<!DOCTYPE html>
<html>

<head>
<title>数据类别管理</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>
		<div class="fui-toolbar">
			<div class="button-group mr5">
				<a class="mini-button" onclick="openAdd()">新增分类</a>
				<a class="mini-button" onclick="saveAll()">保存分类</a>
				<a class="mini-button" onclick="deleteSelected()">删除选中</a>
			</div>
		</div>

		<div class="fui-condition">
			<!-- 表单布局 -->
			<div class="fui-form" id="fui-form">
				<div role="form">
					<!-- 2列 -->
					<div role="row">
						<div role="control" label="分类名称" starred="false">
							<input bind="typeName" id="typeName" class="mini-textbox" />
						</div>
					</div>
				</div>
			</div>
			<!-- 搜索按钮 -->
			<a role="searcher" callback="searchData"></a>
		</div>
		<div id="fuiContent" class="mini-fit">
			<div id="datagrid"  style = 'width: 100%;height:100%'class="mini-datagrid" sortOrder="desc"
				idField="rowguid" multiSelect="true"
				allowResize="false" onlyCheckSelection="true"
				allowCellValid="true" action="getTableData" showPager="true"
				allowCellEdit="true" allowCellSelect="true" pagerType="pagination"
				editNextOnEnterKey="true" editNextRowCell="true">
				<div property="columns">
					<div type="checkcolumn" width="30"></div>
					<div type="indexcolumn" headerAlign="center" width="40">序</div>
					<div field="typeName" width="220" headerAlign="center"
						vtype="required;maxLength:100">
						分类名称 <input property="editor" class="mini-textbox"
							style="width: 99%" />
					</div>
					<div field="orderNum" width="40" headerAlign="center"
						align="center" vtype="int;range:0,99999">
						排序号 <input property="editor" class="mini-textbox"
							style="width: 99%" />
					</div>
					<div width="40" headerAlign="center" align="center"
						renderer="onEditRenderer">修改</div>
					<div width="40" headerAlign="center" align="center"
						renderer="onRelateRenderer">关联表</div>
					<div field="rowguid" visible="false"></div>
				</div>
			</div>
		</div>
	<script src="../../rest/resource/jsboot"></script>
	<script>
		//初始化页面
		epoint.initPage("dxpmodeldatatabletypelistaction");

		

		// 绘制修改按钮
		var onEditRenderer = function(e) {
			return epoint.renderCell(e, "action-icon icon-edit", "openEdit",
					"rowguid");
		};
		

		// 绘制查看按钮
		var onRelateRenderer = function(e) {
			return epoint
					.renderCell(e, "action-icon icon-gear", "openRelateSetting");
		};

		//修改
		function openEdit(e) {
				epoint.openDialog('修改数据表',
						'./tabletypeadd?rowguid='
								+ e, function() {
							mini.get('datagrid').reload();
						}, {
							'width' : 1000,
							'height' : 300
						});
			
		}

		//修改
		function openAdd() {
				epoint.openDialog('新增数据类别',
						'./tabletypeadd', function() {
							mini.get('datagrid').reload();
						}, {
							'width' : 1000,
							'height' : 300
						});
			
		}

		
		
		// 删除
		function deleteSelected() {
			epoint.confirm("确认删除？", "删除确认", function(){
				epoint.execute('deleteSelected', '', function(data) {
					if (data.msg=='删除成功！') {
						epoint.alertAndRefresh(data.msg,'','success');
					}else{
						epoint.alertAndRefresh(data.msg,'','warning');
					}
				});
			});
		}

		// 回掉提醒
		function msgCallBack(data) {
			var msg = data.msg;
			if (msg) {
				if (msg.indexOf("成功") == -1) {
					epoint.alert(msg, '', '', 'warning');
					searchData();
				} else {
					epoint.alert(msg);
					searchData();
				}
			}
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid','fui-form']);
		}


		// 保存信息
		function saveAll() {
			if (mini.get('datagrid').isValid()) {
				epoint.execute('saveAll', [ 'datagrid', 'fui-form' ],
						msgCallBack);
			} else {
				epoint.alert('分类名称 不允许为空,排序号长度不允许超过5位!', '', null, 'warning');
			}
		}

		function callback(param) {
			if ("close" == param) {
				searchData2();
			} else {
				searchData();
			}
		}
		
		function openRelateSetting(e){
			epoint.openDialog('数据类别关联',
					'./tablerelate?typeguid='+e, '', {
						'width' : 800,
						'height' : 500
					});
		}
		

	</script>

</body>
</html>