<!DOCTYPE html>
<html>
<head>
<title>过程版本添加</title>
<meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<link rel="stylesheet" href="../css/workflowicons.css?releaseNo=#{version.version}" />
<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" iconCls="icon-addcircle" id="addbtn" onclick="addProcessVersion()">确定</a> 
			<a class="mini-button" iconCls="icon-removecircle" id="cancelbtn" onclick="epoint.closeDialog()">取消添加</a>
		</div>
	</div>
	
	<div class="fui-content">
		<div class="fui-form"  id="fui-form">
			<div role="form">
				<!-- 2列 -->
				<div role="row">
					<div role="control" label="版本" starred="true">
						<input class="mini-textbox" required="true" style="width: 100%;"
							bind="workflowProcessVersion.version" emptyText="版本不能为空"/>
					</div>
				</div>
				<div role="row">
					<div role="control" label="监听类" id="type">
						<input class="mini-textbox" bind="workflowProcessVersion.tag" />
					</div>
					<div role="control" label="作者" id="showFormUrl">
						<input class="mini-textbox" bind="workflowProcessVersion.author" />
					</div>
				</div>
<!-- 				<div role="row"> -->
<!-- 					<div role="control" label="复制现有版本"> -->
<!-- 						<div id="copyprocess" class="mini-combobox" bind="copyProcess" action="getAllProcessList" -->
<!-- 							onvaluechanged="processChange();" textField="text" -->
<!-- 							valueField="id" enabled="true" ></div> -->
<!-- 					</div> -->
<!-- 				</div> -->
<!-- 				<div role="row" id="version"  style="display: none;"> -->
<!-- 					<div role="control" label="版本"> -->
<!-- 						<div class="mini-combobox" id="copyversion" bind="copyVersion" textField="text" valueField="id"  ></div> -->
<!-- 					</div> -->
<!-- 				</div> -->
				<div role="row" id="formSel">
				    <div role="control" label="表单"  id="type">
					     <input id="formTree" class="mini-treeselect" bind="formUrl" action="getTreeModal"  multiSelect="false" onbeforenodeselect="beforenodeselect"/>
				    </div>
			    </div>
				<div role="row">
					<div role="control" label="备注">
						<input class="mini-textarea" bind="workflowProcessVersion.note" style="width: 100%; height: 80px" />
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="../../../../rest/resource/jsboot"></script>

	<!-- 配置变量 -->
	<script>
		//<![CDATA[
		//初始化页面
		epoint.initPage("processversionsformaddaction");
		
		function addProcessVersion() {
			if (epoint.validate()) {
				epoint.execute('addProcessVersion', '', addComplete);
			}
		}

		function addComplete(data) {
			if (data) {
				var msg = data.message;
				if(msg != null && msg.indexOf('成功')>-1){
					epoint.alertAndClose(data.message, '', null, null, 'success');
				}else{
					epoint.alert(data.message, '', '', 'warning');
				}
			}
		}
		
		function processChange() {
			var processId = mini.get("copyprocess").getValue();
			if (processId != "0") {
				epoint.execute("versionValueChange",'fui-form',[processId],tcallback);
			}
			isShow();
		}
		
		function tcallback(data) {
            if (data) {
            	mini.get("copyversion").setData(data);
            }
        }
		
		function isShow(){
			var processId = mini.get("copyprocess").getValue();
			if (processId != "0") {
				document.getElementById("formSel").style.display = "none";
				document.getElementById("version").style.display = "block";
			} else {
				document.getElementById("formSel").style.display = "block";
				document.getElementById("version").style.display = "none";
			}
		}
		function beforenodeselect(e){
			if(e.isLeaf == false || e.record.ckr == false || e.record.path == 'parent' || e.record.noClick == true){
				e.cancel = true;
			}
		}
		//]]>
	</script>
</body>
</html>