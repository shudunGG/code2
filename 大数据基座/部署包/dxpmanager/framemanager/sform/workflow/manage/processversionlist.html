<!DOCTYPE html>
<html>
<head>
<title>流程版本管理</title>
<meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>

	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" iconCls="icon-addcircle" id="addbtn" onclick="openAddDialog()">新增版本</a> 
			<a class="mini-button" iconCls="icon-removecircle" onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择想要删除的记录！', '', null, 'warning');} else {epoint.confirm('是否确定删除？','',deleteSelect);}">删除选中</a>
		</div>
		<input class="mini-output" bind="processName" />
	</div>

	<div class="fui-content">
		<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="processVersionGuid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			allowCellValid="true" action="getDefaultModel" showPager="true">
			<div property="columns">
				<div type="checkcolumn" width="30"></div>
				<div type="indexcolumn" headerAlign="center" width="30">序</div>
				<div field="version" headerAlign="center" align="center">版本</div>
				<div field="note" headerAlign="center" align="center">备注</div>
				<div width="60" headerAlign="center" align="center" renderer="changeImage">状态</div>
				<div headerAlign="center" align="center" width="80" renderer="method">方法管理</div>
				<div headerAlign="center" align="center" width="60" renderer="design">流程设计</div>
				<div headerAlign="center" align="center" width="50" renderer="edit">修改</div>
				<div field="status" visible="false"></div>
			</div>
		</div>
		<div style="display: none">
			<input id="processGuid" class="mini-textbox" bind="processGuid" />
		</div>
	</div>

	<script src="../../../../rest/resource/jsboot"></script>

	<!-- 配置变量 -->
	<script>
		//<![CDATA[
		//初始化页面
		epoint.initPage("processversionsformlistaction");

		function design(e) {
			return epoint.renderCell(e, "action-icon icon-gear", "JumpToDesign");
		}

		function edit(e) {
			return epoint.renderCell(e, "action-icon icon-edit", "editVersion");
		}

		function changeImage(e) {
			if (e.row.status == 10) {
				return epoint.renderCell(e, "action-icon icon-start","changeStatus");
			} else {
				return epoint.renderCell(e, "action-icon icon-pause","changeStatus");
			}
		}

		function changeStatus(e) {
			epoint.execute('changeImage', '@none', [ e ], msgCallBack);
		}

		// 删除
		function deleteSelect() {
			epoint.execute('deleteSelect', 'datagrid', msgCallBack);
		}

		// 回调提醒
		function msgCallBack(data) {
			if (data) {
				var msg = data.msg;
				if(msg != null && msg.indexOf('成功')>-1){
					epoint.alert(msg, '', searchKeepPage(), 'success');
				}else{
					epoint.alert(msg, '', '', 'warning');
				}
			}
		}

		function openAddDialog() {
			var processGuid = mini.get('processGuid').getValue();
			var url = "processversionbaseinfoadd?processGuid=" + processGuid;
			epoint.openDialog('新增版本', "framemanager/sform/workflow/manage/" + url,
					searchKeepPage, {
						'width' : 800,
						'height' : 600
					});
		}

		function changeComplete(msg) {
			if (msg) {
				epoint.alertAndClose(msg, '', null, null, 'info');
			}
		}

		function editVersion(processVersionGuid) {
			var url = "processversionbaseinfoedit?processVersionGuid=" + processVersionGuid;
			epoint.openDialog('修改版本', "framemanager/sform/workflow/manage/" + url,
					searchKeepPage, {
						'width' : 800,
						'height' : 600
					});
		}

		function JumpToDesign(processVersionGuid) {
			epoint.openTopDialog('流程设计', "framemanager/sform/workflow/design/designbodyoa9?processVersionGuid=" + processVersionGuid);
		}
		
		function method(e) {
			return epoint.renderCell(e, "action-icon icon-paper",
					"JumpToMethod");
		}
		
		function JumpToMethod(processVersionGuid) {
			var url = "methodlist?processVersionGuid=" + processVersionGuid;
			epoint.openDialog('配置流程方法', "framemanager/workflow/design/" + url, '', {
				'width' : 1000
			});
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh('datagrid');
		}
		function searchKeepPage() {
			epoint.refresh('datagrid','',true);
		}
		//]]>
	</script>
</body>
</html>
