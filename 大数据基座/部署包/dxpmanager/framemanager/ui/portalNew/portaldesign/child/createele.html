<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>创建元件副本</title>
    <script src="../../../../../frame/fui/js/cssboot.js"></script>
    <style>
        .content {
            padding: 15px;
        }

        .mr-5 {
            margin-right: 5px;
        }

        .w-full {
            width: 100%;
        }

        .lh-mid {
            line-height: 24px;
            margin-top: 5px;
        }

        .scroll {
            height: 100%;
            overflow-y: auto;
        }

        .footer {
            height: 50px;
            line-height: 50px;
            box-sizing: border-box;
            padding: 12px 15px;
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
        }
        a.mini-button.portal-confirm {
            background-color: #3d9df2;
            border-radius: 0;
            border: 1px solid #3d9df2;
            height: 24px;
            line-height: 24px;
            padding: 0 12px;
            min-width: auto;
        }

        a.mini-button.portal-confirm:hover {
            background-color: #50acfd;
            border-radius: 0;
            border: 1px solid #50acfd;
            height: 24px;
            line-height: 24px;
            padding: 0 12px;
            min-width: auto;
        }

        a.mini-button.portal-cancel {
            background-color: #fff;
            border: 1px solid #bdbec1;
            color: #666;
            border-radius: 0;
            height: 24px;
            line-height: 24px;
            padding: 0 12px;
            min-width: auto;
        }

        a.mini-button.portal-cancel:hover {
            border: 1px solid #3d9df2;
            color: #3d9df2;
            background-color: #fff;
            border-radius: 0;
            height: 24px;
            line-height: 24px;
            padding: 0 12px;
            min-width: auto;
        
        }
    </style>
</head>

<body>
    <div class="content">
        <div class="clearfix lh-mid">
            <div>元件名称</div>
            <div>
                <input id="name" style="" name="name" class="mini-textbox w-full" />
            </div>
        </div>
        <div class="clearfix lh-mid">
            <div>栏目设置</div>
            <div>
                <input id="column" name="column"
                    data="" textField="name"
                    valueField="id" value="" class="mini-combobox w-full" />

                <input id="url" name="url" class="mini-textbox w-full" visible="false" />
            </div>
        </div>
        <div class="clearfix lh-mid">
            <div id="diy" name="diy" class="mini-checkbox" readOnly="false" text="自定义链接"
            onvaluechanged="onDiyChange"></div>
        </div>
    </div>

    <div class="footer text-right clearfix">
        <a class="mini-button r mr-5 portal-confirm"  onclick="save()">保存</a>

        <a class="mini-button r mr-5 portal-cancel" onclick="jump()">取消</a>
    </div>
    <script src="../../../../../rest/resource/jsboot"></script>
    <script>
        var portalConfig = {
            getColumns: 'rest/portaldesignaction/getColumns?isCommondto=true' // 获取主栏目数据
        };
    </script>
<!--     <script src="./_test/mock_data.column.js"></script> -->
    <script>
        (function (win, $) {
            var $column = mini.get('column'),
                $url = mini.get('url'),
                $name = mini.get('name'),
                $diy = mini.get('diy'),
                columnId = Util.getUrlParams('columnId');


            // win.pageLoad = function (data) {
            //     $name.setValue(data.title);
            // }
            $name.setValue(Util.getUrlParams('title') + '-副本');

            // 保存
            win.save = function () {
               
                var isDiy = $diy.checked;

                if(!isDiy) {
                    if(!$column.value) {
                        epoint.alert('栏目信息不能为空');
                        return;
                    }
                } else {
                    if(!$url.value) {
                        epoint.alert('自定义链接不能为空');
                        return;
                    }
                }

                var selectColumn = $column.getSelected();
                var url = '',
                    id = '',
                    name = '';

                if(selectColumn && selectColumn.id) {
                    url = selectColumn.url;
                    id = selectColumn.id;
                    name = selectColumn.name;
                } else {
                    url = $url.value;
                }

                epoint.closeDialog({
                    type: 'ok',
                    options: {
                        name: $name.value,
                        columnId: id,
                        columnName: name,
                        columnUrl: url, // 栏目地址
                        isDiy: isDiy
                    }
                });
            }

            win.jump = function () {
                epoint.closeDialog({
                    type: 'close',
                    options: {
                        
                    }
                });
            }

            // 自定义链接
            win.onDiyChange = function (e) {
                if (this.getChecked()) {
                    $column.setVisible(false);
                    $url.setVisible(true);
                } else {
                    $column.setVisible(true);
                    $url.setVisible(false);
                }
            }

            /* -------- 加载栏目 ---------- */

            function getColumns() {
                Util.ajax({
                    url: portalConfig.getColumns
                }).done(function (data) {
                    
                    $column.setData(data.columns);
                    $column.setValue(columnId);
                });
            }

            getColumns();

            /* -------- 加载栏目 end ---------- */
        })(window, jQuery);
    </script>
</body>

</html>