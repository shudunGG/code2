<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>门户编辑</title>
    <script src="../../../../frame/fui/js/cssboot.js"></script>
    <script>
        SrcBoot.output(['framemanager/ui/portalNew/mCustomScrollbar/jquery.mCustomScrollbar.min.css',
            'framemanager/ui/portalNew/portaldesign/css/index.css',
            'framemanager/ui/portalNew/portaldesign/css/ruler.css'
        ]);
    </script>
</head>

<body>
    <div class="top">
        <span class="title" id="title"></span>
        <div class="r">
            <a class="mini-button" onclick="save()" >保存</a>
        </div>
    </div>
    <div class="main relative" id="main">
        <!-- 左侧面板 -->
        <div class="sidebar-panel" id="sidebar-panel">
            <ul class="types">
                <li class="type icon-page" data-ref="page" title="页面"></li>
                <li class="type icon-element" data-ref="element" title="元件"></li>
                <!-- <li class="type icon-template" data-ref="template" title="模板"></li> -->
            </ul>
            <div class="panel-back"></div>
            <ul class="types-detail">
                <!-- 页面的详情 -->
                <li class="type-detai  page-detail">
                    <div class="page-box">
                        <h3 class="detail-title">页面</h3>
                        <div class="clearfix lh-mid">
                            <div class="l">宽度：</div>
                            <div class="r">
                                <div id="widthType" bind="template.widthType" name="level"
                                    data="[{text:'按比例',id:'1'},{text:'按固值',id:'2'}]" textField="text" valueField="id"
                                    value="1" class="lh-mid mini-radiobuttonlist" style="width: 100%" bind="template.pageWidth"
                                    onvaluechanged="widthChange"></div>
                            </div>
                        </div>
                        <div class="clearfix lh-mid">
                            <div class="l">数值：</div>
                            <div class="r page-number percent" id="page-number">
                                <input id="pageWidth" bind="template.pageWidth" visible="false" width="80" class="mini-textbox"
                                    style="margin-top: -5px;" emptyText="" vtype="int" onvaluechanged="widthValueChange"/>
                                <input id="pagePercent" visible="true" bind="template.pagePercent" width="80"
                                    class="mini-textbox" style="margin-top: -5px;" emptyText="" vtype="int" onvaluechanged="widthPercentChange" />
                            </div>
                        </div>
                        <h3 class="detail-title">辅助设计</h3>
                        <div class="clearfix lh-mid">
                            <div class="l">栅格线：</div>
                            <div class="r">
                                <div id="eleGrid" name="" bind="template.eleGrid" class="mini-checkbox switch" checked="true"
                                    readOnly="false" onvaluechanged="gridChange"></div>
                            </div>
                        </div>
                        <div class="clearfix lh-mid">
                            <div class="l">标尺：</div>
                            <div class="r">
                                <div id="eleRuler" name="product" bind="template.eleRuler" class="mini-checkbox switch"
                                    checked="false" readOnly="false" onvaluechanged="ruleChange"></div>
                            </div>
                        </div>
                        <h3 class="detail-title">门户操控 <i class="title-tip" title="前台用户的门户配置能力">?</i> </h3>
                        <div class="clearfix lh-mid">
                            <div class="l">元件拖动：</div>
                            <div class="r">
                                <div id="eleMove" name="product" bind="template.eleMove" class="mini-checkbox switch"
                                    checked="true" readOnly="false" onvaluechanged="eleMoveChange"></div>
                            </div>
                        </div>
                        <div class="clearfix lh-mid">
                            <div class="l">元件显隐：</div>
                            <div class="r">
                                <div id="eleShow" name="product" bind="template.eleShow" class="mini-checkbox switch"
                                    checked="true" readOnly="false" onvaluechanged="eleShowChange"></div>
                            </div>
                        </div>
                        <div class="clearfix lh-mid">
                            <div class="l">元件缩放：</div>
                            <div class="r">
                                <div id="eleScale" name="product" bind="template.eleScale" class="mini-checkbox switch"
                                    checked="true" readOnly="false" onvaluechanged="eleScaleChange"></div>
                            </div>
                        </div>

                    </div>

                </li>
                <!-- 元件的详情 -->
                <li class="type-detail hidden h-full element-detail">
                    <div class="element-box h-full relative">
                        <ul class="element-tabs clearfix">
                            <li class="element-tab active text-center w-half l" data-ref="template">模板</li>
                            <li class="element-tab text-center w-half l" data-ref="lib">仓库
                                <span class="lib-num"></span> </li>
                        </ul>


                        <ul class="mt-10">
                            <!-- 模板 -->
                            <li class="template-panel">
                                <input class="detail-search relative" id="ele-search" type="text" placeholder="搜索模板">

                                <div class="element-detail-container" id="element-list-container">
                                    
                                </div>
                            </li>
                            <!-- 仓库 -->
                            <li class="hidden lib-panel">
                                <input class="detail-search relative" id="lib-search" type="text" placeholder="搜索模板">

                                <div class="mt-10 element-detail-container" id="lib-list-container">
                                    <ul>
                                        
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
        <!-- 右侧内容 -->
        <!-- 817 和 1592宽度会重绘 -->
        <div class="container-panel" id="container-panel">
            <div class="painting-area" id="painting-area">
                <div class="grid-container gridster row-line ui-droppable" id="grid-container">
                    <ul>

                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 存为模板 -->
    <div id="htmlContent" class="diy-html" style="display:none;">
        <input id="portal-name" class="portal-name" placeholder="请输入模板名称" />
    </div>

    <!-- 模板重命名 -->
    <div id="tempRename" class="diy-html" style="display:none;">
        <input id="temp-name" class="portal-name" placeholder="" />
    </div>

    <!-- 仓库更多-->
    <ul id="lib-more-menu" class="more-menu">
        <li class="menu-item" data-ref="edit">编辑</li>
        <!-- <li class="menu-item" data-ref="create">创建副本</li> -->
        <li class="menu-item text-red" data-ref="delete">删除</li>
    </ul>

    <!-- 模板更多 -->
    <ul id="temp-more-menu" class="more-menu">
        <li class="menu-item" data-ref="rename">重命名</li>
        <li class="menu-item" data-ref="edit">编辑</li>
        <li class="menu-item text-blue public-item" data-ref="public">公开模板</li>
        <!-- <li class="menu-item text-blue" data-ref="cancel">取消公开</li> -->
        <li class="menu-item text-red" data-ref="delete">删除</li>
    </ul>

    <!-- 元件（模板） -->
    <!-- data-colspan="{{sizex}}" 
                        data-rowspan="{{sizey}}"  -->
    <script type="x-tmpl-mustache" id="element-item-tpl">
        <ul>
            {{#list}}
            <li class="template-lists">
                <div class="template-title" data-id="{{id}}">{{name}}</div>
                <ul class="clearfix element-list">
                    {{#items}}
                    <li class="l el-item drag-item w-full" 
                        title="{{name}}"
                        data-sizex="{{sizex}}" 
                        data-sizey="{{sizey}}" 
                        data-id="{{id}}" 
                        data-name="{{name}}" >
                        <i class="element-icon {{icon}} l"></i>
                        <div class="element-content text-ellipsis l">{{{name}}}</div>
                    </li>
                    {{/items}}
                </ul>
            </li>
            {{/list}}
        </ul>
    </script>

    <!-- 元件（搜索模板） -->
    <script type="x-tmpl-mustache" id="element-item-search-tpl">
        <ul>
            {{#list}}
            {{#has}}<li class="template-lists">
                <div class="template-title" data-id="{{id}}">{{name}}</div>
                <ul class="clearfix element-list">
                    {{#items}}{{#result}}
                    <li class="l el-item drag-item w-full" 
                        title="{{name}}"
                        data-sizex="{{sizex}}" 
                        data-sizey="{{sizey}}" 
                        data-id="{{id}}" 
                        data-name="{{name}}" >
                        <i class="element-icon {{icon}} l"></i>
                        <div class="element-content text-ellipsis l">{{{result}}}</div>
                    </li>
                    {{/result}}{{/items}}
                </ul>
            </li>{{/has}}
            {{/list}}
        </ul>
    </script>

    <!-- 元件（仓库） -->
    <script type="x-tmpl-mustache" id="lib-item-tpl">
        <ul>
            {{#list}}
            <li id="lib-item-{{id}}" class="lib-item drag-item{{#visible}} active{{/visible}}" data-id="{{id}}" data-title="{{title}}" data-other="{{other}}" data-url="{{url}}" data-sizex="{{sizex}}" data-sizey="{{sizey}}">
                <i class="icon-eye" title="切换元件可见性"></i>
                <div class="lib-content text-ellipsis" title="{{title}}">
                    {{title}}
                </div>
                <div class="lib-more"></div>
            </li>
            {{/list}}
        </ul>
    </script>
    <!-- 元件（搜索仓库） -->
    <script type="x-tmpl-mustache" id="lib-item-search-tpl">
        <ul>
            {{#list}}
            {{#result}}<li id="lib-item-{{id}}" class="lib-item drag-item{{#visible}} active{{/visible}}" data-public-id="{{publicId}}" data-id="{{id}}" data-title="{{title}}"  data-other="{{other}}" data-url="{{url}}" data-sizex="{{sizex}}" data-sizey="{{sizey}}">
                <i class="icon-eye" title="切换元件可见性"></i>
                <div class="lib-content text-ellipsis" title="{{title}}">
                    {{{result}}}
                </div>
                <div class="lib-more"></div>
            </li>{{/result}}
            {{/list}}
        </ul>
    </script>

    <!-- 模板 -->
    <script type="x-tmpl-mustache" id="temp-item-tpl">
        {{#list}}
            <li class="template-lists" data-id="{{id}}" data-name="{{name}}">
                <div class="template-title">{{name}}</div>
                <ul class="template-list clearfix" id="temlate-list-{{id}}">
                    {{#items}}
                    <li class="l template-item-box{{#publicId}} public{{/publicId}}" id="template-item-{{id}}" data-public-id="{{publicId}}" data-id="{{id}}" data-name="{{name}}">
                        <div class="template-item">
                            <div class="temp-item-img">{{#public}}<img src="./css/images/icon_public.png" alt="">{{/public}}{{^public}}<img src="./css/images/icon_my.png" alt="">{{/public}}
                            </div>
                            <p class="temp-item-text">{{name}}</p>
                            <div class="temp-status">公开</div>
                        </div>
                        
                        {{^public}}<div class="temp-more"></div>{{/public}}
                    </li>
                    {{/items}}
                </ul>
            </li>
            {{/list}}
        </script>

    <!-- 模板（搜索） -->
    <script type="x-tmpl-mustache" id="temp-item-search-tpl">
        {{#list}}
            {{#has}}<li class="template-lists" data-id="{{id}}" data-name="{{name}}">
                <div class="template-title">{{name}}</div>
                <ul class="template-list clearfix" id="temlate-list-search-{{id}}">
                    {{#items}}
                    {{#result}}<li class="l template-item-box{{#public}} public{{/public}}" id="template-item-search-{{id}}" data-public-id="{{publicId}}" data-id="{{id}}" data-name="{{name}}">
                        <div class="template-item">
                            <div class="temp-item-img"><img src="{{img}}" alt="">
                            </div>
                            <p class="temp-item-text">{{{result}}}</p>
                            <div class="temp-status">公开</div>
                        </div>
                        
                        <!-- {{^public}}<div class="temp-more"></div>{{/public}} -->
                    </li>{{/result}}
                    {{/items}}
                </ul>
            </li>{{/has}}
            {{/list}}
        </script>

    <!-- 右侧移动的元件 -->
    <!-- data-rowspan="{{rowspan}}" 
            data-colspan="{{colspan}}"  -->
    <script type="x-tmpl-mustache" id="element-tpl">
        <li id="element-{{id}}" class="widget elem-item element-item {{#showHeader}} showHeader{{/showHeader}} showToolbar" 
            {{^themeCheck}}
            style="{{#borderColor}}border-color: {{borderColor}};{{/borderColor}}
                {{#border}}border-width: {{border}}px;{{/border}}
                {{#bg}}background-color: {{bg}};{{/bg}} 
                border-style: solid;
                {{#shadow}}box-shadow: 0 0 6px 2px {{shadow}};{{/shadow}}
                {{#radius}}border-radius: {{radius}}px;{{/radius}}
            " 
            {{/themeCheck}}
            data-id="{{id}}" 
            data-max-start="{{maxStart}}"
            data-max-end="{{maxEnd}}"
            data-min-start="{{minStart}}"
            data-min-end="{{minEnd}}"
            data-link-open-type="{{linkOpenType}}"
            data-theme-check="{{themeCheck}}"
            data-border="{{border}}"
            data-border-color="{{borderColor}}"
            data-bg="{{bg}}"
            data-shadow="{{shadow}}"
            data-radius="{{radius}}"
            data-show-header="{{showHeader}}" 
            data-title="{{title}}" 
            data-title-color="{{titleColor}}" 
            data-title-bg-color="{{titleBgColor}}" 
            data-icon="{{icon}}" 
            data-icon-color="{{iconColor}}"
            data-show-more-btn="{{showMoreBtn}}" 
            data-more-url="{{moreOpenUrl}}" 
            data-show-refresh-btn="{{showRefreshBtn}}" 
            data-show-add-btn="{{showAddBtn}}" 
            data-add-url="{{addUrl}}"
            data-url="{{url}}" 
            data-manage-url="{{manageUrl}}" 
            data-item-num="{{itemNum}}"
        >
            {{#showHeader}}
            <div class="element-header"
                style ="
                {{#titleColor}}color:{{titleColor}};{{/titleColor}}
                {{#titleBgColor}}background:{{titleBgColor}};{{/titleBgColor}}
                ">
                <!-- {{#icon}}<i style="color: {{iconColor}}" class="title-icon modicon-{{icon}}"></i>{{/icon}} -->
                {{#icon}}<div class="l title-icon mr-5" id="icon-set" style="background: url({{titleIcon}}) no-repeat;"></div>{{/icon}}
                <span style="{{#icon}}padding-left: 0;{{/icon}}" class="name">{{title}}</span>
                <div class="header-operations">
                    {{#showAddBtn}}<span data-url="{{addUrl}}" class="icon add"></span>{{/showAddBtn}}
                    {{#showMoreBtn}}<span data-url="{{moreUrl}}" class="icon open"></span>{{/showMoreBtn}}
                    {{#showRefreshBtn}}<span class="icon refresh"></span>{{/showRefreshBtn}}
                </div>
            </div>
            {{/showHeader}}
            
            {{#hasChildColumn}}
                {{#column}}
                <div class="element-columns">
                    <ul>
                        {{#columnItems}}
                            <li class="column-item-{{id}} element-column-item{{#default}} active{{/default}}" data-is-diy="{{isDiy}}"  data-id="{{id}}" data-name="{{name}}" title="{{name}}" data-url="{{url}}" data-default="{{default}}" data-show-num="{{showNum}}">{{name}}</li>
                        {{/columnItems}}
                    </ul>
                </div>
            {{/column}}
            {{/hasChildColumn}}
            <div class="element-toolbar">
                <span class="split"></span>
                <span class="icon elem-icon setting" data-ref="set"></span>
                <span class="icon elem-icon delete" data-ref="delete"></span>
            </div>
            <div class="element-body" id="element-body-{{id}}" style="{{^showHeader}}height: 100%;{{/showHeader}} {{#hasChildColumn}}height: calc(100% - 80px); {{/hasChildColumn}}">
            </div>
            <span class="spots spot-lt"></span>
            <span class="spots spot-lb"></span>
            <span class="spots spot-rt"></span>
            <span class="spots spot-rb"></span>
        </li>
    </script>

    <script type="x-tmpl-mustache" id="element-content-tpl">
        <ul class="element-body-list">
            {{#itemList}}
            <li class="todo-item">
                <a href="javascript:;" class="todo-item-link" title="{{title}}" data-url="{{url}}" data-id="{{id}}">{{{content}}}</a>
                <span class="todo-item-date">{{date}}</span>
            </li>
            {{/itemList}}
        </ul>
    </script>

    <!-- data-rowspan="{{rowspan}}" 
            data-colspan="{{colspan}}"  -->
    <script type="x-tmpl-mustache" id="cache-element-tpl">
            
        <li class="widget cache-elem-item element-item" 
            id="cache-element-{{id}}"
            data-name="{{title}}" 
            data-row="{{row}}" 
            data-col="{{col}}" 
            data-sizex="{{sizex}}" 
            data-sizey="{{sizey}}"
        >
            
        </li>
    </script>
    <script src="../../../../rest/resource/jsboot"></script>
    <script>
        var domain = "rest/templatedesignaction/",
            portalGuid = Util.getUrlParams('tempGuid'), // 门户ID
            portalConfig = {
                createElementUrl: domain + 'createElement?isCommondto=true',
                getEleDataUrl: domain + 'getComponentTemplate?isCommondto=true', // 元件-模板获取地址
                setEleVisible: domain + 'setElementVisible?isCommondto=true', // 设置元件仓库模板是否可见
                delEleLib: domain + 'deleteLibComponent?isCommondto=true', // 删除元件仓库模板
                saveTemplate: domain + 'saveTemplate?isCommondto=true' // 存为模板
            };
    </script>

    <script>
        SrcBoot.output([
            './js/jquery.gridster.min.js',
            './js/jquery.ruler.js',
            './js/edit.js'
        ]);
    </script>

    <script>
        // portaldesignaction
        // templatedesignaction
        epoint.initPage('templatedesignaction', '@all', function (data) {
            // 初始化左侧宽度方式
            // console.log()
            widthType(mini.get('widthType').value);

            // 初始化内容
            var tableData = data.tableData ||[];
            gridster.remove_all_widgets();
            
            if(tableData.length) {
                $.each(tableData, function (index, item) {
                    ElementManage.addElementItem(item, true);
                });
            }
            
        });
    </script>

</body>

</html>