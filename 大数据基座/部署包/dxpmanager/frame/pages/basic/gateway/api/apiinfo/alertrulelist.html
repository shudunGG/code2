<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
<title>预警列表</title>
<script src="../../../../../fui/js/cssboot.js"></script>
<script src="../../../../../../frame/fui/js/libs/jquery-1.12.4.min.js"></script>
</head>
<body>
	<div class="page-loading"></div>
	<div id="tabs1" class="mini-tabs" activeIndex="0"  onactivechanged="getDataInfo"
		style="width: 100%;" plain="false">
		<div name="tabs1" title="自定义规则" id="tabs">
			<!-- toolbar区域 -->
			<div class="fui-toolbar">
				<div class="btn-group mr10">
					<a class="mini-button" onclick="openAdd();" id="btnAddRecord">
						新增预警规则 </a>
					<a id="btnDel" class="mini-button"
						onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择要删除的记录!');} else {epoint.confirm('确认要删除吗?','',deleteSelect);}">
						删除选定 </a>
					<a class="mini-button init" onclick="initialization();" id="initialization">一键初始化</a>
				</div>
			</div>
		</div>
		<div name="tabs2" title="智能分析规则">
			<!-- toolbar区域 -->
			<div class="fui-toolbar">
				<div class="btn-group mr10">
					<a id="btnDel" class="mini-button"
						onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择要删除的记录!');} else {epoint.confirm('确认要删除吗?','',deleteSelect);}">
						删除选定 </a>
					<a class="mini-button" onclick="analysis();" id="analysis">AI分析 </a>
				</div>
			</div>
		</div>
	</div>
	
	<div class="fui-condition hidden">
		<div class="fui-form" id="fui-form">
		  <input bind="ruleType" id="ruletype" class="mini-hidden" /> 
		</div>
		<a role="searcher" callback="searchData"></a>
	</div>
	<div class="fui-content">
		<div class="fui-content">
			<div id="datagrid" name="datagrid" class="mini-datagrid"
				idField="rowguid" multiSelect="true"
				style="width: 100%; height: 100%;" allowResize="true"
				showPager="true" action="getDataGridData">
				<div property="columns">
					<div width="20" type="checkcolumn"></div>
					<div type="indexcolumn" width="20" headerAlign="center">序</div>
					<div field="rulename" headerAlign="center" align="left" width="50">规则名称</div>
					<!-- <div field="status" headerAlign="center" align="center" width="40"
						renderer="onColorRenderer">状态</div> -->
					<div field="metric" headerAlign="center" align="center">监控项</div>
					<div field="vdoing" headerAlign="center" align="center">维度</div>
					<div field="alertrule" headerAlign="center" align="left"
						width="150">报警规则</div>
					<div field="enabled" headerAlign="center" align="center" width="40" renderer="onColorEnabledRenderer">启用</div>
					<div headerAlign="center" align="center"
						renderer="onOperationRenderer" width="50">操作</div>
					
				</div>
			</div>
		</div>
	</div>
	

	<script src="../../../../../../rest/resource/jsboot"></script>
	<script>
		epoint.initPage('alertrulelistaction','',function(){
			
		});

		// 绘制行操作按钮
		var onOperationRenderer = function(e) {
			var html = '<a href="javascript:void(0);" onclick="openEdit(\''
					+ e.row.rowguid
					+ '\');" class="action-icon icon-edit" title="修改">&nbsp;&nbsp;&nbsp;&nbsp;'
			if ("已禁用" == e.row.enabled) {
				html += '<a href="javascript:void(0);" onclick="openStop(\''
						+ e.row.enabled
						+ '\');" class="action-icon icon-start" title="启用">';
			}
			if ("已启用" == e.row.enabled) {
				html += '<a href="javascript:void(0);" onclick="openStop(\''
						+ e.row.enabled
						+ '\');" class="action-icon icon-stop" title="禁用">';
			}
			return html;
		};

		// 弹出新增窗口
		function openAdd() {
			epoint
					.openDialog(
							'新增预警规则',
							"frame/pages/basic/gateway/api/apiinfo/alertrule?opentype=add",
							searchData, {
								width : 1200,
								height : 800
							});
		}

		// 删除数据
		function deleteSelect() {
			epoint.execute("deleteSelect", '', closeCallback);
		}

		// 关闭操作的回调
		function closeCallback(data) {
			var msg = data.msg;
			if (msg) {
				if (data.success) {
					epoint.alertAndClose(msg, null, null, null, 'info');
					searchData();
				} else {
					epoint.alert(msg, null, null, 'info');
					searchData();
				}
			}
		}

		function openEdit(id) {
			epoint.openDialog('修改预警规则',
					"frame/pages/basic/gateway/api/apiinfo/alertrule?rowguid="
							+ id + "&opentype=edit", searchData, {
						width : 1200,
						height : 800
					});
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid','fui-form' ]);
		}

		function openStop(enabled) {
			epoint.execute("modifyStatus", '', enabled, function() {
				if ("已禁用" == enabled) {
					epoint.alert("启用成功！", '', searchData);
				}
				if ("已启用" == enabled) {
					epoint.alert("禁用成功！", '', searchData);
				}
			});

		}

		function onColorRenderer(e) {
			var status = e.row.status;
			e.cellStyle = " color:green;";
			return status;
		}
		
		 function onColorEnabledRenderer(e){
			 var enabled = e.row.enabled;
			 if ("已启用" == enabled) {
				 e.cellStyle = " color:green;";
					return enabled;
			 }
			 else if ("已禁用" == enabled){
				 e.cellStyle = " color:red;";
					return enabled;
			 }
		 }
		
		function initialization() {
			epoint.execute('init','','',function(data){
				if (data && data.msg) {
					epoint.alert(data.msg, '', searchData);
				}
			});
		}
		
		function getDataInfo(e){
			var tabType = e.name;
			console.log(tabType);
			if ("tabs1" == tabType) {
				mini.get('ruletype').setValue('0');
			}
			else {
				mini.get('ruletype').setValue('1');
			}
			epoint.execute('getDataGridData');
			searchData();
		}
	</script>
</body>
</html>