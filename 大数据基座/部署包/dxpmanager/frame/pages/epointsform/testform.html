<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<!-- 请修改相对路径-->
<link rel="stylesheet"  href="css/buttonstyle.css"></link>
<title>测试</title>
<style>
  html,body {
      overflow: hidden;
      width: 100%;
      height: 100%;
    }
</style>
</head>
<body>

	<!-- toolbar区域 -->
	<div id="toolbar">
	    <input  type="button" class="mini-button" id="saveBtn"  onclick="add();" value="保存" /> 
	    <input type="button" class="mini-button" id="getDataBtn" onclick="getFormData();" value="获取数据" />
	    <input type="button" class="mini-button" id="printBtn" onclick="printPage();" value="打印" />
	    <input type="button" class="mini-button" id="toolPrintBtn" onclick="printPage('1');" value="工具打印" />
	    <input type="button" class="mini-button" id="htmlToPdfBtn" onclick="htmlToPdfForCont();" value="html转pdf" />
		<input type="button" class="mini-button" id="htmlToPdfBtn" onclick="htmlToPdf();" value="html转pdf(本地保存)" />
		<input type="button" class="mini-button" id="htmlToPicToPdfBtn" onclick="htmlToPicToPdf();" value="html转图片转pdf" />
	</div>
	<pre id="output" style="margin:0;"></pre>
	<!-- 内容区域 -->
	<div id="fui-content" style="width: 100%;height:620px; background-color: #fff; overflow: auto; position:relative;"></div>
	
	<script src="../../fui/js/libs/jquery-1.11.1.min.js"></script>
    <script src="js/epointsform.js"></script>

	<script>
		//<![CDATA[          
		/*function adjustHeight() {
			var $toolbar = $('#toolbar'),
	        $content = $('#fui-content');
			$content.css('height',$('body').height() - $toolbar.height());
		}
		
		$(adjustHeight);
		$(window).on('resize',adjustHeight);*/
		           
		           
		var json = {};
		json.rowGuid = "0939ec57-d20c-4edd-8e45-fb88560759b9"//"5d1197f2-527f-4e34-997f-3af5af897591";
		json.isShowButton = false;
		json.versionId = "";
		json.printPageType="";//不传或者为空：打印调printdetail页面（单选复选控件显示）；1:detail页面（单选复选文字显示）
		//json.epointUrl = "http://localhost:8090/epoint-web-sform";

		/**
		 * 初始化页面，嵌入表单页面
		 *
		 * @param tableId  表单tableId
		 * @param divId  嵌入表单页面的父区域id
		 * @param formType  表单查看类型  add：新增/修改页面；detail：查看页面（单选复选控件对应值文本显示；printdetail:查看页面（单选复选控件值控件显示））
		 * @param param  json格式，拼接Url使用参数(epointUrl如果为空默认当前系统地址)  {epointUrl:'http://ip:port/applicationName',rowGuid:'',isShowButton:false}
		 * @param successCallBack  初始化成功回调事件
		 * @param failedCallBack     初始化失败回调事件
		 */
		epointsform.init(epointsform.getUrlParams("tableId") ? epointsform.getUrlParams("tableId"): 24, "fui-content", "detail", json,
				initSuccessCallBack, initFailedCallBack);

		function add() {
			epointsform.validate(validateSuccessCallBack,
					validateFailedCallBack);
		}

		function validateSuccessCallBack(tag) {
			// 验证成功
			if (tag) {
				/**
				 * 新增/修改保存表单
				 *
				 * @param saveSuccessCallBack  成功回调事件
				 * @param saveFailedCallBack     失败回调事件
				 */
				epointsform.save(saveSuccessCallBack, saveFailedCallBack);
			}
		}

		function validateFailedCallBack(err) {
			console.log(err);
		}

		function saveSuccessCallBack(rowGuid) {
			console.log(rowGuid);
		}

		function saveFailedCallBack(err) {
			console.log(err);
		}

		function getFormData() {
			/**
			 * 获取表单数据
			 *
			 * @param getFormDataSuccessCallBack  成功回调事件
			 * @param getFormDataFailedCallBack     失败回调事件
			 */
			epointsform.getFormData(getFormDataSuccessCallBack,
					getFormDataFailedCallBack);
		}

		function getFormDataSuccessCallBack(formData) {
			console.log(formData);
		}

		function getFormDataFailedCallBack(err) {
			console.log(err);
		}

		function initSuccessCallBack(formData) {
			console.log(formData);
			for (i = 0, len = formData.length; i < len; i++) {
				if (formData[i].fieldCNName == 'ere') {
					formData[i].value = 'test';
				}
			}
			/**
			 * @param formData 初始化数据
			 * @param initFormDataSuccessCallBack  成功初始化表单数据回调事件
			 * @param initFormDataFailedCallBack     失败初始化表单数据回调事件
			 */
			epointsform.initFormData(formData, initFormDataSuccessCallBack,
					initFormDataFailedCallBack);
		}

		function initFailedCallBack(err) {
			console.log(err);
		}

		function initFormDataSuccessCallBack() {
		}

		function initFormDataFailedCallBack(err) {
			console.log(err);
		}

		function printPage(flag) {
			/**
			 * 打印表单
			 * @param id 打印表单id，允许为空就全部区域打印
			 * @param successCallBack  打印表单成功回调事件
			 * @param failedCallBack     打印表单失败回调事件
			 * @param flag     是否是工具打印
			 */
			epointsform.print("", null, null, flag);
		}
		
		function htmlToPdfForCont(){
			/**
			 * 表单html转Pdf（返回转换后Pdf流）
			 * @param convertUrl 配置访问.net转换服务地址
			 * @param savePath 转换后pdf存放路径
			 * @param convertSuccessCallBack  表单转Pdf成功回调事件
			 * @param convertFailedCallBack     表单转Pdf失败回调事件
			 */
			//h2p/HtmlConvertPdfCon   /html2pdf/HtmlConvertPdfCon
			var convertPath = "http://192.168.112.38/h2p/HtmlConvertPdfCon";
			epointsform.convertHtml2Pdf(convertPath, "", null, null);
			
		}
		
		function htmlToPdf(){
			/**
			 * 表单html转Pdf本地文件保存
			 * @param convertUrl 配置访问.net转换服务地址
			 * @param savePath 转换后pdf存放路径
			 * @param convertSuccessCallBack  表单转Pdf成功回调事件
			 * @param convertFailedCallBack     表单转Pdf失败回调事件
			 */
			//h2p/HtmlConvertPdfCon   /html2pdf/HtmlConvertPdfCon
			var convertPath = "http://192.168.112.38/h2p/HtmlConvertPdfCon";
			var savePath = "";//"D://wendang/b.pdf";
			$.ajax({
		          url: epointsform
					.getRightUrl('rest/testformaction/getUrl?isCommondto=true',''),
		          data:{
		        	  tableId : "24",
		        	  versionId : "1_0"
		          },
		          success: function(res) {
		        	  var resAfter;
		        	  if(typeof res  === 'string'){
		        		  resAfter = JSON.parse(res);
		        		  if(resAfter.custom.msg && resAfter.custom.msg.indexOf('/')>-1){
		        			  savePath = resAfter.custom.msg;
		        			  epointsform.convertHtml2Pdf(convertPath, savePath, null, null);
		        		  }else{
		        			  alert(resAfter.custom.msg);
		        		  }
		        	  }
		          }
		        })
		}
		
		function htmlToPicToPdf(){
			/**
			 * 表单html转图片再转Pdf
			 * @param convertSuccessCallBack  表单转Pdf成功回调事件
			 * @param convertFailedCallBack     表单转Pdf失败回调事件
			 */
			 
			epointsform.convertHtml2Pic2Pdf(null, null);
		}

		//]]>
	</script>
</body>
</html>