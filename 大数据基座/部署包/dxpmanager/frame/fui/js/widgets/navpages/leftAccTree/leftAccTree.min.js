// 页面左侧手风琴树 导航结构
(function(n,e){var g=e("#acc-nav"),x=Mustache,y=e.trim(e("#acc-item-templ").html()),p=e("#main-frame"),f="",q=0,k={},l=[],h={cacheNodeData:function(a){var b={},d;for(d in a)e.isArray(a[d])||(b[d]=a[d]);k[a.rowkey]=b},cacheTreeData:function(a,b){k[b+"-tree"]=a},getNodeData:function(a){return(a=k[a])?e.extend({},a):!1},getTreeData:function(a){return k[a+"-tree"]||!1},cacheDefaultExpandedNodes:function(a){!a.isLeaf&&a.expanded&&l.push(a)}},z=function(){l.length&&(e.each(l,function(a,b){g.find('[data-id\x3d"'+b.code+'"]').find("\x3e .node-line").find(".node-toggle").trigger("click")}),l=null)},r=function(a){if(""!==e.trim(f)){var b=Util.getWinSize().height;a||(a=g.find('[data-rowkey\x3d"'+f+'"]').find(".acc-item-bd"));a.css("height",b-36*q+"px")}},A=function(a){var b=[];e.each(a,function(a,c){c.rowkey=a+"";h.cacheNodeData(c);!f&&c.expanded&&(f=c.rowkey);var d=c.items;d&&d.length?(c.initTree=!0,h.cacheTreeData(d,c.rowkey)):c.isLazy&&(c.initTree=!0);b.push(x.render(y,c))});g.empty().html(Util.clearHtml(b.join("")));q=a.length;t(f)},v=function(a,b){var d=b.find(".acc-item-bd")[0],c=new mini.Tree;c.set({idField:"code",textField:"name",iconField:"icon",nodesField:"items",autoLoad:!1,url:Util.getRightUrl(LeftAccTree.loadUrl),data:a});c.on("beforeload",function(a){a.data.query="lazyLoad-accTree"});c.on("nodeclick",function(a){u(a.node)});c.render(d);b.data("inittree",!1)},w=function(a){""!==a&&(a=g.find('[data-rowkey\x3d"'+a+'"]'),a.find(".acc-item-bd").addClass("hidden"),a.removeClass("opened").addClass("closed"),f="")},t=function(a){var b=g.find('[data-rowkey\x3d"'+a+'"]'),d=b.data("inittree"),c=b.find(".acc-item-bd");f=b.data("rowkey");d&&((a=h.getTreeData(a))?v(a,b):B(b));r(c);c.removeClass("hidden");b.removeClass("closed").addClass("opened")},u=function(a){var b=a.url,d=LeftAccTree.onNodeClick,c=!0;d&&(c=e.proxy(d,LeftAccTree,a)());!1!==c&&b&&(b=Util.getRightUrl(b),a.isBlank?n.open(b):p[0].src=b)},B=function(a){var b=a.data("id");Util.ajax({type:"POST",dataType:"json",data:{query:"lazyLoad-accTree",code:b},url:Util.getRightUrl(LeftAccTree.loadUrl),success:function(b){v(b,a)}})};g.on("click",".acc-item-hd",function(a){var b=e(this).parent();a=b.find(".acc-item-bd");var b=b.data("rowkey"),d=h.getNodeData(b);a.hasClass("hidden")?(w(f),t(b)):w(b);u(d)});var m=0;e(n).on("resize",function(){m&&clearTimeout(m);m=setTimeout(r,80)});(function(){var a=e.extend({query:"init-accTree"},LeftAccTree.params);Util.ajax({type:"POST",dataType:"json",url:Util.getRightUrl(LeftAccTree.loadUrl),data:a,success:function(a){(a=a.result||a)&&a.length&&(A(a),z(),LeftAccTree.defaultUrl?a=LeftAccTree.defaultUrl:(a=h.getNodeData(f).url,a||(a=h.getNodeData(f+"-0").url)),p[0].src=Util.getRightUrl(a))},error:Util._ajaxErr})})()})(this,jQuery);