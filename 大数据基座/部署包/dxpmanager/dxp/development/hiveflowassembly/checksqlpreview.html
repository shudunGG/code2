<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>SQL预览</title>

<script src="../../../frame/fui/js/cssboot.js"></script>
<script>
	SrcBoot.output([ './css/common.css' ]);
</script>
</head>

<style>
body, html {
	overflow: auto !important;
}
</style>
<body>
	<div class="fui-toolbar">
		<a class="mini-button mini-btn-primary" iconCls="icon-addcircle"
			onclick="executeSql()">校验SQL</a>
		<a class="mini-button mini-btn-primary" iconCls="icon-addcircle"
			onclick="preView()">预览数据</a>
	</div>
	<!-- 页面内容区域 -->
	<div id="form" class="fui-form" style="padding-top: 1px">
		<div role="form">
			<div role="row">
				<input id="sql" name="sql" class="mini-textArea" allowInput="false"
					height="350px" width="750px" bind="sql"/>
			</div>
		</div>
	</div>
	<script src="../../../frame/fui/js/jsboot.js"></script>
	<script>
		//获取表单数据
		epoint.initPage('dxphivechecksqlaction');
		var flowGuid=Util.getUrlParams('flowGuid'),stepId=Util.getUrlParams("stepId");
		
		
		function preView(){
			var sql = mini.get('sql').getValue().toLowerCase();
			if(sql.indexOf('select')!=0){
				epoint.alert('仅可以预览查询语句！');
				return;
			}
			epoint.openTopDialog('数据预览','dxp/development/hiveflowassembly/prviewdata?flowGuid='+flowGuid+"&stepId="+stepId);
		}
		
		function executeSql() {
			var sql = mini.get('sql').getValue().toLowerCase();
			if(sql==''){
				epoint.alert('无可以校验的sql，请检查流程配置！');
				return;
			}
			if(sql.indexOf('select')!=0){
				epoint.alert('表输出组件无法校验');
				return;
			}
			epoint.execute('executeSql', '', sql,function(data){
				epoint.alert(data);
			});
		}
	</script>
</body>

</html>