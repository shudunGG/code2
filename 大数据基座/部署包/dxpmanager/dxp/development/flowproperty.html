<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>流程属性</title>
<script src="../../frame/fui/js/cssboot.js"></script>
</head>
<style>
body, html {
	overflow: auto !important;
}
</style>
<body>

	<!-- 	<div class="page-loading"></div> 
	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a id="savetype" class="mini-button mini-btn-primary"
				onclick="saveModify">保存并关闭</a> <a id="deletetype"
				class="mini-button mini-btn-danger"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择要删除的记录!', '', null, 'warning');} else {epoint.confirm('确认删除?','',deleteSelected);}">删除选中</a>
		</div>
	</div>

	<div id="form" class="fui-form">
		<div role="row" style="padding-top: 1px">
			<div role="control" label="流程名称" starred="true">
				<input id="changeName" name="changeName" class="mini-textbox" vtype="maxLength:100"
					required="true" emptyText="请输入流程名称"  />
			</div>
			<input id="paramData" name="paramData" class="mini-textbox hidden">
		</div>
		<div role="row">
			<div role="control" label="livy地址">
				<input id="livyPath" name="livyPath" bind="livyPath" class="mini-textbox" vtype="maxLength:100" />
			</div>
		</div>
		<div role="row">
			<div role="control" label="最小内存（M）">
				<input id="xms" name="xms" bind="xms" class="mini-textbox" vtype="int;range:1,2048" />
			</div>
		</div>
		<div role="row">
			<div role="control" label="最大内存（M）">
				<input id="xmx" name="xmx" bind="xmx" class="mini-textbox" vtype="int;range:1,2048" />
			</div>
		</div>
		<div role="row">
			<div role="control" label="hdp类型">
				<input id="hadooptype" name="hdpType" bind="hdpType" class="mini-combobox"
					action="getHadoopType" />
			</div>
		</div>
	</div>
	<div class="" style="padding-top: 1px">
		<div class="btn-group mr10">
			<a class="mini-button mini-btn-primary" onclick="add"
				style="margin-left: 20px">新增参数</a>
		</div>
	</div>
	<!-- 内容区域 -->
	<div class="fui-content" style="padding-top: 1px">
		<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="roleTypeGuid" multiSelect="true" allowCellValid="true"
			allowCellEdit="true" style="width: 100%; height: 80%;"
			allowResize="true" showPager="false" allowCellSelect="true"
			editNextOnEnterKey="true" editNextRowCell="true">
			<div property="columns">
				<div type="checkcolumn" width="55"></div>
				<div type="indexcolumn" width="55" headerAlign="center">序</div>
				<div field="namedParamField" headerAlign="center" width="150" align="left" vtype="required">
					命名参数
					<input field="namedParam" property="editor" class="mini-textbox" bind="namedparam" maxLength="50" style="width: 100%" />
				</div>
				<div field="defaultValueField" headerAlign="center" width="150" align="left">
					默认值
					<input field="defaultValue" property="editor" class="mini-textbox" bind="defaultvalue" maxLength="50" style="width: 100%" />
				</div>
			</div>
		</div>

		<script src="../../frame/fui/js/jsboot.js"></script>

		<script>
		
		 epoint.initPage('uploadflowaction','', function(){
				//从父页面获取表单数据
				var property = Util.getUrlParams('property');
				var xms = Util.getUrlParams('xms');
				var xmx = Util.getUrlParams('xmx');
				var flowName = Util.getUrlParams('flowName');
				var livyPath = Util.getUrlParams('livyPath');
				var hdpType = Util.getUrlParams('hdpType');
				if (property && "undefined" != property) {
					var data = JSON.parse(property);
					data.xms = xms;
					data.xmx = xmx;
					data.livyPath = livyPath;
					data.hdpType = hdpType;
					form.setData(data);
					grid.setData(data.paramData);
				}else{
					var data = {
							xms:xms,
							xmx:xmx,
							changeName:flowName,
							livyPath:livyPath,
							hdpType:hdpType
					};
					form.setData(data);
				}
		 });
		 
			var grid = mini.get("datagrid");
			var form = new mini.Form("#form");
			
			//新增类别
			function add() {
				var newRow = {
				//lx : "保留非全局角色"
				};
				grid.addRow(newRow, 0);
				grid.beginEditRow(newRow);
			}

			//删除选中
			function deleteSelected() {
				grid.removeRows(grid.getSelecteds(), false);
				setGridData();
			}

			
			//保存修改
			function saveModify() {
				grid.validate();
				if (grid.isValid() == false) {
					var error = grid.getCellErrors()[0];
					grid.beginEditCell(error.record, error.column);
					return;
				}
				if (epoint.validate()) {
					// 把表格的数据拿出来放到隐藏域中
					var xms=parseInt(mini.get('xms').getValue());
					var xmx=parseInt(mini.get('xmx').getValue());
					console.log(xms+':'+xmx);
					if(xms>xmx){
						epoint.alert('最小内存不能大于最大内存');
						epoint.clear('xms');
						return;
					}
					setGridData();
					var data = form.getData(true, false);
					epoint.closeDialog(data);

				}
			}

			function setGridData() {
				var datas = grid.getData();
				var array = [];
				for (var i = 0; i < datas.length; i++) {
					var row = datas[i];
					array.push({
						"namedParamField" : row.namedParamField,
						"defaultValueField" : row.defaultValueField,
					});
				}
				mini.get('paramData').setValue(JSON.stringify(array));
			}
		</script>
</body>

</html>