<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>数据集成-任务统计节点</title>
<script src="../../frame/fui/js/cssboot.js"></script>
<script>
	SrcBoot.output([ "../css/common.css", "./css/common.css",
			"./css/mission_node.css" ]);
</script>
</head>

<body>
	<div class="main">
		<div class="top">
				<a href="javascript:void(0);" onclick="back();" class="back l">返回</a>
		<div class="fui-toolbar" style="float: right;">
		</div>

		<!-- 条件区域 -->
		<div class="fui-search" primaryControl="keyword" opened="false">
			<!-- 表单布局 -->
			<div class="fui-form" id="fui-form">
				<div role="form">
					<!-- 1列 -->
					<div role="row">
						<div role="control" label="任务名称">
							<input bind="keyword" id="keyword" class="mini-textbox" />
						</div>
					</div>
				</div>
			</div>
			<!-- 搜索按钮 -->
			<a role="searcher" callback="searchData"></a>
		</div>
		</div>
		<div class="content clearfix">
			<div class="fui-content mini-fit">
				<div id="datagrid" name="datagrid" class="mini-datagrid"
					idField="rowguid" multiSelect="true"
					style="width: 100%; height: 100%" showPager="true"
					action="getDataGridData">
					<div property="columns">
						<div type="indexcolumn" width="50" headerAlign="center">序</div>
						<div field="flowname" width="100" headerAlign="center"
							align="center">任务名称</div>
						<div field="totalnum" width="100" headerAlign="center"
							align="center">总条数</div>
						<div field="totalsuccess" width="100" headerAlign="center"
							align="center">成功数</div>
						<div field="totalerror" width="100" headerAlign="center"
							align="center">失败数</div>
						<div field="totallength" width="100" headerAlign="center"
							align="center">数据量</div>
						<div width="100" headerAlign="center" align="center"
							renderer="onDetailRenderer">详情</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="../../rest/resource/jsboot"></script>
	<script>
		epoint.initPage('dxptranscountnodedetailaction');

		function back() {
			Util.getSafeLocation().setHref(
					'mission?dataType=' + Util.getUrlParams('dataType')
							+ '&dataRange=' + Util.getUrlParams('dataRange'));
		}

		function searchData() {
			epoint.refresh([ 'datagrid', 'fui-form' ]);
		}

		function onDetailRenderer(e) {
			var dataType = Util.getUrlParams('dataType');
			var dataRange = Util.getUrlParams('dataRange');
			if (dataRange != "04" && dataRange != "05") {
				return '<a  onclick="openFlowDetail('
						+ "'" + e.row.rowguid + "'," + "'" + e.row.flowname
						+ "'" + ');" >' + '查看' + '</a>';
			}
			return '';
		}
		function openFlowDetail(id, name) {
			var url = 'dxp/dataintegration/mission_detail?flowGuid=' + id + '&dataType='
					+ Util.getUrlParams('dataType') + '&dataRange='
					+ Util.getUrlParams('dataRange');
			epoint.openDialog(name, url, '', {
				width : 1200,
				height : 700
			});
		}

		$('#search').bind('input propertychange', function() {
			mini.get('keyword').setValue($('#search').val());
		}).bind('keyup', function(event) {
			if (event.keyCode == "13") {
				searchData();
			}
		});
	</script>
</body>

</html>