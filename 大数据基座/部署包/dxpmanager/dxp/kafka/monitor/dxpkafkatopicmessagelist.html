<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>消息查看</title>
<script src="../../../frame/fui/js/cssboot.js"></script>
<style>
.form-label {
	display: block;
	box-sizing: border-box !important;
	min-height: 32px;
	text-align: right;
}
</style>
</head>
<body>
	<div class="page-loading"></div>
	<div class="fui-content">
		<div class="fui-form" id="fui-form">
			<div role="form">
				<div role="row">
					<span>topic名称：</span> <input bind="topicName" class="mini-output" />
					<span style="margin-left: 300px;">topic状态：</span> <input
						id="status"  class="mini-output"  renderer="onStatusRender"/>
				</div>
				<div role="row">
					<span>消息记录：</span> <input class="mini-daterangepicker"
						bind="startDate,endDate" id="dataRange"
						style="width: 35%;" /> <a class="mini-button"
						onclick="searchData();" style="width: 12%; margin-left: 100px;">搜索</a>
				</div>
			</div>
		</div>
		<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="rowguid" multiSelect="true" style="width: 100%; height: 80%"
			showPager="true" action="getDataGridModel" extraId="dataRange">
			<div property="columns">
				<div type="indexcolumn" width="20" headerAlign="center">序</div>
				<div field="rowguid" headerAlign="center" align="center">消息ID</div>
				<div field="datetime" headerAlign="center" align="center">生成时间</div>
				<div field="content" visible="false"></div>
				<div headerAlign="center" align="center" renderer="onContentRender">内容</div>
			</div>
		</div>

	</div>

	<script src="../../../rest/resource/jsboot"></script>
	<script>
		epoint.initPage('dxpkafkatopicmessagelistaction', '', function(data){
			if(data.status.indexOf('正常')==-1){
				mini.get('status').setValue("<font color='red'>有积压</font>");
			}else{
				mini.get('status').setValue("正常");
			}
		});

		function searchData() {
			//epoint.refresh([ 'datagrid', 'dataRange' ]);
			mini.get('datagrid').reload();
		}

		var grid = mini.get('datagrid');
		grid.on('load', function(e) {
			if(e.data.length > 0){
				var dataRange = mini.get('dataRange');
				var row = e.data[e.data.length-1];
				dataRange.setMinDate(row.minDate);
				dataRange.setMaxDate(row.maxDate);
				e.data.splice(e.data.length-1,1);
			}
		});

		function onContentRender(e) {
			var obj = JSON.stringify(e.row.content);
			return "<a href='javascript:void(0);' onclick='back("+obj+")' >查看</a>";
		}
		
		function back(json) {
			epoint.alert(json);
		}
		
	</script>
</body>
</html>