<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>自定义行筛选</title>

    <script src="../../../frame/fui/js/cssboot.js"></script>
    <script>
	SrcBoot.output([ './css/common.css' ]);


    </script>
    <link rel="stylesheet" href="css/tablefilter.css"/>

</head>

<style>
body, html {
    overflow: auto !important; 
}

.mini-list-icon{
    display:none;
}


</style>
<body>
<div class="fui-toolbar">
    <div class="btn-group mr10">
        <a class="mini-button mini-btn-primary" id="save"
           onclick="saveModify">保存修改</a> <a
            class="mini-button mini-btn-primary" onclick="epoint.closeDialog">关闭</a>
    </div>
    <!--帮助按钮 -->
    <a role="helper"></a>
</div>

<!-- 页面内容区域 -->
<div id="form" class="fui-form" style="padding-top: 1px">
    <div role="form">
        <div role="row">
            <div role="control" label="步骤名称" starred="true">
                <input id="stepName" name="stepName" class="mini-textbox" vtype="maxLength:20"
                       required="true" emptyText="请输入步骤名称" requiredErrorText="步骤名称不能为空"/>
            </div>
        </div>
        <div role="row">
            <div role="control" label="筛选条件" starred="true">
                <input id="filterContent" name="filterContent" class="mini-textarea" emptyText="请输入where后面的条件，遵循Presto的SQL语法"
                       height="200px" required="true" requiredErrorText="筛选条件不能为空"/>
            </div>
        </div>
        <div role="row">
            <div role="control" label="可用字段">
                <div class="mini-checkboxlist" action="getPreFieldsItem"
                     showCheckBox="false" repeatLayout="table" repeatItems="3" textField="text1" valueField="id"
                     style="overflow: auto;" multiSelect="false" id="fields"></div>
            </div>
        </div>
    </div>
</div>

<script src="../../../frame/fui/js/jsboot.js"></script>

<script>
		//获取表单数据
		var form = new mini.Form("#form");
		var tableList = mini.get('tableName');
		var stepNameForm = mini.get('stepName');
		//var datagrid = mini.get("datagrid");
		var nodeData;
		var nodeInfo;
		var transGuid;
		var columnTemp;
		function getForm() {
			var data = form.getData(true, false);
			var s = mini.encode(data);
			return s;
		}
		
		function pageLoad() {
			var data = top.nodeData;
			nodeInfo = data;
			nodeData = mini.decode(data.id);
			form.setData(nodeData);
			epoint.initPage('modelfilterrowsaction?stepId=' + nodeInfo.key,{'nodeData':epoint.encodeUtf(JSON.stringify(nodeData))}, initCallBack);
		}
	
		function initCallBack(e) {
			//填充表单数据
			form.setData(nodeData);
			var nodeName = nodeData.stepName;
			if(!nodeName){
				stepNameForm.setValue(nodeInfo.name);
			}
			
		}
		
		//保存修改
 		function saveModify() {
 			if (epoint.validate('@all', true)) {
				var nodeForm = getForm();
				epoint.execute("save", '', [ nodeInfo, nodeForm ], function(data) {
					if (data.success == 'success') {
						epoint.closeDialog(nodeForm);
					} else {
						epoint.alert(data.msg, '', null, 'warning');
					}
				});
			} 
			
		} 
		
		function onCloseClick(e) {
			var obj = e.sender;
			obj.setText("");
			obj.setValue("");
		}

        mini.get('fields').on('itemclick',function(e){
            var filterContent=mini.get('filterContent').getValue();
            mini.get('filterContent').setValue(filterContent+' '+e.item.id);
        });

</script>
</body>

</html>