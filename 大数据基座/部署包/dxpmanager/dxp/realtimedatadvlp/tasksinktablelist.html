<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>实时开发任务页</title>
    <script src="../../frame/fui/js/cssboot.js"></script>
</head>
<body>
<div class="page-loading"></div>

<!-- 按钮区域 -->
<div class="fui-toolbar">
    <div class="btn-group mr10">
        <a class="mini-button mini-btn-primary" iconCls="icon-addcircle"
           onclick="addTable()" id="addTable">新建结果表</a> <a
            class="mini-button" iconCls="icon-minuscircle"
            id="del" onclick="deleteSelect()">删除</a>
    </div>
</div>

<!-- 条件区域 -->
<div class="fui-search" primaryControl="tableName" opened="false">
    <!-- 表单布局 -->
    <div class="fui-form" id="fui-form">
        <div role="form">
            <div role="row">
                <div role="control" label="表名称">
                    <input bind="tableName" id="tableName"
                           class="mini-textbox"/>
                </div>
            </div>
        </div>
    </div>
    <!-- 搜索按钮 -->
    <a role="searcher" callback="searchData"></a>
</div>

<!-- 表格区域 -->
<div class="fui-content">
    <div id="datagrid" name="datagrid" class="mini-datagrid"
         idField="rowguid" multiSelect="true"
         style="width: 100%; height: 100%;" showPager="true"
         action="getDataGridData">
        <div property="columns">
            <div type="checkcolumn" width="30"></div>
            <div type="indexcolumn" width="50" headerAlign="center">序</div>
            <div field="taskGuid" visible="false"></div>
            <div field="tableName" width="200" headerAlign="center"
                 align="center" renderer="onTitleRenderer">表名
            </div>
            <div field="mappingTable" width="100" headerAlign="center"
                 align="center">映射表名
            </div>
            <div field="create_date" width="160" headerAlign="center"
                 data-options="{'format':'yyyy-MM-dd HH:mm:ss'}"
                 dateFormat="yyyy-MM-dd HH:mm:ss" align="center">创建日期
            </div>
            <div field="update_date" width="160" headerAlign="center"
                 data-options="{'format':'yyyy-MM-dd HH:mm:ss'}"
                 dateFormat="yyyy-MM-dd HH:mm:ss" align="center">更新日期
            </div>
            <div width="80" headerAlign="center" align="center"
						renderer="onTransRenderer">编辑</div>
        </div>
    </div>
</div>

<script src="../../rest/resource/jsboot"></script>
<script>
		epoint.initPage('dxpflinktasksinktablelistaction', '', function(data) {
			if (mini.get('datagrid').getSelecteds().length === 0) {
				buttonDisable();
			}
		});

        var grid = mini.get('datagrid');
		grid.on('selectionchanged', function(e) {
			if (e.selecteds.length > 0) {
				buttonEnable();
			} else {
				buttonDisable();
			}
		});


		function deleteSelect() {
			if (mini.get('datagrid').getSelecteds().length == 0) {
				epoint.alert('请选择要删除的结果表!', '', null, 'warning');
			} else {
				var select=mini.get('datagrid').getSelecteds();
				epoint.confirm('确认删除吗?', '', function() {
					epoint.execute('deleteSelect', '', function(data) {
						if (data.msg.indexOf('成功') != -1) {
							epoint.alert(data.msg, '', function() {
								epoint.refresh([ 'datagrid', 'fui-form' ], '',
										true);
							}, 'success');
						} else {
							epoint.alert(data.msg);
						}
					});
				});
			}
		}


		function addTable() {
             var flowGuid=Util.getUrlParams('flowGuid');
              epoint.openDialog('结果表','./tasksink?flowGuid='+flowGuid,function(){
                    mini.get('datagrid').reload();
              },{width:800});
		}

		function buttonEnable() {
			mini.get('del').enable();

		}

		function buttonDisable() {
			mini.get('del').disable();

		}


        function onTransRenderer(e) {
			return epoint.renderCell(e, "action-icon icon-edit", "editTable",
					"rowguid");
		}

        function editTable(e){
            var flowGuid=Util.getUrlParams('flowGuid');
              epoint.openDialog('结果表','./tasksink?flowGuid='+flowGuid+"&rowguid="+e,function(){
                    mini.get('datagrid').reload();
              },{width:800});
        }

        function searchData(){
            grid.reload();
        }

</script>
</body>
</html>