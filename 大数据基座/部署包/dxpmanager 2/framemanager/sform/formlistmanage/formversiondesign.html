<!DOCTYPE html>
<html>
<head>
<title>表单设计版本</title>
<meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>
	<div class="fui-toolbar">
		<div class="btn-group mr10">
		    <a class="mini-button" iconCls="icon-copy"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择想要复制的记录！', '', null, 'warning');} else {copyVersion();}">版本复制</a>
			<a class="mini-button mini-btn-danger" iconCls="icon-removecircle" id="delForm"
				onclick="if(mini.get('datagrid').getSelecteds()==0){epoint.alert('请选择想要删除的记录！', '', null, 'warning');} else {del();}">删除选中</a>
		</div>
	</div>

	<div class="fui-content">
		<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="version" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			allowCellValid="true" action="getTableModal" allowCellEdit="true"
			allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true" showPager="true">
			<div property="columns">
				<div type="checkcolumn" width="20"></div>
				<div type="indexcolumn" headerAlign="center" width="20">序</div>
				<div field="version" headerAlign="center" align="left" width="50">版本号</div>
				<div width="60" headerAlign="center" align="center"
					renderer="changeImage">状态</div>
				<div width="30" headerAlign="center" align="center"
					renderer="showDesign">设计</div>
				<div width="30" headerAlign="center" align="center"
					renderer="showPreview">预览</div>
                <div field="enabled" visible="false"></div>
			</div>
		</div>
	</div>
	<input class="mini-hidden" id="tableId" name="tableId" bind="tableId" />
	<script src="../../../rest/resource/jsboot"></script>

	<!-- 配置变量 -->
	<script>
		//<![CDATA[ 
		epoint.initPage("formversiondesignaction");

		//设计
		function showDesign(e) {
			return epoint.renderCell(e, "action-icon icon-gear",
					"showDesignDialog");
		}

		function showDesignDialog(version) {
			var tableId = mini.get("tableId").getValue();
			window.open("formdesign?tableId=" + tableId + "&versionId=" + version);		
		}
		// 删除
		function del() {
			epoint.execute('del', 'datagrid', msgCallBack);
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid' ],'',true);
		}

		//状态图标
		function changeImage(e) {
			if (e.row.enabled == 10) {
				return epoint.renderCell(e, "action-icon icon-start",
						"changeStatus");
			} else {
				return epoint.renderCell(e, "action-icon icon-pause",
						"changeStatus");
			}
		}
		function changeStatus(e) {
			epoint.execute('changeImage', '@none', [ e ], msgCallBack);
		}
		//预览
    	function showPreview(e) {
			return epoint.renderCell(e, "action-icon icon-search", "showPreviewDialog");
		}
		
    	function showPreviewDialog(version){
    		epoint.execute('getPreviewUrl', '', [version], showUrl);
    	}
    	
    	function showUrl(args) {
			if (args.previewUrl) {
				top.epoint.openDialog("表单预览", args.previewUrl, addCallBack);
			} else {
				epoint.alertAndClose("当前表单没有预览页面", '', null, null, 'warning');
			}
		}
    	
		// 回调提醒
		function msgCallBack(data) {
			if (data) {
				var msg = data.msg;
				if (msg.indexOf("成功") == -1) {
					epoint.alert(msg, '', '', 'warning');
				} else {
					epoint.alert(msg, '', searchData(), 'success');
				}
			}
		}
		
		//新增回调
		function addCallBack(param) {
			if (param) {
				searchData();
			}
		}
		
		//版本复制
		function copyVersion() {
			epoint.execute('copyVersion', 'datagrid', msgCallBack);
		}
		//]]>
	</script>
</body>
</html>