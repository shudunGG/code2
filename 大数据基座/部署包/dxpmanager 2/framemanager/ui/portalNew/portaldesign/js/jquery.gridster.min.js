/*! gridster.js - v0.5.6 - 2014-09-25
* http://gridster.net/
* Copyright (c) 2014 ducksboard; Licensed MIT 
* 根据 V0.7.0 修改添加了如下方法，用于拖拽和自适应
* 修改了 add_style_tag
* 添加了 resize_widget_dimensions
* 添加了 move_widget
*/
(function(f,e){"function"===typeof define&&define.amd?define("gridster-coords",["jquery"],e):f.GridsterCoords=e(f.$||f.jQuery)})(this,function(f){function e(e){e[0]&&f.isPlainObject(e[0])?this.data=e[0]:this.el=e;this.isCoords=!0;this.coords={};this.init();return this}var m=e.prototype;m.init=function(){this.set();this.original_coords=this.get()};m.set=function(f,e){var a=this.el;a&&!f&&(this.data=a.offset(),this.data.width=a.width(),this.data.height=a.height());if(a&&f&&!e){var b=a.offset();this.data.top=b.top;this.data.left=b.left}b=this.data;"undefined"===typeof b.left&&(b.left=b.x1);"undefined"===typeof b.top&&(b.top=b.y1);this.coords.x1=b.left;this.coords.y1=b.top;this.coords.x2=b.left+b.width;this.coords.y2=b.top+b.height;this.coords.cx=b.left+b.width/2;this.coords.cy=b.top+b.height/2;this.coords.width=b.width;this.coords.height=b.height;this.coords.el=a||!1;return this};m.update=function(e){if(!e&&!this.el)return this;if(e)return this.data=f.extend({},this.data,e),this.set(!0,!0);this.set(!0);return this};m.get=function(){return this.coords};m.destroy=function(){this.el.removeData("coords");delete this.el};f.fn.coords=function(f){if(this.data("coords"))return this.data("coords");f=new e(this,f);this.data("coords",f);return f};return e});(function(f,e){"function"===typeof define&&define.amd?define("gridster-collision",["jquery","gridster-coords"],e):f.GridsterCollision=e(f.$||f.jQuery,f.GridsterCoords)})(this,function(f,e){function m(a,b,c){this.options=f.extend(k,c);this.$element=a;this.last_colliders=[];this.last_colliders_coords=[];this.set_colliders(b);this.init()}var k={colliders_context:document.body,overlapping_region:"C"};m.defaults=k;var p=m.prototype;p.init=function(){this.find_collisions()};p.overlaps=function(a,b){var c=!1,d=!1;if(b.x1>=a.x1&&b.x1<=a.x2||b.x2>=a.x1&&b.x2<=a.x2||a.x1>=b.x1&&a.x2<=b.x2)c=!0;if(b.y1>=a.y1&&b.y1<=a.y2||b.y2>=a.y1&&b.y2<=a.y2||a.y1>=b.y1&&a.y2<=b.y2)d=!0;return c&&d};p.detect_overlapping_region=function(a,b){var c="",d="";a.y1>b.cy&&a.y1<b.y2&&(c="N");a.y2>b.y1&&a.y2<b.cy&&(c="S");a.x1>b.cx&&a.x1<b.x2&&(d="W");a.x2>b.x1&&a.x2<b.cx&&(d="E");return c+d||"C"};p.calculate_overlapped_area_coords=function(a,b){var c=Math.max(a.x1,b.x1),d=Math.max(a.y1,b.y1);return f({left:c,top:d,width:Math.min(a.x2,b.x2)-c,height:Math.min(a.y2,b.y2)-d}).coords().get()};p.calculate_overlapped_area=function(a){return a.width*a.height};p.manage_colliders_start_stop=function(a,b,c){for(var d=this.last_colliders_coords,h=0,g=d.length;h<g;h++)-1===f.inArray(d[h],a)&&b.call(this,d[h]);b=0;for(h=a.length;b<h;b++)-1===f.inArray(a[b],d)&&c.call(this,a[b])};p.find_collisions=function(a){var b=this.options.overlapping_region,c=[],d=[],h=this.colliders||this.$colliders,g=h.length;for(a=this.$element.coords().update(a||!1).get();g--;){var e=this.$colliders?f(h[g]):h[g],q=e.isCoords?e:e.coords(),r=q.get();if(this.overlaps(a,r)){var n=this.detect_overlapping_region(a,r);if(n===b||"all"===b){var k=this.calculate_overlapped_area_coords(a,r),e={area:this.calculate_overlapped_area(k),area_coords:k,region:n,coords:r,player_coords:a,el:e};this.options.on_overlap&&this.options.on_overlap.call(this,e);c.push(q);d.push(e)}}}(this.options.on_overlap_stop||this.options.on_overlap_start)&&this.manage_colliders_start_stop(c,this.options.on_overlap_start,this.options.on_overlap_stop);this.last_colliders_coords=c;return d};p.get_closest_colliders=function(a){a=this.find_collisions(a);a.sort(function(a,c){return"C"===a.region&&"C"===c.region?a.coords.y1<c.coords.y1||a.coords.x1<c.coords.x1?-1:1:1});return a};p.set_colliders=function(a){"string"===typeof a||a instanceof f?this.$colliders=f(a,this.options.colliders_context).not(this.$element):this.colliders=f(a)};f.fn.collision=function(a,b){return new m(this,a,b)};return m});(function(f,e){f.delay=function(f,e){var k=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return f.apply(null,k)},e)};f.debounce=function(f,e,p){var a;return function(){var b=this,c=arguments;p&&!a&&f.apply(b,c);clearTimeout(a);a=setTimeout(function(){a=null;p||f.apply(b,c)},e)}};f.throttle=function(f,e){var k,a,b,c,d,h,g=debounce(function(){d=c=!1},e);return function(){k=this;a=arguments;b||(b=setTimeout(function(){b=null;d&&f.apply(k,a);g()},e));c?d=!0:h=f.apply(k,a);g();c=!0;return h}}})(window);(function(f,e){"function"===typeof define&&define.amd?define("gridster-draggable",["jquery"],e):f.GridsterDraggable=e(f.$||f.jQuery)})(this,function(f){function e(a,b){this.options=f.extend({},m,b);this.$document=f(document);this.$container=f(a);this.$dragitems=f(this.options.items,this.$container);this.is_dragging=!1;this.player_min_left=0+this.options.offset_left;this.id=++c+"";this.ns=".gridster-draggable-"+this.id;this.init()}var m={items:"li",distance:1,limit:!0,offset_left:0,autoscroll:!0,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null,container_width:0,move_element:!0,helper:!1,remove_helper:!0},k=f(window),p={x:"left",y:"top"},a=!!("ontouchstart"in window),b=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},c=0;e.defaults=m;var d=e.prototype;d.init=function(){var a=this.$container.css("position");this.calculate_dimensions();this.$container.css("position","static"===a?"relative":a);this.disabled=!1;this.events();f(window).bind(this.nsEvent("resize"),throttle(f.proxy(this.calculate_dimensions,this),200))};d.nsEvent=function(a){return(a||"")+this.ns};d.events=function(){this.pointer_events={start:this.nsEvent("touchstart")+" "+this.nsEvent("mousedown"),move:this.nsEvent("touchmove")+" "+this.nsEvent("mousemove"),end:this.nsEvent("touchend")+" "+this.nsEvent("mouseup")};this.$container.on(this.nsEvent("selectstart"),f.proxy(this.on_select_start,this));this.$container.on(this.pointer_events.start,this.options.items,f.proxy(this.drag_handler,this));this.$document.on(this.pointer_events.end,f.proxy(function(a){this.is_dragging=!1;if(!this.disabled&&(this.$document.off(this.pointer_events.move),this.drag_start))this.on_dragstop(a)},this))};d.get_actual_pos=function(a){return a.position()};d.get_mouse_pos=function(a){a.originalEvent&&a.originalEvent.touches&&(a=a.originalEvent,a=a.touches.length?a.touches[0]:a.changedTouches[0]);return{left:a.clientX,top:a.clientY}};d.get_offset=function(a){a.preventDefault();a=this.get_mouse_pos(a);var b=Math.round(a.left-this.mouse_init_pos.left),c=Math.round(a.top-this.mouse_init_pos.top),d=Math.round(this.el_init_offset.left+b-this.baseX+f(window).scrollLeft()-this.win_offset_x),h=Math.round(this.el_init_offset.top+c-this.baseY+f(window).scrollTop()-this.win_offset_y);this.options.limit&&(d>this.player_max_left?d=this.player_max_left:d<this.player_min_left&&(d=this.player_min_left));return{position:{left:d,top:h},pointer:{left:a.left,top:a.top,diff_left:b+(f(window).scrollLeft()-this.win_offset_x),diff_top:c+(f(window).scrollTop()-this.win_offset_y)}}};d.get_drag_data=function(a){a=this.get_offset(a);a.$player=this.$player;a.$helper=this.helper?this.$helper:this.$player;return a};d.set_limits=function(a){a||(a=this.$container.width());this.player_max_left=a-this.player_width+-this.options.offset_left;this.options.container_width=a;return this};d.scroll_in=function(a,c){var d=p[a],h="x"===a,e=h?this.window_width:this.window_height,g=h?f(document).width():f(document).height(),m=h?this.$player.width():this.$player.height(),h=k["scroll"+b(d)](),x=h+50,v=h+c.pointer[d],g=g-e+m;v>=h+e-50&&(e=h+30,e<g&&(k["scroll"+b(d)](e),this["scroll_offset_"+a]+=30));v<=x&&(e=h-30,0<e&&(k["scroll"+b(d)](e),this["scroll_offset_"+a]-=30));return this};d.manage_scroll=function(a){this.scroll_in("x",a);this.scroll_in("y",a)};d.calculate_dimensions=function(a){this.window_height=k.height();this.window_width=k.width()};d.drag_handler=function(b){if(!this.disabled&&(1===b.which||a)&&!this.ignore_drag(b)){var c=this,d=!0;this.$player=f(b.currentTarget);this.el_init_pos=this.get_actual_pos(this.$player);this.mouse_init_pos=this.get_mouse_pos(b);this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top;this.$document.on(this.pointer_events.move,function(a){var b=c.get_mouse_pos(a),f=Math.abs(b.top-c.mouse_init_pos.top);if(!(Math.abs(b.left-c.mouse_init_pos.left)>c.options.distance||f>c.options.distance))return!1;if(d)return d=!1,c.on_dragstart.call(c,a),!1;!0===c.is_dragging&&c.on_dragmove.call(c,a);return!1});if(!a)return!1}};d.on_dragstart=function(a){a.preventDefault();if(this.is_dragging)return this;this.drag_start=this.is_dragging=!0;var b=this.$container.offset();this.baseX=Math.round(b.left);this.baseY=Math.round(b.top);this.initial_container_width=this.options.container_width||this.$container.width();"clone"===this.options.helper?(this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper"),this.helper=!0):this.helper=!1;this.win_offset_y=f(window).scrollTop();this.win_offset_x=f(window).scrollLeft();this.scroll_offset_x=this.scroll_offset_y=0;this.el_init_offset=this.$player.offset();this.player_width=this.$player.width();this.player_height=this.$player.height();this.set_limits(this.options.container_width);this.options.start&&this.options.start.call(this.$player,a,this.get_drag_data(a));return!1};d.on_dragmove=function(a){var b=this.get_drag_data(a);this.options.autoscroll&&this.manage_scroll(b);this.options.move_element&&(this.helper?this.$helper:this.$player).css({position:"absolute",left:b.position.left,top:b.position.top});b.prev_position=this.last_position||b.position;this.options.drag&&this.options.drag.call(this.$player,a,b);this.last_position=b.position;return!1};d.on_dragstop=function(a){var b=this.get_drag_data(a);this.drag_start=!1;this.options.stop&&this.options.stop.call(this.$player,a,b);this.helper&&this.options.remove_helper&&this.$helper.remove();return!1};d.on_select_start=function(a){if(!this.disabled&&!this.ignore_drag(a))return!1};d.enable=function(){this.disabled=!1};d.disable=function(){this.disabled=!0};d.destroy=function(){this.disable();this.$container.off(this.ns);this.$document.off(this.ns);f(window).off(this.ns);f.removeData(this.$container,"drag")};d.ignore_drag=function(a){return this.options.handle?!f(a.target).is(this.options.handle):f.isFunction(this.options.ignore_dragging)?this.options.ignore_dragging(a):f(a.target).is(this.options.ignore_dragging.join(", "))};f.fn.drag=function(a){return new e(this,a)};return e});(function(f,e){"function"===typeof define&&define.amd?define(["jquery","gridster-draggable","gridster-collision"],e):f.Gridster=e(f.$||f.jQuery,f.GridsterDraggable,f.GridsterCollision)})(this,function(f,e,m){function k(a,b){this.options=f.extend(!0,{},p,b);this.$el=f(a);this.$wrapper=this.$el.parent();this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs-w");this.widgets=[];this.$changed=f([]);this.wrapper_width=this.$wrapper.width();this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0];this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1];this.generated_stylesheets=[];this.$style_tags=f([]);this.options.auto_init&&this.init()}var p={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,max_cols:Infinity,min_rows:15,max_size_x:!1,autogrow_cols:!1,autogenerate_stylesheet:!0,avoid_overlapped_widgets:!0,auto_init:!0,serialize_params:function(a,b){return{col:b.col,row:b.row,size_x:b.size_x,size_y:b.size_y}},collision:{},draggable:{items:".gs-w",distance:4,ignore_dragging:e.defaults.ignore_dragging.slice(0)},resize:{enabled:!1,axes:["both"],handle_append_to:"",handle_class:"gs-resize-handle",max_size:[Infinity,Infinity],min_size:[1,1]}};k.defaults=p;k.generated_stylesheets=[];k.sort_by_row_asc=function(a){return a=a.sort(function(a,c){a.row||(a=f(a).coords().grid,c=f(c).coords().grid);return a.row>c.row?1:-1})};k.sort_by_row_and_col_asc=function(a){return a=a.sort(function(a,c){return a.row>c.row||a.row===c.row&&a.col>c.col?1:-1})};k.sort_by_col_asc=function(a){return a=a.sort(function(a,c){return a.col>c.col?1:-1})};k.sort_by_row_desc=function(a){return a=a.sort(function(a,c){return a.row+a.size_y<c.row+c.size_y?1:-1})};e=k.prototype;e.init=function(){this.options.resize.enabled&&this.setup_resize();this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.set_dom_grid_width();this.$wrapper.addClass("ready");this.draggable();this.options.resize.enabled&&this.resizable();f(window).bind("resize.gridster",throttle(f.proxy(this.recalculate_faux_grid,this),200))};e.disable=function(){this.$wrapper.find(".player-revert").removeClass("player-revert");this.drag_api.disable();return this};e.enable=function(){this.drag_api.enable();return this};e.disable_resize=function(){this.$el.addClass("gs-resize-disabled");this.resize_api.disable();return this};e.enable_resize=function(){this.$el.removeClass("gs-resize-disabled");this.resize_api.enable();return this};e.add_widget=function(a,b,c,d,e,g,l){var h;b||(b=1);c||(c=1);!d&!e?h=this.next_position(b,c):(h={col:d,row:e,size_x:b,size_y:c},this.empty_cells(d,e,b,c));a=f(a).attr({"data-col":h.col,"data-row":h.row,"data-sizex":b,"data-sizey":c}).addClass("gs-w").appendTo(this.$el).hide();this.$widgets=this.$widgets.add(a);this.register_widget(a);this.add_faux_rows(h.size_y);g&&this.set_widget_max_size(a,g);l&&this.set_widget_min_size(a,l);this.set_dom_grid_width();this.set_dom_grid_height();this.drag_api.set_limits(this.cols*this.min_widget_width);return a.fadeIn()};e.set_widget_min_size=function(a,b){a="number"===typeof a?this.$widgets.eq(a):a;if(!a.length)return this;var c=a.data("coords").grid;c.min_size_x=b[0];c.min_size_y=b[1];return this};e.set_widget_max_size=function(a,b){a="number"===typeof a?this.$widgets.eq(a):a;if(!a.length)return this;var c=a.data("coords").grid;c.max_size_x=b[0];c.max_size_y=b[1];return this};e.add_resize_handle=function(a){var b=this.options.resize.handle_append_to;f(this.resize_handle_tpl).appendTo(b?f(b,a):a);return this};e.resize_widget=function(a,b,c,d){var f=a.coords().grid,e=f.col,l=this.options.max_cols,q=f.size_y,r=f.col;b||(b=f.size_x);c||(c=f.size_y);Infinity!==l&&(b=Math.min(b,l-e+1));c>q&&this.add_faux_rows(Math.max(c-q,0));e=e+b-1;e>this.cols&&this.add_faux_cols(e-this.cols);b={col:r,row:f.row,size_x:b,size_y:c};this.mutate_widget_in_gridmap(a,f,b);this.set_dom_grid_height();this.set_dom_grid_width();d&&d.call(this,b.size_x,b.size_y);return a};e.mutate_widget_in_gridmap=function(a,b,c){var d=b.size_y,e=this.get_cells_occupied(b),g=this.get_cells_occupied(c),l=[];f.each(e.cols,function(a,b){-1===f.inArray(b,g.cols)&&l.push(b)});var q=[];f.each(g.cols,function(a,b){-1===f.inArray(b,e.cols)&&q.push(b)});var r=[];f.each(e.rows,function(a,b){-1===f.inArray(b,g.rows)&&r.push(b)});var n=[];f.each(g.rows,function(a,b){-1===f.inArray(b,e.rows)&&n.push(b)});this.remove_from_gridmap(b);q.length&&this.empty_cells.apply(this,[c.col,c.row,c.size_x,Math.min(d,c.size_y),a]);n.length&&this.empty_cells.apply(this,[c.col,c.row,c.size_x,c.size_y,a]);b.col=c.col;b.row=c.row;b.size_x=c.size_x;b.size_y=c.size_y;this.add_to_gridmap(c,a);a.removeClass("player-revert");a.data("coords").update({width:c.size_x*this.options.widget_base_dimensions[0]+(c.size_x-1)*this.options.widget_margins[0]*2,height:c.size_y*this.options.widget_base_dimensions[1]+(c.size_y-1)*this.options.widget_margins[1]*2});a.attr({"data-col":c.col,"data-row":c.row,"data-sizex":c.size_x,"data-sizey":c.size_y});l.length&&this.remove_empty_cells.apply(this,[l[0],c.row,l.length,Math.min(d,c.size_y),a]);r.length&&this.remove_empty_cells.apply(this,[c.col,c.row,c.size_x,c.size_y,a]);this.move_widget_up(a);return this};e.empty_cells=function(a,b,c,d,e){this.widgets_below({col:a,row:b-d,size_x:c,size_y:d}).not(e).each(f.proxy(function(a,c){var e=f(c).coords().grid;e.row<=b+d-1&&(e=b+d-e.row,this.move_widget_down(f(c),e))},this));this.set_dom_grid_height();return this};e.remove_empty_cells=function(a,b,c,d,e){this.widgets_below({col:a,row:b,size_x:c,size_y:d}).not(e).each(f.proxy(function(a,b){this.move_widget_up(f(b),d)},this));this.set_dom_grid_height();return this};e.next_position=function(a,b){a||(a=1);b||(b=1);for(var c=this.gridmap,d=c.length,f=[],e,l=1;l<d;l++){e=c[l].length;for(var q=1;q<=e;q++)this.can_move_to({size_x:a,size_y:b},l,q)&&f.push({col:l,row:q,size_y:b,size_x:a})}return f.length?k.sort_by_row_and_col_asc(f)[0]:!1};e.remove_widget=function(a,b,c){var d=a instanceof f?a:f(a),e=d.coords().grid;f.isFunction(b)&&(c=b,b=!1);this.cells_occupied_by_placeholder={};this.$widgets=this.$widgets.not(d);var g=this.widgets_below(d);this.remove_from_gridmap(e);d.fadeOut(f.proxy(function(){d.remove();b||g.each(f.proxy(function(a,b){this.move_widget_up(f(b),e.size_y)},this));this.set_dom_grid_height();c&&c.call(this,a)},this));return this};e.remove_all_widgets=function(a){this.$widgets.each(f.proxy(function(b,c){this.remove_widget(c,!0,a)},this));return this};e.serialize=function(a){a||(a=this.$widgets);return a.map(f.proxy(function(a,c){var b=f(c);return this.options.serialize_params(b,b.coords().grid)},this)).get()};e.serialize_changed=function(){return this.serialize(this.$changed)};e.dom_to_coords=function(a){return{col:parseInt(a.attr("data-col"),10),row:parseInt(a.attr("data-row"),10),size_x:parseInt(a.attr("data-sizex"),10)||1,size_y:parseInt(a.attr("data-sizey"),10)||1,max_size_x:parseInt(a.attr("data-max-sizex"),10)||!1,max_size_y:parseInt(a.attr("data-max-sizey"),10)||!1,min_size_x:parseInt(a.attr("data-min-sizex"),10)||!1,min_size_y:parseInt(a.attr("data-min-sizey"),10)||!1,el:a}};e.register_widget=function(a){var b=a instanceof jQuery,c=b?this.dom_to_coords(a):a,d=!1;b||(a=c.el);if(b=this.can_go_widget_up(c))c.row=b,a.attr("data-row",b),this.$el.trigger("gridster:positionchanged",[c]),d=!0;this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:c.size_x,size_y:c.size_y},c.col,c.row)&&(f.extend(c,this.next_position(c.size_x,c.size_y)),a.attr({"data-col":c.col,"data-row":c.row,"data-sizex":c.size_x,"data-sizey":c.size_y}),d=!0);a.data("coords",a.coords());a.data("coords").grid=c;this.add_to_gridmap(c,a);this.options.resize.enabled&&this.add_resize_handle(a);return d};e.update_widget_position=function(a,b){this.for_each_cell_occupied(a,function(a,d){if(!this.gridmap[a])return this;this.gridmap[a][d]=b});return this};e.remove_from_gridmap=function(a){return this.update_widget_position(a,!1)};e.add_to_gridmap=function(a,b){this.update_widget_position(a,b||a.el);a.el&&this.widgets_below(a.el).each(f.proxy(function(a,b){this.move_widget_up(f(b))},this))};e.draggable=function(){var a=this,b=f.extend(!0,{},this.options.draggable,{offset_left:this.options.widget_margins[0],offset_top:this.options.widget_margins[1],container_width:this.cols*this.min_widget_width,limit:!0,start:function(b,d){a.$widgets.filter(".player-revert").removeClass("player-revert");a.$player=f(this);a.$helper=f(d.$helper);a.helper=!a.$helper.is(a.$player);a.on_start_drag.call(a,b,d);a.$el.trigger("gridster:dragstart")},stop:function(b,d){a.on_stop_drag.call(a,b,d);a.$el.trigger("gridster:dragstop")},drag:throttle(function(b,d){a.on_drag.call(a,b,d);a.$el.trigger("gridster:drag")},60)});this.drag_api=this.$el.drag(b);return this};e.resizable=function(){this.resize_api=this.$el.drag({items:"."+this.options.resize.handle_class,offset_left:this.options.widget_margins[0],container_width:this.container_width,move_element:!1,resize:!0,limit:this.options.autogrow_cols?!1:!0,start:f.proxy(this.on_start_resize,this),stop:f.proxy(function(a,b){delay(f.proxy(function(){this.on_stop_resize(a,b)},this),120)},this),drag:throttle(f.proxy(this.on_resize,this),60)});return this};e.setup_resize=function(){this.resize_handle_class=this.options.resize.handle_class;var a='\x3cspan class\x3d"'+this.resize_handle_class+" "+this.resize_handle_class+'-{type}" /\x3e';this.resize_handle_tpl=f.map(this.options.resize.axes,function(b){return a.replace("{type}",b)}).join("");f.isArray(this.options.draggable.ignore_dragging)&&this.options.draggable.ignore_dragging.push("."+this.resize_handle_class);return this};e.on_start_drag=function(a,b){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging");this.highest_col=this.get_highest_occupied_cell().col;this.$player.addClass("player");this.player_grid_data=this.$player.coords().grid;this.placeholder_grid_data=f.extend({},this.player_grid_data);this.set_dom_grid_height(this.$el.height()+this.player_grid_data.size_y*this.min_widget_height);this.set_dom_grid_width(this.cols);var c=this.player_grid_data.size_x,d=this.cols-this.highest_col;this.options.autogrow_cols&&d<=c&&this.add_faux_cols(Math.min(c-d,1));c=this.faux_grid;d=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.last_cols=[];this.last_rows=[];this.collision_api=this.$helper.collision(c,this.options.collision);this.$preview_holder=f("\x3c"+this.$player.get(0).tagName+" /\x3e",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:d.width,height:d.height}}).appendTo(this.$el);this.options.draggable.start&&this.options.draggable.start.call(this,a,b)};e.on_drag=function(a,b){if(null===this.$player)return!1;var c={left:b.position.left+this.baseX,top:b.position.top+this.baseY};this.options.autogrow_cols&&(this.placeholder_grid_data.col+this.placeholder_grid_data.size_x-1>=this.cols-1&&this.options.max_cols>=this.cols+1&&(this.add_faux_cols(1),this.set_dom_grid_width(this.cols+1),this.drag_api.set_limits(this.container_width)),this.collision_api.set_colliders(this.faux_grid));this.colliders_data=this.collision_api.get_closest_colliders(c);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.helper&&this.$player&&this.$player.css({left:b.position.left,top:b.position.top});this.options.draggable.drag&&this.options.draggable.drag.call(this,a,b)};e.on_stop_drag=function(a,b){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging");b.position.left+=this.baseX;b.position.top+=this.baseY;this.colliders_data=this.collision_api.get_closest_colliders(b.position);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""});this.$changed=this.$changed.add(this.$player);this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data);this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row);this.$player.coords().grid.row=this.placeholder_grid_data.row;this.$player.coords().grid.col=this.placeholder_grid_data.col;this.options.draggable.stop&&this.options.draggable.stop.call(this,a,b);this.$preview_holder.remove();this.$helper=this.$player=null;this.placeholder_grid_data={};this.player_grid_data={};this.cells_occupied_by_placeholder={};this.cells_occupied_by_player={};this.set_dom_grid_height();this.set_dom_grid_width();this.options.autogrow_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)};e.on_start_resize=function(a,b){this.$resized_widget=b.$player.closest(".gs-w");this.resize_coords=this.$resized_widget.coords();this.resize_wgd=this.resize_coords.grid;this.resize_initial_width=this.resize_coords.coords.width;this.resize_initial_height=this.resize_coords.coords.height;this.resize_initial_sizex=this.resize_coords.grid.size_x;this.resize_initial_sizey=this.resize_coords.grid.size_y;this.resize_initial_col=this.resize_coords.grid.col;this.resize_last_sizex=this.resize_initial_sizex;this.resize_last_sizey=this.resize_initial_sizey;this.resize_max_size_x=Math.min(this.resize_wgd.max_size_x||this.options.resize.max_size[0],this.options.max_cols-this.resize_initial_col+1);this.resize_max_size_y=this.resize_wgd.max_size_y||this.options.resize.max_size[1];this.resize_min_size_x=this.resize_wgd.min_size_x||this.options.resize.min_size[0]||1;this.resize_min_size_y=this.resize_wgd.min_size_y||this.options.resize.min_size[1]||1;this.resize_initial_last_col=this.get_highest_occupied_cell().col;this.set_dom_grid_width(this.cols);this.resize_dir={right:b.$player.is("."+this.resize_handle_class+"-x"),bottom:b.$player.is("."+this.resize_handle_class+"-y")};this.$resized_widget.css({"min-width":this.options.widget_base_dimensions[0],"min-height":this.options.widget_base_dimensions[1]});var c=this.$resized_widget.get(0).tagName;this.$resize_preview_holder=f("\x3c"+c+" /\x3e",{"class":"preview-holder resize-preview-holder","data-row":this.$resized_widget.attr("data-row"),"data-col":this.$resized_widget.attr("data-col"),css:{width:this.resize_initial_width,height:this.resize_initial_height}}).appendTo(this.$el);this.$resized_widget.addClass("resizing");this.options.resize.start&&this.options.resize.start.call(this,a,b,this.$resized_widget);this.$el.trigger("gridster:resizestart")};e.on_stop_resize=function(a,b){this.$resized_widget.removeClass("resizing").css({width:"",height:""});delay(f.proxy(function(){this.$resize_preview_holder.remove().css({"min-width":"","min-height":""});this.options.resize.stop&&this.options.resize.stop.call(this,a,b,this.$resized_widget);this.$el.trigger("gridster:resizestop")},this),300);this.set_dom_grid_width();this.options.autogrow_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)};e.on_resize=function(a,b){var c=b.pointer.diff_left,d=b.pointer.diff_top,f=this.options.widget_base_dimensions[0],e=this.options.widget_base_dimensions[1],l=this.options.widget_margins[0],q=this.options.widget_margins[1],r=this.resize_max_size_x,n=this.resize_min_size_x,k=this.resize_max_size_y,p=this.resize_min_size_y,m=this.options.autogrow_cols,t=Math.max(1,this.resize_initial_sizex+Math.ceil(c/(f+2*l)-.2)),u=Math.max(1,this.resize_initial_sizey+Math.ceil(d/(e+2*q)-.2)),w=this.container_width/this.min_widget_width-this.resize_initial_col+1,y=w*this.min_widget_width-2*l,t=Math.max(Math.min(t,r),n),t=Math.min(w,t),r=Math.min(r*f+(t-1)*l*2,y);min_width=n*f+(t-1)*l*2;u=Math.max(Math.min(u,k),p);f=k*e+(u-1)*q*2;min_height=p*e+(u-1)*q*2;this.resize_dir.right?u=this.resize_initial_sizey:this.resize_dir.bottom&&(t=this.resize_initial_sizex);m&&(e=this.resize_initial_col+t-1,m&&this.resize_initial_last_col<=e&&(this.set_dom_grid_width(Math.max(e+1,this.cols)),this.cols<e&&this.add_faux_cols(e-this.cols)));m={};!this.resize_dir.bottom&&(m.width=Math.max(Math.min(this.resize_initial_width+c,r),min_width));!this.resize_dir.right&&(m.height=Math.max(Math.min(this.resize_initial_height+d,f),min_height));this.$resized_widget.css(m);if(t!==this.resize_last_sizex||u!==this.resize_last_sizey)this.resize_widget(this.$resized_widget,t,u),this.set_dom_grid_width(this.cols),this.$resize_preview_holder.css({width:"",height:""}).attr({"data-row":this.$resized_widget.attr("data-row"),"data-sizex":t,"data-sizey":u});this.options.resize.resize&&this.options.resize.resize.call(this,a,b,this.$resized_widget);this.$el.trigger("gridster:resize");this.resize_last_sizex=t;this.resize_last_sizey=u};e.on_overlapped_column_change=function(a,b){if(!this.colliders_data.length)return this;var c=this.get_targeted_columns(this.colliders_data[0].el.data.col),d=this.last_cols.length,e=c.length,g;for(g=0;g<e;g++)-1===f.inArray(c[g],this.last_cols)&&(a||f.noop).call(this,c[g]);for(g=0;g<d;g++)-1===f.inArray(this.last_cols[g],c)&&(b||f.noop).call(this,this.last_cols[g]);this.last_cols=c;return this};e.on_overlapped_row_change=function(a,b){if(!this.colliders_data.length)return this;var c=this.get_targeted_rows(this.colliders_data[0].el.data.row),d=this.last_rows.length,e=c.length,g;for(g=0;g<e;g++)-1===f.inArray(c[g],this.last_rows)&&(a||f.noop).call(this,c[g]);for(g=0;g<d;g++)-1===f.inArray(this.last_rows[g],c)&&(b||f.noop).call(this,this.last_rows[g]);this.last_rows=c};e.set_player=function(a,b,c){c||this.empty_cells_player_occupies();c=c?{col:a}:this.colliders_data[0].el.data;a=c.col;b=b||c.row;this.player_grid_data={col:a,row:b,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x};this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);c=this.get_widgets_overlapped(this.player_grid_data);var d=this.widgets_constraints(c);this.manage_movements(d.can_go_up,a,b);this.manage_movements(d.can_not_go_up,a,b);c.length||(c=this.can_go_player_up(this.player_grid_data),!1!==c&&(b=c),this.set_placeholder(a,b));return{col:a,row:b}};e.widgets_constraints=function(a){var b=f([]),c=[],d=[];a.each(f.proxy(function(a,e){var h=f(e),g=h.coords().grid;this.can_go_widget_up(g)?(b=b.add(h),c.push(g)):d.push(g)},this));a.not(b);return{can_go_up:k.sort_by_row_asc(c),can_not_go_up:k.sort_by_row_desc(d)}};e.manage_movements=function(a,b,c){f.each(a,f.proxy(function(a,f){var d=f.el,e=this.can_go_widget_up(f);e?(this.move_widget_to(d,e),this.set_placeholder(b,e+f.size_y)):this.can_go_player_up(this.player_grid_data)||(this.move_widget_down(d,c+this.player_grid_data.size_y-f.row),this.set_placeholder(b,c))},this));return this};e.is_player=function(a,b){if(b&&!this.gridmap[a])return!1;var c=b?this.gridmap[a][b]:a;return c&&(c.is(this.$player)||c.is(this.$helper))};e.is_player_in=function(a,b){var c=this.cells_occupied_by_player||{};return 0<=f.inArray(a,c.cols)&&0<=f.inArray(b,c.rows)};e.is_placeholder_in=function(a,b){var c=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(a)&&0<=f.inArray(b,c.rows)};e.is_placeholder_in_col=function(a){return 0<=f.inArray(a,(this.cells_occupied_by_placeholder||[]).cols)};e.is_empty=function(a,b){return"undefined"!==typeof this.gridmap[a]?"undefined"!==typeof this.gridmap[a][b]&&!1===this.gridmap[a][b]?!0:!1:!0};e.is_occupied=function(a,b){return this.gridmap[a]?this.gridmap[a][b]?!0:!1:!1};e.is_widget=function(a,b){var c=this.gridmap[a];return c?(c=c[b])?c:!1:!1};e.is_widget_under_player=function(a,b){return this.is_widget(a,b)?this.is_player_in(a,b):!1};e.get_widgets_under_player=function(a){a||(a=this.cells_occupied_by_player||{cols:[],rows:[]});var b=f([]);f.each(a.cols,f.proxy(function(c,d){f.each(a.rows,f.proxy(function(a,c){this.is_widget(d,c)&&(b=b.add(this.gridmap[d][c]))},this))},this));return b};e.set_placeholder=function(a,b){var c=f.extend({},this.placeholder_grid_data),d=this.widgets_below({col:c.col,row:c.row,size_y:c.size_y,size_x:c.size_x}),e=a+c.size_x-1;e>this.cols&&(a-=e-a);var e=this.placeholder_grid_data.row<b,g=this.placeholder_grid_data.col!==a;this.placeholder_grid_data.col=a;this.placeholder_grid_data.row=b;this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.$preview_holder.attr({"data-row":b,"data-col":a});(e||g)&&d.each(f.proxy(function(b,d){this.move_widget_up(f(d),this.placeholder_grid_data.col-a+c.size_y)},this));d=this.get_widgets_under_player(this.cells_occupied_by_placeholder);d.length&&d.each(f.proxy(function(a,d){var e=f(d);this.move_widget_down(e,b+c.size_y-e.data("coords").grid.row)},this))};e.can_go_player_up=function(a){var b=a.row+a.size_y-1,c=!0,d=[],f=1E4,e=this.get_widgets_under_player();this.for_each_column_occupied(a,function(a){var h=this.gridmap[a],g=b+1;for(d[a]=[];0<--g;)if(this.is_empty(a,g)||this.is_player(a,g)||this.is_widget(a,g)&&h[g].is(e))d[a].push(g),f=g<f?g:f;else break;if(0===d[a].length)return c=!1,!0;d[a].sort(function(a,b){return a-b})});return c?this.get_valid_rows(a,d,f):!1};e.can_go_widget_up=function(a){var b=a.row+a.size_y-1,c=!0,d=[],f=1E4;this.for_each_column_occupied(a,function(e){var h=this.gridmap[e];d[e]=[];for(var g=b+1;0<--g&&(!this.is_widget(e,g)||this.is_player_in(e,g)||h[g].is(a.el));)this.is_player(e,g)||this.is_placeholder_in(e,g)||this.is_player_in(e,g)||d[e].push(g),g<f&&(f=g);if(0===d[e].length)return c=!1,!0;d[e].sort(function(a,b){return a-b})});return c?this.get_valid_rows(a,d,f):!1};e.get_valid_rows=function(a,b,c){var d=a.row,e=a.row+a.size_y-1;a=a.size_y;var g=c-1;for(c=[];++g<=e;){var l=!0;f.each(b,function(a,b){f.isArray(b)&&-1===f.inArray(g,b)&&(l=!1)});if(!0===l&&(c.push(g),c.length===a))break}b=!1;1===a?c[0]!==d&&(b=c[0]||!1):c[0]!==d&&(b=this.get_consecutive_numbers_index(c,a));return b};e.get_consecutive_numbers_index=function(a,b){for(var c=a.length,d=[],f=!0,e=-1,l=0;l<c;l++){if(f||a[l]===e+1){d.push(l);if(d.length===b)break;f=!1}else d=[],f=!0;e=a[l]}return d.length>=b?a[d[0]]:!1};e.get_widgets_overlapped=function(){var a=f([]),b=[],c=this.cells_occupied_by_player.rows.slice(0);c.reverse();f.each(this.cells_occupied_by_player.cols,f.proxy(function(d,e){f.each(c,f.proxy(function(c,d){if(!this.gridmap[e])return!0;var g=this.gridmap[e][d];this.is_occupied(e,d)&&!this.is_player(g)&&-1===f.inArray(g,b)&&(a=a.add(g),b.push(g))},this))},this));return a};e.on_start_overlapping_column=function(a){this.set_player(a,!1)};e.on_start_overlapping_row=function(a){this.set_player(!1,a)};e.on_stop_overlapping_column=function(a){this.set_player(a,!1);var b=this;this.for_each_widget_below(a,this.cells_occupied_by_player.rows[0],function(a,d){b.move_widget_up(this,b.player_grid_data.size_y)})};e.on_stop_overlapping_row=function(a){this.set_player(!1,a);for(var b=this,c=this.cells_occupied_by_player.cols,d=0,f=c.length;d<f;d++)this.for_each_widget_below(c[d],a,function(a,c){b.move_widget_up(this,b.player_grid_data.size_y)})};e.move_widget=function(a,b,c,d){var f=a.coords().grid;b={col:b,row:c,size_x:f.size_x,size_y:f.size_y};this.mutate_widget_in_gridmap(a,f,b);this.set_dom_grid_height();this.set_dom_grid_width();d&&d.call(this,b.col,b.row);return a};e.move_widget_to=function(a,b){var c=this,d=a.coords().grid,e=this.widgets_below(a);if(!1===this.can_move_to(d,d.col,b,a))return!1;this.remove_from_gridmap(d);d.row=b;this.add_to_gridmap(d);a.attr("data-row",b);this.$changed=this.$changed.add(a);e.each(function(a,b){var d=f(b),e=d.coords().grid,g=c.can_go_widget_up(e);g&&g!==e.row&&c.move_widget_to(d,g)});return this};e.move_widget_up=function(a,b){var c=a.coords().grid,d=c.row,e=[];b||(b=1);if(!this.can_go_up(a))return!1;this.for_each_column_occupied(c,function(c){if(-1===f.inArray(a,e)){var g=a.coords().grid,h=d-b,h=this.can_go_up_to_row(g,c,h);if(!h)return!0;c=this.widgets_below(a);this.remove_from_gridmap(g);g.row=h;this.add_to_gridmap(g);a.attr("data-row",g.row);this.$changed=this.$changed.add(a);e.push(a);c.each(f.proxy(function(a,c){this.move_widget_up(f(c),b)},this))}})};e.move_widget_down=function(a,b){var c,d;if(0>=b)return!1;c=a.coords().grid.row;d=[];if(!a)return!1;if(-1===f.inArray(a,d)){var e=a.coords().grid;c+=b;var g=this.widgets_below(a);this.remove_from_gridmap(e);g.each(f.proxy(function(a,c){var d=f(c),g=d.coords().grid,g=this.displacement_diff(g,e,b);0<g&&this.move_widget_down(d,g)},this));e.row=c;this.update_widget_position(e,a);a.attr("data-row",e.row);this.$changed=this.$changed.add(a);d.push(a)}};e.can_go_up_to_row=function(a,b,c){var d=!0,e=[],g=a.row,l;this.for_each_column_occupied(a,function(a){e[a]=[];for(l=g;l--;)if(this.is_empty(a,l)&&!this.is_placeholder_in(a,l))e[a].push(l);else break;if(!e[a].length)return d=!1,!0});if(!d)return!1;l=c;for(l=1;l<g;l++){a=!0;b=0;for(c=e.length;b<c;b++)e[b]&&-1===f.inArray(l,e[b])&&(a=!1);if(!0===a){d=l;break}}return d};e.displacement_diff=function(a,b,c){var d=a.row,e=[],f=b.row+b.size_y;this.for_each_column_occupied(a,function(a){for(var b=0,c=f;c<d;c++)this.is_empty(a,c)&&(b+=1);e.push(b)});a=Math.max.apply(Math,e);c-=a;return 0<c?c:0};e.widgets_below=function(a){a=f.isPlainObject(a)?a:a.coords().grid;var b=this,c=a.row+a.size_y-1,d=f([]);this.for_each_column_occupied(a,function(a){b.for_each_widget_below(a,c,function(a,c){if(!b.is_player(this)&&-1===f.inArray(this,d))return d=d.add(this),!0})});return k.sort_by_row_asc(d)};e.set_cells_player_occupies=function(a,b){this.remove_from_gridmap(this.placeholder_grid_data);this.placeholder_grid_data.col=a;this.placeholder_grid_data.row=b;this.add_to_gridmap(this.placeholder_grid_data,this.$player);return this};e.empty_cells_player_occupies=function(){this.remove_from_gridmap(this.placeholder_grid_data);return this};e.can_go_up=function(a){a=a.coords().grid;var b=a.row,c=b-1,d=!0;if(1===b)return!1;this.for_each_column_occupied(a,function(a){this.is_widget(a,c);if(this.is_occupied(a,c)||this.is_player(a,c)||this.is_placeholder_in(a,c)||this.is_player_in(a,c))return d=!1,!0});return d};e.can_move_to=function(a,b,c,d){var e=a.el,f=!0;if(b+a.size_x-1>this.cols||d&&d<c+a.size_y-1)return!1;this.for_each_cell_occupied({size_y:a.size_y,size_x:a.size_x,col:b,row:c},function(b,c){var d=this.is_widget(b,c);!d||a.el&&!d.is(e)||(f=!1)});return f};e.get_targeted_columns=function(a){for(var b=(a||this.player_grid_data.col)+(this.player_grid_data.size_x-1),c=[];a<=b;a++)c.push(a);return c};e.get_targeted_rows=function(a){for(var b=(a||this.player_grid_data.row)+(this.player_grid_data.size_y-1),c=[];a<=b;a++)c.push(a);return c};e.get_cells_occupied=function(a,b){var c={cols:[],rows:[]},d;b instanceof f&&(a=b.coords().grid);for(d=0;d<a.size_x;d++)c.cols.push(a.col+d);for(d=0;d<a.size_y;d++)c.rows.push(a.row+d);return c};e.for_each_cell_occupied=function(a,b){this.for_each_column_occupied(a,function(c){this.for_each_row_occupied(a,function(a){b.call(this,c,a)})});return this};e.for_each_column_occupied=function(a,b){for(var c=0;c<a.size_x;c++)b.call(this,a.col+c,a)};e.for_each_row_occupied=function(a,b){for(var c=0;c<a.size_y;c++)b.call(this,a.row+c,a)};e._traversing_widgets=function(a,b,c,d,e){var g=this.gridmap;if(g[c]){var h,k;a=a+"/"+b;c instanceof f&&(b=c.coords().grid,c=b.col,e=d=b.row);var m=[],n=d;b={"for_each/above":function(){for(;n--&&!(0<n&&this.is_widget(c,n)&&-1===f.inArray(g[c][n],m)&&(h=e.call(g[c][n],c,n),m.push(g[c][n]),h)););},"for_each/below":function(){n=d+1;for(k=g[c].length;n<k&&(!this.is_widget(c,n)||-1!==f.inArray(g[c][n],m)||(h=e.call(g[c][n],c,n),m.push(g[c][n]),!h));n++);}};b[a]&&b[a].call(this)}};e.for_each_widget_above=function(a,b,c){this._traversing_widgets("for_each","above",a,b,c);return this};e.for_each_widget_below=function(a,b,c){this._traversing_widgets("for_each","below",a,b,c);return this};e.get_highest_occupied_cell=function(){var a;a=this.gridmap;for(var b=a[1].length,c=[],d=[],e=a.length-1;1<=e;e--)for(a=b-1;1<=a;a--)if(this.is_widget(e,a)){c.push(a);d.push(e);break}return{col:Math.max.apply(Math,d),row:Math.max.apply(Math,c)}};e.get_widgets_from=function(a,b){var c=f();a&&(c=c.add(this.$widgets.filter(function(){var b=f(this).attr("data-col");return b===a||b>a})));b&&(c=c.add(this.$widgets.filter(function(){var a=f(this).attr("data-row");return a===b||a>b})));return c};e.set_dom_grid_height=function(a){"undefined"===typeof a&&(a=this.get_highest_occupied_cell().row*this.min_widget_height);this.container_height=a;this.$el.css("height",this.container_height);return this};e.set_dom_grid_width=function(a){"undefined"===typeof a&&(a=this.get_highest_occupied_cell().col);a=Math.min(this.options.autogrow_cols?this.options.max_cols:this.cols,Math.max(a,this.options.min_cols));this.container_width=a*this.min_widget_width;this.$el.css("width",this.container_width);return this};e.generate_stylesheet=function(a){var b="",c=this.options.max_size_x||this.cols,d;a||(a={});a.cols||(a.cols=this.cols);a.rows||(a.rows=this.rows);a.namespace||(a.namespace=this.options.namespace);a.widget_base_dimensions||(a.widget_base_dimensions=this.options.widget_base_dimensions);a.widget_margins||(a.widget_margins=this.options.widget_margins);a.min_widget_width=2*a.widget_margins[0]+a.widget_base_dimensions[0];a.min_widget_height=2*a.widget_margins[1]+a.widget_base_dimensions[1];d=f.param(a);if(0<=f.inArray(d,k.generated_stylesheets))return!1;this.generated_stylesheets.push(d);k.generated_stylesheets.push(d);for(d=a.cols;0<=d;d--)b+=a.namespace+' [data-col\x3d"'+(d+1)+'"] { left:'+(d*a.widget_base_dimensions[0]+d*a.widget_margins[0]+(d+1)*a.widget_margins[0])+"px; }\n";for(d=a.rows;0<=d;d--)b+=a.namespace+' [data-row\x3d"'+(d+1)+'"] { top:'+(d*a.widget_base_dimensions[1]+d*a.widget_margins[1]+(d+1)*a.widget_margins[1])+"px; }\n";for(d=1;d<=a.rows;d++)b+=a.namespace+' [data-sizey\x3d"'+d+'"] { height:'+(d*a.widget_base_dimensions[1]+2*(d-1)*a.widget_margins[1])+"px; }\n";for(d=1;d<=c;d++)b+=a.namespace+' [data-sizex\x3d"'+d+'"] { width:'+(d*a.widget_base_dimensions[0]+2*(d-1)*a.widget_margins[0])+"px; }\n";this.remove_style_tags();return this.add_style_tag(b)};e.add_style_tag=function(a){var b=document,c="gridster-stylesheet";""!==this.options.namespace&&(c=c+"-"+this.options.namespace);f("#"+c).remove();if(!document.getElementById(c)){var d=b.createElement("style");d.id=c;b.getElementsByTagName("head")[0].appendChild(d);d.setAttribute("type","text/css");d.styleSheet?d.styleSheet.cssText=a:d.appendChild(document.createTextNode(a));this.remove_style_tags();this.$style_tags=this.$style_tags.add(d)}return this};e.remove_style_tags=function(){var a=k.generated_stylesheets,b=this.generated_stylesheets;this.$style_tags.remove();k.generated_stylesheets=f.map(a,function(a){if(-1===f.inArray(a,b))return a})};e.generate_faux_grid=function(a,b){this.faux_grid=[];this.gridmap=[];var c,d;for(c=b;0<c;c--)for(this.gridmap[c]=[],d=a;0<d;d--)this.add_faux_cell(d,c);return this};e.add_faux_cell=function(a,b){var c=f({left:this.baseX+(b-1)*this.min_widget_width,top:this.baseY+(a-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:b,row:a,original_col:b,original_row:a}).coords();f.isArray(this.gridmap[b])||(this.gridmap[b]=[]);this.gridmap[b][a]=!1;this.faux_grid.push(c);return this};e.add_faux_rows=function(a){for(var b=this.rows,c=a=b+(a||1);c>b;c--)for(var d=this.cols;1<=d;d--)this.add_faux_cell(c,d);this.rows=a;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this};e.add_faux_cols=function(a){var b=this.cols;a=Math.min(b+(a||1),this.options.max_cols);for(b+=1;b<=a;b++)for(var c=this.rows;1<=c;c--)this.add_faux_cell(c,b);this.cols=a;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this};e.recalculate_faux_grid=function(){var a=this.$wrapper.width();this.baseX=(f(window).width()-a)/2;this.baseY=this.$wrapper.offset().top;f.each(this.faux_grid,f.proxy(function(a,c){this.faux_grid[a]=c.update({left:this.baseX+(c.data.col-1)*this.min_widget_width,top:this.baseY+(c.data.row-1)*this.min_widget_height})},this));return this};e.resize_widget_dimensions=function(a){a.widget_margins&&(this.options.widget_margins=a.widget_margins);a.widget_base_dimensions&&(this.options.widget_base_dimensions=a.widget_base_dimensions);this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0];this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1];this.$widgets.each(f.proxy(function(a,c){var b=f(c);this.resize_widget(b)},this));this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.set_dom_grid_width();return this};e.get_widgets_from_DOM=function(){var a=this.$widgets.map(f.proxy(function(a,c){var b=f(c);return this.dom_to_coords(b)},this)),a=k.sort_by_row_and_col_asc(a);f(a).map(f.proxy(function(a,c){return this.register_widget(c)||null},this)).length&&this.$el.trigger("gridster:positionschanged");return this};e.generate_grid_and_stylesheet=function(){var a=this.$wrapper.width(),b=this.options.max_cols,c=Math.floor(a/this.min_widget_width)+this.options.extra_cols,d=this.$widgets.map(function(){return f(this).attr("data-col")}).get();d.length||(d=[0]);d=Math.max.apply(Math,d);this.cols=Math.max(d,c,this.options.min_cols);Infinity!==b&&b>=d&&b<this.cols&&(this.cols=b);var e=this.options.extra_rows;this.$widgets.each(function(a,b){e+=+f(b).attr("data-sizey")});this.rows=Math.max(e,this.options.min_rows);this.baseX=(f(window).width()-a)/2;this.baseY=this.$wrapper.offset().top;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this.generate_faux_grid(this.rows,this.cols)};e.destroy=function(a){this.$el.removeData("gridster");f(window).unbind(".gridster");this.drag_api&&this.drag_api.destroy();this.remove_style_tags();a&&this.$el.remove();return this};f.fn.gridster=function(a){return this.each(function(){f(this).data("gridster")||f(this).data("gridster",new k(this,a))})};return k});