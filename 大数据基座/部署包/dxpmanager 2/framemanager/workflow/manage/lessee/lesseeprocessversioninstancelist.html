<!DOCTYPE html>
<html>

<head>
<title>过程版本实例</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div id="toolbar" class="btn-group mr10" style="display: none">
			<a class="mini-button" id="btnBack" iconCls="icon-backward"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择想要回第一步的记录！', '', null, 'warning');} else {epoint.confirm('确定要回第一步吗？','',backToStart);}">回第一步</a>
			<a class="mini-button mini-btn-success" id="btnEnd"
				iconCls="icon-stop"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择想要终止的记录！', '', null, 'warning');} else {epoint.confirm('确定要终止吗？','',terminatePVI);}">终止流程实例</a>
			<a class="mini-button mini-btn-danger" id="btnDel"
				iconCls="icon-removecircle"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择想要删除的记录！', '', null, 'warning');} else {epoint.confirm('确定要删除吗？','',deleteSelected);}">删除选中</a>

		</div>
	</div>

	<div class="fui-search" opened="false" primaryControl="processversion">
		<div class="fui-form" id="fui-form">
			<div role="form">
				<!-- 2列 -->
				<div role="row">
					<div role="control" label="过程版本实例名称">
						<input bind="processversion" id="processversion"
							class="mini-textbox" />
					</div>
					<div role="control" label="PVIGuid">
						<input bind="pviguid" id="pviguid" class="mini-textbox" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="过程版本实例状态">
						<input id="processversionstate" autoLoad="false"
							bind="processversionstate" textField="text"
							data="[{text:'所有分类',id:'0'},{text:'初始化',id:'10'},{text:'未提交',id:'15'},{text:'已提交',id:'20'},{text:'挂起',id:'30'},{text:'完成',id:'80'},{text:'终止',id:'90'}]"
							valueField="id" class="mini-combobox mr10" />
					</div>
					<div role="control"></div>
					<!-- <div role="control" label="租户">
						<input id="tenantguid" autoLoad="false" bind="tenantguid"
							textField="text" action="getTenantModel" valueField="id"
							class="mini-combobox mr10" />
					</div> -->
				</div>
			</div>
			<input class="mini-hidden" id="lessee" bind="lessee" /> <input
				class="mini-hidden" id="lesseeshow" bind="lesseeshow" />
		</div>
		<!-- 搜索按钮 -->
		<a role="searcher" callback="searchData"></a>
	</div>

	<div class="fui-content">
		<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="processVersionInstanceGuid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			action="getDefaultDataModel" showPager="true"
			editNextOnEnterKey="true" editNextRowCell="true">
			<div property="columns">

				<div type="checkcolumn" width="35"></div>

				<div type="indexcolumn" headerAlign="center" width="35">序</div>
				<div field="processVersionInstanceGuid" width="280"
					headerAlign="center">pviguid</div>
				<div field="pviName" width="100%" headerAlign="center"
					align="center" renderer="onLocationUrl">名称</div>
				<div field="tenantName" width="80" headerAlign="center"
					align="center">租户标识</div>
				<div field="sendName" width="120" headerAlign="center"
					align="center">发起人</div>
				<div field="tenantName" width="80" headerAlign="center"
					align="center" renderer="onSetting">流程监控</div>
				<div field="startDate" width="150" headerAlign="center"
					align="center" dateFormat="yyyy-MM-dd HH:mm:ss"
					data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}" allowSort="true"
					sortOrder="desc">开始时间</div>
				<div field="pviStatus" width="80" headerAlign="center"
					align="center">状态</div>
				<div field="endDate" width="150" headerAlign="center" align="center"
					dateFormat="yyyy-MM-dd HH:mm:ss"
					data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}">结束时间</div>
			</div>
		</div>
	</div>

	<script src="../../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[  
		//初始化页面
		epoint.initPage('lesseeprocessversioninstancelistaction', '',
				initCallBack);
		function initCallBack() {
			var lesseeshow = mini.get('lesseeshow').getValue();
			if (lesseeshow && lesseeshow == false) {
				document.getElementById("toolbar").style.display = "none";
			} else {
				document.getElementById("toolbar").style.display = "block";
			}
		}

		function deleteSelected() {
			epoint.execute('delete', 'datagrid', msgCallBack);
		}

		function backToStart() {
			epoint.execute('backToStart', 'datagrid', msgCallBack);
		}

		function terminatePVI() {
			epoint.execute('terminatePVI', 'datagrid', msgCallBack);
		}

		function onLocationUrl(e) {
			return ' <a class="" href="javascript:openBrowserWindow(\''
					+ e.row['processVersionInstanceGuid'] + '\')">' + e.value
					+ '</a>';
		}

		function showFlowChart(processversioninstanceguid) {
			epoint
					.openDialog(
							'流程监控',
							Util
									.addUrlParams(
											"frame/pages/epointworkflow/client/processoa9manage?processVersionInstanceGuid="
													+ processversioninstanceguid
													+ "&actionName=processversioninstancelistaction",
											Util.getUrlParams(), "ignore"),
							function() {
								epoint.refresh([ 'datagrid', 'fui-form' ], '',
										true);
							});
		}

		function openBrowserWindow(processversioninstanceguid) {
			var url = Util
					.addUrlParams(
							"frame/pages/epointworkflow/client/browser/browserenter?ProcessVersionInstanceGuid="
									+ processversioninstanceguid
									+ "&actionName=processversioninstancelistaction",
							Util.getUrlParams(), "ignore");
			epoint.openDialog('流程预览', url);
		}

		function onSetting(e) {
			return epoint.renderCell(e, "action-icon icon-gear",
					"showFlowChart");
		}

		// 回调提醒
		function msgCallBack(data) {
			var msg = data.msg;
			if (msg) {
				epoint.alert(msg, '', function() {
					epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
				}, 'info');
			}
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid', 'fui-form' ]);
		}
		//]]>
	</script>
</body>
</html>
