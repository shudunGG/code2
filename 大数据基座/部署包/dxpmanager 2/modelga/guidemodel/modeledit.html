<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>模型保存</title>
<!-- 请修改相对路径 -->
<script src="../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>
	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addNew" onclick="confirmadd">确定保存</a>
			<a class="mini-button" id="cancleadd" onclick="epoint.closeDialog">取消保存</a>
		</div>
	</div>
	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="fui-form" class="fui-form">
			<div role="form">
				<div role="row"></div>
				<div role="row">
					<div role="control" label="模型名称" starred="true">
						<input id="modelname" class="mini-textbox" width="90%" required="true" requiredErrorText="模型名称不能为空！"
							bind="flowName" maxLength="25" />
					</div>
				</div>
				<div role="row" id="modelgroup">
					<div role="control" label="模型分类" starred="true">
						<input id="tree1" class="mini-treeselect" action="dxpflowgroupaction.getTreeModel" bind="groupGuid" width="90%"
							showFolderCheckBox="true" showRadioButton="true" showTreeIcon="true" textField="text" valueField="id"
							expandOnNodeClick="true" required="true" requiredErrorText="模型分类不能为空！"/>

					</div>
				</div>
				 <div role="row">
					<div role="control" label="模型描述">
						<input id="describeinfo" class="mini-textArea" height="50px" width="90%" bind="describeinfo" />
					</div>
				</div>
			</div>
			<!-- <input class="mini-hidden" bind="dataBean.rowguid" id="rowguid" /> -->
		</div></div>
		<!-- 请修改相对路径 -->
		<script src="../../rest/resource/jsboot"></script>
		<script>
		var savetype = Util.getUrlParams("savetype");
		var type = Util.getUrlParams("type");
		var historyGuid = Util.getUrlParams("historyGuid");
		// 初始化页面
		//var rowguid;
		epoint.initPage('dxpmodelfloweditaction', null, function(data) {
			//rowguid = mini.get('rowguid').getValue();
			if (!mini.get("tree1").getValue()) {
				mini.get("tree1").setText("");
			}
		});


		function confirmadd() {
			if (epoint.validate()) {
				var name=mini.get('modelname').getValue();
				if(name.substring(0,4)=='演示模型'){
					epoint.alert('请修改模型名称！不要以演示模型开头！');
					return;
				}
				if (savetype) {
					if (savetype == 'other') {
						epoint.execute('othersave', 'fui-form', ['1',historyGuid],
								function(data){
							 if (data.result) {
									if (data.result == "success") {
										var modelGuid=data.modelGuid;
										epoint.alert("保存成功", '', function(){
											epoint.closeDialog(modelGuid+";"+mini.get('modelname').getValue());
										},  'info');
									} else {
										epoint.alert(data.result);
									}

								}
						 });
					}else{
						 epoint.execute('save2', 'fui-form', '1',
						function(data){
							 if (data.result) {
									if (data.result == "success") {
										epoint.alert("保存成功", '', function(){
											epoint.closeDialog(mini.get('modelname').getValue());
										},  'info');
									} else {
										epoint.alert(data.error,'','','error');
									}

								}
						 });
					}
				} else {
					if(type=='2'){
						epoint.execute('saveGuideModel', 'fui-form', newCallback);
					}else{
						epoint.execute('save', 'fui-form', newCallback);
					}
				}

			}
		}

		// 新增操作的回调
		function newCallback(data) {
			if (data.result) {
				if (data.result == "success") {
					epoint.alertAndClose("保存成功", '', null, null, 'info');
				} else {
					epoint.alert("保存失败");
				}

			}else{
				epoint.alert(data.error,'','','error');
			}
		}
		function refreshGrid() {
			epoint.refresh([ 'datagrid' ]);
		}

		function beforenodeselect(e) {
			//禁止选中父节点
			if (e.node.id == -1)
				e.cancel = true;
		}

		function onCloseClick(e) {
			var obj = e.sender;
			obj.setText("");
			obj.setValue("");
		}
	</script>
</body>
</html>