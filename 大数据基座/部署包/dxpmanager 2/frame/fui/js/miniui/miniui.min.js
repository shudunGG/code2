mini={components:{},uids:{},ux:{},doc:document,window:window,isReady:!1,createTime:new Date,byClass:function(t,e){return"string"==typeof e&&(e=mini.byId(e)),jQuery("."+t,e)[0]},getComponents:function(){var t=[];for(var e in mini.components){var i=mini.components[e];i.isControl&&t.push(i)}return t},get:function(t){if(!t)return null;if(mini.isControl(t))return t;if("string"==typeof t&&"#"==t.charAt(0)&&(t=t.substr(1)),"string"==typeof t)return mini.components[t];var e=mini.uids[t.uid];return e&&e.el==t?e:null},getbyUID:function(t){return mini.uids[t]},findControls:function(t,e){if(!t)return[];e=e||mini;var i=[],n=mini.uids;for(var s in n){var o=n[s],r=t.call(e,o);if((!0===r||1===r)&&(i.push(o),1===r))break}return i},getChildControls:function(e){var i=e.el?e.el:e;return mini.findControls(function(t){return!(!t.el||e==t)&&!(!mini.isAncestor(i,t.el)||!t.within)})},emptyFn:function(){},createNameControls:function(t,e){if(t&&t.el){e=e||"_";for(var i=t.el,n=mini.findControls(function(t){return!(!t.el||!t.name)&&!!mini.isAncestor(i,t.el)}),s=0,o=n.length;s<o;s++){var r=n[s],l=e+r.name;!0===e&&(l=r.name[0].toUpperCase()+r.name.substring(1,r.name.length)),t[l]=r}}},getsByName:function(t,e){return mini.getsbyName(t,e)},getsbyName:function(e,i){var t=mini.isControl(i),n=i;i&&t&&(i=i.el),i=(i=mini.byId(i))||document.body;var s=mini.findControls(function(t){return!!t.el&&!(t.name!=e||!mini.isAncestor(i,t.el))},this);if(t&&0==s.length&&n&&n.getbyName){var o=n.getbyName(e);o&&s.push(o)}return s},getbyName:function(t,e){return mini.getsbyName(t,e)[0]},getByName:function(t,e){return mini.getbyName(t,e)},getParams:function(t){var e={};if(t=(t=t||location.href).split("?")[1])for(var i=t.split("&"),n=0,s=i.length;n<s;n++){var o=i[n].split("=");try{e[o[0]]=decodeURIComponent(unescape(o[1]))}catch(t){}}return e},reg:function(t){this.components[t.id]=t,this.uids[t.uid]=t},unreg:function(t){delete mini.components[t.id],delete mini.uids[t.uid]},classes:{},uiClasses:{},getClass:function(t){return t?this.classes[t.toLowerCase()]:null},getClassByUICls:function(t){return this.uiClasses[t.toLowerCase()]},idPre:"mini-",idIndex:1,newId:function(t){return(t||this.idPre)+this.idIndex++},copyTo:function(t,e){if(t&&e)for(var i in e)t[i]=e[i];return t},copyIf:function(t,e){if(t&&e)for(var i in e)mini.isNull(t[i])&&(t[i]=e[i]);return t},createDelegate:function(t,e){return t?function(){return t.apply(e,arguments)}:function(){}},isControl:function(t){return!(!t||!t.isControl)},isElement:function(t){return t&&t.appendChild},isDate:function(t){return!(!t||!t.getFullYear)},isArray:function(t){return!(!t||!t.unshift)},isNull:function(t){return null==t},isNumber:function(t){return!isNaN(t)&&"number"==typeof t},isEquals:function(t,e){return!(0===t||0===e||!mini.isNull(t)&&""!=t||!mini.isNull(e)&&""!=e)||(t&&e&&t.getFullYear&&e.getFullYear?t.getTime()===e.getTime():"object"==typeof t&&"object"==typeof e?t===e:String(t)===String(e))},forEach:function(t,e,i){for(var n=t.clone(),s=0,o=n.length;s<o;s++){var r=n[s];if(!1===e.call(i,r,s,t))break}},sort:function(t,e,i){(function(t,e){for(var i,n=0,s=t.length;n<s;n++)for(i=n;i<s;i++){var o=t[n],r=t[i];0<e(o,r)&&(t.removeAt(i),t.insert(n,r))}})(t,e)},elWarp:document.createElement("div")},"undefined"==typeof mini_debugger&&(mini_debugger=!0),"undefined"==typeof mini_useShims&&(mini_useShims=!1),"undefined"==typeof mini_ajaxAsyncInvoke&&(mini_ajaxAsyncInvoke=!0),mini_regClass=function(t,e){e=e.toLowerCase(),mini.classes[e]||((mini.classes[e]=t).prototype.type=e);var i=t.prototype.uiCls;mini.isNull(i)||mini.uiClasses[i]||(mini.uiClasses[i]=t)},mini_extend=function(t,e,i){if("function"!=typeof e)return this;var n=t,s=n.prototype,o=e.prototype;if(n.superclass!=o){for(var r in n.superclass=o,n.superclass.constructor=e,o)s[r]=o[r];if(i)for(var r in i)s[r]=i[r];return n}},mini.copyTo(mini,{extend:mini_extend,regClass:mini_regClass,debug:!1}),mini.namespace=function(t){if("string"==typeof t){t=t.split(".");for(var e=window,i=0,n=t.length;i<n;i++){var s=t[i],o=e[s];e=o=o||(e[s]={})}}},mini._BindCallbacks=[],mini._BindEvents=function(t,e){mini._BindCallbacks.push([t,e]),mini._EventTimer||(mini._EventTimer=setTimeout(function(){mini._FireBindEvents()},50))},mini._FireBindEvents=function(){for(var t=0,e=mini._BindCallbacks.length;t<e;t++){var i=mini._BindCallbacks[t];i[0].call(i[1])}mini._BindCallbacks=[],mini._EventTimer=null},mini._getFunctoin=function(t){if("string"!=typeof t)return null;for(var e=t.split("."),i=null,n=0,s=e.length;n<s;n++){var o=e[n];if(!(i=i?i[o]:window[o]))break}return i};var cacheParts={};function createPathParts(t){var e=cacheParts[t];if(!e){for(var i=0,n=(e=t.split(".")).length;i<n;i++){var s=e[i],o=s.indexOf("[");-1<o&&(e[i]=s.substr(0,o),e.splice(++i,0,parseInt(s.substr(o+1))))}cacheParts[t]=e}return e}function getValueByPath(t,e){if(t&&e){if(e in t)return t[e];for(var i=createPathParts(e),n=0,s=i.length;n<s&&t;n++)t=t[i[n]];return t}}function listColumnRenderer(t){var e=t.column,i=mini.isNull(t.value)?"":String(t.value),n=i.split(","),s="id",o="text",r={},l=e.editor,a=e.__editor;if(l){a||"combobox"!=l.type&&"treeselect"!=l.type||(a=mini.isControl(l)?l:(l=mini.clone(l),mini.create(l)),t.column.__editor=a),s=a.getValueField(),o=a.getTextField();var h=a.getData();if(!(r=e._valueMaps)||h!==e._data){var u=a.getList?a.getList():h;r={};for(var d=0,c=u.length;d<c;d++){r[(f=u[d])[s]]=f}e._valueMaps=r,e._data=h}}var m=[];for(d=0,c=n.length;d<c;d++){var f;if(f=r[n[d]]){var p=f[o];null==p&&(p=""),m.push(p)}}return 0==m.length&&!1===e.valueFromSelect?i:m.join(",")}mini._getMap=function(t,e){if(t&&e){if(void 0!==(n=e[t]))return n;var i=t.indexOf(".");if(-1==i&&-1==t.indexOf("["))return e[t];if(i==t.length-1)return e[t];try{var n=getValueByPath(e,t)}catch(t){return}return n}},mini._setMap=function(t,e,i){if(i&&"string"==typeof t){for(var n=t.split("."),s=null,o=0,r=n.length;o<=r-1;o++){t=n[o];if(o==r-1){var l,a,h;if(-1==t.indexOf("]"))i[t]=e;else u(i,a=(l=t.split("["))[0],h=parseInt(l[1]),""),i[a][h]=e;break}if(-1==t.indexOf("]"))s=i[t],o<=r-2&&null==s&&(i[t]=s={}),i=s;else i=u(i,a=(l=t.split("["))[0],h=parseInt(l[1]))}return e}function u(t,e,i,n){var s=t[e];s=s||(t[e]=[]);for(var o=0;o<=i;o++){var r=s[o];r=r||(s[o]=null==n?{}:n)}return t[e][i]}},mini.getAndCreate=function(t){return t?"string"==typeof t?mini.components[t]:"object"==typeof t?mini.isControl(t)?t:mini.isElement(t)?mini.uids[t.uid]:mini.create(t):null:null},mini.create=function(t){if(!t)return null;if(mini.get(t.id)===t)return t;var e=this.getClass(t.type);if(!e)return null;var i=new e;return i.set(t),i},mini.Component=function(){this._events={},this.uid=mini.newId(this._idPre),this._id=this.uid,this.id||(this.id=this.uid),mini.reg(this)},mini.Component.prototype={isControl:!0,id:null,_idPre:"mini-",_idSet:!1,_canFire:!0,set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i=t.renderTo||t.render;for(var n in delete t.renderTo,delete t.render,t)if(0==n.toLowerCase().indexOf("on")){if(this["_$"+n])continue;var s=t[n];this.on(n.substring(2,n.length).toLowerCase(),s),delete t[n]}for(var n in t){var o=t[n],r=this["set"+n.charAt(0).toUpperCase()+n.substring(1,n.length)];r?r.call(this,o):this[n]=o}return i&&this.render&&this.render(i),this._allowLayout=e,this.doLayout&&this.doLayout(),this},fire:function(t,e){if(0!=this._canFire){t=t.toLowerCase();var i=this._events[t];if(i){(e=e||{})&&e!=this&&(e.source=e.sender=this,e.type||(e.type=t));for(var n=0,s=i.length;n<s;n++){var o=i[n];o&&o[0].apply(o[1],[e])}}}},on:function(t,e,i){if("string"==typeof e){var n=mini._getFunctoin(e);if(n)e=n;else{var s=mini.newId("__str_");window[s]=e,e=new Function("e","var s = "+s+";var fn = mini._getFunctoin(s); if(fn) {fn.call(this, e)}else{eval(s);}")}}if("function"!=typeof e||!t)return!1;t=t.toLowerCase();var o=this._events[t];return o=o||(this._events[t]=[]),i=i||this,this.findListener(t,e,i)||o.push([e,i]),this},un:function(t,e,i){t=t.toLowerCase();var n=this._events[t];if(n)if(e){i=i||this;var s=this.findListener(t,e,i);s&&n.remove(s)}else delete this._events[t];return this},findListener:function(t,e,i){t=t.toLowerCase(),i=i||this;var n=this._events[t];if(n)for(var s=0,o=n.length;s<o;s++){var r=n[s];if(r[0]===e&&r[1]===i)return r}},setId:function(t){if(!t)throw new Error("id not null");if(this._idSet)throw new Error("id just set only one");mini.unreg(this),this.id=t,this.el&&(this.el.id=t),this._valueEl&&(this._valueEl.id=t+"$value"),this._textEl&&(this._textEl.id=t+"$text"),this._idSet=!0,mini.reg(this)},getId:function(){return this.id},destroy:function(){mini.unreg(this),this.fire("destroy"),this._events={}}},mini.Control=function(t){mini.Control.superclass.constructor.apply(this,arguments),this._create(),this.el.uid=this.uid,this._initEvents(),this._clearBorder&&(this.el.style.borderWidth="0"),this.addCls(this.uiCls),this.setWidth(this.width),this.setHeight(this.height),this.el.style.display=this.visible?this._displayStyle:"none",t&&mini.applyTo.call(this,t)},mini.extend(mini.Control,mini.Component,{jsName:null,width:"",height:"",visible:!0,readOnly:!1,enabled:!0,tooltip:"",_readOnlyCls:"mini-readonly",_disabledCls:"mini-disabled",_create:function(){this.el=document.createElement("div")},_initEvents:function(){},within:function(t){return!!mini.isAncestor(this.el,t.target)},name:"",setName:function(t){this.name=t},getName:function(){return this.name},isAutoHeight:function(){var t=this.el.style.height;return"auto"==t||""==t},isAutoWidth:function(){var t=this.el.style.width;return"auto"==t||""==t},isFixedSize:function(){var t=this.width,e=this.height;return parseInt(t)+"px"==t&&parseInt(e)+"px"==e},isRender:function(t){return!!(this.el&&this.el.parentNode&&this.el.parentNode.tagName)},render:function(t,e){"string"==typeof t&&(t="#body"==t?document.body:mini.byId(t)),t&&("before"==(e=(e=e||"append").toLowerCase())?jQuery(t).before(this.el):"prepend"==e?jQuery(t).prepend(this.el):"after"==e?jQuery(t).after(this.el):t.appendChild(this.el),this.el.id=this.id,this.doLayout(),this.fire("render"))},getEl:function(){return this.el},setJsName:function(t){this.jsName=t,window[t]=this},getJsName:function(){return this.jsName},setTooltip:function(t){this.tooltip=t,this.el.title=t,this.tooltipPlacement&&jQuery(this.el).attr("data-placement",this.tooltipPlacement)},getTooltip:function(){return this.tooltip},_sizeChanged:function(){this.doLayout()},setWidth:function(t){parseInt(t)==t&&(t+="px"),this.width=t,this.el.style.width=t,this._sizeChanged()},getWidth:function(t){var e=this.el,i=t?jQuery(e).width():jQuery(e).outerWidth();if(t&&this._borderEl){var n=mini.getBorders(this._borderEl);i=i-n.left-n.right}return i},setHeight:function(t){parseInt(t)==t&&(t+="px"),this.height=t,this.el.style.height=t,this._sizeChanged()},getHeight:function(t){var e=t?jQuery(this.el).height():jQuery(this.el).outerHeight();if(t&&this._borderEl){var i=mini.getBorders(this._borderEl);e=e-i.top-i.bottom}return e},getBox:function(){return mini.getBox(this.el)},setBorderStyle:function(t){var e=this._borderEl||this.el;mini.setStyle(e,t),this.doLayout()},getBorderStyle:function(){return this.borderStyle},_clearBorder:!0,setStyle:function(t){this.style=t,mini.setStyle(this.el,t),this._clearBorder&&(this.el.style.borderWidth="0",this.el.style.padding="0px"),this.width=this.el.style.width,this.height=this.el.style.height,this._sizeChanged()},getStyle:function(){return this.style},setCls:function(t){this.addCls(t)},getCls:function(){return this.cls},addCls:function(t){mini.addClass(this.el,t)},removeCls:function(t){mini.removeClass(this.el,t)},_doReadOnly:function(){this.readOnly?this.addCls(this._readOnlyCls):this.removeCls(this._readOnlyCls)},setReadOnly:function(t){this.readOnly=t,this._doReadOnly()},getReadOnly:function(){return this.readOnly},getParent:function(t){for(var e=document,i=this.el.parentNode;i!=e&&null!=i;){var n=mini.get(i);if(n){if(!mini.isControl(n))return null;if(!t||n.uiCls==t)return n}i=i.parentNode}return null},isReadOnly:function(){if(this.readOnly||!this.enabled)return!0;var t=this.getParent();return!!t&&t.isReadOnly()},setEnabled:function(t){this.enabled=t,this.enabled?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),this._doReadOnly()},getEnabled:function(){return this.enabled},enable:function(){this.setEnabled(!0)},disable:function(){this.setEnabled(!1)},_displayStyle:"",setVisible:function(t){this.visible=t,this.el&&(this.el.style.display=t?this._displayStyle:"none",this.doLayout())},getVisible:function(){return this.visible},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},isDisplay:function(t){if(0==mini.WindowVisible||!this.el)return!1;for(var e=document.body,i=this.el;;){if(null==i||!i.style)return!1;if(i&&i.style&&"none"==i.style.display){if(!t)return!1;if(!0!==t(i))return!1}if(i==e)return!0;i=i.parentNode}return!0},_allowUpdate:!0,beginUpdate:function(){this._allowUpdate=!1},endUpdate:function(){this._allowUpdate=!0,this.doUpdate()},doUpdate:function(){},canLayout:function(){return!!mini.enableLayout&&(0!=this._allowLayout&&this.isDisplay())},doLayout:function(){},layoutChanged:function(){0!=this.canLayout()&&this.doLayout()},_destroyChildren:function(t){if(this.el)for(var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++){var s=e[i];!0!==s.destroyed&&s.destroy(t)}},destroy:function(t){if(!0!==this.destroyed&&(mini._destroying||this._destroyChildren(t)),this.el){var e=this.el;e.onclick=e.ondblclick=e.onmousedown=e.onmouseup=e.onmousemove=e.onmouseover=e.onmouseout=e.onkeydown=e.onkeyup=e.oncontextmenu=null,mini.clearEvent(e),!1!==t&&mini.removeNode(e)}this._borderEl=this._contentEl=this._valueEl=this._textEl=this._errorIconEl=null,this.el=null,mini.unreg(this),this.destroyed=!0,this.fire("destroy")},focus:function(){try{this.el.focus()}catch(t){}},blur:function(){try{this.el.blur()}catch(t){}},allowAnim:!0,setAllowAnim:function(t){this.allowAnim=t},getAllowAnim:function(){return this.allowAnim},_getMaskWrapEl:function(){return this.el},mask:function(t){"string"==typeof t&&(t={html:t}),(t=t||{}).el=this._getMaskWrapEl(),t.cls||(t.cls=this._maskCls),mini.mask(t)},unmask:function(){mini.unmask(this._getMaskWrapEl()),this.isLoading=!1},_maskCls:"mini-mask-loading",loadingMsg:"Loading...",loading:function(t){this.mask(t||this.loadingMsg)},setLoadingMsg:function(t){this.loadingMsg=t},getLoadingMsg:function(){return this.loadingMsg},_getContextMenu:function(t){var e=t;return"string"==typeof t?(e=mini.get(t))||(mini.parse(t),e=mini.get(t)):mini.isArray(t)?e={type:"menu",items:t}:mini.isControl(t)||(e=mini.create(t)),e},__OnHtmlContextMenu:function(t){var e={popupEl:this.el,htmlEvent:t,cancel:!1};if(this.contextMenu.fire("BeforeOpen",e),1!=e.cancel&&(this.contextMenu.fire("opening",e),1!=e.cancel))return this.contextMenu.showAtPos(t.pageX,t.pageY),this.contextMenu.fire("Open",e),!1},contextMenu:null,setContextMenu:function(t){var e=this._getContextMenu(t);e&&this.contextMenu!==e&&(this.contextMenu=e,mini.addClass(e.el,"mini-menu-open"),this.contextMenu.owner=this,mini.on(this.el,"contextmenu",this.__OnHtmlContextMenu,this))},getContextMenu:function(){return this.contextMenu},setDefaultValue:function(t){this.defaultValue=t},getDefaultValue:function(){return this.defaultValue},setValue:function(t){this.value=t},getValue:function(){return this.value},ajaxData:null,ajaxType:"",ajaxOptions:null,setAjaxOptions:function(t){this.ajaxOptions=t},getAjaxOptions:function(){return this.ajaxOptions},setAjaxData:function(t){this.ajaxData=t},getAjaxData:function(){return this.ajaxData},setAjaxType:function(t){this.ajaxType=t},getAjaxType:function(){return this.ajaxType},_afterApply:function(t){},dataField:"",setDataField:function(t){this.dataField=t},getDataField:function(){return this.dataField},tabIndex:0,setTabIndex:function(t){(this._textEl||this.el).tabIndex=t,this.tabIndex=t},getTabIndex:function(){return this.tabIndex},getAttrs:function(t){var e={},i=t.className;i&&(e.cls=i),t.value&&(e.value=t.value),mini._ParseString(t,e,["id","name","width","height","borderStyle","value","defaultValue","tabIndex","contextMenu","tooltip","ondestroy","data-options","ajaxData","ajaxType","dataField","ajaxOptions","data-placement"]),e["data-placement"]&&(this.tooltipPlacement=e["data-placement"]),mini._ParseBool(t,e,["visible","enabled","readOnly"]),t.readOnly&&"false"!=t.readOnly&&(e.readOnly=!0);var n=t.style.cssText;if(n&&(e.style=n),isIE9){var s=t.style.background;s&&(e.style||(e.style=""),e.style+=";background:"+s)}this.style&&(e.style?e.style=this.style+";"+e.style:e.style=this.style),this.borderStyle&&(e.borderStyle?e.borderStyle=this.borderStyle+";"+e.borderStyle:e.borderStyle=this.borderStyle),"string"==typeof e.ajaxOptions&&(e.ajaxOptions=window.eval("("+e.ajaxOptions+")"));var o=mini._attrs;if(o)for(var r=0,l=o.length;r<l;r++){var a=o[r],h=a[0],u=a[1];"string"==(u=u||"string")?mini._ParseString(t,e,[h]):"bool"==u?mini._ParseBool(t,e,[h]):"int"==u&&mini._ParseInt(t,e,[h])}var d=e["data-options"];return(d=d&&window.eval("("+d+")"))&&mini.copyTo(e,d),e}}),mini._attrs=null,mini.regHtmlAttr=function(t,e){t&&(e=e||"string",mini._attrs||(mini._attrs=[]),mini._attrs.push([t,e]))},__mini_setControls=function(t,e,i){e=e||this._contentEl,i=i||this,t=t||[],mini.isArray(t)||(t=[t]);for(var n=0,s=t.length;n<s;n++){var o=t[n];"string"==typeof o?0==o.indexOf("#")&&(o=mini.byId(o)):mini.isElement(o)||(o=(o=mini.getAndCreate(o)).el),o&&mini.append(e,o)}return mini.parse(e),i.doLayout(),i},mini.Container=function(){mini.Container.superclass.constructor.apply(this,arguments),this._contentEl||(this._contentEl=this.el)},mini.extend(mini.Container,mini.Control,{setControls:__mini_setControls,getContentEl:function(){return this._contentEl},getBodyEl:function(){return this._contentEl},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++){if(e[i].within(t))return!0}return!1}}),mini.ValidatorBase=function(){mini.ValidatorBase.superclass.constructor.apply(this,arguments)},mini.extend(mini.ValidatorBase,mini.Control,{required:!1,requiredErrorText:"This field is required.",_requiredCls:"mini-required",errorText:"",_errorCls:"mini-error",_invalidCls:"mini-invalid",errorMode:"icon",validateOnChanged:!0,validateOnLeave:!0,_IsValid:!0,forceValidate:!1,setForceValidate:function(t){this.forceValidate=t},getForceValidate:function(){return this.forceValidate},keyNavEnabled:!0,setKeyNavEnabled:function(t){this.keyNavEnabled=t},getKeyNavEnabled:function(){return this.keyNavEnabled},indentSpace:!1,_indentCls:"mini-indent",setIndentSpace:function(t){t?this.addCls(this._indentCls):this.removeCls(this._indentCls),this.indentSpace=t},getIndentSpace:function(){return this.indentSpace},isEditable:function(){return!(this.readOnly||!this.allowInput||!this.enabled)},_tryValidate:function(){this._tryValidateTimer&&clearTimeout(this._tryValidateTimer);var t=this;this._tryValidateTimer=setTimeout(function(){t.validate()},30)},validate:function(){var t={value:this.getValue(),errorText:"",isValid:!0};return this.required&&(!mini.isNull(t.value)&&""!==String(t.value).trim()||(t.isValid=!1,t.errorText=this.requiredErrorText)),this.fire("validation",t),this.errorText=t.errorText,this.setIsValid(t.isValid),this.isValid()},isValid:function(){return this._IsValid},setIsValid:function(t){this._IsValid=t,this.doUpdateValid()},getIsValid:function(){return this._IsValid},setValidateOnChanged:function(t){this.validateOnChanged=t},getValidateOnChanged:function(t){return this.validateOnChanged},setValidateOnLeave:function(t){this.validateOnLeave=t},getValidateOnLeave:function(t){return this.validateOnLeave},setErrorMode:function(t){t=t||"none",this.errorMode=t.toLowerCase(),0==this._IsValid&&this.doUpdateValid()},getErrorMode:function(){return this.errorMode},setErrorText:function(t){this.errorText=t,0==this._IsValid&&this.doUpdateValid()},getErrorText:function(){return this.errorText},setRequired:function(t){this.required=t,this.required?this.addCls(this._requiredCls):this.removeCls(this._requiredCls)},getRequired:function(){return this.required},setRequiredErrorText:function(t){this.requiredErrorText=t},getRequiredErrorText:function(){return this.requiredErrorText},errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl},_RemoveErrorIcon:function(){},doUpdateValid:function(){this.__doUpdateValid()},errorTooltipPlacement:"right",__doUpdateValid:function(){if(this.el){if(this.removeCls(this._errorCls),this.removeCls(this._invalidCls),"border"==this.errorMode&&(this.el.title=""),0==this._IsValid)switch(this.errorMode){case"icon":this.addCls(this._errorCls);var t=this.getErrorIconEl();t&&(t.title=this.errorText,jQuery(t).attr("data-placement",this.errorTooltipPlacement));break;case"border":this.addCls(this._invalidCls),this.el.title=this.errorText;default:this._RemoveErrorIcon()}else this._RemoveErrorIcon();this.doLayout()}},doValueChanged:function(){this._OnValueChanged()},_OnValueChanged:function(){this.validateOnChanged&&this._tryValidate(),this.fire("valuechanged",{value:this.getValue(),oldValue:this._oldValue}),this._oldValue=this.getValue()},onValueChanged:function(t,e){this.on("valuechanged",t,e)},onValidation:function(t,e){this.on("validation",t,e)},getAttrs:function(t){var e=mini.ValidatorBase.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["onvaluechanged","onvalidation","label","labelStyle","requiredErrorText","errorMode","errorTooltipPlacement"]),mini._ParseBool(t,e,["validateOnChanged","validateOnLeave","labelField","indentSpace","keyNavEnabled","forceValidate"]);var i=t.getAttribute("required");if(!(i=i||t.required)){var n=t.attributes.required;n&&(i="null"==n.value?null:"true")}return i&&(e.required="false"!=i),e},_labelLayout:function(){var t=this._borderEl;if(t)if(this._labelLayouted=!0,this.labelField){var e=this._labelEl.offsetWidth;t.style.marginLeft=e+"px",this._doLabelLayout=0===e}else t.style.marginLeft=0},_labelFieldCls:"mini-labelfield",labelField:!1,label:"",labelStyle:"",setLabelField:function(t){if(this.labelField!=t){if(this.labelField=t,!this._borderEl)return;this._labelEl||(this._labelEl=mini.append(this.el,'<label class="mini-labelfield-label"></label>'),this._labelEl.innerHTML=this.label,mini.setStyle(this._labelEl,this.labelStyle)),this._labelEl.style.display=t?"block":"none",t?mini.addClass(this.el,this._labelFieldCls):mini.removeClass(this.el,this._labelFieldCls),this._labelLayout()}},getLabelField:function(){this.labelField},setLabel:function(t){this.label!=t&&(this.label=t,this._labelEl&&(this._labelEl.innerHTML=t),this._labelLayout())},getLabel:function(){this.label},setLabelStyle:function(t){this.labelStyle!=t&&(this.labelStyle=t,this._labelEl&&mini.setStyle(this._labelEl,t),this._labelLayout())},getLabelStyle:function(){this.labelStyle}}),mini.ListControl=function(t){this.data=[],this._selecteds=[],mini.ListControl.superclass.constructor.call(this,null),this.doUpdate(),t&&mini.applyTo.call(this,t)},mini.ListControl.ajaxType="get",mini.extend(mini.ListControl,mini.ValidatorBase,{defaultValue:"",value:"",valueField:"id",textField:"text",dataField:"",delimiter:",",setDelimiter:function(t){this.delimiter=t},getDelimiter:function(){return this.delimiter},data:null,url:"",valueInCheckOrder:!0,setValueInCheckOrder:function(t){this.valueInCheckOrder=t},getValueInCheckOrder:function(){return this.valueInCheckOrder},_itemCls:"mini-list-item",_itemHoverCls:"mini-list-item-hover",_itemSelectedCls:"mini-list-item-selected",doLayout:function(){this._doLabelLayout&&this._labelLayout()},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.url;delete t.url;var n=t.data;return delete t.data,mini.ListControl.superclass.set.call(this,t),mini.isNull(n)||this.setData(n),mini.isNull(i)||this.setUrl(i),mini.isNull(e)||this.setValue(e),this},uiCls:"mini-list",_create:function(){},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"click",this.__OnClick,this),mini_onOne(this.el,"dblclick",this.__OnDblClick,this),mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"mouseup",this.__OnMouseUp,this),mini_onOne(this.el,"mousemove",this.__OnMouseMove,this),mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this),mini_onOne(this.el,"keydown",this.__OnKeyDown,this),mini_onOne(this.el,"keyup",this.__OnKeyUp,this),mini_onOne(this.el,"contextmenu",this.__OnContextMenu,this)},this)},destroy:function(t){mini.ListControl.superclass.destroy.call(this,t)},name:"",setName:function(t){this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name)},getItemByEvent:function(t){var e=mini.findParent(t.target,this._itemCls);if(e){var i=parseInt(mini.getAttr(e,"index"));return this.data[i]}},addItemCls:function(t,e){var i=this.getItemEl(t);i&&mini.addClass(i,e)},removeItemCls:function(t,e){var i=this.getItemEl(t);i&&mini.removeClass(i,e)},getItemEl:function(t){t=this.getItem(t);var e=this.data.indexOf(t),i=this._createItemId(e);return document.getElementById(i)},_focusItem:function(t,e){if(t=this.getItem(t)){var i=this.getItemEl(t);e&&i&&this.scrollIntoView(t),this._focusedItem!=t&&(this._blurItem(),this._focusedItem=t),i&&mini.addClass(i,this._itemHoverCls)}},_blurItem:function(){if(this._focusedItem){var t=this.getItemEl(this._focusedItem);t&&mini.removeClass(t,this._itemHoverCls),this._focusedItem=null}},getFocusedItem:function(){var t=this._focusedItem;return-1==this.indexOf(t)?null:t},getFocusedIndex:function(){return this.data.indexOf(this._focusedItem)},_scrollViewEl:null,scrollIntoView:function(t){try{var e=this.getItemEl(t),i=this._scrollViewEl||this.el;mini.scrollIntoView(e,i,!1)}catch(t){}},getItem:function(t){return"object"==typeof t?t:"number"==typeof t?this.data[t]:this.findItems(t)[0]},getCount:function(){return this.data.length},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},updateItem:function(t,e){(t=this.getItem(t))&&(mini.copyTo(t,e),this.doUpdate())},load:function(t){"string"==typeof t?this.setUrl(t):this.setData(t)},loadData:function(t){this.setData(t)},setData:function(t){if("string"==typeof t&&(t=window.eval(t)),mini.isArray(t)||(t=[]),this.data=t,this.doUpdate(),""!=this.value){this.deselectAll();var e=this.findItems(this.value);this.selects(e)}},getData:function(){return this.data.clone()},setUrl:function(t){this.url=t,this._doLoad({})},getUrl:function(){return this.url},ajaxData:null,_doLoad:function(t){try{null!=(r=window.eval(this.url))&&(this.url=r)}catch(l){}var r=this.url,e=mini.ListControl.ajaxType;r&&(-1==r.indexOf(".txt")&&-1==r.indexOf(".json")||(e="get"));var i=mini._evalAjaxData(this.ajaxData,this);mini.copyTo(t,i);var l={url:this.url,async:!1,type:this.ajaxType?this.ajaxType:e,data:t,params:t,cache:!1,cancel:!1};if(jQuery.extend(!0,l,this.ajaxOptions),this.fire("beforeload",l),l.data!=l.params&&l.params!=t&&(l.data=l.params),1!=l.cancel){var a=me=this;r=l.url;mini.copyTo(l,{success:function(t,e,i){delete l.params;var n={text:t,result:null,sender:me,options:l,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(o){1==mini_debugger&&alert(r+"\njson is error.")}mini.isArray(s)&&(s={data:s}),a.dataField&&(s.data=mini._getMap(a.dataField,s)),s.data||(s.data=[]);var o={data:s.data,cancel:!1,result:s};a.fire("preload",o),1!=o.cancel&&(a.setData(o.data),delete o.cancel,a.fire("load",o),setTimeout(function(){a.doLayout()},100))},error:function(t,e,i){var n={xhr:t,text:t.responseText,textStatus:e,errorMsg:t.responseText,errorCode:t.status};1==mini_debugger&&alert(r+"\n"+n.errorCode+"\n"+n.errorMsg),a.fire("loaderror",n)}}),this._ajaxer=mini.ajax(l)}},setValue:function(t){mini.isNull(t)&&(t=""),this.deselectAll(),this.value=t,this._valueEl&&(this._valueEl.value=t);var e=this.findItems(this.value);this.selects(e),this.setSelected(e[0])},getValue:function(){return this.value},getFormValue:function(){return this.value},setValueField:function(t){this.valueField=t},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},getItemValue:function(t){return String(mini._getMap(this.valueField,t))},getItemText:function(t){var e=mini._getMap(this.textField,t);return mini.isNull(e)?"":String(e)},getValueAndText:function(t){if(mini.isNull(t)&&(t=[]),mini.isArray(t)||(t=this.findItems(t)),this.valueInCheckOrder){var s=this.getData();mini.sort(t,function(t,e){var i=s.indexOf(t),n=s.indexOf(e);return n<i?1:i<n?-1:0})}for(var e=[],i=[],n=0,o=t.length;n<o;n++){var r=t[n];r&&(e.push(this.getItemValue(r)),i.push(this.getItemText(r)))}return[e.join(this.delimiter),i.join(this.delimiter)]},findItems:function(t){if(mini.isNull(t)||""===t)return[];if("function"==typeof t){for(var e=t,i=[],n=0,s=(o=this.data).length;n<s;n++){!0===e(a=o[n],n)&&i.push(a)}return i}var o,r=String(t).split(this.delimiter),l={};for(n=0,s=(o=this.data).length;n<s;n++){var a=o[n];l[mini._getMap(this.valueField,a)]=a}for(var h=[],u=0,d=r.length;u<d;u++){(a=l[r[u]])&&h.push(a)}return h},removeAll:function(){var t=this.getData();this.removeItems(t)},addItems:function(t,e){mini.isArray(t)&&(mini.isNull(e)&&(e=this.data.length),this.data.insertRange(e,t),this.doUpdate())},addItem:function(t,e){t&&-1==this.data.indexOf(t)&&(mini.isNull(e)&&(e=this.data.length),this.data.insert(e,t),this.doUpdate())},removeItems:function(t){mini.isArray(t)&&(this.data.removeRange(t),this._checkSelecteds(),this.doUpdate())},removeItem:function(t){var e=this.data.indexOf(t);-1!=e&&(this.data.removeAt(e),this._checkSelecteds(),this.doUpdate())},moveItem:function(t,e){t&&mini.isNumber(e)&&(e<0&&(e=0),e>this.data.length&&(e=this.data.length),this.data.remove(t),this.data.insert(e,t),this.doUpdate())},_isSelectedAll:function(){for(var t=this.getData(),e=0,i=t.length;e<i;e++){var n=t[e];if(!1!==n.enabled&&!this.isSelected(n))return!1}return!0},_selected:null,_selecteds:[],multiSelect:!1,_checkSelecteds:function(){for(var t=this._selecteds.length-1;0<=t;t--){var e=this._selecteds[t];-1==this.data.indexOf(e)&&this._selecteds.removeAt(t)}this._selected&&-1==this.data.indexOf(this._selected)&&(this._selected=null);var i=this.getValueAndText(this._selecteds);this.value=i[0],this._valueEl&&(this._valueEl.value=this.value)},setMultiSelect:function(t){this.multiSelect=t},getMultiSelect:function(){return this.multiSelect},isSelected:function(t){return!!t&&-1!=this._selecteds.indexOf(t)},getSelecteds:function(){var t=this._selecteds.clone(),s=this;return this.valueInCheckOrder&&mini.sort(t,function(t,e){var i=s.indexOf(t),n=s.indexOf(e);return n<i?1:i<n?-1:0}),t},setSelected:function(t){t&&(this._selected=t,this.select(t))},getSelected:function(){return this._selected},select:function(t){(t=this.getItem(t))&&(this.isSelected(t)||(this._selected=t,this.selects([t])))},deselect:function(t){(t=this.getItem(t))&&this.isSelected(t)&&this.deselects([t])},selectAll:function(){var t=this.data.clone();this.selects(t)},deselectAll:function(){this.deselects(this._selecteds)},clearSelect:function(){this.deselectAll()},selects:function(t){if(t&&0!=t.length){t=t.clone(),0==this.multiSelect&&1<t.length&&(t.length=1);for(var e=0,i=t.length;e<i;e++){var n=t[e];this.isSelected(n)||this._selecteds.push(n)}this._doSelects()}},deselects:function(t){if(t&&0!=t.length){for(var e=(t=t.clone()).length-1;0<=e;e--){var i=t[e];this.isSelected(i)&&this._selecteds.remove(i)}this._doSelects()}},_doSelects:function(){var t=this.getValueAndText(this._selecteds);this.value=t[0],this._valueEl&&(this._valueEl.value=this.value);for(var e=0,i=this.data.length;e<i;e++){var n=this.data[e],s=this.isSelected(n);s?this.addItemCls(n,this._itemSelectedCls):this.removeItemCls(n,this._itemSelectedCls);var o=this.data.indexOf(n),r=this._createCheckId(o),l=mini.byId(r,this.el);l&&(l.checked=!!s)}},_OnSelectionChanged:function(t,e){var i=this.getValueAndText(this._selecteds);this.value=i[0],this._valueEl&&(this._valueEl.value=this.value);var n={selecteds:this.getSelecteds(),selected:this.getSelected(),value:this.getValue()};this.fire("SelectionChanged",n)},_createCheckId:function(t){return this.uid+"$ck$"+t},_createItemId:function(t){return this.uid+"$"+t},__OnClick:function(t){this._clickTime&&new Date-this._clickTime<100||(this._clickTime=new Date,this._fireEvent(t,"Click"))},__OnDblClick:function(t){this._fireEvent(t,"Dblclick")},__OnMouseDown:function(t){this._fireEvent(t,"MouseDown")},__OnMouseUp:function(t){this._fireEvent(t,"MouseUp")},__OnMouseMove:function(t){this._fireEvent(t,"MouseMove")},__OnMouseOver:function(t){this._fireEvent(t,"MouseOver")},__OnMouseOut:function(t){this._fireEvent(t,"MouseOut")},__OnKeyDown:function(t){this._fireEvent(t,"KeyDown")},__OnKeyUp:function(t){this._fireEvent(t,"KeyUp")},__OnContextMenu:function(t){this._fireEvent(t,"ContextMenu")},_fireEvent:function(t,e){if(this.enabled){var i=this.getItemByEvent(t);if(i){var n=this["_OnItem"+e];if(n)n.call(this,i,t);else{var s={item:i,htmlEvent:t};this.fire("item"+e,s)}}}},allowDeselect:!1,setAllowDeselect:function(t){this.allowDeselect=t},getAllowDeselect:function(){return this.allowDeselect},_OnItemClick:function(t,e){if(this.isReadOnly()||0==this.enabled||!1===t.enabled)e.preventDefault();else{var i=this.getValue(),n={item:t,htmlEvent:e,cancel:!1};this.fire("beforeselect",n);e={item:t,htmlEvent:e,cancel:!1};if(this.fire("beforeitemclick",e),!e.cancel){0==n.cancel&&(this._oldValue=i,this.multiSelect?(this.isSelected(t)?(this.deselect(t),this._selected==t&&(this._selected=null)):(this.select(t),this._selected=t),t.__NullItem&&(this.deselectAll(),this._selected=null),this._OnSelectionChanged()):this.isSelected(t)?this.allowDeselect&&0==this.multiSelect&&(this.deselectAll(),this._OnSelectionChanged()):(this.deselectAll(),this.select(t),this._selected=t,this._OnSelectionChanged()),i!=this.getValue()&&this._OnValueChanged());e={item:t,htmlEvent:e};this.fire("itemclick",e)}}},_blurOnOut:!0,_OnItemMouseOut:function(t,e){if(this.enabled){this._blurOnOut&&this._blurItem();e={item:t,htmlEvent:e};this.fire("itemmouseout",e)}},_OnItemMouseMove:function(t,e){if(this.enabled&&!1!==t.enabled){this._focusItem(t);e={item:t,htmlEvent:e};this.fire("itemmousemove",e)}},onItemClick:function(t,e){this.on("itemclick",t,e)},onItemMouseDown:function(t,e){this.on("itemmousedown",t,e)},onBeforeLoad:function(t,e){this.on("beforeload",t,e)},onLoad:function(t,e){this.on("load",t,e)},onLoadError:function(t,e){this.on("loaderror",t,e)},onPreLoad:function(t,e){this.on("preload",t,e)},getText:function(){var t=this.getSelecteds();if(0==t.length)return"";for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i],o=this.getTextField();e.push(s[o])}return e.join(",")},getAttrs:function(t){var e=mini.ListControl.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["url","data","value","textField","valueField","onitemclick","onitemmousemove","onselectionchanged","onitemdblclick","onbeforeload","onload","onloaderror","ondataload","onbeforeselect","delimiter"]),mini._ParseBool(t,e,["multiSelect","valueInCheckOrder","allowDeselect"]);var i=e.valueField||this.valueField,n=e.textField||this.textField;if("select"==t.nodeName.toLowerCase()){for(var s=[],o=0,r=t.length;o<r;o++){var l=t.options[o],a={};a[n]=l.text,a[i]=l.value,s.push(a)}0<s.length&&(e.data=s)}return e}}),mini._Layouts={},mini.layout=function(t,l){mini.enableLayout&&document.body&&(function t(e){if(e){var i=mini.get(e);if(i)i.doLayout&&(mini._Layouts[i.uid]||(mini._Layouts[i.uid]=i,!1===l&&0!=i.isFixedSize()||i.doLayout(!1),delete mini._Layouts[i.uid]));else{var n=e.childNodes;if(n)for(var s=0,o=n.length;s<o;s++){var r=n[s];try{r.toString()}catch(t){continue}t(r)}}}}(t=t||document.body),t==document.body&&mini.layoutIFrames())},mini.applyTo=function(t){if(!(t=mini.byId(t)))return this;if(mini.get(t))throw new Error("not applyTo a mini control");var e=this.getAttrs(t);delete e._applyTo,mini.isNull(e.defaultValue)&&!mini.isNull(e.value)&&(e.defaultValue=e.value),mini.isNull(e.defaultText)&&!mini.isNull(e.text)&&(e.defaultText=e.text);var i=t.parentNode;return i&&this.el!=t&&i.replaceChild(this.el,t),window._mini_set&&_mini_set(e,this),this.set(e),this._afterApply(t),this},mini._doParse=function(t){if(t){var e=t.nodeName.toLowerCase();if(e&&null==jQuery(t).attr("noparser")){var i=String(t.className);if(i)if(!mini.get(t))for(var n=i.split(" "),s=0,o=n.length;s<o;s++){var r=n[s],l=mini.getClassByUICls(r);if(l){mini.removeClass(t,r);var a=new l;mini.applyTo.call(a,t),t=a.el;break}}if(!("select"==e||mini.hasClass(t,"mini-menu")||mini.hasClass(t,"mini-datagrid")||mini.hasClass(t,"mini-treegrid")||mini.hasClass(t,"mini-tree")||mini.hasClass(t,"mini-button")||mini.hasClass(t,"mini-textbox")||mini.hasClass(t,"mini-buttonedit"))){var h=mini.getChildNodes(t,!0);for(s=0,o=h.length;s<o;s++){var u=h[s];1==u.nodeType&&u.parentNode==t&&mini._doParse(u)}}}}},mini._Removes=[],mini._firstParse=!0,mini.parse=function(t,e){if(mini.parsed=!0,mini._firstParse){mini._firstParse=!1;for(var i=document.getElementsByTagName("iframe"),s=[],n=0,o=i.length;n<o;n++){var r=i[n];s.push(r)}for(n=0,o=s.length;n<o;n++){r=s[n];var l=jQuery(r).attr("src");l&&(r.loaded=!1,r._onload=r.onload,r._src=l,r.onload=function(){},r.src="")}setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t];i._src&&""==jQuery(i).attr("src")&&(i.loaded=!0,i.onload=i._onload,i.src=i._src,i._src=i._onload=null)}},20),setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t],n=jQuery(i).attr("data-src");n&&(i.src=n)}},30)}if("string"==typeof t){var a=t;t=(t=mini.byId(a))||document.body}t&&!mini.isElement(t)&&(t=t.el),t=t||document.body;var h=mini.WindowVisible;isIE&&(mini.WindowVisible=!1),mini._doParse(t),mini.WindowVisible=h,!1!==e&&mini.layout(t)},mini._ParseString=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],r=mini.getAttr(t,o);r&&(e[o]=r)}},mini._ParseBool=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],r=mini.getAttr(t,o);r&&(e[o]="true"==r)}},mini._ParseInt=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],r=parseInt(mini.getAttr(t,o));isNaN(r)||(e[o]=r)}},mini._ParseColumns=function(t){for(var e=[],i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],r={},l=null,a=null,h=mini.getChildNodes(o);if(h)for(var u=0,d=h.length;u<d;u++){var c=h[u],m=mini.getAttr(c,"property");if(m&&("columns"==(m=m.toLowerCase())&&(r.columns=mini._ParseColumns(c),c.parentNode&&c.parentNode.removeChild(c)),"editor"==m||"filter"==m)){for(var f=c.className.split(" "),p=0,g=f.length;p<g;p++){var _=f[p],v=mini.getClassByUICls(_);if(v){var w=new v;"filter"==m?(a=w.getAttrs(c)).type=w.type:(l=w.getAttrs(c)).type=w.type;break}}c.parentNode&&c.parentNode.removeChild(c)}}if(r.header=o.innerHTML,mini._ParseString(o,r,["name","header","field","editor","filter","renderer","width","type","renderer","headerAlign","align","headerCls","cellCls","headerStyle","cellStyle","displayField","dateFormat","listFormat","mapFormat","numberFormat","trueValue","falseValue","dataType","vtype","currencyUnit","summaryType","summaryRenderer","groupSummaryType","groupSummaryRenderer","defaultValue","defaultText","decimalPlaces","data-options","sortField","sortType"]),mini._ParseBool(o,r,["allowCellWrap","visible","readOnly","allowSort","allowResize","allowMove","allowDrag","autoShowPopup","unique","autoEscape","enabled","hideable","showCellTip","valueFromSelect","navUpdown"]),mini._ParseInt(o,r,["minWidth"]),l&&(r.editor=l),a&&(r.filter=a),"string"==typeof r.editor)try{r.editor=window.eval("("+r.editor+")")}catch(t){}r.dataType&&(r.dataType=r.dataType.toLowerCase()),"true"===r.defaultValue&&(r.defaultValue=!0),"false"===r.defaultValue&&(r.defaultValue=!1),e.push(r);var y=r["data-options"];(y=y&&window.eval("("+y+")"))&&mini.copyTo(r,y)}return e},mini._Columns={},mini._getColumn=function(t){var e=mini._Columns[t.toLowerCase()];return e?e():{}},mini.IndexColumn=function(t){return mini.copyTo({ignoreCollapseIndex:!1,width:30,cellCls:"",align:"center",draggable:!1,allowDrag:!0,hideable:!0,init:function(t){t.on("addrow",this.__OnIndexChanged,this),t.on("removerow",this.__OnIndexChanged,this),t.on("moverow",this.__OnIndexChanged,this),t.isTree&&(t.on("addnode",this.__OnIndexChanged,this),t.on("removenode",this.__OnIndexChanged,this),t.on("movenode",this.__OnIndexChanged,this),t.on("loadnode",this.__OnIndexChanged,this),this._gridUID=t.uid,this._rowIdField="_id")},getNumberId:function(t){return this._gridUID+"$number$"+t[this._rowIdField]},createNumber:function(t,e){return mini.isNull(t.pageIndex)?e+1:t.pageIndex*t.pageSize+e+1},renderer:function(t){var e=t.sender;this.draggable&&(t.cellStyle||(t.cellStyle=""),t.cellStyle+=";cursor:move;");var i='<div id="'+this.getNumberId(t.record)+'">',n=t.rowIndex;return this.ignoreCollapseIndex,mini.isNull(e.getPageIndex)?i+=n+1:i+=e.getPageIndex()*e.getPageSize()+n+1,i+="</div>"},__updateRowNumbers:function(t){for(var e=t.getDataView(),i=0,n=e.length;i<n;i++){var s=e[i],o=this.getNumberId(s),r=document.getElementById(o);r&&(r.innerHTML=this.createNumber(t,i))}},__OnIndexChanged:function(t){var e=t.sender,i=this;i._toIndex||(i._toIndex=setTimeout(function(){i._toIndex=null,i.__updateRowNumbers(e)},10))}},t)},mini._Columns.indexcolumn=mini.IndexColumn,mini.CheckColumn=function(t){return mini.copyTo({width:30,cellCls:"mini-checkcolumn",headerCls:"mini-checkcolumn",hideable:!0,_multiRowSelect:!0,header:function(t){var e=this.uid+"checkall",i='<span class="mini-grid-checkbox mini-icon '+(t._checkedAll?"mini-grid-checkbox-checked":"")+'" id="'+e+'"></span>';return 0==this.multiSelect&&(i=""),i},getCheckId:function(t,e){return this._gridUID+"$checkcolumn$"+t[this._rowIdField]+"$"+e._id},init:function(t){t.on("_selectchange",this.__OnSelectionChanged,this),t.on("HeaderCellClick",this.__OnHeaderCellClick,this);var e=this;t.on("removerow",function(){t.data&&0==t.data.length&&e._doCheckState(t)});e=this;t.on("load",function(){t.uid;e._doCheckState(t)},this)},renderer:function(t){var e=this.getCheckId(t.record,t.column);t.sender.isSelected&&t.sender.isSelected(t.record);return'<span class="mini-grid-'+(t.sender.getMultiSelect()?"checkbox":"radio")+' mini-icon" id="'+e+'"></span>'},__OnHeaderCellClick:function(t){var e=t.sender;if(t.column==this){var i=e.uid+"checkall",n=document.getElementById(i);if(n){var s="mini-grid-checkbox-checked",o=!mini.hasClass(n,s);if(this._checkedAll=o,e.getMultiSelect())if(o){var r=e.getDataView();e.selects(r),mini.addClass(n,s),setTimeout(function(){mini.addClass(n,s)},30)}else{r=e.getDataView();e.deselects(r),mini.removeClass(n,s)}else e.deselectAll(),o&&(e.select(0),mini.addClass(n,s));e.fire("checkall")}}},__OnSelectionChanged:function(t){var e=t.sender,i=e.toArray(),n=this,s=e.isVirtualScroll(),o=e._viewRegion,r=s&&o?o.start:-1,l=o?o.end:-1,a={};if(-1!=r)for(var h=e.getVisibleRows(),u=r,d=l;u<d;u++){var c=h[u];c&&(a[c._id]=!0)}for(u=0,d=i.length;u<d;u++){var m=i[u];-1==r||a[m._id]}this._timer||(this._timer=setTimeout(function(){n._doCheckState(e),n._timer=null},10))},_doCheckState:function(t){var e=t.uid+"checkall",i=document.getElementById(e);if(i){var n=t.getSelecteds(),s=t.isTree?t.getList().length:t.getData().length;n.length==s&&0!=s?jQuery(i).addClass("mini-grid-checkbox-checked"):jQuery(i).removeClass("mini-grid-checkbox-checked")}}},t)},mini._Columns.checkcolumn=mini.CheckColumn,mini.ExpandColumn=function(t){return mini.copyTo({width:30,headerAlign:"center",align:"center",draggable:!1,cellStyle:"padding:0",cellCls:"mini-grid-expandCell",hideable:!0,renderer:function(t){return'<a class="mini-grid-ecIcon mini-icon" href="javascript:#" onclick="return false"></a>'},init:function(t){t.on("cellclick",this.__OnCellClick,this)},__OnCellClick:function(t){var e=t.sender;if(t.column==this&&e.isShowRowDetail&&mini.findParent(t.htmlEvent.target,"mini-grid-ecIcon")){var i=e.isShowRowDetail(t.record);if(i){if(t.cancel=!1,e.fire("beforehiderowdetail",t),!0===t.cancel)return}else if(t.cancel=!1,e.fire("beforeshowrowdetail",t),!0===t.cancel)return;e.autoHideRowDetail&&e.hideAllRowDetail(),i?e.hideRowDetail(t.record):e.showRowDetail(t.record)}}},t)},mini._Columns.expandcolumn=mini.ExpandColumn,mini.CheckBoxColumn=function(t){return mini.copyTo({_type:"checkboxcolumn",editMode:"inline",header:"",headerAlign:"center",trueValue:!0,falseValue:!1,readOnly:!1,getCheckId:function(t,e){return this._gridUID+"$checkbox$"+t[this._rowIdField]+"$"+e._id},getCheckBoxEl:function(t,e){return document.getElementById(this.getCheckId(t,e))},isChecked:function(t,e){var i=this.getCheckBoxEl(t,e);return jQuery(i).hasClass("mini-grid-checkbox-checked")},renderer:function(t){return'<span  id="'+this.getCheckId(t.record,t.column)+'" class="mini-grid-checkbox mini-icon '+(mini._getMap(t.field,t.record)==this.trueValue?"mini-grid-checkbox-checked":"")+'"></span>'},init:function(n){function s(t){if(!n.isReadOnly()&&!this.readOnly&&(t.value=mini._getMap(t.field,t.record),n.fire("cellbeginedit",t),!0!==t.cancel)){var e=mini._getMap(t.column.field,t.record)==this.trueValue?this.falseValue:this.trueValue;n._OnCellCommitEdit&&(n._OnCellCommitEdit(t.record,t.column,e),n._OnCellEndEdit(t.record,t.column))}}(this.grid=n).on("cellclick",function(t){if(t.column==this){var e=this.getCheckId(t.record,t.column),i=t.htmlEvent.target;if(i.id==e)if(n.allowCellEdit)t.cancel=!1,s.call(this,t);else{if(this.readOnly)return;if(t.value=mini._getMap(t.column.field,t.record),n.fire("cellbeginedit",t),1==t.cancel)return;n.isEditingRow&&n.isEditingRow(t.record)&&setTimeout(function(){jQuery(i).toggleClass("mini-grid-checkbox-checked")},1)}}},this),mini.on(this.grid.el,"keydown",function(t){if(32==t.keyCode&&n.allowCellEdit){var e=n.getCurrentCell();if(!e)return;if(e[1]!=this)return;var i={record:e[0],column:e[1]};i.field=i.column.field,s.call(this,i),t.preventDefault()}},this);var t=parseInt(this.trueValue),e=parseInt(this.falseValue);isNaN(t)||(this.trueValue=t),isNaN(e)||(this.falseValue=e),"true"==this.trueValue&&(this.trueValue=!0),"false"==this.falseValue&&(this.falseValue=!1)}},t)},mini._Columns.checkboxcolumn=mini.CheckBoxColumn,mini.RadioButtonColumn=function(t){return mini.copyTo({_type:"radiobuttoncolumn",editMode:"inline",header:"",headerAlign:"center",trueValue:!0,falseValue:!1,readOnly:!1,getCheckId:function(t,e){return this._gridUID+"$radio$"+t[this._rowIdField]+"$"+e._id},getCheckBoxEl:function(t,e){return document.getElementById(this.getCheckId(t,e))},renderer:function(t){var e=t.sender,i=this.getCheckId(t.record,t.column),n=mini._getMap(t.field,t.record)==this.trueValue;e._id,t.column.field;return'<span id="'+i+'" class="mini-grid-radio '+(n?"mini-grid-radio-checked":"")+'"></span>'},init:function(u){function n(t){if(!u.isReadOnly()&&!this.readOnly&&(t.value=mini._getMap(t.field,t.record),u.fire("cellbeginedit",t),!0!==t.cancel)){if((o=mini._getMap(t.column.field,t.record))==this.trueValue)return;for(var e=o==this.trueValue?this.falseValue:this.trueValue,i=u.getData(),n=0,s=i.length;n<s;n++){var o,r=i[n];if(r!=t.record)(o=mini._getMap(t.column.field,r))!=this.falseValue&&u.updateRow(r,t.column.field,this.falseValue)}u._OnCellCommitEdit&&(u._OnCellCommitEdit(t.record,t.column,e),u._OnCellEndEdit(t.record,t.column))}}(this.grid=u).on("cellclick",function(l){if(l.column==this){var t=this.getCheckId(l.record,l.column),a=l.htmlEvent.target;if(a.id==t)if(u.allowCellEdit)l.cancel=!1,n.call(this,l);else if(u.isEditingRow&&u.isEditingRow(l.record)){var h=this;setTimeout(function(){a.checked=!0;for(var t=u.getData(),e=0,i=t.length;e<i;e++){var n=t[e];if(n!=l.record){var s=l.column.field,o=mini._getMap(s,n);if(o!=h.falseValue&&n!=l.record)if(u._dataSource)mini._setMap(l.column.field,h.falseValue,n),u._dataSource._setModified(n,s,o);else{var r={};mini._setMap(s,h.falseValue,r),u._doUpdateRow(n,r)}}}},1)}}},this),mini.on(this.grid.el,"keydown",function(t){if(32==t.keyCode&&u.allowCellEdit){var e=u.getCurrentCell();if(!e)return;if(e[1]!=this)return;var i={record:e[0],column:e[1]};i.field=i.column.field,n.call(this,i),t.preventDefault()}},this);var t=parseInt(this.trueValue),e=parseInt(this.falseValue);isNaN(t)||(this.trueValue=t),isNaN(e)||(this.falseValue=e)}},t)},mini._Columns.radiobuttoncolumn=mini.RadioButtonColumn,mini.ComboBoxColumn=function(t){return mini.copyTo({renderer:listColumnRenderer},t)},mini._Columns.comboboxcolumn=mini.ComboBoxColumn,mini.TreeSelectColumn=function(t){return mini.copyTo({renderer:listColumnRenderer},t)},mini._Columns.treeselectcolumn=mini.TreeSelectColumn,mini._Resizer=function(t){this.owner=t,mini.on(this.owner.el,"mousedown",this.__OnMouseDown,this)},mini._Resizer.prototype={__OnMouseDown:function(t){mini.hasClass(t.target,"mini-resizer-trigger")&&this.owner.allowResize&&this._getResizeDrag().start(t)},_getResizeDrag:function(){return this._resizeDragger||(this._resizeDragger=new mini.Drag({capture:!0,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this._resizeDragger},_OnDragStart:function(t){this.mask=mini.append(document.body,'<div class="mini-resizer-mask mini-fixed"></div>'),this.proxy=mini.append(document.body,'<div class="mini-resizer-proxy"></div>'),this.proxy.style.cursor="se-resize";var e=this.owner.el;e.offsetWidth,this.elBox=mini.getBox(e),mini.setBox(this.proxy,this.elBox)},_OnDragMove:function(t){var e=this.owner,i=t.now[0]-t.init[0],n=t.now[1]-t.init[1],s=this.elBox.width+i,o=this.elBox.height+n;s<e.minWidth&&(s=e.minWidth),o<e.minHeight&&(o=e.minHeight),s>e.maxWidth&&(s=e.maxWidth),o>e.maxHeight&&(o=e.maxHeight),mini.setSize(this.proxy,s,o)},_OnDragStop:function(t,e){if(this.proxy){var i=mini.getBox(this.proxy);jQuery(this.mask).remove(),jQuery(this.proxy).remove(),this.proxy=null,this.elBox=null,e&&(this.owner.setWidth(i.width),this.owner.setHeight(i.height),this.owner.fire("resize"))}}},mini._topWindow=null,mini._getTopWindow=function(t){if(mini._topWindow)return mini._topWindow;var i=[];return function t(e){try{(e.___try=1)==e.___try&&i.push(e)}catch(t){}e.parent&&e.parent!=e&&t(e.parent)}(window),mini._topWindow=i[i.length-1],mini._topWindow};var __ps=mini.getParams();if(__ps._winid)try{window.Owner=mini._getTopWindow()[__ps._winid]}catch(t){}function fixIEFocus(){var t=mini.getViewportBox(),e=document.createElement("input");e.style.cssText="position:absolute;left:"+t.left+"px;top:"+t.top+"px;",document.body.appendChild(e),e.focus(),e.parentNode.removeChild(e)}mini._WindowID="w"+Math.floor(1e4*Math.random()),mini._getTopWindow()[mini._WindowID]=window,mini.iframeParams={},mini.createIFrame=function(t,e,i,n,s){var o=(t=t||"").split("#");t=o[0];var r="";if(!0!==i&&(r="_t="+Math.floor(1e6*Math.random()),-1==t.indexOf("?")?t+="?"+r:t+="&"+r),t&&-1==t.indexOf("_winid")){r="_winid="+mini._WindowID;-1==t.indexOf("?")?t+="?"+r:t+="&"+r}if(mini.iframeParams)for(var l in mini.iframeParams)t+="&"+l+"="+mini.iframeParams[l];o[1]&&(t=t+"#"+o[1]);var a=-1!=t.indexOf(".mht"),h=a?t:"",u='<iframe name="'+mini.newId("mini-iframe-")+'" src="'+("post"==n?"":h)+'" style="width:100%;height:100%;"  frameborder="0"></iframe>',d=document.createElement("div"),c=mini.append(d,u),m=!1;a?m=!0:setTimeout(function(){c&&("post"!=n&&(c.src=t),m=!0)},5),c.attachEvent?c.attachEvent("onload",_):c.onload=_;var f,p=!1,g=!0;function _(){0==m||p||setTimeout(function(){e&&e(c,g),g=!1},1)}if(c._ondestroy=function(){if(p=!0,c.src="",mini.isIE)try{c.contentWindow.document.write(""),c.contentWindow.document.close()}catch(t){}c._ondestroy=null,c=null},"post"==n){f=jQuery("<form />").attr({method:"post",action:t,enctype:"multipart/form-data",target:c.name}).hide().appendTo("body"),setTimeout(function(){f.submit()},10)}return c},mini._doOpen=function(t){"string"==typeof t&&(t={url:t}),(t=mini.copyTo({width:700,height:400,allowResize:!0,allowModal:!0,closeAction:"destroy",title:"",titleIcon:"",iconCls:"",iconStyle:"",bodyStyle:"padding: 0",url:"",showCloseButton:!0,showFooter:!1},t)).closeAction="destroy";var e=t.onload;delete t.onload;var i=t.ondestroy;delete t.ondestroy;var n=t.url;delete t.url;var s=mini.getViewportBox();if(t.width&&-1!=String(t.width).indexOf("%")){var o=parseInt(t.width);t.width=parseInt(s.width*(o/100))}if(t.height&&-1!=String(t.height).indexOf("%")){var r=parseInt(t.height);t.height=parseInt(s.height*(r/100))}var l=new mini.Window;return l.set(t),l.load(n,e,i),l.show(),mini.isIE&&setTimeout(function(){fixIEFocus()},100),l},mini.getTopWindow=function(){var i=[];return function t(e){try{e.mini&&i.push(e),e.parent&&e.parent!=e&&t(e.parent)}catch(t){}}(window),i[i.length-1]},mini.open=function(t){if(t){var e,i=(e=(e=t.url)||"").split("#");if((e=i[0])&&-1==e.indexOf("_winid")){var n="_winid="+mini._WindowID;-1==e.indexOf("?")?e+="?"+n:e+="&"+n,i[1]&&(e=e+"#"+i[1])}t.url=e,t.Owner=window;var s=[];!function t(e){try{e.mini&&s.push(e),e.parent&&e.parent!=e&&t(e.parent)}catch(t){}}(window);var o=s[s.length-1];return t.targetWindow&&(o=t.targetWindow),o.mini._doOpen(t)}},mini.openTop=mini.open,mini._getResult=function(e,t,i,n,s,o){var r=null,l=mini.getText(e,t,function(t,e){r=e,i&&i&&i(t,e)},n,s),a={text:l,result:null,sender:{type:""},options:{url:e,data:t,type:s},xhr:r},h=null;try{mini_doload(a),h=(h=a.result)||mini.decode(l)}catch(t){1==mini_debugger&&alert(e+"\njson is error")}return!mini.isArray(h)&&o&&(h=mini._getMap(o,h)),mini.isArray(h)&&(h={data:h}),h?h.data:null},mini.getData=function(t,e,i,n,s){var o=mini.getText(t,e,i,n,s);return mini.decode(o)},mini.getText=function(t,e,n,i,s){var o=null;return mini.ajax({url:t,data:e,async:!1,type:s||"get",cache:!1,dataType:"text",success:function(t,e,i){o=t,n&&n(t,i)},error:i}),o},window.mini_RootPath||(mini_RootPath="/"),mini_CreateJSPath=function(t){for(var e=document.getElementsByTagName("script"),i="",n=0,s=e.length;n<s;n++){var o=e[n].src;if(-1!=o.indexOf(t)){i=(r=o.split(t))[0];break}}var r,l=location.href;return(r=(l=(l=l.split("#")[0]).split("?")[0]).split("/")).length=r.length-1,l=r.join("/"),-1==i.indexOf("http:")&&-1==i.indexOf("file:")&&(i=l+"/"+i),i},window.mini_JSPath||(mini_JSPath=mini_CreateJSPath("miniui.js")),mini.update=function(t,e){"string"==typeof t&&(t={url:t}),e&&(t.el=e);var i=mini.loadText(t.url);mini.innerHTML(t.el,i),mini.parse(t.el)},mini.createSingle=function(t){if("string"==typeof t&&(t=mini.getClass(t)),"function"==typeof t){var e=t.single;return e=e||(t.single=new t)}},mini.createTopSingle=function(t){if("function"==typeof t){var e=t.prototype.type;return top&&top!=window&&top.mini&&top.mini.getClass(e)?top.mini.createSingle(e):mini.createSingle(t)}},mini.sortTypes={string:function(t){return String(t).toUpperCase()},date:function(t){return t?mini.isDate(t)?t.getTime():mini.parseDate(String(t)):0},float:function(t){var e=parseFloat(String(t).replace(/,/g,""));return isNaN(e)?0:e},int:function(t){var e=parseInt(String(t).replace(/,/g,""),10);return isNaN(e)?0:e},currency:function(t){var e=parseFloat(String(t).replace(/,/g,""));return isNaN(e)?0:e}},mini._ValidateVType=function(t,e,i,n){for(var s=t.split(";"),o=0,r=s.length;o<r;o++){var l=(t=s[o].trim()).split(":"),a=l[0],h=t.substr(a.length+1,1e3);h=h?h.split(","):[];var u=mini.VTypes[a];if(u)if(!0!==u(e,h)){i.isValid=!1;var d=l[0]+"ErrorText";i.errorText=n[d]||mini.VTypes[d]||"",i.errorText=String.format(i.errorText,h[0],h[1],h[2],h[3],h[4]);break}}},mini._getErrorText=function(t,e){return t&&t[e]?t[e]:mini.VTypes[e]},mini.VTypes={minDateErrorText:"Date can not be less than {0}",maxDateErrorText:"Date can not be greater than {0}",uniqueErrorText:"This field is unique.",requiredErrorText:"This field is required.",emailErrorText:"Please enter a valid email address.",urlErrorText:"Please enter a valid URL.",floatErrorText:"Please enter a valid number.",intErrorText:"Please enter only digits",dateErrorText:"Please enter a valid date. Date format is {0}",maxLengthErrorText:"Please enter no more than {0} characters.",minLengthErrorText:"Please enter at least {0} characters.",maxErrorText:"Please enter a value less than or equal to {0}.",minErrorText:"Please enter a value greater than or equal to {0}.",rangeLengthErrorText:"Please enter a value between {0} and {1} characters long.",rangeCharErrorText:"Please enter a value between {0} and {1} characters long.",rangeErrorText:"Please enter a value between {0} and {1}.",required:function(t,e){return!mini.isNull(t)&&""!==t},email:function(t,e){return!(!mini.isNull(t)&&""!==t)||-1!=t.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)},url:function(t,e){if(mini.isNull(t)||""===t)return!0;return i=(i=t).toLowerCase().split("?")[0],!!new RegExp("^((https|http|ftp|rtsp|mms)?://)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,5})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$").test(i);var i},int:function(t,e){if(mini.isNull(t)||""===t)return!0;return function(t){t<0&&(t=-t);var e=String(t);return 0<e.length&&!/[^0-9]/.test(e)}(t)},float:function(t,e){if(mini.isNull(t)||""===t)return!0;return!(-1!=(i=String(t)).indexOf("-")&&0!=i.indexOf("-")||2<(i=i.replace("-","")).split(".").length||!(0<i.length)||/[^0-9.]/.test(i)||"."==i.charAt(i.length-1));var i},date:function(t,e){if(mini.isNull(t)||""===t)return!0;if(!t)return!1;var i=null,n=e[0];if(n){if((i=mini.parseDate(t,n))&&i.getFullYear&&mini.formatDate(i,n)==t)return!0}else if((i=(i=(i=mini.parseDate(t,"yyyy-MM-dd"))||mini.parseDate(t,"yyyy/MM/dd"))||mini.parseDate(t,"MM/dd/yyyy"))&&i.getFullYear)return!0;return!1},maxLength:function(t,e){if(mini.isNull(t)||""===t)return!0;var i=parseInt(e);return!(t&&!isNaN(i))||t.length<=i},minLength:function(t,e){if(mini.isNull(t)||""===t)return!0;var i=parseInt(e);return!!isNaN(i)||t.length>=i},rangeLength:function(t,e){if(mini.isNull(t)||""===t)return!0;if(!t)return!1;var i=parseFloat(e[0]),n=parseFloat(e[1]);return!(!isNaN(i)&&!isNaN(n))||i<=t.length&&t.length<=n},rangeChar:function(t,e){if(mini.isNull(t)||""===t)return!0;var i=parseFloat(e[0]),n=parseFloat(e[1]);if(isNaN(i)||isNaN(n))return!0;for(var s,o=0,r=String(t).split(""),l=0,a=r.length;l<a;l++)s=r[l],new RegExp("^[-]+$").test(s)?o+=2:o+=1;return i<=o&&o<=n},range:function(t,e){if(0==mini.VTypes.float(t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;var i=parseFloat(e[0]),n=parseFloat(e[1]);return!(!isNaN(i)&&!isNaN(n))||i<=t&&t<=n},min:function(t,e){if(0==mini.VTypes.float(t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;var i=parseFloat(e[0]);return!!isNaN(i)||i<=t},max:function(t,e){if(0==mini.VTypes.float(t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;var i=parseFloat(e[0]);return!!isNaN(i)||t<=i}},mini.summaryTypes={count:function(t){return(t=t||[]).length},max:function(t,e){for(var i=null,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],r=parseFloat(mini._getMap(e,o));null==r||isNaN(r)||(null==i||i<r)&&(i=r)}return i},min:function(t,e){for(var i=null,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],r=parseFloat(mini._getMap(e,o));null==r||isNaN(r)||(null==i||r<i)&&(i=r)}return i},avg:function(t,e){if(0==(t=t||[]).length)return 0;for(var i=0,n=0,s=t.length;n<s;n++){var o=t[n],r=parseFloat(mini._getMap(e,o));null==r||isNaN(r)||(i+=r)}return i/t.length},sum:function(t,e){for(var i=0,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],r=parseFloat(mini._getMap(e,o));null==r||isNaN(r)||(i+=r)}return i}},mini.formatCurrency=function(t,e){t=String(t).replace(/\$|\,/g,""),isNaN(t)&&(t="0"),sign=t==(t=Math.abs(t)),t=Math.floor(100*t+.50000000001),cents=t%100,t=Math.floor(t/100).toString(),cents<10&&(cents="0"+cents);for(var i=0;i<Math.floor((t.length-(1+i))/3);i++)t=t.substring(0,t.length-(4*i+3))+","+t.substring(t.length-(4*i+3));return(e=e||"")+(sign?"":"-")+t+"."+cents},mini.getByUid=mini.getbyUID,mini.emptyFn=function(){},mini.Drag=function(t){mini.copyTo(this,t)},mini.Drag.prototype={onStart:mini.emptyFn,onMove:mini.emptyFn,onStop:mini.emptyFn,capture:!1,fps:20,event:null,delay:80,start:function(t){t.preventDefault(),t&&(this.event=t),this.now=this.init=[this.event.pageX,this.event.pageY];var e=document;mini.on(e,"mousemove",this.move,this),mini.on(e,"mouseup",this.stop,this),mini.on(e,"contextmenu",this.contextmenu,this),this.context&&mini.on(this.context,"contextmenu",this.contextmenu,this),this.trigger=t.target,mini.selectable(this.trigger,!1),mini.selectable(e.body,!1),this.capture&&(isIE?this.trigger.setCapture(!0):document.captureEvents&&document.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP|Event.MOUSEDOWN)),this.started=!1,this.startTime=new Date},contextmenu:function(t){this.context&&mini.un(this.context,"contextmenu",this.contextmenu,this),mini.un(document,"contextmenu",this.contextmenu,this),t.preventDefault(),t.stopPropagation()},move:function(t){if(!(this.delay&&new Date-this.startTime<this.delay)){var e=this;this.timer||(this.timer=setTimeout(function(){e.started||(e.started=!0,e.onStart(e)),e.now=[t.pageX,t.pageY],e.event=t,e.onMove(e),e.timer=null},5))}},stop:function(t){this.now=[t.pageX,t.pageY],this.event=t,this.timer&&(clearTimeout(this.timer),this.timer=null);var e=document;mini.selectable(this.trigger,!0),mini.selectable(e.body,!0),isIE&&(this.trigger.setCapture(!1),this.trigger.releaseCapture());var i=mini.MouseButton.Right!=t.button;0==i&&t.preventDefault(),mini.un(e,"mousemove",this.move,this),mini.un(e,"mouseup",this.stop,this);var n=this;setTimeout(function(){mini.un(document,"contextmenu",n.contextmenu,n),n.context&&mini.un(n.context,"contextmenu",n.contextmenu,n)},1),this.started&&this.onStop(this,i)}},mini.JSON=new function(){function a(t,e){var i=n[e];return i||(i=e.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))}var o,r,l,h=[],u=null,d=!!{}.hasOwnProperty,c=function(t,e){if(null!==t){var i=typeof t;if("undefined"!=i)if(t.push){h[h.length]="[";var n=t.length;for(r=0;r<n;r+=1)"undefined"==(i=typeof(l=t[r]))||"function"==i||"unknown"==i||(o&&(h[h.length]=","),c(l),o=!0);h[h.length]="]"}else if(t.getFullYear){var s;u?(h[h.length]='"',h[h.length]="function"==typeof u?u(t,e):mini.formatDate(t,u)):(h[h.length]='"',h[h.length]=t.getFullYear(),h[h.length]="-",s=t.getMonth()+1,h[h.length]=s<10?"0"+s:s,h[h.length]="-",s=t.getDate(),h[h.length]=s<10?"0"+s:s,h[h.length]="T",s=t.getHours(),h[h.length]=s<10?"0"+s:s,h[h.length]=":",s=t.getMinutes(),h[h.length]=s<10?"0"+s:s,h[h.length]=":",s=t.getSeconds(),h[h.length]=s<10?"0"+s:s),h[h.length]='"'}else{if("string"==i)return m.test(t)?(h[h.length]='"',h[h.length]=t.replace(f,a),void(h[h.length]='"')):void(h[h.length]='"'+t+'"');if("number"!=i)if("boolean"!=i){var o,r,l;for(r in h[h.length]="{",t)d&&!Object.prototype.hasOwnProperty.call(t,r)||"undefined"==(i=typeof(l=t[r]))||"function"==i||"unknown"==i||(o&&(h[h.length]=","),c(r),h[h.length]=":",c(l,r),o=!0);h[h.length]="}"}else h[h.length]=String(t);else h[h.length]=t}else h[h.length]="null"}else h[h.length]="null"},n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m=/["\\\x00-\x1f]/,f=/([\x00-\x1f\\"])/g;this.encode=function(t,e){return h=[],u=e,c(t),u=null,h.join("")},this.decode=(o=/^(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2}(?:\.*\d*)?)Z*$/,r=new RegExp("^/+Date\\((-?[0-9]+).*\\)/+$","g"),l=/[\"\'](\d{4})-(\d{1,2})-(\d{1,2})[T ](\d{1,2}):(\d{1,2}):(\d{1,2})(\.*\d*)[\"\']/g,function(e,n){if(""===e||null==e)return e;function i(t){return!1!==n&&(t=(t=(t=t.replace(__js_dateRegEx,"$1new Date($2)")).replace(l,"new Date($1,$2-1,$3,$4,$5,$6)")).replace(__js_dateRegEx2,"new Date($1)")),window.eval("("+t+")")}"object"==typeof e&&(e=this.encode(e));var s=null;if(window.JSON&&window.JSON.parse)try{var t=e.replace(__js_dateRegEx,'$1"/Date($2)/"');s=window.JSON.parse(t,function(t,e){if("string"==typeof e&&!1!==n){var i;if(o.lastIndex=0,i=o.exec(e))return e=new Date(i[1],i[2]-1,i[3],i[4],i[5],i[6]);if(r.lastIndex=0,i=r.exec(e))return e=new Date(parseInt(i[1]))}return e})}catch(t){s=i(e)}else s=i(e);return s})},__js_dateRegEx=new RegExp('(^|[^\\\\])\\"\\\\/Date\\((-?[0-9]+)(?:[a-zA-Z]|(?:\\+|-)[0-9]{4})?\\)\\\\/\\"',"g"),__js_dateRegEx2=new RegExp("[\"']/Date\\(([0-9]+)\\)/[\"']","g"),mini.encode=mini.JSON.encode,mini.decode=mini.JSON.decode,mini.clone=function(t,e){if(null==t)return t;var i=mini.encode(t),n=mini.decode(i);return!1!==e&&function t(e){for(var i=0,n=e.length;i<n;i++){var s=e[i];for(var o in delete s._state,delete s._id,delete s._pid,delete s._uid,s){var r=s[o];r instanceof Array&&t(r)}}}(n instanceof Array?n:[n]),n};var DAY_MS=864e5,HOUR_MS=36e5,MINUTE_MS=6e4;mini.copyTo(mini,{clearTime:function(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate()):null},maxTime:function(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59):null},cloneDate:function(t){return t?new Date(t.getTime()):null},addDate:function(t,e,i){switch(i=i||"D",t=new Date(t.getTime()),i.toUpperCase()){case"Y":t.setFullYear(t.getFullYear()+e);break;case"MO":t.setMonth(t.getMonth()+e);break;case"D":t.setDate(t.getDate()+e);break;case"H":t.setHours(t.getHours()+e);break;case"M":t.setMinutes(t.getMinutes()+e);break;case"S":t.setSeconds(t.getSeconds()+e);break;case"MS":t.setMilliseconds(t.getMilliseconds()+e)}return t},getWeek:function(t,e,i){var n=Math.floor((14-e)/12),s=t+4800-n,o=e+12*n-3,r=i+Math.floor((153*o+2)/5)+365*s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400)-32045,l=(31741+r-r%7)%146097%36524%1461,a=Math.floor(l/1460),h=(l-a)%365+a;return NumberOfWeek=Math.floor(h/7)+1,NumberOfWeek},getWeekStartDate:function(t,e){if(6<(e=e||0)||e<0)throw new Error("out of weekday");var i=t.getDay(),n=e-i;return i<e&&(n-=7),new Date(t.getFullYear(),t.getMonth(),t.getDate()+n)},getShortWeek:function(t){return this.dateInfo.daysShort[t]},getLongWeek:function(t){return this.dateInfo.daysLong[t]},getShortMonth:function(t){return this.dateInfo.monthsShort[t]},getLongMonth:function(t){return this.dateInfo.monthsLong[t]},dateInfo:{monthsLong:["January","Febraury","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],daysLong:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Su","Mo","Tu","We","Th","Fr","Sa"],quarterLong:["Q1","Q2","Q3","Q4"],quarterShort:["Q1","Q2","Q3","Q4"],halfYearLong:["first half","second half"],patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",f:"dddd, MMMM dd, yyyy H:mm tt",F:"dddd, MMMM dd, yyyy H:mm:ss tt",g:"M/d/yyyy H:mm tt",G:"M/d/yyyy H:mm:ss tt",m:"MMMM dd",o:"yyyy-MM-ddTHH:mm:ss.fff",s:"yyyy-MM-ddTHH:mm:ss",t:"H:mm tt",T:"H:mm:ss tt",U:"dddd, MMMM dd, yyyy HH:mm:ss tt",y:"MMM, yyyy"},tt:{AM:"AM",PM:"PM"},ten:{Early:"Early",Mid:"Mid",Late:"Late"},today:"Today",clockType:24}}),Date.prototype.getHalfYear=function(){return this.getMonth?this.getMonth()<6?0:1:null},Date.prototype.getQuarter=function(){if(!this.getMonth)return null;var t=this.getMonth();return t<3?0:t<6?1:t<9?2:3},mini.formatDate=function(t,e,i){if(!t||!t.getFullYear||isNaN(t))return"";var n=t.toString(),s=mini.dateInfo;if(void 0!==(s=s||mini.dateInfo)){var o=void 0!==s.patterns[e]?s.patterns[e]:e,r=t.getFullYear(),l=t.getMonth(),a=t.getDate();if("yyyy-MM-dd"==e)return r+"-"+(l=l+1<10?"0"+(l+1):l+1)+"-"+(a=a<10?"0"+a:a);if("MM/dd/yyyy"==e)return(l=l+1<10?"0"+(l+1):l+1)+"/"+(a=a<10?"0"+a:a)+"/"+r;n=(n=o.replace(/yyyy/g,r)).replace(/yy/g,(r+"").substring(2));var h=t.getHalfYear();n=n.replace(/hy/g,s.halfYearLong[h]);var u=t.getQuarter();n=(n=(n=(n=(n=(n=n.replace(/Q/g,s.quarterLong[u])).replace(/q/g,s.quarterShort[u])).replace(/MMMM/g,s.monthsLong[l].escapeDateTimeTokens())).replace(/MMM/g,s.monthsShort[l].escapeDateTimeTokens())).replace(/MM/g,l+1<10?"0"+(l+1):l+1)).replace(/(\\)?M/g,function(t,e){return e?t:l+1});var d=t.getDay();n=(n=(n=(n=n.replace(/dddd/g,s.daysLong[d].escapeDateTimeTokens())).replace(/ddd/g,s.daysShort[d].escapeDateTimeTokens())).replace(/dd/g,a<10?"0"+a:a)).replace(/(\\)?d/g,function(t,e){return e?t:a});var c=t.getHours(),m=12<c?c-12:c;12==s.clockType&&12<c&&(c-=12),n=(n=(n=(n=n.replace(/HH/g,c<10?"0"+c:c)).replace(/(\\)?H/g,function(t,e){return e?t:c})).replace(/hh/g,m<10?"0"+m:m)).replace(/(\\)?h/g,function(t,e){return e?t:m});var f=t.getMinutes();n=(n=n.replace(/mm/g,f<10?"0"+f:f)).replace(/(\\)?m/g,function(t,e){return e?t:f});var p=t.getSeconds();n=(n=(n=(n=n.replace(/ss/g,p<10?"0"+p:p)).replace(/(\\)?s/g,function(t,e){return e?t:p})).replace(/fff/g,t.getMilliseconds())).replace(/tt/g,12<t.getHours()||0==t.getHours()?s.tt.PM:s.tt.AM);var g="";g=(t=t.getDate())<=10?s.ten.Early:t<=20?s.ten.Mid:s.ten.Late,n=n.replace(/ten/g,g)}return n.replace(/\\/g,"")},String.prototype.escapeDateTimeTokens=function(){return this.replace(/([dMyHmsft])/g,"\\$1")},mini.fixDate=function(t,e){if(+t)for(;t.getDate()!=e.getDate();)t.setTime(+t+(t<e?1:-1)*HOUR_MS)},mini.parseDate=function(t,e){try{if((n=window.eval(t))&&n.getFullYear)return n}catch(t){}if("object"==typeof t)return isNaN(t)?null:t;if("number"==typeof t)return(n=new Date(1e3*t)).getTime()!=t?null:isNaN(n)?null:n;if("string"!=typeof t)return null;if(m=t.match(/^([0-9]{4})([0-9]{2})([0-9]{0,2})$/),m){var i=new Date(parseInt(m[1],10),parseInt(m[2],10)-1);return m[3]&&i.setDate(m[3]),i}if(m=t.match(/^([0-9]{4}).([0-9]*)$/),m)return i=new Date(m[1],m[2]-1);if(t.match(/^\d+(\.\d+)?$/))return(n=new Date(1e3*parseFloat(t))).getTime()!=t?null:n;void 0===e&&(e=!0);var n=mini.parseISO8601(t,e)||(t?new Date(t):null);return isNaN(n)?null:n},mini.parseISO8601=function(t,e){var i=t.match(/^([0-9]{4})([-\/]([0-9]{1,2})([-\/]([0-9]{1,2})([T ]([0-9]{1,2}):([0-9]{1,2})(:([0-9]{1,2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!i)return(i=t.match(/^([0-9]{4})[-\/]([0-9]{2})[-\/]([0-9]{2})[T ]([0-9]{1,2})/))?n=new Date(i[1],i[2]-1,i[3],i[4]):(i=t.match(/^([0-9]{4}).([0-9]*)$/))?n=new Date(i[1],i[2]-1):(i=t.match(/^([0-9]{4}).([0-9]*).([0-9]*)/))?n=new Date(i[1],i[2]-1,i[3]):(i=t.match(/^([0-9]{2})-([0-9]{2})-([0-9]{4})$/))?n=new Date(i[3],i[1]-1,i[2]):null;var n=new Date(i[1],0,1);if(e||!i[14]){var s=new Date(i[1],0,1,9,0);i[3]&&(n.setMonth(i[3]-1),s.setMonth(i[3]-1)),i[5]&&(n.setDate(i[5]),s.setDate(i[5])),mini.fixDate(n,s),i[7]&&n.setHours(i[7]),i[8]&&n.setMinutes(i[8]),i[10]&&n.setSeconds(i[10]),i[12]&&n.setMilliseconds(1e3*Number("0."+i[12])),mini.fixDate(n,s)}else{n.setUTCFullYear(i[1],i[3]?i[3]-1:0,i[5]||1),n.setUTCHours(i[7]||0,i[8]||0,i[10]||0,i[12]?1e3*Number("0."+i[12]):0);var o=60*Number(i[16])+(i[18]?Number(i[18]):0);o*="-"==i[15]?1:-1,n=new Date(+n+60*o*1e3)}return n},mini.parseTime=function(t,e){if(!t)return null;var i=parseInt(t);if(i==t&&e){s=new Date(0);var n=e.charAt(0);return"H"==n?s.setHours(i):"m"==n?s.setMinutes(i):"s"==n&&s.setSeconds(i),isNaN(s)&&(s=null),s}var s=mini.parseDate(t);if(!s){var o=t.split(":"),r=parseInt(parseFloat(o[0])),l=parseInt(parseFloat(o[1])),a=parseInt(parseFloat(o[2]));isNaN(r)||isNaN(l)||isNaN(a)||((s=new Date(0)).setHours(r),s.setMinutes(l),s.setSeconds(a)),isNaN(r)||"H"!=e&&"HH"!=e?isNaN(r)||isNaN(l)||"H:mm"!=e&&"HH:mm"!=e?isNaN(r)||isNaN(l)||"mm:ss"!=e||((s=new Date(0)).setMinutes(r),s.setSeconds(l)):((s=new Date(0)).setHours(r),s.setMinutes(l)):(s=new Date(0)).setHours(r)}return s},mini.dateInfo={monthsLong:["","","","","","","","","","","",""],monthsShort:["1","2","3","4","5","6","7","8","9","10","11","12"],daysLong:["","","","","","",""],daysShort:["","","","","","",""],quarterLong:["","","",""],quarterShort:["Q1","Q2","Q2","Q4"],halfYearLong:["",""],patterns:{d:"yyyy-M-d",D:"yyyyMd",f:"yyyyMd H:mm",F:"yyyyMd H:mm:ss",g:"yyyy-M-d H:mm",G:"yyyy-M-d H:mm:ss",m:"MMMd",o:"yyyy-MM-ddTHH:mm:ss.fff",s:"yyyy-MM-ddTHH:mm:ss",t:"H:mm",T:"H:mm:ss",U:"yyyyMd HH:mm:ss",y:"yyyyMM"},tt:{AM:"",PM:""},ten:{Early:"",Mid:"",Late:""},today:"",clockType:24},function(window){var mini=window.mini;mini=mini||(window.mini={});var cultures=mini.cultures={},cultureName="en";function findCulture(t){return mini.cultures[t]}function getCulture(t){return t&&t.name?t:findCulture(t)||mini.cultures.current}mini.cultures[cultureName]={name:cultureName,numberFormat:{number:{pattern:["n","-n"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3]},percent:{pattern:["n %","-n %"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3],symbol:"%"},currency:{pattern:["$n","($n)"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3],symbol:"$"}}},mini.getCulture=getCulture,mini.culture=function(t){if(void 0===t)return cultures.current;mini.cultures.current=findCulture(t)},mini.culture(cultureName);var STRING="string",NUMBER="number",isArray=function(t){return t&&!!t.unshift},numberRegExp={2:/^\d{1,2}/,4:/^\d{4}/};function pad(t,e,i){var n=(e=typeof e==NUMBER?e:2)-(t+="").length;if(0<n){var s=repeat(n,"0");return i?t+s:s+t}return t}function repeat(t,e){for(var i="";t;)t-=1,i+=e;return i}var numberFormatRegExp=/^(n|c|p)(\d*)$/i,eRegExp=/^(e)(\d*)$/i,clearRegExp=/[^0#]/g,exponentRegExp=/[eE][\-+]?[0-9]+/;function doFormatNumber(number,format,options){number=Math.abs(number);var isGroup=-1!=format.indexOf(","),formats=format.split("."),format0=(formats[0]||"").replace(clearRegExp,""),format1=(formats[1]||"").replace(clearRegExp,""),value="",groupSize=options.groupSize[0],decimalsSeparator=options.decimalsSeparator,groupSeparator=options.groupSeparator,index=format0.indexOf("0");format0=-1==index?"0":format0.substr(index)||"0";var decimals=format1.length,decimalPlaces=format1.substr(0,format1.lastIndexOf("0")+1).length;function round2(number,fractionDigits){with(Math)return round(number*pow(10,fractionDigits))/pow(10,fractionDigits)}number=round2(number,decimals);var values=String(number).split(".");if(value0=values[0],value1=values[1]||"",value0){if(value0=pad(value0,format0.length),isGroup)for(var i=0;i<Math.floor((value0.length-(1+i))/3);i++)value0=value0.substring(0,value0.length-(4*i+3))+groupSeparator+value0.substring(value0.length-(4*i+3));value+=value0}return 0<decimals&&(value+=decimalsSeparator,value+=pad(value1.substr(0,decimals),decimalPlaces,!0)),value}function transformFormat(t,e,i,n){var s=i.numberFormat.number,o=numberFormatRegExp.exec(t);if(null!=o){var r=o[1],l=o[2];"p"==r?s=i.numberFormat.percent:"c"==r&&(s=i.numberFormat.currency);var a=l?parseInt(l):s.decimals,h=s.pattern[e<0?1:0];h=h.replace("n","#,#"+(0<a?"."+repeat(a,"0"):"")),t=t.replace(r+l,h).replace("$",i.numberFormat.currency.symbol).replace("%",i.numberFormat.percent.symbol)}else isNumberFormat(t)&&e<0&&!n[1]&&(t="-"+t);return t}function isNumberFormat(t){return-1!=t.indexOf("0")||-1!=t.indexOf("#")}function getNumberFormat(t){if(!t)return null;var e=function(t){var e=t.indexOf("0"),i=t.indexOf("#");(-1==e||-1!=i&&i<e)&&(e=i);var n=t.lastIndexOf("0"),s=t.lastIndexOf("#");return(-1==n||-1!=s&&n<s)&&(n=s),[e,n]}(t),i=e[0],n=e[1];return-1<i?{begin:i,end:n,format:t.substring(i,n+1)}:null}function formatNumber(t,e,i){if(typeof t!=NUMBER)return"";if(!e)return String(t);var n=e.split(";");e=n[0],t<0&&2<=n.length&&(e=n[1]),0==t&&3<=n.length&&(e=n[2]);var s=(i=getCulture(i)).numberFormat.number,o=i.numberFormat.percent,r=i.numberFormat.currency,l=-1!=(e=transformFormat(e,t,i,n)).indexOf(r.symbol),a=-1!=e.indexOf(o.symbol),h=(e.indexOf("."),isNumberFormat(e)),u=l?r:a?r:s,d=(t=a?100*t:t,eRegExp.exec(e));if(d){var c=parseInt(d[2]);return isNaN(c)?t.toExponential():t.toExponential(c)}if(!h)return e;var m="",f=getNumberFormat(e);return m=null!=f?(m=doFormatNumber(t,f.format,u),e.substr(0,f.begin)+m+e.substr(f.end+1)):e}mini.parseInt=function(t,e,i){var n=mini.parseFloat(t,e,i);return n&&(n|=0),n},mini.parseFloat=function(t,e,i){if(!t&&0!==t)return null;if(typeof t===NUMBER)return t;if(i&&i.split(";")[2]==t)return 0;if(exponentRegExp.test(t))return t=parseFloat(t),isNaN(t)&&(t=null),t;t=t.toString();var n=(e=mini.getCulture(e)).numberFormat,s=n.number,o=n.percent,r=n.currency,l=-1!=t.indexOf(o.symbol),a=(s=-1!=t.indexOf(r.symbol)?r:l?o:s).pattern[1],h=s.decimals,u=s.decimalsSeparator,d=s.groupSeparator,c=-1<t.indexOf("-");function m(t,e,i){var n=getNumberFormat(e);if(n){var s=e.substr(0,n.begin),o=e.substr(n.end+1);0==t.indexOf(s)&&-1<t.indexOf(o)&&(t=t.replace(s,"").replace(o,""),c=i)}return t}if(i){var f=i.split(";");if(f[1])t=m(t,i=f[1],!0);else{var p=t;p==(t=m(p,i=f[0],!1))&&(t=m(p,"-"+i,!0))}}else 0==c&&(t=m(t,i=a.replace("n","#,#"+(0<h?"."+repeat(h,"0"):"")).replace("$",r.symbol).replace("%",o.symbol),!0));var g=(t=t.split(d).join("").replace(u,".")).match(/([0-9,.]+)/g);return null==g?null:(t=g[0],t=parseFloat(t),isNaN(t)?t=null:c&&(t*=-1),t&&l&&(t/=100),t)},mini.formatNumber=formatNumber}(this);var inBrowser="undefined"!=typeof window,UA=inBrowser&&window.navigator.userAgent.toLowerCase(),isIE=UA&&/msie|trident/.test(UA),isIE9=UA&&0<UA.indexOf("msie 9.0"),isEdge=UA&&0<UA.indexOf("edge/"),isAndroid=UA&&0<UA.indexOf("android"),isIOS=UA&&/iphone|ipad|ipod|ios/.test(UA),isMobile=isAndroid||isIOS;mini.isAndroid=isAndroid,mini.isIOS=isIOS,mini.isMobile=isMobile,mini.Keyboard={Left:37,Top:38,Right:39,Bottom:40,PageUp:33,PageDown:34,End:35,Home:36,Enter:13,ESC:27,Space:32,Tab:9,Del:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};var ua=navigator.userAgent.toLowerCase(),check=function(t){return t.test(ua)},DOC=document,isStrict="CSS1Compat"==document.compatMode,version=function(t,e){var i;return t&&(i=e.exec(ua))?parseFloat(i[1]):0},docMode=document.documentMode,isOpera=check(/opera/),isOpera10_5=isOpera&&check(/version\/10\.5/),isChrome=check(/\bchrome\b/),isWebKit=check(/webkit/),isSafari=!isChrome&&check(/safari/),isSafari2=isSafari&&check(/applewebkit\/4/),isSafari3=isSafari&&check(/version\/3/),isSafari4=isSafari&&check(/version\/4/),isSafari5_0=isSafari&&check(/version\/5\.0/),isSafari5=isSafari&&check(/version\/5/),isIE=!isOpera&&check(/msie/),isIE7=isIE&&(check(/msie 7/)&&8!=docMode&&9!=docMode&&10!=docMode||7==docMode),isIE8=isIE&&(check(/msie 8/)&&7!=docMode&&9!=docMode&&10!=docMode||8==docMode),isIE9=isIE&&(check(/msie 9/)&&7!=docMode&&8!=docMode&&10!=docMode||9==docMode),isIE10=isIE&&(check(/msie 10/)&&7!=docMode&&8!=docMode&&9!=docMode||10==docMode),isIE6=isIE&&!isIE7&&!isIE8&&!isIE9&&!isIE10,isIE11=-1<ua.indexOf("trident")&&-1<ua.indexOf("rv"),isIE=isIE||isIE11,isFirefox=0<navigator.userAgent.indexOf("Firefox"),isGecko=!isWebKit&&check(/gecko/),isGecko3=isGecko&&check(/rv:1\.9/),isGecko4=isGecko&&check(/rv:2\.0/),isGecko5=isGecko&&check(/rv:5\./),isGecko10=isGecko&&check(/rv:10\./),isFF3_0=isGecko3&&check(/rv:1\.9\.0/),isFF3_5=isGecko3&&check(/rv:1\.9\.1/),isFF3_6=isGecko3&&check(/rv:1\.9\.2/),isWindows=check(/windows|win32/),isMac=check(/macintosh|mac os x/),isAir=check(/adobeair/),isLinux=check(/linux/),scrollbarSize=null,chromeVersion=version(!0,/\bchrome\/(\d+\.\d+)/),firefoxVersion=version(!0,/\bfirefox\/(\d+\.\d+)/),ieVersion=version(isIE,/msie (\d+\.\d+)/),IE_V=isIE?parseInt(ieVersion):-1,operaVersion=version(isOpera,/version\/(\d+\.\d+)/),safariVersion=version(isSafari,/version\/(\d+\.\d+)/),webKitVersion=version(isWebKit,/webkit\/(\d+\.\d+)/),isSecure=/^https/i.test(window.location.protocol),isBorderBox=isIE&&!isStrict;if(isIE6)try{DOC.execCommand("BackgroundImageCache",!1,!0)}catch(t){}mini.boxModel=!isBorderBox,mini.isIE=isIE,mini.isIE6=isIE6,mini.isIE7=isIE7,mini.isIE8=isIE8,mini.isIE9=isIE9,mini.isIE10=isIE10,mini.isIE11=isIE11,mini.IE_V=isIE11?11:IE_V,mini.isFirefox=isFirefox,mini.isOpera=isOpera,mini.isSafari=isSafari,mini.isChrome=isChrome,isIE&&jQuery(document.documentElement).addClass("ie ie"+mini.IE_V),jQuery&&(jQuery.boxModel=mini.boxModel),mini.noBorderBox=!1,0==jQuery.boxModel&&isIE&&0==isIE9&&(mini.noBorderBox=!0),mini.MouseButton={Left:0,Middle:1,Right:2},!isIE||isIE9||isIE10||(mini.MouseButton={Left:1,Middle:4,Right:2}),mini.append=function(t,e){if(t=mini.byId(t),e&&t){if("string"!=typeof e)return t.appendChild(e),e;if("#"==e.charAt(0)){if(!(e=mini.byId(e)))return;return t.appendChild(e),e}if(0==e.indexOf("<tr"))return jQuery(t).append(e)[0].lastChild;var i=document.createElement("div");for(i.innerHTML=e,e=i.firstChild;i.firstChild;)t.appendChild(i.firstChild);return e}},mini.prepend=function(t,e){if("string"==typeof e)if("#"==e.charAt(0))e=mini.byId(e);else{var i=document.createElement("div");i.innerHTML=e,e=i.firstChild}return jQuery(t).prepend(e)[0].firstChild},mini.after=function(t,e){if("string"==typeof e)if("#"==e.charAt(0))e=mini.byId(e);else{var i=document.createElement("div");i.innerHTML=e,e=i.firstChild}if(e&&t)return t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e),e},mini.before=function(t,e){if("string"==typeof e)if("#"==e.charAt(0))e=mini.byId(e);else{var i=document.createElement("div");i.innerHTML=e,e=i.firstChild}if(e&&t)return t.parentNode.insertBefore(e,t),e},mini.__wrap=document.createElement("div"),mini.createElements=function(t){mini.removeChilds(mini.__wrap);var e=0==t.indexOf("<tr");return e&&(t="<table>"+t+"</table>"),mini.__wrap.innerHTML=t,e?mini.__wrap.firstChild.rows:mini.__wrap.childNodes},mini_byId=function(t,e){if("string"!=typeof t)return t;if("#"==t.charAt(0)&&(t=t.substr(1)),o=document.getElementById(t))return o;if(e&&!mini.isAncestor(document.body,e)){for(var i=e.getElementsByTagName("*"),n=0,s=i.length;n<s;n++){var o;if((o=i[n]).id==t)return o}o=null}return o},mini_hasClass=function(t,e){if(t=mini.byId(t))return!!t.className&&-1!=String(t.className).split(" ").indexOf(e)},mini_addClass=function(t,e){e&&0==mini.hasClass(t,e)&&jQuery(t).addClass(e)},mini_removeClass=function(t,e){e&&jQuery(t).removeClass(e)};var _ceil=function(t){return Math.ceil(parseFloat(t))};function UUID(){for(var t=[],e="0123456789ABCDEF".split(""),i=0;i<36;i++)t[i]=Math.floor(16*Math.random());t[14]=4,t[19]=3&t[19]|8;for(i=0;i<36;i++)t[i]=e[t[i]];return t[8]=t[13]=t[18]=t[23]="-",t.join("")}function __BindIFrames(){}function js_isTouchDevice(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}function js_touchScroll(t){if(js_isTouchDevice()){var e="string"==typeof t?document.getElementById(t):t,i=0;e.addEventListener("touchstart",function(t){i=this.scrollTop+t.touches[0].pageY,t.preventDefault()},!1),e.addEventListener("touchmove",function(t){this.scrollTop=i-t.touches[0].pageY,t.preventDefault()},!1)}}mini_getMargins=function(t){t=mini.byId(t);var e=jQuery(t);return{top:_ceil(e.css("margin-top"),10)||0,left:_ceil(e.css("margin-left"),10)||0,bottom:_ceil(e.css("margin-bottom"),10)||0,right:_ceil(e.css("margin-right"),10)||0}},mini_getBorders=function(t){t=mini.byId(t);var e=jQuery(t);return{top:_ceil(e.css("border-top-width"),10)||0,left:_ceil(e.css("border-left-width"),10)||0,bottom:_ceil(e.css("border-bottom-width"),10)||0,right:_ceil(e.css("border-right-width"),10)||0}},mini_getPaddings=function(t){t=mini.byId(t);var e=jQuery(t);return{top:_ceil(e.css("padding-top"),10)||0,left:_ceil(e.css("padding-left"),10)||0,bottom:_ceil(e.css("padding-bottom"),10)||0,right:_ceil(e.css("padding-right"),10)||0}},mini_setWidth=function(t,e){if(t=mini.byId(t),e=parseInt(e),!isNaN(e)&&t){if(jQuery.boxModel){var i=mini.getPaddings(t),n=mini.getBorders(t);e=e-i.left-i.right-n.left-n.right}e<0&&(e=0),t.style.width=e+"px"}},mini_setHeight=function(t,e){if(t=mini.byId(t),e=parseInt(e),!isNaN(e)&&t){if(jQuery.boxModel){var i=mini.getPaddings(t),n=mini.getBorders(t);e=e-i.top-i.bottom-n.top-n.bottom}e<0&&(e=0),t.style.height=e+"px"}},mini_getWidth=function(t,e){return"none"==(t=mini.byId(t)).style.display||"text/javascript"==t.type?0:e?jQuery(t).width():jQuery(t).outerWidth()},mini_getHeight=function(t,e){return"none"==(t=mini.byId(t)).style.display||"text/javascript"==t.type?0:e?jQuery(t).height():jQuery(t).outerHeight()},mini_setBox=function(t,e,i,n,s){void 0===i&&(i=e.y,n=e.width,s=e.height,e=e.x),mini.setXY(t,e,i),mini.setWidth(t,n),mini.setHeight(t,s)},mini_getBox=function(t){var e=mini.getXY(t),i={x:e[0],y:e[1],width:mini.getWidth(t),height:mini.getHeight(t)};return i.left=i.x,i.top=i.y,i.right=i.x+i.width,i.bottom=i.y+i.height,i},mini_setStyle=function(t,e){if((t=mini.byId(t))&&"string"==typeof e)for(var i=jQuery(t),n=e.toLowerCase().split(";"),s=0,o=n.length;s<o;s++){var r=n[s].split(":");if(1<r.length)if(2<r.length){var l=r[0].trim();r.removeAt(0);var a=r.join(":").trim();i.css(l,a)}else i.css(r[0].trim(),r[1].trim())}},mini_getStyle=function(){var t=document.defaultView;return new Function("el","style",["style.indexOf('-')>-1 && (style=style.replace(/-(\\w)/g,function(m,a){return a.toUpperCase()}));","style=='float' && (style='",t?"cssFloat":"styleFloat","');return el.style[style] || ",t?"window.getComputedStyle(el, null)[style]":"el.currentStyle[style]"," || null;"].join(""))}(),mini_isAncestor=function(t,e){var i=!1;if((t=mini.byId(t))===(e=mini.byId(e)))return!0;if(t&&e)if(t.contains)try{return t.contains(e)}catch(t){return!1}else{if(t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));for(;e=e.parentNode;)i=e==t||i}return i},mini_findParent=function(t,e,i){t=mini.byId(t);var n,s=document.body,o=0;for("number"!=typeof(i=i||50)&&(n=mini.byId(i),i=10);t&&1==t.nodeType&&o<i&&t!=s&&t!=n;){if(mini.hasClass(t,e))return t;o++,t=t.parentNode}return null},mini.copyTo(mini,{byId:mini_byId,hasClass:mini_hasClass,addClass:mini_addClass,removeClass:mini_removeClass,getMargins:mini_getMargins,getBorders:mini_getBorders,getPaddings:mini_getPaddings,setWidth:mini_setWidth,setHeight:mini_setHeight,getWidth:mini_getWidth,getHeight:mini_getHeight,setBox:mini_setBox,getBox:mini_getBox,setStyle:mini_setStyle,getStyle:mini_getStyle,repaint:function(t){t=t||document.body,mini.addClass(t,"mini-repaint"),setTimeout(function(){mini.removeClass(t,"mini-repaint")},1)},getSize:function(t,e){return{width:mini.getWidth(t,e),height:mini.getHeight(t,e)}},setSize:function(t,e,i){mini.setWidth(t,e),mini.setHeight(t,i)},setX:function(t,e){e=parseInt(e);var i=jQuery(t).offset(),n=parseInt(i.top);void 0===n&&(n=i[1]),mini.setXY(t,e,n)},setY:function(t,e){e=parseInt(e);var i=jQuery(t).offset(),n=parseInt(i.left);void 0===n&&(n=i[0]),mini.setXY(t,n,e)},setXY:function(t,e,i){var n={left:parseInt(e),top:parseInt(i)};jQuery(t).offset(n),jQuery.fn.jquery&&-1!=jQuery.fn.jquery.indexOf("1.4")&&jQuery(t).offset(n)},getXY:function(t){var e=jQuery(t).offset();return[parseInt(e.left),parseInt(e.top)]},getViewportBox:function(){var t=jQuery(window).width(),e=jQuery(window).height(),i=jQuery(document).scrollLeft(),n=jQuery(document.body).scrollTop();return 0==n&&document.documentElement&&(n=document.documentElement.scrollTop),{x:i,y:n,top:n,left:i,width:t,height:e,right:i+t,bottom:n+e}},showAt:function(t){jQuery;t=jQuery.extend({el:null,x:"center",y:"center",offset:[0,0],fixed:!1,zindex:mini.getMaxZIndex(),timeout:0,timeoutHandler:null,constrain:!1,animation:!1},t);var e=jQuery(t.el)[0],i=t.x,n=t.y,s=t.offset[0],o=t.offset[1],r=t.zindex,l=t.fixed;t.animation;if(e){t.timeout&&setTimeout(function(){t.timeoutHandler&&t.timeoutHandler()},t.timeout);var a=";position:absolute;display:block;left:auto;top:auto;right:auto;bottom:auto;margin:0;z-index:"+r+";";mini.setStyle(e,a);a="";if(t&&mini.isNumber(i)&&mini.isNumber(n)){if(t.fixed&&!mini.isIE6&&(a+=";position:fixed;"),mini.setStyle(e,a),t.constrain){var h=jQuery(window).width(),u=jQuery(window).height();i+(d=mini.getSize(e)).width>h&&(i=h-d.width),i<0&&(i=0),n+d.height>u&&(n=u-d.height),n<0&&(n=0)}mini.setXY(e,i,n)}else{if("left"==i)a+="left:"+s+"px;";else if("right"==i)a+="right:"+s+"px;";else{a+="left:50%;margin-left:"+.5*-(d=mini.getSize(e)).width+"px;"}if("top"==n)a+="top:"+o+"px;";else if("bottom"==n)a+="bottom:"+o+"px;";else{var d;a+="top:50%;margin-top:"+.5*-(d=mini.getSize(e)).height+"px;"}l&&!mini.isIE6&&(a+="position:fixed"),mini.setStyle(e,a)}}},getChildNodes:function(t,e){if(t=mini.byId(t)){for(var i=t.childNodes,n=[],s=0,o=i.length;s<o;s++){var r=i[s];1!=r.nodeType&&!0!==e||n.push(r)}return n}},removeNode:isIE?function(){var e;return function(t){t&&"BODY"!=t.tagName&&((e=e||document.createElement("div")).appendChild(t),e.innerHTML="")}}():function(t){t&&t.parentNode&&"BODY"!=t.tagName&&t.parentNode.removeChild(t)},removeChilds:function(t,e){if(t=mini.byId(t))for(var i=mini.getChildNodes(t,!0),n=0,s=i.length;n<s;n++){var o=i[n];e&&o==e||t.removeChild(i[n])}},isAncestor:mini_isAncestor,findParent:mini_findParent,findChild:function(t,e){for(var i=(t=mini.byId(t)).getElementsByTagName("*"),n=0,s=i.length;n<s;n++){t=i[n];if(mini.hasClass(t,e))return t}},isAncestor:function(t,e){var i=!1;if((t=mini.byId(t))===(e=mini.byId(e)))return!0;if(t&&e)if(t.contains)try{return t.contains(e)}catch(t){return!1}else{if(t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));for(;e=e.parentNode;)i=e==t||i}return i},getOffsetsTo:function(t,e){var i=this.getXY(t),n=this.getXY(e);return[i[0]-n[0],i[1]-n[1]]},scrollIntoView:function(t,e,i,n){var s=mini.byId(e)||document.body,o=this.getOffsetsTo(t,s),r=o[0]+s.scrollLeft,l=o[1]+s.scrollTop,a=l+t.offsetHeight,h=r+t.offsetWidth,u=s.clientHeight,d=parseInt(s.scrollTop,10),c=parseInt(s.scrollLeft,10),m=d+u,f=c+s.clientWidth;return!1!==n&&(t.offsetHeight>u||l<d?s.scrollTop=l:m<a&&(s.scrollTop=a-u),s.scrollTop=s.scrollTop),!1!==i&&(t.offsetWidth>s.clientWidth||r<c?s.scrollLeft=r:f<h&&(s.scrollLeft=h-s.clientWidth),s.scrollLeft=s.scrollLeft),this},getScrollOffset:function(){if(!mini._scrollOffset){var t=document.createElement("div");t.style.cssText="width:100px;background:#eee;height:50px;overflow:scroll;padding:1px;position:absolute;left:-1000px;top:0;box-sizing:content-box;-moz-box-sizing: content-box;",document.body.appendChild(t),mini._scrollOffset=t.offsetWidth-t.clientWidth,t.parentNode.removeChild(t)}return mini._scrollOffset},setOpacity:function(t,e){jQuery(t).css({opacity:e})},selectable:function(t,e){t=mini.byId(t),e?(jQuery(t).removeClass("mini-unselectable"),isIE?t.unselectable="off":(t.style.MozUserSelect="",t.style.KhtmlUserSelect="",t.style.UserSelect="")):(jQuery(t).addClass("mini-unselectable"),isIE?t.unselectable="on":(t.style.MozUserSelect="none",t.style.UserSelect="none",t.style.KhtmlUserSelect="none"))},selectRange:function(t,e,i){if(t.createTextRange){var n=t.createTextRange();n.moveStart("character",e),n.moveEnd("character",i-t.value.length),n.select()}else t.setSelectionRange&&t.setSelectionRange(e,i);try{t.focus()}catch(t){}},getSelectRange:function(t){if(t=mini.byId(t)){try{t.focus()}catch(t){}var e,i=0,n=0;if(t.createTextRange&&document.selection)(e=document.selection.createRange().duplicate()).moveEnd("character",t.value.length),i=""===e.text?t.value.length:t.value.lastIndexOf(e.text),(e=document.selection.createRange().duplicate()).moveStart("character",-t.value.length),n=e.text.length;else i=t.selectionStart,n=t.selectionEnd;return[i,n]}}}),function(){var r={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},t=document.createElement("div");t.setAttribute("class","t");var l="t"===t.className;mini.setAttr=function(t,e,i){t.setAttribute(l?e:r[e]||e,i)},mini.getAttr=function(t,e){if("height"==e)return jQuery(t).attr("height");if("value"==e&&(isIE6||isIE7)){var i=t.attributes[e];return i?i.value:null}if(!t.getAttribute)return null;var n=t.getAttribute(l?e:r[e]||e);if("function"==typeof n||"maxLength"==e){var s=t.attributes[e];s&&(n=s.value)}if(!n&&"onload"==e){var o=t.getAttributeNode?t.getAttributeNode(e):null;o&&(n=o.nodeValue)}return n}}(),mini_preventDefault=function(){window.event&&(window.event.returnValue=!1)},mini_stopPropogation=function(){window.event&&(window.event.cancelBubble=!0)},mini_onOne=function(t,e,i,n){t&&(t["on"+e.toLowerCase()]=function(t){if((t=t||window.event).target||(t.target=t.srcElement),t.preventDefault||(t.preventDefault=mini_preventDefault),t.stopPropogation||(t.stopPropogation=mini_stopPropogation),!1===i.call(n,t))return!1})},mini_on=function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;if(mini.findListener(t,e,i,n))return!1;var s=mini.createDelegate(i,n);mini.listeners.push([t,e,i,n,s]),mini.isFirefox&&"mousewheel"==e&&(e="DOMMouseScroll"),jQuery(t).bind(e,s)},mini_un=function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;var s=mini.findListener(t,e,i,n);if(!s)return!1;mini._destroying||mini.listeners.remove(s),mini.isFirefox&&"mousewheel"==e&&(e="DOMMouseScroll"),jQuery(t).unbind(e,s[4])},mini.copyTo(mini,{listeners:[],on:mini_on,un:mini_un,_getListeners:function(){return mini.listeners},findListener:function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;for(var s=mini._getListeners(),o=s.length-1;0<=o;o--){var r=s[o];try{if(r[0]==t&&r[1]==e&&r[2]==i&&r[3]==n)return r}catch(t){}}},clearEvent:function(t,e){if(!(t=mini.byId(t)))return!1;if(mini._destroying)jQuery(t).unbind();else{for(var i=mini._getListeners(),n=i.length-1;0<=n;n--){var s=i[n];s[0]==t&&(e&&e!=s[1]||mini.un(t,s[1],s[2],s[3]))}t.onmouseover=t.onmousedown=null}}}),mini.__windowResizes=[],mini.onWindowResize=function(t,e){mini.__windowResizes.push([t,e])},mini.on(window,"resize",function(t){for(var e=mini.__windowResizes,i=0,n=e.length;i<n;i++){var s=e[i];s[0].call(s[1],t)}}),mini.htmlEncode=function(t){if("string"!=typeof t)return t;return 0==t.length?"":t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")},mini.htmlDecode=function(t){if("string"!=typeof t)return t;return 0==t.length?"":t.replace(/&gt;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"')},mini.copyTo(Array.prototype,{add:Array.prototype.enqueue=function(t){return this[this.length]=t,this},getRange:function(t,e){for(var i=[],n=t;n<=e;n++){var s=this[n];s&&(i[i.length]=s)}return i},addRange:function(t){for(var e=0,i=t.length;e<i;e++)this[this.length]=t[e];return this},clear:function(){return this.length=0,this},clone:function(){return 1===this.length?[this[0]]:Array.apply(null,this)},contains:function(t){return 0<=this.indexOf(t)},indexOf:function(t,e){for(var i=this.length,n=e<0?Math.max(0,i+e):e||0;n<i;n++)if(this[n]===t)return n;return-1},dequeue:function(){return this.shift()},insert:function(t,e){return this.splice(t,0,e),this},insertRange:function(t,e){for(var i=e.length-1;0<=i;i--){var n=e[i];this.splice(t,0,n)}return this},remove:function(t){var e=this.indexOf(t);return 0<=e&&this.splice(e,1),0<=e},removeAt:function(t){var e=this[t];return this.splice(t,1),e},removeRange:function(t){for(var e=0,i=(t=t.clone()).length;e<i;e++)this.remove(t[e])}}),mini.isShowBackdrop=!(mini.isIE&&mini.IE_V<=8),mini._MaskID=1,mini._MaskObjects={},mini.mask=function(t){var e=mini.byId(t);mini.isElement(e)?t={el:e}:"string"==typeof t&&(t={html:t}),(t=mini.copyTo({html:"",cls:"",style:"",backStyle:""},t)).el=mini.byId(t.el),t.el||(t.el=document.body);e=t.el;mini.unmask(t.el),e._maskid=mini._MaskID++,mini._MaskObjects[e._maskid]=t;var i=mini.append(e,'<div class="mini-mask"><div class="mini-mask-background" style="'+t.backStyle+'"></div><div class="mini-mask-msg '+t.cls+'" style="'+t.style+'">'+t.html+"</div></div>");e==document.body&&mini.addClass(i,"mini-fixed"),t.maskEl=i,mini.isNull(t.opacity)||mini.setOpacity(i.firstChild,t.opacity);var n=i.lastChild;n.style.display="none",setTimeout(function(){!function(){n.style.display="block";var t=mini.getSize(n);n.style.marginLeft=-t.width/2+"px",n.style.marginTop=-t.height/2+"px",n.style.zIndex=mini.getMaxZIndex()}()},0)},mini.unmask=function(t){t=(t=mini.byId(t))||document.body;var e=mini._MaskObjects[t._maskid];if(e){delete mini._MaskObjects[t._maskid];var i=e.maskEl;e.maskEl=null,i&&i.parentNode&&i.parentNode.removeChild(i)}},mini.showMaskLoading=function(t){return t=$.extend({el:document.body,cls:"mini-mask-loading",html:mini.Control.prototype.loadingMsg||"Loading..."},t),mini.mask(t)},mini.Cookie={get:function(t){for(var e=document.cookie.split("; "),i=null,n=0;n<e.length;n++){var s=e[n].split("=");t==s[0]&&(i=s)}if(i){var o=i[1];return void 0===o?o:unescape(o)}return null},set:function(t,e,i,n){var s=new Date;null!=i&&(s=new Date(s.getTime()+1e3*i*3600*24)),document.cookie=t+"="+escape(e)+(null==i?"":"; expires="+s.toGMTString())+";path=/"+(n?"; domain="+n:"")},del:function(t,e){this.set(t,null,-100,e)}},mini.copyTo(mini,{treeToArray:function(t,e,i,n,s){e=e||"children";for(var o=[],r=0,l=t.length;r<l;r++){var a=t[r];o[o.length]=a,n&&(a[n]=s);var h=a[e];if(h&&0<h.length){var u=a[i],d=this.treeToArray(h,e,i,n,u);o.addRange(d)}}return o},arrayToTree:function(t,e,i,n){e=e||"children",i=i||"_id",n=n||"_pid";for(var s=[],o={},r=0,l=t.length;r<l;r++){if(h=t[r]){var a=mini._getMap(i,h);null!=a&&(o[a]=h),delete h[e]}}for(r=0,l=t.length;r<l;r++){var h=t[r],u=o[mini._getMap(n,h)];u?(u[e]||(u[e]=[]),u[e].push(h)):s.push(h)}return s}}),mini.treeToList=mini.treeToArray,mini.listToTree=mini.arrayToTree,String.format=function(t){var i=Array.prototype.slice.call(arguments,1);return(t=t||"").replace(/\{(\d+)\}/g,function(t,e){return i[e]})},String.prototype.trim=function(){var t=/^\s+|\s+$/g;return function(){return this.replace(t,"")}}(),mini.copyTo(mini,{measureText:function(t,e,i){if(this.measureEl||(this.measureEl=mini.append(document.body,"<div></div>")),this.measureEl.style.cssText="position:absolute;left:-1000px;top:-1000px;visibility:hidden;","string"==typeof t)this.measureEl.className=t;else{this.measureEl.className="";for(var n=jQuery(t),s=jQuery(this.measureEl),o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],r=0,l=o.length;r<l;r++){var a=o[r];s.css(a,n.css(a))}}return i&&mini.setStyle(this.measureEl,i),this.measureEl.innerHTML=e,mini.getSize(this.measureEl)}}),"undefined"==typeof mini_layoutOnParse&&(mini_layoutOnParse=!0),mini.enableLayout=!0,mini.autoParse=!0,jQuery(function(){mini.updateDevice(),mini.autoParse&&setTimeout(function(){var t=document.documentElement;(isIE6||isIE7)&&("hidden"==mini.getStyle(document.body,"overflow")||t&&"hidden"==mini.getStyle(t,"overflow"))&&(jQuery(document.body).css("overflow","visible"),t&&jQuery(t).css("overflow","visible")),mini.__LastWindowWidth=document.documentElement.clientWidth,mini.__LastWindowHeight=document.documentElement.clientHeight;new Date;mini.isReady=!0,mini.parse(null,mini_layoutOnParse),mini._FireBindEvents()},1)}),mini_onload=function(t){mini.on(window,"resize",mini_onresize)},mini.on(window,"load",mini_onload),mini.__LastWindowWidth=document.documentElement.clientWidth,mini.__LastWindowHeight=document.documentElement.clientHeight,mini.doWindowResizeTimer=null,mini.allowLayout=!0,mini_onresize=function(t){if(mini.updateDevice(),mini.doWindowResizeTimer&&clearTimeout(mini.doWindowResizeTimer),mini.WindowVisible=mini.isWindowDisplay(),0!=mini.WindowVisible&&0!=mini.allowLayout)if("undefined"!=typeof Ext)mini.doWindowResizeTimer=setTimeout(function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;mini.__LastWindowWidth==t&&mini.__LastWindowHeight==e||(mini.__LastWindowWidth=t,mini.__LastWindowHeight=e,mini.layout(null,!1)),mini.doWindowResizeTimer=null},300);else{var e=100;try{parent&&parent!=window&&parent.mini&&(e=0)}catch(t){}mini.doWindowResizeTimer=setTimeout(function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;mini.__LastWindowWidth==t&&mini.__LastWindowHeight==e||(mini.__LastWindowWidth=t,mini.__LastWindowHeight=e,mini.layout(null,!1)),mini.doWindowResizeTimer=null},e)}},mini.isDisplay=function(t,e){for(var i=e||document.body;;){if(null==t||!t.style)return!1;if(t&&t.style&&"none"==t.style.display)return!1;if(t==i)return!0;t=t.parentNode}return!0},mini.isWindowDisplay=function(){try{var t=window.parent;if(t==window)return!0;for(var e=t.document.getElementsByTagName("iframe"),i=t.document.getElementsByTagName("frame"),n=[],s=0,o=e.length;s<o;s++)n.push(e[s]);for(s=0,o=i.length;s<o;s++)n.push(i[s]);var r=null;for(s=0,o=n.length;s<o;s++){var l=n[s];if(l.contentWindow==window){r=l;break}}return!!r&&mini.isDisplay(r,t.document.body)}catch(t){return!0}},mini.WindowVisible=mini.isWindowDisplay(),mini.layoutIFrames=function(n){if(document.body){var s=(n=n||document.body).getElementsByTagName("iframe");setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t];try{mini.isDisplay(i)&&mini.isAncestor(n,i)&&(i.contentWindow.mini&&(0==i.contentWindow.mini.WindowVisible?(i.contentWindow.mini.WindowVisible=i.contentWindow.mini.isWindowDisplay(),i.contentWindow.mini.layout()):i.contentWindow.mini.layout(null,!1)),i.contentWindow.mini.layoutIFrames())}catch(t){}}},30)}},jQuery.ajaxSetup({cache:!1}),isIE&&setInterval(function(){},2e4),mini_unload=function(t){try{var e=mini._getTopWindow();e[mini._WindowID]="",delete e[mini._WindowID]}catch(t){}var i=document.body.getElementsByTagName("iframe");if(0<i.length){for(var n=[],s=0,o=i.length;s<o;s++)n.push(i[s]);for(s=0,o=n.length;s<o;s++)try{var r=n[s];if(r._ondestroy=null,r.onload=function(){},jQuery(r).unbind("load"),r.src="",mini.isIE)try{r.contentWindow.document.write(""),r.contentWindow.document.close()}catch(t){}r.parentNode&&r.parentNode.removeChild(r)}catch(t){}}mini._destroying=!0;var l=mini.getComponents().clone();for(s=0,o=l.length;s<o;s++){var a=l[s];!0!==a.destroyed&&a.destroy(!1)}l.length=0,l=null,mini.clearEvent(window),mini.clearEvent(document),mini.un(window,"unload",mini_unload),mini.un(window,"load",mini_onload),mini.un(window,"resize",mini_onresize),mini.components={},mini.classes={},mini.uiClasses={},mini.uids={},mini.listeners.length=0,mini._topWindow=null,window.mini=null,window.Owner=null,window.CloseOwnerWindow=null},mini.on(window,"unload",mini_unload),mini.zIndex=1e3,mini.zindex=mini.getMaxZIndex=function(){return mini.zIndex++},mini._placeholder=function(i){if((i=mini.byId(i))&&isIE&&!isIE10&&!isIE11)if(i._placeholder)n();else{i._placeholder=!0;var e=document.createElement("label");e.className="mini-placeholder-label",i.parentNode.appendChild(e),(i._placeholder_label=e).onmousedown=function(){try{i.focus()}catch(t){}},i.onpropertychange=function(t){"value"==(t=t||window.event).propertyName&&n()},n(),mini.on(i,"focus",function(t){i.readOnly||(e.style.display="none")}),mini.on(i,"blur",function(t){n()})}function n(){var t=i._placeholder_label;if(t){var e=i.getAttribute("placeholder");e=e||i.placeholder,i.value?t.style.display="none":(t.innerHTML=e,t.style.display="")}}},mini.ajax=function(t){return t.dataType||(t.dataType="text"),window.jQuery.ajax(t)},mini._evalAjaxData=function(t,e){var i=t;return"string"==typeof t&&"function"==typeof(i=window.eval("("+t+")"))&&(i=i.call(e)),i};var hasOn=!!jQuery.fn.on;if(jQuery.fn.on||(jQuery.fn.on=function(t,e,i,n){return this.delegate(e,t,i,n)}),mini._lastDevice,mini.updateDevice=function(){var t="mini-xs",e=jQuery(window).width(),i="xs";768<e&&(t+=" mini-sm",i="sm"),992<e&&(t+=" mini-md",i="md"),1200<e&&(t+=" mini-lg",i="lg"),t+=" mini-"+i+"-active",mini._lastDevice!=i&&(jQuery(document.documentElement).removeClass("mini-xs mini-sm mini-md mini-lg mini-xs-active mini-sm-active mini-md-active mini-lg-active ").addClass(t),mini._lastDevice!=i&&jQuery(window).triggerHandler("devicechange",i),mini._lastDevice=i)},mini.getClipboard=function(t){var e="";return window.clipboardData?e=window.clipboardData.getData("Text"):t&&(e=t.clipboardData.getData("text/plain")),e},mini.setClipboard=function(t){if(window.clipboardData)window.clipboardData.setData("Text",t);else{var e=jQuery('<textarea style="position:absolute;left:0;top:-1000px;width:100px;z-index:1000;"></textarea>').appendTo("body").val(t)[0];e.select(),e.focus(),document.execCommand("copy")}},mini.getActiveElement=function(){try{return document.activeElement}catch(t){}},mini.getScrollOffset=function(){if(!mini._scrollOffset){var t=document.createElement("div");t.style.cssText="z-index:1000;width:100px;background:#eee;height:50px;overflow:auto;position:absolute;left:100px;top:100px;",t.innerHTML='<div style="width:50px;height:200px;"></div>',document.body.appendChild(t),mini._scrollOffset=t.offsetWidth-t.clientWidth,t.parentNode.removeChild(t)}return mini._scrollOffset},void 0===window.rootpath&&(rootpath="/"),mini.loadJS=function(t,e){if(t)return"function"==typeof e?mini.loadJS._async(t,e):mini.loadJS._sync(t)},mini.loadJS._js={},mini.loadJS._async=function(t,e){var i=mini.loadJS._js[t];if((i=i||(mini.loadJS._js[t]={create:!1,loaded:!1,callbacks:[]})).loaded)setTimeout(function(){e()},1);else if(i.callbacks.push(e),!i.create){i.create=!0;var n=document.getElementsByTagName("head")[0],s=document.createElement("script");return s.src=t,s.type="text/javascript",setTimeout(function(){document.all?s.onreadystatechange=function(){"loaded"!=s.readyState&&"complete"!=s.readyState||(o(),i.loaded=!0)}:s.onload=function(){o(),i.loaded=!0},n.appendChild(s)},1),s}function o(){for(var t=0;t<i.callbacks.length;t++){var e=i.callbacks[t];e&&e()}i.callbacks.length=0}},mini.loadJS._sync=function(t){if(!loadJS._js[t]){loadJS._js[t]={create:!0,loaded:!0,callbacks:[]};var e=document.getElementsByTagName("head")[0],i=document.createElement("script");return i.type="text/javascript",i.text=loadText(t),e.appendChild(i),i}},mini.loadText=function(t){var e="",i=document.all&&"file:"==location.protocol,n=null;i?n=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n.onreadystatechange=function(){if(4==n.readyState){var t=i?0:200;n.status==t&&(e=n.responseText)}};var s="_t="+(new Date).getTime();return s=-1==t.indexOf("?")?"?"+s:"&"+s,t+=s,n.open("GET",t,!1),n.send(null),e},mini.loadJSON=function(t){var e=loadText(t);return window.eval("("+e+")")},mini.loadCSS=function(t,e){if(t&&!loadCSS._css[t]){var i=document.getElementsByTagName("head")[0],n=document.createElement("link");return e&&(n.id=e),n.href=t,n.rel="stylesheet",n.type="text/css",i.appendChild(n),n}},mini.loadCSS._css={},mini.innerHTML=function(t,e){if("string"==typeof t&&(t=document.getElementById(t)),t){e='<div style="display:none">&nbsp;</div>'+e,t.innerHTML=e,mini.__executeScripts(t);t.firstChild}},mini.__executeScripts=function(t){for(var e=t.getElementsByTagName("script"),i=0,n=e.length;i<n;i++){var s=(r=e[i]).src;if(s)mini.loadJS(s);else{var o=document.createElement("script");o.type="text/javascript",o.text=r.text,t.appendChild(o)}}for(i=e.length-1;0<=i;i--){var r;(r=e[i]).parentNode.removeChild(r)}},mini.supportRem=function(){var t=!1,e=document.createElement("span");try{e.style.fontSize="13rem",/rem/.test(e.style.fontSize)&&(t=!0)}catch(t){}return t}(),mini.getFontSizeRatio=function(){return this._fontSizeRatio||(this._fontSizeRatio=mini.Cookie.get("_font_size_ratio_")||parseInt($("html").css("fontSize"))/window.HtmlBaseFontSize),this._fontSizeRatio},mini.setFontSizeRatio=function(t){this._fontSizeRatio=t},mini.copyTo(mini,{overwrite:function(t,e){var i;if("function"==typeof t)i=t.prototype;else{if("object"!=typeof t)return this;i=t}for(var n in e)i[n]=e[n];return t}}),void 0===window._rootPath)var _rootPath=function(){var t=location.pathname;return 0===t.indexOf("/")&&(t=t.substring(1)),"/"+t.split("/")[0]}();mini.loadJS._sync=function(t){if(!mini.loadJS._js[t]){mini.loadJS._js[t]={create:!0,loaded:!0,callbacks:[]};var e=document.getElementsByTagName("head")[0],i=document.createElement("script");return i.type="text/javascript",i.text=mini.loadText(t),e.appendChild(i),i}},mini.loadCSS=function(t,e){if(t&&!mini.loadCSS._css[t]){var i=document.getElementsByTagName("head")[0],n=document.createElement("link");return e&&(n.id=e),n.href=t,n.rel="stylesheet",n.type="text/css",i.appendChild(n),mini.loadCSS._css[t]=n}},mini.isDisplay=function(t,e,i){"function"==typeof e&&(i=e,e=void 0);for(var n=e||document.body;;){if(null==t||!t.style)return!1;if(t&&("none"==jQuery(t).css("display")||mini.isFirefox&&"IFRAME"==t.nodeName&&0===t.getBoundingClientRect().width&&0===t.getBoundingClientRect().height&&0===t.getBoundingClientRect().x&&0===t.getBoundingClientRect().y)){if(!i)return!1;if(!0!==i(t))return!1}if(t==n)return!0;t=t.parentNode}return!0},mini.loadCSS._css={},mini.externalSrc=_rootPath+"/lib/",mini_useShims=!0,mini_debugger=!1,mini.showPageWarning=function(t){var e=$("#mini-pageWarning");e.length||(e=$("<div></div>",{id:"mini-pageWarning",style:"position:fixed;top:30%;left:50%;margin-left:-280px;width:560px;height:40px;color:#dd2727;background:#f2dede;text-align:center;border-radius:3px;line-height:40px;font-size:13px;"}).html(t.html).append($('<span title= "" style= "position: absolute;top:0;right:10px;font-size:18px;line-height:40px;cursor:pointer" onclick= \'$("#mini-pageWarning").remove();\'></span>')).css("z-index",t.zIndex||9999).appendTo("body"),setTimeout(function(){e.remove(),e=null},t.timeout||15e3))};var _oGetAttrs=mini.Control.prototype.getAttrs;mini.overwrite(mini.Control,{getAttrs:function(t){var e,i=_oGetAttrs.call(this,t);return this.getExtraAttrs&&(e=this.getExtraAttrs.call(this,t),mini.copyTo(i,e)),i}}),mini.overwrite(mini.Container,{getAttrs:function(t){return mini.Container.superclass.getAttrs.call(this,t)}}),mini.getValidErrorToolTip=function(){return mini._errorToolTip||(mini._errorToolTip=new mini.ToolTip,mini._errorToolTip.set({selector:".mini-error[data-tooltip]",placement:"topright",trigger:"focus",theme:"error",defaultTheme:"error"}),$(document).on("mousewheel",function(){mini._errorToolTip.close()})),mini._errorToolTip},mini.overwrite(mini.ValidatorBase,{__doUpdateValid:function(){if(this.el){if(this.removeCls(this._errorCls),this.removeCls(this._invalidCls),"border"==this.errorMode&&(this.el.title=""),0==this._IsValid)switch(mini.getValidErrorToolTip(),jQuery(this.el).attr("data-tooltip",this.errorText),this.errorMode){case"icon":this.addCls(this._errorCls);var t=this.getErrorIconEl();t&&(t.title=this.errorText,jQuery(t).attr("data-placement",this.errorTooltipPlacement));break;case"border":this.addCls(this._invalidCls),this.el.title=this.errorText;default:this._RemoveErrorIcon()}else this._RemoveErrorIcon(),jQuery(this.el).attr("data-tooltip","");this.doLayout()}}}),mini.CheckColumn=function(t){return mini.copyTo({width:30,cellCls:"mini-checkcolumn",headerCls:"mini-checkcolumn",hideable:!0,_multiRowSelect:!0,header:function(t){var e=this.uid+"checkall",i='<span class="mini-grid-checkbox mini-icon '+(t._checkedAll?"mini-grid-checkbox-checked":"")+'" id="'+e+'"></span>';return 0==this.multiSelect&&(i=""),i},getCheckId:function(t,e){return this._gridUID+"$checkcolumn$"+t[this._rowIdField]+"$"+e._id},init:function(t){t.on("_selectchange",this.__OnSelectionChanged,this),t.on("HeaderCellClick",this.__OnHeaderCellClick,this);var e=this;t.on("removerow",function(){t.data&&0==t.data.length&&e._doCheckState(t)});e=this;t.on("load",function(){t.uid;e._doCheckState(t)},this)},renderer:function(t){var e=this.getCheckId(t.record,t.column);t.sender.isSelected&&t.sender.isSelected(t.record);return'<span class="mini-grid-'+(t.sender.getMultiSelect()?"checkbox":"radio")+' mini-icon" id="'+e+'"></span>'},__OnHeaderCellClick:function(t){var e=t.sender;if(t.column==this){var i=e.uid+"checkall",n=document.getElementById(i);if(n){var s="mini-grid-checkbox-checked",o=!mini.hasClass(n,s);if(this._checkedAll=o,e.getMultiSelect())if(o){var r=e.getDataView();e.selects(r),mini.addClass(n,s),setTimeout(function(){mini.addClass(n,s)},30)}else{r=e.getDataView();e.deselects(r),mini.removeClass(n,s)}else e.deselectAll(),o&&(e.select(0),mini.addClass(n,s));e.fire("checkall")}}},__OnSelectionChanged:function(t){var e=t.sender,i=e.toArray(),n=this,s=e.isVirtualScroll(),o=e._viewRegion,r=s&&o?o.start:-1,l=o?o.end:-1,a={};if(-1!=r)for(var h=e.getVisibleRows(),u=r,d=l;u<d;u++){var c=h[u];c&&(a[c._id]=!0)}for(u=0,d=i.length;u<d;u++){var m=i[u];-1==r||a[m._id]}this._timer||(this._timer=setTimeout(function(){n._doCheckState(e),n._timer=null},10))},_doCheckState:function(t){var e=t.uid+"checkall",i=document.getElementById(e);if(i){var n=t.getSelecteds(),s=t.isTree?t.getList().length:t.getData().length;n.length==s&&0!=s?(jQuery(i).addClass("mini-grid-checkbox-checked"),this._checkedAll=!0):(jQuery(i).removeClass("mini-grid-checkbox-checked"),this._checkedAll=!1)}}},t)},mini._Columns.checkcolumn=mini.CheckColumn,mini.ExpandColumn=function(t){return mini.copyTo({width:30,headerAlign:"center",align:"center",draggable:!1,cellStyle:"padding:0",cellCls:"mini-grid-expandCell",hideable:!0,renderer:function(t){return'<i class="mini-grid-ecIcon mini-icon" ></i>'},init:function(t){t.on("cellclick",this.__OnCellClick,this)},__OnCellClick:function(t){var e=t.sender;if(t.column==this&&e.isShowRowDetail&&mini.findParent(t.htmlEvent.target,"mini-grid-ecIcon")){var i=e.isShowRowDetail(t.record);if(i){if(t.cancel=!1,e.fire("beforehiderowdetail",t),!0===t.cancel)return}else if(t.cancel=!1,e.fire("beforeshowrowdetail",t),!0===t.cancel)return;e.autoHideRowDetail&&e.hideAllRowDetail(),i?e.hideRowDetail(t.record):e.showRowDetail(t.record)}}},t)},mini._Columns.expandcolumn=mini.ExpandColumn,mini.htmlDecode=function(t){if("string"!=typeof t)return t;return 0==t.length?"":t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"')},mini.createIFrame=function(t,e,i,n,s){var o=(t=t||"").split("#");t=o[0];var r="";if(!0!==i&&(r="_t="+Math.floor(1e6*Math.random()),-1==t.indexOf("?")?t+="?"+r:t+="&"+r),t&&-1==t.indexOf("_winid")){r="_winid="+mini._WindowID;-1==t.indexOf("?")?t+="?"+r:t+="&"+r}if(mini.iframeParams)for(var l in mini.iframeParams)t+="&"+l+"="+mini.iframeParams[l];o[1]&&(t=t+"#"+o[1]);var a=-1!=t.indexOf(".mht"),h=a?t:"",u='<iframe name="'+mini.newId("mini-iframe-")+'" src="'+("post"==n?"":h)+'" style="width:100%;height:100%;" allowfullscreen="true" frameborder="0"></iframe>',d=document.createElement("div"),c=mini.append(d,u),m=!1;a?m=!0:setTimeout(function(){c&&("post"!=n&&(c.src=t),m=!0)},5),c.attachEvent?c.attachEvent("onload",_):c.onload=_;var f,p=!1,g=!0;function _(){0==m||p||setTimeout(function(){e&&e(c,g),g=!1},1)}if(c._ondestroy=function(){if(p=!0,c.src="",mini.isIE)try{c.contentWindow.document.write(""),c.contentWindow.document.close()}catch(t){}c._ondestroy=null,c=null},"post"==n){f=jQuery("<form />").attr({method:"post",action:t,enctype:"multipart/form-data",target:c.name}).hide().appendTo("body"),setTimeout(function(){f.submit()},10)}return c},mini.getScrollBarWidth=function(){var t=document.createElement("div"),e=document.createElement("p");t.style.display=e.style.display="block",e.style.height="100px",t.style.padding=0,t.style.border="none",t.style.overflow="auto",t.style.height="10px",t.appendChild(e),document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return t.parentNode.removeChild(t),t=e=null,i},function(){var t;Object.defineProperty&&!mini.isIE8?Object.defineProperty(mini,"_scrollBarWidth",{get:function(){return t=t||mini.getScrollBarWidth()}}):jQuery(window).on("load",function(){mini._scrollBarWidth=mini.getScrollBarWidth()})}(),function(){mini.reservedAttrsReg=[/title/,/data-*/];var n=mini.applyTo;mini.applyTo=function(t){var e=function(t){if(t&&t.hasAttributes&&t.hasAttributes()){for(var e,i=t.attributes,n={},s=!1,o=0,r=i.length;o<r;o++)e=i[o].name,l(e)&&(s=!0,n[e]=i[o].value);return s?n:null}}(t=mini.byId(t)),i=n.apply(this,arguments);return function(i,t){if(!i||!t)return;jQuery.map(t,function(t,e){i.setAttribute(e,t)})}(this.el,e),i};var l=Array.prototype.some?function(e){return mini.reservedAttrsReg&&mini.reservedAttrsReg.some(function(t){return t.test(e)})}:function(t){if(!mini.reservedAttrsReg||!mini.reservedAttrsReg.length)return!1;for(var e=0,i=mini.reservedAttrsReg.length;e<i;e++)if(mini.reservedAttrsReg[e].test(t))return!0;return!1}}(),mini.Hidden=function(){mini.Hidden.superclass.constructor.apply(this,arguments)},mini.extend(mini.Hidden,mini.Control,{_clearBorder:!1,formField:!0,value:"",uiCls:"mini-hidden",_create:function(){this.el=document.createElement("input"),this.el.type="hidden",this.el.className="mini-hidden"},setName:function(t){this.name=t,this.el.name=t},setValue:function(t){if(null==t&&(t=""),this.value=t,mini.isDate(t)){var e=t.getFullYear(),i=t.getMonth()+1,n=t.getDate();i=i<10?"0"+i:i,n=n<10?"0"+n:n,this.el.value=e+"-"+i+"-"+n}else this.el.value=t},getValue:function(){return this.value},getFormValue:function(){return this.el.value}}),mini.regClass(mini.Hidden,"hidden"),mini.Popup=function(){mini.Popup.superclass.constructor.apply(this,arguments),this.setVisible(!1),this.setAllowDrag(this.allowDrag),this.setAllowResize(this.allowResize)},mini.extend(mini.Popup,mini.Container,{_clearBorder:!1,uiCls:"mini-popup",_create:function(){this.el=document.createElement("div");this.el.className="mini-popup",this._contentEl=this.el},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this)},this)},doLayout:function(){if(this.canLayout()){mini.Popup.superclass.doLayout.call(this),this._doShadow();var t=this.el.childNodes;if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];mini.layout(n)}}},destroy:function(t){this.el&&(this.el.onmouseover=null),mini._destroying||(mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this)),!1!==t&&(this._modalEl&&jQuery(this._modalEl).remove(),this.shadowEl&&jQuery(this.shadowEl).remove(),this._shimEl&&jQuery(this._shimEl).remove()),this._modalEl=null,this.shadowEl=null,this._shimEl=null,mini.Popup.superclass.destroy.call(this,t)},setWidth:function(t){parseInt(t)==t&&(t+="px"),-1!=(this.width=t).indexOf("px")?mini.setWidth(this.el,t):this.el.style.width=t,this._sizeChanged()},setHeight:function(t){parseInt(t)==t&&(t+="px"),-1!=(this.height=t).indexOf("px")?mini.setHeight(this.el,t):this.el.style.height=t,this._sizeChanged()},setBody:function(t){if(t){mini.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++)mini.append(this._contentEl,t[e])}},getAttrs:function(t){var e=mini.Popup.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["popupEl","popupCls","showAction","hideAction","xAlign","yAlign","modalStyle","onbeforeopen","open","onbeforeclose","onclose"]),mini._ParseBool(t,e,["showModal","showShadow","allowDrag","allowResize"]),mini._ParseInt(t,e,["showDelay","hideDelay","xOffset","yOffset","minWidth","minHeight","maxWidth","maxHeight"]);var i=mini.getChildNodes(t,!0);return e.body=i,e}}),mini.regClass(mini.Popup,"popup"),mini.Popup_prototype={isPopup:!1,popupEl:null,popupCls:"",showAction:"mouseover",hideAction:"outerclick",showDelay:300,hideDelay:500,xAlign:"left",yAlign:"below",xOffset:0,yOffset:0,minWidth:50,minHeight:25,maxWidth:2e3,maxHeight:2e3,showModal:!1,showShadow:!0,modalStyle:"opacity:0.2",_dragCls:"mini-popup-drag",_resizeCls:"mini-popup-resize",allowDrag:!1,allowResize:!1,_unbindPopupEl:function(){this.popupEl&&(mini.un(this.popupEl,"click",this.__OnLeftClick,this),mini.un(this.popupEl,"contextmenu",this.__OnRightClick,this),mini.un(this.popupEl,"mouseover",this.__OnMouseOver,this))},_bindPopupEl:function(){this.popupEl&&(mini.on(this.popupEl,"click",this.__OnLeftClick,this),mini.on(this.popupEl,"contextmenu",this.__OnRightClick,this),mini.on(this.popupEl,"mouseover",this.__OnMouseOver,this))},doShow:function(t){var e={popupEl:this.popupEl,htmlEvent:t,cancel:!1};if(this.fire("BeforeOpen",e),1!=e.cancel&&(this.fire("opening",e),1!=e.cancel))if(this.popupEl){var i={};t&&(i.xy=[t.pageX,t.pageY]),this.showAtEl(this.popupEl,i)}else this.show()},doHide:function(t){var e={popupEl:this.popupEl,htmlEvent:t,cancel:!1};this.fire("BeforeClose",e),1!=e.cancel&&this.close()},show:function(t,e){this.showAtPos(t,e)},showAtPos:function(t,e){this.render(document.body),t||0===t||(t="center"),e||0===e||(e="middle"),this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this._measureSize();var i=mini.getViewportBox(),n=mini.getBox(this.el);"left"==t&&(t=0),"center"==t&&(t=i.width/2-n.width/2),"right"==t&&(t=i.width-n.width),"top"==e&&(e=0),"middle"==e&&(e=i.y+i.height/2-n.height/2),"bottom"==e&&(e=i.height-n.height),t+n.width>i.right&&(t=i.right-n.width),e+n.height>i.bottom&&(e=i.bottom-n.height-2),this._Show(t,e)},_doModal:function(){if(jQuery(this._modalEl).remove(),this.showModal&&0!=this.visible){var t=document.documentElement,e=parseInt(Math.max(document.body.scrollWidth,t?t.scrollWidth:0)),i=parseInt(Math.max(document.body.scrollHeight,t?t.scrollHeight:0)),n=mini.getViewportBox(),s=n.height;s<i&&(s=i);var o=n.width;o<e&&(o=e),this._modalEl=mini.append(document.body,'<div class="mini-modal"></div>'),this._modalEl.style.height=s+"px",this._modalEl.style.width=o+"px",this._modalEl.style.zIndex=mini.getStyle(this.el,"zIndex")-1,mini.setStyle(this._modalEl,this.modalStyle)}},_doShim:function(){if(mini_useShims){if(!this._shimEl){this._shimEl=mini.append(document.body,"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 0; height: 0; top: 0;left:0;scrolling:no;'></iframe>")}this._shimEl.style.display="none",this._doShimTimer&&(clearTimeout(this._doShimTimer),this._doShimTimer=null);var t=this;this._doShimTimer=setTimeout(function(){t._doShimTimer=null,function(){this._shimEl.style.display="";var t=mini.getBox(this.el),e=this._shimEl.style;e.width=t.width+"px",e.height=t.height+"px",e.left=t.x+"px",e.top=t.y+"px";var i=mini.getStyle(this.el,"zIndex");isNaN(i)||(this._shimEl.style.zIndex=i-3)}.call(t)},20)}},_doShadow:function(){this.shadowEl||(this.shadowEl=mini.append(document.body,'<div class="mini-shadow"></div>')),this.shadowEl.style.display=this.showShadow?"":"none",this.shadowEl.style.display="none"},_measureSize:function(){this.el.style.display="";var t=mini.getBox(this.el);t.width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),t=mini.getBox(this.el)),t.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),t=mini.getBox(this.el)),t.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),t=mini.getBox(this.el)),t.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),t=mini.getBox(this.el))},_getWindowOffset:function(t){return[0,0]},showAtEl:function(t,e){if(t=mini.byId(t)){this.isRender()&&this.el.parentNode==document.body||this.render(document.body);var i={atEl:t,popupEl:this.el,xAlign:this.xAlign,yAlign:this.yAlign,xOffset:this.xOffset,yOffset:this.yOffset,popupCls:this.popupCls};mini.copyTo(i,e),mini.addClass(t,i.popupCls),t.popupCls=i.popupCls,this._popupEl=t,this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this.doLayout(),this._measureSize();var n=mini.getViewportBox(),s=mini.getBox(this.el),o=mini.getBox(t),r=i.xy,l=n.width/2-s.width/2,a=0;switch(r&&(l=r[0],a=r[1]),i.xAlign){case"outleft":l=o.x-s.width;break;case"left":l=o.x;break;case"center":l=o.x+o.width/2-s.width/2;break;case"right":l=o.right-s.width;break;case"outright":l=o.right}switch(i.yAlign){case"above":a=o.y-s.height;break;case"top":a=o.y;break;case"middle":a=o.y+o.height/2-s.height/2;break;case"bottom":a=o.bottom-s.height;break;case"below":a=o.bottom}l=parseInt(l),a=parseInt(a);var h=this._getWindowOffset(e);if(i.outYAlign||i.outXAlign){if("above"==i.outYAlign&&a+s.height>n.bottom){var u=o.y-n.y;n.bottom-o.bottom<u&&(a=o.y-s.height)}if("below"==i.outYAlign&&a+s.height>n.bottom){u=o.y-n.y;n.bottom-o.bottom<u&&(a=o.y-s.height)}if("outleft"==i.outXAlign&&l+s.width>n.right){var d=o.x-n.x;n.right-o.right<d&&(l=o.x-s.width)}"right"==i.outXAlign&&l+s.width>n.right&&(l=o.right-s.width),i.alwaysView&&(a<0&&(a=0),a+s.height>n.bottom&&(a=n.bottom-s.height),l<0&&(l=0),l+s.width>n.right&&(l=n.right-s.width)),this._Show(l+h[0],a+h[1])}else this.showAtPos(l+i.xOffset+h[0],a+i.yOffset+h[1])}},_Show:function(t,e){this.el.style.display="",this.el.style.zIndex=mini.getMaxZIndex(),mini.setX(this.el,t),mini.setY(this.el,e),this.setVisible(!0),"mouseout"==this.hideAction&&mini.on(document,"mousemove",this.__OnBodyMouseMove,this);this._doShadow(),this._doModal(),this._doShim(),mini.layoutIFrames(this.el),this.isPopup=!0,mini.on(document,"mousedown",this.__OnBodyMouseDown,this),mini.on(window,"resize",this.__OnWindowResize,this),this.fire("Open")},open:function(){this.show()},close:function(){this.hide()},hide:function(){this.el&&(this.popupEl&&mini.removeClass(this.popupEl,this.popupEl.popupCls),this._popupEl&&mini.removeClass(this._popupEl,this._popupEl.popupCls),this._popupEl=null,jQuery(this._modalEl).remove(),this.shadowEl&&(this.shadowEl.style.display="none"),this._shimEl&&(this._shimEl.style.display="none"),mini.un(document,"mousemove",this.__OnBodyMouseMove,this),mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this),this.setVisible(!1),this.isPopup=!1,this.fire("Close"))},setPopupEl:function(t){(t=mini.byId(t))&&(this._unbindPopupEl(),this.popupEl=t,this._bindPopupEl())},setPopupCls:function(t){this.popupCls=t},setShowAction:function(t){this.showAction=t},setHideAction:function(t){this.hideAction=t},setShowDelay:function(t){this.showDelay=t},setHideDelay:function(t){this.hideDelay=t},setXAlign:function(t){this.xAlign=t},setYAlign:function(t){this.yAlign=t},setxOffset:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.xOffset=t},setyOffset:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.yOffset=t},setShowModal:function(t){this.showModal=t},setShowShadow:function(t){this.showShadow=t},setMinWidth:function(t){isNaN(t)||(this.minWidth=t)},setMinHeight:function(t){isNaN(t)||(this.minHeight=t)},setMaxWidth:function(t){isNaN(t)||(this.maxWidth=t)},setMaxHeight:function(t){isNaN(t)||(this.maxHeight=t)},setAllowDrag:function(t){this.allowDrag=t,mini.removeClass(this.el,this._dragCls),t&&mini.addClass(this.el,this._dragCls)},setAllowResize:function(t){this.allowResize=t,mini.removeClass(this.el,this._resizeCls),t&&mini.addClass(this.el,this._resizeCls)},__OnLeftClick:function(t){if(!this._inAniming&&"leftclick"==this.showAction){var e=jQuery(this.popupEl).attr("allowPopup");"false"!=String(e)&&this.doShow(t)}},__OnRightClick:function(t){if(!this._inAniming&&"rightclick"==this.showAction){var e=jQuery(this.popupEl).attr("allowPopup");"false"!=String(e)&&(t.preventDefault(),this.doShow(t))}},__OnMouseOver:function(t){if(!this._inAniming&&"mouseover"==this.showAction){var e=jQuery(this.popupEl).attr("allowPopup");if("false"!=String(e)&&(clearTimeout(this._hideTimer),this._hideTimer=null,!this.isPopup)){var i=this;this._showTimer=setTimeout(function(){i.doShow(t)},this.showDelay)}}},__OnBodyMouseMove:function(t){"mouseout"==this.hideAction&&this._tryHide(t)},__OnBodyMouseDown:function(t){"outerclick"==this.hideAction&&this.isPopup&&(jQuery(t.target).closest(".mini-popup")[0]||this.within(t)||this.popupEl&&mini.isAncestor(this.popupEl,t.target)||this.doHide(t))},_tryHide:function(t){if(mini.isAncestor(this.el,t.target)||this.popupEl&&mini.isAncestor(this.popupEl,t.target));else{if(clearTimeout(this._showTimer),this._showTimer=null,this._hideTimer)return;var e=this;this._hideTimer=setTimeout(function(){e.doHide(t)},this.hideDelay)}},__OnWindowResize:function(t){this.isDisplay()&&!mini.isIE6&&this._doModal()},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++){if(e[i].within(t))return!0}return!1}},mini.copyTo(mini.Popup.prototype,mini.Popup_prototype),function(){if(hasOn){var i=mini.getTopWindow();if(i){function t(t,e){e==document||jQuery(document).trigger("mousedown")}function e(t){var e=i.jQuery;e&&e(i.document).trigger("topmousedown",[document])}jQuery(i.document).on("topmousedown",t),jQuery(document).on("mousedown",e),jQuery(window).on("unload",function(){jQuery(i.document).off("topmousedown",t),jQuery(document).off("mousedown",e)})}}}(),mini.Button=function(){mini.Button.superclass.constructor.apply(this,arguments)},mini.extend(mini.Button,mini.Control,{text:"",iconCls:"",iconStyle:"",plain:!1,checkOnClick:!1,checked:!1,groupName:"",img:"",_plainCls:"mini-button-plain",_hoverCls:"mini-button-hover",_pressedCls:"mini-button-pressed",_checkedCls:"mini-button-checked",_disabledCls:"mini-button-disabled",allowCls:"",_clearBorder:!1,set:function(t){return"string"==typeof t||(this._allowUpdate=t.text||t.iconStyle||t.iconCls||t.iconPosition,mini.Button.superclass.set.call(this,t),!1===this._allowUpdate&&(this._allowUpdate=!0,this.doUpdate())),this},uiCls:"mini-button",_create:function(){this.el=document.createElement("a"),this.el.className="mini-button mini-state-default mini-corner-all",this.el.hideFocus=!0,this.el.href="javascript:void(0)",this.doUpdate()},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"click",this.__OnClick,this)},this)},destroy:function(t){this.el&&(this.el.onclick=null,this.el.onmousedown=null),this.menu&&(this.menu.owner=null),this.menu=null,mini.Button.superclass.destroy.call(this,t)},doUpdate:function(){if(!1!==this._allowUpdate){var t="",e=this.text,i=this.iconStyle||this.iconCls||this.img;i&&e?t=" mini-button-icon-text ":i&&""===e?(t=" mini-button-icon-only ",e="&nbsp;"):""==e&&(e="&nbsp;");var n=this.iconStyle||"";!n&&this.img&&(n="background-image:url("+this.img+")");var s="";i&&(s='<span class="mini-button-icon mini-icon mini-iconfont '+this.iconCls+'" style="'+n+'"></span>');var o='<span class="mini-button-inner '+t+'">'+s+(e='<span class="mini-button-text">'+e+"</span>")+"</span>";this.allowCls&&(o=o+'<span class="mini-button-allow mini-icon '+this.allowCls+'"></span>'),this.el.innerHTML=o}},href:"",setHref:function(t){this.href=t,this.el.href=t;var e=this.el;setTimeout(function(){e.onclick=null},100)},getHref:function(){return this.href},target:"",setTarget:function(t){this.target=t,this.el.target=t},getTarget:function(){return this.target},setText:function(t){this.text!=t&&(this.text=t,this.doUpdate())},getText:function(){return this.text},setIconCls:function(t){this.iconCls=t,this.doUpdate()},getIconCls:function(){return this.iconCls},setIconStyle:function(t){this.iconStyle=t,this.doUpdate()},getIconStyle:function(){return this.iconStyle},setImg:function(t){this.img=t,this.doUpdate()},getImg:function(){return this.img},setIconPosition:function(t){this.iconPosition="left",this.doUpdate()},getIconPosition:function(){return this.iconPosition},setPlain:function(t){(this.plain=t)?this.addCls(this._plainCls):this.removeCls(this._plainCls)},getPlain:function(){return this.plain},setGroupName:function(t){this.groupName=t},getGroupName:function(){return this.groupName},setCheckOnClick:function(t){this.checkOnClick=t},getCheckOnClick:function(){return this.checkOnClick},setChecked:function(t){var e=this.checked!=t;(this.checked=t)?this.addCls(this._checkedCls):this.removeCls(this._checkedCls),e&&this.fire("CheckedChanged")},getChecked:function(){return this.checked},doClick:function(){this.__OnClick(null)},__OnClick:function(t){if(!this.href&&t&&t.preventDefault(),!this.readOnly&&0!=this.enabled){if(this.focus(),this.checkOnClick)if(this.groupName){var e=this.groupName,i=mini.findControls(function(t){if("button"==t.type&&t.groupName==e)return!0});if(0<i.length){for(var n=0,s=i.length;n<s;n++){var o=i[n];o!=this&&o.setChecked(!1)}this.setChecked(!0)}else this.setChecked(!this.checked)}else this.setChecked(!this.checked);this.fire("click",{htmlEvent:t})}},__OnMouseDown:function(t){this.isReadOnly()||(this.addCls(this._pressedCls),mini.on(document,"mouseup",this.__OnDocMouseUp,this))},__OnDocMouseUp:function(t){this.removeCls(this._pressedCls),mini.un(document,"mouseup",this.__OnDocMouseUp,this)},onClick:function(t,e){this.on("click",t,e)},getAttrs:function(t){var e=mini.Button.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["text","href","iconCls","iconStyle","iconPosition","groupName","menu","onclick","oncheckedchanged","target","img"]),mini._ParseBool(t,e,["plain","checkOnClick","checked"]),e}}),mini.regClass(mini.Button,"button"),mini.MenuButton=function(){mini.MenuButton.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuButton,mini.Button,{uiCls:"mini-menubutton",allowCls:"mini-button-menu",setMenu:function(t){if(mini.isArray(t)&&(t={type:"menu",items:t}),"string"==typeof t){if(!mini.byId(t))return;mini.parse(t),t=mini.get(t)}if(this.menu!==t){this.menu=mini.getAndCreate(t),this.menu.setPopupEl(this.el),this.menu.setPopupCls("mini-button-popup"),this.menu.setShowAction("leftclick"),this.menu.setHideAction("outerclick"),this.menu.setXAlign("left"),this.menu.setYAlign("below"),this.menu.hide(),(this.menu.owner=this).menu.addCls("mini-menu-open");var e=this;this.menu.on("BeforeOpen",function(t){e.split&&!jQuery(t.htmlEvent.target).closest(".mini-button-split")[0]&&(t.cancel=!0)})}},setEnabled:function(t){(this.enabled=t)?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),jQuery(this.el).attr("allowPopup",!!t)}}),mini.regClass(mini.MenuButton,"menubutton"),mini.SplitButton=function(){mini.SplitButton.superclass.constructor.apply(this,arguments)},mini.extend(mini.SplitButton,mini.MenuButton,{split:!0,uiCls:"mini-splitbutton",allowCls:"mini-button-split",__OnClick:function(t){this.split&&jQuery(t.target).closest(".mini-button-split")[0]||mini.SplitButton.superclass.__OnClick.call(this,t)}}),mini.regClass(mini.SplitButton,"splitbutton"),mini.CheckBox=function(){mini.CheckBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.CheckBox,mini.Control,{formField:!0,_clearText:!1,text:"",checked:!1,defaultValue:!1,trueValue:!0,falseValue:!1,checkedCls:"mini-checkbox-checked",set:function(t){if("string"==typeof t)return this;return mini.isNull(t.trueValue)||(this.setTrueValue(t.trueValue),delete t.trueValue),mini.isNull(t.falseValue)||(this.setFalseValue(t.falseValue),delete t.falseValue),mini.CheckBox.superclass.set.call(this,t),this},uiCls:"mini-checkbox",_create:function(){var t=this.uid+"$check";this.el=document.createElement("span"),this.el.className="mini-checkbox",this.el.innerHTML='<input id="'+t+'" name="'+this.id+'" type="checkbox" class="mini-checkbox-check"><span class="mini-checkbox-icon mini-icon" tabIndex="0"></span><label for="'+t+'" onclick="return false;">'+this.text+"</label>",this._checkEl=this.el.firstChild,this._labelEl=this.el.lastChild},destroy:function(t){this._checkEl&&(this._checkEl.onmouseup=null,this._checkEl.onclick=null,this._checkEl=null),mini.CheckBox.superclass.destroy.call(this,t)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"click",this.__onClick,this);mini.on(this.el,"keyup",function(t){32==t.keyCode&&jQuery(t.target).click()}),this._checkEl.onmouseup=function(){return!1};var t=this;this._checkEl.onclick=function(){if(t.isReadOnly())return!1},this._checkEl.checked=this.checked},this)},setName:function(t){this.name=t,mini.setAttr(this._checkEl,"name",this.name)},setText:function(t){this.text!==t&&(this.text=t,this._labelEl.innerHTML=t)},getText:function(){return this.text},setChecked:function(t){t=!0===t||(String(t)==String(this.trueValue)||("true"==t||("True"==t||("1"===String(t)||"Y"==t)))),this.checked!==t&&(this.checked=!!t,this._checkEl.checked=this.checked,this.value=this.getValue());var e=jQuery(this.el);this.checked?e.addClass(this.checkedCls):e.removeClass(this.checkedCls)},getChecked:function(){return this.checked},setValue:function(t){this.checked!==t&&(this.setChecked(t),this.value=this.getValue())},getValue:function(){return String(1==this.checked?this.trueValue:this.falseValue)},getFormValue:function(){return this.getValue()},setTrueValue:function(t){this._checkEl.value=t,this.trueValue=t},getTrueValue:function(){return this.trueValue},setFalseValue:function(t){this.falseValue=t},getFalseValue:function(){return this.falseValue},__onClick:function(t){this.isReadOnly()||(this.setChecked(!this.checked),this.fire("checkedchanged",{checked:this.checked}),this.fire("valuechanged",{value:this.getValue()}),this.fire("click",t,this))},getAttrs:function(t){var e=mini.CheckBox.superclass.getAttrs.call(this,t),i=jQuery(t);e.text=t.innerHTML,mini._ParseString(t,e,["text","oncheckedchanged","onclick","onvaluechanged"]),mini._ParseBool(t,e,["enabled"]);var n=mini.getAttr(t,"checked");n&&(e.checked="true"==n||"checked"==n);var s=i.attr("trueValue");s&&(e.trueValue=s,s=parseInt(s),isNaN(s)||(e.trueValue=s));var o=i.attr("falseValue");return o&&(e.falseValue=o,o=parseInt(o),isNaN(o)||(e.falseValue=o)),e}}),mini.regClass(mini.CheckBox,"checkbox"),jQuery(function(){setTimeout(function(){for(var t=mini.getComponents(),e=0,i=t.length;e<i;e++){var n=t[e];if(n instanceof mini.TextBox){var s=n.getTextEl().value;n.value!==s&&(n.value=s)}}},300)}),mini.TextBox=function(){mini.TextBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.TextBox,mini.ValidatorBase,{name:"",formField:!0,selectOnFocus:!1,allowInput:!0,minWidth:10,minHeight:15,maxLength:5e3,emptyText:"",text:"",value:"",defaultValue:"",height:21,_emptyCls:"mini-textbox-empty",_focusCls:"mini-textbox-focus",_disabledCls:"mini-textbox-disabled",uiCls:"mini-textbox",_InputType:"text",_create:function(){var t='<input  type="'+this._InputType+'" class="mini-textbox-input" autocomplete="off"/>';"textarea"==this._InputType&&(t='<textarea  class="mini-textbox-input" autocomplete="off"/></textarea>'),t='<span class="mini-textbox-border mini-corner-all">'+t+"</span>",t+='<input type="hidden"/>',this.el=document.createElement("span"),this.el.className="mini-textbox",this.el.innerHTML=t,this._borderEl=this.el.firstChild,this._textEl=this._borderEl.firstChild,this._valueEl=this._borderEl.lastChild,this._doEmpty()},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this._textEl,"drop",this.__OnDropText,this),mini_onOne(this._textEl,"change",this.__OnInputTextChanged,this),mini_onOne(this._textEl,"focus",this.__OnFocus,this),mini_onOne(this.el,"mousedown",this.__OnMouseDown,this);var t=this.value;this.value=null,this.el&&this.setValue(t)},this),this.on("validation",this.__OnValidation,this)},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini.on(this._textEl,"blur",this.__OnBlur,this),mini.on(this._textEl,"keydown",this.__OnInputKeyDown,this),mini.on(this._textEl,"keyup",this.__OnInputKeyUp,this),mini.on(this._textEl,"keypress",this.__OnInputKeyPress,this),mini_onOne(this.el,"click",this.__OnClick,this))},destroy:function(t){if(this.el&&(this.el.onmousedown=null),this._textEl){var e=this._textEl;e._placeholder_label&&(e._placeholder_label.onmousedown=null,e._placeholder_label=null),e.onpropertychange=e.ondrop=e.onchange=e.onfocus=null,mini.clearEvent(e),this._textEl=null}this._valueEl&&(mini.clearEvent(this._valueEl),this._valueEl=null),mini.TextBox.superclass.destroy.call(this,t)},doLayout:function(){this._doLabelLayout&&this._labelLayout()},setHeight:function(t){parseInt(t)==t&&(t+="px"),this.height=t,"textarea"==this._InputType&&(this.el.style.height=t,this.doLayout())},setName:function(t){this.name!=t&&(this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name))},setValue:function(t){null==t&&(t=""),(t=String(t)).length>this.maxLength&&(t=t.substring(0,this.maxLength)),this.value=t,this._valueEl.value=this._textEl.value=t,this._doEmpty()},getValue:function(){return this.value},setText:function(t){mini.isNull(t)&&(t=""),this._textEl.value=t},getText:function(){return this._textEl.value},getFormValue:function(){var t=this.value;return null==t&&(t=""),String(t)},setAllowInput:function(t){this.allowInput!=t&&(this.allowInput=t,this.doUpdate())},getAllowInput:function(){return this.allowInput},_placeholdered:!1,_doEmpty:function(){this._textEl.placeholder=this.emptyText,this.emptyText&&mini._placeholder(this._textEl)},setEmptyText:function(t){this.emptyText!=t&&(this.emptyText=t,this._doEmpty())},getEmptyText:function(){return this.emptyText},setMaxLength:function(t){this.maxLength=t,mini.setAttr(this._textEl,"maxLength",t),"textarea"==this._InputType&&mini.isIE&&(mini.on(this._textEl,"keyup",this.__OnMaxLengthKeyUp,this),mini.on(this._textEl,"keypress",this.__OnMaxLengthKeyUp,this),mini.on(this._textEl,"paste",this.__OnPaste,this))},__OnPaste:function(t){var e=this;setTimeout(function(){var t=e._textEl.value;t.length>e.maxLength&&(e._textEl.value=t.substring(0,e.maxLength)),e.__OnInputTextChanged()},0)},__OnMaxLengthKeyUp:function(t){this._textEl.value.length>=this.maxLength&&(this.__OnPaste(t),t.preventDefault())},getMaxLength:function(){return this.maxLength},setReadOnly:function(t){this.readOnly!=t&&(this.readOnly=t,this.doUpdate())},setEnabled:function(t){this.enabled!=t&&(this.enabled=t,this.doUpdate())},doUpdate:function(){this.enabled?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),this.isReadOnly()||0==this.allowInput?(this._textEl.readOnly=!0,mini.addClass(this.el,"mini-textbox-readOnly")):(this._textEl.readOnly=!1,mini.removeClass(this.el,"mini-textbox-readOnly")),this.required?this.addCls(this._requiredCls):this.removeCls(this._requiredCls),this.enabled?this._textEl.disabled=!1:this._textEl.disabled=!0},focus:function(){var e=this;setTimeout(function(){try{if(e._textEl.focus(),mini.isIE){var t=e._textEl.createTextRange();t.collapse(!1),t.select()}}catch(t){}},10)},blur:function(){try{this._textEl.blur()}catch(t){}},selectText:function(){var t=this;!function(){try{t._textEl.select()}catch(t){}}()},getTextEl:function(){return this._textEl},getInputText:function(){return this._textEl.value},setSelectOnFocus:function(t){this.selectOnFocus=t},getSelectOnFocus:function(t){return this.selectOnFocus},_errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl||(this._errorIconEl=mini.append(this.el,'<span class="mini-errorIcon"></span>')),this._errorIconEl},_RemoveErrorIcon:function(){if(this._errorIconEl){var t=this._errorIconEl;jQuery(t).remove()}this._errorIconEl=null},__OnClick:function(t){this.enabled&&this.fire("click",{htmlEvent:t})},__OnMouseDown:function(t){var e=this;"textarea"!=this._InputType&&(mini.isAncestor(this._textEl,t.target)?setTimeout(function(){try{e._textEl.focus()}catch(t){}},1):setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e4,1e4)},1))},__OnInputTextChanged:function(t,e){var i=this.value;this._oldValue=i,this.setValue(this._textEl.value),i===this.getValue()&&!0!==e||this._OnValueChanged()},__OnDropText:function(t){var e=this;setTimeout(function(){e.__OnInputTextChanged(t)},0)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(27==t.keyCode||13==t.keyCode||9==t.keyCode)if("textarea"==this._InputType&&13==t.keyCode);else if(this.__OnInputTextChanged(null),this._textEl.blur(),this._textEl.focus(),13==t.keyCode){this.fire("enter",e)}27==t.keyCode&&t.preventDefault()},__OnInputKeyUp:function(t){this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},__OnFocus:function(t){if(this.doUpdate(),!this.isReadOnly()){if(this._focused=!0,this.addCls(this._focusCls),this._initInputEvents(),this.selectOnFocus){var e=this;setTimeout(function(){e.selectText()},1)}this.fire("focus",{htmlEvent:t})}},__OnBlur:function(t){this._focused=!1;var e=this;setTimeout(function(){0==e._focused&&e.removeCls(e._focusCls)},2),this.fire("blur",{htmlEvent:t}),this.validateOnLeave&&this.isEditable()&&this._tryValidate()},inputStyle:"",setInputStyle:function(t){this.inputStyle=t,mini.setStyle(this._textEl,t)},getAttrs:function(t){var e=mini.TextBox.superclass.getAttrs.call(this,t);jQuery(t);return mini._ParseString(t,e,["value","text","emptyText","inputStyle","onenter","onkeydown","onkeyup","onkeypress","onclick","maxLengthErrorText","minLengthErrorText","onfocus","onblur","vtype","emailErrorText","urlErrorText","floatErrorText","intErrorText","dateErrorText","minErrorText","maxErrorText","rangeLengthErrorText","rangeErrorText","rangeCharErrorText"]),mini._ParseBool(t,e,["allowInput","selectOnFocus"]),mini._ParseInt(t,e,["maxLength","minLength","minHeight","minWidth"]),e},vtype:"",setVtype:function(t){this.vtype=t},getVtype:function(){return this.vtype},__OnValidation:function(t){0!=t.isValid&&mini._ValidateVType(this.vtype,t.value,t,this)},setEmailErrorText:function(t){this.emailErrorText=t},getEmailErrorText:function(){return this.emailErrorText},setUrlErrorText:function(t){this.urlErrorText=t},getUrlErrorText:function(){return this.urlErrorText},setFloatErrorText:function(t){this.floatErrorText=t},getFloatErrorText:function(){return this.floatErrorText},setIntErrorText:function(t){this.intErrorText=t},getIntErrorText:function(){return this.intErrorText},setDateErrorText:function(t){this.dateErrorText=t},getDateErrorText:function(){return this.dateErrorText},setMaxLengthErrorText:function(t){this.maxLengthErrorText=t},getMaxLengthErrorText:function(){return this.maxLengthErrorText},setMinLengthErrorText:function(t){this.minLengthErrorText=t},getMinLengthErrorText:function(){return this.minLengthErrorText},setMaxErrorText:function(t){this.maxErrorText=t},getMaxErrorText:function(){return this.maxErrorText},setMinErrorText:function(t){this.minErrorText=t},getMinErrorText:function(){return this.minErrorText},setRangeLengthErrorText:function(t){this.rangeLengthErrorText=t},getRangeLengthErrorText:function(){return this.rangeLengthErrorText},setRangeCharErrorText:function(t){this.rangeCharErrorText=t},getRangeCharErrorText:function(){return this.rangeCharErrorText},setRangeErrorText:function(t){this.rangeErrorText=t},getRangeErrorText:function(){return this.rangeErrorText}}),mini.regClass(mini.TextBox,"textbox"),mini.Password=function(){mini.Password.superclass.constructor.apply(this,arguments)},mini.extend(mini.Password,mini.TextBox,{uiCls:"mini-password",_InputType:"password",getValue:function(){return this._textEl.value}}),mini.regClass(mini.Password,"password"),mini.TextArea=function(){mini.TextArea.superclass.constructor.apply(this,arguments)},mini.extend(mini.TextArea,mini.TextBox,{maxLength:1e7,height:"",minHeight:50,_InputType:"textarea",uiCls:"mini-textarea",doLayout:function(){if(this.canLayout()){mini.TextArea.superclass.doLayout.call(this);var t=mini.getHeight(this.el);mini.isIE6&&mini.setHeight(this._borderEl,t),(t-=2)<0&&(t=0),this._textEl.style.height=t+"px"}}}),mini.regClass(mini.TextArea,"textarea"),mini.ButtonEdit=function(){mini.ButtonEdit.superclass.constructor.apply(this,arguments);var t=this.isReadOnly();!t&&0!=this.allowInput||(this._textEl.readOnly=!0),0==this.enabled&&this.addCls(this._disabledCls),t&&this.addCls(this._readOnlyCls),this.required&&this.addCls(this._requiredCls)},mini.extend(mini.ButtonEdit,mini.ValidatorBase,{name:"",formField:!0,selectOnFocus:!1,showButton:!0,buttonToolTip:"",closeToolTip:"",showClose:!1,emptyText:"",defaultValue:"",defaultText:"",value:"",text:"",maxLength:1e3,minLength:0,height:21,inputAsValue:!0,allowInput:!0,_noInputCls:"mini-buttonedit-noInput",_readOnlyCls:"mini-buttonedit-readOnly",_disabledCls:"mini-buttonedit-disabled",_emptyCls:"mini-buttonedit-empty",_focusCls:"mini-buttonedit-focus",_buttonCls:"mini-buttonedit-button",_buttonHoverCls:"mini-buttonedit-button-hover",_buttonPressedCls:"mini-buttonedit-button-pressed",_closeCls:"mini-buttonedit-close",set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;return delete t.text,this._allowUpdate=!(0==t.enabled||0==t.allowInput||t.readOnly),mini.ButtonEdit.superclass.set.call(this,t),!1===this._allowUpdate&&(this._allowUpdate=!0,this.doUpdate()),mini.isNull(i)||this.setText(i),mini.isNull(e)||this.setValue(e),this},uiCls:"mini-buttonedit",setButtons:function(t){var e=this;jQuery(".mini-buttonedit-button:not(.mini-buttonedit-trigger)",this.el).remove(),e.buttons=t||[];var i,n="";for(var s=0,o=e.buttons.length;s<o;s++){var r=e.buttons[s];r.name||(r.name="button"+s),i=r,n+=e._createButtonHtml(i.name,i.iconCls,i.tooltip)}mini.append(e._buttonsEl,n),e._doInputLayout(!1)},getButtons:function(){return this.buttons||[]},getButtonByName:function(t){for(var e=this.getButtons(),i=0,n=e.length;i<n;i++){var s=e[i];if(s.name&&s.name==t)return s}return null},_createButtonHtml:function(t,e,i){return e=e||"",'<span title="'+(i=i||"")+'" name="'+(t=t||"")+'" class="mini-buttonedit-button mini-buttonedit-'+t+'" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-icon mini-icon mini-iconfont '+e+'"></span></span>'},_getButtonsHTML:function(){return'<span class="mini-buttonedit-buttons">'+('<span class="mini-buttonedit-close mini-icon" name="close"></span>'+this._getButtonHtml("trigger","",this.buttonToolTip))+"</span>"},_getButtonHtml:function(t,e,i){return this._createButtonHtml(t,e,i)},_create:function(){this.el=document.createElement("span"),this.el.className="mini-buttonedit";var t=this._getButtonsHTML();this.el.innerHTML='<span class="mini-buttonedit-border mini-corner-all"><input type="text" class="mini-buttonedit-input" autocomplete="off"/>'+t+'</span><input name="'+this.name+'" type="hidden"/>',this._borderEl=this.el.firstChild,this._textEl=this._borderEl.firstChild,this._valueEl=this.el.lastChild,this._buttonsEl=this._borderEl.lastChild,this._buttonEl=this._buttonsEl.lastChild,this._closeEl=this._buttonEl.previousSibling,this._doEmpty()},destroy:function(t){this._textEl&&(this._textEl.onchange=this._textEl.onfocus=null,mini.clearEvent(this._textEl),this._textEl=null),this._borderEl=this._buttonsEl=this._buttonEl=this._closeEl=this._valueEl=null,mini.ButtonEdit.superclass.destroy.call(this,t)},_deferSetText:!0,_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this._textEl,"focus",this.__OnFocus,this),mini_onOne(this._textEl,"change",this.__OnInputTextChanged,this);var t=this.text;this.text=null,this.el&&this._deferSetText&&this.setText(t),mini.isIE&&mini.on(this._textEl,"input",this.__input,this)},this)},__input:function(){},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini.on(this.el,"click",this.__OnClick,this),mini.on(this._textEl,"blur",this.__OnBlur,this),mini.on(this._textEl,"keydown",this.__OnInputKeyDown,this),mini.on(this._textEl,"keyup",this.__OnInputKeyUp,this),mini.on(this._textEl,"keypress",this.__OnInputKeyPress,this))},_buttonWidth:20,_closeWidth:20,_doInputLayout:function(t){if(this._buttonEl.style.display=this.showButton?"inline-block":"none",this._buttonEl.title=this.buttonToolTip,this._closeEl&&(this._closeEl.style.display=this.showClose?"inline-block":"none",this._closeEl.title=this.closeToolTip),mini.isNull(mini.ButtonEdit._paddingOffset)){var e=mini.getPaddings(this._borderEl);mini.ButtonEdit._paddingOffset=e.left}var i=this._buttonsEl.offsetWidth,n=i+(0<i?0:mini.ButtonEdit._paddingOffset);this._noLayout=2==n,this._borderEl.style.paddingRight=n+"px",!1!==t&&this.doLayout()},doLayout:function(){this._noLayout&&this._doInputLayout(!1),this._doLabelLayout&&this._labelLayout()},setHeight:function(t){parseInt(t)==t&&(t+="px"),this.height=t},focus:function(){try{this._textEl.focus();var t=this;setTimeout(function(){t._focused&&t._textEl.focus()},10)}catch(t){}},blur:function(){try{this._textEl.blur()}catch(t){}},selectText:function(){this._textEl.select()},getTextEl:function(){return this._textEl},setName:function(t){this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name)},setText:function(t){null==t&&(t="");this.text;this.text=t,this._textEl.value=t,this._doEmpty()},getText:function(){return this._textEl.value},setValue:function(t){null==t&&(t="");this.value;this.value=t,this._valueEl.value=this.getFormValue()},getValue:function(){return this.value},getFormValue:function(){var t=this.value;return null==t&&(t=""),String(t)},_doEmpty:function(){this._textEl.placeholder=this.emptyText,this.emptyText&&mini._placeholder(this._textEl)},setEmptyText:function(t){this.emptyText!=t&&(this.emptyText=t,this._doEmpty())},getEmptyText:function(){return this.emptyText},setMaxLength:function(t){t=parseInt(t),isNaN(t)||(this.maxLength=t,this._textEl.maxLength=t)},getMaxLength:function(){return this.maxLength},setMinLength:function(t){t=parseInt(t),isNaN(t)||(this.minLength=t)},getMinLength:function(){return this.minLength},setEnabled:function(t){mini.ButtonEdit.superclass.setEnabled.call(this,t)},_doReadOnly:function(){var t=this.isReadOnly();t||0==this.allowInput?this._textEl.readOnly=!0:this._textEl.readOnly=!1,t?this.addCls(this._readOnlyCls):this.removeCls(this._readOnlyCls),this.allowInput?this.removeCls(this._noInputCls):this.addCls(this._noInputCls),this.enabled?this._textEl.disabled=!1:this._textEl.disabled=!0},setAllowInput:function(t){this.allowInput=t,this._doReadOnly()},getAllowInput:function(){return this.allowInput},setInputAsValue:function(t){this.inputAsValue=t},getInputAsValue:function(){return this.inputAsValue},autoClear:!1,setAutoClear:function(t){this.autoClear=t},getAutoClear:function(){return this.autoClear},setButtonToolTip:function(t){this.buttonToolTip=t},getButtonToolTip:function(){return this.buttonToolTip},_errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl||(this._errorIconEl=mini.append(this.el,'<span class="mini-errorIcon"></span>')),this._errorIconEl},_RemoveErrorIcon:function(){if(this._errorIconEl){var t=this._errorIconEl;jQuery(t).remove()}this._errorIconEl=null},__OnClick:function(t){if(0!=this.enabled&&(this.fire("click",{htmlEvent:t}),!this.isReadOnly()&&mini.isAncestor(this._borderEl,t.target))){new Date;mini.isAncestor(this._buttonEl,t.target)&&this._OnButtonClick(t),mini.findParent(t.target,this._closeCls)&&(this.autoClear&&(this.value&&0!==this.value||""!==this.text)&&(this._oldValue=this.value,this.setValue(""),this.setText(""),this._OnValueChanged()),this.fire("closeclick",{htmlEvent:t})),this._handlerButtonElClick(t)}},_handlerButtonElClick:function(t){var e=mini.findParent(t.target,"mini-buttonedit-button");if(e&&e!=this._buttonEl&&e!=this._closeEl){var i=jQuery(e).attr("name"),n=this.getButtonByName(i),s={sender:this,button:n,htmlEvent:t};n.handler&&n.handler(s)}},__OnMouseDown:function(t){if(!this.isReadOnly()&&0!=this.enabled&&mini.isAncestor(this._borderEl,t.target)&&!mini.isAncestor(this._textEl,t.target)){this._clickTarget=t.target;var e=this;if(setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e3,1e3)},1),mini.isAncestor(this._buttonEl,t.target)){var i=mini.findParent(t.target,"mini-buttonedit-up"),n=mini.findParent(t.target,"mini-buttonedit-down");i?(mini.addClass(i,this._buttonPressedCls),this._OnButtonMouseDown(t,"up")):n?(mini.addClass(n,this._buttonPressedCls),this._OnButtonMouseDown(t,"down")):(mini.addClass(this._buttonEl,this._buttonPressedCls),this._OnButtonMouseDown(t))}mini.on(document,"mouseup",this.__OnDocMouseUp,this);var s=mini.findParent(t.target,"mini-buttonedit-button");s&&mini.addClass(s,this._buttonPressedCls)}},__OnDocMouseUp:function(t){this._clickTarget=null;var n=this;setTimeout(function(){for(var t=n._buttonEl.getElementsByTagName("*"),e=0,i=t.length;e<i;e++)mini.removeClass(t[e],n._buttonPressedCls);mini.removeClass(n._buttonEl,n._buttonPressedCls),mini.removeClass(n.el,n._pressedCls),jQuery(".mini-buttonedit-button",n._buttonsEl).removeClass(n._buttonPressedCls)},80),mini.un(document,"mouseup",this.__OnDocMouseUp,this)},__OnFocus:function(t){this.doUpdate(),this._initInputEvents(),this.isReadOnly()||(this._focused=!0,this.addCls(this._focusCls),this.selectOnFocus&&this.selectText(),this.fire("focus",{htmlEvent:t}))},__doFocusCls:function(){0==this._focused&&this.removeCls(this._focusCls)},__fireBlur:function(t){var e=this;setTimeout(function(){(function(){0==e._focused&&(e.removeCls(e._focusCls),e.validateOnLeave&&e.isEditable()&&e._tryValidate(),this.fire("blur",{htmlEvent:t}))}).call(e)},2)},__OnBlur:function(t){var e=this;e._focused=!1,setTimeout(function(){e.__fireBlur(t)},10)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(27==t.keyCode||13==t.keyCode||9==t.keyCode){if(this.__OnInputTextChanged(null),13==t.keyCode){this.fire("enter",e)}}27==t.keyCode&&t.preventDefault()},__OnInputTextChanged:function(){var t=this._textEl.value;if(t!=this.text){var e=this.getValue();this._oldValue=e,this.setText(t),this.inputAsValue&&(this.setValue(t),e!==this.getFormValue()&&this._OnValueChanged())}},__OnInputKeyUp:function(t){this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},_OnButtonClick:function(t){var e={htmlEvent:t,cancel:!1};this.fire("beforebuttonclick",e),1!=e.cancel&&this.fire("buttonclick",e)},_OnButtonMouseDown:function(t,e){this.focus(),this.addCls(this._focusCls),this.fire("buttonmousedown",{htmlEvent:t,spinType:e})},onButtonClick:function(t,e){this.on("buttonclick",t,e)},onButtonMouseDown:function(t,e){this.on("buttonmousedown",t,e)},onTextChanged:function(t,e){this.on("textchanged",t,e)},textName:"",setTextName:function(t){this.textName=t,this._textEl&&mini.setAttr(this._textEl,"name",this.textName)},getTextName:function(){return this.textName},setSelectOnFocus:function(t){this.selectOnFocus=t},getSelectOnFocus:function(t){return this.selectOnFocus},setShowClose:function(t){this.showClose=t,this._doInputLayout()},getShowClose:function(t){return this.showClose},setShowButton:function(t){this.showButton=t,this._doInputLayout()},getShowButton:function(){return this.showButton},inputStyle:"",setInputStyle:function(t){this.inputStyle=t,mini.setStyle(this._textEl,t)},getAttrs:function(t){var e=mini.ButtonEdit.superclass.getAttrs.call(this,t);jQuery(t);mini._ParseString(t,e,["value","text","textName","emptyText","inputStyle","defaultText","onenter","onkeydown","onkeyup","onkeypress","onbuttonclick","onbuttonmousedown","ontextchanged","onfocus","onblur","oncloseclick","onclick","buttons","buttonToolTip"]),mini._ParseBool(t,e,["allowInput","inputAsValue","selectOnFocus","showClose","showButton","autoClear"]),mini._ParseInt(t,e,["maxLength","minLength"]);var i=e.buttons;return i&&(i=window.eval("("+i+")"),e.buttons=i||null),e}}),mini.regClass(mini.ButtonEdit,"buttonedit"),mini.PopupEdit=function(){mini.PopupEdit.superclass.constructor.apply(this,arguments),this._createPopup(),this.el.className+=" mini-popupedit"},mini.extend(mini.PopupEdit,mini.ButtonEdit,{uiCls:"mini-popupedit",popup:null,popupCls:"mini-buttonedit-popup",_hoverCls:"mini-buttonedit-hover",_pressedCls:"mini-buttonedit-pressed",_destroyPopup:!0,destroy:function(t){this.isShowPopup()&&this.hidePopup(),this.popup&&(this._destroyPopup&&this.popup.destroy(),this.popup=null),this._popupInner&&(this._popupInner.owner=null,this._popupInner=null),this.el&&(this.el.onmouseover=this.el.onmouseout=null),this._listbox=this.tree=null,mini.PopupEdit.superclass.destroy.call(this,t)},_initEvents:function(){mini.PopupEdit.superclass._initEvents.call(this),mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this)},this)},__OnBlur:function(t){this._focused=!1,this._clickTarget&&mini.isAncestor(this.el,this._clickTarget)||this.isShowPopup()||mini.PopupEdit.superclass.__OnBlur.call(this,t)},__OnMouseOver:function(t){if(!this.isReadOnly()&&!this.allowInput&&mini.findParent(t.target,"mini-buttonedit-border")){var e=mini.findParent(t.target,"mini-buttonedit-button");e&&e!=this._buttonEl||this.addCls(this._hoverCls)}},__OnMouseOut:function(t){this.isReadOnly()||this.allowInput||this.removeCls(this._hoverCls)},__OnMouseDown:function(t){this.isReadOnly()||(mini.PopupEdit.superclass.__OnMouseDown.call(this,t),0==this.allowInput&&mini.findParent(t.target,"mini-buttonedit-border")&&(mini.addClass(this.el,this._pressedCls),mini.on(document,"mouseup",this.__OnDocMouseUp,this)))},__OnInputKeyDown:function(t){if(this.fire("keydown",{htmlEvent:t}),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;9!=t.keyCode&&27!=t.keyCode?(13==t.keyCode&&this.fire("enter"),this.isShowPopup()&&(13!=t.keyCode&&27!=t.keyCode||t.stopPropagation())):this.hidePopup()},__OnInputTextChanged:function(t){this.isShowPopup()?this._textChanged=!0:(this._textChanged=!1,mini.PopupEdit.superclass.__OnInputTextChanged.call(this,t))},within:function(t){return!!mini.isAncestor(this.el,t.target)||!!this.popup.within(t)},popupWidth:"100%",popupMinWidth:50,popupMaxWidth:2e3,popupHeight:"",popupMinHeight:30,popupMaxHeight:2e3,showPopupOnClick:!1,setPopup:function(t){"string"==typeof t&&(mini.parse(t),t=mini.get(t));var e=mini.getAndCreate(t);e&&(e.setVisible(!1),(this._popupInner=e).owner=this,e.on("beforebuttonclick",this.__OnPopupButtonClick,this))},getPopup:function(){return this.popup||this._createPopup(),this.popup},_createPopup:function(){this.popup=new mini.Popup,this.popup.setShowAction("none"),this.popup.setHideAction("outerclick"),this.popup.setPopupEl(this.el),this.popup.on("BeforeClose",this.__OnPopupBeforeClose,this),this.popup.on("close",this.__OnPopupClose,this),mini.on(this.popup.el,"keydown",this.__OnPopupKeyDown,this)},__OnPopupClose:function(t){},__OnPopupBeforeClose:function(t){this.within(t.htmlEvent)?t.cancel=!0:this._unDocumentMousewheel()},__OnPopupKeyDown:function(t){},showPopup:function(){var t={cancel:!1};if(!1!==this._firebeforeshowpopup&&(this.fire("beforeshowpopup",t),1==t.cancel))return!1;var e=this.getPopup();this._syncShowPopup(),e.on("Close",this.__OnPopupHide,this),this._onDocumentMousewheel(),this.fire("showpopup")},_unDocumentMousewheel:function(){mini.un(document,"mousewheel",this.__OnDocumentMousewheel,this),this._mousewheelXY=null},_onDocumentMousewheel:function(){this._unDocumentMousewheel(),this._mousewheelXY=mini.getXY(this.el),mini.on(document,"mousewheel",this.__OnDocumentMousewheel,this)},__OnDocumentMousewheel:function(t){var n=this;setTimeout(function t(){if(n.isShowPopup()){var e=n._mousewheelXY,i=mini.getXY(n.el);e[0]!=i[0]||e[1]!=i[1]?n.hidePopup():setTimeout(t,300)}},300)},_syncShowPopup:function(){var t=this.getPopup();this._popupInner&&this._popupInner.el.parentNode!=this.popup._contentEl&&(this.popup._contentEl.appendChild(this._popupInner.el),this._popupInner.setVisible(!0));var e=mini.getBox(this._borderEl),i=this.popupWidth;"100%"==this.popupWidth&&(i=e.width),t.show(-1e3,-1e3),t.setWidth(i);var n=parseInt(this.popupHeight);isNaN(n)?t.setHeight("auto"):t.setHeight(n),t.setMinWidth(this.popupMinWidth),t.setMinHeight(this.popupMinHeight),t.setMaxWidth(this.popupMaxWidth),t.setMaxHeight(this.popupMaxHeight);var s={xAlign:"left",yAlign:"below",outYAlign:"above",outXAlign:"right",popupCls:this.popupCls,alwaysView:this.alwaysView};this._doShowAtEl(this._borderEl,s)},_doShowAtEl:function(t,e){this.getPopup().showAtEl(t,e)},__OnPopupHide:function(t){this._textChanged&&(this._textChanged=!1,this.__OnInputTextChanged()),this.__doFocusCls(),this.fire("hidepopup")},hidePopup:function(){this.isShowPopup()&&(this.getPopup().close(),!1!==this._autoBlur&&this.blur())},isShowPopup:function(){return!(!this.popup||!this.popup.isDisplay())},alwaysView:!1,setAlwaysView:function(t){this.alwaysView=t},getAlwaysView:function(){return this.alwaysView},setPopupWidth:function(t){this.popupWidth=t},setPopupMaxWidth:function(t){this.popupMaxWidth=t},setPopupMinWidth:function(t){this.popupMinWidth=t},getPopupWidth:function(t){return this.popupWidth},getPopupMaxWidth:function(t){return this.popupMaxWidth},getPopupMinWidth:function(t){return this.popupMinWidth},setPopupHeight:function(t){this.popupHeight=t},setPopupMaxHeight:function(t){this.popupMaxHeight=t},setPopupMinHeight:function(t){this.popupMinHeight=t},getPopupHeight:function(t){return this.popupHeight},getPopupMaxHeight:function(t){return this.popupMaxHeight},getPopupMinHeight:function(t){return this.popupMinHeight},setShowPopupOnClick:function(t){this.showPopupOnClick=t},getShowPopupOnClick:function(t){return this.showPopupOnClick},__OnClick:function(t){if(0!=this.enabled&&(this.fire("click",{htmlEvent:t}),!this.isReadOnly())){if(mini.isAncestor(this._buttonEl,t.target)&&this._OnButtonClick(t),mini.findParent(t.target,this._closeCls))return this.isShowPopup()&&this.hidePopup(),this.autoClear&&(this.value&&0!==this.value||""!==this.text)&&(this.setValue(""),this.setText(""),this._OnValueChanged()),void this.fire("closeclick",{htmlEvent:t});if(0==this.allowInput||mini.isAncestor(this._buttonEl,t.target)||this.showPopupOnClick){var e=mini.findParent(t.target,"mini-buttonedit-button");if(e&&e!=this._buttonEl);else if(this.isShowPopup())this.hidePopup(),this.focus();else{var i=this;setTimeout(function(){i.showPopup()},1)}}this._handlerButtonElClick(t)}},__OnPopupButtonClick:function(t){"close"==t.name&&this.hidePopup(),t.cancel=!0},getAttrs:function(t){var e=mini.PopupEdit.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["popupWidth","popupHeight","popup","onshowpopup","onhidepopup","onbeforeshowpopup"]),mini._ParseInt(t,e,["popupMinWidth","popupMaxWidth","popupMinHeight","popupMaxHeight"]),mini._ParseBool(t,e,["showPopupOnClick","alwaysView"]),e}}),mini.regClass(mini.PopupEdit,"popupedit"),mini.ComboBox=function(){this.data=[],this.columns=[],mini.ComboBox.superclass.constructor.apply(this,arguments),this._initInput()},mini.extend(mini.ComboBox,mini.PopupEdit,{_initInput:function(){var t=this;isFirefox&&(this._textEl.oninput=function(){t._tryQuery()})},__input:function(){document.activeElement==this._textEl&&this._tryQuery()},text:"",value:"",valueField:"id",textField:"text",dataField:"",delimiter:",",multiSelect:!1,data:[],url:"",valueInCheckOrder:!0,columns:[],allowInput:!1,valueFromSelect:!1,popupMaxHeight:200,setDelimiter:function(t){this.delimiter=t,this._listbox&&(this._listbox.delimiter=t)},getDelimiter:function(){return this.delimiter},autoFocusItem:!1,setAutoFocusItem:function(t){this.autoFocusItem=t},getAutoFocusItem:function(){return this.autoFocusItem},set:function(t){if("string"==typeof t)return this;var e=t.text;delete t.text;var i=t.value;delete t.value;var n=t.url;delete t.url;var s=t.data;return delete t.data,mini.ComboBox.superclass.set.call(this,t),mini.isNull(s)||(this.setData(s),t.data=s),mini.isNull(n)||(this.setUrl(n),t.url=n),mini.isNull(i)||(this.setValue(i),t.value=i),mini.isNull(e)||this.setText(e),this},uiCls:"mini-combobox",_createPopup:function(){mini.ComboBox.superclass._createPopup.call(this),this._listbox=new mini.ListBox,this.listbox=this._listbox,this._listbox.delimiter=this.delimiter,this._listbox.setBorderStyle("border:0;"),this._listbox.setStyle("width:100%;height:auto;"),this._listbox.render(this.popup._contentEl),this._listbox.on("beforeitemclick",this.__OnBeforeItemClick,this),this._listbox.on("itemclick",this.__OnItemClick,this),this._listbox.on("drawcell",this.__OnItemDrawCell,this);var e=this;this._listbox.on("beforeload",function(t){e.fire("beforeload",t)},this),this._listbox.on("preload",function(t){e.fire("preload",t)},this),this._listbox.on("load",function(t){e.data=t.data,e.fire("load",t)},this),this._listbox.on("loaderror",function(t){e.fire("loaderror",t)},this)},showPopup:function(){var t={cancel:!1};if(this.fire("beforeshowpopup",t),this._firebeforeshowpopup=!1,1!=t.cancel){this._listbox.setHeight("auto"),mini.ComboBox.superclass.showPopup.call(this);var e=this.popup.el.style.height;""==e||"auto"==e?this._listbox.setHeight("auto"):this._listbox.setHeight("100%");if(!this.multiSelect){var i=jQuery("table .mini-listbox-checkbox",this._listbox.el),n=i.css("display");i.css("display","table-cell"),i.css("display",n)}this._listbox.setValueInCheckOrder(this.valueInCheckOrder),this._listbox.setValue(this.value),this.autoFocusItem&&(""==this.value||mini.isNull(this.value))&&this._listbox._focusItem(0)}},changeOnSelectMethod:!1,isSelected:function(t){return this._listbox.isSelected(t)},_syncValueText:function(){var t=this._listbox.getSelecteds(),e=this._listbox.getValueAndText(t);this.setValue(e[0]),this.setText(e[1])},selectAll:function(){this._listbox.selectAll(),this._syncValueText()},deselectAll:function(){this._listbox.deselectAll(),this._syncValueText()},deselect:function(t){this._listbox.deselect(t),this._syncValueText()},select:function(t){this._listbox.deselectAll(),(t=this.getItem(t))&&(this._oldValue=this.getValue(),this._listbox.select(t),this.__OnItemClick({item:t},!1),this.changeOnSelectMethod&&this._OnValueChanged())},selects:function(t){if(t){var e=this._listbox.getValueAndText(t);this.setValue(e[0]),this._listbox.setValue(this.value)}},getItem:function(t){return"object"==typeof t?t:this.data[t]},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},load:function(t){"string"==typeof t?this.setUrl(t):this.setData(t)},_eval:function(t){return window.eval("("+t+")")},setData:function(t){"string"==typeof t&&(t=this._eval(t)),mini.isArray(t)||(t=[]),this._listbox.setData(t),this.data=this._listbox.data,this.doDataChange()},getData:function(){return this.data},clearOnLoad:!0,setClearOnLoad:function(t){this.clearOnLoad=t},getClearOnLoad:function(){return this.clearOnLoad},doDataChange:function(){var t=this._listbox.getValueAndText(this.value),e=t[0],i=t[1];""!==e||this.clearOnLoad||(e=this.value,i=this.text,this.value=null),this.text=this._textEl.value=i,this.setValue(e)},setUrl:function(t){this.getPopup(),this._listbox.setUrl(t),this.url=this._listbox.url,this.data=this._listbox.data,this.doDataChange()},getUrl:function(){return this.url},setValueField:function(t){this.valueField=t,this._listbox&&this._listbox.setValueField(t)},getValueField:function(){return this.valueField},setTextField:function(t){this._listbox&&this._listbox.setTextField(t),this.textField=t},getTextField:function(){return this.textField},pinyinField:"tag",setPinyinField:function(t){this.pinyinField=t},getPinyinField:function(){return this.pinyinField},setDisplayField:function(t){this.setTextField(t)},setDataField:function(t){this._listbox&&this._listbox.setDataField(t),this.dataField=t},getDataField:function(){return this.dataField},setValueInCheckOrder:function(t){this.valueInCheckOrder=t,this._listbox.valueInCheckOrder=t},getValueInCheckOrder:function(){return this.valueInCheckOrder},setValue:function(t){mini.isNull(t)&&(t="");var e=this._listbox.getValueAndText(t),i=e[0],n=e[1];""!==n&&!mini.isNull(n)||(n=t),this.valueFromSelect&&(""===i||mini.isNull(i))&&(t=n=""),this.value=t,this._valueEl.value=this.value,this.text=this._textEl.value=n,this._doEmpty()},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t,this._listbox&&(this._listbox.setMultiSelect(t),this._listbox.setShowCheckBox(t)))},getMultiSelect:function(){return this.multiSelect},setColumns:function(t){mini.isArray(t)||(t=[]),this.columns=t,this._listbox.setColumns(t)},getColumns:function(){return this.columns},showNullItem:!1,setShowNullItem:function(t){this.showNullItem!=t&&(this.showNullItem=t,this._listbox.setShowNullItem(t))},getShowNullItem:function(){return this.showNullItem},setNullItemText:function(t){this.nullItemText!=t&&(this.nullItemText=t,this._listbox.setNullItemText(t))},getNullItemText:function(){return this.nullItemText},setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},_OnValueChanged:function(){this.validateOnChanged&&this._tryValidate();var n=this;setTimeout(function(){!function(){var t=n.getValue(),e=n.getSelecteds(),i=e[0];n.fire("valuechanged",{value:t,selecteds:e,selected:i,oldValue:n._oldValue})}()},50)},getSelecteds:function(){return this._listbox.findItems(this.value)},getSelected:function(){return this.getSelecteds()[0]},__OnItemDrawCell:function(t){this.fire("drawcell",t)},__OnBeforeItemClick:function(t){var e={item:t.item,cancel:!1};this.fire("beforeitemclick",e),e.cancel&&(t.cancel=!0)},__OnItemClick:function(t,e){var i={item:t.item,cancel:!1};if(!1===e||(this.fire("beforeitemclick",i),!i.cancel)){var n=this._listbox.getSelecteds(),s=this._listbox.getValueAndText(n),o=this.getValue();if(this.setValue(s[0]),this.setText(s[1]),this._oldValue=o,t&&!1!==e){if(o!=this.getValue()){var r=this;setTimeout(function(){r._OnValueChanged()},1)}this.multiSelect||this.hidePopup(),isMobile||this.focus(),this.fire("itemclick",{item:t.item})}}},__OnInputKeyDown:function(t,e){var i={htmlEvent:t};if(this.fire("keydown",i),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(!this.isReadOnly())switch(t.keyCode){case 27:t.preventDefault(),this.isShowPopup()&&t.stopPropagation(),this.hidePopup(),this.focus();break;case 13:if(this.isShowPopup()){t.preventDefault(),t.stopPropagation();var n=this._listbox.getFocusedIndex();if((l=this._listbox.getAt(n))&&!1!==l.enabled&&-1!=n){var s={item:l,cancel:!1};if(this.fire("beforeitemclick",s),0==s.cancel){this._oldValue=this.getValue(),this.multiSelect||(this._listbox.deselectAll(),this._listbox.select(l));var o=this._listbox.getSelecteds(),r=this._listbox.getValueAndText(o);this.setValue(r[0]),this.setText(r[1]),this._OnValueChanged()}}this.hidePopup(),this.focus()}else this.fire("enter",i);break;case 37:break;case 38:if(t.preventDefault(),-1==(n=this._listbox.getFocusedIndex()))if(n=0,!this.multiSelect)(l=this._listbox.findItems(this.value)[0])&&(n=this._listbox.indexOf(l));this.isShowPopup()&&(this.multiSelect||((n-=1)<0&&(n=0),this._listbox._focusItem(n,!0)));break;case 39:break;case 40:var l;if(t.preventDefault(),-1==(n=this._listbox.getFocusedIndex()))if(n=-1,!this.multiSelect)(l=this._listbox.findItems(this.value)[0])&&(n=this._listbox.indexOf(l));this.isShowPopup()?this.multiSelect||((n+=1)>this._listbox.getCount()-1&&(n=this._listbox.getCount()-1),this._listbox._focusItem(n,!0)):this.keyNavEnabled&&(this.showPopup(),this.multiSelect||this._listbox._focusItem(n,!0));break;default:0==this.allowInput||this._tryQuery(this._textEl.value)}}else this.isShowPopup()&&(this._autoBlur=!1,this.hidePopup(),delete this._autoBlur)},__OnInputKeyUp:function(t){this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},_tryQuery:function(e){var i=this;setTimeout(function(){var t=i._textEl.value;t!=e&&i._doQuery(t)},10)},_doQuery:function(t){if(this.autoFilter&&1!=this.multiSelect){var e=[];t=t.toUpperCase();for(var i=0,n=this.data.length;i<n;i++){var s=this.data[i],o=mini._getMap(this.textField,s),r=mini._getMap(this.pinyinField,s);o=o?String(o).toUpperCase():"",r=r?String(r).toUpperCase():"",-1==o.indexOf(t)&&-1==r.indexOf(t)||e.push(s)}if(this._listbox.setData(e),this._filtered=!0,""!==t||this.isShowPopup()){this.showPopup();var l=0;this._listbox.getShowNullItem()&&(l=1);this._listbox._focusItem(l,!0)}}},__OnPopupHide:function(t){(this.valueFromSelect||this._textChanged)&&(this._textChanged=!1,this.__OnInputTextChanged()),""==this._textEl.value&&this._listbox._blurItem(),this._filtered&&(this._filtered=!1,this._listbox.el&&this._listbox.setData(this.data)),this.__doFocusCls(),this.fire("hidepopup")},findItems:function(t){return this._listbox.findItems(t)},__OnInputTextChanged:function(t){if(this.isShowPopup())this._textChanged=!0;else if(this._textChanged=!1,this._oldValue=this.getValue(),0==this.multiSelect){for(var e=this._textEl.value,i=this.getData(),n=null,s=0,o=i.length;s<o;s++){var r=i[s],l=r[this.textField],a=r[this.valueField];if(l==e&&(mini.isNull(this.value)||""===this.value||this.value==a)){n=r;break}}if(n){this._listbox.setValue(n?n[this.valueField]:"");var h=this._listbox.getValue(),u=this._listbox.getValueAndText(h),d=this.getValue();this.setValue(h),this.setText(u[1])}else this.valueFromSelect?(this.setValue(""),this.setText("")):(this.setValue(e),this.setText(e));if(d!=this.getValue()){this._OnValueChanged()}}},setAjaxData:function(t){this.ajaxData=t,this._listbox.setAjaxData(t)},setAjaxType:function(t){this.ajaxType=t,this._listbox.setAjaxType(t)},setAjaxOptions:function(t){this.ajaxOptions=t,this._listbox.setAjaxOptions(t)},autoFilter:!0,setAutoFilter:function(t){this.autoFilter=t},getAutoFilter:function(){return this.autoFilter},getAttrs:function(t){var e=mini.ComboBox.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["url","data","textField","valueField","displayField","nullItemText","pinyinField","delimiter","ondrawcell","onbeforeload","onpreload","onload","onloaderror","onitemclick","onbeforeitemclick"]),mini._ParseBool(t,e,["multiSelect","showNullItem","valueFromSelect","valueInCheckOrder","clearOnLoad","autoFilter","autoFocusItem"]),e.displayField&&(e.textField=e.displayField);var i=e.valueField||this.valueField,n=e.textField||this.textField;if("select"==t.nodeName.toLowerCase()){for(var s=[],o=0,r=t.length;o<r;o++){var l=t.options[o],a={};a[n]=l.text,a[i]=l.value,s.push(a)}0<s.length&&(e.data=s)}else{var h=mini.getChildNodes(t);for(o=0,r=h.length;o<r;o++){var u=h[o],d=jQuery(u).attr("property");d&&("columns"==(d=d.toLowerCase())?e.columns=mini._ParseColumns(u):"data"==d&&(e.data=u.innerHTML))}}return e}}),mini.regClass(mini.ComboBox,"combobox"),mini.DatePicker=function(){mini.DatePicker.superclass.constructor.apply(this,arguments),mini.addClass(this.el,"mini-datepicker"),this.on("validation",this.__OnValidation,this)},mini.extend(mini.DatePicker,mini.PopupEdit,{valueFormat:"",format:"yyyy-MM-dd",maxDate:null,minDate:null,popupWidth:"",viewDate:new Date,showTime:!1,timeFormat:"H:mm",showYesterdayButton:!1,showTodayButton:!0,showClearButton:!0,showOkButton:!1,valueType:"date",uiCls:"mini-datepicker",_getCalendar:function(){mini.DatePicker._Calendar&&!mini.DatePicker._Calendar.destroyed||(mini.DatePicker._Calendar=new mini.Calendar).setStyle("border:0;");return mini.DatePicker._Calendar},destroy:function(t){this._destroyPopup,this._calendar=null,mini.DatePicker.superclass.destroy.call(this,t)},_createPopup:function(){mini.DatePicker.superclass._createPopup.call(this),this._calendar=this._getCalendar()},__OnPopupClose:function(t){this._calendar&&this._calendar.hideMenu()},_monthPicker:!1,showPopup:function(){var t={cancel:!1};if(this.fire("beforeshowpopup",t),1!=t.cancel){this._calendar=this._getCalendar(),this._calendar.beginUpdate(),this._calendar._allowLayout=!1,this._calendar.el.parentNode!=this.popup._contentEl&&this._calendar.render(this.popup._contentEl),this._calendar.set({monthPicker:this._monthPicker,showTime:this.showTime,timeFormat:this.timeFormat,showClearButton:this.showClearButton,showYesterdayButton:this.showYesterdayButton,showTodayButton:this.showTodayButton,showOkButton:this.showOkButton,showWeekNumber:this.showWeekNumber}),this._calendar.setValue(this.value),this.value?this._calendar.setViewDate(this.value):this._calendar.setViewDate(this.viewDate);(function(){if(this._calendar.hideMenu(),this._calendar._target){var t=this._calendar._target;this._calendar.un("timechanged",t.__OnTimeChanged,t),this._calendar.un("dateclick",t.__OnDateClick,t),this._calendar.un("drawdate",t.__OnDrawDate,t)}this._calendar.on("timechanged",this.__OnTimeChanged,this),this._calendar.on("dateclick",this.__OnDateClick,this),this._calendar.on("drawdate",this.__OnDrawDate,this),this._calendar.endUpdate(),this._calendar._allowLayout=!0,this._calendar.doLayout(),this._calendar.focus(),this._calendar._target=this}).call(this),mini.DatePicker.superclass.showPopup.call(this)}},hidePopup:function(){mini.DatePicker.superclass.hidePopup.call(this),this._calendar&&(this._calendar.un("timechanged",this.__OnTimeChanged,this),this._calendar.un("dateclick",this.__OnDateClick,this),this._calendar.un("drawdate",this.__OnDrawDate,this),this._calendar.hideMenu())},within:function(t){return!!mini.isAncestor(this.el,t.target)||!!this._calendar.within(t)},__OnPopupKeyDown:function(t){13==t.keyCode&&this.__OnDateClick(),27==t.keyCode&&(this.hidePopup(),this.focus())},minDateErrorText:"",maxDateErrorText:"",__OnValidation:function(t){if(0!=t.isValid){var e=this.value;if(mini.isDate(e)){var i=mini.parseDate(this.maxDate),n=mini.parseDate(this.minDate),s=this.maxDateErrorText||mini.VTypes.maxDateErrorText,o=this.minDateErrorText||mini.VTypes.minDateErrorText;mini.isDate(i)&&e.getTime()>i.getTime()&&(t.isValid=!1,t.errorText=String.format(s,mini.formatDate(i,this.format))),mini.isDate(n)&&e.getTime()<n.getTime()&&(t.isValid=!1,t.errorText=String.format(o,mini.formatDate(n,this.format)))}}},__OnDrawDate:function(t){var e=t.date,i=mini.parseDate(this.maxDate),n=mini.parseDate(this.minDate);mini.isDate(i)&&e.getTime()>i.getTime()&&(t.allowSelect=!1),mini.isDate(n)&&e.getTime()<n.getTime()&&(t.allowSelect=!1),this.fire("drawdate",t)},__OnDateClick:function(t){if(t&&(!this.showOkButton||"ok"==t.action)){var e=this._calendar.getValue(),i=this.getFormValue("U");this.setValue(e),i!==this.getFormValue("U")&&this._OnValueChanged(),this.hidePopup(),isMobile||this.focus()}},__OnTimeChanged:function(t){if(!this.showOkButton){var e=this._calendar.getValue();this.setValue(e),this._OnValueChanged()}},setFormat:function(t){"string"==typeof t&&this.format!=t&&(this.format=t,this._textEl.value=this._valueEl.value=this.getFormValue())},getFormat:function(){return this.format},setValueFormat:function(t){"string"==typeof t&&this.valueFormat!=t&&(this.valueFormat=t)},getValueFormat:function(){return this.valueFormat},setValue:function(t){"date"==this.valueType?t=mini.parseDate(t):mini.isDate(t)&&(t=mini.formatDate(t,this.format)),mini.isNull(t)&&(t=""),mini.isDate(t)&&(t=new Date(t.getTime()),mini.isDate(t)&&isNaN(t.getTime())&&(t="")),this.value!=t&&(this.value=t),this.text=this._textEl.value=this._valueEl.value=this.getFormValue()},nullValue:"",setNullValue:function(t){"null"==t&&(t=null),this.nullValue=t},getNullValue:function(){return this.nullValue},getValue:function(){if("date"!=this.valueType)return this.value;if(!mini.isDate(this.value))return this.nullValue;var t=this.value;return this.valueFormat&&(t=mini.formatDate(t,this.valueFormat)),t},getFormValue:function(t){return"date"!=this.valueType?this.value:mini.isDate(this.value)?(t=t||this.format,mini.formatDate(this.value,t)):""},setViewDate:function(t){t=mini.parseDate(t),mini.isDate(t)&&(this.viewDate=t)},getViewDate:function(){return this._calendar.getViewDate()},setShowTime:function(t){this.showTime!=t&&(this.showTime=t)},getShowTime:function(){return this.showTime},setTimeFormat:function(t){this.timeFormat!=t&&(this.timeFormat=t)},getTimeFormat:function(){return this.timeFormat},setShowYesterdayButton:function(t){this.showYesterdayButton=t},getShowYesterdayButton:function(){return this.showYesterdayButton},setShowTodayButton:function(t){this.showTodayButton=t},getShowTodayButton:function(){return this.showTodayButton},setShowClearButton:function(t){this.showClearButton=t},getShowClearButton:function(){return this.showClearButton},setShowOkButton:function(t){this.showOkButton=t},getShowOkButton:function(){return this.showOkButton},setShowWeekNumber:function(t){this.showWeekNumber=t},getShowWeekNumber:function(){return this.showWeekNumber},setMaxDate:function(t){this.maxDate=t},getMaxDate:function(){return this.maxDate},setMinDate:function(t){this.minDate=t},getMinDate:function(){return this.minDate},setMaxDateErrorText:function(t){this.maxDateErrorText=t},getMaxDateErrorText:function(){return this.maxDateErrorText},setMinDateErrorText:function(t){this.minDateErrorText=t},getMinDateErrorText:function(){return this.minDateErrorText},__OnInputTextChanged:function(t){var e=this._textEl.value,i=this.getFormValue("U");if("date"==this.valueType){var n=mini.parseDate(e);n&&!isNaN(n)||(n=null)}this.setValue(e),i!==this.getFormValue("U")&&this._OnValueChanged()},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(!this.isReadOnly())switch(t.keyCode){case 27:t.preventDefault(),this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 9:case 13:if(this.isShowPopup())t.preventDefault(),t.stopPropagation(),this.hidePopup(),this.focus();else{this.__OnInputTextChanged(null);var i=this;setTimeout(function(){i.fire("enter",e)},10)}break;case 37:break;case 38:t.preventDefault();break;case 39:break;case 40:this.keyNavEnabled&&(t.preventDefault(),this.showPopup())}}else this.isShowPopup()&&this.hidePopup()},getAttrs:function(t){var e=mini.DatePicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["format","viewDate","timeFormat","ondrawdate","minDate","maxDate","valueType","valueFormat","nullValue","minDateErrorText","maxDateErrorText"]),mini._ParseBool(t,e,["showTime","showTodayButton","showClearButton","showOkButton","showWeekNumber","showYesterdayButton"]),e}}),mini.regClass(mini.DatePicker,"datepicker"),mini.MonthPicker=function(){mini.MonthPicker.superclass.constructor.apply(this,arguments)},mini.extend(mini.MonthPicker,mini.DatePicker,{uiCls:"mini-monthpicker",valueFormat:"",format:"yyyy-MM",_monthPicker:!0}),mini.regClass(mini.MonthPicker,"monthpicker"),mini.Calendar=function(){this.viewDate=new Date,this._selectedDates=[],mini.Calendar.superclass.constructor.apply(this,arguments)},mini.extend(mini.Calendar,mini.Control,{width:220,height:160,monthPicker:!1,_clearBorder:!1,viewDate:null,_selectedDate:"",_selectedDates:[],multiSelect:!1,firstDayOfWeek:0,yesterdayText:"Yesterday",todayText:"Today",clearText:"Clear",okText:"OK",cancelText:"Cancel",daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],format:"MMM, yyyy",timeFormat:"H:mm",showTime:!1,currentTime:!0,rows:1,columns:1,headerCls:"",bodyCls:"",footerCls:"",_todayCls:"mini-calendar-today",_weekendCls:"mini-calendar-weekend",_otherMonthCls:"mini-calendar-othermonth",_selectedDateCls:"mini-calendar-selected",showHeader:!0,showFooter:!0,showWeekNumber:!1,showDaysHeader:!0,showMonthButtons:!0,showYearButtons:!0,showTodayButton:!0,showClearButton:!0,showOkButton:!1,showYesterdayButton:!1,isWeekend:function(t){var e=t.getDay();return 0==e||6==e},getFirstDateOfMonth:function(t){t=new Date(t.getFullYear(),t.getMonth(),1);return mini.getWeekStartDate(t,this.firstDayOfWeek)},getShortWeek:function(t){return this.daysShort[t]},uiCls:"mini-calendar",_create:function(){var t='<tr style="width:100%;"><td style="width:100%;"></td></tr>',e='<table class="mini-calendar" cellpadding="0" cellspacing="0">'+(t+='<tr ><td><div class="mini-calendar-footer"><span style="display:inline-block;"><input name="time" class="mini-timespinner mini-calendar-timespinner" format="'+this.timeFormat+'"/><span class="mini-calendar-footerSpace"></span></span><span class="mini-calendar-tadayButton mini-calendar-button mini-corner-all">'+this.todayText+'</span><span class="mini-calendar-footerSpace"></span><span class="mini-calendar-clearButton mini-calendar-button mini-corner-all">'+this.clearText+'</span><span class="mini-calendar-okButton mini-calendar-button mini-corner-all">'+this.okText+'</span><a href="#" class="mini-calendar-focus" style="position:absolute;left:-10px;top:-10px;width:0px;height:0px;outline:none" hideFocus></a></div></td></tr>')+"</table>",i=document.createElement("div");i.innerHTML=e,this.el=i.firstChild;this.el.getElementsByTagName("tr");var n=this.el.getElementsByTagName("td");this._innerEl=n[0],this._footerEl=mini.byClass("mini-calendar-footer",this.el),this.timeWrapEl=this._footerEl.childNodes[0],this.todayButtonEl=this._footerEl.childNodes[1],this.footerSpaceEl=this._footerEl.childNodes[2],this.closeButtonEl=this._footerEl.childNodes[3],this.okButtonEl=this._footerEl.childNodes[4],this._focusEl=this._footerEl.lastChild,this.yesterdayButtonEl=mini.after(this.todayButtonEl,'<span class="mini-calendar-tadayButton yesterday mini-calendar-button mini-corner-all">'+this.yesterdayText+"</span>"),mini.parse(this._footerEl),this.timeSpinner=mini.getbyName("time",this.el),this.doUpdate()},focus:function(){try{this._focusEl.focus()}catch(t){}},destroy:function(t){this.timeSpinner&&(this.timeSpinner.destroy(),this.timeSpinner=null),this._innerEl=this._footerEl=this.timeWrapEl=this.todayButtonEl=this.footerSpaceEl=this.closeButtonEl=null,this._focusEl=this.okButtonEl=this.yesterdayButtonEl=null,this.timeSpinner=null,mini.Calendar.superclass.destroy.call(this,t)},_initEvents:function(){this.timeSpinner&&this.timeSpinner.on("valuechanged",this.__OnTimeChanged,this),mini._BindEvents(function(){mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"keydown",this.__OnKeyDown,this)},this)},getDateEl:function(t){if(!t)return null;var e=this.uid+"$"+mini.clearTime(t).getTime();return document.getElementById(e)},within:function(t){return!!mini.isAncestor(this.el,t.target)||!(!this.menuEl||!mini.isAncestor(this.menuEl,t.target))},setShowHeader:function(t){this.showHeader=t,this.doUpdate()},getShowHeader:function(){return this.showHeader},setShowFooter:function(t){this.showFooter=t,this.doUpdate()},getShowFooter:function(){return this.showFooter},setShowWeekNumber:function(t){this.showWeekNumber=t,this.doUpdate()},getShowWeekNumber:function(){return this.showWeekNumber},setShowDaysHeader:function(t){this.showDaysHeader=t,this.doUpdate()},getShowDaysHeader:function(){return this.showDaysHeader},setShowMonthButtons:function(t){this.showMonthButtons=t,this.doUpdate()},getShowMonthButtons:function(){return this.showMonthButtons},setShowYearButtons:function(t){this.showYearButtons=t,this.doUpdate()},getShowYearButtons:function(){return this.showYearButtons},setShowTodayButton:function(t){this.showTodayButton=t,this.todayButtonEl.style.display=this.showTodayButton?"":"none",this.doUpdate()},getShowTodayButton:function(){return this.showTodayButton},setShowYesterdayButton:function(t){this.showYesterdayButton=t,this.yesterdayButtonEl.style.display=this.showYesterdayButton?"":"none",this.doUpdate()},getShowYesterdayButton:function(){return this.showYesterdayButton},setShowClearButton:function(t){this.showClearButton=t,this.closeButtonEl.style.display=this.showClearButton?"":"none",this.doUpdate()},getShowClearButton:function(){return this.showClearButton},setShowOkButton:function(t){this.showOkButton=t,this.okButtonEl.style.display=this.showOkButton?"":"none",this.doUpdate()},getShowOkButton:function(){return this.showOkButton},setViewDate:function(t){t=(t=mini.parseDate(t))||new Date,mini.isDate(t)&&(t=new Date(t.getTime())),this.viewDate=t,this.doUpdate()},getViewDate:function(){return this.viewDate},setSelectedDate:function(t){var e;t=mini.parseDate(t),t=mini.isDate(t)?new Date(t.getTime()):"",(e=this.getDateEl(this._selectedDate))&&mini.removeClass(e,this._selectedDateCls),this._selectedDate=t,this._selectedDate&&(this._selectedDate=mini.cloneDate(this._selectedDate)),(e=this.getDateEl(this._selectedDate))&&mini.addClass(e,this._selectedDateCls),this.fire("datechanged")},setSelectedDates:function(t){mini.isArray(t)||(t=[]),this._selectedDates=t,this.doUpdate()},getSelectedDate:function(){return this._selectedDate?this._selectedDate:""},setTime:function(t){this.timeSpinner.setValue(t)},getTime:function(){return this.timeSpinner.getFormValue()},setValue:function(t){this.setSelectedDate(t),t=t||new Date,this.setTime(t)},getValue:function(){var t=this._selectedDate;if(t&&(t=mini.clearTime(t),this.showTime)){var e=this.timeSpinner.getValue();e&&(t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(e.getSeconds()))}return t||""},getFormValue:function(){var t=this.getValue();return t?mini.formatDate(t,"yyyy-MM-dd HH:mm:ss"):""},isSelectedDate:function(t){return!(!t||!this._selectedDate)&&mini.clearTime(t).getTime()==mini.clearTime(this._selectedDate).getTime()},setMultiSelect:function(t){this.multiSelect=t,this.doUpdate()},getMultiSelect:function(){return this.multiSelect},setRows:function(t){isNaN(t)||(t<1&&(t=1),this.rows=t,this.doUpdate())},getRows:function(){return this.rows},setColumns:function(t){isNaN(t)||(t<1&&(t=1),this.columns=t,this.doUpdate())},getColumns:function(){return this.columns},setShowTime:function(t){this.showTime!=t&&(this.showTime=t,this.timeWrapEl.style.display=this.showTime?"":"none",jQuery(this._footerEl).toggleClass("mini-calendar-hastime",this.showTime),this.doLayout())},getShowTime:function(){return this.showTime},setTimeFormat:function(t){this.timeFormat!=t&&(this.timeSpinner.setFormat(t),this.timeFormat=this.timeSpinner.format)},getTimeFormat:function(){return this.timeFormat},doLayout:function(){if(this.canLayout()){this.timeWrapEl.style.display=this.showTime?"":"none",this.todayButtonEl.style.display=this.showTodayButton?"":"none",this.closeButtonEl.style.display=this.showClearButton?"":"none",this.yesterdayButtonEl.style.display=this.showYesterdayButton?"":"none",this.okButtonEl.style.display=this.showOkButton?"":"none",this.footerSpaceEl.style.display=this.showClearButton&&this.showTodayButton?"":"none",this._footerEl.style.display=this.showFooter?"":"none";var t=this._innerEl.firstChild;this.isAutoHeight()?t.parentNode.style.height="":(t.parentNode.style.height="100px",h=jQuery(this.el).height(),h-=jQuery(this._footerEl).outerHeight(),t.parentNode.style.height=h+"px"),mini.layout(this._footerEl),this.monthPicker&&this._tryShowMenu()}},doUpdate:function(){if(this._allowUpdate){for(var t=new Date(this.viewDate.getTime()),e=(1==this.rows&&this.columns,100/this.rows),i='<table class="mini-calendar-views" border="0" cellpadding="0" cellspacing="0">',n=0,s=this.rows;n<s;n++){i+="<tr >";for(var o=0,r=this.columns;o<r;o++)i+='<td style="height:'+e+'%">',i+=this._CreateView(t,n,o),i+="</td>",t=new Date(t.getFullYear(),t.getMonth()+1,1);i+="</tr>"}i+="</table>",this._innerEl.innerHTML=i;var l=this.el;setTimeout(function(){mini.repaint(l)},100),this.doLayout()}},_CreateView:function(t,e,i){var n=t.getMonth(),s=this.getFirstDateOfMonth(t),o=new Date(s.getTime()),r=mini.clearTime(new Date).getTime(),l=(this.value&&mini.clearTime(this.value).getTime(),1<this.rows||1<this.columns),a="";if(a+='<table class="mini-calendar-view" border="0" cellpadding="0" cellspacing="0">',this.showHeader&&(a+='<tr ><td colSpan="10" class="mini-calendar-header"><div class="mini-calendar-headerInner">',0==e&&0==i&&(a+='<div class="mini-calendar-prev mini-icon">',this.showYearButtons&&(a+='<span class="mini-calendar-yearPrev mini-icon"></span>'),this.showMonthButtons&&(a+='<span class="mini-calendar-monthPrev mini-icon"></span>'),a+="</div>"),0==e&&i==this.columns-1&&(a+='<div class="mini-calendar-next mini-icon">',this.showMonthButtons&&(a+='<span class="mini-calendar-monthNext mini-icon"></span>'),this.showYearButtons&&(a+='<span class="mini-calendar-yearNext mini-icon"></span>'),a+="</div>"),a+='<span class="mini-calendar-title">'+mini.formatDate(t,this.format),a+="</div></td></tr>"),this.showDaysHeader){a+='<tr class="mini-calendar-daysheader"><td class="mini-calendar-space"></td>',this.showWeekNumber&&(a+='<td sclass="mini-calendar-weeknumber"></td>');for(var h=(c=this.firstDayOfWeek)+7;c<h;c++){a+='<td yAlign="middle">',a+=this.getShortWeek(c),a+="</td>",s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1)}a+='<td class="mini-calendar-space"></td></tr>'}s=o;for(var u=0;u<=5;u++){if(a+='<tr class="mini-calendar-days"><td class="mini-calendar-space"></td>',this.showWeekNumber){var d=mini.getWeek(s.getFullYear(),s.getMonth()+1,s.getDate());1==String(d).length&&(d="0"+d),a+='<td class="mini-calendar-weeknumber" yAlign="middle">'+d+"</td>"}var c;for(h=(c=this.firstDayOfWeek)+7;c<h;c++){var m=this.isWeekend(s),f=mini.clearTime(s).getTime(),p=f==r,g=this.isSelectedDate(s);n!=s.getMonth()&&l&&(f=-1);var _=this._OnDrawDate(s);a+='<td yAlign="middle" id="',a+=this.uid+"$"+f,a+='" class="mini-calendar-date ',m&&(a+=" mini-calendar-weekend "),0==_.allowSelect&&(a+=" mini-calendar-disabled "),n!=s.getMonth()&&l||(g&&(a+=" "+this._selectedDateCls+" "),p&&(a+=" mini-calendar-today ")),n!=s.getMonth()&&(a+=" mini-calendar-othermonth "),_.dateCls&&(a+=" "+_.dateCls),a+='" style="',_.dateStyle&&(a+=_.dateStyle),a+='">',n!=s.getMonth()&&l||(a+=_.dateHtml),a+="</td>",s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1)}a+='<td class="mini-calendar-space"></td></tr>'}return a+='<tr class="mini-calendar-bottom" colSpan="10"><td ></td></tr>',a+="</table>"},_OnDrawDate:function(t){var e={date:t,dateCls:"",dateStyle:"",dateHtml:t.getDate(),allowSelect:!0};return this.fire("drawdate",e),e},_OnDateClick:function(t,e){var i={date:t,action:e};this.fire("dateclick",i),this._OnValueChanged(),this.hideMenu()},menuEl:null,menuYear:null,menuSelectMonth:null,menuSelectYear:null,_tryShowMenu:function(){if(!this.menuEl){var t=this;setTimeout(function(){t.showMenu()},1)}},showMenu:function(){this.hideMenu(),this.menuYear=10*parseInt(this.viewDate.getFullYear()/10),this._menuselectMonth=this.viewDate.getMonth(),this._menuselectYear=this.viewDate.getFullYear();this.menuEl=mini.append(document.body,'<div class="mini-calendar-menu"></div>'),this.updateMenu(this.viewDate);var t=this.getBox();"0px"==this.el.style.borderWidth&&(this.menuEl.style.border="0"),mini.setBox(this.menuEl,t),mini.on(this.menuEl,"click",this.__OnMenuClick,this),mini.on(this.menuEl,"dblclick",this.__OnMenuDblClick,this),mini.on(document,"mousedown",this.__OnBodyMenuMouseDown,this)},hideMenu:function(){this.menuEl&&(mini.un(this.menuEl,"click",this.__OnMenuClick,this),mini.un(document,"mousedown",this.__OnBodyMenuMouseDown,this),jQuery(this.menuEl).remove(),this.menuEl=null)},updateMenu:function(){if(this.menuEl){for(var t='<div class="mini-calendar-menu-months">',e=0,i=12;e<i;e++){var n=mini.getShortMonth(e),s="";this._menuselectMonth==e&&(s="mini-calendar-menu-selected"),t+='<a id="'+e+'" class="mini-calendar-menu-month '+s+'" href="javascript:void(0);" hideFocus onclick="return false">'+n+"</a>"}t+='<div style="clear:both;"></div></div>',t+='<div class="mini-calendar-menu-years">';for(e=this.menuYear,i=this.menuYear+10;e<i;e++){n=e,s="";this._menuselectYear==e&&(s="mini-calendar-menu-selected"),t+='<a id="'+e+'" class="mini-calendar-menu-year '+s+'" href="javascript:void(0);" hideFocus onclick="return false">'+n+"</a>"}t+='<div class="mini-calendar-menu-prevYear mini-icon"></div><div class="mini-calendar-menu-nextYear mini-icon"></div><div style="clear:both;"></div></div>',t+='<div class="mini-calendar-footer"><span class="mini-calendar-okButton mini-calendar-button mini-corner-all">'+this.okText+'</span><span class="mini-calendar-footerSpace"></span><span class="mini-calendar-cancelButton mini-calendar-button mini-corner-all">'+this.cancelText+'</span></div><div style="clear:both;"></div>',this.menuEl.innerHTML=t}},__OnMenuClick:function(t){var e=this,i=t.target,n="mini-calendar-menu-month",s="mini-calendar-menu-year",o="mini-calendar-menu-selected";function r(){setTimeout(function(){e.updateMenu()},30)}var l=mini.findParent(i,n),a=mini.findParent(i,s);l?(this._menuselectMonth=parseInt(l.id),jQuery("."+n,e.menuEl).removeClass(o),jQuery(i).parent().find("#"+this._menuselectMonth).addClass(o)):a?(this._menuselectYear=parseInt(a.id),jQuery("."+s,e.menuEl).removeClass(o),jQuery(i).parent().find("#"+this._menuselectYear).addClass(o)):mini.findParent(i,"mini-calendar-menu-prevYear")?(this.menuYear=this.menuYear-1,this.menuYear=10*parseInt(this.menuYear/10),r()):mini.findParent(i,"mini-calendar-menu-nextYear")?(this.menuYear=this.menuYear+11,this.menuYear=10*parseInt(this.menuYear/10),r()):mini.findParent(i,"mini-calendar-okButton")?this.__getMonthYear():mini.findParent(i,"mini-calendar-cancelButton")&&(this.monthPicker?this._OnDateClick(null,"cancel"):this.hideMenu())},__OnMenuDblClick:function(t){var e=mini.findParent(t.target,"mini-calendar-menu-year"),i=mini.findParent(t.target,"mini-calendar-menu-month"),n=mini.findParent(t.target,"mini-calendar-date ");(e||i||n)&&(this.monthPicker&&!i&&!e||this.__getMonthYear())},__getMonthYear:function(){var t=new Date(this._menuselectYear,this._menuselectMonth,1);this.monthPicker?(this.setViewDate(t),this.setSelectedDate(t),this._OnDateClick(t)):(this.setViewDate(t),this.hideMenu())},__OnBodyMenuMouseDown:function(t){mini.findParent(t.target,"mini-calendar-menu")||mini.findParent(t.target,"mini-monthpicker")||this.hideMenu()},__OnClick:function(t){var e=this.viewDate;if(0!=this.enabled){var i=t.target,n=mini.findParent(t.target,"mini-calendar-title");if(mini.findParent(i,"mini-calendar-monthNext"))e.setDate(1),e.setMonth(e.getMonth()+1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-yearNext"))e.setDate(1),e.setFullYear(e.getFullYear()+1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-monthPrev"))e.setMonth(e.getMonth()-1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-yearPrev"))e.setFullYear(e.getFullYear()-1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-tadayButton")){var s=!!mini.findParent(i,"yesterday"),o=new Date;if(s&&o.setDate(o.getDate()-1),this.setViewDate(o),this.setSelectedDate(o),this.currentTime){var r=new Date;this.setTime(r)}this._OnDateClick(o,"today")}else mini.findParent(i,"mini-calendar-clearButton")?(this.setSelectedDate(null),this.setTime(null),this._OnDateClick(null,"clear")):mini.findParent(i,"mini-calendar-okButton")?this._OnDateClick(null,"ok"):n&&this.showMenu();var l=mini.findParent(t.target,"mini-calendar-date");if(l&&!mini.hasClass(l,"mini-calendar-disabled")){var a=l.id.split("$"),h=parseInt(a[a.length-1]);if(-1==h)return;var u=new Date(h);this._OnDateClick(u)}}},__OnMouseDown:function(t){if(0!=this.enabled){var e=mini.findParent(t.target,"mini-calendar-date");if(e&&!mini.hasClass(e,"mini-calendar-disabled")){var i=e.id.split("$"),n=parseInt(i[i.length-1]);if(-1==n)return;var s=new Date(n);this.setSelectedDate(s)}}},__OnTimeChanged:function(t){this.fire("timechanged"),this._OnValueChanged()},__OnKeyDown:function(t){if(0!=this.enabled){var e=this.getSelectedDate();switch(e=e||new Date(this.viewDate.getTime()),t.keyCode){case 27:break;case 13:return void(e&&this._OnDateClick(e));case 37:e=mini.addDate(e,-1,"D");break;case 38:e=mini.addDate(e,-7,"D");break;case 39:e=mini.addDate(e,1,"D");break;case 40:e=mini.addDate(e,7,"D")}e.getMonth()!=this.viewDate.getMonth()&&(this.setViewDate(mini.cloneDate(e)),this.focus());var i=this.getDateEl(e);i&&mini.hasClass(i,"mini-calendar-disabled")||(this.setSelectedDate(e),37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode||t.preventDefault())}},_OnValueChanged:function(){this.fire("valuechanged")},getAttrs:function(t){var e=mini.Calendar.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["viewDate","rows","columns","ondateclick","ondrawdate","ondatechanged","timeFormat","ontimechanged","onvaluechanged"]),mini._ParseBool(t,e,["multiSelect","showHeader","showFooter","showWeekNumber","showDaysHeader","showMonthButtons","showYearButtons","showTodayButton","showClearButton","showYesterdayButton","showTime","showOkButton"]),e}}),mini.regClass(mini.Calendar,"calendar"),mini.ListBox=function(){mini.ListBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.ListBox,mini.ListControl,{formField:!0,columns:null,columnWidth:80,showNullItem:!1,nullItemText:"",showEmpty:!1,emptyText:"",showCheckBox:!1,showAllCheckBox:!0,multiSelect:!1,_itemCls:"mini-listbox-item",_itemHoverCls:"mini-listbox-item-hover",_itemSelectedCls:"mini-listbox-item-selected",uiCls:"mini-listbox",_create:function(){this.el=document.createElement("div");this.el.className="mini-listbox",this.el.innerHTML='<div class="mini-listbox-border"><div class="mini-listbox-header"></div><div class="mini-listbox-view"></div><input type="hidden"/></div><div class="mini-errorIcon"></div>',this._borderEl=this.el.firstChild,this._headerEl=this._borderEl.firstChild,this._viewEl=this._borderEl.childNodes[1],this._valueEl=this._borderEl.childNodes[2],this._errorIconEl=this.el.lastChild,this._scrollViewEl=this._viewEl,this._viewEl.innerHTML='<div class="mini-grid-rows-content"></div>',this._contentEl=this._viewEl.firstChild},_initEvents:function(){mini.ListBox.superclass._initEvents.call(this),mini._BindEvents(function(){mini_onOne(this._viewEl,"scroll",this.__OnScroll,this)},this)},destroy:function(t){this._viewEl&&(this._viewEl.onscroll=null,mini.clearEvent(this._viewEl),this._viewEl=null),this._borderEl=this._headerEl=this._viewEl=this._valueEl=this._errorIconEl=this._scrollViewEl=this._contentEl=null,mini.ListBox.superclass.destroy.call(this,t)},setColumns:function(t){mini.isArray(t)||(t=[]),this.columns=t;for(var e=0,i=this.columns.length;e<i;e++){var n=this.columns[e];if(n.type){mini.isNull(n.header)||"function"==typeof n.header||""==n.header.trim()&&delete n.header;var s=mini._getColumn(n.type);if(s){var o=mini.copyTo({},n);mini.copyTo(n,s),mini.copyTo(n,o)}}var r=parseInt(n.width);mini.isNumber(r)&&String(r)==n.width&&(n.width=r+"px"),mini.isNull(n.width)&&(n.width=this.columnWidth+"px")}this.doUpdate()},isVisibleColumn:function(t){return 0!=(t=this.getColumn(t)).visible},getColumn:function(t){var e=typeof t;if("number"==e)return this.columns[t];if("object"==e)return t;for(var i=0,n=this.columns.length;i<n;i++){var s=this.columns[i];if(s.name==t)return s}return null},hideColumn:function(t){(t=this.getColumn(t))&&(t.visible=!1,this.doUpdate())},showColumn:function(t){(t=this.getColumn(t))&&(t.visible=!0,this.doUpdate())},getColumns:function(){return this.columns},doUpdate:function(){if(!1!==this._allowUpdate){var t=this.columns&&0<this.columns.length;t?mini.addClass(this.el,"mini-listbox-showColumns"):mini.removeClass(this.el,"mini-listbox-showColumns"),this._headerEl.style.display=t?"":"none";var e=[];if(t){e[e.length]='<table class="mini-listbox-headerInner" cellspacing="0" cellpadding="0"><tr>';var i=this.uid+"$ck$all";this.showCheckBox&&(e[e.length]='<td class="mini-listbox-checkbox"><input type="checkbox" id="'+i+'"></td>');for(var n=0,s=this.columns.length;n<s;n++){if(!1!==(_=this.columns[n]).visible){var o=_.header;mini.isNull(o)&&(o="&nbsp;");var r=_.width;mini.isNumber(r)&&(r+="px"),e[e.length]='<td class="',_.headerCls&&(e[e.length]=_.headerCls),e[e.length]='" style="',_.headerStyle&&(e[e.length]=_.headerStyle+";"),r&&(e[e.length]="width:"+r+";"),_.headerAlign&&(e[e.length]="text-align:"+_.headerAlign+";"),e[e.length]='">',e[e.length]=o,e[e.length]="</td>"}}e[e.length]="</tr></table>"}this._headerEl.innerHTML=e.join("");e=[];var l=this.data;if(e[e.length]='<table class="mini-listbox-items" cellspacing="0" cellpadding="0">',this.showEmpty&&0==l.length)e[e.length]='<tr><td colspan="20">'+this.emptyText+"</td></tr>";else{this._doNullItem();for(var a=0,h=l.length;a<h;a++){var u,d,c=l[a],m=" ",f=" ";e[e.length]='<tr id="',e[e.length]=this._createItemId(a),e[e.length]='" index="',e[e.length]=a,!(e[e.length]='" class="mini-listbox-item ')===c.enabled&&(e[e.length]=" mini-disabled "),u=e.length,e[e.length]=m,e[e.length]='" style="',d=e.length,e[e.length]=f,e[e.length]='">';var p=this._createCheckId(a),g=(this.name,this.getItemValue(c),"");if(!1===c.enabled&&(g="disabled"),this.showCheckBox&&(!0===c.__NullItem?e[e.length]='<td class="mini-listbox-checkbox"></td>':e[e.length]='<td class="mini-listbox-checkbox"><input '+g+' id="'+p+'" type="checkbox" ></td>'),t)for(n=0,s=this.columns.length;n<s;n++){var _;if(!1!==(_=this.columns[n]).visible){var v=this._OnDrawCell(c,a,_);"number"==typeof(r=_.width)&&(r+="px"),e[e.length]='<td class="',v.cellCls&&(e[e.length]=v.cellCls),e[e.length]='" style="',v.cellStyle&&(e[e.length]=v.cellStyle+";"),r&&(e[e.length]="width:"+r+";"),_.align&&(e[e.length]="text-align:"+_.align+";"),e[e.length]='">',e[e.length]=v.cellHtml,e[e.length]="</td>",v.rowCls&&(m=v.rowCls),v.rowStyle&&(f=v.rowStyle)}}else{v=this._OnDrawCell(c,a,null);e[e.length]='<td class="',v.cellCls&&(e[e.length]=v.cellCls),e[e.length]='" style="',v.cellStyle&&(e[e.length]=v.cellStyle),e[e.length]='">',e[e.length]=v.cellHtml,e[e.length]="</td>",v.rowCls&&(m=v.rowCls),v.rowStyle&&(f=v.rowStyle)}e[u]=m,e[d]=f,e[e.length]="</tr>"}}e[e.length]="</table>";var w=e.join("");this._viewEl.firstChild.innerHTML=w,this._doSelects(),this.doLayout()}},doLayout:function(t){this.columns&&0<this.columns.length?mini.addClass(this.el,"mini-listbox-showcolumns"):mini.removeClass(this.el,"mini-listbox-showcolumns"),this.showCheckBox?mini.removeClass(this.el,"mini-listbox-hideCheckBox"):mini.addClass(this.el,"mini-listbox-hideCheckBox");var e=this.uid+"$ck$all",i=document.getElementById(e);i&&(i.style.display=this.showAllCheckBox?"":"none");var n=this._viewEl;this.isAutoHeight()&&(n.style.height="auto");var s=this.getHeight(!0),o=a=mini.getWidth(this._borderEl,!0);if(mini.isIE6||(n.style.width=a+"px"),(s-=mini.getHeight(this._headerEl))<0&&(s=0),n.style.height=s+"px",isIE){var r=this._headerEl.firstChild,l=this._viewEl.firstChild.firstChild;if(this._viewEl.offsetHeight>=this._viewEl.scrollHeight)l&&(l.style.width="100%"),r&&(r.style.width="100%");else{var a=parseInt(l.parentNode.offsetWidth)+"px";r&&(r.style.width=a)}}this._viewEl.offsetHeight<this._viewEl.scrollHeight?((a=o-(jQuery(this._viewEl).width()-jQuery(this._contentEl).width()))<0&&(a=0),this._headerEl.style.width=a+"px"):this._headerEl.style.width="100%"},setShowCheckBox:function(t){this.showCheckBox=t,this.doUpdate()},getShowCheckBox:function(){return this.showCheckBox},setShowAllCheckBox:function(t){this.showAllCheckBox=t,this.doLayout()},getShowAllCheckBox:function(){return this.showAllCheckBox},setShowNullItem:function(t){this.showNullItem!=t&&(this.showNullItem=t,this._doNullItem(),this.doUpdate())},getShowNullItem:function(){return this.showNullItem},setNullItemText:function(t){this.nullItemText!=t&&(this.nullItemText=t,this._doNullItem(),this.doUpdate())},getNullItemText:function(){return this.nullItemText},_doNullItem:function(){for(var t=0,e=this.data.length;t<e;t++){if((i=this.data[t]).__NullItem){this.data.removeAt(t);break}}var i;this.showNullItem&&((i={__NullItem:!0})[this.textField]="",i[this.valueField]="",this.data.insert(0,i))},_OnDrawCell:function(t,e,i){var n=i?mini._getMap(i.field,t):this.getItemText(t),s={sender:this,index:e,rowIndex:e,record:t,item:t,column:i,field:i?i.field:null,value:n,cellHtml:n,rowCls:null,cellCls:i&&i.cellCls||"",rowStyle:null,cellStyle:i&&i.cellStyle||""};if(this.columns&&0<this.columns.length||0==e&&this.showNullItem&&(s.cellHtml=this.nullItemText),1==s.autoEscape&&(s.cellHtml=mini.htmlEncode(s.cellHtml)),i){i.dateFormat&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(n,i.dateFormat):s.cellHtml=n);var o=i.renderer;o&&(fn="function"==typeof o?o:window[o],fn&&(s.cellHtml=fn.call(i,s)))}return this.fire("drawcell",s),null!==s.cellHtml&&void 0!==s.cellHtml&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s},__OnScroll:function(t){this._headerEl.scrollLeft=this._viewEl.scrollLeft},__OnClick:function(t){var e=this.uid+"$ck$all";if(t.target.id!=e)this._fireEvent(t,"Click");else{var i=document.getElementById(e);if(i){var n=i.checked,s=this.getValue();this._oldValue=s,n?this.selectAll():this.deselectAll(),this._OnSelectionChanged(),s!=this.getValue()&&(this._OnValueChanged(),this.fire("itemclick",{htmlEvent:t}))}}},setValue:function(t){mini.ListBox.superclass.setValue.call(this,t),this._doCheckState()},_doCheckState:function(){var t=this.uid+"$ck$all",e=jQuery(document.getElementById(t));this._isSelectedAll()&&0!=this.getSelecteds().length?e.prop?e.prop("checked",!0):e.attr("checked",!0):e.prop?e.prop("checked",!1):e.attr("checked",!1)},_OnValueChanged:function(t){mini.ListBox.superclass._OnValueChanged.call(this),this._doCheckState()},getAttrs:function(t){var e=mini.ListBox.superclass.getAttrs.call(this,t);if(mini._ParseString(t,e,["nullItemText","ondrawcell"]),mini._ParseBool(t,e,["showCheckBox","showAllCheckBox","showNullItem"]),"select"!=t.nodeName.toLowerCase())for(var i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],r=jQuery(o).attr("property");r&&("columns"==(r=r.toLowerCase())?e.columns=mini._ParseColumns(o):"data"==r&&(e.data=o.innerHTML))}return e}}),mini.regClass(mini.ListBox,"listbox"),mini.CheckBoxList=function(){mini.CheckBoxList.superclass.constructor.apply(this,arguments)},mini.extend(mini.CheckBoxList,mini.ListControl,{formField:!0,_labelFieldCls:"mini-labelfield-checkboxlist",multiSelect:!0,repeatItems:0,repeatLayout:"none",repeatDirection:"horizontal",_itemCls:"mini-checkboxlist-item",_itemHoverCls:"mini-checkboxlist-item-hover",_itemSelectedCls:"mini-checkboxlist-item-selected",_tableCls:"mini-checkboxlist-table",_tdCls:"mini-checkboxlist-td",_checkType:"checkbox",uiCls:"mini-checkboxlist",_create:function(){var t=this.el=document.createElement("div");this.el.className=this.uiCls,this.el.innerHTML='<table cellpadding="0" border="0" cellspacing="0" style="display:table;"><tr><td><div class="mini-list-inner"></div><div class="mini-errorIcon"></div><input type="hidden" /></td></tr></table>',this.cellEl=t.getElementsByTagName("td")[0],this._innerEl=this.cellEl.firstChild,this._valueEl=this.cellEl.lastChild,this._errorIconEl=this.cellEl.childNodes[1],this._borderEl=this.el.firstChild;mini.on(this.el,"keyup",function(t){32==t.keyCode&&$(t.target).click()})},_getRepeatTable:function(){var t=[];if(0<this.repeatItems)if("horizontal"==this.repeatDirection){for(var e=[],i=0,n=this.data.length;i<n;i++){var s=this.data[i];e.length==this.repeatItems&&(t.push(e),e=[]),e.push(s)}t.push(e)}else{for(i=0,n=this.repeatItems>this.data.length?this.data.length:this.repeatItems;i<n;i++)t.push([]);for(i=0,n=this.data.length;i<n;i++){s=this.data[i];t[i%this.repeatItems].push(s)}}else t=[this.data.clone()];return t},doUpdate:function(){for(var t=this.data,e="",i=0,n=t.length;i<n;i++){(r=t[i])._i=i}if("flow"==this.repeatLayout)for(i=0,n=(l=this._getRepeatTable()).length;i<n;i++){for(var s=0,o=(a=l[i]).length;s<o;s++){var r=a[s];e+=this._createItemHtml(r,r._i)}i!=n-1&&(e+="<br/>")}else if("table"==this.repeatLayout){var l=this._getRepeatTable();e+='<table class="'+this._tableCls+'" cellpadding="0" cellspacing="1">';for(i=0,n=l.length;i<n;i++){var a;e+="<tr>";for(s=0,o=(a=l[i]).length;s<o;s++){r=a[s];e+='<td class="'+this._tdCls+'">',e+=this._createItemHtml(r,r._i),e+="</td>"}e+="</tr>"}e+="</table>"}else for(i=0,n=t.length;i<n;i++){r=t[i];e+=this._createItemHtml(r,i)}this._innerEl.innerHTML=e;for(i=0,n=t.length;i<n;i++){delete(r=t[i])._i}},_createItemHtml:function(t,e){var i=this._OnDrawItem(t,e),n=this._createItemId(e),s=this._createCheckId(e),o=this.getItemValue(t),r="",l='<div id="'+n+'" index="'+e+'" class="'+this._itemCls+" ";!1===t.enabled&&(l+=" mini-disabled ",r="disabled");return'onmousedown="this._checked = this.checked;" onclick="this.checked = this._checked"',l+=i.itemCls+'" style="'+i.itemStyle+'"><span tabIndex="0" class="mini-list-icon mini-icon"></span><input style="display:none;" onmousedown="this._checked = this.checked;" onclick="this.checked = this._checked" '+r+' value="'+o+'" id="'+s+'" type="'+this._checkType+'" /><label for="'+s+'" onclick="return false;">',l+=i.itemHtml+"</label></div>"},_OnDrawItem:function(t,e){var i={index:e,item:t,itemHtml:this.getItemText(t),itemCls:"",itemStyle:""};return this.fire("drawitem",i),null!==i.itemHtml&&void 0!==i.itemHtml||(i.itemHtml=""),i},setRepeatItems:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.repeatItems!=t&&(this.repeatItems=t,this.doUpdate())},getRepeatItems:function(){return this.repeatItems},setRepeatLayout:function(t){"flow"!=t&&"table"!=t&&(t="none"),this.repeatLayout!=t&&(this.repeatLayout=t,this.doUpdate())},getRepeatLayout:function(){return this.repeatLayout},setRepeatDirection:function(t){"vertical"!=t&&(t="horizontal"),this.repeatDirection!=t&&(this.repeatDirection=t,this.doUpdate())},getRepeatDirection:function(){return this.repeatDirection},getAttrs:function(t){var e=mini.CheckBoxList.superclass.getAttrs.call(this,t),i=jQuery(t);mini._ParseString(t,e,["ondrawitem"]);var n=parseInt(i.attr("repeatItems"));isNaN(n)||(e.repeatItems=n);var s=i.attr("repeatLayout");s&&(e.repeatLayout=s);var o=i.attr("repeatDirection");return o&&(e.repeatDirection=o),e}}),mini.regClass(mini.CheckBoxList,"checkboxlist"),mini.RadioButtonList=function(){mini.RadioButtonList.superclass.constructor.apply(this,arguments)},mini.extend(mini.RadioButtonList,mini.CheckBoxList,{multiSelect:!1,_itemCls:"mini-radiobuttonlist-item",_itemHoverCls:"mini-radiobuttonlist-item-hover",_itemSelectedCls:"mini-radiobuttonlist-item-selected",_tableCls:"mini-radiobuttonlist-table",_tdCls:"mini-radiobuttonlist-td",_checkType:"radio",uiCls:"mini-radiobuttonlist"}),mini.regClass(mini.RadioButtonList,"radiobuttonlist"),mini.Spinner=function(){mini.Spinner.superclass.constructor.apply(this,arguments),this.setValue(this.minValue)},mini.extend(mini.Spinner,mini.ButtonEdit,{value:0,minValue:0,maxValue:100,increment:1,decimalPlaces:-1,changeOnMousewheel:!0,allowLimitValue:!0,allowLoopValue:!1,allowNull:!1,set:function(t){if("string"==typeof t)return this;var e=t.value;return delete t.value,mini.Spinner.superclass.set.call(this,t),mini.isNull(e)||this.setValue(e),this},uiCls:"mini-spinner",_getButtonHtml:function(){return'<span name="trigger" class="mini-buttonedit-button mini-buttonedit-trigger" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-up"><span class="mini-icon"></span></span><span class="mini-buttonedit-down"><span class="mini-icon"></span></span></span>'},_initEvents:function(){mini.Spinner.superclass._initEvents.call(this),mini._BindEvents(function(){this.on("buttonmousedown",this.__OnButtonMouseDown,this),mini.on(this.el,"mousewheel",this.__OnMousewheel,this)},this)},_ValueLimit:function(){0!=this.allowLimitValue&&(mini.isNull(this.value)&&this.allowNull||(this.minValue>this.maxValue&&(this.maxValue=this.minValue+100),this.value<this.minValue&&this.setValue(this.minValue),this.value>this.maxValue&&this.setValue(this.maxValue)))},getFormValue:function(){var t=this.value;if(t=parseFloat(t),this.allowNull&&isNaN(t))return"";isNaN(t)&&(t=0);var e=String(t).split("."),i=e[0],n=e[1];if(n=n||"",0<this.decimalPlaces){for(var s=n.length,o=this.decimalPlaces;s<o;s++)n+="0";n="."+n}else n=n&&"."+n;return i+n},setValue:function(t){t=mini.parseFloat(t,this.culture,this.format),t=parseFloat(t),isNaN(t)&&!this.allowNull&&(t=this.minValue),isNaN(t)&&this.allowNull&&(t=null),t&&0<=this.decimalPlaces&&(t=parseFloat(t.toFixed(this.decimalPlaces))),this.value!=t&&(this.value=t,this._ValueLimit(),this._valueEl.value=this.value),this.text=this._textEl.value=this.getFormatValue()},setMaxValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.maxValue!=t&&(this.maxValue=t,this._ValueLimit()))},getMaxValue:function(t){return this.maxValue},setMinValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.minValue!=t&&(this.minValue=t,this._ValueLimit()))},getMinValue:function(t){return this.minValue},setIncrement:function(t){t=parseFloat(t),isNaN(t)||this.increment!=t&&(this.increment=t)},getIncrement:function(t){return this.increment},setDecimalPlaces:function(t){t=parseInt(t),isNaN(t)||t<0||(this.decimalPlaces=t)},getDecimalPlaces:function(t){return this.decimalPlaces},setChangeOnMousewheel:function(t){this.changeOnMousewheel=t},getChangeOnMousewheel:function(t){return this.changeOnMousewheel},setAllowLimitValue:function(t){this.allowLimitValue=t},getAllowLimitValue:function(t){return this.allowLimitValue},setAllowNull:function(t){this.allowNull=t},getAllowNull:function(t){return this.allowNull},format:"",setFormat:function(t){"string"==typeof t&&this.format!=t&&(this.format=t,this.setText(this.getFormatValue()))},getFormat:function(){return this.format},getFormatValue:function(){return mini.isNull(this.value)?"":this.format&&mini.isNumber(this.value)?mini.formatNumber(this.value,this.format,this.culture):this.value},setAllowLoopValue:function(t){this.allowLoopValue=t},getAllowLoopValue:function(){return this.allowLoopValue},_SpinTimer:null,_StartSpin:function(i,n,s){this._StopSpin();var o=this;function r(t){0<i?t>o.maxValue&&o.setValue(o.minValue):t<o.minValue&&o.setValue(o.maxValue)}var t=(1e6*this.value+1e6*i)/1e6;this.setValue(t),o.allowLoopValue&&r(t);var l=s,a=new Date;this._SpinTimer=setInterval(function(){var t=o.value+i;o.setValue(t),o.allowLoopValue&&r(t),o._OnValueChanged(),0==--s&&50<n&&o._StartSpin(i,n-100,l+3);var e=new Date;500<e-a&&o._StopSpin(),a=e},n),mini.on(document,"mouseup",this._OnDocumentMouseUp,this)},_StopSpin:function(){clearInterval(this._SpinTimer),this._SpinTimer=null},__OnButtonMouseDown:function(t){this._DownValue=this.getValue(),this.__OnInputTextChanged(),"up"==t.spinType?this._StartSpin(this.increment,230,2):this._StartSpin(-this.increment,230,2)},__OnInputKeyDown:function(t){mini.Spinner.superclass.__OnInputKeyDown.call(this,t);var e=mini.Keyboard;if(!this.isReadOnly())switch(t.keyCode){case e.Top:this.keyNavEnabled&&(this.setValue(this.value+this.increment),this._OnValueChanged());break;case e.Bottom:this.keyNavEnabled&&(this.setValue(this.value-this.increment),this._OnValueChanged())}},__OnMousewheel:function(t){if(!this.isReadOnly()&&0!=this.changeOnMousewheel){this.text!=this._textEl.value&&this.__OnInputTextChanged();var e=t.wheelDelta||t.originalEvent.wheelDelta;mini.isNull(e)&&(e=24*-t.originalEvent.detail);var i=this.increment;e<0&&(i=-i);var n=(1e6*this.value+1e6*i)/1e6;return this.setValue(n),this._OnValueChanged(),!1}},_OnDocumentMouseUp:function(t){this._StopSpin(),mini.un(document,"mouseup",this._OnDocumentMouseUp,this),this._DownValue!=this.getValue()&&this._OnValueChanged()},__OnInputTextChanged:function(t){var e=this.getValue(),i=mini.parseFloat(this._textEl.value,this.culture,this.format);this.setValue(i),e!=this.getValue()&&this._OnValueChanged()},getAttrs:function(t){var e=mini.Spinner.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["minValue","maxValue","increment","decimalPlaces","format"]),mini._ParseBool(t,e,["allowLimitValue","allowNull","changeOnMousewheel","allowLoopValue"]),e}}),mini.regClass(mini.Spinner,"spinner"),mini.TimeSpinner=function(){mini.TimeSpinner.superclass.constructor.apply(this,arguments),this.setValue("00:00:00")},mini.extend(mini.TimeSpinner,mini.ButtonEdit,{value:null,format:"H:mm:ss",uiCls:"mini-timespinner",_getButtonHtml:function(){return'<span class="mini-buttonedit-button" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-up"><span class="mini-icon"></span></span><span class="mini-buttonedit-down"><span class="mini-icon"></span></span></span>'},_initEvents:function(){mini.TimeSpinner.superclass._initEvents.call(this),mini._BindEvents(function(){this.on("buttonmousedown",this.__OnButtonMouseDown,this),mini.on(this.el,"mousewheel",this.__OnMousewheel,this),mini.on(this._textEl,"keydown",this.__OnKeyDown,this)},this)},setFormat:function(t){if("string"==typeof t){this.format!=t&&(this.format=t,this.text=this._textEl.value=this.getFormattedValue())}},getFormat:function(){return this.format},setValue:function(t){t=(t=mini.parseTime(t,this.format))||null,mini.isDate(t)&&(t=new Date(t.getTime())),this.value=t,this.text=this._textEl.value=this.getFormattedValue(),this._valueEl.value=this.getFormValue()},getValue:function(){return null==this.value?null:new Date(this.value.getTime())},getFormValue:function(){return this.value?mini.formatDate(this.value,this.format):""},getFormattedValue:function(){return this.value?mini.formatDate(this.value,this.format):""},_ChangeValue:function(t,e){var i=this.getValue();if(i)switch(e){case"hours":var n=i.getHours()+t;23<n&&(n=23),n<0&&(n=0),i.setHours(n);break;case"minutes":var s=i.getMinutes()+t;59<s&&(s=59),s<0&&(s=0),i.setMinutes(s);break;case"seconds":var o=i.getSeconds()+t;59<o&&(o=59),o<0&&(o=0),i.setSeconds(o)}else i="00:00:00";this.setValue(i)},_SpinTimer:null,_StartSpin:function(e,i,n){this._StopSpin(),this._ChangeValue(e,this._timeType);var s=this,o=n,r=new Date;this._SpinTimer=setInterval(function(){s._ChangeValue(e,s._timeType),0==--n&&50<i&&s._StartSpin(e,i-100,o+3);var t=new Date;500<t-r&&s._StopSpin(),r=t},i),mini.on(document,"mouseup",this._OnDocumentMouseUp,this)},_StopSpin:function(){clearInterval(this._SpinTimer),this._SpinTimer=null},__OnButtonMouseDown:function(t){this._DownValue=this.getFormValue(),this._timeType="hours","up"==t.spinType?this._StartSpin(1,230,2):this._StartSpin(-1,230,2)},_OnDocumentMouseUp:function(t){this._StopSpin(),mini.un(document,"mouseup",this._OnDocumentMouseUp,this),this._DownValue!=this.getFormValue()&&this._OnValueChanged()},__OnInputTextChanged:function(t){var e=this.getFormValue();this.setValue(this._textEl.value),e!=this.getFormValue()&&this._OnValueChanged()},getAttrs:function(t){var e=mini.TimeSpinner.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["format"]),e}}),mini.regClass(mini.TimeSpinner,"timespinner"),mini.Lookup=function(){this.data=[],mini.Lookup.superclass.constructor.apply(this,arguments),mini.on(this._textEl,"mouseup",this.__OnMouseUp,this),this.on("showpopup",this.__OnShowPopup,this)},mini.extend(mini.Lookup,mini.PopupEdit,{allowInput:!0,valueField:"id",textField:"text",delimiter:",",setDelimiter:function(t){this.delimiter=t},getDelimiter:function(){return this.delimiter},multiSelect:!1,data:[],grid:null,_destroyPopup:!1,uiCls:"mini-lookup",destroy:function(t){this.grid&&(this.grid.un("rowclick",this.__OnGridRowClickChanged,this),this.grid.un("load",this.__OnGridLoad,this),this.grid.un("checkall",this.__OnGridRowClickChanged,this),this.grid=null),mini.Lookup.superclass.destroy.call(this,t)},setMultiSelect:function(t){this.multiSelect=t,this.grid&&this.grid.setMultiSelect(t)},setGrid:function(t){"string"==typeof t&&(mini.parse(t),t=mini.get(t)),this.grid=mini.getAndCreate(t),this.grid&&(this.grid.setMultiSelect(this.multiSelect),this.grid.setCheckSelectOnLoad(!1),this.grid.on("rowclick",this.__OnGridRowClickChanged,this),this.grid.on("load",this.__OnGridLoad,this),this.grid.on("checkall",this.__OnGridRowClickChanged,this))},getGrid:function(){return this.grid},setValueField:function(t){this.valueField=t},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},deselectAll:function(){this.data=[],this.setValue(""),this.setText(""),this.grid&&this.grid.deselectAll()},getItemValue:function(t){return String(t[this.valueField])},getItemText:function(t){var e=t[this.textField];return mini.isNull(e)?"":String(e)},getValueAndText:function(t){mini.isNull(t)&&(t=[]);for(var e=[],i=[],n=0,s=t.length;n<s;n++){var o=t[n];o&&(e.push(this.getItemValue(o)),i.push(this.getItemText(o)))}return[e.join(this.delimiter),i.join(this.delimiter)]},_createData:function(){this.value=mini.isNull(this.value)?"":String(this.value),this.text=mini.isNull(this.text)?"":String(this.text);var t=[],e=this.value.split(this.delimiter),i=this.text.split(this.delimiter),n=e.length;if(this.value)for(var s=0,o=n;s<o;s++){var r={},l=e[s],a=i[s];r[this.valueField]=l||"",r[this.textField]=a||"",t.push(r)}this.data=t},_getValueMaps:function(t){for(var e={},i=0,n=t.length;i<n;i++){var s=t[i];e[s[this.valueField]]=s}return e},setValue:function(t){mini.Lookup.superclass.setValue.call(this,t),this._createData()},setText:function(t){mini.Lookup.superclass.setText.call(this,t),this._createData()},__OnGridRowClickChanged:function(t){var s=this.grid,e=this._getValueMaps(s.getList()),i=this._getValueMaps(s.getSelecteds()),n=this._getValueMaps(this.data);0==this.multiSelect&&(n={},this.data=[]);var o={};for(var r in n){var l=n[r];e[r]&&(i[r]||(o[r]=l))}for(var a=this.data.length-1;0<=a;a--){o[r=(l=this.data[a])[this.valueField]]&&this.data.removeAt(a)}var h=[];for(var r in i){l=i[r];n[r]||h.push(l)}h.sort(function(t,e){var i=s.indexOf(t),n=s.indexOf(e);return i<n?-1:i==n?0:1}),this.data.addRange(h);var u=this.getValueAndText(this.data);this.setValue(u[0]),this.setText(u[1]),this._OnValueChanged()},__OnGridLoad:function(t){this.__OnShowPopup(t)},__OnShowPopup:function(t){for(var e=String(this.value).split(this.delimiter),i={},n=0,s=e.length;n<s;n++){i[e[n]]=1}var o=this.grid.getData(),r=[];for(n=0,s=o.length;n<s;n++){var l=o[n];i[l[this.valueField]]&&r.push(l)}this.grid.selects(r)},doUpdate:function(){mini.Lookup.superclass.doUpdate.call(this),this._textEl.readOnly=!0,this.el.style.cursor="default"},__OnInputKeyDown:function(t){mini.Lookup.superclass.__OnInputKeyDown.call(this,t),t.keyCode},__OnMouseUp:function(t){if(!this.isReadOnly()){var e=mini.getSelectRange(this._textEl),i=e[0];e[1],this._findTextIndex(i)}},_findTextIndex:function(t){var e=-1;if(""==this.text)return e;for(var i=String(this.text).split(this.delimiter),n=0,s=0,o=i.length;s<o;s++){var r=i[s];if(n<t&&t<=n+r.length){e=s;break}n=n+r.length+1}return e},getAttrs:function(t){var e=mini.Lookup.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["grid","valueField","textField","delimiter"]),mini._ParseBool(t,e,["multiSelect"]),e}}),mini.regClass(mini.Lookup,"lookup"),mini.TextBoxList=function(t){mini.TextBoxList.superclass.constructor.call(this,null),this.data=[],this.selecteds=[],this.doUpdate(),t&&mini.applyTo.call(this,t)},mini.extend(mini.TextBoxList,mini.ValidatorBase,{formField:!0,remote:!0,value:"",text:"",valueField:"id",textField:"text",selecteds:null,data:null,url:"",delay:150,allowInput:!0,editIndex:0,_focusCls:"mini-textboxlist-focus",_itemHoverClass:"mini-textboxlist-item-hover",_itemSelectedClass:"mini-textboxlist-item-selected",_closeHoverClass:"mini-textboxlist-close-hover",textName:"",setTextName:function(t){this.textName=t},getTextName:function(){return this.textName},getData:function(){return this.data},setData:function(t){this.data=t},getRemote:function(){return this.remote},setRemote:function(t){this.remote=t},uiCls:"mini-textboxlist",_create:function(){var t=document.createElement("div");t.innerHTML='<table class="mini-textboxlist mini-corner-all" cellpadding="0" cellspacing="0"><tr ><td class="mini-textboxlist-border mini-corner-all"><ul></ul><a href="#"></a><input type="hidden"/></td></tr></table>',this.el=t.firstChild;var e=this.el.getElementsByTagName("td")[0];this.ulEl=e.firstChild,this._valueEl=e.lastChild,this.focusEl=e.childNodes[1]},destroy:function(t){this.isShowPopup&&this.hidePopup(),this._inputEl&&(mini.clearEvent(this._inputEl),this._inputEl.onkeyup=null,this._inputEl.onfocus=null,this._inputEl.onblur=null),mini.un(document,"mousedown",this.__OnDocMouseDown,this),mini.TextBoxList.superclass.destroy.call(this,t)},_initEvents:function(){mini.TextBoxList.superclass._initEvents.call(this),mini.on(this.el,"mousemove",this.__OnMouseMove,this),mini.on(this.el,"mouseout",this.__OnMouseOut,this),mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"keydown",this.__OnKeyDown,this),mini.on(document,"mousedown",this.__OnDocMouseDown,this)},__OnDocMouseDown:function(t){if(!this.isReadOnly()){this.isShowPopup&&(mini.isAncestor(this.popup.el,t.target)||this.hidePopup());var e=this;this._focused&&0==this.within(t)&&(clearInterval(this._ValueChangeTimer),this.select(null,!1),setTimeout(function(){e.showInput(!1)},100),this.removeCls(this._focusCls),this._focused=!1)}},errorIconEl:null,getErrorIconEl:function(){if(!this._errorIconEl){var t=this.el.rows[0].insertCell(1);t.style.cssText="width:18px;vertical-align:top;",t.innerHTML='<div class="mini-errorIcon"></div>',this._errorIconEl=t.firstChild}return this._errorIconEl},_RemoveErrorIcon:function(){this._errorIconEl&&jQuery(this._errorIconEl.parentNode).remove(),this._errorIconEl=null},doLayout:function(){0!=this.canLayout()&&(mini.TextBoxList.superclass.doLayout.call(this),this.doReadOnly())},doReadOnly:function(){this.isReadOnly()||0==this.allowInput?this._inputEl.readOnly=!0:this._inputEl.readOnly=!1},doUpdate:function(){this._ValueChangeTimer&&clearInterval(this._ValueChangeTimer),this._inputEl&&mini.un(this._inputEl,"keydown",this.__OnInputKeyDown,this);for(var t=[],e=this.uid,i=0,n=this.selecteds.length;i<n;i++){var s=this.selecteds[i],o=e+"$text$"+i,r=mini._getMap(this.textField,s);mini.isNull(r)&&(r=""),t[t.length]='<li id="'+o+'" class="mini-textboxlist-item">',t[t.length]=r,t[t.length]='<span class="mini-textboxlist-close"></span></li>'}var l=e+"$input";t[t.length]='<li id="'+l+'" class="mini-textboxlist-inputLi"><input class="mini-textboxlist-input" type="text" autocomplete="off"></li>',this.ulEl.innerHTML=t.join(""),this.editIndex=this.selecteds.length,this.editIndex<0&&(this.editIndex=0),this.inputLi=this.ulEl.lastChild,this._inputEl=this.inputLi.firstChild,this._inputEl.placeholder=this.placeholder,mini.on(this._inputEl,"keydown",this.__OnInputKeyDown,this);var a=this;this._inputEl.onkeyup=function(){a._syncInputSize()},a._ValueChangeTimer=null,a._LastInputText=a._inputEl.value,this._inputEl.onfocus=function(){a._LastInputText=a._inputEl.value,a._ValueChangeTimer=setInterval(function(){if(!a._focused)return clearInterval(a._ValueChangeTimer),void(a._ValueChangeTimer=null);a._LastInputText!=a._inputEl.value&&(a._startQuery(),a._LastInputText=a._inputEl.value)},10),a.addCls(a._focusCls),a._focused=!0,a.fire("focus")},this._inputEl.onblur=function(){clearInterval(a._ValueChangeTimer),a._ValueChangeTimer=null,a.fire("blur"),a.validateOnLeave&&a.isEditable()&&a._tryValidate()},this.doReadOnly()},getItemByEvent:function(t){var e=mini.findParent(t.target,"mini-textboxlist-item");if(e){var i=e.id.split("$"),n=i[i.length-1];return this.selecteds[n]}},getItem:function(t){return"number"==typeof t?this.selecteds[t]:"object"==typeof t?t:void 0},getItemEl:function(t){var e=this.selecteds.indexOf(t),i=this.uid+"$text$"+e;return document.getElementById(i)},hoverItem:function(t,e){if(!this.isReadOnly()&&0!=this.enabled){this.blurItem();var i=this.getItemEl(t);mini.addClass(i,this._itemHoverClass),e&&mini.hasClass(e.target,"mini-textboxlist-close")&&mini.addClass(e.target,this._closeHoverClass)}},blurItem:function(){for(var t=0,e=this.selecteds.length;t<e;t++){var i=this.selecteds[t],n=this.getItemEl(i);n&&(mini.removeClass(n,this._itemHoverClass),mini.removeClass(n.lastChild,this._closeHoverClass))}},showInput:function(t){this.select(null),mini.isNumber(t)?this.editIndex=t:this.editIndex=this.selecteds.length,this.editIndex<0&&(this.editIndex=0),this.editIndex>this.selecteds.length&&(this.editIndex=this.selecteds.length);var e=this.inputLi;if(e.style.display="block",mini.isNumber(t)&&t<this.selecteds.length){var i=this.selecteds[t],n=this.getItemEl(i);jQuery(n).before(e)}else this.ulEl.appendChild(e);return!1!==t?setTimeout(function(){try{e.firstChild.focus(),mini.selectRange(e.firstChild,100)}catch(t){}},10):(this.lastInputText="",this._inputEl.value=""),e},select:function(t){if(t=this.getItem(t),this._selected){var e=this.getItemEl(this._selected);mini.removeClass(e,this._itemSelectedClass)}if(this._selected=t,this._selected){e=this.getItemEl(this._selected);mini.addClass(e,this._itemSelectedClass)}if(this._selected){this.focusEl.focus();var i=this;setTimeout(function(){try{i.focusEl.focus()}catch(t){}},50)}this._selected&&(this.addCls(this._focusCls),this._focused=!0)},_doInsertInputValue:function(){var t=this.getInputText(),e={};e[this.textField]=t,e[this.valueField]=t;var i=this.editIndex;this.insertItem(i,e)},_doInsertSelectValue:function(){if(0!=this._listbox.getData().length){var t=this._listbox.getSelected(),e=this.editIndex;t&&(t=mini.clone(t),this.insertItem(e,t))}},insertItem:function(t,e){this.selecteds.insert(t,e);var i=this.getText(),n=this.getValue();this.setValue(n,!1),this.setText(i,!1),this._createSelecteds(),this.doUpdate(),this.showInput(t+1),this._OnValueChanged()},removeItem:function(t){if(t){var e=this.getItemEl(t);mini.removeNode(e),this.selecteds.remove(t);var i=this.getText(),n=this.getValue();this.setValue(n,!1),this.setText(i,!1),this._OnValueChanged()}},_createSelecteds:function(){var t=(this.text?this.text:"").split(","),e=(this.value?this.value:"").split(",");""==e[0]&&(e=[]);for(var i=e.length,n=0,s=this.selecteds.length=i;n<s;n++){var o=this.selecteds[n];o||(o={},this.selecteds[n]=o);var r=mini.isNull(t[n])?"":t[n],l=mini.isNull(e[n])?"":e[n];mini._setMap(this.textField,r,o),mini._setMap(this.valueField,l,o)}this.value=this.getValue(),this.text=this.getText()},getInputText:function(){return this._inputEl?this._inputEl.value:""},getText:function(){for(var t=[],e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e],s=mini._getMap(this.textField,n);mini.isNull(s)&&(s=""),s=s.replace(",",""),t.push(s)}return t.join(",")},getValue:function(){for(var t=[],e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e],s=mini._getMap(this.valueField,n);t.push(s)}return t.join(",")},getFormValue:function(){var t=this.value;return null==t&&(t=""),String(t)},setName:function(t){this.name!=t&&(this.name=t,this._valueEl.name=t)},setValue:function(t){mini.isNull(t)&&(t=""),this.value!=t&&(this.value=t,this._valueEl.value=t,this._createSelecteds(),this.doUpdate())},setText:function(t){mini.isNull(t)&&(t=""),this.text!==t&&(this.text=t,this._createSelecteds(),this.doUpdate())},setValueField:function(t){this.valueField=t,this._createSelecteds()},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t,this._createSelecteds()},getTextField:function(){return this.textField},setAllowInput:function(t){this.allowInput=t,this.doLayout()},getAllowInput:function(){return this.allowInput},setUrl:function(t){this.url=t},getUrl:function(){return this.url},setPopupHeight:function(t){this.popupHeight=t},getPopupHeight:function(){return this.popupHeight},setPopupMinHeight:function(t){this.popupMinHeight=t},getPopupMinHeight:function(){return this.popupMinHeight},setPopupMaxHeight:function(t){this.popupMaxHeight=t},getPopupMaxHeight:function(){return this.popupMaxHeight},valueFromSelect:!0,setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},doQuery:function(){this._startQuery(!0)},_syncInputSize:function(){if(0!=this.isDisplay()){var t=this.getInputText(),e=mini.measureText(this._inputEl,t),i=20<e.width?e.width+4:20,n=mini.getWidth(this.el,!0);n-15<i&&(i=n-15),this._inputEl.style.width=i+"px"}},inputMode:!1,setIputMode:function(t){this.inputMode=t},getIputMode:function(){return this.inputMode},_startQuery:function(t){var e=this;this.inputMode||(setTimeout(function(){e._syncInputSize()},1),this.showPopup("loading"),this._stopQuery(),this._loading=!0,this.delayTimer=setTimeout(function(){e._inputEl.value;e._doQuery()},this.delay))},ajaxDataType:"text",ajaxContentType:"application/x-www-form-urlencoded; charset=UTF-8",_getSelectedMap:function(){for(var t={},e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e];t[n[this.valueField]]=n[this.textField]}return t},_getFilterLocalData:function(t){var e=[],i=this._getSelectedMap();t=(t||"").toLowerCase();for(var n=0,s=this.data.length;n<s;n++){var o=this.data[n];if(!i[o[this.valueField]]){var r=o[this.textField];t&&-1==String(r).toLowerCase().indexOf(t)||e.push(o)}}return e},_doQuery:function(){if(0!=this.isDisplay()){var t=this.getInputText(),o=this;if(!o.remote){var e=this._getFilterLocalData(t);return o._listbox.setData(e),o.showPopup(),o._listbox._focusItem(0,!0),void(o._loading=!1)}this._listbox.getData();var i={value:this.getValue(),text:this.getText()};i[this.searchField]=t;var n=this.url,s="function"==typeof n?n:window[n];if("function"==typeof s&&(n=s(this)),n){var r="post";n&&(-1==n.indexOf(".txt")&&-1==n.indexOf(".json")||(r="get"));var l={url:n,async:!0,params:i,data:i,type:this.ajaxType?this.ajaxType:r,cache:!1,cancel:!1};if(jQuery.extend(!0,l,this.ajaxOptions),this.fire("beforeload",l),!l.cancel){var a=this;mini.copyTo(l,{success:function(t,e,i){delete l.params;var n={text:t,result:null,sender:a,options:l,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(t){if(1==mini_debugger)throw new Error("textboxlist json is error")}mini.isArray(s)&&(s={data:s}),a.dataField&&(s.data=mini._getMap(a.dataField,s)),s.data||(s.data=[]),o._listbox.setData(s.data),o.showPopup(),o._listbox._focusItem(0,!0),o.fire("load",{data:s.data,result:s}),o._loading=!1,o._selectOnLoad&&(o.__doSelectValue(),o._selectOnLoad=null)},error:function(t,e,i){o.showPopup("error")}}),o._ajaxer=mini.ajax(l)}}}},_stopQuery:function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this._ajaxer&&this._ajaxer.abort(),this._loading=!1},within:function(t){return!!mini.isAncestor(this.el,t.target)||!!(this.showPopup&&this.popup&&this.popup.within(t))},placeholder:"",setPlaceholder:function(t){this.placeholder=t},getPlaceholder:function(t){return this.placeholder},emptyText:"No Result",setEmptyText:function(t){this.popupEmptyText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.emptyText=t},getEmptyText:function(t){return this.emptyText},loadingText:"Loading...",setLoadingText:function(t){this.popupLoadingText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.loadingText=t},getLoadingText:function(t){return this.loadingText},errorText:"Error",setErrorText:function(t){this.popupEmptyText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.errorText=t},getErrorText:function(t){return this.errorText},popupLoadingText:"<span class='mini-textboxlist-popup-loading'>Loading...</span>",popupErrorText:"<span class='mini-textboxlist-popup-error'>Error</span>",popupEmptyText:"<span class='mini-textboxlist-popup-noresult'>No Result</span>",isShowPopup:!1,popupHeight:"",popupMinHeight:30,popupMaxHeight:150,_createPopup:function(){return this.popup||(this.popup=new mini.ListBox,this.popup.addCls("mini-textboxlist-popup"),this.popup.setStyle("position:absolute;left:0;top:0;"),this.popup.showEmpty=!0,this.popup.setValueField(this.valueField),this.popup.setTextField(this.textField),this.popup.render(document.body),this.popup.on("itemclick",function(t){this.hidePopup(),this._doInsertSelectValue()},this)),this._listbox=this.popup,this.popup},showPopup:function(t){if(0!=this.isDisplay()){this.isShowPopup=!0;var e=this._createPopup();e.el.style.zIndex=mini.getMaxZIndex();var i=this._listbox;i.emptyText=this.popupEmptyText,"loading"==t?(i.emptyText=this.popupLoadingText,this._listbox.setData([])):"error"==t&&(i.emptyText=this.popupLoadingText,this._listbox.setData([])),this._listbox.doUpdate();var n=this.getBox(),s=n.x,o=n.y+n.height;this.popup.el.style.display="block",mini.setXY(e.el,-1e3,-1e3),this.popup.setWidth(n.width),this.popup.setHeight(this.popupHeight),this.popup.getHeight()<this.popupMinHeight&&this.popup.setHeight(this.popupMinHeight),this.popup.getHeight()>this.popupMaxHeight&&this.popup.setHeight(this.popupMaxHeight),mini.setXY(e.el,s,o)}},hidePopup:function(){this.isShowPopup=!1,this.popup&&(this.popup.el.style.display="none")},__OnMouseMove:function(t){if(0!=this.enabled){var e=this.getItemByEvent(t);e?this.hoverItem(e,t):this.blurItem()}},__OnMouseOut:function(t){this.blurItem()},__OnClick:function(t){if(!this.isReadOnly()&&0!=this.enabled&&0!=this.enabled){var e=this.getItemByEvent(t);e?(this.focusEl.focus(),this.select(e),t&&mini.hasClass(t.target,"mini-textboxlist-close")&&(this.removeItem(e),this.fire("removeitem",{item:e}))):mini.findParent(t.target,"mini-textboxlist-input")||this.showInput()}},__OnKeyDown:function(t){if(this.isReadOnly()||0==this.allowInput)return!1;var e=this.selecteds.indexOf(this._selected),i=this;function n(){var t=i.selecteds[e];i.removeItem(t),t=(t=i.selecteds[e])||i.selecteds[e-1],i.select(t),t||i.showInput()}switch(t.keyCode){case 8:t.preventDefault(),n();break;case 37:case 38:this.select(null),this.showInput(e);break;case 39:case 40:e+=1,this.select(null),this.showInput(e);break;case 46:n()}},__doSelectValue:function(){var t=this._listbox.getFocusedItem();if(t)this._listbox.setSelected(t),this.lastInputText=this.text,this.hidePopup(),this._doInsertSelectValue();else if(!this.valueFromSelect){this.getInputText().trim()&&this._doInsertInputValue()}},__OnInputKeyDown:function(t){if(this._selectOnLoad=null,this.isReadOnly()||0==this.allowInput)return!1;if((13!=t.keyCode||this.isShowPopup)&&(t.stopPropagation(),!this.isReadOnly()&&0!=this.allowInput)){var e=mini.getSelectRange(this._inputEl),i=e[0],n=e[1],s=this._inputEl.value.length,o=i==n&&0==i,r=i==n&&n==s;if(!this.isReadOnly()&&0!=this.allowInput||t.preventDefault(),9!=t.keyCode){if(16!=t.keyCode&&17!=t.keyCode&&18!=t.keyCode)switch(t.keyCode){case 13:if(this.inputMode)return void(this.getInputText().trim()&&this._doInsertInputValue());if(this.isShowPopup){if(t.preventDefault(),this._loading)return void(this._selectOnLoad=!0);if((a=this._listbox.getFocusedItem())&&!1===a.enabled)return;this.__doSelectValue()}break;case 27:t.preventDefault(),this.hidePopup();break;case 8:o&&t.preventDefault();case 37:if(o)if(this.isShowPopup)this.hidePopup();else if(0<this.editIndex)(l=this.editIndex-1)<0&&(l=0),l>=this.selecteds.length&&(l=this.selecteds.length-1),this.showInput(!1),this.select(l);break;case 39:if(r)if(this.isShowPopup)this.hidePopup();else if(this.editIndex<=this.selecteds.length-1){var l=this.editIndex;this.showInput(!1),this.select(l)}break;case 38:if(t.preventDefault(),this.isShowPopup){l=-1;(a=this._listbox.getFocusedItem())&&(l=this._listbox.indexOf(a)),--l<0&&(l=0),this._listbox._focusItem(l,!0)}break;case 40:if(t.preventDefault(),this.isShowPopup){var a;l=-1;(a=this._listbox.getFocusedItem())&&(l=this._listbox.indexOf(a)),++l<0&&(l=0),l>=this._listbox.getCount()&&(l=this._listbox.getCount()-1),this._listbox._focusItem(l,!0)}else this._startQuery(!0)}}else this.hidePopup()}},focus:function(){try{this._inputEl.focus()}catch(t){}},blur:function(){try{this._inputEl.blur()}catch(t){}},searchField:"key",setSearchField:function(t){this.searchField=t},getSearchField:function(){return this.searchField},getAttrs:function(t){var e=mini.TextBox.superclass.getAttrs.call(this,t);jQuery(t);return mini._ParseString(t,e,["value","text","valueField","textField","url","popupHeight","textName","onfocus","onbeforeload","onload","searchField","emptyText","loadingText","errorText","onblur","onremoveitem","placeholder"]),mini._ParseBool(t,e,["allowInput","valueFromSelect","remote","inputMode"]),mini._ParseInt(t,e,["popupMinHeight","popupMaxHeight"]),e}}),mini.regClass(mini.TextBoxList,"textboxlist"),mini.AutoComplete=function(){mini.AutoComplete.superclass.constructor.apply(this,arguments);var t=this;t._ValueChangeTimer=null,this._textEl.onfocus=function(){t._LastInputText=t._textEl.value,t._ValueChangeTimer=setInterval(function(){t._LastInputText!=t._textEl.value&&(t._tryQuery(),t._LastInputText=t._textEl.value,""==t._textEl.value&&""!=t.value&&(t.setValue(""),t._OnValueChanged()))},10)},this._textEl.onblur=function(){clearInterval(t._ValueChangeTimer),t.isShowPopup()||t._LastInputText!=t._textEl.value&&""==t._textEl.value&&""!=t.value&&(t.setValue(""),t._OnValueChanged())},this._buttonEl.style.display="none",this._doInputLayout()},mini.extend(mini.AutoComplete,mini.ComboBox,{remote:!0,url:"",allowInput:!0,delay:150,showButton:!1,searchField:"key",minChars:0,_buttonWidth:0,uiCls:"mini-autocomplete",_initInput:function(){var t=this;isFirefox&&(this._textEl.oninput=function(){t.enterQuery||t._tryQuery()})},getRemote:function(){return this.remote},setRemote:function(t){this.remote=t},setUrl:function(t){this.url=t,this.remote||mini.AutoComplete.superclass.setUrl.call(this,t)},setValue:function(t){mini.isNull(t)&&(t=""),this.value!=t&&(this.value=t,this._valueEl.value=this.value),this.__oldText=""},setText:function(t){mini.isNull(t)&&(t=""),this.text!=t&&(this.text=t,this._LastInputText=t),this._textEl.value=this.text},setMinChars:function(t){this.minChars=t},getMinChars:function(){return this.minChars},setSearchField:function(t){this.searchField=t},getSearchField:function(){return this.searchField},popupEmptyText:"No Result",setPopupEmptyText:function(t){this.popupEmptyText=t},getPopupEmptyText:function(t){return this.popupEmptyText},loadingText:"Loading...",setLoadingText:function(t){this.loadingText=t},getLoadingText:function(t){return this.loadingText},errorText:"Error",setErrorText:function(t){this.errorText=t},getErrorText:function(t){return this.errorText},getPopupEmptyHtml:function(){return"<span class='mini-textboxlist-popup-noresult'>"+this.popupEmptyText+"</span>"},getPopupLoadingHtml:function(){return"<span class='mini-textboxlist-popup-loading'>"+this.loadingText+"</span>"},getPopupErrorHtml:function(){return"<span class='mini-textboxlist-popup-error'>"+this.errorText+"</span>"},showPopup:function(t){this.getPopup();var e=this._listbox;e.showEmpty=!0,e.emptyText=this.getPopupEmptyHtml(),"loading"==t?(e.emptyText=this.getPopupLoadingHtml(),this._listbox.setData([])):"error"==t&&(e.emptyText=this.getPopupErrorHtml(),this._listbox.setData([])),this._listbox.doUpdate(),mini.AutoComplete.superclass.showPopup.call(this)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(16!=t.keyCode&&17!=t.keyCode&&18!=t.keyCode&&!this.isReadOnly())switch(t.keyCode){case 27:this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 13:var i=!0;if((!this.isShowPopup()||0==this._listbox.getData().length)&&this.enterQuery){i=!1;var n=this._textEl.value;this._enterSearchText==n&&this.loading||(this._enterSearchText=n,this._tryQuery(n))}if(this.isShowPopup()){if(t.preventDefault(),t.stopPropagation(),!0!==this._requestSearch)if(-1!=(l=this._listbox.getFocusedIndex())){var s=this._listbox.getAt(l),o=this._listbox.getValueAndText([s]),r=o[0];this.setText(o[1]),this.setValue(r),this._OnValueChanged()}}else this.fire("enter",e);i&&(this.hidePopup(),this.focus());break;case 37:break;case 38:if(-1==(l=this._listbox.getFocusedIndex()))if(l=0,!this.multiSelect)(s=this._listbox.findItems(this.value)[0])&&(l=this._listbox.indexOf(s));this.isShowPopup()&&(this.multiSelect||((l-=1)<0&&(l=0),this._listbox._focusItem(l,!0)));break;case 39:break;case 40:var l=this._listbox.getFocusedIndex();this.isShowPopup()?this.multiSelect||((l+=1)>this._listbox.getCount()-1&&(l=this._listbox.getCount()-1),this._listbox._focusItem(l,!0)):this._tryQuery(this._textEl.value);break;default:1==this.enterQuery?(this.hidePopup(),this.focus()):this._keydownQuery()}}else this.hidePopup()},delay:200,_keydownQuery:function(){var e=this;e._requestSearch=!0,e.remote||(e._requestSearch=!1),e._keydownTimer&&(clearTimeout(e._keydownTimer),e._keydownTimer=null),e._keydownTimer=setTimeout(function(){var t=e._textEl.value;t!=e.__oldText&&(e._tryQuery(t),e.__oldText=t)},e.delay)},enterQuery:!1,doQuery:function(){this._tryQuery()},_tryQuery:function(t){var e=this;this._queryTimer&&(clearTimeout(this._queryTimer),this._queryTimer=null),this._queryTimer=setTimeout(function(){var t=e._textEl.value;e._doQuery(t)},this.delay),!1!==e._tryHide()&&this.showPopup("loading")},_tryHide:function(){if(mini.getActiveElement()!=this._textEl&&mini.hasClass(this.el,"mini-buttonedit-focus"))return this.hidePopup(),!1},blur:function(){var t=this;mini.AutoComplete.superclass.blur.apply(this),t._ajaxer&&(t._ajaxer.abort(),t._ajaxer=null),t._doloadTimer&&(clearTimeout(t._doloadTimer),t._doloadTimer=null),t._queryTimer&&(clearTimeout(t._queryTimer),t._queryTimer=null),t._keydownTimer&&(clearTimeout(t._keydownTimer),t._keydownTimer=null),t.isShowPopup()&&t.hidePopup()},_doQuery:function(t){var o=this;if(mini.getActiveElement()==o._textEl)if(this.remote){this._ajaxer&&this._ajaxer.abort();var e=this.url,i="post";e&&(-1==e.indexOf(".txt")&&-1==e.indexOf(".json")||(i="get"));var n={};n[this.searchField]=t;var r={url:e,async:!0,params:n,data:n,type:this.ajaxType?this.ajaxType:i,cache:!1,cancel:!1};jQuery.extend(!0,r,this.ajaxOptions),this.fire("beforeload",r);o=this;if(r.cancel){var s=r.result||[];l(s,s)}else o.loading=!0,mini.copyTo(r,{success:function(t,e,i){delete r.params;var n={text:t,result:null,sender:o,options:r,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(t){if(1==mini_debugger)throw new Error("autocomplete json is error")}mini.isArray(s)&&(s={data:s}),o.dataField&&(s.data=mini._getMap(o.dataField,s)),s.data||(s.data=[]),l(s.data,s)},error:function(t,e,i){},complete:function(){o.loading=!1,o._requestSearch=!1,o._ajaxer=null}}),this._ajaxer=mini.ajax(r)}else mini.AutoComplete.superclass._doQuery.apply(this,arguments);else o.hidePopup();function l(t,e){o._focused&&!1!==o._tryHide()&&(o._doloadTimer&&(clearTimeout(o._doloadTimer),o._doloadTimer=null),o._doloadTimer=setTimeout(function(){o._doloadTimer=null,o._tryHide()},100),o._listbox.setData(t),o.showPopup(),o._listbox._focusItem(0,!0),o.data=t,o.fire("load",{data:t,result:e}))}},setEnterQuery:function(t){this.enterQuery=t},getEnterQuery:function(){return this.enterQuery},getAttrs:function(t){var e=mini.AutoComplete.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["searchField","popupEmptyText","loadingText","errorText"]),mini._ParseBool(t,e,["enterQuery","remote"]),e}}),mini.regClass(mini.AutoComplete,"autocomplete"),mini.ToolTip=function(){mini.ToolTip.superclass.constructor.apply(this,arguments)},mini.extend(mini.ToolTip,mini.Control,{selector:"[title]",placement:"bottom",trigger:"hover focus",delay:200,uiCls:"mini-tooltip",_create:function(){this.el=jQuery('<div class="mini-tooltip"><div class="mini-tooltip-arrow"></div><div class="mini-tooltip-inner mini-corner-all"></div></div>')[0],this.$element=jQuery(this.el),this.$element.appendTo(document.body)},_initEvents:function(){},_bindTooltip:function(){var t=jQuery(document),e=this.selector,i="tooltip";t.unbind("."+i,this);for(var n=this.trigger.split(" "),s=n.length;s--;){var o=n[s];if("click"==o)t.on("click."+i,e,jQuery.proxy(this._toggle,this));else if("manual"!=o){var r="hover"==o?"mouseenter":"focus",l="hover"==o?"mouseleave":"blur";t.on(r+"."+i,e,jQuery.proxy(this._enter,this)),t.on(l+"."+i,e,jQuery.proxy(this._leave,this))}}},setSelector:function(t){this.selector=t,this._bindTooltip()},getSelector:function(){return this.selector},setPlacement:function(t){this.placement=t},getPlacement:function(){return this.placement},setTrigger:function(t){this.trigger=t,this._bindTooltip()},getTrigger:function(){return this.trigger},openTimer:null,_enter:function(t){var e=this,i=t.currentTarget;this.getContent(i),clearTimeout(this.openTimer),this.openTimer=setTimeout(function(){e.openTimer=null,e.open(i)},e.delay)},_leave:function(t){clearTimeout(this.openTimer),this.close()},_toggle:function(t){"none"==this._getTip().css("display")?this.enter(t):this.leave(t)},open:function(t){t=jQuery(t)[0]||this.target,jQuery(t);var e=this.getContent(t),i={element:t,content:e,cancel:!e};if(this.fire("beforeopen",i),!i.cancel){this.$element.show(),this._target=t;try{this.setContent(i.content)}catch(t){}this.fire("open",{element:t})}},close:function(){this._target=null,this.$element.hide()},showLoading:function(){this.setContent('<div class="mini-tooltip-loading"></div>')},setContent:function(t){this.$element.children(".mini-tooltip-inner").html(t||"&nbsp;"),this.applyPlacement()},getContent:function(t){var e=t.title;return e&&jQuery(t).attr("data-tooltip",e).attr("title",""),e=e||jQuery(t).attr("data-tooltip")},applyPlacement:function(){if(this._target&&"none"!=this.$element.css("display")){var t=this._target,e=jQuery(t).attr("data-placement")||this.placement,i=this.$element;if(t&&i[0]){i.show().css({left:"-2000px",top:"-2000px"});var n=mini.getBox(t),s=mini.getViewportBox(),o=n.top-s.top,r=s.bottom-n.bottom;c(e);var l,a=mini.getBox(i[0]),h=mini.getCalculatedOffset(e,n,a.width,a.height);if("left"==e||"right"==e||"top"==e||"bottom"==e||"bottomleft"==e&&r<o&&h.top+a.height>s.bottom&&(e="topleft"),c(e),h=mini.getCalculatedOffset(e,n,a.width,a.height),"right"==e||"left"==e){var u=jQuery(i).children(".mini-tooltip-arrow");function d(){var t=n.top+n.height/2-u.height()/2-h.top;u.css("top",t)}u.css("top","");s=mini.getViewportBox();h.top<s.y?(h.top=s.y,d()):h.top+a.height>s.bottom&&(h.top=s.bottom-a.height,d())}l=h,i.offset(l)}}function c(t){i.removeClass("mini-tooltip-left mini-tooltip-top mini-tooltip-right mini-tooltip-bottom mini-tooltip-bottomleft mini-tooltip-topleft mini-tooltip-bottomright mini-tooltip-topright").addClass("mini-tooltip-"+t)}},getAttrs:function(t){var e=mini.ToolTip.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["selector","placement","onbeforeopen","onopen","onclose"]),e}}),mini.regClass(mini.ToolTip,"tooltip"),mini.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:"bottomleft"==t?{top:e.top+e.height,left:e.left}:"bottomright"==t?{top:e.top+e.height,left:e.left+e.width-i}:"topleft"==t?{top:e.top-n,left:e.left}:"topright"==t?{top:e.top-n,left:e.left+e.width-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},mini.ProgressBar=function(){mini.ProgressBar.superclass.constructor.apply(this,arguments)},mini.extend(mini.ProgressBar,mini.Control,{formField:!0,uiCls:"mini-progressbar",showText:!1,textAlign:"center",text:"",format:"{0}%",value:0,set:function(t){if("string"==typeof t)return this;var e=t.value;return delete t.value,mini.ProgressBar.superclass.set.call(this,t),mini.isNull(e)||this.setValue(e),this},_create:function(){this.el=document.createElement("div"),this.el.className="mini-progressbar";this.el.innerHTML='<div class="mini-progressbar-border"><div class="mini-progressbar-bar"></div><div class="mini-progressbar-text"></div></div>',this._borderEl=this.el.firstChild,this._barEl=this._borderEl.firstChild,this._textEl=this._borderEl.lastChild},setText:function(t){this.text=t,this._textEl.innerHTML=t},setShowText:function(t){this.showText=t,this._textEl.style.display=t?"":"none"},getShowText:function(){return this.showText},setTextAlign:function(t){this.textAlign=t,this._textEl.style.textAlign=t},getTextAlign:function(){return this.textAlign},setValue:function(t){t=parseFloat(t),isNaN(t)&&(t=0),t<0&&(t=0),100<t&&(t=100),this.value=t,this._barEl.style.width=t+"%";var e=String.format(this.format,t);this.setText(e)},getValue:function(){return this.value},getAttrs:function(t){var e=mini.ProgressBar.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["text","format","textAlign"]),mini._ParseBool(t,e,["showText"]),e}}),mini.regClass(mini.ProgressBar,"progressbar"),mini.Form=function(t){if(this.el=mini.byId(t),!this.el)throw new Error("form element not null");mini.Form.superclass.constructor.apply(this,arguments)},mini.extend(mini.Form,mini.Component,{el:null,getFields:function(){return this.el?mini.findControls(function(t){return!(!t.el||1!=t.formField)&&!!mini.isAncestor(this.el,t.el)},this):[]},getFieldsMap:function(){for(var t=this.getFields(),e={},i=0,n=t.length;i<n;i++){var s=t[i];s.name&&(e[s.name]=s)}return e},getField:function(t){return this.el?mini.getbyName(t,this.el):null},getData:function(t,e){mini.isNull(e)&&(e=!0);for(var i=t?"getFormValue":"getValue",n=this.getFields(),s={},o=0,r=n.length;o<r;o++){var l=n[o],a=l[i];a&&(l.name&&(1==e?mini._setMap(l.name,a.call(l),s):s[l.name]=a.call(l)),l.textName&&l.getText&&(1==e?mini._setMap(l.textName,l.getText(),s):s[l.textName]=l.getText()))}return s},setData:function(t,e,i){mini.isNull(i)&&(i=!0),"object"!=typeof t&&(t={});var n=this.getFieldsMap();for(var s in n){var o=n[s];if(o){if(o.setValue){var r=t[s];if(1==i&&(r=mini._getMap(s,t)),void 0===r&&!1===e)continue;null===r&&(r=""),o.setValue(r)}if(o.setText&&o.textName){var l=t[o.textName];1==i&&(l=mini._getMap(o.textName,t)),mini.isNull(l)&&(l=""),o.setText(l)}}}},reset:function(){for(var t=this.getFields(),e=0,i=t.length;e<i;e++){var n=t[e];if(n.setValue){if(n.setText&&!1!==n._clearText){var s=n.defaultText;mini.isNull(s)&&(s=""),n.setText(s)}n.setValue(n.defaultValue),n.clear&&n.clear()}}this.setIsValid(!0)},clear:function(){for(var t=this.getFields(),e=0,i=t.length;e<i;e++){var n=t[e];n.setValue&&(n.setText&&!1!==n._clearText&&n.setText(""),n.setValue(""),n.clear&&n.clear())}this.setIsValid(!0)},getValidateFields:function(t){for(var e=[],i=this.getFields(),n=0,s=i.length;n<s;n++){var o=i[n];o.validate&&o.isDisplay&&(!o.isDisplay(function(t){if(mini.hasClass(t,"mini-tabs-body"))return!0})&&!o.forceValidate||(o.enabled||t||o.forceValidate)&&e.push(o))}return e},validate:function(t,e){for(var i=this.getValidateFields(e),n=0,s=i.length;n<s;n++){if(0==i[n].validate()&&!1===t)break}return this.isValid()},isValid:function(){for(var t=this.getValidateFields(),e=0,i=t.length;e<i;e++){if(0==t[e].isValid())return!1}return!0},setIsValid:function(t){for(var e=this.getFields(),i=0,n=e.length;i<n;i++){var s=e[i];s.setIsValid&&s.setIsValid(t)}},getErrorTexts:function(){for(var t=[],e=this.getErrors(),i=0,n=e.length;i<n;i++){var s=e[i];t.push(s.errorText)}return t},getErrors:function(){for(var t=[],e=this.getFields(),i=0,n=e.length;i<n;i++){var s=e[i];s.isValid&&0==s.isValid()&&t.push(s)}return t},mask:function(t){"string"==typeof t&&(t={html:t}),(t=t||{}).el=this.el,t.cls||(t.cls=this._maskCls),mini.mask(t)},unmask:function(){mini.unmask(this.el)},_maskCls:"mini-mask-loading",loadingMsg:"...",loading:function(t){this.mask(t||this.loadingMsg)},__OnValueChanged:function(t){this._changed=!0},_changed:!1,setChanged:function(t){this._changed=t;for(var e=this.getFields(),i=0,n=e.length;i<n;i++){e[i].on("valuechanged",this.__OnValueChanged,this)}},isChanged:function(){return this._changed},setEnabled:function(t){for(var e=this.getFields(),i=0,n=e.length;i<n;i++){e[i].setEnabled(t)}}}),mini.Fit=function(){mini.Fit.superclass.constructor.apply(this,arguments)},mini.extend(mini.Fit,mini.Container,{style:"",_clearBorder:!1,uiCls:"mini-fit",_create:function(){this.el=document.createElement("div"),this.el.className="mini-fit",this._bodyEl=this.el},_initEvents:function(){},isFixedSize:function(){return!1},doLayout:function(){if(this.canLayout()){var t=this.el.parentNode,e=mini.getChildNodes(t);t==document.body&&(this.el.style.height="0px");for(var i=mini.getHeight(t,!0),n=0,s=e.length;n<s;n++){var o=(u=e[n]).tagName?u.tagName.toLowerCase():"";if(u!=this.el&&"style"!=o&&"script"!=o&&"hidden"!=u.type){var r=mini.getStyle(u,"position");if("absolute"!=r&&"fixed"!=r)i=i-mini.getHeight(u)-(l=mini.getMargins(u)).top-l.bottom}}var l,a=mini.getBorders(this.el),h=mini.getPaddings(this.el);i=i-(l=mini.getMargins(this.el)).top-l.bottom,jQuery.boxModel&&(i=i-h.top-h.bottom-a.top-a.bottom),i<0&&(i=0),this.el.style.height=i+"px";try{e=mini.getChildNodes(this.el);for(n=0,s=e.length;n<s;n++){var u=e[n];mini.layout(u)}}catch(t){}}},set_bodyParent:function(t){if(t){for(var e=this._bodyEl,i=t;i.firstChild;)try{e.appendChild(i.firstChild)}catch(t){}this.doLayout()}},getAttrs:function(t){var e=mini.Fit.superclass.getAttrs.call(this,t);return e._bodyParent=t,e}}),mini.regClass(mini.Fit,"fit"),mini.Panel=function(){this._initButtons(),mini.Panel.superclass.constructor.apply(this,arguments),this.url&&this.setUrl(this.url),this._contentEl=this._bodyEl,this._doVisibleEls(),this._Resizer=new mini._Resizer(this),this._doTools()},mini.extend(mini.Panel,mini.Container,{width:250,title:"",iconCls:"",iconStyle:"",allowResize:!1,url:"",refreshOnExpand:!1,maskOnLoad:!0,collapseOnTitleClick:!1,showCollapseButton:!1,showCloseButton:!1,closeAction:"display",showHeader:!0,showToolbar:!1,showFooter:!1,headerCls:"",headerStyle:"",bodyCls:"",bodyStyle:"",footerCls:"",footerStyle:"",toolbarCls:"",toolbarStyle:"",minWidth:180,minHeight:100,maxWidth:5e3,maxHeight:3e3,set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i=t.toolbar;delete t.toolbar;var n=t.footer;delete t.footer;var s=t.url;delete t.url;var o=t.buttons;return delete t.buttons,mini.Panel.superclass.set.call(this,t),o&&this.setButtons(o),i&&this.setToolbar(i),n&&this.setFooter(n),s&&this.setUrl(s),this._allowLayout=e,this.doLayout(),this},uiCls:"mini-panel",_create:function(){this.el=document.createElement("div"),this.el.className="mini-panel",this.el.tabIndex=0;this.el.innerHTML='<div class="mini-panel-border"><div class="mini-panel-header" ><div class="mini-panel-header-inner" ><span class="mini-panel-icon mini-icon mini-iconfont"></span><div class="mini-panel-title" ></div><div class="mini-tools" ></div></div></div><div class="mini-panel-viewport"><div class="mini-panel-toolbar"></div><div class="mini-panel-body" ></div><div class="mini-panel-footer"></div><div class="mini-resizer-trigger"></div></div></div>',this.el.hideFocus=!0,this._borderEl=this.el.firstChild,this._headerEl=this._borderEl.firstChild,this._viewportEl=this._borderEl.lastChild,this._toolbarEl=mini.byClass("mini-panel-toolbar",this.el),this._bodyEl=mini.byClass("mini-panel-body",this.el),this._footerEl=mini.byClass("mini-panel-footer",this.el),this._resizeGridEl=mini.byClass("mini-resizer-trigger",this.el);mini.byClass("mini-panel-header-inner",this.el);this._iconEl=mini.byClass("mini-panel-icon",this.el),this._titleEl=mini.byClass("mini-panel-title",this.el),this._toolsEl=mini.byClass("mini-tools",this.el),mini.setStyle(this._bodyEl,this.bodyStyle),this._doTitle()},destroy:function(t){this._doRemoveIFrame(),this._iframeEl=null,this._viewportEl=this._borderEl=this._bodyEl=this._footerEl=this._toolbarEl=null,this._toolsEl=this._titleEl=this._iconEl=this._resizeGridEl=null,mini.Panel.superclass.destroy.call(this,t)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"click",this.__OnClick,this)},this)},_doVisibleEls:function(){this._headerEl.style.display=this.showHeader?"":"none",this._toolbarEl.style.display=this.showToolbar?"":"none",this._footerEl.style.display=this.showFooter?"":"none"},_setBodyWidth:!0,doLayout:function(){if(this.canLayout()){var t=this.isAutoHeight(),e=(this.isAutoWidth(),parseInt(jQuery(this.el).css("max-height")));if(t&&e)this._viewportEl.style.height="auto",this._bodyEl.style.height="auto",e<this.el.firstChild.offsetHeight&&(t=!1);this._autoHeight=t;var i=this.getWidth(!0);if(mini.isIE6&&mini.setWidth(this._bodyEl,i),t)this._viewportEl.style.height="auto",this._bodyEl.style.height="auto";else{var n=this.getViewportHeight();mini.setHeight(this._viewportEl,n);var s=this.getBodyHeight();mini.setHeight(this._bodyEl,s)}mini.layout(this._borderEl),this._resizeGridEl&&mini.repaint(this._resizeGridEl),this._resizeGridEl.style.display=this.allowResize?"":"none",this.fire("layout")}},deferLayout:function(t){if(t=t||10,!this._layoutTimer){var e=this;this._layoutTimer=setTimeout(function(){e._layoutTimer=null,e.doLayout()},t)}},_stopLayout:function(){clearTimeout(this._layoutTimer),this._layoutTimer=null},getViewportWidth:function(t){return this.getWidth(!0)},getViewportHeight:function(t){var e=this.getHeight(!0)-this.getHeaderHeight();if(t){var i=mini.getPaddings(this._viewportEl),n=mini.getBorders(this._viewportEl),s=mini.getMargins(this._viewportEl);jQuery.boxModel&&(e=e-i.top-i.bottom-n.top-n.bottom),e=e-s.top-s.bottom}return e},getBodyHeight:function(t){var e=(e=this.getViewportHeight())-this.getToolbarHeight()-this.getFooterHeight();if(t){var i=mini.getPaddings(this._bodyEl),n=mini.getBorders(this._bodyEl),s=mini.getMargins(this._bodyEl);jQuery.boxModel&&(e=e-i.top-i.bottom-n.top-n.bottom),e=e-s.top-s.bottom}return e<0&&(e=0),e},getHeaderHeight:function(){return this.showHeader?jQuery(this._headerEl).outerHeight():0},getToolbarHeight:function(){return this.showToolbar?jQuery(this._toolbarEl).outerHeight():0},getFooterHeight:function(){return this.showFooter?jQuery(this._footerEl).outerHeight():0},setHeaderStyle:function(t){this.headerStyle=t,mini.setStyle(this._headerEl,t),this.doLayout()},getHeaderStyle:function(){return this.headerStyle},setBodyStyle:function(t){this.bodyStyle=t,mini.setStyle(this._bodyEl,t),this.doLayout()},getBodyStyle:function(){return this.bodyStyle},setToolbarStyle:function(t){this.toolbarStyle=t,mini.setStyle(this._toolbarEl,t),this.doLayout()},getToolbarStyle:function(){return this.toolbarStyle},setFooterStyle:function(t){this.footerStyle=t,mini.setStyle(this._footerEl,t),this.doLayout()},getFooterStyle:function(){return this.footerStyle},setHeaderCls:function(t){jQuery(this._headerEl).removeClass(this.headerCls),jQuery(this._headerEl).addClass(t),this.headerCls=t,this.doLayout()},getHeaderCls:function(){return this.headerCls},setBodyCls:function(t){jQuery(this._bodyEl).removeClass(this.bodyCls),jQuery(this._bodyEl).addClass(t),this.bodyCls=t,this.doLayout()},getBodyCls:function(){return this.bodyCls},setToolbarCls:function(t){jQuery(this._toolbarEl).removeClass(this.toolbarCls),jQuery(this._toolbarEl).addClass(t),this.toolbarCls=t,this.doLayout()},getToolbarCls:function(){return this.toolbarCls},setFooterCls:function(t){jQuery(this._footerEl).removeClass(this.footerCls),jQuery(this._footerEl).addClass(t),this.footerCls=t,this.doLayout()},getFooterCls:function(){return this.footerCls},_doTitle:function(){var t=""==this.title?"&nbsp":this.title;this._titleEl.innerHTML=t,this._iconEl.style.display=this.iconCls||this.iconStyle?"inline":"none",this._iconEl.className="mini-panel-icon mini-icon mini-iconfont "+this.iconCls,mini.setStyle(this._iconEl,this.iconStyle)},setTitle:function(t){this.title=t,this._doTitle()},getTitle:function(){return this.title},setIconCls:function(t){this.iconCls=t,this._doTitle()},getIconCls:function(){return this.iconCls},setIconStyle:function(t){this.iconStyle=t,this._doTitle()},getIconStyle:function(){return this.iconStyle},_doTools:function(){for(var t="",e=0,i=this.buttons.length;e<i;e++){var n=this.buttons[e];n.html?t+=n.html:t+='<span id="'+e+'" class="mini-icon mini-iconfont fa '+n.cls+" "+(n.enabled?"":"mini-disabled")+'" style="'+n.style+";"+(n.visible?"":"display:none;")+'"></span>'}this._toolsEl.innerHTML=t},setShowCloseButton:function(t){this.showCloseButton=t;var e=this.getButton("close");e&&(e.visible=t,this._doTools())},getShowCloseButton:function(){return this.showCloseButton},setCloseAction:function(t){this.closeAction=t},getCloseAction:function(){return this.closeAction},setShowCollapseButton:function(t){this.showCollapseButton=t;var e=this.getButton("collapse");e&&(e.visible=t,this._doTools())},getShowCollapseButton:function(){return this.showCollapseButton},setShowHeader:function(t){this.showHeader=t,this._doVisibleEls(),this.deferLayout()},getShowHeader:function(){return this.showHeader},setShowToolbar:function(t){this.showToolbar=t,this._doVisibleEls(),this.deferLayout()},getShowToolbar:function(){return this.showToolbar},setShowFooter:function(t){this.showFooter=t,this._doVisibleEls(),this.deferLayout()},getShowFooter:function(){return this.showFooter},__OnClick:function(t){if(mini.isAncestor(this._headerEl,t.target))if(mini.findParent(t.target,"mini-tools")){var e=this.getButton(parseInt(t.target.id));e&&this._OnButtonClick(e,t)}else this.collapseOnTitleClick&&this.toggle()},_OnButtonClick:function(t,e){var i={button:t,index:this.buttons.indexOf(t),name:t.name.toLowerCase(),htmlEvent:e,cancel:!1};this.fire("beforebuttonclick",i);var n=!0;try{"close"==i.name&&"destroy"==this.closeAction&&this._iframeEl&&this._iframeEl.contentWindow&&(n=this._iframeEl.contentWindow.CloseWindow?this._iframeEl.contentWindow.CloseWindow("close"):this._iframeEl.contentWindow.CloseOwnerWindow?this._iframeEl.contentWindow.CloseOwnerWindow("close"):this._CloseOwnerWindow("close"))}catch(t){n=this._CloseOwnerWindow("close")}return!1===n&&(i.cancel=!0),1==i.cancel||(this.fire("buttonclick",i),"close"==i.name&&("destroy"==this.closeAction?(this.__HideAction="close",this.destroy()):this.hide()),"collapse"==i.name&&(this.toggle(),this.refreshOnExpand&&this.expanded&&this.url&&this.reload())),i},onButtonClick:function(t,e){this.on("buttonclick",t,e)},_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);var e=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(e)},createButton:function(t){return mini.copyTo({name:"",cls:"",style:"",visible:!0,enabled:!0,html:""},t)},setButtons:function(t){"string"==typeof t&&(t=t.split(" ")),mini.isArray(t)||(t=[]);for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];if("string"==typeof s){if(!(s=s.trim()))continue;s={name:s,cls:"mini-tools-"+s,html:""}}s=this.createButton(s),e.push(s)}this.buttons=e,this._doTools()},getButtons:function(){return this.buttons},addButton:function(t,e){"string"==typeof t&&(t={iconCls:t}),t=this.createButton(t),"number"!=typeof e&&(e=this.buttons.length),this.buttons.insert(e,t),this._doTools()},updateButton:function(t,e){var i=this.getButton(t);i&&(mini.copyTo(i,e),this._doTools())},removeButton:function(t){var e=this.getButton(t);e&&(this.buttons.remove(e),this._doTools())},getButton:function(t){if("number"==typeof t)return this.buttons[t];for(var e=0,i=this.buttons.length;e<i;e++){var n=this.buttons[e];if(n.name==t)return n}},setBody:function(t){__mini_setControls(t,this._bodyEl,this)},set_bodyParent:function(t){},setToolbar:function(t){__mini_setControls(t,this._toolbarEl,this)},setFooter:function(t){__mini_setControls(t,this._footerEl,this)},getHeaderEl:function(){return this._headerEl},getToolbarEl:function(){return this._toolbarEl},getBodyEl:function(){return this._bodyEl},getFooterEl:function(){return this._footerEl},getIFrameEl:function(t){return this._iframeEl},clearTimeStamp:!1,setClearTimeStamp:function(t){this.clearTimeStamp=t},getClearTimeStamp:function(){return this.clearTimeStamp},_getMaskWrapEl:function(){return this._bodyEl},_doRemoveIFrame:function(t){if(this._iframeEl){var e=this._iframeEl;if(e._ondestroy&&e._ondestroy(),e.onload=function(){},jQuery(e).unbind("load"),e.src="",mini.isIE)try{e.contentWindow.document.write(""),e.contentWindow.document.close()}catch(t){}try{this._iframeEl.parentNode.removeChild(this._iframeEl),this._iframeEl.removeNode(!0)}catch(t){}}!(this._iframeEl=null)===t&&mini.removeChilds(this._bodyEl)},_deferLoadingTime:80,_doLoad:function(){if(this.url){this._doRemoveIFrame(!0);var s=new Date,o=this;this.loadedUrl=this.url,this.maskOnLoad&&this.loading(),jQuery(this._bodyEl).css("overflow","hidden"),o._CloseOwnerWindow=r;var t=mini.createIFrame(this.url,function(t,e){if(!o.destroyed){var i=s-new Date+o._deferLoadingTime;i<0&&(i=0),setTimeout(function(){o.unmask()},i);try{o._iframeEl.contentWindow.Owner=o.Owner,o._iframeEl.contentWindow.CloseOwnerWindow=r}catch(n){}if(e||o.loadOnRefresh){o.__onLoad&&o.__onLoad();var n={iframe:o._iframeEl};o.fire("load",n)}}},this.clearTimeStamp);this._bodyEl.appendChild(t),this._iframeEl=t}function r(t){o.__HideAction=t;var e=!0;try{o.__onDestroy&&(e=o.__onDestroy(t))}catch(t){}if(!1===e)return!1;var i={iframe:o._iframeEl,action:t};o.fire("unload",i),setTimeout(function(){o.destroy()},10)}},load:function(t,e,i){this.setUrl(t,e,i)},reload:function(){this.setUrl(this.url)},setUrl:function(t,e,i){this.url=t,this.__onLoad=e,this.__onDestroy=i,this.expanded&&t&&this._doLoad()},getUrl:function(){return this.url},setRefreshOnExpand:function(t){this.refreshOnExpand=t},getRefreshOnExpand:function(){return this.refreshOnExpand},setMaskOnLoad:function(t){this.maskOnLoad=t},getMaskOnLoad:function(t){return this.maskOnLoad},setAllowResize:function(t){this.allowResize!=t&&(this.allowResize=t,this.doLayout())},getAllowResize:function(){return this.allowResize},setLoadOnRefresh:function(t){this.loadOnRefresh=t},getLoadOnRefresh:function(t){return this.loadOnRefresh},expanded:!0,setExpanded:function(t){this.expanded!=t&&(this.expanded=t,this.expanded?this.expand():this.collapse())},getExpanded:function(){return this.expanded},toggle:function(){this.expanded?this.collapse():this.expand()},collapse:function(){this.expanded=!1,"max"!=this.state&&(this._height=this.el.style.height),this.el.style.height="auto",this._viewportEl.style.display="none",mini.addClass(this.el,"mini-panel-collapse"),this.doLayout()},expand:function(){this.expanded=!0,this._height&&(this.el.style.height=this._height),this._viewportEl.style.display="block","max"!=this.state&&delete this._height,mini.removeClass(this.el,"mini-panel-collapse"),this._expandLoad(),this.doLayout()},_expandLoad:function(){this.url&&this.url!=this.loadedUrl&&this._doLoad()},setCollapseOnTitleClick:function(t){this.collapseOnTitleClick=t,mini.removeClass(this.el,"mini-panel-titleclick"),t&&mini.addClass(this.el,"mini-panel-titleclick")},getCollapseOnTitleClick:function(){return this.collapseOnTitleClick},getAttrs:function(t){var e=mini.Panel.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["title","iconCls","iconStyle","headerCls","headerStyle","bodyCls","bodyStyle","footerCls","footerStyle","toolbarCls","toolbarStyle","footer","toolbar","url","closeAction","loadingMsg","onbeforebuttonclick","onbuttonclick","onload","buttons"]),mini._ParseBool(t,e,["allowResize","showCloseButton","showHeader","showToolbar","showFooter","loadOnRefresh","showCollapseButton","refreshOnExpand","maskOnLoad","expanded","collapseOnTitleClick","clearTimeStamp"]);for(var i=mini.getChildNodes(t,!0),n=i.length-1;0<=n;n--){var s=i[n],o=mini.getAttr(s,"property");o&&("toolbar"==(o=o.toLowerCase())?e.toolbar=s:"footer"==o&&(e.footer=s))}return e.body=i,e}}),mini.regClass(mini.Panel,"panel"),mini.Window=function(){mini.Window.superclass.constructor.apply(this,arguments),this.addCls("mini-window"),this.setVisible(!1),this.setAllowDrag(this.allowDrag),this.setAllowResize(this.allowResize)},mini.extend(mini.Window,mini.Panel,{x:0,y:0,state:"restore",_dragCls:"mini-window-drag",_resizeCls:"mini-window-resize",allowDrag:!0,showCloseButton:!0,showMaxButton:!1,showMinButton:!1,showCollapseButton:!1,showModal:!0,minWidth:150,minHeight:80,maxWidth:2e3,maxHeight:2e3,uiCls:"mini-window",_create:function(){if(mini.Window.superclass._create.call(this),this.el.className+=" mini-corner-all",this.el.firstChild.className+=" mini-corner-all",mini.isIE&&mini_useShims){mini.append(this.el,"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 100%; height: 100%; top: 0;left:0;scrolling:no;'></iframe>")}},_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);var e=this.createButton({name:"min",cls:"mini-tools-min",visible:this.showMinButton});this.buttons.push(e);var i=this.createButton({name:"max",cls:"mini-tools-max",visible:this.showMaxButton});this.buttons.push(i);var n=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(n)},_initEvents:function(){mini.Window.superclass._initEvents.call(this),mini._BindEvents(function(){mini.on(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this),mini.on(this.el,"mousedown",this.__OnWindowMouseDown,this)},this)},doLayout:function(){if(this.canLayout()){if("max"==this.state){var t=this.getParentBox();this.el.style.left="0px",this.el.style.top="0px",mini.setSize(this.el,t.width,t.height)}mini.Window.superclass.doLayout.call(this),this.allowDrag&&mini.addClass(this.el,this._dragCls),"max"==this.state&&(this._resizeGridEl.style.display="none",mini.removeClass(this.el,this._dragCls)),this._doModal()}},_doModal:function(){if(this.el){var t=this.showModal&&this.isDisplay()&&this.visible;if(this._modalEl||0!=this.showModal){if(!this._modalEl){var e="__modal"+this._id,i=mini_useShims?"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 100%; height: 100%; top: 0;left:0;scrolling:no;'></iframe>":"";this._modalEl=mini.append(document.body,'<div id="'+e+'" class="mini-modal mini-widget-content" style="display:none">'+i+"</div>")}t?(this._modalEl.style.display="block",this._modalEl.style.zIndex=mini.getStyle(this.el,"zIndex")-1):this._modalEl.style.display="none"}else this._modalEl&&mini.removeNode(this._modalEl)}else this._modalEl&&mini.removeNode(this._modalEl)},getParentBox:function(){var t=mini.getViewportBox(),e=this._containerEl||document.body;return e!=document.body&&(t=mini.getBox(e)),t},setShowModal:function(t){this.showModal=t},getShowModal:function(){return this.showModal},setMinWidth:function(t){isNaN(t)||(this.minWidth=t)},getMinWidth:function(){return this.minWidth},setMinHeight:function(t){isNaN(t)||(this.minHeight=t)},getMinHeight:function(){return this.minHeight},setMaxWidth:function(t){isNaN(t)||(this.maxWidth=t)},getMaxWidth:function(){return this.maxWidth},setMaxHeight:function(t){isNaN(t)||(this.maxHeight=t)},getMaxHeight:function(){return this.maxHeight},setAllowDrag:function(t){this.allowDrag=t,mini.removeClass(this.el,this._dragCls),t&&mini.addClass(this.el,this._dragCls)},getAllowDrag:function(){return this.allowDrag},setShowMaxButton:function(t){this.showMaxButton=t;var e=this.getButton("max");e&&(e.visible=t,this._doTools())},getShowMaxButton:function(){return this.showMaxButton},setShowMinButton:function(t){this.showMinButton=t;var e=this.getButton("min");e&&(e.visible=t,this._doTools())},getShowMinButton:function(){return this.showMinButton},max:function(){this.state="max",this.addCls("mini-window-max"),this.show();var t=this.getButton("max");t&&(t.cls="mini-tools-restore",this._doTools())},restore:function(){this.removeCls("mini-window-max"),this.state="restore",this.show(this.x,this.y);var t=this.getButton("max");t&&(t.cls="mini-tools-max",this._doTools())},showInBody:!0,setShowInBody:function(t){this.showInBody=t},getShowInBody:function(){return this.showInBody},containerEl:null,showAtPos:function(t,e,i){this.show(t,e,i)},show:function(t,e,i){this._allowLayout=!1;var n=this._containerEl||document.body;if((!this.isRender()||this.el.parentNode!=n&&this.showInBody)&&this.render(n),this.el.style.zIndex=mini.getMaxZIndex(),this._doShow(t,e),this._allowLayout=!0,this.setVisible(!0),"max"!=this.state){var s=this.getBox();this.x=s.x,this.y=s.y}try{document.body.focus()}catch(t){}},hide:function(){this.setVisible(!1),this._doModal()},getWidth:function(t){this._headerEl.style.width="50px";var e=mini.getWidth(this.el);if(this._headerEl.style.width="auto",t&&this._borderEl){var i=mini.getBorders(this._borderEl);e=e-i.left-i.right}return e},getBox:function(){this._headerEl.style.width="50px",this.el.style.display="";var t=mini.getWidth(this.el);this._headerEl.style.width="auto";var e=mini.getBox(this.el);return e.width=t,e.right=e.x+t,e},_measureSize:function(){this.el.style.display="";var t=this.getBox();t.width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),t=this.getBox()),this.expanded&&t.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),t=this.getBox()),t.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),t=this.getBox()),this.expanded&&t.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),t=this.getBox())},_doShow:function(t,e){var i=this.getParentBox();if("max"==this.state){if(!this._width){var n=this.getBox();this._width=n.width,this.expanded&&(this._height=n.height),this.x=n.x,this.y=n.y}this.el.style.left="-10000px",this.el.style.top="-10000px"}else{mini.isNull(t)&&(t="center"),mini.isNull(e)&&(e="middle"),this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this._width&&(this.setWidth(this._width),this.setHeight(this._height),delete this._width,delete this._height),this._measureSize();n=this.getBox();"left"==t&&(t=0),"center"==t&&(t=i.width/2-n.width/2),"right"==t&&(t=i.width-n.width),"top"==e&&(e=0),"middle"==e&&(e=i.y+i.height/2-n.height/2),"bottom"==e&&(e=i.height-n.height),t+n.width>i.right&&(t=i.right-n.width),e+n.height>i.bottom&&(e=i.bottom-n.height),t<0&&(t=0),e<0&&(e=0),this.el.style.display="",mini.setX(this.el,t),mini.setY(this.el,e)}this.doLayout()},_OnButtonClick:function(t,e){var i=mini.Window.superclass._OnButtonClick.call(this,t,e);return 1==i.cancel||"max"==i.name&&("max"==this.state?this.restore():this.max()),i},__OnWindowResize:function(t){"max"==this.state&&this.doLayout(),mini.isIE6||this._doModal()},enableDragProxy:!0,setEnableDragProxy:function(t){this.enableDragProxy=t},getEnableDragProxy:function(t){return this.enableDragProxy},allowCrossBottom:!0,setAllowCrossBottom:function(t){this.allowCrossBottom=t},getAllowCrossBottom:function(){return this.allowCrossBottom},xxx:0,__OnWindowMouseDown:function(t){var l=this;if("max"!=this.state&&this.allowDrag&&mini.isAncestor(this._headerEl,t.target)&&!mini.findParent(t.target,"mini-tools")){l=this;this.el&&(this.el.style.zIndex=mini.getMaxZIndex());var a=this.getBox();new mini.Drag({capture:!1,onStart:function(){l._maskProxy=mini.append(document.body,'<div class="mini-resizer-mask" style=""></div>'),l.enableDragProxy?(l._dragProxy=mini.append(document.body,'<div class="mini-drag-proxy"></div>'),l.el.style.left="-2000px",l.el.style.top="-2000px"):l._dragProxy=l.el;var t=mini.append(document.body,'<div class="mini-resizer-mask"></div>');setTimeout(function(){mini.removeNode(t)},300)},onMove:function(t){var e=t.now[0]-t.init[0],i=t.now[1]-t.init[1];e=a.x+e,i=a.y+i;var n=l.getParentBox(),s=e+a.width,o=i+a.height;s>n.width&&(e=n.width-a.width),l.allowCrossBottom||o>n.height&&(i=n.height-a.height),e<0&&(e=0),i<0&&(i=0);var r={x:l.x=e,y:l.y=i,width:a.width,height:a.height};mini.setBox(l._dragProxy,r),this.moved=!0},onStop:function(){if(l.el&&(l.el.style.display="block",this.moved)){var t=mini.getBox(l._dragProxy);mini.setBox(l.el,t)}jQuery(l._maskProxy).remove(),l._maskProxy=null,l.enableDragProxy&&jQuery(l._dragProxy).remove(),l._dragProxy=null,l.fire("moveend")}}).start(t)}},destroy:function(t){mini.un(window,"resize",this.__OnWindowResize,this),this._modalEl&&(jQuery(this._modalEl).remove(),this._modalEl=null),this.shadowEl&&(jQuery(this.shadowEl).remove(),this.shadowEl=null);var e="__modal"+this._id;jQuery("[id='"+e+"']").remove(),mini.Window.superclass.destroy.call(this,t)},getAttrs:function(t){var e=mini.Window.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["modalStyle","onmoveend"]),mini._ParseBool(t,e,["showModal","showShadow","allowDrag","allowResize","showMaxButton","showMinButton","showInBody","enableDragProxy","allowCrossBottom"]),mini._ParseInt(t,e,["minWidth","minHeight","maxWidth","maxHeight"]),e},showAtEl:function(t,e){if(t=mini.byId(t)){this.isRender()&&this.el.parentNode==document.body||this.render(document.body);var i={xAlign:this.xAlign,yAlign:this.yAlign,xOffset:0,yOffset:0,popupCls:this.popupCls};mini.copyTo(i,e),this._popupEl=t,this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this.doLayout(),this._measureSize();var n=mini.getViewportBox(),s=this.getBox(),o=mini.getBox(t),r=i.xy,l=n.width/2-s.width/2,a=0;switch(r&&(l=r[0],a=r[1]),i.xAlign){case"outleft":l=o.x-s.width;break;case"left":l=o.x;break;case"center":l=o.x+o.width/2-s.width/2;break;case"right":l=o.right-s.width;break;case"outright":l=o.right}switch(i.yAlign){case"above":a=o.y-s.height;break;case"top":a=o.y;break;case"middle":a=o.y+o.height/2-s.height/2;break;case"bottom":a=o.bottom-s.height;break;case"below":a=o.bottom}if(l=parseInt(l),a=parseInt(a),i.outYAlign||i.outXAlign){if("above"==i.outYAlign&&a+s.height>n.bottom){var h=o.y-n.y;n.bottom-o.bottom<h&&(a=o.y-s.height)}if("outleft"==i.outXAlign&&l+s.width>n.right){var u=o.x-n.x;n.right-o.right<u&&(l=o.x-s.width)}"right"==i.outXAlign&&l+s.width>n.right&&(l=o.right-s.width),this._Show(l,a)}else this.showAtPos(l+i.xOffset,a+i.yOffset)}}}),mini.regClass(mini.Window,"window"),mini.MessageBox={alertTitle:"",confirmTitle:"",prompTitle:"",prompMessage:"",buttonText:{ok:"",cancel:"",yes:"",no:""},autoFocus:!0,show:function(t){(t=mini.copyTo({width:"auto",height:"auto",showModal:!0,timeout:0,minWidth:150,maxWidth:800,minHeight:50,maxHeight:350,showHeader:!0,title:"",titleIcon:"",iconCls:"",iconStyle:"",message:"",html:"",spaceStyle:"margin-right:15px",showCloseButton:!0,buttons:null,buttonWidth:58,callback:null},t)).message=String(t.message);var i=t.callback,n=new mini.Window;n.addCls("mini-messagebox"),n.setBodyStyle("overflow:hidden"),n.setShowModal(t.showModal),n.setTitle(t.title||""),n.setIconCls(t.titleIcon),n.setShowHeader(t.showHeader),n.setShowCloseButton(t.showCloseButton);var e=n.uid+"$table",s=n.uid+"$content",o='<table class="mini-messagebox-table" id="'+e+'" style="" cellspacing="0" cellpadding="0"><tr><td>'+('<div class="'+t.iconCls+'" style="'+t.iconStyle+'"></div>')+'</td><td id="'+s+'" class="mini-messagebox-content-text">'+(t.message||"")+"</td></tr></table>";n._bodyEl.innerHTML='<div class="mini-messagebox-content"></div><div class="mini-messagebox-buttons"></div>';var r=n._bodyEl.firstChild;t.html?"string"==typeof t.html?r.innerHTML=t.html:mini.isElement(t.html)&&r.appendChild(t.html):r.innerHTML=o,n._Buttons=[];var l=n._bodyEl.lastChild;if(t.buttons&&0<t.buttons.length)for(var a=0,h=t.buttons.length;a<h;a++){var u=t.buttons[a],d=mini.MessageBox.buttonText[u];d=d||u;var c=new mini.Button;c.setText(d),c.setWidth(t.buttonWidth),c.render(l),c.action=u,c.on("click",function(t){var e=t.sender;i&&!1===i(e.action)||mini.MessageBox.hide(n)}),a!=h-1&&c.setStyle(t.spaceStyle),n._Buttons.push(c)}else l.style.display="none";n.setMinWidth(t.minWidth),n.setMinHeight(t.minHeight),n.setMaxWidth(t.maxWidth),n.setMaxHeight(t.maxHeight),n.setWidth(t.width),n.setHeight(t.height),n.show(t.x,t.y,{animType:t.animType});var m=n.getWidth();n.setWidth(m);var f=n.getHeight();n.setHeight(f);var p=document.getElementById(e);p&&(p.style.width="100%");var g=document.getElementById(s);if(g&&(g.style.width="100%"),mini.MessageBox.autoFocus){var _=n._Buttons[0];_?_.focus():n.focus()}return n.on("beforebuttonclick",function(t){i&&i("close"),t.cancel=!0,mini.MessageBox.hide(n)}),mini.on(n.el,"keydown",function(t){27==t.keyCode&&(i&&i("close"),mini.MessageBox.hide(n))}),t.timeout&&setTimeout(function(){mini.MessageBox.hide(n.uid)},t.timeout),n.uid},hide:function(t){if(t){var e="object"==typeof t?t:mini.getbyUID(t);if(e){for(var i=0,n=e._Buttons.length;i<n;i++){e._Buttons[i].destroy()}e._Buttons=null,e.destroy()}}},alert:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.alertTitle,buttons:["ok"],message:t,iconCls:"mini-messagebox-warning",callback:i})},confirm:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.confirmTitle,buttons:["ok","cancel"],message:t,iconCls:"mini-messagebox-question",callback:i})},prompt:function(t,e,i,n,s){var o="prompt$"+(new Date).getTime(),r=t||mini.MessageBox.promptMessage;r=n?r+'<br/><textarea id="'+o+'" style="width:200px;height:60px;margin-top:3px;"></textarea>':r+'<br/><input id="'+o+'" type="text" style="width:200px;margin-top:3px;"/>';var l=mini.MessageBox.show({title:e||mini.MessageBox.promptTitle,buttons:["ok","cancel"],width:250,html:'<div style="padding:5px;padding-left:10px;">'+r+"</div>",callback:function(t){var e=document.getElementById(o);if(i)return i(t,e.value)}}),a=document.getElementById(o);return a.focus(),null==s&&(s=""),a.value=s,l},loading:function(t,e){return mini.MessageBox.show({minHeight:50,title:e,showCloseButton:!1,message:t,iconCls:"mini-messagebox-waiting"})},showTips:function(t){jQuery;var e='<div class="mini-tips '+("mini-tips-"+(t=jQuery.extend({content:"",state:"",x:"center",y:"top",offset:[10,10],fixed:!0,timeout:2e3},t)).state)+'">'+t.content+"</div>",i=jQuery(e).appendTo(document.body);t.el=i[0],t.timeoutHandler=function(){i.slideUp(),setTimeout(function(){i.remove()},2e3)},mini.showAt(t),i.hide().slideDown()}},mini.alert=mini.MessageBox.alert,mini.confirm=mini.MessageBox.confirm,mini.prompt=mini.MessageBox.prompt,mini.loading=mini.MessageBox.loading,mini.showMessageBox=mini.MessageBox.show,mini.hideMessageBox=mini.MessageBox.hide,mini.showTips=mini.MessageBox.showTips,mini.Tabs=function(){this._initTabs(),mini.Tabs.superclass.constructor.apply(this,arguments)},mini.extend(mini.Tabs,mini.Control,{activeIndex:-1,tabAlign:"left",tabPosition:"top",showBody:!0,showHeader:!0,nameField:"name",titleField:"title",urlField:"url",url:"",maskOnLoad:!0,plain:!0,bodyStyle:"",_tabHoverCls:"mini-tab-hover",_tabActiveCls:"mini-tab-active",set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i=t.activeIndex;delete t.activeIndex;var n=t.url;return delete t.url,mini.Tabs.superclass.set.call(this,t),n&&this.setUrl(n),mini.isNumber(i)&&this.setActiveIndex(i),this._allowLayout=e,this.doLayout(),this},uiCls:"mini-tabs",_create:function(){this.el=document.createElement("div"),this.el.className="mini-tabs";this.el.innerHTML='<table class="mini-tabs-table" cellspacing="0" cellpadding="0"><tr style="width:100%;"><td></td><td style="text-align:left;vertical-align:top;width:100%;"><div class="mini-tabs-bodys"></div></td><td></td></tr></table>',this._tableEl=this.el.firstChild;var t=this.el.getElementsByTagName("td");this._td1El=t[0],this._td2El=t[1],this._td3El=t[2],this._bodyEl=this._td2El.firstChild,this._borderEl=this._bodyEl,this.doUpdate()},destroy:function(t){if(this.tabs)for(var e=0,i=this.tabs.length;e<i;e++){this.tabs[e]._iframeEl=null}this._tableEl=this._td1El=this._td2El=this._td3El=null,this._bodyEl=this._borderEl=this.headerEl=null,this.tabs=null,mini.Tabs.superclass.destroy.call(this,t)},_doClearElement:function(){mini.removeClass(this._td1El,"mini-tabs-header"),mini.removeClass(this._td3El,"mini-tabs-header"),this._td1El.innerHTML="",this._td3El.innerHTML="",mini.removeChilds(this._td2El,this._bodyEl)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"mouseover",this.__OnMouseOver,this),mini.on(this.el,"mouseout",this.__OnMouseOut,this),mini.on(this.el,"dblclick",this.__OnDblClick,this)},this)},_initTabs:function(){this.tabs=[]},_TabID:1,createTab:function(t){var e=mini.copyTo({_id:this._TabID++,name:"",title:"",newLine:!1,tooltip:"",iconCls:"",iconStyle:"",headerCls:"",headerStyle:"",bodyCls:"",bodyStyle:"",visible:!0,enabled:!0,showCloseButton:!1,active:!1,url:"",loaded:!1,refreshOnClick:!1},t);return t&&(e=t=mini.copyTo(t,e)),e},_doLoad:function(){var t=mini._getResult(this.url,null,null,null,null,this.dataField);this.dataField&&!mini.isArray(t)&&(t=mini._getMap(this.dataField,t)),t=t||[],this.setTabs(t),this.fire("load")},load:function(t){"string"==typeof t?this.setUrl(t):this.setTabs(t)},setUrl:function(t){this.url=t,this._doLoad()},getUrl:function(){return this.url},setNameField:function(t){this.nameField=t},getNameField:function(){return this.nameField},setTitleField:function(t){this.titleField=t},getTitleField:function(){return this.titleField},setUrlField:function(t){this.urlField=t},getUrlField:function(){return this.urlField},buttonsAlign:"right",setButtonsAlign:function(t){this.buttonsAlign=t},getButtonsAlign:function(){return this.buttonsAlign},setButtons:function(t){if(this._buttons=mini.byId(t),this._buttons){var e=mini.byClass("mini-tabs-buttons",this.el);e&&(e.appendChild(this._buttons),mini.parse(e),this.doLayout())}},setTabControls:function(t,e){if(t=this.getTab(t)){var i=this.getTabBodyEl(t);__mini_setControls(e,i,this)}},setTabs:function(t){if(mini.isArray(t)){this.beginUpdate(),this.removeAll();for(var e=0,i=t.length;e<i;e++){var n=t[e];n.title=mini._getMap(this.titleField,n),n.url=mini._getMap(this.urlField,n),n.name=mini._getMap(this.nameField,n)}for(e=0,i=t.length;e<i;e++)this.addTab(t[e]);this.setActiveIndex(0),this.endUpdate()}},getTabs:function(){return this.tabs},removeAll:function(t){var e=this.getActiveTab();mini.isNull(t)&&(t=[]),mini.isArray(t)||(t=[t]);for(var i=t.length-1;0<=i;i--){var n=this.getTab(t[i]);n?t[i]=n:t.removeAt(i)}var s=this.tabs;for(i=s.length-1;0<=i;i--){var o=s[i];-1==t.indexOf(o)&&this.removeTab(o)}var r=t[0];e!=this.getActiveTab()&&r&&this.activeTab(r)},addTab:function(t,e){"string"==typeof t&&(t={title:t}),(t=this.createTab(t)).name||(t.name="");var i=this.getActiveTab();"number"!=typeof e&&(e=this.tabs.length),this.tabs.insert(e,t),i&&(this.activeIndex=this.tabs.indexOf(i));var n='<div id="'+this._createTabBodyId(t)+'" class="mini-tabs-body '+t.bodyCls+'" style="'+t.bodyStyle+';display:none;"></div>';mini.append(this._bodyEl,n);var s=this.getTabBodyEl(t),o=t.body;if(delete t.body,o){mini.isArray(o)||(o=[o]);for(var r=0,l=o.length;r<l;r++)mini.append(s,o[r])}if(t.bodyParent)for(var a=t.bodyParent;a.firstChild;)8==a.firstChild.nodeType?a.removeChild(a.firstChild):s.appendChild(a.firstChild);return delete t.bodyParent,t.controls&&(this.setTabControls(t,t.controls),delete t.controls),this.doUpdate(),t},removeTab:function(t){if((t=this.getTab(t))&&-1!=this.tabs.indexOf(t)){var e=this.getActiveTab(),i=t==e,n=this._OnTabDestroy(t);this.tabs.remove(t),this._doRemoveIFrame(t);var s=this.getTabBodyEl(t);if(s&&this._bodyEl.removeChild(s),n&&i){for(var o=this.activeIndex;0<=o;o--){if((t=this.getTab(o))&&t.enabled&&t.visible){this.activeIndex=o;break}}this.doUpdate(),this.setActiveIndex(this.activeIndex),this.fire("activechanged")}else this.activeIndex=this.tabs.indexOf(e),this.doUpdate();return t}},moveTab:function(t,e){if(t=this.getTab(t)){var i=this.tabs[e];if(i!=t)this.tabs.remove(t),-1==(e=this.tabs.indexOf(i))?this.tabs.add(t):this.tabs.insert(e,t),this.doUpdate()}},updateTab:function(t,e){if(t=this.getTab(t)){if(mini.copyTo(t,e),!t.visible&&this.tabs.indexOf(t)==this.activeIndex){for(var i=-1,n=this.activeIndex+1,s=this.tabs.length;n<s;n++){if(this.tabs[n].visible){i=n;break}}this.setActiveIndex(i)}this.doUpdate()}},_getMaskWrapEl:function(){return this._bodyEl},_doRemoveIFrame:function(t,e){if(t._iframeEl&&t._iframeEl.parentNode){var i=t._iframeEl;if(i.onload=function(){},jQuery(i).unbind("load"),i.src="",mini.isIE)try{i.contentWindow.document.write(""),i.contentWindow.document.close()}catch(t){}t._iframeEl._ondestroy&&t._iframeEl._ondestroy();try{i.parentNode.removeChild(i),i.removeNode(!0)}catch(t){}}if(t._iframeEl=null,!(t.loadedUrl=null)===e){var n=this.getTabBodyEl(t);if(n)for(var s=mini.getChildNodes(n,!0),o=0,r=s.length;o<r;o++){var l=s[o];l&&l.parentNode&&l.parentNode.removeChild(l)}}},_deferLoadingTime:180,_cancelLoadTabs:function(t){for(var e=this.tabs,i=0,n=e.length;i<n;i++){var s=e[i];s!=t&&s._loading&&s._iframeEl&&(s._loading=!1,this._doRemoveIFrame(s,!0))}t&&t==this.getActiveTab()&&t._loading||(this._loading=!1,this.unmask())},_doLoadTab:function(s){if(s&&s==this.getActiveTab()){var t=this.getTabBodyEl(s);if(t){this._cancelLoadTabs(),this._doRemoveIFrame(s,!0),this._loading=!0,s._loading=!0,this.unmask(),this.maskOnLoad&&this.loading();var o=new Date,r=this;r.isLoading=!0;var e=mini.createIFrame(s.url,function(t,e){try{s._iframeEl.contentWindow.Owner=window,s._iframeEl.contentWindow.CloseOwnerWindow=function(t){s.removeAction=t;var e=!0;if(s.ondestroy&&("string"==typeof s.ondestroy&&(s.ondestroy=window[s.ondestroy]),s.ondestroy)){var i=r._getTabEvent(s);i.action=t,e=s.ondestroy.call(r,i)}if(!1===e)return!1;setTimeout(function(){r.removeTab(s)},10)}}catch(n){}if(1==s._loading){var i=o-new Date+r._deferLoadingTime;if(s._loading=!1,s.loadedUrl=s.url,i<0&&(i=0),setTimeout(function(){r.unmask(),r.doLayout(),r.isLoading=!1},i),e){var n={sender:r,tab:s,index:r.tabs.indexOf(s),name:s.name,iframe:s._iframeEl};s.onload&&("string"==typeof s.onload&&(s.onload=window[s.onload]),s.onload&&s.onload.call(r,n))}r.getActiveTab()==s&&r.fire("tabload",n)}},this.clearTimeStamp,s.method,s.params);setTimeout(function(){s._iframeEl==e&&t.appendChild(e)},1),s._iframeEl=e}}},_getTabEvent:function(t){return{sender:this,tab:t,index:this.tabs.indexOf(t),name:t.name,iframe:t._iframeEl,autoActive:!0}},_OnTabDestroy:function(t){var e=this._getTabEvent(t);return this.fire("tabdestroy",e),e.autoActive},loadTab:function(t,e,i,n){if(t&&(e=(e=this.getTab(e))||this.getActiveTab())){var s=this.getTabBodyEl(e);s&&mini.addClass(s,"mini-tabs-hideOverflow"),e.url=t,delete e.loadedUrl,i&&(e.onload=i),n&&(e.ondestroy=n);var o=this;clearTimeout(this._loadTabTimer),this._loadTabTimer=null,this._loadTabTimer=setTimeout(function(){o._doLoadTab(e)},1)}},reloadTab:function(t){(t=(t=this.getTab(t))||this.getActiveTab())&&this.loadTab(t.url,t)},getTabRows:function(){for(var t=[],e=[],i=0,n=this.tabs.length;i<n;i++){var s=this.tabs[i];0!=i&&s.newLine&&(t.push(e),e=[]),e.push(s)}return t.push(e),t},doUpdate:function(){if(!1!==this._allowUpdate){this._buttons&&this._buttons.parentNode&&this._buttons.parentNode.removeChild(this._buttons),mini.removeClass(this.el,"mini-tabs-position-left"),mini.removeClass(this.el,"mini-tabs-position-top"),mini.removeClass(this.el,"mini-tabs-position-right"),mini.removeClass(this.el,"mini-tabs-position-bottom"),"bottom"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-bottom"),this._doUpdateBottom()):"right"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-right"),this._doUpdateRight()):"left"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-left"),this._doUpdateLeft()):(mini.addClass(this.el,"mini-tabs-position-top"),this._doUpdateTop());var t=this._headerEl,e="mini-tabs-header-";mini.removeClass(t,e+"left"),mini.removeClass(t,e+"top"),mini.removeClass(t,e+"right"),mini.removeClass(t,e+"bottom"),mini.addClass(t,e+this.tabPosition);t=this._bodyEl,e="mini-tabs-body-";if(mini.removeClass(t,e+"left"),mini.removeClass(t,e+"top"),mini.removeClass(t,e+"right"),mini.removeClass(t,e+"bottom"),mini.addClass(t,e+this.tabPosition),this._buttons)(t=mini.byClass("mini-tabs-buttons",this.el))&&(t.appendChild(this._buttons),mini.parse(t));this.doLayout(),this.setActiveIndex(this.activeIndex,!1)}},_handleIFrameOverflow:function(){var t=this.getTabBodyEl(this.activeIndex);if(t){mini.removeClass(t,"mini-tabs-hideOverflow");var e=mini.getChildNodes(t)[0];e&&e.tagName&&"IFRAME"==e.tagName.toUpperCase()&&mini.addClass(t,"mini-tabs-hideOverflow")}},doLayout:function(){var t=this._headerEl,e=this._bodyEl,i=this.tabPosition;if(this.canLayout()){t.style.display=this.showHeader?"":"none",this._handleIFrameOverflow();var n=this.isAutoHeight(),s=x=this.getHeight(!0),o=P=this.getWidth();this.showBody?e.style.display="":e.style.display="none";var r=this.el.firstChild;if(this.plain?mini.addClass(r,"mini-tabs-plain"):mini.removeClass(r,"mini-tabs-plain"),!n&&this.showBody){var l=jQuery(t).outerHeight(),a=jQuery(t).outerWidth();if("top"!=i&&"bottom"!=i||(l=jQuery(t.parentNode).outerHeight(),l-=1),"left"==i||"right"==i?P-=a:x-=l,jQuery.boxModel){var h=mini.getPaddings(e),u=mini.getBorders(e);x=x-h.top-h.bottom-u.top-u.bottom,P=P-h.left-h.right-u.left-u.right}if(margin=mini.getMargins(e),(x=x-margin.top-margin.bottom)<0&&(x=0),(P=P-margin.left-margin.right)<0&&(P=0),e.style.width=P+"px",e.style.height=x+"px","left"==i||"right"==i){for(var d=(T=(p=t.getElementsByTagName("tr")[0]).childNodes)[0].getElementsByTagName("tr"),c=last=all=0,m=0,f=d.length;m<f;m++){var p=d[m],g=jQuery(p).outerHeight();all+=g,0==m&&(c=g),m==f-1&&(last=g)}switch(this.tabAlign){case"center":var _=parseInt((s-(all-c-last))/2);for(m=0,f=T.length;m<f;m++){T[m].firstChild.style.height=s+"px";var v=(d=(b=T[m].firstChild).getElementsByTagName("tr"))[0],w=d[d.length-1];v.style.height=_+"px",w.style.height=_+"px"}break;case"right":for(m=0,f=T.length;m<f;m++){p=(d=(b=T[m].firstChild).getElementsByTagName("tr"))[0];0<=(y=s-(all-c))&&(p.style.height=y+"px")}break;case"fit":for(m=0,f=T.length;m<f;m++)T[m].firstChild.style.height=s+"px";break;default:for(m=0,f=T.length;m<f;m++){var y;p=(d=(b=T[m].firstChild).getElementsByTagName("tr"))[d.length-1];0<=(y=s-(all-last))&&(p.style.height=y+"px")}}}}else e.style.width="auto",e.style.height="auto";var C=this.getTabBodyEl(this.activeIndex);if(C)if(!n&&this.showBody){var x=mini.getHeight(e,!0);if(jQuery.boxModel){h=mini.getPaddings(C),u=mini.getBorders(C);x=x-h.top-h.bottom-u.top-u.bottom}C.style.height=x+"px"}else C.style.height="auto";switch(i){case"bottom":for(m=0,f=(S=t.childNodes).length;m<f;m++){var b=S[m];mini.removeClass(b,"mini-tabs-header2"),1<f&&0!=m&&mini.addClass(b,"mini-tabs-header2")}break;case"left":for(m=0,f=(T=t.firstChild.rows[0].cells).length;m<f;m++){var E=T[m];mini.removeClass(E,"mini-tabs-header2"),1<f&&0==m&&mini.addClass(E,"mini-tabs-header2")}break;case"right":var T;for(m=0,f=(T=t.firstChild.rows[0].cells).length;m<f;m++){E=T[m];mini.removeClass(E,"mini-tabs-header2"),1<f&&0!=m&&mini.addClass(E,"mini-tabs-header2")}break;default:var S;for(m=0,f=(S=t.childNodes).length;m<f;m++){b=S[m];mini.removeClass(b,"mini-tabs-header2"),1<f&&0==m&&mini.addClass(b,"mini-tabs-header2")}}mini.removeClass(this.el,"mini-tabs-scroll");E=mini.byClass("mini-tabs-lastSpace",this.el);var k=mini.byClass("mini-tabs-buttons",this.el),I=t.parentNode;I.style.paddingRight="0px",this._navEl&&(this._navEl.style.display="none"),this._leftNavEl&&(this._leftNavEl.style.display="none"),k&&(k.style.display="none");var O="right"==this.buttonsAlign;if(O||(k.style.right="auto",k.style.left="0"),mini.setWidth(I,o),!("top"!=i&&"bottom"!=i||"left"!=this.tabAlign&&"right"!=this.tabAlign)){t.style.width="auto",k.style.display="block";var N=o,F=t.firstChild.offsetWidth-E.offsetWidth,M=k.firstChild?k.offsetWidth:0;if(N<F+M){this._navEl.style.display="block";var L=this._navEl.offsetWidth,D=0;this.showNavMenu&&(this._headerMenuEl.style.display="inline-block",D=this._headerMenuEl.offsetWidth,this._headerMenuEl.style.right=M+"px",this._headerMenu||this._createHeaderMenu());var B=0;"side"==this.arrowPosition&&(this._leftNavEl.style.display="block",B=this._leftNavEl.offsetWidth,t.style.left=B+"px"),this._navEl.style.right=(O?M:0)+D+"px";var P=N-M-L-B-D;mini.setWidth(t,P)}else t.style.left="0px";t.style.marginLeft=(O?0:M)+"px"}this._scrollToTab(this.activeIndex),this._doScrollButton(),mini.layout(e);var V=this.getActiveTab();if(V&&V.repaint&&C){P=C.style.width;C.style.width="0px",setTimeout(function(){C.style.width=P},1)}this.fire("layout")}},_getTabBy_Id:function(t){for(var e=0,i=this.tabs.length;e<i;e++){var n=this.tabs[e];if(n._id==t)return n}},_createHeaderMenu:function(){this._headerMenu=new mini.Menu,this._headerMenu.setIdField("_id"),this._headerMenu.setTextField("title"),this._headerMenu.setPopupEl(this._headerMenuEl),this._headerMenu.setShowAction("leftclick"),this._headerMenu.setHideAction("outerclick"),this._headerMenu.setXAlign("left"),this._headerMenu.setYAlign("below"),mini.addClass(this._headerMenu.el,"mini-menu-open"),this._headerMenu.on("itemclick",this._doMenuSelectTab,this),this._headerMenu.hide(),this._headerMenu.owner=this._headerMenuEl},_setHeaderMenuItems:function(){for(var t=this.getTabs(),e=[],i=0,n=t.length;i<n;i++){var s=t[i];e.push({id:s._id,text:s[this.titleField]})}this._headerMenu.setItems(e)},_doMenuSelectTab:function(t){var e=t.item,i=this._getTabBy_Id(e.id);this.activeTab(i)},setTabAlign:function(t){this.tabAlign=t,this.doUpdate()},setTabPosition:function(t){this.tabPosition=t,this.doUpdate()},allowClickWrap:!0,setAllowClickWrap:function(t){this.allowClickWrap=t},getAllowClickWrap:function(){return this.allowClickWrap},getTab:function(t){if("object"==typeof t)return t;if("number"==typeof t)return this.tabs[t];for(var e=0,i=this.tabs.length;e<i;e++){var n=this.tabs[e];if(n.name==t)return n}},getHeaderEl:function(){return this._headerEl},getBodyEl:function(){return this._bodyEl},getTabEl:function(t){var e=this.getTab(t);if(!e)return null;for(var i=this._createTabId(e),n=this.el.getElementsByTagName("*"),s=0,o=n.length;s<o;s++){var r=n[s];if(r.id==i)return r}return null},getTabBodyEl:function(t){var e=this.getTab(t);if(!e)return null;for(var i=this._createTabBodyId(e),n=this._bodyEl.childNodes,s=0,o=n.length;s<o;s++){var r=n[s];if(r.id==i)return r}return null},getTabIFrameEl:function(t){var e=this.getTab(t);return e?e._iframeEl:null},_createTabId:function(t){return this.uid+"$"+t._id},_createTabBodyId:function(t){return this.uid+"$body$"+t._id},_doScrollButton:function(){if("top"==this.tabPosition||"bottom"==this.tabPosition){mini.removeClass(this._leftButtonEl,"mini-disabled"),mini.removeClass(this._rightButtonEl,"mini-disabled"),0==this._headerEl.scrollLeft&&mini.addClass(this._leftButtonEl,"mini-disabled");var t=this.getTabEl(this.tabs.length-1);if(t){var e=mini.getBox(t),i=mini.getBox(this._headerEl);e.right<=i.right&&mini.addClass(this._rightButtonEl,"mini-disabled")}}},setActiveIndex:function(t,e){var i,n=this.getTab(t),s=n!=(l=this.getTab(this.activeIndex));if((i=this.getTabBodyEl(this.activeIndex))&&(i.style.display="none"),this.activeIndex=n?this.tabs.indexOf(n):-1,(i=this.getTabBodyEl(this.activeIndex))&&(i.style.display=""),(i=this.getTabEl(l))&&mini.removeClass(i,this._tabActiveCls),(i=this.getTabEl(n))&&mini.addClass(i,this._tabActiveCls),i&&s){if("bottom"==this.tabPosition)(r=mini.findParent(i,"mini-tabs-header"))&&jQuery(this._headerEl).prepend(r);else if("left"==this.tabPosition){(o=mini.findParent(i,"mini-tabs-header").parentNode)&&o.parentNode.appendChild(o)}else if("right"==this.tabPosition){var o;(o=mini.findParent(i,"mini-tabs-header").parentNode)&&jQuery(o.parentNode).prepend(o)}else{var r;(r=mini.findParent(i,"mini-tabs-header"))&&this.allowClickWrap&&this._headerEl.appendChild(r)}this._headerEl.scrollLeft;var l,a=!!(l=this.getTab(this.activeIndex))&&!l._layouted;(this.isAutoHeight()||a)&&(l&&(l._layouted=!0),this.doLayout(),l&&(l._layouted=!1)),1<this.getTabRows().length||(this._scrollToTab(this.activeIndex),this._doScrollButton());for(var h=0,u=this.tabs.length;h<u;h++){var d=this.getTabEl(this.tabs[h]);d&&mini.removeClass(d,this._tabHoverCls)}}var c=this;if(s){var m={tab:n,index:this.tabs.indexOf(n),name:n?n.name:""};setTimeout(function(){c.fire("ActiveChanged",m)},1)}this._cancelLoadTabs(n),!1===e||n&&n.url&&!n.loadedUrl&&(c=this).loadTab(n.url,n);if(n&&mini.isChrome){var f=this.getTabIFrameEl(n);f&&(f.style.position="relative",f.style.left="1px",f.offsetWidth,f.style.left="0px")}if(c.canLayout())try{mini.layoutIFrames(c.el)}catch(m){}},_scrollToTab:function(t){var e=this._headerEl.scrollLeft;if("top"==this.tabPosition||"bottom"==this.tabPosition){this._headerEl.scrollLeft=e;var i=this.getTabEl(t);if(i){var n=mini.getBox(i),s=mini.getBox(this._headerEl);n.x<s.x?this._headerEl.scrollLeft-=s.x-n.x:n.right>s.right&&(this._headerEl.scrollLeft+=n.right-s.right)}}},getActiveIndex:function(){return this.activeIndex},activeTab:function(t){this.setActiveIndex(t)},getActiveTab:function(){return this.getTab(this.activeIndex)},getActiveIndex:function(){return this.activeIndex},_tryActiveTab:function(t){if(t=this.getTab(t)){var e=this.tabs.indexOf(t);if(this.activeIndex!=e){var i={tab:t,index:e,name:t.name,cancel:!1};this.fire("BeforeActiveChanged",i),0==i.cancel&&this.activeTab(t)}}},setShowHeader:function(t){this.showHeader!=t&&(this.showHeader=t,this.doLayout())},getShowHeader:function(){return this.showHeader},setShowBody:function(t){this.showBody!=t&&(this.showBody=t,this.doLayout())},getShowBody:function(){return this.showBody},setBodyStyle:function(t){this.bodyStyle=t,mini.setStyle(this._bodyEl,t),this.doLayout()},getBodyStyle:function(){return this.bodyStyle},setMaskOnLoad:function(t){this.maskOnLoad=t},getMaskOnLoad:function(){return this.maskOnLoad},setPlain:function(t){this.plain=t,this.doLayout()},getPlain:function(){return this.plain},arrowPosition:"right",setArrowPosition:function(t){this.arrowPosition=t},getArrowPosition:function(){return this.arrowPosition},showNavMenu:!1,setShowNavMenu:function(t){this.showNavMenu=t},getShowNavMenu:function(){return this.showNavMenu},clearTimeStamp:!1,setClearTimeStamp:function(t){this.clearTimeStamp=t},getClearTimeStamp:function(){return this.clearTimeStamp},getTabByEvent:function(t){return this._getTabByEvent(t)},_getTabByEvent:function(t){var e=mini.findParent(t.target,"mini-tab");if(!e)return null;if(e.id.split("$")[0]!=this.uid)return null;var i=parseInt(jQuery(e).attr("index"));return this.getTab(i)},__OnDblClick:function(t){var e=this._getTabByEvent(t);if(e){t={tab:e};this.fire("tabdblclick",t)}},__OnClick:function(e){var i=this._getTabByEvent(e);if(i){var n=!!mini.findParent(e.target,"mini-tab-close");if((n||i!=this.getActiveTab()||i.refreshOnClick)&&i.enabled){var s=this;setTimeout(function(){if(n)s._OnCloseButtonClick(i,e);else{var t=i.loadedUrl;s._tryActiveTab(i),i.refreshOnClick&&i.url==t&&s.reloadTab(i)}},10)}}},hoverTab:null,__OnMouseOver:function(t){var e=this._getTabByEvent(t);if(e&&e.enabled){var i=this.getTabEl(e);mini.addClass(i,this._tabHoverCls),this.hoverTab=e}},__OnMouseOut:function(t){if(this.hoverTab){var e=this.getTabEl(this.hoverTab);mini.removeClass(e,this._tabHoverCls)}this.hoverTab=null},__OnMouseDown:function(t){if(clearInterval(this._scrollTimer),"top"==this.tabPosition||"bottom"==this.tabPosition){var e=this,i=0,n=10;t.target==this._leftButtonEl?this._scrollTimer=setInterval(function(){e._headerEl.scrollLeft-=n,5<++i&&(n=18),10<i&&(n=25),e._doScrollButton()},25):t.target==this._rightButtonEl?this._scrollTimer=setInterval(function(){e._headerEl.scrollLeft+=n,5<++i&&(n=18),10<i&&(n=25),e._doScrollButton()},25):t.target==this._headerMenuEl&&this._setHeaderMenuItems(),mini.on(document,"mouseup",this.__OnDocMouseUp,this)}},__OnDocMouseUp:function(t){clearInterval(this._scrollTimer),this._scrollTimer=null,mini.un(document,"mouseup",this.__OnDocMouseUp,this)},_doUpdateTop:function(){this.tabPosition;var t="";t+='<div class="mini-tabs-scrollCt">',"side"==this.arrowPosition?(t+='<div class="mini-tabs-leftnav"><a class="mini-tabs-leftButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>',t+='<div class="mini-tabs-nav"><a class="mini-tabs-rightButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>'):t+='<div class="mini-tabs-nav"><a class="mini-tabs-leftButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a><a class="mini-tabs-rightButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>',this.showNavMenu&&(t+='<a class="mini-tabs-tabmenu mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a>'),t+='<div class="mini-tabs-buttons" a=1 style="'+("right"==this.buttonsAlign?"":"right:auto;left:0;")+'"></div>',t+='<div class="mini-tabs-headers">';for(var e=this.getTabRows(),i=0,n=e.length;i<n;i++){var s=e[i],o="";t+='<table class="mini-tabs-header" cellspacing="0" cellpadding="0"><tr><td class="mini-tabs-space mini-tabs-firstSpace"><div></div></td>';for(var r=0,l=s.length;r<l;r++){var a=s[r],h=this._createTabId(a);if(a.visible){var u=this.tabs.indexOf(a);o=a.headerCls||"";if(0==a.enabled&&(o+=" mini-disabled"),t+='<td title="'+a.tooltip+'" id="'+h+'" index="'+u+'"  class="mini-tab mini-corner-all '+o+'" style="'+a.headerStyle+'">',(a.iconCls||a.iconStyle)&&(t+='<span class="mini-tab-icon mini-iconfont '+a.iconCls+'" style="'+a.iconStyle+'"></span>'),t+='<span class="mini-tab-text">'+a.title+"</span>",a.showCloseButton){var d="";a.enabled&&(d="onmouseover=\"mini.addClass(this, 'mini-tab-close-hover')\" onmouseout=\"mini.removeClass(this, 'mini-tab-close-hover')\""),t+='<span class="mini-tab-close mini-icon" '+d+" ></span>"}t+="</td>",r!=l-1&&(t+='<td class="mini-tabs-space2"><div></div></td>')}}t+='<td class="mini-tabs-space mini-tabs-lastSpace" ><div></div></td></tr></table>'}t+="</div>",t+="</div>",this._doClearElement(),mini.prepend(this._td2El,t);var c=this._td2El;switch(this._headerEl=c.firstChild.lastChild,"side"==this.arrowPosition?(this._leftNavEl=c.firstChild.firstChild,this._navEl=this._headerEl.parentNode.children[1],this._leftButtonEl=this._leftNavEl.firstChild,this._rightButtonEl=this._navEl.firstChild,this.showNavMenu&&(this._headerMenuEl=this._headerEl.parentNode.children[2])):(this._navEl=this._headerEl.parentNode.firstChild,this._leftButtonEl=this._navEl.firstChild,this._rightButtonEl=this._navEl.childNodes[1],this.showNavMenu&&(this._headerMenuEl=this._headerEl.parentNode.children[1])),this.tabAlign){case"center":for(r=0,l=(m=this._headerEl.childNodes).length;r<l;r++){(f=m[r].getElementsByTagName("td"))[0].style.width="50%",f[f.length-1].style.width="50%"}break;case"right":for(r=0,l=(m=this._headerEl.childNodes).length;r<l;r++){(f=m[r].getElementsByTagName("td"))[0].style.width="100%"}break;case"fit":break;default:var m;for(r=0,l=(m=this._headerEl.childNodes).length;r<l;r++){var f;(f=m[r].getElementsByTagName("td"))[f.length-1].style.width="100%"}}},_doUpdateBottom:function(){this._doUpdateTop();var t=this._td2El;mini.append(t,t.firstChild),this._headerEl=t.lastChild.lastChild},_doUpdateLeft:function(){for(var t='<table cellspacing="0" cellpadding="0"><tr>',e=this.getTabRows(),i=0,n=e.length;i<n;i++){var s=e[i],o="";1<n&&i!=n-1&&(o="mini-tabs-header2"),t+='<td class="'+o+'"><table class="mini-tabs-header" cellspacing="0" cellpadding="0">',t+='<tr ><td class="mini-tabs-space mini-tabs-firstSpace" ><div></div></td></tr>';for(var r=0,l=s.length;r<l;r++){var a=s[r],h=this._createTabId(a);if(a.visible){var u=this.tabs.indexOf(a);o=a.headerCls||"";if(0==a.enabled&&(o+=" mini-disabled"),t+='<tr><td id="'+h+'" index="'+u+'"  class="mini-tab '+o+'" style="'+a.headerStyle+'">',(a.iconCls||a.iconStyle)&&(t+='<span class="mini-tab-icon mini-iconfont '+a.iconCls+'" style="'+a.iconStyle+'"></span>'),t+='<span class="mini-tab-text">'+a.title+"</span>",a.showCloseButton){var d="";a.enabled&&(d="onmouseover=\"mini.addClass(this, 'mini-tab-close-hover')\" onmouseout=\"mini.removeClass(this, 'mini-tab-close-hover')\""),t+='<span class="mini-tab-close mini-icon" '+d+"></span>"}t+="</td></tr>",r!=l-1&&(t+='<tr><td class="mini-tabs-space2"><div></div></td></tr>')}}t+='<tr ><td class="mini-tabs-space mini-tabs-lastSpace" ><div></div></td></tr>',t+="</table></td>"}t+="</tr ></table>",this._doClearElement(),mini.addClass(this._td1El,"mini-tabs-header"),mini.append(this._td1El,t),this._headerEl=this._td1El},_doUpdateRight:function(){this._doUpdateLeft(),mini.removeClass(this._td1El,"mini-tabs-header"),mini.removeClass(this._td3El,"mini-tabs-header"),mini.append(this._td3El,this._td1El.firstChild),this._headerEl=this._td3El},_OnCloseButtonClick:function(t,e){var i={tab:t,index:this.tabs.indexOf(t),name:t.name.toLowerCase(),htmlEvent:e,cancel:!1};if(this.fire("beforecloseclick",i),1!=i.cancel){try{if(t._iframeEl&&t._iframeEl.contentWindow){var n=!0;t._iframeEl.contentWindow.CloseWindow?n=t._iframeEl.contentWindow.CloseWindow("close"):t._iframeEl.contentWindow.CloseOwnerWindow&&(n=t._iframeEl.contentWindow.CloseOwnerWindow("close")),!1===n&&(i.cancel=!0)}}catch(t){}1!=i.cancel&&(t.removeAction="close",this.removeTab(t),this.fire("closeclick",i))}},onBeforeCloseClick:function(t,e){this.on("beforecloseclick",t,e)},onCloseClick:function(t,e){this.on("closeclick",t,e)},onActiveChanged:function(t,e){this.on("activechanged",t,e)},getAttrs:function(t){var e=mini.Tabs.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["tabAlign","tabPosition","bodyStyle","onactivechanged","onbeforeactivechanged","url","ontabload","ontabdestroy","onbeforecloseclick","oncloseclick","ontabdblclick","titleField","urlField","nameField","loadingMsg","buttons","arrowPosition","buttonsAlign"]),mini._ParseBool(t,e,["allowAnim","showBody","showHeader","maskOnLoad","plain","allowClickWrap","showNavMenu","clearTimeStamp"]),mini._ParseInt(t,e,["activeIndex"]);for(var i=[],n=mini.getChildNodes(t),s=0,o=n.length;s<o;s++){var r=n[s],l={};i.push(l),l.style=r.style.cssText,mini._ParseString(r,l,["name","title","url","cls","iconCls","iconStyle","headerCls","headerStyle","bodyCls","bodyStyle","onload","ondestroy","data-options","tooltip"]),mini._ParseBool(r,l,["newLine","visible","enabled","showCloseButton","refreshOnClick"]),l.bodyParent=r;var a=l["data-options"];(a=a&&window.eval("("+a+")"))&&mini.copyTo(l,a)}return e.tabs=i,e}}),mini.regClass(mini.Tabs,"tabs"),mini.Menu=function(){this.items=[],mini.Menu.superclass.constructor.apply(this,arguments)},mini.extend(mini.Menu,mini.Control),mini.copyTo(mini.Menu.prototype,mini.Popup_prototype);var mini_Popup_prototype_hide=mini.Popup_prototype.hide;mini.copyTo(mini.Menu.prototype,{height:"auto",width:"auto",minWidth:140,vertical:!0,allowSelectItem:!1,_selectedItem:null,_itemSelectedCls:"mini-menuitem-selected",textField:"text",resultAsTree:!1,idField:"id",parentField:"pid",itemsField:"children",iconClsField:"iconCls",showNavArrow:!0,imgPath:"",overflow:!1,_clearBorder:!1,showAction:"none",hideAction:"outerclick",menuAlign:"",setMenuAlign:function(t){this.menuAlign=t},getMenuAlign:function(){return this.menuAlign},getbyName:function(t){for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];if(n.name==t)return n;if(n.menu){var s=n.menu.getbyName(t);if(s)return s}}return null},set:function(t){if("string"==typeof t)return this;var e=t.url;return delete t.url,t.imgPath&&this.setImgPath(t.imgPath),delete t.imgPath,this.ownerItem=t.ownerItem,delete t.ownerItem,mini.Menu.superclass.set.call(this,t),e&&this.setUrl(e),this},uiCls:"mini-menu",_create:function(){this.el=document.createElement("div"),this.el.className="mini-menu",this.el.innerHTML='<div class="mini-menu-border"><a class="mini-menu-topArrow mini-icon" href="#" onclick="return false"></a><div class="mini-menu-inner"></div><a class="mini-menu-bottomArrow mini-icon" href="#" onclick="return false"></a></div>',this._borderEl=this.el.firstChild,this._topArrowEl=this._borderEl.childNodes[0],this._bottomArrowEl=this._borderEl.childNodes[2],this._innerEl=this._borderEl.childNodes[1],this._innerEl.innerHTML='<div class="mini-menu-float"></div><div class="mini-menu-toolbar"></div><div style="clear:both;max-height: 1px;"></div>',this._contentEl=this._innerEl.firstChild,this._toolbarEl=this._innerEl.childNodes[1],0==this.isVertical()&&mini.addClass(this.el,"mini-menu-horizontal")},destroy:function(t){if(this.items)for(var e=0,i=this.items.length;e<i;e++)this.items[e].destroy();this._topArrowEl&&(this._topArrowEl.onmousedown=this._bottomArrowEl.onmousedown=null),this._popupEl=this.popupEl=this._borderEl=this._innerEl=this._contentEl=this._toolbarEl=null,this._topArrowEl=this._bottomArrowEl=null,this.owner=null,this.window=null,mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this),mini.Menu.superclass.destroy.call(this,t)},_disableContextMenu:!1,_initEvents:function(){mini._BindEvents(function(){mini.on(document,"mousedown",this.__OnBodyMouseDown,this),mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this),this._disableContextMenu&&mini_onOne(this.el,"contextmenu",function(t){t.preventDefault()},this),mini_onOne(this._topArrowEl,"mousedown",this.__OnTopMouseDown,this),mini_onOne(this._bottomArrowEl,"mousedown",this.__OnBottomMouseDown,this)},this)},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=0,i=this.items.length;e<i;e++){if(this.items[e].within(t))return!0}return!1},setVertical:function(t){(this.vertical=t)?mini.removeClass(this.el,"mini-menu-horizontal"):mini.addClass(this.el,"mini-menu-horizontal")},getVertical:function(){return this.vertical},isVertical:function(){return this.vertical},show:function(){this.setVisible(!0)},hide:function(){this.hideItems(),mini_Popup_prototype_hide.call(this)},hideItems:function(){for(var t=0,e=this.items.length;t<e;t++){this.items[t].hideMenu()}},showItemMenu:function(t){for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];n==t?n.showMenu():n.hideMenu()}},hasShowItemMenu:function(){for(var t=0,e=this.items.length;t<e;t++){var i=this.items[t];if(i&&i.menu&&i.menu.isPopup)return!0}return!1},setData:function(t){mini.isArray(t)||(t=[]),this.setItems(t)},getData:function(){return this.getItems()},setItems:function(t){mini.isArray(t)||(t=[]),this.removeAll();new Date;for(var e=0,i=t.length;e<i;e++)this.addItem(t[e])},getItems:function(){return this.items},_itemType:"menuitem",addItem:function(t){if("-"!=t&&"|"!=t&&"separator"!=t.type)mini.isControl(t)||mini.getClass(t.type)||(t.type=this._itemType),t.ownerMenu=this,t=mini.getAndCreate(t),this.items.push(t),this._contentEl.appendChild(t.el),(t.ownerMenu=this).fire("itemschanged");else{var e=t.id?'id="'+t.id+'"':"";mini.append(this._contentEl,"<span "+e+' name="'+(t.name||"")+'" class="mini-separator"></span>')}},removeItem:function(t){(t=mini.get(t))&&(this.items.remove(t),this._contentEl.removeChild(t.el),this.fire("itemschanged"))},removeItemAt:function(t){var e=this.items[t];this.removeItem(e)},removeAll:function(){for(var t=this.items.clone(),e=t.length-1;0<=e;e--)this.removeItem(t[e]);this._contentEl.innerHTML=""},getGroupItems:function(t){if(!t)return[];for(var e=[],i=0,n=this.items.length;i<n;i++){var s=this.items[i];s.groupName==t&&e.push(s)}return e},getItem:function(t){if("number"==typeof t)return this.items[t];if("string"!=typeof t)return t&&-1!=this.items.indexOf(t)?t:null;for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];if(n.id==t)return n}return null},setAllowSelectItem:function(t){this.allowSelectItem=t},getAllowSelectItem:function(){return this.allowSelectItem},setSelectedItem:function(t){t=this.getItem(t),this._OnItemSelect(t)},getSelectedItem:function(t){return this._selectedItem},setShowNavArrow:function(t){this.showNavArrow=t},getShowNavArrow:function(){return this.showNavArrow},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},setResultAsTree:function(t){this.resultAsTree=t},getResultAsTree:function(){return this.resultAsTree},setIdField:function(t){this.idField=t},getIdField:function(){return this.idField},setParentField:function(t){this.parentField=t},getParentField:function(){return this.parentField},setIconClsField:function(t){this.iconClsField=t},getIconClsField:function(){return this.iconClsField},setOverflow:function(t){(this.overflow=t)?mini.addClass(this.el,"mini-menu-overflow"):mini.removeClass(this.el,"mini-menu-overflow")},getOverflow:function(){return this.overflow},doLayout:function(){if(this.canLayout()){var t=this._innerEl,e=this._topArrowEl,i=this._bottomArrowEl;if(this.isAutoHeight())this._borderEl.style.height="auto",this._contentEl.style.height="auto";else{var n=mini.getHeight(this.el,!0);if(mini.setHeight(this._borderEl,n),e.style.display=i.style.display="none",this._contentEl.style.height="auto",this.showNavArrow&&this._borderEl.scrollHeight>this._borderEl.clientHeight+2){e.style.display=i.style.display="block";var s=(n=mini.getHeight(this._borderEl,!0))-mini.getHeight(e)-mini.getHeight(i);s<0&&(s=0),mini.setHeight(this._contentEl,s);var o=mini.getWidth(this._borderEl,!0);mini.setWidth(e,o),mini.setWidth(i,o)}else this._contentEl.style.height="auto"}this.overflow&&(e.style.display=i.style.display="none",t.style.marginLeft=t.style.marginRight="0px",this._getScrollWidth()>this._innerEl.offsetWidth?(e.style.display=i.style.display="block",t.style.marginLeft=t.style.marginRight="15px"):t.scrollLeft=0)}},_measureSize:function(){if("auto"==this.height){this.el.style.height="auto",this._borderEl.style.height="auto",this._contentEl.style.height="auto",this._topArrowEl.style.display=this._bottomArrowEl.style.display="none";var t=mini.getViewportBox(),e=mini.getBox(this.el);this.maxHeight=t.height-2,this.ownerItem&&(this.maxHeight=t.height-2)}this.el.style.display="",(e=mini.getBox(this.el)).width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),e=mini.getBox(this.el)),e.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),e=mini.getBox(this.el)),e.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),e=mini.getBox(this.el)),e.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),e=mini.getBox(this.el))},url:"",_doLoad:function(){var t=mini._getResult(this.url,null,null,null,null,this.dataField);this.dataField&&!mini.isArray(t)&&(t=mini._getMap(this.dataField,t)),t=t||[],0==this.resultAsTree&&(t=mini.arrayToTree(t,this.itemsField,this.idField,this.parentField));for(var e=mini.treeToArray(t,this.itemsField,this.idField,this.parentField),i=0,n=e.length;i<n;i++){var s=e[i];s.text=mini._getMap(this.textField,s),s.iconCls=mini._getMap(this.iconClsField,s),mini.isNull(s.text)&&(s.text="")}new Date;this.setItems(t),this.fire("load")},loadList:function(t,e,i){if(t){e=e||this.idField,i=i||this.parentField;for(var n=0,s=t.length;n<s;n++){var o=t[n];o.text=mini._getMap(this.textField,o),o.iconCls=mini._getMap(this.iconClsField,o),mini.isNull(o.text)&&(o.text="")}var r=mini.arrayToTree(t,this.itemsField,e,i);this.load(r)}},load:function(t){"string"==typeof t?this.setUrl(t):this.setItems(t)},setUrl:function(t){this.url=t,this._doLoad()},getUrl:function(){return this.url},hideOnClick:!0,setHideOnClick:function(t){this.hideOnClick=t},getHideOnClick:function(){return this.hideOnClick},hideOnClick:!0,setImgPath:function(t){this.imgPath=t},getImgPath:function(){return this.imgPath},_OnItemClick:function(t,e){var i={item:t,isLeaf:!t.menu,htmlEvent:e};this.hideOnClick&&(this.isPopup?this.hide():i.isLeaf&&this.hideItems()),this.allowSelectItem&&this._selectedItem!=t&&this.setSelectedItem(t),this.fire("itemclick",i),this.ownerItem},_OnItemSelect:function(t){this._selectedItem&&this._selectedItem.removeCls(this._itemSelectedCls),this._selectedItem=t,this._selectedItem&&this._selectedItem.addCls(this._itemSelectedCls);var e={item:this._selectedItem,isLeaf:!!this._selectedItem&&!this._selectedItem.menu};this.fire("itemselect",e)},onItemClick:function(t,e){this.on("itemclick",t,e)},onItemSelect:function(t,e){this.on("itemselect",t,e)},__OnTopMouseDown:function(t){this._startScrollMove(-20)},__OnBottomMouseDown:function(t){this._startScrollMove(20)},_getScrollWidth:function(){var t=0,e=jQuery(".mini-menuitem",this.el).first()[0],i=jQuery(".mini-menuitem",this.el).last()[0];if(e&&i){var n=mini.getBox(e);t=mini.getBox(i).right-n.left}return t},_getMaxScrollLeft:function(){return parseInt(this._getScrollWidth()-this._innerEl.offsetWidth+6)},_startScrollMove:function(e){clearInterval(this._scrollTimer);var t=function(){clearInterval(n._scrollTimer),mini.un(document,"mouseup",t)};mini.on(document,"mouseup",t);var i=this._getMaxScrollLeft(),n=this;this._scrollTimer=setInterval(function(){if(0==n.isVertical()){var t=n._innerEl.scrollLeft;i<(t+=e)&&(t=i),n._innerEl.scrollLeft=t}else n._contentEl.scrollTop+=e},50)},setToolbar:function(t){__mini_setControls(t,this._toolbarEl,this),this._toolbarEl.style.display="block"},parseItems:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];if("separator"!=s.className){var o=mini.getChildNodes(s),r=o[0],l=o[1];h=new mini.MenuItem;if(l){mini.applyTo.call(h,r),h.render(document.body);var a=new mini.Menu;mini.applyTo.call(a,l),h.setMenu(a),a.render(document.body),e.add(h)}else mini.applyTo.call(h,s),e.add(h)}else{var h={type:"separator",id:s.id,name:s.name};e.add(h)}}return e.clone()},getAttrs:function(t){var e=mini.Menu.superclass.getAttrs.call(this,t),i=jQuery(t);mini._ParseString(t,e,["popupEl","popupCls","showAction","hideAction","xAlign","yAlign","modalStyle","onbeforeopen","open","onbeforeclose","onclose","url","onitemclick","onitemselect","textField","idField","parentField","toolbar","imgPath","iconClsField","menuAlign"]),mini._ParseBool(t,e,["resultAsTree","hideOnClick","showNavArrow","showShadow","overflow"]);for(var n=(r=mini.getChildNodes(t)).length-1;0<=n;n--){var s=r[n],o=jQuery(s).attr("property");o&&"toolbar"==(o=o.toLowerCase())&&(e.toolbar=s).parentNode.removeChild(s)}var r=mini.getChildNodes(t),l=this.parseItems(r);0<l.length&&(e.items=l);var a=i.attr("vertical");a&&(e.vertical="true"==a);var h=i.attr("allowSelectItem");return h&&(e.allowSelectItem="true"==h),e}}),mini.regClass(mini.Menu,"menu"),mini.MenuBar=function(){mini.MenuBar.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuBar,mini.Menu,{uiCls:"mini-menubar",vertical:!1,setVertical:function(t){this.vertical=!1}}),mini.regClass(mini.MenuBar,"menubar"),mini.ContextMenu=function(){mini.ContextMenu.superclass.constructor.apply(this,arguments)},mini.extend(mini.ContextMenu,mini.Menu,{uiCls:"mini-contextmenu",vertical:!0,visible:!1,_disableContextMenu:!0,setVertical:function(t){this.vertical=!0}}),mini.regClass(mini.ContextMenu,"contextmenu"),mini.MenuItem=function(){mini.MenuItem.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuItem,mini.Control,{text:"",iconCls:"",iconStyle:"",iconPosition:"left",img:"",showIcon:!0,showAllow:!0,checked:!1,checkOnClick:!1,groupName:"",_hoverCls:"mini-menuitem-hover",_pressedCls:"mini-menuitem-pressed",_checkedCls:"mini-menuitem-checked",_clearBorder:!1,menu:null,set:function(t){return"string"==typeof t||(this.ownerMenu=t.ownerMenu,delete t.ownerMenu,mini.MenuItem.superclass.set.call(this,t)),this},uiCls:"mini-menuitem",_create:function(){this.el=document.createElement("div");this.el.className="mini-menuitem",this.el.innerHTML='<div class="mini-menuitem-inner"><div class="mini-menuitem-icon mini-icon mini-iconfont"></div><div class="mini-menuitem-text"></div><div class="mini-menuitem-allow mini-icon"></div></div>',this._innerEl=this.el.firstChild,this._iconEl=this._innerEl.firstChild,this._textEl=this._innerEl.childNodes[1],this.allowEl=this._innerEl.lastChild},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this)},this)},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini_onOne(this.el,"click",this.__OnClick,this),mini_onOne(this.el,"mouseup",this.__OnMouseUp,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this))},destroy:function(t){this.menu&&this.menu.destroy(),this.menu=this._innerEl=this._iconEl=this._textEl=this.allowEl=null,mini.MenuItem.superclass.destroy.call(this,t)},within:function(t){return!!mini.isAncestor(this.el,t.target)||!(!this.menu||!this.menu.within(t))},_getIconImg:function(){return this.img&&this.getTopMenu()?this.getTopMenu().imgPath+this.img:this.img},_doUpdateIcon:function(){var t=this._getIconImg(),e=!!(this.iconStyle||this.iconCls||this.checkOnClick||t);if(this._iconEl){if(mini.setStyle(this._iconEl,this.iconStyle),mini.addClass(this._iconEl,this.iconCls),t&&!this.checked){var i="background-image:url("+t+")";mini.setStyle(this._iconEl,i)}this.checked&&jQuery(this._iconEl).css({"background-image":""}),this._iconEl.style.display=e?"block":"none"}"top"==this.iconPosition?mini.addClass(this.el,"mini-menuitem-icontop"):mini.removeClass(this.el,"mini-menuitem-icontop")},_hasChildMenu:function(){return this.menu&&0<this.menu.items.length},doUpdate:function(){this._textEl&&(this._textEl.innerHTML=this.text),this._doUpdateIcon(),this.checked?(mini.addClass(this.el,this._checkedCls),jQuery(this._iconEl).css({"background-image":""})):mini.removeClass(this.el,this._checkedCls),this.allowEl&&(this._hasChildMenu()?this.allowEl.style.display="block":this.allowEl.style.display="none")},setText:function(t){this.text=t,this._textEl&&(this._textEl.innerHTML=this.text)},getText:function(){return this.text},setIconCls:function(t){mini.removeClass(this._iconEl,this.iconCls),this.iconCls=t,this._doUpdateIcon()},getIconCls:function(){return this.iconCls},setImg:function(t){this.img=t,this._doUpdateIcon()},getImg:function(){return this.img},setIconStyle:function(t){this.iconStyle=t,this._doUpdateIcon()},getIconStyle:function(){return this.iconStyle},setIconPosition:function(t){this.iconPosition=t,this._doUpdateIcon()},getIconPosition:function(){return this.iconPosition},setCheckOnClick:function(t){(this.checkOnClick=t)?mini.addClass(this.el,"mini-menuitem-showcheck"):mini.removeClass(this.el,"mini-menuitem-showcheck"),this.doUpdate()},getCheckOnClick:function(){return this.checkOnClick},setChecked:function(t){this.checked!=t&&(this.checked=t,this.doUpdate(),this.fire("checkedchanged"))},getChecked:function(){return this.checked},setGroupName:function(t){this.groupName!=t&&(this.groupName=t)},getGroupName:function(){return this.groupName},setChildren:function(t){this.setMenu(t)},setMenu:function(t){mini.isArray(t)&&(t={type:"menu",items:t}),this.menu!==t&&((t.ownerItem=this).menu=mini.getAndCreate(t),this.menu.hide(),(this.menu.ownerItem=this).doUpdate(),this.menu.on("itemschanged",this.__OnItemsChanged,this))},getMenu:function(){return this.menu},showMenu:function(){if(this.menu&&0==this.menu.isDisplay()){this.menu.setHideAction("outerclick");var t={xAlign:"outright",yAlign:"top",popupCls:"mini-menu-popup",alwaysView:!0};this.ownerMenu&&0==this.ownerMenu.vertical&&(t.xAlign=this.ownerMenu.menuAlign||"left",t.yAlign="below",t.outXAlign="right"),this.menu.showAtEl(this.el,t),this.menu.addCls("mini-menu-open")}},hideMenu:function(){this.menu&&this.menu.hide()},hide:function(){this.hideMenu(),this.setVisible(!1)},__OnItemsChanged:function(t){this.doUpdate()},getTopMenu:function(){return this.ownerMenu?this.ownerMenu.ownerItem?this.ownerMenu.ownerItem.getTopMenu():this.ownerMenu:null},__OnClick:function(t){if(!this.isReadOnly()){if(this.checkOnClick)if(this.ownerMenu&&this.groupName){var e=this.ownerMenu.getGroupItems(this.groupName);if(0<e.length){if(0==this.checked){for(var i=0,n=e.length;i<n;i++){var s=e[i];s!=this&&s.setChecked(!1)}this.setChecked(!0)}}else this.setChecked(!this.checked)}else this.setChecked(!this.checked);this.fire("click");var o=this.getTopMenu();o&&o._OnItemClick(this,t)}},__OnMouseUp:function(t){if(!this.isReadOnly()&&this.ownerMenu){var e=this;setTimeout(function(){e.isDisplay()&&e.ownerMenu.showItemMenu(e)},1)}},__OnMouseOver:function(t){this.isReadOnly()||(this._initInputEvents(),mini.addClass(this.el,this._hoverCls),this.el.title=this.text,this._textEl.scrollWidth>this._textEl.clientWidth?this.el.title=this.text:this.el.title="",this.ownerMenu&&(1==this.ownerMenu.isVertical()?this.ownerMenu.showItemMenu(this):this.ownerMenu.hasShowItemMenu()&&this.ownerMenu.showItemMenu(this)))},__OnMouseOut:function(t){mini.removeClass(this.el,this._hoverCls)},onClick:function(t,e){this.on("click",t,e)},onCheckedChanged:function(t,e){this.on("checkedchanged",t,e)},getAttrs:function(t){var e=mini.MenuItem.superclass.getAttrs.call(this,t);jQuery(t);return e.text=t.innerHTML,mini._ParseString(t,e,["text","iconCls","iconStyle","iconPosition","groupName","onclick","oncheckedchanged"]),mini._ParseBool(t,e,["checkOnClick","checked"]),e}}),mini.regClass(mini.MenuItem,"menuitem"),mini.Separator=function(){mini.Separator.superclass.constructor.apply(this,arguments)},mini.extend(mini.Separator,mini.Control,{_clearBorder:!1,uiCls:"mini-separator",_create:function(){this.el=document.createElement("span"),this.el.className="mini-separator"}}),mini.regClass(mini.Separator,"separator"),mini.Pager=function(){mini.Pager.superclass.constructor.apply(this,arguments)},mini.extend(mini.Pager,mini.Control,{pageIndex:0,pageSize:10,totalCount:0,totalPage:0,showPageIndex:!0,showPageSize:!0,showTotalCount:!0,showPageInfo:!0,showReloadButton:!0,_clearBorder:!1,showButtonText:!1,showButtonIcon:!0,sizeText:"",firstText:"",prevText:"",nextText:"",lastText:"",reloadText:"",pageInfoText:" {0} ,  {1} ",sizeList:[10,20,50,100],set:function(t){if("string"==typeof t)return this;var e=t.pageIndex;return delete t.pageIndex,mini.Pager.superclass.set.call(this,t),mini.isNull(e)||this.setPageIndex(e),this},uiCls:"mini-pager",_create:function(){this.el=document.createElement("div"),this.el.className="mini-pager";var t='<div class="mini-pager-left"><table cellspacing="0" cellpadding="0" border="0"><tr><td></td><td></td></tr></table></div><div class="mini-pager-right"></div>';(isIE6||isIE7)&&(t+='<div class="mini-clearfix"></div>',mini.addClass(this.el,"mini-clearfix")),this.el.innerHTML=t,this._leftEl=this.el.childNodes[0],this._rightEl=this.el.childNodes[1];var e=this._leftEl.getElementsByTagName("td");this._barEl=e[0],this._barEl2=e[1],this.sizeEl=mini.append(this._barEl,'<span class="mini-pager-size"></span>'),this.sizeTextEl=mini.before(this.sizeEl,'<span class="mini-pager-sizetext"></span>'),this.sizeCombo=new mini.ComboBox,this.pageSizeWidth&&this.sizeCombo.setWidth(this.pageSizeWidth),this.sizeCombo.render(this.sizeEl),mini.append(this.sizeEl,'<span class="separator"></span>'),this.firstButton=new mini.Button,this.firstButton.addCls("mini-pager-firstbutton"),this.firstButton.render(this._barEl),this.prevButton=new mini.Button,this.prevButton.addCls("mini-pager-prevbutton"),this.prevButton.render(this._barEl),this.indexEl=document.createElement("span"),this.indexEl.className="mini-pager-index",this.indexEl.innerHTML='<input type="text" class="mini-pager-num"/><span class="mini-pager-pages">/ 0</span>',this._barEl.appendChild(this.indexEl),this.numInput=this.indexEl.firstChild,this.pagesLabel=this.indexEl.lastChild,this.nextButton=new mini.Button,this.nextButton.addCls("mini-pager-nextbutton"),this.nextButton.render(this._barEl),this.lastButton=new mini.Button,this.lastButton.addCls("mini-pager-lastbutton"),this.lastButton.render(this._barEl),mini.append(this._barEl,'<span class="separator"></span>'),this.reloadButton=new mini.Button,this.reloadButton.render(this._barEl),this.firstButton.setPlain(!0),this.prevButton.setPlain(!0),this.nextButton.setPlain(!0),this.lastButton.setPlain(!0),this.reloadButton.setPlain(!0),this.buttonsEl=mini.append(this._barEl2,'<div class="mini-page-buttons"></div>'),this.update()},destroy:function(t){this.pageSelect&&(mini.clearEvent(this.pageSelect),this.pageSelect=null),this.numInput&&(mini.clearEvent(this.numInput),this.numInput=null),this.sizeEl=this.sizeTextEl=this._barEl=this._barEl2=this._leftEl=this._rightEl=this.indexEl=this.buttonsEl=null,mini.Pager.superclass.destroy.call(this,t)},setButtons:function(t){__mini_setControls(t,this.buttonsEl,this)},getButtonsEl:function(){return this.buttonsEl},_initEvents:function(){function e(){if(!i){i=!0;var t=parseInt(this.numInput.value);isNaN(t)?this.update():this._OnPageChanged(t-1),setTimeout(function(){i=!1},100)}}mini.Pager.superclass._initEvents.call(this),this.firstButton.on("click",function(t){this._OnPageChanged(0)},this),this.prevButton.on("click",function(t){this._OnPageChanged(this.pageIndex-1)},this),this.nextButton.on("click",function(t){this._OnPageChanged(this.pageIndex+1)},this),this.lastButton.on("click",function(t){this._OnPageChanged(this.totalPage)},this),this.reloadButton.on("click",function(t){this._OnPageChanged()},this);var i=!1;mini.on(this.numInput,"change",function(t){e.call(this)},this),mini.on(this.numInput,"keydown",function(t){13==t.keyCode&&(e.call(this),t.stopPropagation())},this),this.sizeCombo.on("valuechanged",this.__OnPageSelectChanged,this)},doLayout:function(){this.canLayout()&&(mini.layout(this._leftEl),mini.layout(this._rightEl))},setPageIndex:function(t){isNaN(t)||(this.pageIndex=t,this.update())},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){isNaN(t)||(this.pageSize=t,this.update())},getPageSize:function(){return this.pageSize},setTotalCount:function(t){t=parseInt(t),isNaN(t)||(this.totalCount=t,this.update())},getTotalCount:function(){return this.totalCount},setSizeList:function(t){mini.isArray(t)&&(this.sizeList=t,this.update())},getSizeList:function(){return this.sizeList},pageSizeWidth:null,setPageSizeWidth:function(t){t=parseInt(t),isNaN(t)||this.pageSizeWidth!=t&&(this.pageSizeWidth=t,this.sizeCombo.setWidth(t))},getPageSizeWidth:function(){return this.pageSizeWidth},setShowPageSize:function(t){this.showPageSize=t,this.update()},getShowPageSize:function(){return this.showPageSize},setShowPageIndex:function(t){this.showPageIndex=t,this.update()},getShowPageIndex:function(){return this.showPageIndex},setShowTotalCount:function(t){this.showTotalCount=t,this.update()},getShowTotalCount:function(){return this.showTotalCount},setShowPageInfo:function(t){this.showPageInfo=t,this.update()},getShowPageInfo:function(){return this.showPageInfo},setShowReloadButton:function(t){this.showReloadButton=t,this.update()},getShowReloadButton:function(){return this.showReloadButton},setShowButtonText:function(t){this.showButtonText=t,this.update()},getShowButtonText:function(){return this.showButtonText},setShowButtonIcon:function(t){this.showButtonIcon=t,this.update()},getShowButtonIcon:function(){return this.showButtonIcon},getTotalPage:function(){return this.totalPage},update:function(t,e,i){mini.isNumber(t)&&(this.pageIndex=parseInt(t)),mini.isNumber(e)&&(this.pageSize=parseInt(e)),mini.isNumber(i)&&(this.totalCount=parseInt(i)),this.totalPage=parseInt(this.totalCount/this.pageSize)+1,(this.totalPage-1)*this.pageSize==this.totalCount&&(this.totalPage-=1),0==this.totalCount&&(this.totalPage=0),0<=this.totalCount&&this.pageIndex>this.totalPage-1&&(this.pageIndex=this.totalPage-1),this.pageIndex<=0&&(this.pageIndex=0),this.totalPage<=0&&(this.totalPage=0),this.firstButton.enable(),this.prevButton.enable(),this.nextButton.enable(),this.lastButton.enable(),0==this.pageIndex&&(this.firstButton.disable(),this.prevButton.disable()),this.pageIndex>=this.totalPage-1&&(this.nextButton.disable(),this.lastButton.disable());var n=-1<this.pageIndex?this.pageIndex+1:0;0==this.totalCount&&(n=0),this.numInput.value=n,this.pagesLabel.innerHTML="/ "+this.totalPage;var s=this.sizeList.clone();-1==s.indexOf(this.pageSize)&&(s.push(this.pageSize),s=s.sort(function(t,e){return e<t}));for(var o=[],r=0,l=s.length;r<l;r++){var a=s[r],h={};h.text=a,h.id=a,o.push(h)}this.sizeCombo.setData(o),this.sizeCombo.setValue(this.pageSize),this.sizeTextEl.innerHTML=this.sizeText,this.sizeTextEl.style.display=this.sizeText?"":"none";var u=this.firstText,d=this.prevText,c=this.nextText,m=this.lastText,f=this.reloadText;0==this.showButtonText&&(u=d=c=m=f=""),this.firstButton.setText(u),this.prevButton.setText(d),this.nextButton.setText(c),this.lastButton.setText(m),this.reloadButton.setText(f);u=this.firstText,d=this.prevText,c=this.nextText,m=this.lastText;this.showButtonText&&(this.firstButton.setTooltip(u),this.prevButton.setTooltip(d),this.nextButton.setTooltip(c),this.lastButton.setTooltip(m),this.reloadButton.setTooltip(f)),this.firstButton.setIconCls(this.showButtonIcon?"mini-pager-first":""),this.prevButton.setIconCls(this.showButtonIcon?"mini-pager-prev":""),this.nextButton.setIconCls(this.showButtonIcon?"mini-pager-next":""),this.lastButton.setIconCls(this.showButtonIcon?"mini-pager-last":""),this.reloadButton.setIconCls(this.showButtonIcon?"mini-pager-reload":""),this.reloadButton.setVisible(this.showReloadButton);var p=this.reloadButton.el.previousSibling;p&&(p.style.display=this.showReloadButton?"":"none"),this._rightEl.innerHTML=String.format(this.pageInfoText,this.pageSize,this.totalCount),this.indexEl.style.display=this.showPageIndex?"":"none",this.sizeEl.style.display=this.showPageSize?"":"none",this._rightEl.style.display=this.showPageInfo?"":"none",this.firstButton.setVisible(0<=this.totalCount),this.lastButton.setVisible(0<=this.totalCount),this.totalCount<0&&(this.firstButton.enable(),this.nextButton.enable(),0==this.pageIndex&&this.firstButton.disable())},__OnPageSelectChanged:function(t){var e=parseInt(this.sizeCombo.getValue());this._OnPageChanged(0,e)},_OnPageChanged:function(t,e){var i={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};0<=this.totalCount&&i.pageIndex>this.totalPage-1&&(i.pageIndex=this.totalPage-1),i.pageIndex<0&&(i.pageIndex=0),this.fire("beforepagechanged",i),1!=i.cancel&&(this.fire("pagechanged",i),this.update(i.pageIndex,i.pageSize))},onPageChanged:function(t,e){this.on("pagechanged",t,e)},getAttrs:function(t){var e=mini.Pager.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onpagechanged","sizeList","onbeforepagechanged","buttons","sizeText"]),mini._ParseBool(t,e,["showPageIndex","showPageSize","showTotalCount","showPageInfo","showReloadButton","showButtonText","showButtonIcon"]),mini._ParseInt(t,e,["pageIndex","pageSize","totalCount","pageSizeWidth"]),"string"==typeof e.sizeList&&(e.sizeList=window.eval(e.sizeList)),e.buttons&&(e.buttons=mini.byId(e.buttons)),e}}),mini.regClass(mini.Pager,"pager"),mini.DataBinding=function(){this._bindFields=[],this._bindForms=[],mini.DataBinding.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataBinding,mini.Component,{bindField:function(t,e,i,n,s){if(t=mini.get(t),e=mini.get(e),t&&e&&i){var o={control:t,source:e,field:i,convert:s,mode:n};this._bindFields.push(o),e.on("currentchanged",this.__OnCurrentChanged,this),t.on("valuechanged",this.__OnValueChanged,this)}},bindForm:function(t,e,i,n){if(t=mini.byId(t),e=mini.get(e),t&&e)for(var s=(t=new mini.Form(t)).getFields(),o=0,r=s.length;o<r;o++){var l=s[o];this.bindField(l,e,l.getName(),i,n)}},__OnCurrentChanged:function(t){if(!this._doSetting){this._doSetting=!0,this._currentRecord=t.record;for(var e=t.sender,i=t.record,n=0,s=this._bindFields.length;n<s;n++){var o=this._bindFields[n];if(o.source==e){var r=o.control,l=o.field;if(r.setValue)if(i){var a=mini._getMap(l,i);r.setValue(a)}else r.setValue("");r.setText&&r.textName&&(i?r.setText(i[r.textName]):r.setText(""))}}var h=this;setTimeout(function(){h._doSetting=!1},10)}},__OnValueChanged:function(t){if(!this._doSetting){this._doSetting=!0;for(var e=t.sender,i=e.getValue(),n=0,s=this._bindFields.length;n<s;n++){var o=this._bindFields[n];if(o.control==e&&!1!==o.mode){var r=o.source,l=this._currentRecord;if(l){var a={};a[o.field]=i,e.getText&&e.textName&&(a[e.textName]=e.getText()),r.updateRow(l,a)}}}var h=this;setTimeout(function(){h._doSetting=!1},10)}}}),mini.regClass(mini.DataBinding,"databinding"),mini.DataSet=function(){this._sources={},this._data={},this._links=[],this._originals={},mini.DataSet.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataSet,mini.Component,{add:function(t,e){t&&e&&(this._sources[t]=e,this._data[t]=[],e._set_autoCreateNewID(!0),e._set_originalIdField(e.getIdField()),e._set_clearOriginals(!1),e.on("addrow",this.__OnRowChanged,this),e.on("updaterow",this.__OnRowChanged,this),e.on("deleterow",this.__OnRowChanged,this),e.on("removerow",this.__OnRowChanged,this),e.on("preload",this.__OnDataPreLoad,this),e.on("selectionchanged",this.__OnDataSelectionChanged,this))},addLink:function(t,e,i){if(t&&e&&i&&this._sources[t]&&this._sources[e]){var n={parentName:t,childName:e,parentField:i};this._links.push(n)}},clearData:function(){for(var t in this._data={},this._originals={},this._sources)this._data=[]},getData:function(){return this._data},_getNameByListControl:function(t){for(var e in this._sources){if(this._sources[e]==t)return e}},_getRecord:function(t,e,i){var n=this._data[t];if(!n)return!1;for(var s=0,o=n.length;s<o;s++){var r=n[s];if(r[i]==e[i])return r}return null},__OnRowChanged:function(t){var e=t.type,i=t.record,n=this._getNameByListControl(t.sender),s=this._getRecord(n,i,t.sender.getIdField()),o=this._data[n];s&&(o=this._data[n]).remove(s);if("removerow"==e&&"added"==i._state||"beforeremove"==e&&"added"==i._state||o.push(i),this._originals[n]=t.sender._get_originals(),"added"==i._state){var r=this._getParentSource(t.sender);if(r){var l=r.getSelected();l?i._parentId=l[r.getIdField()]:o.remove(i)}}},__OnDataPreLoad:function(t){for(var e=t.sender,i=this._getNameByListControl(e),n=t.sender.getIdField(),s=this._data[i],o={},r=0,l=s.length;r<l;r++){o[(f=s[r])[n]]=f}var a=this._originals[i];a&&e._set_originals(a);var h=t.data||[];for(r=0,l=h.length;r<l;r++){(p=o[(f=h[r])[n]])&&(delete p._uid,mini.copyTo(f,p))}var u=this._getParentSource(e);if(e.getPageIndex&&0==e.getPageIndex()){var d=[];for(r=0,l=s.length;r<l;r++){if("added"==(f=s[r])._state)if(u){var c=u.getSelected();c&&c[u.getIdField()]==f._parentId&&d.push(f)}else d.push(f)}d.reverse(),h.insertRange(0,d)}var m=[];for(r=h.length-1;0<=r;r--){var f,p;(p=o[(f=h[r])[n]])&&"removed"==p._state&&(h.removeAt(r),m.push(p))}},_getParentSource:function(t){for(var e=this._getNameByListControl(t),i=0,n=this._links.length;i<n;i++){var s=this._links[i];if(s.childName==e)return this._sources[s.parentName]}},_getLinks:function(t){for(var e=this._getNameByListControl(t),i=[],n=0,s=this._links.length;n<s;n++){var o=this._links[n];o.parentName==e&&i.push(o)}return i},__OnDataSelectionChanged:function(t){for(var e=t.sender,i=e.getSelected(),n=this._getLinks(e),s=0,o=n.length;s<o;s++){var r=n[s],l=this._sources[r.childName];if(i){var a={};a[r.parentField]=i[e.getIdField()],l.load(a)}else l.loadData([])}}}),mini.regClass(mini.DataSet,"dataset"),"undefined"==typeof mini_doload&&(mini_doload=function(t){}),mini.DataSource=function(){mini.DataSource.superclass.constructor.apply(this,arguments),this._init()},mini.extend(mini.DataSource,mini.Component,{idField:"id",textField:"text",loaded:!1,destroy:function(){this.source=[],this.dataview=[],this.visibleRows=null,this.list=null,this._ids={},this._removeds=[],this._clearOriginals&&(this._originals={}),this._errors={},this._selected=null,this._selecteds=[],this._idSelecteds={},this._filterInfo=null,this._sortInfo=null,this.root={_id:-1,_level:-1},this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null,mini.DataSource.superclass.destroy.call(this)},_originalIdField:"_id",_clearOriginals:!0,_autoCreateNewID:!1,_init:function(){this.source=[],this.dataview=[],this.visibleRows=null,this.list=null,this._ids={},this._removeds=[],this._clearOriginals&&(this._originals={}),this._errors={},this._selected=null,this._selecteds=[],this._idSelecteds={},this.__changeCount=0},getSource:function(){return this.source},getList:function(){return this.source.clone()},getDataView:function(){return this.dataview.clone()},getVisibleRows:function(){return this.visibleRows||(this.visibleRows=this.getDataView().clone()),this.visibleRows},setData:function(t){this.loadData(t)},loadData:function(t){return mini.isArray(t)||(t=[]),this._init(),this._doLoadData(t),this._dataChanged("loaddata"),this.fire("loaddata"),!0},_doLoadData:function(t){this.source=t,this.dataview=t;for(var e=this.source,i=this._ids,n=0,s=e.length;n<s;n++){var o=e[n];o._id=mini.DataSource.RecordId++,(i[o._id]=o)._uid=o._id}},clearData:function(){this._init(),this._dataChanged(),this.fire("cleardata")},clear:function(){this.clearData()},updateRecord:function(t,e,i){if(!mini.isNull(t)){var n=mini._getMap,s=mini._setMap;if(this.fire("beforeupdate",{record:t}),"string"==typeof e){var o=n(e,t);if(mini.isEquals(o,i))return!1;this.beginChange(),s(e,i,t),this._setModified(t,e,o),this.endChange()}else{for(var r in this.beginChange(),e){o=n(r,t),i=e[r];mini.isEquals(o,i)||(s(r,i,t),this._setModified(t,r,o))}this.endChange("update")}this.fire("update",{record:t})}},deleteRecord:function(t){this._setDeleted(t),this._dataChanged(),this.fire("delete",{record:t})},getby_id:function(t){return t="object"==typeof t?t._id:t,this._ids[t]},getbyId:function(t){if("number"==typeof t)return this.getAt(t);if("object"==typeof t){if(this.getby_id(t))return t;t=t[this.idField]}t=String(t);var e=this.ids;if(!e){e=this.ids={};for(var i=this.getList(),n=0,s=i.length;n<s;n++){var o=i[n],r=o[this.idField];mini.isNull(r)||(e[r]=o)}}return e[t]},getsByIds:function(t){mini.isNull(t)&&(t=""),t=String(t);for(var e=[],i=String(t).split(","),n=0,s=i.length;n<s;n++){var o=this.getbyId(i[n]);o&&e.push(o)}return e},getRecord:function(t){return"object"==typeof t?t:this.getRow(t)},getRow:function(t){var e=typeof t;return"string"==e?this.getbyId(t):"number"==e?this.getAt(t):"object"==e?t:void 0},delimiter:",",getValueAndText:function(t,e){mini.isNull(t)&&(t=[]),e=e||this.delimiter,"string"==typeof t||"number"==typeof t?t=this.getsByIds(t):mini.isArray(t)||(t=[t]);for(var i=[],n=[],s=0,o=t.length;s<o;s++){var r=t[s];r&&(i.push(this.getItemValue(r)),n.push(this.getItemText(r)))}return[i.join(e),n.join(e)]},getItemValue:function(t){if(!t)return"";var e=mini._getMap(this.idField,t);return mini.isNull(e)?"":String(e)},getItemText:function(t){if(!t)return"";var e=mini._getMap(this.textField,t);return mini.isNull(e)?"":String(e)},isModified:function(t,e){var i=this._originals[t[this._originalIdField]];return!!i&&(!mini.isNull(e)&&i.hasOwnProperty(e))},hasRecord:function(t){return!!this.getby_id(t)},findRecords:function(t,e){for(var i="function"==typeof t,n=t,s=e||this,o=this.source,r=[],l=0,a=o.length;l<a;l++){var h=o[l];if(i){var u=n.call(s,h);if(1==u&&(r[r.length]=h),1===u)break}else h[t]==e&&(r[r.length]=h)}return r},findRecord:function(t,e){return this.findRecords(t,e)[0]},each:function(t,e){var i=this.getDataView().clone();e=e||this,mini.forEach(i,t,e)},getCount:function(){return this.getDataView().length},setIdField:function(t){this.idField=t},setTextField:function(t){this.textField=t},__changeCount:0,beginChange:function(){this.__changeCount++},endChange:function(t,e){this.__changeCount--,this.__changeCount<0&&(this.__changeCount=0),(!1!==e&&0==this.__changeCount||1==e)&&(this.__changeCount=0,this._dataChanged(t))},_dataChanged:function(t){this.ids=null,this.visibleRows=null,this.list=null,0==this.__changeCount&&this.fire("datachanged")},_setAdded:function(t){t._id=mini.DataSource.RecordId++,this._autoCreateNewID&&!t[this.idField]&&(t[this.idField]=UUID()),t._uid=t._id,t._state="added",this._ids[t._id]=t,delete this._originals[t[this._originalIdField]]},_setModified:function(t,e,i){if("added"!=t._state&&"deleted"!=t._state&&"removed"!=t._state){t._state="modified";var n=this._getOriginal(t);n.hasOwnProperty(e)||(n[e]=i)}},_setDeleted:function(t){"added"!=t._state&&"deleted"!=t._state&&"removed"!=t._state&&(t._state="deleted")},_setRemoved:function(t){delete this._ids[t._id],"added"!=t._state&&"removed"!=t._state&&(t._state="removed",delete this._originals[t[this._originalIdField]],this._removeds.push(t))},_getOriginal:function(t){var e=t[this._originalIdField],i=this._originals[e];return i=i||(this._originals[e]={})},_selected:null,_selecteds:[],_idSelecteds:null,multiSelect:!1,isSelected:function(t){return!!t&&("string"!=typeof t&&(t=t._id),!!this._idSelecteds[t])},setSelected:function(t){t=this.getby_id(t),this.getSelected()!=t&&((this._selected=t)?this.select(t):this.deselect(this.getSelected()),this._OnCurrentChanged(t))},getSelected:function(){return this.isSelected(this._selected)?this._selected:this._selecteds[0]},setCurrent:function(t){this.setSelected(t)},getCurrent:function(){return this.getSelected()},getSelecteds:function(){return this._selecteds.clone()},select:function(t,e){mini.isNull(t)||this.selects([t],e)},deselect:function(t,e){mini.isNull(t)||this.deselects([t],e)},selectAll:function(t){this.selects(this.getList(),t)},deselectAll:function(t){this.deselects(this.getSelecteds(),t)},_fireSelect:function(t,e){var i={record:t,cancel:!1};return this.fire(e,i),!i.cancel},selects:function(t,e){if(mini.isArray(t)){t=t.clone(),0==this.multiSelect&&(this.deselects(this.getSelecteds()),0<t.length&&(t.length=1),this._selecteds=[],this._idSelecteds={});for(var i=[],n=0,s=t.length;n<s;n++){var o=this.getbyId(t[n]);if(o&&!this.isSelected(o)){if(!1!==e&&!this._fireSelect(o,"beforeselect"))continue;this._selecteds.push(o),this._idSelecteds[o._id]=o,i.push(o),!1!==e&&this.fire("select",{record:o})}}this._OnSelectionChanged(t,!0,i,e)}},deselects:function(t,e){if(mini.isArray(t)){for(var i=[],n=(t=t.clone()).length-1;0<=n;n--){if((r=this.getbyId(t[n]))&&this.isSelected(r)){if(!1!==e&&!this._fireSelect(r,"beforedeselect"))continue;delete this._idSelecteds[r._id],i.push(r)}}this._selecteds=[];var s=this._idSelecteds;for(var n in s){var o=s[n];o._id&&this._selecteds.push(o)}for(n=t.length-1;0<=n;n--){var r;(r=this.getbyId(t[n]))&&!1!==e&&this.fire("deselect",{record:r})}this._OnSelectionChanged(t,!1,i,e)}},_OnSelectionChanged:function(t,e,i,n){var s={fireEvent:n,records:t,select:e,selected:this.getSelected(),selecteds:this.getSelecteds(),_records:i};this.fire("SelectionChanged",s);var o=this._current,r=this.getCurrent();o!=r&&(this._current=r,this._OnCurrentChanged(r))},_OnCurrentChanged:function(e){this._currentTimer&&clearTimeout(this._currentTimer);var i=this;this._currentTimer=setTimeout(function(){i._currentTimer=null;var t={record:e};i.fire("CurrentChanged",t)},30)},_checkSelecteds:function(){for(var t=this._selecteds.length-1;0<=t;t--){var e=this._selecteds[t];this.getby_id(e._id)||(this._selecteds.removeAt(t),delete this._idSelecteds[e._id])}this._selected&&null==this.getby_id(this._selected._id)&&(this._selected=null)},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t)},getMultiSelect:function(){return this.multiSelect},selectPrev:function(){var t=this.getSelected();if(t){var e=this.indexOf(t);t=this.getAt(e-1)}else t=this.getAt(0);t&&(this.deselectAll(),this.select(t),this.setCurrent(t))},selectNext:function(){var t=this.getSelected();if(t){var e=this.indexOf(t);t=this.getAt(e+1)}else t=this.getAt(0);t&&(this.deselectAll(),this.select(t),this.setCurrent(t))},selectFirst:function(){var t=this.getAt(0);t&&(this.deselectAll(),this.select(t),this.setCurrent(t))},selectLast:function(){var t=this.getVisibleRows(),e=this.getAt(t.length-1);e&&(this.deselectAll(),this.select(e),this.setCurrent(e))},getSelectedsId:function(t){var e=this.getSelecteds();return this.getValueAndText(e,t)[0]},getSelectedsText:function(t){var e=this.getSelecteds();return this.getValueAndText(e,t)[1]},_filterInfo:null,_sortInfo:null,filter:function(t,e){"function"==typeof t&&(e=e||this,this._filterInfo=[t,e],this._doFilter(),this._doSort(),this._dataChanged(),this.fire("filter"))},clearFilter:function(){this._filterInfo&&(this._filterInfo=null,this._doFilter(),this._doSort(),this._dataChanged(),this.fire("filter"))},sort:function(t,e,i){"function"==typeof t&&(e=e||this,this._sortInfo=[t,e,i],this._doSort(),this._dataChanged(),this.fire("sort"))},clearSort:function(){if(this._sortInfo=null,this.sortField=this.sortOrder="",this._doFilter(),this._dataChanged(),"server"==this.sortMode){var t=this.getLoadParams();t.sortField="",t.sortOrder="",this.load(t)}this.fire("filter")},_sortMulti:function(t){},_doClientSortField:function(t,e,i){var n=this._getSortFnByField(t,i);if(n){var s="desc"==e;this.sort(n,this,s)}},_getSortFnByField:function(l,a){if(!l)return null;var h=mini.sortTypes[a];return h=h||mini.sortTypes.string,function(t,e){var i=mini._getMap(l,t),n=mini._getMap(l,e),s=mini.isNull(i)||""===i,o=mini.isNull(n)||""===n;if(s)return 0;if(o)return 1;if("chinese"==a)return i.localeCompare(n,"zh");var r=h(i);return h(n)<r?1:0}},ajaxOptions:null,autoLoad:!1,url:"",pageSize:10,pageIndex:0,totalCount:0,totalPage:0,sortField:"",sortOrder:"",loadParams:null,getLoadParams:function(){return this.loadParams||{}},sortMode:"server",pageIndexField:"pageIndex",pageSizeField:"pageSize",sortFieldField:"sortField",sortOrderField:"sortOrder",totalField:"total",dataField:"data",startField:"",limitField:"",errorField:"error",errorMsgField:"errorMsg",stackTraceField:"stackTrace",load:function(t,e,i,n){if("string"!=typeof t)if(this._loadTimer&&clearTimeout(this._loadTimer),this.loadParams=t||{},mini.isNumber(this.loadParams.pageIndex)||(this.loadParams.pageIndex=0),this._xhr&&this._xhr.abort(),this.ajaxAsync&&mini_ajaxAsyncInvoke){var s=this;this._loadTimer=setTimeout(function(){s._doLoadAjax(s.loadParams,e,i,n),s._loadTimer=null},1)}else this._doLoadAjax(this.loadParams,e,i,n);else this.setUrl(t)},reload:function(t,e,i){this.load(this.loadParams,t,e,i)},gotoPage:function(t,e){var i=this.loadParams||{};mini.isNumber(t)&&(i.pageIndex=t),mini.isNumber(e)&&(i.pageSize=e),this.load(i)},sortBy:function(t,e){if(this.sortField=t,this.sortOrder="asc"==e?"asc":"desc","server"==this.sortMode){var i=this.getLoadParams();i.sortField=t,i.sortOrder=e,i.pageIndex=this.pageIndex,this.load(i)}},setSortField:function(t){this.sortField=t,"server"==this.sortMode&&(this.getLoadParams().sortField=t)},setSortOrder:function(t){this.sortOrder=t,"server"==this.sortMode&&(this.getLoadParams().sortOrder=t)},checkSelectOnLoad:!0,selectOnLoad:!1,ajaxData:null,ajaxAsync:!0,ajaxType:"",_doLoadAjax:function(p,g,_,n,v){p=p||{},mini.isNull(p.pageIndex)&&(p.pageIndex=this.pageIndex),mini.isNull(p.pageSize)&&(p.pageSize=this.pageSize),p.sortField&&(this.sortField=p.sortField),p.sortOrder&&(this.sortOrder=p.sortOrder),p.sortField=this.sortField,p.sortOrder=this.sortOrder,this.loadParams=p;var w=this._evalUrl(),t=this._evalType(w),e=mini._evalAjaxData(this.ajaxData,this);jQuery.extend(!0,p,e);var y={url:w,async:this.ajaxAsync,type:t,data:p,params:p,cache:!1,cancel:!1};if(jQuery.extend(!0,y,this.ajaxOptions),this._OnBeforeLoad(y),1==y.cancel)return p.pageIndex=this.getPageIndex(),void(p.pageSize=this.getPageSize());y.data!=y.params&&y.params!=p&&(y.data=y.params),y.url!=w&&y.type==t&&(y.type=this._evalType(y.url));var i={};i[this.pageIndexField]=p.pageIndex,i[this.pageSizeField]=p.pageSize,p.sortField&&(i[this.sortFieldField]=p.sortField),p.sortOrder&&(i[this.sortOrderField]=p.sortOrder),this.startField&&this.limitField&&(i[this.startField]=p.pageIndex*p.pageSize,i[this.limitField]=p.pageSize),jQuery.extend(!0,p,i),jQuery.extend(!0,y.data,i),"client"==this.sortMode&&(p[this.sortFieldField]="",p[this.sortOrderField]="");var s=this.getSelected();this._currentSelectValue=s?s[this.idField]:null,mini.isNumber(this._currentSelectValue)&&(this._currentSelectValue=String(this._currentSelectValue));for(var o=this.getSelecteds(),r=[],l=0,a=o.length;l<a;l++){var h=o[l][this.idField];mini.isNull(h)||(h=String(h)),r.push(h)}this._selectedValue=0==r.length?null:r,mini.isNumber(this._selectedValue)&&(this._selectedValue=String(this._selectedValue));var C=this;C._resultObject=null;var x=y.async;mini.copyTo(y,{success:function(t,e,i){t&&"null"!=t||(t="{ total: 0, data: [] }"),delete y.params;var n={text:t,result:null,sender:C,options:y,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(r){1==mini_debugger&&alert(w+"\n json is error.")}if(s&&!mini.isArray(s))s.total=parseInt(mini._getMap(C.totalField,s)),s.data=mini._getMap(C.dataField,s);else if(null==s)s={data:[],total:0};else if(mini.isArray(s)){var o={};o.data=s,o.total=s.length,s=o}s.data||(s.data=[]),s.total||(s.total=0),C._resultObject=s,mini.isArray(s.data)||(s.data=[s.data]);var r={xhr:i,text:t,textStatus:e,result:s,total:s.total,data:s.data.clone(),pageIndex:p[C.pageIndexField],pageSize:p[C.pageSizeField]},l=mini._getMap(C.errorField,s),a=mini._getMap(C.errorMsgField,s),h=mini._getMap(C.stackTraceField,s);if(mini.isNumber(l)&&0!=l||!1===l)r.textStatus="servererror",r.errorCode=l,r.stackTrace=h||"",r.errorMsg=a||"",1==mini_debugger&&alert(w+"\n"+r.textStatus+"\n"+r.errorMsg+"\n"+r.stackTrace),C.fire("loaderror",r),_&&_.call(C,r);else{if(0<r.pageIndex&&0==r.data.length)return void C.gotoPage(r.pageIndex-1);if(v)v(r);else{C.pageIndex=r.pageIndex,C.pageSize=r.pageSize,C.setTotalCount(r.total),C._OnPreLoad(r),C.loaded=!0;new Date;if(C.setData(r.data),C._selectedValue&&C.checkSelectOnLoad){var u=[],d=C._selectedValue;if(0<d.length){for(var c=0,m=d.length;c<m;c++){var f=C.getbyId(d[c]);f&&u.push(f)}u.length&&C.selects(u),C._selected=C.getbyId(C._currentSelectValue)}}null==C.getSelected()&&C.selectOnLoad&&0<C.getDataView().length&&C.select(0),C.fire("load",r),g&&(x?setTimeout(function(){g.call(C,r)},20):g.call(C,r))}}},error:function(t,e,i){if("abort"!=e){var n={xhr:t,text:t.responseText,textStatus:e};n.errorMsg=t.responseText,n.errorCode=t.status,1==mini_debugger&&alert(w+"\n"+n.errorCode+"\n"+n.errorMsg),C.fire("loaderror",n),_&&_.call(C,n)}},complete:function(t,e){var i={xhr:t,text:t.responseText,textStatus:e};C.fire("loadcomplete",i),n&&n.call(C,i),C._xhr=null}}),this._xhr,this._xhr=mini.ajax(y)},_OnBeforeLoad:function(t){this.fire("beforeload",t)},_OnPreLoad:function(t){this.fire("preload",t)},_evalUrl:function(){var e=this.url;if("function"==typeof e)e=e();else{try{e=window.eval(e)}catch(t){e=this.url}e=e||this.url}return e},_evalType:function(t){var e=this.ajaxType;return e||(e="post",t&&-1==t.indexOf(".txt")&&-1==t.indexOf(".json")||(e="get")),e},setSortMode:function(t){this.sortMode=t},getSortMode:function(){return this.sortMode},setAjaxOptions:function(t){this.ajaxOptions=t},getAjaxOptions:function(){return this.ajaxOptions},setAutoLoad:function(t){this.autoLoad=t},getAutoLoad:function(){return this.autoLoad},setUrl:function(t){this.url=t,this.autoLoad&&this.load()},getUrl:function(){return this.url},setPageIndex:function(t){this.pageIndex=t;var e=this.loadParams||{};mini.isNumber(t)&&(e.pageIndex=t),this.fire("pageinfochanged")},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){this.pageSize=t;var e=this.loadParams||{};mini.isNumber(t)&&(e.pageSize=t),this.fire("pageinfochanged")},getPageSize:function(){return this.pageSize},setTotalCount:function(t){this.totalCount=parseInt(t),this.fire("pageinfochanged")},getTotalCount:function(){return this.totalCount},getTotalPage:function(){return this.totalPage},setCheckSelectOnLoad:function(t){this.checkSelectOnLoad=t},getCheckSelectOnLoad:function(){return this.checkSelectOnLoad},setSelectOnLoad:function(t){this.selectOnLoad=t},getSelectOnLoad:function(){return this.selectOnLoad}}),mini.DataSource.RecordId=1,mini.DataTable=function(){mini.DataTable.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataTable,mini.DataSource,{_init:function(){mini.DataTable.superclass._init.call(this),this._filterInfo=null,this._sortInfo=null},add:function(t){return this.insert(this.source.length,t)},addRange:function(t){this.insertRange(this.source.length,t)},insert:function(t,e){if(!e)return null;if(!mini.isNumber(t)){var i=this.getRecord(t);t=i?this.indexOf(i):this.dataview.length}var n={index:t,record:e};this.fire("beforeadd",n);var s=this.dataview[t];if(s?this.dataview.insert(t,e):this.dataview.add(e),this.dataview!=this.source)if(s){var o=this.source.indexOf(s);this.source.insert(o,e)}else this.source.add(e);this._setAdded(e),this._dataChanged(),this.fire("add",n)},insertRange:function(t,e){if(mini.isArray(e)){mini.isNumber(t)||(t=this.dataview.length),this.beginChange();for(var i=0,n=(e=e.clone()).length;i<n;i++){var s=e[i];this.insert(t+i,s)}this.endChange()}},remove:function(t,e){var i=this.indexOf(t);return this.removeAt(i,e)},removeAt:function(t,e){var i=this.getAt(t);if(!i)return null;var n={record:i};this.fire("beforeremove",n);var s=this.isSelected(i);if(this.source.remove(i),this.dataview!==this.source&&this.dataview.removeAt(t),this._setRemoved(i),this._checkSelecteds(),this._dataChanged(),this.fire("remove",n),s&&e){var o=this.getAt(t);o=o||this.getAt(t-1),this.deselectAll(),this.select(o)}},removeRange:function(t,e){if(mini.isArray(t)){this.beginChange();for(var i=0,n=(t=t.clone()).length;i<n;i++){var s=t[i];this.remove(s,e)}this._dataChanged(),this.endChange()}},move:function(t,e){if(t&&mini.isNumber(e)&&!(e<0))if(mini.isArray(t)){this.beginChange();var i=t,n=this.getAt(e),s=this;mini.sort(i,function(t,e){return s.indexOf(t)>s.indexOf(e)},this);for(var o=0,r=i.length;o<r;o++){var l=i[o],a=this.indexOf(n);this.move(l,a)}this.endChange()}else{var h={index:e,record:t};this.fire("beforemove",h);var u,d=this.dataview[e];if(this.dataview.remove(t),-1!=(u=this.dataview.indexOf(d))&&(e=u),d?this.dataview.insert(e,t):this.dataview.add(t),this.dataview!=this.source)this.source.remove(t),-1!=(u=this.source.indexOf(d))&&(e=u),d?this.source.insert(e,t):this.source.add(t);this._dataChanged(),this.fire("move",h)}},indexOf:function(t){return this.getVisibleRows().indexOf(t)},getAt:function(t){return this.getVisibleRows()[t]},getRange:function(t,e){if(e<t){var i=t;t=e,e=i}for(var n=[],s=t,o=e;s<=o;s++){var r=this.dataview[s];n.push(r)}return n},selectRange:function(t,e){if(mini.isNumber(t)||(t=this.indexOf(t)),mini.isNumber(e)||(e=this.indexOf(e)),!mini.isNull(t)&&!mini.isNull(e)){var i=this.getRange(t,e);this.selects(i)}},toArray:function(){return this.source.clone()},isChanged:function(){return 0<this.getChanges().length},getChanges:function(t,e){var i=[];"removed"!=t&&null!=t||i.addRange(this._removeds.clone());for(var n=0,s=this.source.length;n<s;n++){var o=this.source[n];o._state&&(o._state!=t&&null!=t||(i[i.length]=o))}var r=i;if(e)for(n=0,s=r.length;n<s;n++){var l=r[n];if("modified"==l._state){var a={};for(var h in a._state=l._state,a[this.idField]=l[this.idField],l){this.isModified(l,h)&&(a[h]=l[h])}r[n]=a}}var u=this;return mini.sort(i,function(t,e){var i=u.indexOf(t),n=u.indexOf(e);return n<i?1:i<n?-1:0}),i},accept:function(){this.beginChange();for(var t=0,e=this.source.length;t<e;t++){var i=this.source[t];this.acceptRecord(i)}this._removeds=[],this._originals={},this.endChange()},reject:function(){this.beginChange();for(var t=this.source.clone(),e=0,i=t.length;e<i;e++){var n=t[e];this.rejectRecord(n)}this._removeds=[],this._originals={},this.endChange()},acceptRecord:function(t){t._state&&(delete this._originals[t[this._originalIdField]],"deleted"==t._state?this.remove(t):(delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged()),this.fire("update",{record:t}))},rejectRecord:function(t){if(t._state)if("added"==t._state)this.remove(t);else if("modified"==t._state||"deleted"==t._state){var e=this._getOriginal(t);for(var i in e){var n=e[i];mini._setMap(i,n,t)}delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})}},_doFilter:function(){if(this._filterInfo){for(var t=this._filterInfo[0],e=this._filterInfo[1],i=[],n=this.source,s=0,o=n.length;s<o;s++){var r=n[s];!1!==t.call(e,r,s,this)&&i.push(r)}this.dataview=i}else this.dataview=this.source},_doSort:function(){if(this._sortInfo){var t=this._sortInfo[0],e=this._sortInfo[1],i=this._sortInfo[2],n=this.getDataView().clone();mini.sort(n,t,e),i&&n.reverse(),this.dataview=n}}}),mini.regClass(mini.DataTable,"datatable"),mini.DataTree=function(){mini.DataTree.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataTree,mini.DataSource,{isTree:!0,expandOnLoad:!1,idField:"id",parentField:"pid",nodesField:"children",checkedField:"checked",resultAsTree:!0,dataField:"",checkModel:"cascade",autoCheckParent:!1,onlyLeafCheckable:!1,setExpandOnLoad:function(t){this.expandOnLoad=t},getExpandOnLoad:function(){return this.expandOnLoad},setParentField:function(t){this.parentField=t},setNodesField:function(t){if(this.nodesField!=t){var e=this.root[this.nodesField];this.nodesField=t,this._doLoadData(e)}},setResultAsTree:function(t){this.resultAsTree=t},setCheckRecursive:function(t){this.checkModel=t?"cascade":"multiple"},getCheckRecursive:function(){return"cascade"==this.checkModel},setShowFolderCheckBox:function(t){this.onlyLeafCheckable=!t},getShowFolderCheckBox:function(){return!this.onlyLeafCheckable},_doExpandOnLoad:function(t){var l=this.nodesField,a=this.expandOnLoad;!function t(e,i){for(var n=0,s=e.length;n<s;n++){var o=e[n];mini.isNull(o.expanded)&&(!0===a||mini.isNumber(a)&&i<=a?o.expanded=!0:o.expanded=!1);var r=o[l];r&&t(r,i+1)}}(t,0)},_OnBeforeLoad:function(t){var e=this._loadingNode||this.root;t.node=e,this._isNodeLoading()&&(t.async=!0,t.isRoot=t.node==this.root,t.isRoot||(t.data[this.idField]=this.getItemValue(t.node))),this.fire("beforeload",t)},_OnPreLoad:function(t){0==this.resultAsTree&&(t.data=mini.arrayToTree(t.data,this.nodesField,this.idField,this.parentField)),this.fire("preload",t)},_init:function(){mini.DataTree.superclass._init.call(this),this.root={_id:-1,_level:-1},this.source=this.root[this.nodesField]=[],this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null,this._ids[this.root._id]=this.root},_doLoadData:function(t){t=t||[],this._doExpandOnLoad(t),this.source=this.root[this.nodesField]=t,this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null;new Date;var e=mini.treeToArray(t,this.nodesField);(h=this._ids)[this.root._id]=this.root;for(var i=mini.DataSource.RecordId,n=0,s=e.length;n<s;n++){(r=e[n])._id=i++,(h[r._id]=r)._uid=r._id}mini.DataSource.RecordId=i;var o=this.checkedField;e=mini.treeToArray(t,this.nodesField,"_id","_pid",this.root._id);this.list=e;var r,l,a,h=this._ids;for(n=0,s=e.length;n<s;n++)l=h[(r=e[n])._pid],r._level=l._level+1,r._state&&delete r._state,(a=r[o])&&(r.checked=a,r.checked&&(r.checked="false"!=r.checked));this._doUpdateLoadedCheckedNodes()},_setAdded:function(t){var e=this.getParentNode(t);t._id=mini.DataSource.RecordId++,this._autoCreateNewID&&!t[this.idField]&&(t[this.idField]=UUID()),t._uid=t._id,t._pid=e._id,e[this.idField]&&(t[this.parentField]=e[this.idField]),t._level=e._level+1,t._state="added",this._ids[t._id]=t,delete this._originals[t[this._originalIdField]]},_createNodes:function(t){var e=t[this.nodesField];return e=e||(t[this.nodesField]=[]),this.viewNodes&&!this.viewNodes[t._id]&&(this.viewNodes[t._id]=[]),e},addNode:function(t,e){if(t)return this.insertNode(t,-1,e)},addNodes:function(t,e,i){if(mini.isArray(t)){mini.isNull(i)&&(i="add");for(var n=0,s=t.length;n<s;n++){var o=t[n];this.insertNode(o,i,e)}}},insertNodes:function(t,e,i){if(mini.isNumber(e)&&mini.isArray(t)){i=i||this.root,this.beginChange();var n=this._createNodes(i);(e<0||e>n.length)&&(e=n.length);for(var s=0,o=(t=t.clone()).length;s<o;s++)this.insertNode(t[s],e+s,i);return this.endChange(),t}},removeNode:function(t){var e=this.getParentNode(t);if(e){var i=this.indexOfNode(t);return this.removeNodeAt(i,e)}},removeNodes:function(t){if(mini.isArray(t)){this.beginChange();for(var e=0,i=(t=t.clone()).length;e<i;e++)this.removeNode(t[e]);this.endChange()}},moveNodes:function(t,e,i){if(t&&0!=t.length&&e&&i){this.beginChange();var n=this;mini.sort(t,function(t,e){return n.indexOf(t)>n.indexOf(e)},this);for(var s=0,o=t.length;s<o;s++){var r=t[s];this.moveNode(r,e,i),0!=s&&(e=r,i="after")}this.endChange()}},moveNode:function(t,e,i){if(t&&e&&!mini.isNull(i)){if(this.viewNodes){var n=e;if("before"==(l=i))n=this.getParentNode(e),l=this.indexOfNode(e);else if("after"==l)n=this.getParentNode(e),l=this.indexOfNode(e)+1;else if("add"==l||"append"==l)n[this.nodesField]||(n[this.nodesField]=[]),l=n[this.nodesField].length;else if(!mini.isNumber(l))return;if(this.isAncestor(t,n))return!1;s=(s=this.viewNodes[n._id])||(this.viewNodes[n._id]=[]);var s=this.getChildNodes(n);(l<0||l>s.length)&&(l=s.length);var o={};s.insert(l,o);var r=this.getParentNode(t);this.getChildNodes(r).remove(t),l=s.indexOf(o),s[l]=t}n=e;var l=i;s=this._createNodes(n);if("before"==l)n=this.getParentNode(e),l=(s=this._createNodes(n)).indexOf(e);else if("after"==l)n=this.getParentNode(e),l=(s=this._createNodes(n)).indexOf(e)+1;else if("add"==l||"append"==l)l=s.length;else if(!mini.isNumber(l))return;if(this.isAncestor(t,n))return!1;(l<0||l>s.length)&&(l=s.length);o={};s.insert(l,o),(r=this.getParentNode(t))[this.nodesField].remove(t),l=s.indexOf(o),s[l]=t,this._updateParentAndLevel(t,n),this._dataChanged();var a={oldParentNode:r,parentNode:n,index:l,node:t};this.fire("movenode",a)}},insertNode:function(t,e,i){if(t){if(i||(i=this.root,e="add"),!mini.isNumber(e)){switch(e){case"before":e=this.indexOfNode(i),i=this.getParentNode(i),t=this.insertNode(t,e,i);break;case"after":e=this.indexOfNode(i),i=this.getParentNode(i),t=this.insertNode(t,e+1,i);break;case"append":case"add":t=this.addNode(t,i)}return t}var n=this._createNodes(i),s=this.getChildNodes(i);if((e<0||e>s.length)&&(e=s.length),s.insert(e,t),this.viewNodes){var o=s[e-1];if(o){var r=n.indexOf(o);n.insert(r+1,t)}else n.insert(0,t)}t._pid=i._id,this._setAdded(t);var l=this,a=t[this.nodesField];if(a){!function t(e,i){for(var n=0,s=e.length;n<s;n++){var o=e[n];o._pid=i._id,l._setAdded(o),o[l.nodesField]&&t(o[l.nodesField])}}(a,t)}this._dataChanged();var h={parentNode:i,index:e,node:t};return this.fire("addnode",h),t}},removeNodeAt:function(t,e){e=e||this.root;var i=this.getChildNodes(e),n=i[t];if(!n)return null;i.removeAt(t),this.viewNodes&&e[this.nodesField].remove(n);this._setRemoved(n),this.cascadeChild(n,function(t,e,i){this._setRemoved(t)},this),this._checkSelecteds(),this._dataChanged();var s={parentNode:e,index:t,node:n};return this.fire("removenode",s),n},bubbleParent:function(t,e,i){i=i||this,t&&e.call(this,t);var n=this.getParentNode(t);n&&n!=this.root&&this.bubbleParent(n,e,i)},cascadeChild:function(t,e,i){if(e){t=t||this.root;var n=this.getChildNodes(t);if(n)for(var s=0,o=(n=n.clone()).length;s<o;s++){var r=n[s];if(!1===e.call(i||this,r,s,t))return;this.cascadeChild(r,e,i)}}},eachChild:function(t,e,i){if(e&&t){var n=t[this.nodesField];if(n)for(var s=n.clone(),o=0,r=s.length;o<r;o++){var l=s[o];if(!1===e.call(i||this,l,o,t))break}}},collapse:function(t,e){if(t=this.getNode(t)){this.beginChange(),t.expanded=!1,e&&this.eachChild(t,function(t){null!=t[this.nodesField]&&this.collapse(t,e)},this),this.endChange("collapse");var i={node:t};this.fire("collapse",i)}},expand:function(t,e){if(t=this.getNode(t)){this.beginChange(),t.expanded=!0,e&&this.eachChild(t,function(t){null!=t[this.nodesField]&&this.expand(t,e)},this),this.endChange("expand");var i={node:t};this.fire("expand",i)}},toggle:function(t){this.isExpandedNode(t)?this.collapse(t):this.expand(t)},expandNode:function(t){this.expand(t)},collapseNode:function(t){this.collapse(t)},collapseAll:function(){this.collapse(this.root,!0)},expandAll:function(){this.expand(this.root,!0)},collapseLevel:function(i,n){this.beginChange(),this.each(function(t){var e=this.getLevel(t);i==e&&this.collapse(t,n)},this),this.endChange()},expandLevel:function(i,n){this.beginChange(),this.each(function(t){var e=this.getLevel(t);i==e&&this.expand(t,n)},this),this.endChange()},expandPath:function(t){if(t=this.getNode(t))for(var e=this.getAncestors(t),i=0,n=e.length;i<n;i++)this.expandNode(e[i])},collapsePath:function(t){if(t=this.getNode(t))for(var e=this.getAncestors(t),i=0,n=e.length;i<n;i++)this.collapseNode(e[i])},isAncestor:function(t,e){if(t==e)return!0;if(!t||!e)return!1;if(t==this.getRootNode())return!0;for(var i=this.getAncestors(e),n=0,s=i.length;n<s;n++)if(i[n]==t)return!0;return!1},getAncestors:function(t){for(var e=[];;){var i=this.getParentNode(t);if(!i||i==this.root)break;t=e[e.length]=i}return e.reverse(),e},getNode:function(t){return"object"==typeof t?t:this.getRecord(t)},getRootNode:function(){return this.root},getParentNode:function(t){return t?this.getby_id(t._pid):null},getAllChildNodes:function(t,e){return this.getChildNodes(t,!0,e)},getChildNodes:function(t,e,i){var n=(t=(t=this.getNode(t))||this.getRootNode())[this.nodesField];if(this.viewNodes&&!1!==i&&(n=this.viewNodes[t._id]),!0===e&&n){for(var s=[],o=0,r=n.length;o<r;o++){var l=n[o];s[s.length]=l;var a=this.getChildNodes(l,e,i);a&&0<a.length&&s.addRange(a)}n=s}return n||[]},getChildNodeAt:function(t,e){var i=this.getChildNodes(e);return i?i[t]:null},hasChildNodes:function(t){return 0<this.getChildNodes(t).length},getLevel:function(t){return t._level},_is_true:function(t){return"true"==String(t)||1===t||"Y"===t||"y"===t},_is_false:function(t){return"false"==String(t)||0===t||"N"===t||"n"===t},leafField:"isLeaf",isLeafNode:function(t){return this.isLeaf(t)},isLeaf:function(t){if(!t)return!1;var e=t[this.leafField];return!(!t||this._is_false(e))&&!(0<this.getChildNodes(t,!1,!1).length)},hasChildren:function(t){var e=this.getChildNodes(t);return!!(e&&0<e.length)},isFirstNode:function(t){if(t==this.root)return!0;var e=this.getParentNode(t);return!!e&&this.getFirstNode(e)==t},isLastNode:function(t){if(t==this.root)return!0;var e=this.getParentNode(t);return!!e&&this.getLastNode(e)==t},isCheckedNode:function(t){return!0===t.checked},isExpandedNode:function(t){return 1==t.expanded||1==t.expanded||mini.isNull(t.expanded)},isEnabledNode:function(t){return!1!==t.enabled},isVisibleNode:function(t){if(0==t.visible)return!1;var e=this._ids[t._pid];return!e||e==this.root||!1!==e.expanded&&this.isVisibleNode(e)},getNextNode:function(t){var e=this.getby_id(t._pid);if(!e)return null;var i=this.indexOfNode(t);return this.getChildNodes(e)[i+1]},getPrevNode:function(t){var e=this.getby_id(t._pid);if(!e)return null;var i=this.indexOfNode(t);return this.getChildNodes(e)[i-1]},getFirstNode:function(t){return this.getChildNodes(t)[0]},getLastNode:function(t){var e=this.getChildNodes(t);return e[e.length-1]},indexOfNode:function(t){var e=this.getby_id(t._pid);return e?this.getChildNodes(e).indexOf(t):-1},indexOfList:function(t){return this.getList().indexOf(t)},getAt:function(t){return this.getVisibleRows()[t]},indexOf:function(t){return this.getVisibleRows().indexOf(t)},getRange:function(t,e){if(e<t){var i=t;t=e,e=i}for(var n=this.getChildNodes(this.root,!0),s=[],o=t,r=e;o<=r;o++){var l=n[o];l&&s.push(l)}return s},selectRange:function(t,e){var i=this.getChildNodes(this.root,!0);if(mini.isNumber(t)||(t=i.indexOf(t)),mini.isNumber(e)||(e=i.indexOf(e)),!mini.isNull(t)&&!mini.isNull(e)){var n=this.getRange(t,e);this.selects(n)}},findRecords:function(t,e){var i=this.toArray(),n="function"==typeof t,s=t,o=e||this,r=[];mini.isNull(e)||(e=String(e));for(var l=0,a=i.length;l<a;l++){var h=i[l];if(n){var u=s.call(o,h);if(1==u&&(r[r.length]=h),1===u)break}else if(-1!=e.indexOf(","))for(var d=e.split(","),c=0,m=d.length;c<m;c++){var f=d[c];h[t]==f&&(r[r.length]=h)}else h[t]==e&&(r[r.length]=h)}return r},_dataChangedCount:0,_dataChanged:function(t){this._dataChangedCount++,"update"!=t&&(this.ids=null,this.dataview=null,this.visibleRows=null,"collapse"==t||"expand"==t||"loaddata"==t||(this.list=null)),0==this.__changeCount&&this.fire("datachanged")},_createDataView:function(){return this.viewNodes?this.getChildNodes(this.root,!0):this.getList()},_createVisibleRows:function(){var s,o,r=[],e=this.nodesField,i=this.viewNodes,n=!!i;function l(t){return n?i[t._id]:t[e]}return function t(e){for(var i=0,n=e.length;i<n;i++)s=e[i],!1===(r[r.length]=s).expanded||(o=l(s))&&t(o)}(l(this.root)),r},getList:function(){return this.list||(this.list=mini.treeToList(this.source,this.nodesField)),this.list},getDataView:function(){return this.dataview||(this.dataview=this._createDataView()),this.dataview},getVisibleRows:function(){return this.visibleRows||(this.visibleRows=this._createVisibleRows()),this.visibleRows},_doFilter:function(){if(this._filterInfo){var h=this._filterInfo[0],u=this._filterInfo[1],d=this.viewNodes={},c=this.nodesField;!function t(e){var i=e[c];if(!i)return!1;for(var n=e._id,s=d[n]=[],o=0,r=i.length;o<r;o++){var l=i[o],a=t(l);!0!==h.call(u,l,o,this)&&!a||s.push(l)}return 0<s.length}(this.root)}else this.viewNodes=null},_doSort:function(){if(this._filterInfo||this._sortInfo){if(this._sortInfo){var o=this._sortInfo[0],r=this._sortInfo[1],l=this._sortInfo[2],s=this.nodesField;if(!this.viewNodes){var a=this.viewNodes={};a[this.root._id]=this.root[s].clone(),this.cascadeChild(this.root,function(t,e,i){var n=t[s];n&&(a[t._id]=n.clone())})}var h=this;!function t(e){var i=h.getChildNodes(e);mini.sort(i,o,r),l&&i.reverse();for(var n=0,s=i.length;n<s;n++)t(i[n])}(this.root)}}else this.viewNodes=null},toArray:function(){return this._array&&this._dataChangedCount==this._dataChangedCount2||(this._dataChangedCount2=this._dataChangedCount,this._array=this.getChildNodes(this.root,!0,!1)),this._array},toTree:function(){return this.root[this.nodesField]},isChanged:function(){return 0<this.getChanges().length},getChanges:function(t,e){var i=[];"removed"!=t&&null!=t||i.addRange(this._removeds.clone());for(var n=this.getAllChildNodes(this.root,!1),s=0,o=n.length;s<o;s++){var r=n[s];null!=r._state&&""!=r._state&&(r._state!=t&&null!=t||(i[i.length]=r))}var l=i;if(e)for(s=0,o=l.length;s<o;s++){var a=l[s];if("modified"==a._state){var h={};for(var u in h._state=a._state,h[this.idField]=a[this.idField],a){this.isModified(a,u)&&(h[u]=a[u])}l[s]=h}}return i},accept:function(t){t=t||this.root,this.beginChange(),this.cascadeChild(this.root,function(t){this.acceptRecord(t)},this),this._removeds=[],this._originals={},this.endChange()},reject:function(t){this.beginChange(),this.cascadeChild(this.root,function(t){this.rejectRecord(t)},this),this._removeds=[],this._originals={},this.endChange()},acceptRecord:function(t){t._state&&(delete this._originals[t[this._originalIdField]],"deleted"==t._state?this.removeNode(t):(delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})))},rejectRecord:function(t){if(t._state)if("added"==t._state)this.removeNode(t);else if("modified"==t._state||"deleted"==t._state){var e=this._getOriginal(t);mini.copyTo(t,e),delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})}},upGrade:function(t){var e=this.getParentNode(t);if(e==this.root||t==this.root)return!1;for(var i=e[this.nodesField],n=i.indexOf(t),s=t[this.nodesField]?t[this.nodesField].length:0,o=i.length-1;n<=o;o--){var r=i[o];i.removeAt(o),r!=t&&(t[this.nodesField]||(t[this.nodesField]=[]),t[this.nodesField].insert(s,r))}var l=this.getParentNode(e),a=l[this.nodesField];n=a.indexOf(e);a.insert(n+1,t),this._updateParentAndLevel(t,l),this._doFilter(),this._dataChanged()},downGrade:function(t){if(this.isFirstNode(t))return!1;var e=this.getParentNode(t)[this.nodesField],i=e.indexOf(t),n=e[i-1];e.removeAt(i),n[this.nodesField]||(n[this.nodesField]=[]),n[this.nodesField].add(t),this._updateParentAndLevel(t,n),this._doFilter(),this._dataChanged()},_updateParentAndLevel:function(t,e){var n=this;t._pid=e._id,t._level=e._level+1,t[n.parentField]=e[n.idField],t[n.parentField]||(t[n.parentField]=e._id),this.cascadeChild(t,function(t,e,i){t._pid=i._id,t._level=i._level+1,t[n.parentField]=i[n.idField]},this),this._setModified(t)},setCheckModel:function(t){this.checkModel=t},getCheckModel:function(){return this.checkModel},setOnlyLeafCheckable:function(t){this.onlyLeafCheckable=t},getOnlyLeafCheckable:function(){return this.onlyLeafCheckable},setAutoCheckParent:function(t){this.autoCheckParent=t},getAutoCheckParent:function(){return this.autoCheckParent},_doUpdateLoadedCheckedNodes:function(){for(var t=this.getList(),e=0,i=t.length;e<i;e++){var n=t[e];1==n.checked&&(0!=this.autoCheckParent&&this.hasChildNodes(n)||this._doUpdateNodeCheckState(n))}},_doUpdateNodeCheckState:function(t){if(t){var e=this.isChecked(t);if(("cascade"==this.checkModel||this.autoCheckParent)&&(this.cascadeChild(t,function(t){this.doCheckNodes(t,e)},this),!this.autoCheckParent)){(d=this.getAncestors(t)).reverse();for(var i=0,n=d.length;i<n;i++){for(var s=d[i],o=this.getChildNodes(s),r=!0,l=0,a=o.length;l<a;l++){var h=o[l];this.isCheckedNode(h)||(r=!1)}r?this.doCheckNodes(s,!0):this.doCheckNodes(s,!1),this.fire("checkchanged",{nodes:[s],_nodes:[s]})}}var u=this;if(this.autoCheckParent){var d;(d=this.getAncestors(t)).reverse();for(i=0,n=d.length;i<n;i++){(s=d[i]).checked=c(s),this.fire("checkchanged",{nodes:[s],_nodes:[s]})}}}function c(t){for(var e=u.getChildNodes(t),i=0,n=e.length;i<n;i++){var s=e[i];if(u.isCheckedNode(s))return!0}return!1}},doCheckNodes:function(t,e,i){if(t){"string"==typeof t&&(t=t.split(",")),mini.isArray(t)||(t=[t]),t=t.clone();var n=[];e=!1!==e,!0===i&&"single"==this.checkModel&&this.uncheckAllNodes();for(var s=t.length-1;0<=s;s--){var o=this.getRecord(t[s]);!o||e&&!0===o.checked||!e&&!0!==o.checked?o&&(!0===i&&this._doUpdateNodeCheckState(o),e||this.isLeaf(o)||n.push(o)):(o.checked=e,n.push(o),!0===i&&this._doUpdateNodeCheckState(o))}var r=this;setTimeout(function(){r.fire("_checkchanged",{nodes:t,_nodes:n,checked:e})},1)}},checkNode:function(t,e){this.doCheckNodes([t],!0,!1!==e)},uncheckNode:function(t,e){this.doCheckNodes([t],!1,!1!==e)},checkNodes:function(t,e){mini.isArray(t)||(t=[]),this.doCheckNodes(t,!0,!1!==e)},uncheckNodes:function(t,e){mini.isArray(t)||(t=[]),this.doCheckNodes(t,!1,!1!==e)},checkAllNodes:function(){var t=this.getList();this.doCheckNodes(t,!0,!1)},uncheckAllNodes:function(){var t=this.getList();this.doCheckNodes(t,!1,!1)},doGetCheckedNodes:function(t,e){!1===e&&(e="leaf");for(var i=[],n={},s=0,o=t.length;s<o;s++){var r=t[s],l=this.isLeafNode(r);if(!0===e){n[r._id]||(n[r._id]=r,i.push(r));for(var a=this.getAncestors(r),h=0,u=a.length;h<u;h++){var d=a[h];n[d._id]||(n[d._id]=d,i.push(d))}}else"parent"===e?l||n[r._id]||(n[r._id]=r,i.push(r)):"leaf"===e?l&&(n[r._id]||(n[r._id]=r,i.push(r))):n[r._id]||(n[r._id]=r,i.push(r))}return i},getCheckedNodes:function(t){var e=[];return this.cascadeChild(this.root,function(t){1==t.checked&&e.push(t)}),e=this.doGetCheckedNodes(e,t)},getCheckedNodesId:function(t,e){var i=this.getCheckedNodes(t);return this.getValueAndText(i,e)[0]},getCheckedNodesText:function(t,e){var i=this.getCheckedNodes(t);return this.getValueAndText(i,e)[1]},isChecked:function(t){return(t=this.getRecord(t))?!0===t.checked||1===t.checked:null},getCheckState:function(t){if(!(t=this.getRecord(t)))return null;if(!0===t.checked)return"checked";if(!t[this.nodesField])return"unchecked";if(t.indeterminate)return"indeterminate";for(var e=this.getChildNodes(t,!0),i=0,n=e.length;i<n;i++){if(!0===(t=e[i]).checked)return"indeterminate"}return"unchecked"},getUnCheckableNodes:function(){var e=[];return this.cascadeChild(this.root,function(t){0==this.getCheckable(t)&&e.push(t)},this),e},setCheckable:function(t,e){if(t){mini.isArray(t)||(t=[t]),e=!!e;for(var i=(t=t.clone()).length-1;0<=i;i--){var n=this.getRecord(t[i]);n&&(n.checkable=checked)}}},getCheckable:function(t){return!!(t=this.getRecord(t))&&(!0===t.checkable||!1!==t.checkable&&(!!this.isLeafNode(t)||!this.onlyLeafCheckable))},showNodeCheckbox:function(t,e){},reload:function(t,e,i){this._loadingNode=null,this.load(this.loadParams,t,e,i)},_isNodeLoading:function(){return!!this._loadingNode},loadNode:function(r,l){var t={node:this._loadingNode=r};this.fire("beforeloadnode",t);var e=new Date,a=this;a._doLoadAjax(a.loadParams,null,null,null,function(o){var t=new Date-e;t<60&&(t=60-t),setTimeout(function(){o.node=r,a._OnPreLoad(o),a._loadingNode=null,a.loadParams&&delete a.loadParams[a.idField];var t=r[a.nodesField];a.removeNodes(t);var e=o.data;if(e&&0<e.length){a.collapse(r),a.addNodes(e,r);for(var i=a.getAllChildNodes(r),n=0,s=i.length;n<s;n++){delete i[n]._state}!1!==l?a.expand(r,!0):a.collapse(r,!0)}else delete r[a.leafField],a.expand(r,!0);a.fire("loadnode",o),a.fire("load",o)},t)},!0)}}),mini.regClass(mini.DataTree,"datatree"),mini._DataTableApplys={idField:"id",textField:"text",setAjaxData:function(t){this._dataSource.ajaxData=t},getby_id:function(t){return this._dataSource.getby_id(t)},getValueAndText:function(t,e){return this._dataSource.getValueAndText(t,e)},setIdField:function(t){this._dataSource.setIdField(t),this.idField=t},getIdField:function(){return this._dataSource.idField},setTextField:function(t){this._dataSource.setTextField(t),this.textField=t},getTextField:function(){return this._dataSource.textField},getLoadParams:function(){return this._dataSource.loadParams},clearData:function(){this._dataSource.clearData()},loadData:function(t){this._dataSource.loadData(t)},setData:function(t){this._dataSource.loadData(t)},getData:function(){return this._dataSource.getSource().clone()},getList:function(){return this._dataSource.getList()},getDataView:function(){return this._dataSource.getDataView()},getVisibleRows:function(){return this._useEmptyView?[]:this._dataSource.getVisibleRows()},toArray:function(){return this._dataSource.toArray()},getRecord:function(t){return"object"==typeof t?t:this._dataSource.getRecord(t)},getRow:function(t){return"object"==typeof t?t:this._dataSource.getRow(t)},getRange:function(t,e){if(!mini.isNull(t)&&!mini.isNull(e))return this._dataSource.getRange(t,e)},getAt:function(t){return this._dataSource.getAt(t)},indexOf:function(t){return this._dataSource.indexOf(t)},getRowByUID:function(t){return this._dataSource.getby_id(t)},getRowByUid:function(t){return this.getRowByUID(t)},getRowById:function(t){return this._dataSource.getbyId(t)},clearRows:function(){this._dataSource.clearData()},updateRow:function(t,e,i){this._dataSource.updateRecord(t,e,i)},addRow:function(t,e){var i=this._dataSource.insert(e,t);return this.validateOnAdd&&this.validateRow(t),i},removeRow:function(t,e){return this._dataSource.remove(t,e)},removeRows:function(t,e){return this._dataSource.removeRange(t,e)},removeSelected:function(){var t=this.getSelected();t&&this.removeRow(t,!0)},removeRowAt:function(t,e){return this._dataSource.removeAt(t,e)},moveRow:function(t,e){this._dataSource.move(t,e)},addRows:function(t,e){return this._dataSource.insertRange(e,t)},findRows:function(t,e){return this._dataSource.findRecords(t,e)},findRow:function(t,e){return this._dataSource.findRecord(t,e)},multiSelect:!1,setMultiSelect:function(t){this._dataSource.setMultiSelect(t),this.multiSelect=t},getMultiSelect:function(){return this._dataSource.getMultiSelect()},setCurrent:function(t){this._dataSource.setCurrent(t)},getCurrent:function(){return this._dataSource.getCurrent()},isSelected:function(t){return this._dataSource.isSelected(t)},setSelected:function(t){this._dataSource.setSelected(t)},getSelected:function(){return this._dataSource.getSelected()},getSelecteds:function(){return this._dataSource.getSelecteds()},select:function(t,e){this._dataSource.select(t,e)},selects:function(t,e){this._dataSource.selects(t,e)},deselect:function(t,e){this._dataSource.deselect(t,e)},deselects:function(t,e){this._dataSource.deselects(t,e)},selectAll:function(t){this._dataSource.selectAll(t)},deselectAll:function(t){this._dataSource.deselectAll(t)},clearSelect:function(t){this.deselectAll(t)},selectPrev:function(){this._dataSource.selectPrev()},selectNext:function(){this._dataSource.selectNext()},selectFirst:function(){this._dataSource.selectFirst()},selectLast:function(){this._dataSource.selectLast()},selectRange:function(t,e){this._dataSource.selectRange(t,e)},filter:function(t,e){this._dataSource.filter(t,e)},clearFilter:function(){this._dataSource.clearFilter()},sort:function(t,e,i){this._dataSource.sort(t,e,i)},clearSort:function(){this._dataSource.clearSort()},findItems:function(t,e,i){return this._dataSource.findRecords(i,e,i)},getResultObject:function(){return this._dataSource._resultObject||{}},isChanged:function(){return this._dataSource.isChanged()},getChanges:function(t,e){return this._dataSource.getChanges(t,e)},accept:function(){this._dataSource.accept()},reject:function(){this._dataSource.reject()},acceptRecord:function(t){this._dataSource.acceptRecord(t)},rejectRecord:function(t){this._dataSource.rejectRecord(t)}},mini._DataTreeApplys={addRow:null,removeRow:null,removeRows:null,removeRowAt:null,moveRow:null,setExpandOnLoad:function(t){this._dataSource.setExpandOnLoad(t)},getExpandOnLoad:function(){return this._dataSource.getExpandOnLoad()},isSelectedNode:function(t){return t=this.getNode(t),this.getSelectedNode()===t},selectNode:function(t,e){t?this._dataSource.select(t,e):this._dataSource.deselect(this.getSelectedNode(),e)},getSelectedNode:function(){return this.getSelected()},getSelectedNodes:function(){return this.getSelecteds()},updateNode:function(t,e,i){this._dataSource.updateRecord(t,e,i)},addNode:function(t,e,i){return this._dataSource.insertNode(t,e,i)},removeNodeAt:function(t,e){return this._dataSource.removeNodeAt(t,e)},removeNode:function(t){return this._dataSource.removeNode(t)},moveNode:function(t,e,i){this._dataSource.moveNode(t,e,i)},addNodes:function(t,e,i){return this._dataSource.addNodes(t,e,i)},insertNodes:function(t,e,i){return this._dataSource.insertNodes(e,t,i)},moveNodes:function(t,e,i){this._dataSource.moveNodes(t,e,i)},removeNodes:function(t){return this._dataSource.removeNodes(t)},expandOnLoad:!1,checkRecursive:!0,autoCheckParent:!1,showFolderCheckBox:!0,idField:"id",textField:"text",parentField:"pid",nodesField:"children",checkedField:"checked",leafField:"isLeaf",resultAsTree:!0,setShowFolderCheckBox:function(t){this._dataSource.setShowFolderCheckBox(t),this.doUpdate&&this.doUpdate(),this.showFolderCheckBox=t},getShowFolderCheckBox:function(){return this._dataSource.getShowFolderCheckBox()},setCheckRecursive:function(t){this._dataSource.setCheckRecursive(t),this.checkRecursive=t},getCheckRecursive:function(){return this._dataSource.getCheckRecursive()},setResultAsTree:function(t){this._dataSource.setResultAsTree(t)},getResultAsTree:function(t){return this._dataSource.resultAsTree},setParentField:function(t){this._dataSource.setParentField(t),this.parentField=t},getParentField:function(){return this._dataSource.parentField},setLeafField:function(t){this._dataSource.leafField=t,this.leafField=t},getLeafField:function(){return this._dataSource.leafField},setNodesField:function(t){this._dataSource.setNodesField(t),this.nodesField=t},getNodesField:function(){return this._dataSource.nodesField},setCheckedField:function(t){this._dataSource.checkedField=t,this.checkedField=t},getCheckedField:function(){return this.checkedField},findNodes:function(t,e){return this._dataSource.findRecords(t,e)},getLevel:function(t){return this._dataSource.getLevel(t)},isVisibleNode:function(t){return this._dataSource.isVisibleNode(t)},isEnabledNode:function(t){return this._dataSource.isEnabledNode(t)},isExpandedNode:function(t){return this._dataSource.isExpandedNode(t)},isCheckedNode:function(t){return this._dataSource.isCheckedNode(t)},isLeaf:function(t){return this._dataSource.isLeafNode(t)},hasChildren:function(t){return this._dataSource.hasChildren(t)},isAncestor:function(t,e){return this._dataSource.isAncestor(t,e)},getNode:function(t){return this._dataSource.getRecord(t)},getRootNode:function(){return this._dataSource.getRootNode()},getParentNode:function(t){return this._dataSource.getParentNode.apply(this._dataSource,arguments)},getAncestors:function(t){return this._dataSource.getAncestors(t)},getAllChildNodes:function(t){return this._dataSource.getAllChildNodes.apply(this._dataSource,arguments)},getChildNodes:function(t,e){return this._dataSource.getChildNodes.apply(this._dataSource,arguments)},getChildNodeAt:function(t,e){return this._dataSource.getChildNodeAt.apply(this._dataSource,arguments)},indexOfNode:function(t){return this._dataSource.indexOfNode.apply(this._dataSource,arguments)},hasChildNodes:function(t){return this._dataSource.hasChildNodes.apply(this._dataSource,arguments)},isFirstNode:function(t){return this._dataSource.isFirstNode.apply(this._dataSource,arguments)},isLastNode:function(t){return this._dataSource.isLastNode.apply(this._dataSource,arguments)},getNextNode:function(t){return this._dataSource.getNextNode.apply(this._dataSource,arguments)},getPrevNode:function(t){return this._dataSource.getPrevNode.apply(this._dataSource,arguments)},getFirstNode:function(t){return this._dataSource.getFirstNode.apply(this._dataSource,arguments)},getLastNode:function(t){return this._dataSource.getLastNode.apply(this._dataSource,arguments)},toggleNode:function(t){this._dataSource.toggle(t)},collapseNode:function(t,e){this._dataSource.collapse(t,e)},expandNode:function(t,e){this._dataSource.expand(t,e)},collapseAll:function(){this.useAnimation=!1,this._dataSource.collapseAll(),this.useAnimation=!0},expandAll:function(){this.useAnimation=!1,this._dataSource.expandAll(),this.useAnimation=!0},expandLevel:function(t){this.useAnimation=!1,this._dataSource.expandLevel(t),this.useAnimation=!0},collapseLevel:function(t){this.useAnimation=!1,this._dataSource.collapseLevel(t),this.useAnimation=!0},expandPath:function(t){this.useAnimation=!1,this._dataSource.expandPath(t),this.useAnimation=!0},collapsePath:function(t){this.useAnimation=!1,this._dataSource.collapsePath(t),this.useAnimation=!0},loadNode:function(t,e){this._dataSource.loadNode(t,e)},setCheckModel:function(t){this._dataSource.setCheckModel(t)},getCheckModel:function(){return this._dataSource.getCheckModel()},setOnlyLeafCheckable:function(t){this._dataSource.setOnlyLeafCheckable(t)},getOnlyLeafCheckable:function(){return this._dataSource.getOnlyLeafCheckable()},setAutoCheckParent:function(t){this._dataSource.setAutoCheckParent(t)},getAutoCheckParent:function(){return this._dataSource.getAutoCheckParent()},checkNode:function(t,e){this._dataSource.checkNode(t,e)},uncheckNode:function(t,e){this._dataSource.uncheckNode(t,e)},checkNodes:function(t,e){this._dataSource.checkNodes(t,e)},uncheckNodes:function(t,e){this._dataSource.uncheckNodes(t,e)},checkAllNodes:function(){this._dataSource.checkAllNodes()},uncheckAllNodes:function(){this._dataSource.uncheckAllNodes()},getCheckedNodes:function(){return this._dataSource.getCheckedNodes.apply(this._dataSource,arguments)},getCheckedNodesId:function(){return this._dataSource.getCheckedNodesId.apply(this._dataSource,arguments)},getCheckedNodesText:function(){return this._dataSource.getCheckedNodesText.apply(this._dataSource,arguments)},getNodesByValue:function(t){mini.isNull(t)&&(t=""),t=String(t);for(var e=[],i=String(t).split(","),n=0,s=i.length;n<s;n++){var o=this.getNode(i[n]);o&&e.push(o)}return e},isChecked:function(t){return this._dataSource.isChecked.apply(this._dataSource,arguments)},getCheckState:function(t){return this._dataSource.getCheckState.apply(this._dataSource,arguments)},setCheckable:function(t,e){this._dataSource.setCheckable.apply(this._dataSource,arguments)},getCheckable:function(t){return this._dataSource.getCheckable.apply(this._dataSource,arguments)},bubbleParent:function(t,e,i){this._dataSource.bubbleParent.apply(this._dataSource,arguments)},cascadeChild:function(t,e,i){this._dataSource.cascadeChild.apply(this._dataSource,arguments)},eachChild:function(t,e,i){this._dataSource.eachChild.apply(this._dataSource,arguments)}},mini.ColumnModel=function(t){this.owner=t,mini.ColumnModel.superclass.constructor.apply(this,arguments),this._init()},mini.ColumnModel_ColumnID=1,mini.extend(mini.ColumnModel,mini.Component,{_defaultColumnWidth:100,_init:function(){this.columns=[],this._columnsRow=[],this._visibleColumnsRow=[],this._bottomColumns=[],this._visibleColumns=[],this._idColumns={},this._nameColumns={},this._fieldColumns={}},getColumns:function(){return this.columns},getAllColumns:function(){var t=[];for(var e in this._idColumns){var i=this._idColumns[e];t.push(i)}return t},getColumnsRow:function(){return this._columnsRow},getVisibleColumnsRow:function(){return this._visibleColumnsRow},getBottomColumns:function(){return this._bottomColumns},getVisibleColumns:function(){return this._visibleColumns},_getBottomColumnsByColumn:function(t){t=this.getColumn(t);for(var e=this._bottomColumns,i=[],n=0,s=e.length;n<s;n++){var o=e[n];this.isAncestorColumn(t,o)&&i.push(o)}return i},_getVisibleColumnsByColumn:function(t){t=this.getColumn(t);for(var e=this._visibleColumns,i=[],n=0,s=e.length;n<s;n++){var o=e[n];this.isAncestorColumn(t,o)&&i.push(o)}return i},setColumns:function(t){mini.isArray(t)||(t=[]),this._init(),this.columns=t,this._columnsChanged()},_columnsChanged:function(){this._updateColumnsView(),this.fire("columnschanged")},columnDefaults:{allowCellWrap:!1},_updateColumnsView:function(){var l=this._maxColumnLevel=0;this.eachColumns(this,function t(e,i,n){if(e.type){mini.isNull(e.header)||"function"==typeof e.header||""==e.header.trim()&&delete e.header;var s=mini._getColumn(e.type);if(s){var o=mini.copyTo({},e);mini.copyTo(e,s),mini.copyTo(e,o)}}e._id||(e._id=mini.ColumnModel_ColumnID++),e._pid=n==this?-1:n._id,(this._idColumns[e._id]=e).name&&(this._nameColumns[e.name]=e),e._level=l,l+=1,this.eachColumns(e,t,this),l-=1,e._level>this._maxColumnLevel&&(this._maxColumnLevel=e._level);var r=parseInt(e.width);mini.isNumber(r)&&String(r)==e.width&&(e.width=r+"px"),mini.isNull(e.width)&&(e.width=this._defaultColumnWidth+"px"),String(e.width).indexOf("px")&&(e.pxWidth=parseInt(e.width)),e.visible=!1!==e.visible,e.allowResize=!1!==e.allowResize,e.allowMove=!1!==e.allowMove,e.allowSort=!0===e.allowSort,e.allowDrag=!!e.allowDrag,e.readOnly=!!e.readOnly,e.autoEscape=!!e.autoEscape,e.enabled=!1!==e.enabled,e.showCellTip=!1!==e.showCellTip,e.valueFromSelect=!1!==e.valueFromSelect,e.vtype=e.vtype||"",null==e.allowCellWrap&&(e.allowCellWrap=this.columnDefaults.allowCellWrap),"string"==typeof e.filter&&(e.filter=window.eval("("+e.filter+")")),e.filter&&!e.filter.el&&(e.filter=mini.create(e.filter)),"function"==typeof e.init&&1!=e.inited&&e.init(this.owner),e.inited=!0,e._gridUID=this.owner.uid,e._rowIdField=this.owner._rowIdField},this),this._createColumnsRow();var e=0,i=this._visibleColumns=[],n=this._bottomColumns=[];this.cascadeColumns(this,function(t){t.columns&&0!=t.columns.length||(n.push(t),this.isVisibleColumn(t)&&(i.push(t),t._index=e++))},this),this._fieldColumns={};for(var t=this.getAllColumns(),s=0,o=t.length;s<o;s++){var r=t[s];r.field&&!this._fieldColumns[r.field]&&(this._fieldColumns[r.field]=r)}this._createFrozenColSpan()},_frozenStartColumn:-1,_frozenEndColumn:-1,isFrozen:function(){return 0<=this._frozenStartColumn&&this._frozenEndColumn>=this._frozenStartColumn},isFrozenColumn:function(t){if(!this.isFrozen())return!1;if(!(t=this.getColumn(t)))return!1;var e=this.getVisibleColumns().indexOf(t);return this._frozenStartColumn<=e&&e<=this._frozenEndColumn},frozen:function(t,e){t=this.getColumn(t),e=this.getColumn(e);var i=this.getVisibleColumns();this._frozenStartColumn=i.indexOf(t),this._frozenEndColumn=i.indexOf(e),t&&e&&this._columnsChanged()},unFrozen:function(){this._frozenStartColumn=-1,this._frozenEndColumn=-1,this._columnsChanged()},setFrozenStartColumn:function(t){this.frozen(t,this._frozenEndColumn)},setFrozenEndColumn:function(t){this.frozen(this._frozenStartColumn,t)},getFrozenColumns:function(){for(var t=[],e=this.isFrozen(),i=0,n=this._visibleColumns.length;i<n;i++)e&&this._frozenStartColumn<=i&&i<=this._frozenEndColumn&&t.push(this._visibleColumns[i]);return t},getUnFrozenColumns:function(){for(var t=[],e=this.isFrozen(),i=0,n=this._visibleColumns.length;i<n;i++)(e&&i>this._frozenEndColumn||!e)&&t.push(this._visibleColumns[i]);return t},getFrozenColumnsRow:function(){return this.isFrozen()?this._columnsRow1:[]},getUnFrozenColumnsRow:function(){return this.isFrozen()?this._columnsRow2:this.getVisibleColumnsRow()},_createFrozenColSpan:function(){var l=this,a=this.getVisibleColumns(),h=this._frozenStartColumn,u=this._frozenEndColumn;function d(t,e){for(var i=l.isBottomColumn(t)?[t]:l._getVisibleColumnsByColumn(t),n=0,s=i.length;n<s;n++){var o=i[n],r=a.indexOf(o);if(0==e&&r<h)return!0;if(1==e&&h<=r&&r<=u)return!0;if(2==e&&u<r)return!0}return!1}function t(t,e){for(var i=mini.treeToList(t.columns,"columns"),n=0,s=0,o=i.length;s<o;s++){var r=i[s];0!=l.isVisibleColumn(r)&&0!=d(r,e)&&(r.columns&&0!=r.columns.length||(n+=1))}return n}for(var e=mini.treeToList(this.columns,"columns"),i=0,n=e.length;i<n;i++){var s=e[i];delete s.colspan0,delete s.colspan1,delete s.colspan2,delete s.viewIndex0,delete s.viewIndex1,delete s.viewIndex2,this.isFrozen()&&(s.columns&&0<s.columns.length?(s.colspan1=t(s,1),s.colspan2=t(s,2),s.colspan0=t(s,0)):(s.colspan1=1,s.colspan2=1,s.colspan0=1),d(s,0)&&(s.viewIndex0=!0),d(s,1)&&(s.viewIndex1=!0),d(s,2)&&(s.viewIndex2=!0))}this._getMaxColumnLevel();this._columnsRow1=[],this._columnsRow2=[];for(i=0,n=this._visibleColumnsRow.length;i<n;i++){var o=this._visibleColumnsRow[i],r=[],c=[];this._columnsRow1.push(r),this._columnsRow2.push(c);for(var m=0,f=o.length;m<f;m++){var p=o[m];p.viewIndex1&&r.push(p),p.viewIndex2&&c.push(p)}}},_createColumnsRow:function(){for(var t=this._getMaxColumnLevel(),e=[],i=[],n=0,s=t;n<=s;n++)e.push([]),i.push([]);var r=this;function o(t){for(var e=mini.treeToList(t.columns,"columns"),i=0,n=0,s=e.length;n<s;n++){var o=e[n];0!=r.isVisibleColumn(o)&&(o.columns&&0!=o.columns.length||(i+=1))}return i}var l=mini.treeToList(this.columns,"columns");for(n=0,s=l.length;n<s;n++){var a=l[n],h=e[a._level],u=i[a._level];delete a.rowspan,delete a.colspan,a.columns&&0<a.columns.length&&(a.colspan=o(a)),(!a.columns||0==a.columns.length)&&a._level<t&&(a.rowspan=t-a._level+1),h.push(a),this.isVisibleColumn(a)&&u.push(a)}this._columnsRow=e,this._visibleColumnsRow=i},_getMaxColumnLevel:function(){return this._maxColumnLevel},cascadeColumns:function(t,e,i){if(e){var n=t.columns;if(n)for(var s=0,o=(n=n.clone()).length;s<o;s++){var r=n[s];if(!1===e.call(i||this,r,s,t))return;this.cascadeColumns(r,e,i)}}},eachColumns:function(t,e,i){var n=t.columns;if(n)for(var s=n.clone(),o=0,r=s.length;o<r;o++){var l=s[o];if(!1===e.call(i,l,o,t))break}},getColumn:function(t){var e=typeof t;return"number"==e?this._bottomColumns[t]:"object"==e?t:this._nameColumns[t]},getColumnByField:function(t){return t?this._fieldColumns[t]:null},_getColumnById:function(t){return this._idColumns[t]},_getDataTypeByField:function(t){for(var e="string",i=this.getBottomColumns(),n=0,s=i.length;n<s;n++){var o=i[n];if(o.field==t){o.sortType?e=o.sortType.toLowerCase():o.dataType&&(e=o.dataType.toLowerCase());break}}return e},getParentColumn:function(t){var e=(t=this.getColumn(t))._pid;return-1==e?this:this._idColumns[e]},getAncestorColumns:function(t){for(var e=[t];;){var i=this.getParentColumn(t);if(!i||i==this)break;t=e[e.length]=i}return e.reverse(),e},isAncestorColumn:function(t,e){if(t==e)return!0;if(!t||!e)return!1;for(var i=this.getAncestorColumns(e),n=0,s=i.length;n<s;n++)if(i[n]==t)return!0;return!1},isVisibleColumn:function(t){if(0==(t=this.getColumn(t)).visible)return!1;for(var e=this.getAncestorColumns(t),i=0,n=e.length;i<n;i++)if(0==e[i].visible)return!1;var s=t.columns;if(s){var o=!0;for(i=0,n=s.length;i<n;i++){var r=s[i];if(this.isVisibleColumn(r)){o=!1;break}}if(o)return!1}return!0},isBottomColumn:function(t){return!((t=this.getColumn(t)).columns&&0<t.columns.length)},updateColumn:function(t,e){(t=this.getColumn(t))&&(mini.copyTo(t,e),this._columnsChanged())},moveColumn:function(t,e,i){if(t=this.getColumn(t),e=this.getColumn(e),t&&e&&i&&t!=e&&!this.isAncestorColumn(t,e)){var n=this.getParentColumn(t);n&&n.columns.remove(t);var s=e,o=i;if("before"==o)o=(s=this.getParentColumn(e)).columns.indexOf(e);else if("after"==o)o=(s=this.getParentColumn(e)).columns.indexOf(e)+1;else if("add"==o||"append"==o)s.columns||(s.columns=[]),o=s.columns.length;else if(!mini.isNumber(o))return;s.columns.insert(o,t),this._columnsChanged()}},addColumn:function(t){t&&(delete t._id,this._columnsChanged())},removeColumn:function(){this._columnsChanged()}}),mini.GridView=function(){if(this._createTime=new Date,this._createColumnModel(),this._bindColumnModel(),this.data=[],this._createSource(),this._bindSource(),this._initData(),mini.GridView.superclass.constructor.apply(this,arguments),this._doUpdateFilterRow(),this._doUpdateSummaryRow(),this.doUpdate(),mini.isNull(this._paddingTop)){if(mini.isNull(mini.GridView._paddingTop)){var t=jQuery('<div class="mini-grid-cell-inner" style="position:absolute;left:-1000px;top:-1000px;"></div>').appendTo("body"),e=mini.getPaddings(t);mini.GridView._paddingTop=e.top,mini.GridView._paddingBottom=e.bottom}this._paddingTop=mini.GridView._paddingTop,this._paddingBottom=mini.GridView._paddingBottom}this._rowClsHash={}},mini.extend(mini.GridView,mini.Panel,{_displayStyle:"block",_rowIdField:"_id",width:"100%",showSortIcon:!1,showColumns:!0,showFilterRow:!1,showSummaryRow:!1,summaryRows:1,showPager:!1,allowCellWrap:!1,allowHeaderWrap:!1,showModified:!0,showNewRow:!0,showEmptyText:!1,emptyText:"No data returned.",showHGridLines:!0,showVGridLines:!0,_rowCls:"mini-grid-row",_cellCls:"mini-grid-cell",_headerCellCls:"mini-grid-headerCell",_rowSelectedCls:"mini-grid-row-selected",_rowHoverCls:"mini-grid-row-hover",_cellSelectedCls:"mini-grid-cell-selected",defaultRowHeight:25,fixedRowHeight:!1,isFixedRowHeight:function(){return this.fixedRowHeight},fitColumns:!0,isFitColumns:function(){return this.fitColumns},allowAlternating:!1,_alternatingCls:"mini-grid-row-alt",getAllowAlternating:function(){return this.allowAlternating},setAllowAlternating:function(t){this.allowAlternating=t,this.doUpdate()},showGroupSummary:!1,getShowGroupSummary:function(){return this.showGroupSummary},setShowGroupSummary:function(t){this.showGroupSummary=t},summaryPosition:"bottom",getSummaryPosition:function(){return this.summaryPosition},setSummaryPosition:function(t){this.summaryPosition=t,"top"==this.summaryPosition&&(mini.before(this._rowsEl,this._summaryEl),mini.before(this._summaryViewEl,this._summaryLockEl)),jQuery(this.el).toggleClass("mini-grid-summary-top","top"==t)},uiCls:"mini-gridview",_create:function(){mini.GridView.superclass._create.call(this);var t=this.el;mini.addClass(t,"mini-grid"),mini.addClass(this._borderEl,"mini-grid-border"),mini.addClass(this._viewportEl,"mini-grid-viewport");this._columnsEl=mini.after(this._toolbarEl,'<div class="mini-grid-columns"><div class="mini-grid-columns-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._filterEl=mini.after(this._columnsEl,'<div class="mini-grid-filterRow"><div class="mini-grid-filterRow-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._rowsEl=this._bodyEl,mini.addClass(this._rowsEl,"mini-grid-rows"),this._summaryEl=mini.after(this._rowsEl,'<div class="mini-grid-summaryRow"><div class="mini-grid-summaryRow-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._bottomPagerEl=mini.after(this._summaryEl,'<div class="mini-grid-pager"></div>'),this._columnsViewEl=this._columnsEl.childNodes[0],this._rowsViewEl=mini.append(this._rowsEl,'<div class="mini-grid-rows-view"><div class="mini-grid-rows-content"></div></div>'),this._rowsViewContentEl=this._rowsViewEl.firstChild,this._filterViewEl=this._filterEl.childNodes[0],this._summaryViewEl=this._summaryEl.childNodes[0];this._focusEl=mini.append(this._borderEl,'<a href="#" class="mini-grid-focus" style="position:absolute;left:0px;top:0px;width:0px;height:0px;outline:none;" hideFocus onclick="return false" ></a>');var e=this;mini.on(this._filterViewEl,"scroll",function(t){0<e._filterViewEl.scrollLeft&&(e._filterViewEl.scrollLeft=0)})},destroy:function(t){if(this._dataSource&&(this._dataSource.destroy(),this._dataSource=null),this._columnModel&&(this._columnModel.destroy(),this._columnModel=null),this._pagers){for(var e=this._pagers.clone(),i=0,n=e.length;i<n;i++)e[i].destroy(t);this._pagers=null}this._viewportEl&&mini.clearEvent(this._viewportEl),this._rowsViewEl&&mini.clearEvent(this._rowsViewEl),this._rowsEl&&mini.clearEvent(this._rowsEl),this._vscrollEl&&mini.clearEvent(this._vscrollEl),this._headerEl&&mini.clearEvent(this._headerEl),this._columnsEl&&(jQuery(this._columnsEl).unbind("mouseenter"),jQuery(this._columnsEl).unbind("mouseleave")),this._columnsEl=this._rowsEl=this._filterEl=this._summaryEl=this._bottomPagerEl=null,this._columnsViewEl=this._topRightCellEl=this._rowsViewEl=this._rowsViewContentEl=null,this._filterViewEl=this._summaryViewEl=this._focusEl=null,this._viewportEl=this._vscrollEl=this._bottomPager=null,mini.GridView.superclass.destroy.call(this,t)},_initEvents:function(){mini.GridView.superclass._initEvents.call(this),this._bindScrollEvent()},_bindScrollEvent:function(){var t=this;this._unbindScrollEvent(),this._scrollBindTimer=setTimeout(function(){mini.on(t._rowsViewEl,"scroll",t.__OnRowViewScroll,t)},100)},_unbindScrollEvent:function(){this._scrollBindTimer&&(clearTimeout(this._scrollBindTimer),this._scrollBindTimer=null),mini.un(this._rowsViewEl,"scroll",this.__OnRowViewScroll,this)},_syncScrollOffset:function(t,e){this._unbindScrollEvent(),null!=t&&(this._rowsViewEl.scrollLeft=t),null!=e&&(this._rowsViewEl.scrollTop=e,this._vscrollEl),this._bindScrollEvent()},_sizeChanged:function(){mini.GridView.superclass._sizeChanged.call(this);var t=this.isAutoHeight();mini.isIE&&(t?mini.addClass(this._rowsViewEl,"mini-grid-hidden-y"):mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y"))},_setBodyWidth:!1,doLayoutCardView:function(){var t=this._rowsViewEl.scrollHeight>this._rowsViewEl.clientHeight+1,e=this._columnsViewEl.firstChild,i=t?mini.getScrollOffset():0;e.parentNode.style.paddingRight=i+"px",e.style.width="100%"},doLayout:function(){var t=this;if(this.canLayout())if(mini.GridView.superclass.doLayout.call(this),this._stopLayout(),"cardview"!=this.viewType){var e=this._autoHeight;mini.isIE&&(e?mini.addClass(this._rowsViewEl,"mini-grid-hidden-y"):mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y"));var i=this._columnsViewEl.firstChild,n=this._rowsViewContentEl.firstChild,s=this._filterViewEl.firstChild,o=this._summaryViewEl.firstChild,r=jQuery(this._columnsViewEl).height(),l=s.offsetHeight,a=this._rowsViewEl.scrollHeight>this._rowsViewEl.clientHeight+1,h=this._rowsViewEl.scrollWidth>this._rowsViewEl.clientWidth+1,u=this._rowsViewContentEl.parentNode.offsetWidth-(a?mini.getScrollOffset():0);c.call(this,i),c.call(this,s),c.call(this,o),this._syncScroll();var d=this;setTimeout(function(){mini.layout(d._filterEl),mini.layout(d._summaryEl)},10),mini.isIE6&&setTimeout(function(){c.call(t,i)},1),mini.isIE10&&(setTimeout(function(){d.isFitColumns()?(i.style.width="auto",i.offsetWidth,i.style.width="100%"):i.style.width="0px"},0),mini.repaint(n)),this._topRightCellEl=this._columnsViewEl.childNodes[1],mini.isIE6&&(this._topRightCellEl.style.height=r),(mini.isIE6||mini.isIE7)&&(this._rowsViewContentEl.style.paddingBottom="0px",e&&h&&(this._rowsViewContentEl.style.paddingBottom="17px")),this._filterViewEl.style.height=l+"px",s.style.width=this.isFitColumns()?u+"px":""}else this.doLayoutCardView();function c(t){this.isFitColumns()?(n.style.width="100%",mini.isSafari||mini.isIE6?t.style.width=u+"px":a?(t.style.width="100%",t.parentNode.style.width="auto",s!=t&&(t.parentNode.style.paddingRight=mini.getScrollOffset()+"px"),mini.isIE8&&mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y")):(t.style.width="100%",t.parentNode.style.width="auto",t.parentNode.style.paddingRight="0px",mini.isIE8&&mini.addClass(this._rowsViewEl,"mini-grid-hidden-y"))):(n.style.width="0px",t.style.width="0px",mini.isSafari||mini.isChrome||mini.isIE6||(t.parentNode.style.width="100%",t.parentNode.style.paddingRight="0px"))}},setBody:function(){},_createTopRowHTML:function(t,e,i){var n="";mini.isIE?mini.isIE6||mini.isIE7||!mini.boxModel?n+='<tr style="display:none;height:0px;">':n+='<tr style="height:0px;">':mini.isChrome&&i&&0==i.length?n+='<tr style="height:1px;">':n+='<tr style="height:0px;">',!1!==this._userEmptyTd&&(n+='<td style="height:0px;width:0;"></td>');for(var s=0,o=t.length;s<o;s++){var r=t[s];r.width;n+='<td id="'+r._id+'" style="padding:0;border:0;margin:0;height:0px;',r.width&&(n+="width:"+r.width),r.minWidth&&(n+=";min-width:"+r.minWidth+"px"),n+='" ></td>'}return n+='<td style="width:0px;"></td>',n+="</tr>"},_createColumnsHTML:function(t,e,i){i=i||this.getVisibleColumns();var n=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];n.push(this._createTopRowHTML(i));for(var s=this.getSortField(),o=this.getSortOrder(),r=0,l=t.length;r<l;r++){var a=t[r];n[n.length]="<tr>",n[n.length]='<td style="width:0;"></td>';for(var h=0,u=a.length;h<u;h++){var d=a[h],c=d.sortField||d.field,m=this._createHeaderText(d,e),f=this._createHeaderCellId(d,e),p="";s&&s==c&&(p="asc"==o?"mini-grid-asc":"mini-grid-desc");var g="";0==this.allowHeaderWrap&&(g=" mini-grid-headerCell-nowrap "),n[n.length]='<td id="',n[n.length]=f,n[n.length]='" class="mini-grid-headerCell '+p+" "+(d.headerCls||"")+" ",d.columns&&0<d.columns.length||(n[n.length]=" mini-grid-bottomCell "),h==u-1&&(n[n.length]=" mini-grid-rightCell "),n[n.length]='" style="',d.headerStyle&&(n[n.length]=d.headerStyle+";"),d.headerAlign&&(n[n.length]="text-align:"+d.headerAlign+";"),n[n.length]='" ',d.rowspan&&(n[n.length]='rowspan="'+d.rowspan+'" '),this._createColumnColSpan(d,n,e),n[n.length]='><div class="mini-grid-headerCell-outer"><div class="mini-grid-headerCell-inner '+g+'">',n[n.length]=m,p?n[n.length]='<span class="mini-grid-sortIcon mini-icon"></span>':this.showSortIcon&&d.allowSort&&(n[n.length]='<span class="mini-grid-allowsort mini-icon"></span>'),n[n.length]='</div><div id="'+d._id+'" class="mini-grid-column-splitter"></div>',n[n.length]="</div></td>"}this.isFrozen()&&1==e&&(n[n.length]='<td class="mini-grid-headerCell" style="width:0;"><div class="mini-grid-headerCell-inner" style="',n[n.length]='">0</div></td>'),n[n.length]="</tr>"}return n.push("</table>"),n.join("")},_createHeaderText:function(t,e){var i=t.header;return"function"==typeof i&&(i=i.call(this,t)),!mini.isNull(i)&&""!==i||(i="&nbsp;"),i},_createColumnColSpan:function(t,e,i){t.colspan&&(e[e.length]='colspan="'+t.colspan+'" ')},doUpdateColumns:function(){var t=this._columnsViewEl.scrollLeft,e=this.getVisibleColumnsRow(),i=this._createColumnsHTML(e,2);i+='<div class="mini-grid-topRightCell"></div>',this._columnsViewEl.innerHTML=i,this._columnsViewEl.scrollLeft=t},doUpdate:function(){if(0!=this.canUpdate()){var t=this,e=this._isCreating();new Date;this._doUpdateSummaryRow();var i=this,n=this.getScrollLeft();i.doUpdateColumns(),e&&(this._useEmptyView=!0),this._doRemoveRowContent(),"cardview"==t.viewType?i.updateCardView():i.doUpdateRows(),0<n&&i.isVirtualScroll()&&i._syncScrollOffset(n),e&&(this._useEmptyView=!1),i.doLayout(),e&&!this._doUpdateTimer&&(this._doUpdateTimer=setTimeout(function(){i.el&&(i.doUpdateColumns(),"cardview"==t.viewType?i.updateCardView():i.doUpdateRows(),i.doLayout(),i._doUpdateTimer=null)},15)),this.unmask(),t._fireUpdateTimer&&(clearTimeout(t._fireUpdateTimer),t._fireUpdateTimer=null),t._fireUpdateTimer=setTimeout(function(){t._fireUpdateTimer=null,t.fire("update")},100)}},_doRemoveRowContent:function(){this._rowsViewContentEl&&this._rowsViewContentEl.firstChild&&this._rowsViewContentEl.removeChild(this._rowsViewContentEl.firstChild),this._rowsLockContentEl&&this._rowsLockContentEl.firstChild&&this._rowsLockContentEl.removeChild(this._rowsLockContentEl.firstChild)},_isCreating:function(){return new Date-this._createTime<1e3},deferUpdate:function(t){if(t=t||5,!this._updateTimer&&!this._doUpdateTimer){var e=this;this._updateTimer=setTimeout(function(){e._updateTimer=null,e.doUpdate()},t)}},_stopDeferUpdate:function(){this._updateTimer&&(clearTimeout(this._updateTimer),this._updateTimer=null)},_pushUpdateCallback:function(t,e,i){var n=0;(this._doUpdateTimer||this._updateTimer)&&(n=20),0==n?t.apply(e,i):setTimeout(function(){t.apply(e,i)},n)},_updateCount:0,beginUpdate:function(){this._updateCount++},endUpdate:function(t){this._updateCount--,0!=this._updateCount&&!0!==t||(this._updateCount=0,this.doUpdate())},canUpdate:function(){return 0==this._updateCount},setDefaultRowHeight:function(t){this.defaultRowHeight=t},getDefaultRowHeight:function(){return this.defaultRowHeight},_getRowHeight:function(t){var e=this.defaultRowHeight;return t._height&&(e=parseInt(t._height),isNaN(parseInt(t._height))&&(e=rowHeight)),e=e-this._paddingTop-this._paddingBottom,e-=1},_createGroupingHTML:function(s,o){var t=this.getGroupingView(),e=this.showGroupSummary,i=this.isFrozen(),r=0,l=this;function n(t){if(h.push('<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'),0<s.length){h.push(l._createTopRowHTML(s));for(var e=0,i=t.length;e<i;e++){var n=t[e];l._createRowHTML(n,r++,s,o,h)}}h.push("</table>")}var a=!1!==this.groupTitleCollapsible,h=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];h.push(this._createTopRowHTML(s));for(var u=0,d=t.length;u<d;u++)if(1!=o||this.isFrozen()){var c=t[u],m=this._createRowGroupId(c,o),f=this._createRowGroupRowsId(c,o),p=this._OnDrawGroup(c),g=c.expanded?"":" mini-grid-group-collapse ";h[h.length]='<tr id="',h[h.length]=m,h[h.length]='" class="mini-grid-groupRow',h[h.length]=g,h[h.length]='"><td style="width:0;"></td><td class="mini-grid-groupCell ',h[h.length]=p.cls,h[h.length]='" style="',h[h.length]=p.style,h[h.length]='" colspan="',h[h.length]=s.length,h[h.length]='"><div class="mini-grid-groupHeader ',a&&(h[h.length]="mini-grid-groupHeader-collapsible"),h[h.length]='">',!i||i&&1==o?(h[h.length]='<div class="mini-grid-group-ecicon"></div>',h[h.length]='<div class="mini-grid-groupTitle">'+p.cellHtml+"</div>"):h[h.length]="&nbsp;",h[h.length]="</div></td></tr>";var _=c.expanded?"":"display:none";if(h[h.length]='<tr class="mini-grid-groupRows-tr" style="',h[h.length]='"><td style="width:0;"></td><td class="mini-grid-groupRows-td" colspan="',h[h.length]=s.length,h[h.length]='"><div id="',h[h.length]=f,h[h.length]='" class="mini-grid-groupRows" style="',mini.isChrome&&(h[h.length]="margin-left:-1px;"),h[h.length]=_,h[h.length]='">',n(c.rows),h[h.length]="</div></td></tr>",e&&0<s.length){h[h.length]='<tr class="mini-grid-groupFooter">',h[h.length]='<td style="width:0;"></td>';for(var v=0,w=s.length;v<w;v++){var y=s[v];m="",p=this._OnDrawSummaryCell(c.rows,y,c);h[h.length]='<td id="',h[h.length]=m,h[h.length]='" class="mini-grid-cell '+p.cellCls+'" style="'+p.cellStyle+";",h[h.length]='"><div class="mini-grid-cell-inner">',h[h.length]=p.cellHtml,h[h.length]="</div></td>"}h[h.length]="</tr>"}}return h.push("</table>"),h.join("")},_isFastCreating:function(){return 50<this.getVisibleRows().length&&(this._isCreating()||this.getScrollTop()<50*this._defaultRowHeight)},isShowRowDetail:function(t){return!1},isCellValid:function(t,e){return!0},updateCardView:function(){for(var t=this.getVisibleRows(),e=(this.getVisibleColumns(),[]),i=0,n=t.length;i<n;i++){var s=t[i],o={rowCls:"",rowStyle:""},r=this.itemRenderer(s,i,o,this);e[e.length]='<div class="mini-grid-row ',e[e.length]=o.rowCls,e[e.length]='" style="',e[e.length]=o.rowStyle,e[e.length]='" id="',e[e.length]=this._createRowId(s,1),e[e.length]='">',e[e.length]=r,e[e.length]="</div>"}this._rowsViewContentEl.innerHTML=e.join("")},itemRenderer:function(t,e,i,n){return""},_createRowHTML:function(t,e,i,n,s){var o=!s;s=s||[];var r="",l=this.isFixedRowHeight();l&&(r=this._getRowHeight(t));var a,h,u=this.defaultRowHeight-1,d=" ",c=" ";s[s.length]='<tr class="mini-grid-row ',"added"==t._state&&this.showNewRow&&(s[s.length]="mini-grid-newRow "),this.isShowRowDetail(t)&&(s[s.length]="mini-grid-expandRow "),this.allowAlternating&&e%2==1&&(s[s.length]=this._alternatingCls,s[s.length]=" ");var m=this._rowClsHash[t._id];m&&(s[s.length]=m.join(" "),s[s.length]=" "),this._dataSource.isSelected(t)&&(s[s.length]=this._rowSelectedCls,s[s.length]=" "),a=s.length,s[s.length]=d,s[s.length]='" style="',h=s.length,s[s.length]=c,s[s.length]='" id="',s[s.length]=this._createRowId(t,n),!(s[s.length]='">')!==this._userEmptyTd&&(s[s.length]='<td style="width:0;"></td>');for(var f=this._currentCell,p=0,g=i.length;p<g;p++){var _=i[p],v=this._createCellId(t,_),w=this._OnDrawCell(t,_,e,_._index);null!==w.cellHtml&&void 0!==w.cellHtml&&""!==w.cellHtml||(w.cellHtml="&nbsp;"),s[s.length]="<td ",w.rowSpan&&(s[s.length]='rowspan="'+w.rowSpan+'"'),w.colSpan&&(s[s.length]='colspan="'+w.colSpan+'"'),s[s.length]=' id="',s[s.length]=v,s[s.length]='" class="mini-grid-cell ',this.isCellValid(t,_)||(s[s.length]=" mini-grid-cell-error "),p==g-1&&(s[s.length]=" mini-grid-rightCell "),w.cellCls&&(s[s.length]=" "+w.cellCls+" "),f&&f[0]==t&&f[1]==_&&(s[s.length]=" ",s[s.length]=this._cellSelectedCls),s[s.length]='" style="',0==w.showHGridLines&&(s[s.length]="border-bottom:0;"),0==w.showVGridLines&&(s[s.length]="border-right:0;"),w.visible||(s[s.length]="display:none;"),_.align&&(s[s.length]="text-align:",s[s.length]=_.align,s[s.length]=";"),w.cellStyle&&(s[s.length]=w.cellStyle),s[s.length]='">',s[s.length]='<div class="mini-grid-cell-inner ';var y=_.allowCellWrap;(y=y||w.allowCellWrap)||(s[s.length]=" mini-grid-cell-nowrap "),w.cellInnerCls&&(s[s.length]=w.cellInnerCls),!!_.field&&this._dataSource.isModified(t,_.field)&&this.showModified&&(s[s.length]=" mini-grid-cell-dirty"),s[s.length]='" style="',l&&(s[s.length]="height:",_.name&&this._treeColumn===_.name?s[s.length]=u:s[s.length]=r,s[s.length]="px;",s[s.length]="line-height:",_.name&&this._treeColumn===_.name?s[s.length]=u:s[s.length]=r,s[s.length]="px;"),w.cellInnerStyle&&(s[s.length]=w.cellInnerStyle),s[s.length]='">',s[s.length]=w.cellHtml,s[s.length]="</div>",s[s.length]="</td>",w.rowCls&&(d=w.rowCls),w.rowStyle&&(c=w.rowStyle)}if(this.isFrozen()&&1==n&&(s[s.length]='<td class="mini-grid-cell" style="width:0;',0==this.showHGridLines&&(s[s.length]="border-bottom:0;"),s[s.length]='"><div class="mini-grid-cell-inner" style="',l&&(s[s.length]="height:",s[s.length]=r,s[s.length]="px;"),s[s.length]='">0</div></td>'),s[a]=d,s[h]=c,s[s.length]="</tr>",o){var C=s.join("");return C=C.replace(/(<script(.*)<\/script(\s*)>)/i,"")}},_createRowsHTML:function(t,e,i,n){i=i||this.getVisibleRows();var s=['<table class="mini-grid-table mini-grid-rowstable" cellspacing="0" cellpadding="0" border="0">'];s.push(this._createTopRowHTML(t,!0,i));var o=this.uid+"$emptytext"+e;if(2==e&&(this._dataSource.loaded||this.alwaysShowEmptyText)){var r=this.showEmptyText&&0==i.length?"":"display:none;";s.push('<tr id="'+o+'" style="'+r+'"><td style="width:0"></td><td class="mini-grid-emptyText" colspan="'+t.length+'">'+this.emptyText+"</td></tr>")}var l=0;if(0<i.length){var a=i[0];l=this.getVisibleRows().indexOf(a)}for(var h=0,u=i.length;h<u;h++){var d=l+h,c=i[h];this._createRowHTML(c,d,t,e,s)}return n&&s.push(n),s.push("</table>"),s.join("")},doUpdateRows:function(){var t=this.getVisibleRows(),e=(new Date,this.getVisibleColumns());if(this.isGrouping()){var i=this._createGroupingHTML(e,2);this._rowsViewContentEl.innerHTML=i}else{i=this._createRowsHTML(e,2,t);this._rowsViewContentEl.innerHTML=i}},_createFilterRowHTML:function(t,e){var i=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0" style="position:absolute;top:0;left:0;height:100%;">'];i.push(this._createTopRowHTML(t)),i[i.length]="<tr>",i[i.length]='<td style="width:0;"></td>';for(var n=0,s=t.length;n<s;n++){var o=t[n],r=this._createFilterCellId(o);i[i.length]='<td id="',i[i.length]=r,i[i.length]='" class="mini-grid-filterCell" style="',i[i.length]='">&nbsp;</td>'}return i[i.length]='</tr></table><div class="mini-grid-scrollHeaderCell"></div>',i.join("")},_doRenderFilters:function(){for(var t=this.getVisibleColumns(),e=0,i=t.length;e<i;e++){var n=t[e];if(n.filter){var s=this.getFilterCellEl(n);s&&(s.innerHTML="",n.filter.render(s))}}},_doUpdateFilterRow:function(){this._filterViewEl.firstChild&&this._filterViewEl.removeChild(this._filterViewEl.firstChild);this.isFrozen();var t=this.getVisibleColumns(),e=this._createFilterRowHTML(t,2);this._filterViewEl.innerHTML=e,this._doRenderFilters()},_createSummaryRowHTML:function(t,e){var i=this.getDataView(),n=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];n.push(this._createTopRowHTML(t));for(var s=0,o=this.summaryRows;s<o;s++){n[n.length]="<tr>",n[n.length]='<td style="width:0;"></td>';for(var r=0,l=t.length;r<l;r++){var a=t[r],h=this._createSummaryCellId(a,s),u=this._OnDrawSummaryCell(i,a,null,s);n[n.length]='<td id="',n[n.length]=h,n[n.length]='" class="mini-grid-summaryCell '+u.cellCls+'" style="'+u.cellStyle+";",n[n.length]='">',n[n.length]=u.cellHtml,n[n.length]="</td>"}n[n.length]="</tr>"}return n[n.length]='</table><div class="mini-grid-scrollHeaderCell"></div>',n.join("")},_doUpdateSummaryRow:function(){if(this.showSummaryRow){var t=this.getVisibleColumns(),e=this._createSummaryRowHTML(t,2);this._summaryViewEl.innerHTML=e}},_doSortByField:function(t,e){if(!t)return null;var i=this._columnModel._getDataTypeByField(t);this._dataSource._doClientSortField(t,e,i)},_expandGroupOnLoad:!0,_GroupID:1,_groupField:"",_groupDir:"",groupBy:function(t,e){t&&(this._groupField=t,"string"==typeof e&&(e=e.toLowerCase()),this._groupDir=e,this._createGroupingView(),this.deferUpdate())},clearGroup:function(){this._groupField="",this._groupDir="",this._groupDataView=null,this.deferUpdate()},setGroupField:function(t){this.groupBy(t)},getGroupField:function(){return this._groupField},getGroupDir:function(){return this._groupDir},setGroupDir:function(t){this._groupDir=field,this.groupBy(this._groupField,t)},isGrouping:function(){return""!=this._groupField},getGroupingView:function(){return this._groupDataView},enableGroupOrder:!0,_createGroupingView:function(){if(0!=this.isGrouping()){this._groupDataView=null;var t=this._dataSource,e=this._groupField,i=this._groupDir;(this.enableGroupOrder||i)&&this._doSortByField(e,i);for(var n=this.getVisibleRows(),s=[],o={},r=0,l=n.length;r<l;r++){var a=n[r],h=a[e],u=mini.isDate(h)?h.getTime():h;(g=o[u])||((g=o[u]={}).field=e,g.dir=i,g.value=h,g.rows=[],s.push(g),g.id="g"+this._GroupID++,g.expanded=this._expandGroupOnLoad),g.rows.push(a)}var d=t.sortField,c=t.sortOrder;if(d){var m=this._columnModel._getDataTypeByField(d),f=t._getSortFnByField(d,m);if(f){var p="desc"==c;for(r=0,l=s.length;r<l;r++){var g=s[r];mini.sort(g.rows,f),p&&g.rows.reverse()}}}this._groupDataView=s}},_OnDrawGroup:function(t){var e={group:t,rows:t.rows,field:t.field,dir:t.dir,value:t.value,cls:"",style:"",cellHtml:t.field+" ("+t.rows.length+" Items)"};return this.fire("drawgroup",e),e},getRowGroup:function(t){var e=typeof t;return"number"==e?this.getGroupingView()[t]:"string"==e?this._getRowGroupById(t):t},_getRowGroupByEvent:function(t){var e=mini.findParent(t.target,"mini-grid-groupRow");if(e){var i=e.id.split("$");if(i[0]!=this._id)return null;var n=i[i.length-1];return this._getRowGroupById(n)}return null},_getRowGroupById:function(t){for(var e=this.getGroupingView(),i=0,n=e.length;i<n;i++){var s=e[i];if(s.id==t)return s}return null},_createRowGroupId:function(t,e){return this._id+"$group"+e+"$"+t.id},_createRowGroupRowsId:function(t,e){return this._id+"$grouprows"+e+"$"+t.id},_createRowId:function(t,e){return this._id+"$row"+e+"$"+t._id},_createHeaderCellId:function(t,e){return this._id+"$headerCell"+e+"$"+t._id},_createCellId:function(t,e){return t._id+"$cell$"+e._id},_createFilterCellId:function(t){return this._id+"$filter$"+t._id},_createSummaryCellId:function(t,e){return this._id+"$summary$"+t._id+"_"+e},getFilterCellEl:function(t){return(t=this.getColumn(t))?document.getElementById(this._createFilterCellId(t)):null},getSummaryCellEl:function(t,e){return e=e||0,(t=this.getColumn(t))?document.getElementById(this._createSummaryCellId(t,e)):null},_doVisibleEls:function(){mini.GridView.superclass._doVisibleEls.call(this),this._columnsEl.style.display=this.showColumns?"block":"none",this._filterEl.style.display=this.showFilterRow?"block":"none",this._summaryEl.style.display=this.showSummaryRow?"block":"none",this._bottomPagerEl.style.display=this.showPager?"block":"none"},setShowColumns:function(t){this.showColumns=t,this._doVisibleEls(),this.deferLayout()},setShowFilterRow:function(t){this.showFilterRow=t,this._doVisibleEls(),this.deferLayout()},setShowSummaryRow:function(t){this.showSummaryRow=t,this._doVisibleEls(),this.deferLayout()},setShowPager:function(t){this.showPager=t,this._doVisibleEls(),this.deferLayout()},setFitColumns:function(t){this.fitColumns=t,mini.removeClass(this.el,"mini-grid-fixwidth"),0==this.fitColumns&&mini.addClass(this.el,"mini-grid-fixwidth"),this.deferLayout()},getBodyHeight:function(t){var e=mini.GridView.superclass.getBodyHeight.call(this,t);return e=e-this.getColumnsHeight()-this.getFilterHeight()-this.getSummaryHeight()-this.getPagerHeight()},getColumnsHeight:function(){return this.showColumns?mini.getHeight(this._columnsEl):0},getFilterHeight:function(){return this.showFilterRow?mini.getHeight(this._filterViewEl.firstChild):0},getSummaryHeight:function(){return this.showSummaryRow?mini.getHeight(this._summaryEl):0},getPagerHeight:function(){return this.showPager?mini.getHeight(this._bottomPagerEl):0},getGridViewBox:function(t){var e=mini.getBox(this._columnsEl),i=mini.getBox(this._bodyEl);return e.height=i.bottom-e.top,e.bottom=e.top+e.height,e},getSortField:function(t){return this._dataSource.sortField},getSortOrder:function(t){return this._dataSource.sortOrder},_createSource:function(){this._dataSource=new mini.DataTable},_bindSource:function(){var t=this._dataSource;t.on("loaddata",this.__OnSourceLoadData,this),t.on("cleardata",this.__OnSourceClearData,this)},__OnSourceLoadData:function(t){this._initData();var e=this.getSortField(),i=this.getSortOrder();"client"==this.sortMode&&e&&i&&this.sortBy(e,i),this.doUpdate()},__OnSourceClearData:function(t){this._initData(),this.doUpdate()},_initData:function(){},isFrozen:function(){this._columnModel._frozenStartColumn,this._columnModel._frozenEndColumn;return this._columnModel.isFrozen()},_createColumnModel:function(){this._columnModel=new mini.ColumnModel(this)},_bindColumnModel:function(){this._columnModel.on("columnschanged",this.__OnColumnsChanged,this)},__OnColumnsChanged:function(t){this.columns=this._columnModel.columns,this._doUpdateFilterRow(),this._doUpdateSummaryRow(),this.doUpdate(),this.fire("columnschanged")},setColumns:function(t){this._columnModel.setColumns(t),this.columns=this._columnModel.columns},getColumns:function(){return this._columnModel.getColumns()},getBottomColumns:function(){return this._columnModel.getBottomColumns()},getVisibleColumnsRow:function(){return this._columnModel.getVisibleColumnsRow().clone()},getVisibleColumns:function(){return this._columnModel.getVisibleColumns().clone()},getFrozenColumns:function(){return this._columnModel.getFrozenColumns().clone()},getUnFrozenColumns:function(){return this._columnModel.getUnFrozenColumns().clone()},getColumn:function(t){return this._columnModel.getColumn(t)},updateColumn:function(t,e){this._columnModel.updateColumn(t,e)},showColumns:function(t){for(var e=0,i=t.length;e<i;e++){var n=this.getColumn(t[e]);n&&(n.visible=!0)}this._columnModel._columnsChanged()},hideColumns:function(t){for(var e=0,i=t.length;e<i;e++){var n=this.getColumn(t[e]);n&&(n.visible=!1)}this._columnModel._columnsChanged()},showColumn:function(t){this.updateColumn(t,{visible:!0})},hideColumn:function(t){this.updateColumn(t,{visible:!1})},moveColumn:function(t,e,i){this._columnModel.moveColumn(t,e,i)},removeColumn:function(t){if(t=this.getColumn(t)){var e=this.getParentColumn(t);return t&&e&&(e.columns.remove(t),this._columnModel._columnsChanged()),t}},setDefaultColumnWidth:function(t){this._columnModel._defaultColumnWidth=t},getDefaultColumnWidth:function(){return this._columnModel._defaultColumnWidth},setColumnWidth:function(t,e){this.updateColumn(t,{width:e})},getColumnWidth:function(t){return this.getColumnBox(t).width},getParentColumn:function(t){return this._columnModel.getParentColumn(t)},getMaxColumnLevel:function(){return this._columnModel._getMaxColumnLevel()},_isCellVisible:function(t,e){return!0},_createDrawCellEvent:function(t,e,i,n){var s=mini._getMap(e.field,t),o={sender:this,rowIndex:i,columnIndex:n,record:t,row:t,column:e,field:e.field,value:s,cellHtml:s,rowCls:"",rowStyle:null,cellCls:e.cellCls||"",cellStyle:e.cellStyle||"",allowCellWrap:this.allowCellWrap,showHGridLines:this.showHGridLines,showVGridLines:this.showVGridLines,cellInnerCls:"",cellInnnerStyle:"",autoEscape:e.autoEscape};if(o.visible=this._isCellVisible(i,n),1==o.visible&&this._mergedCellMaps){var r=this._mergedCellMaps[i+":"+n];r&&(o.rowSpan=r.rowSpan,o.colSpan=r.colSpan)}return o},defaultColumnDateFormat:"yyyy-MM-dd",_OnDrawCell:function(t,e,i,n){var s=this._createDrawCellEvent(t,e,i,n),o=s.value,r=e.dateFormat||("date"==e.dataType?this.defaultColumnDateFormat:"");if(r&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(o,r):s.cellHtml=o),"float"==e.dataType){o=parseFloat(s.value);isNaN(o)||(decimalPlaces=parseInt(e.decimalPlaces),isNaN(decimalPlaces)&&(decimalPlaces=2),s.cellHtml=o.toFixed(decimalPlaces))}if("currency"==e.dataType&&(s.cellHtml=mini.formatCurrency(s.value,e.currencyUnit)),e.displayField&&(s.cellHtml=mini._getMap(e.displayField,t)),e.numberFormat){var l=parseFloat(s.cellHtml);isNaN(l)||(s.cellHtml=mini.formatNumber(l,e.numberFormat))}1==s.autoEscape&&(s.cellHtml=mini.htmlEncode(s.cellHtml));var a=e.renderer;if(a){var h="function"==typeof a?a:mini._getFunctoin(a);h&&(s.cellHtml=h.call(e,s))}return s.cellHtml=0===s.cellHtml||!1===s.cellHtml||s.cellHtml?String(s.cellHtml).trim():"",this.fire("drawcell",s),s.cellHtml&&s.cellHtml.unshift&&0==s.cellHtml.length&&(s.cellHtml="&nbsp;"),null!==s.cellHtml&&void 0!==s.cellHtml&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s},_OnDrawSummaryCell:function(t,e,i,n){var s={row:n,group:i,result:this.getResultObject(),sender:this,data:t,column:e,field:e.field,value:"",cellHtml:"",cellCls:e.cellCls||"",cellStyle:e.cellStyle||"",allowCellWrap:this.allowCellWrap};if(e.summaryType){var o=mini.summaryTypes[e.summaryType];o&&(s.value=o(t,e.field))}var r=s.value;s.cellHtml=s.value,s.value&&parseInt(s.value)!=s.value&&s.value.toFixed&&(decimalPlaces=parseInt(e.decimalPlaces),isNaN(decimalPlaces)&&(decimalPlaces=2),s.cellHtml=parseFloat(s.value.toFixed(decimalPlaces))),e.dateFormat&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(r,e.dateFormat):s.cellHtml=r),s.cellHtml&&"currency"==e.dataType&&(s.cellHtml=mini.formatCurrency(s.cellHtml,e.currencyUnit));var l=e.summaryRenderer;return l&&(o="function"==typeof l?l:window[l])&&(s.cellHtml=o.call(e,s)),e.summaryValue=s.value,this.fire("drawsummarycell",s),null!==s.cellHtml&&void 0!==s.cellHtml&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s},getScrollTop:function(){return this._rowsViewEl.scrollTop},setScrollTop:function(t){this._rowsViewEl.scrollTop=t},getScrollLeft:function(){return this._rowsViewEl.scrollLeft},setScrollLeft:function(t){this._rowsViewEl.scrollLeft=t},_syncScroll:function(){var t=this._rowsViewEl.scrollLeft;this._filterViewEl.firstChild.style.left=-t+"px",this._summaryViewEl.scrollLeft=t,this._columnsViewEl.scrollLeft=t},__OnRowViewScroll:function(t){this._syncScroll()},pagerType:"pager",getPagerType:function(){return this.pagerType},setPagerType:function(t){this.pagerType=t;var e=mini.create({type:this.pagerType});e&&this._setBottomPager(e)},_pagers:[],_createPagers:function(){this._pagers=[];var t=new mini.Pager;this._setBottomPager(t)},_setBottomPager:function(t){(t=mini.create(t))&&(this._bottomPager&&(this.unbindPager(this._bottomPager),this._bottomPagerEl.removeChild(this._bottomPager.el)),(this._bottomPager=t).render(this._bottomPagerEl),this.bindPager(t))},bindPager:function(t){this._pagers.add(t)},unbindPager:function(t){this._pagers.remove(t)},alwaysShowEmptyText:!1,setAlwaysShowEmptyText:function(t){this.alwaysShowEmptyText=t},getAlwaysShowEmptyText:function(){return this.alwaysShowEmptyText},setShowEmptyText:function(t){this.showEmptyText=t,0==this.data.length&&this.deferUpdate()},getShowEmptyText:function(){return this.showEmptyText},setEmptyText:function(t){this.emptyText=t},getEmptyText:function(){return this.emptyText},setShowModified:function(t){this.showModified=t},getShowModified:function(){return this.showModified},setShowNewRow:function(t){this.showNewRow=t},getShowNewRow:function(){return this.showNewRow},setAllowCellWrap:function(t){this.allowCellWrap=t},getAllowCellWrap:function(){return this.allowCellWrap},setAllowHeaderWrap:function(t){this.allowHeaderWrap=t},getAllowHeaderWrap:function(){return this.allowHeaderWrap},setEnableGroupOrder:function(t){this.enableGroupOrder=t},getEnableGroupOrder:function(){return this.enableGroupOrder},setShowHGridLines:function(t){this.showHGridLines!=t&&(this.showHGridLines=t,this.deferUpdate())},getShowHGridLines:function(){return this.showHGridLines},setShowVGridLines:function(t){this.showVGridLines!=t&&(this.showVGridLines=t,this.deferUpdate())},getShowVGridLines:function(){return this.showVGridLines},setShowSortIcon:function(t){this.showSortIcon!=t&&(this.showSortIcon=t,this.deferUpdate())},getShowSortIcon:function(){return this.showSortIcon}}),mini.copyTo(mini.GridView.prototype,mini._DataTableApplys),mini.regClass(mini.GridView,"gridview"),mini.FrozenGridView=function(){mini.FrozenGridView.superclass.constructor.apply(this,arguments)},mini.extend(mini.FrozenGridView,mini.GridView,{isFixedRowHeight:function(){return this.fixedRowHeight},frozenPosition:"left",isRightFrozen:function(){return"right"==this.frozenPosition},_create:function(){mini.FrozenGridView.superclass._create.call(this);this.el;this._columnsLockEl=mini.before(this._columnsViewEl,'<div class="mini-grid-columns-lock"></div>'),this._rowsLockEl=mini.before(this._rowsViewEl,'<div class="mini-grid-rows-lock"><div class="mini-grid-rows-content"></div></div>'),this._rowsLockContentEl=this._rowsLockEl.firstChild;this._filterLockEl=mini.before(this._filterViewEl,'<div class="mini-grid-filterRow-lock" style="height:100%;"></div>');this._summaryLockEl=mini.before(this._summaryViewEl,'<div class="mini-grid-summaryRow-lock"></div>')},_initEvents:function(){mini.FrozenGridView.superclass._initEvents.call(this),mini.on(this._rowsEl,"mousewheel",this.__OnMouseWheel,this)},_createHeaderText:function(t,e){var i=t.header;return"function"==typeof i&&(i=i.call(this,t)),!mini.isNull(i)&&""!==i||(i="&nbsp;"),this.isFrozen()&&2==e&&t.viewIndex1&&(i="&nbsp;"),i},_createColumnColSpan:function(t,e,i){if(this.isFrozen()){var n=t["colspan"+i];n&&(e[e.length]='colspan="'+n+'" ')}else t.colspan&&(e[e.length]='colspan="'+t.colspan+'" ')},doUpdateColumns:function(){var t=this._columnsViewEl.scrollLeft,e=this.isFrozen()?this.getFrozenColumnsRow():[],i=this.isFrozen()?this.getUnFrozenColumnsRow():this.getVisibleColumnsRow(),n=this.isFrozen()?this.getFrozenColumns():[],s=this.isFrozen()?this.getUnFrozenColumns():this.getVisibleColumns(),o=this._createColumnsHTML(e,1,n),r=this._createColumnsHTML(i,2,s),l='<div class="mini-grid-topRightCell"></div>';o+=l,r+=l,this._columnsLockEl.innerHTML=o,this._columnsViewEl.innerHTML=r,this._columnsLockEl.firstChild.style.width="0px",this._columnsViewEl.scrollLeft=t},doUpdateRows:function(){var t=this.getVisibleRows(),e=this.getFrozenColumns(),i=this.getUnFrozenColumns();if(this.isGrouping()){var n=this._createGroupingHTML(e,1),s=this._createGroupingHTML(i,2);this._rowsLockContentEl.innerHTML=n,this._rowsViewContentEl.innerHTML=s}else{n=this._createRowsHTML(e,1,this.isFrozen()?t:[]),s=this._createRowsHTML(i,2,t);this._rowsLockContentEl.innerHTML=n,this._rowsViewContentEl.innerHTML=s}this._rowsLockContentEl.firstChild.style.width="0px"},_doUpdateFilterRow:function(){this._filterLockEl.firstChild&&this._filterLockEl.removeChild(this._filterLockEl.firstChild),this._filterViewEl.firstChild&&this._filterViewEl.removeChild(this._filterViewEl.firstChild);var t=this.getFrozenColumns(),e=this.getUnFrozenColumns(),i=this._createFilterRowHTML(t,1),n=this._createFilterRowHTML(e,2);this._filterLockEl.innerHTML=i,this._filterViewEl.innerHTML=n,this._doRenderFilters()},_doUpdateSummaryRow:function(){var t=this.getFrozenColumns(),e=this.getUnFrozenColumns(),i=this._createSummaryRowHTML(t,1),n=this._createSummaryRowHTML(e,2);this._summaryLockEl.innerHTML=i,this._summaryViewEl.innerHTML=n},_syncRowsHeightTimer:null,syncRowDetail:function(t){var e=this._getRowDetailEl(t,1),i=this._getRowDetailEl(t,2);e&&i&&this._doSyncRowHeight(e,i)},_doSyncRowHeight:function(t,e){t.style.height=e.style.height="auto";var i=t.cells[0],n=e.cells[0],s=i.offsetHeight,o=n.offsetHeight;s<o&&(s=o),t.style.height=e.style.height=s+"px"},_syncRowsHeight:function(){var v=this;this.isFrozen()&&0==this.isFixedRowHeight()&&(this._syncRowsHeightTimer&&clearTimeout(this._syncRowsHeightTimer),this._syncRowsHeightTimer=setTimeout(function(){new Date,document;for(var t,e,i,n,s,o,r,l,a,h,u=v.getDataView(),d={},c=0,m=u.length;c<m;c++){var f=u[c],p=v._getRowEl(f,1),g=v._getRowEl(f,2);p&&g&&(t=g,p.style.height=t.style.height="auto",d[c]={row1:p,row2:g})}for(c=0,m=u.length;c<m;c++){f=u[c];(_=d[c])&&(_.height=(e=_.row1,i=_.row2,o=void 0,n=e.cells[0],s=i.cells[0],o=n.offsetHeight,r=s.offsetHeight,o<r&&(o=r),o))}for(c=0,m=u.length;c<m;c++){var _;f=u[c];(_=d[c])&&(l=_.row1,a=_.row2,h=_.height,l.style.height=a.style.height=h+"px")}v._syncRowsHeightTimer=null},2))},_syncColumnHeight:function(){var t=this._columnsLockEl,e=this._columnsViewEl;if(t.style.height=e.style.height="auto",this.isFrozen()){var i=t.offsetHeight;i=(n=e.offsetHeight)<i?i:n,t.style.height=e.style.height=i+"px"}t=this._summaryLockEl,e=this._summaryViewEl;if(t.style.height=e.style.height="auto",this.isFrozen()){var n;i=t.offsetHeight;i=(n=e.offsetHeight)<i?i:n,t.style.height=e.style.height=i+"px"}},_layoutColumns:function(){function t(t){return t.offsetHeight}function a(t){for(var e=[],i=0,n=t.cells.length;i<n;i++){var s=t.cells[i];"0px"!=s.style.width&&e.push(s)}return e}function s(t){for(var e=a(t),i=0,n=e.length;i<n;i++){e[i].style.height="auto"}}function l(t,e){for(var i=0,n=a(t),s=0,o=n.length;s<o;s++){var r=n[s];if(!(1<parseInt(r.rowSpan))||!e){var l=r.offsetHeight;i<l&&(i=l)}}return i}if(this.isFrozen()){var o=this._columnsLockEl.firstChild,r=this._columnsViewEl.firstChild;!function(){o.style.height=o.style.height="auto";for(var t=0,e=o.rows.length;t<e;t++){var i=o.rows[t],n=r.rows[t];s(i),s(n)}}();for(var e=0,i=o.rows.length;e<i;e++){var n,h,u=o.rows[e],d=r.rows[e];(n=l(u))==(h=l(d))||(n<h?(c(u,d),m(u,d)):h<n&&(c(d,u),m(d,u)))}(n=t(o))<(h=t(r))?mini.setHeight(o,h):h<n&&mini.setHeight(r,n)}function c(t,e){for(var i=l(e,!0),n=a(t),s=0,o=n.length;s<o;s++){var r=n[s];1<parseInt(r.rowSpan)||mini.setHeight(r,i)}}function m(t,e){for(var i=l(e),n=a(t),s=0,o=n.length;s<o;s++){var r=n[s];1<parseInt(r.rowSpan)&&mini.setHeight(r,i)}}},doLayout:function(){if(0!=this.canLayout()){this._doLayoutScroll=!1;var t=this.isFrozen(),e=this.getViewportWidth(!0),i=this.getLockedWidth(),n=e-i;this._doEmptyText();var s=this.isRightFrozen()?"marginRight":"marginLeft",o=this.isRightFrozen()?"right":"left";t?(this._filterViewEl.style[s]=i+"px",this._summaryViewEl.style[s]=i+"px",this._columnsViewEl.style[s]=i+"px",this._rowsViewEl.style[s]=i+"px",mini.isSafari||mini.isChrome||mini.isIE6?(this._filterViewEl.style.width=n+"px",this._summaryViewEl.style.width=n+"px",this._columnsViewEl.style.width=n+"px"):(this._filterViewEl.style.width="auto",this._summaryViewEl.style.width="auto",this._columnsViewEl.style.width="auto"),(mini.isSafari||mini.isChrome||mini.isIE6)&&(this._rowsViewEl.style.width=n+"px"),mini.setWidth(this._filterLockEl,i),mini.setWidth(this._summaryLockEl,i),mini.setWidth(this._columnsLockEl,i),mini.setWidth(this._rowsLockEl,i),this._filterLockEl.style[o]="0px",this._summaryLockEl.style[o]="0px",this._columnsLockEl.style[o]="0px",this._rowsLockEl.style[o]="0px"):this._doClearFrozen(),this._layoutColumns(),this._syncColumnHeight(),mini.FrozenGridView.superclass.doLayout.call(this);var r=this._autoHeight;t&&(mini.isChrome||mini.isIE6)&&(this._layoutColumns(),this._syncColumnHeight(),mini.FrozenGridView.superclass.doLayout.call(this)),this._rowsLockEl.style.height=r?"auto":"100%",this._syncRowsHeight()}},_doEmptyText:function(){},_getRowEl:function(t,e){t=this.getRecord(t);var i=this._createRowId(t,e);return document.getElementById(i)},_doClearFrozen:function(){this.isRightFrozen(),this.isRightFrozen();this._filterLockEl.style.left="-10px",this._summaryLockEl.style.left="-10px",this._columnsLockEl.style.left="-10px",this._rowsLockEl.style.left="-10px",this._filterLockEl.style.width="0px",this._summaryLockEl.style.width="0px",this._columnsLockEl.style.width="0px",this._rowsLockEl.style.width="0px",this._filterViewEl.style.marginLeft="0px",this._summaryViewEl.style.marginLeft="0px",this._columnsViewEl.style.marginLeft="0px",this._rowsViewEl.style.marginLeft="0px",this._filterViewEl.style.width="auto",this._summaryViewEl.style.width="auto",this._columnsViewEl.style.width="auto",this._rowsViewEl.style.width="auto",(mini.isSafari||mini.isChrome||mini.isIE6)&&(this._filterViewEl.style.width="100%",this._summaryViewEl.style.width="100%",this._columnsViewEl.style.width="100%",this._rowsViewEl.style.width="100%")},frozenColumns:function(t,e){this.frozen(t,e)},unFrozenColumns:function(){this.unFrozen()},frozen:function(t,e){this._doClearFrozen(),this._columnModel.frozen(t,e)},unFrozen:function(){this._doClearFrozen(),this._columnModel.unFrozen()},setFrozenStartColumn:function(t){this._columnModel.setFrozenStartColumn(t)},setFrozenEndColumn:function(t){return this._columnModel.setFrozenEndColumn(t)},getFrozenStartColumn:function(t){return this._columnModel._frozenStartColumn},getFrozenEndColumn:function(t){return this._columnModel._frozenEndColumn},getFrozenColumnsRow:function(){return this._columnModel.getFrozenColumnsRow()},getUnFrozenColumnsRow:function(){return this._columnModel.getUnFrozenColumnsRow()},getLockedWidth:function(){if(!this.isFrozen())return 0;var t=this._rowsLockContentEl.firstChild.firstChild;return t?t.offsetWidth:0},_canDeferSyncScroll:function(){return this.isFrozen()},_syncScroll:function(){var t=this._rowsViewEl.scrollLeft;this._filterViewEl.firstChild.style.left=-t+"px",this._summaryViewEl.scrollLeft=t,this._columnsViewEl.scrollLeft=t;var e=this._rowsViewEl.scrollTop;this._rowsLockEl.scrollTop=e},__OnMouseWheel:function(t){var e=this.getScrollTop()-t.wheelDelta,i=this.getScrollTop();this.setScrollTop(e),i!=this.getScrollTop()&&t.preventDefault()}}),mini.regClass(mini.FrozenGridView,"FrozenGridView"),mini.ScrollGridView=function(){mini.ScrollGridView.superclass.constructor.apply(this,arguments)},mini.extend(mini.ScrollGridView,mini.FrozenGridView,{virtualScroll:!0,virtualRows:25,defaultRowHeight:25,virtualColumns:!1,_canDeferSyncScroll:function(){return this.isFrozen()&&!this.isVirtualScroll()},setVirtualScroll:function(t){this.virtualScroll=t,this.doUpdate()},getVirtualScroll:function(t){return this.virtualScroll},isFitColumns:function(){return this.fitColumns&&!this.virtualColumns},setVirtualColumns:function(t){this.virtualColumns=t,this.doUpdate()},getVirtualColumns:function(t){return this.virtualColumns},isFixedRowHeight:function(){return this.fixedRowHeight||this.virtualScroll},isVirtualScroll:function(){return!!this.virtualScroll&&(0==this.isAutoHeight()&&0==this.isGrouping())},_getScrollView:function(){return this.getVisibleRows()},_getScrollViewCount:function(){return this._getScrollView().length},_getScrollRowHeight:function(t,e){if(e&&e._height){var i=parseInt(e._height);if(!isNaN(i))return i}return this.defaultRowHeight},_getRangeHeight:function(t,e){return(e-t)*this.defaultRowHeight},_getIndexByScrollTop:function(t){return parseInt(t/this.defaultRowHeight)},__getScrollViewRange:function(t,e){return this._getScrollView().getRange(t,e)},_getColumnByScrollLeft:function(t){for(var e=0,i=this.getUnFrozenColumns(),n=i.length,s=0,o=n;s<o;s++){var r=i[s].pxWidth;if(isNaN(r)||(e+=r),t<=e)return s}return n},_getRangeWidth:function(t,e){for(var i=0,n=this.getUnFrozenColumns(),s=t;s<e;s++){var o=n[s];if(o){var r=o.pxWidth;isNaN(r)||(i+=r)}}return i},_getColumnAllWidth:function(){for(var t=0,e=this.getUnFrozenColumns(),i=0,n=e.length;i<n;i++){var s=e[i].pxWidth;isNaN(s)||(t+=s)}return t},_getViewRegion:function(){var t,e=this._getScrollView();if(0==this.isVirtualScroll())return t={top:0,bottom:0,rows:e,start:0,end:0};this.defaultRowHeight;for(var i=this._getViewNowRegion(),n=(this.getScrollTop(),this._vscrollEl.offsetHeight,this._getScrollViewCount()),s=i.start,o=i.end,r=0,l=n;r<l;r+=this.virtualRows){var a=r+this.virtualRows;r<=s&&s<a&&(s=r),r<o&&o<=a&&(o=a)}if(n<o&&(o=n),0==o&&(o=this.virtualRows),(t={top:this._getRangeHeight(0,s),bottom:this._getRangeHeight(o,this._getScrollViewCount()),rows:e=this.__getScrollViewRange(s,o),start:s,end:o,viewStart:s,viewEnd:o}).viewTop=this._getRangeHeight(0,t.viewStart),t.viewBottom=this._getRangeHeight(t.viewEnd,this._getScrollViewCount()),this.virtualColumns){var h=this.getScrollLeft(),u=this._rowsViewEl.offsetWidth;t.startColumn=this._getColumnByScrollLeft(h),t.endColumn=this._getColumnByScrollLeft(h+u),t.columns=this.getUnFrozenColumns().slice(t.startColumn,t.endColumn+1),t.right=this._getColumnAllWidth(),t.viewLeft=this._getRangeWidth(0,t.startColumn)}else t.columns=this.getUnFrozenColumns();return t},_getViewNowRegion:function(){this.defaultRowHeight;var t=this.getScrollTop(),e=this._rowsViewEl.offsetHeight,i=this._getIndexByScrollTop(t),n=this._getIndexByScrollTop(t+e+30),s=this._getScrollViewCount();return s<n&&(n=s),{start:i,end:n}},_canVirtualUpdate:function(){if(!this._viewRegion)return!0;var t=this._getViewNowRegion();return!(this._viewRegion.start<=t.start&&t.end<=this._viewRegion.end)},__OnColumnsChanged:function(t){this.columns=this._columnModel.columns,this._doUpdateFilterRow(),this._doUpdateSummaryRow(),0==this.getVisibleRows().length?this.doUpdate():this.deferUpdate(),this.isVirtualScroll()&&this.__OnVScroll(),this.fire("columnschanged")},doLayout:function(){0!=this.canLayout()&&(mini.ScrollGridView.superclass.doLayout.call(this),this._layoutScroll(),mini.isNumber(this._scrollTop)&&this._vscrollEl.scrollTop!=this._scrollTop&&(this._vscrollEl.scrollTop=this._scrollTop))},_createRowsHTML:function(t,e,i,n,s,o){var r=this.isVirtualScroll();if(!r)return mini.ScrollGridView.superclass._createRowsHTML.apply(this,arguments);r&&this._viewRegion;var l=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0" >'];if(l.push(this._createTopRowHTML(t)),this.isVirtualScroll()){var a=0==n?"display:none;":"";l.push('<tr class="mini-grid-virtualscroll-top" style="padding:0;border:0;'+a+'"><td colspan="'+t.length+'" style="height:'+n+"px;padding:0;border:0;"+a+'"></td></tr>')}new Date;if(1==e&&0==this.isFrozen());else for(var h=0,u=i.length;h<u;h++){var d=i[h];this._createRowHTML(d,o,t,e,l),o++}return this.isVirtualScroll()&&l.push('<tr class="mini-grid-virtualscroll-bottom" style="padding:0;border:0;"><td colspan="'+t.length+'" style="height:'+s+'px;padding:0;border:0;"></td></tr>'),l.push("</table>"),l.join("")},doUpdateRows:function(){if(0!=this.isVirtualScroll()){var t=this._getViewRegion();this._viewRegion=t;var e=this.getFrozenColumns(),i=t.columns,n=t.viewStart;t.start,t.viewEnd;if(this._scrollPaging){var s=this.getPageIndex()*this.getPageSize();n-=s,s,s}var o=this._createRowsHTML(e,1,t.rows,t.viewTop,t.viewBottom,n),r=this._createRowsHTML(i,2,t.rows,t.viewTop,t.viewBottom,n);this._rowsLockContentEl.innerHTML=o,this._rowsViewContentEl.innerHTML=r;var l=this._rowsViewContentEl.firstChild;if(this.virtualColumns){r='<div style="position:absolute;top:0px;left:'+t.right+'px;width:1px;height:1px;overflow:hidden;"></div>';jQuery(r).appendTo(this._rowsViewContentEl),l.style.width="0px",l.style.position="absolute",l.style.top="0px",l.style.left=t.viewLeft+"px"}var a=this.getScrollTop();this._rowsViewEl.scrollTop!=a&&this._syncScrollOffset(null,a)}else mini.ScrollGridView.superclass.doUpdateRows.call(this)},_create:function(){mini.ScrollGridView.superclass._create.call(this),this._vscrollEl=mini.append(this._rowsEl,'<div class="mini-grid-vscroll"><div class="mini-grid-vscroll-content"></div></div>'),this._vscrollContentEl=this._vscrollEl.firstChild},_initEvents:function(){mini.ScrollGridView.superclass._initEvents.call(this);var e=this;mini.on(this._vscrollEl,"scroll",this.__OnVScroll,this),mini._onScrollDownUp(this._vscrollEl,function(t){e._VScrollMouseDown=!0},function(t){e._VScrollMouseDown=!1})},_layoutScroll:function(){var t=this.isVirtualScroll();if(t){var e=this.getScrollHeight(),i=e>this._rowsViewEl.offsetHeight;if(t&&i?(this._vscrollEl.style.display="block",this._vscrollContentEl.style.height=e+"px"):this._vscrollEl.style.display="none",this._rowsViewEl.scrollWidth>this._rowsViewEl.clientWidth+1){var n=this.getBodyHeight(!0)-18;n<0&&(n=0),this._vscrollEl.style.height=n+"px"}else this._vscrollEl.style.height="100%"}else this._vscrollEl.style.display="none"},getScrollHeight:function(){var t=this.getVisibleRows();return this._getRangeHeight(0,t.length)},setScrollTop:function(t){this.isVirtualScroll()?this._vscrollEl.scrollTop=t:this._rowsViewEl.scrollTop=t},getScrollTop:function(){return this.isVirtualScroll()?this._vscrollEl.scrollTop:this._rowsViewEl.scrollTop},__OnVScroll:function(t){if(this.isVirtualScroll()){this._scrollTop=this._vscrollEl.scrollTop;var e=this;setTimeout(function(){e._syncScrollOffset(null,e._scrollTop),e.__scrollTimer=null},8),this._scrollTopTimer&&clearTimeout(this._scrollTopTimer),this._scrollTopTimer=setTimeout(function(){e._scrollTopTimer=null,e._tryUpdateScroll(),e._syncScrollOffset(null,e._scrollTop)},150)}},wheelIncrement:0,setWheelIncrement:function(t){this.wheelIncrement=t},getWheelIncrement:function(){return this.wheelIncrement},__OnMouseWheel:function(t){var e=t.wheelDelta?t:t.originalEvent,i=e.wheelDelta||40*-e.detail;0<i?i+=this.wheelIncrement:i-=this.wheelIncrement;var n=this.getScrollTop()-i,s=this.getScrollTop();this.setScrollTop(n),s==this.getScrollTop()&&!this.isVirtualScroll()||t.preventDefault()},_tryUpdateScroll:function(){if(this._canVirtualUpdate())if(this._scrollPaging){this.reload(null,null,function(t){})}else{new Date;var t=this._rowsViewEl.scrollLeft;this._doRemoveRowContent(),this.doUpdateRows(),this.deferLayout(50),this._syncScrollOffset(t)}},_updateScrollTop:function(t){this._syncScrollOffset(null,t),this._tryUpdateScroll()},__OnRowViewScroll:function(t){this._syncScroll(),this.virtualColumns&&this.doVirtualColumns()},doVirtualColumns:function(){var t=this;t._virtualColumnTimer&&(clearTimeout(t._virtualColumnTimer),t._virtualColumnTimer=null),t._virtualColumnTimer=setTimeout(function(){t._virtualColumnTimer=null,t._doRemoveRowContent(),t.doUpdateRows(),t.deferLayout(50)},500)}}),mini.regClass(mini.ScrollGridView,"ScrollGridView"),mini._onScrollDownUp=function(t,e,i){function n(t){mini.un(document,"mousemove",n),i(t)}function s(t){mini.un(document,"mouseup",s),i(t)}mini.on(t,"mousedown",function(t){mini.isFirefox?mini.on(document,"mouseup",s):mini.on(document,"mousemove",n),e(t)})},mini.mousewheelEditable=!1,mini._Grid_Select=function(t){this.owner=t,el=t.el,t.on("rowmousemove",this.__OnRowMouseMove,this),mini.on(t._viewportEl,"mouseout",this.__OnMouseOut,this),mini.on(t._viewportEl,"mousewheel",this.__OnMouseWheel,this),mini.on(document,"mousewheel",this.__OnMouseWheel,this),t.on("cellmousedown",this.__OnCellMouseDown,this),t.on("cellmouseup",this.__OnGridCellClick,this),t.on("celldblclick",this.__OnGridCellClick,this),mini.on(t.el,"keydown",this.__OnGridKeyDown,this),jQuery(t._columnsEl).on("mouseenter",".mini-grid-headerCell",function(t){jQuery(t.currentTarget).addClass("mini-grid-header-over")}),jQuery(t._columnsEl).on("mouseleave",".mini-grid-headerCell",function(t){jQuery(t.currentTarget).removeClass("mini-grid-header-over")})},mini._Grid_Select.prototype={__OnGridKeyDown:function(t){var e=this.owner,i=mini.findParent(t.target,"mini-grid-detailRow"),n=!!i&&mini.isAncestor(e.el,i);if(!(mini.isAncestor(e._filterEl,t.target)||mini.isAncestor(e._summaryEl,t.target)||mini.isAncestor(e._toolbarEl,t.target)||mini.isAncestor(e._footerEl,t.target)||mini.findParent(t.target,"mini-grid-detailRow")&&n||mini.findParent(t.target,"mini-grid-rowEdit")||mini.findParent(t.target,"mini-tree-editinput"))){var s=e.getCurrentCell();if(!(t.shiftKey||t.ctrlKey||t.altKey)){37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode||t.preventDefault();var o=e.getVisibleColumns(),r=s?s[1]:null,l=s?s[0]:null;s||(l=e.getCurrent());var a,h,u=o.indexOf(r),d=(a=l,e.getVisibleRows().indexOf(a)),c=e.getVisibleRows().length;switch(t.keyCode){case 9:if(e.allowCellEdit&&e.editOnTabKey)return t.preventDefault(),void e._beginEditNextCell(0==t.shiftKey,!0);break;case 27:break;case 13:if(e.allowCellEdit&&e.editNextOnEnterKey&&r&&(e.isEditingCell(s)||!r.editor))return void e._beginEditNextCell(0==t.shiftKey);e.allowCellEdit&&s&&!r.readOnly&&!e.isReadOnly()&&e.beginEditCell();break;case 37:r?0<u&&(u-=1):u=0;break;case 38:l?0<d&&(d-=1):d=0,0!=d&&e.isVirtualScroll();break;case 39:r?u<o.length-1&&(u+=1):u=0;break;case 40:l?d<c-1&&(d+=1):d=0;break;default:return}if(r=o[u],h=d,l=e.getVisibleRows()[h],r&&l&&e.allowCellSelect){s=[l,r];e.setCurrentCell(s),e.scrollIntoView(l,r,!1)}if(!e.onlyCheckSelection&&37!=t.keyCode&&39!=t.keyCode&&l&&e.allowRowSelect){var m={record:l,selected:l,cancel:!1,htmlEvent:t};if(l&&(e.fire("beforerowselect",m),e.fire("beforeselect",m)),m.cancel)return;e.deselectAll(),e.setCurrent(l),l&&e.scrollIntoView(l,null,!1)}}}},__OnMouseWheel:function(t){var e=this.owner;if(t.stopPropagation(),!mini.mousewheelEditable){var i=e._editingControl;i&&i.within(t)||e.allowCellEdit&&e.commitEdit()}},__OnGridCellClick:function(t){var e=this.owner,i=t.type;new Date;if("cellmouseup"==i&&(i="cellclick"),0!=e.allowCellEdit&&e.cellEditAction==i){t.record;t.column.readOnly||e.isReadOnly()||t.htmlEvent.shiftKey||t.htmlEvent.ctrlKey||e.beginEditCell()}},__OnCellMouseDown:function(t){var e=this;!e.owner.selectOnRightClick&&3==t.htmlEvent.which||setTimeout(function(){e.__doSelect(t)},1)},__OnRowMouseMove:function(t){var e=this.owner,i=t.record;e.enabled&&0!=e.enableHotTrack&&e.focusRow(i)},__OnMouseOut:function(t){this.owner.allowHotTrackOut&&this.owner.focusRow(null)},__doSelect:function(t){var e=t.record,i=t.column,n=this.owner;if(!1!==e.enabled){if(n.allowCellSelect){var s=[e,i];n.setCurrentCell(s)}if((!n.onlyCheckSelection||i._multiRowSelect)&&n.allowRowSelect){var o={record:e,selected:e,cancel:!1,htmlEvent:t};if(e&&(n.isSelected(e)||(n.fire("beforerowselect",o),n.fire("beforeselect",o))),o.cancel)return;if(n.getMultiSelect())if(n.el.onselectstart=function(){},t.htmlEvent.shiftKey){n.el.onselectstart=function(){return!1};try{t.htmlEvent.preventDefault()}catch(o){}var r=n.getCurrent();r?(n.deselectAll(),n.selectRange(r,e),n.setCurrent(r)):(n.select(e),n.setCurrent(e))}else{if(n.el.onselectstart=function(){},t.htmlEvent.ctrlKey){n.el.onselectstart=function(){return!1};try{t.htmlEvent.preventDefault()}catch(o){}}!0===t.column._multiRowSelect||t.htmlEvent.ctrlKey||n.allowUnselect?n.isSelected(e)?n.deselect(e):(n.select(e),n.setCurrent(e)):n.isSelected(e)||(n.deselectAll(),n.select(e),n.setCurrent(e))}else n.isSelected(e)?(t.htmlEvent.ctrlKey||n.allowUnselect)&&n.deselectAll():(n.deselectAll(),n.select(e))}}}},mini._Grid_RowGroup=function(t){this.owner=t,el=t.el,mini.on(t._bodyEl,"click",this.__OnClick,this)},mini._Grid_RowGroup.prototype={__OnClick:function(t){var e=this.owner,i=e._getRowGroupByEvent(t);if(i){if(!e.groupTitleCollapsible&&!mini.hasClass(t.target,"mini-grid-group-ecicon"))return;var n={htmlEvent:t,cancel:!1,group:i};if(e.fire("beforegroupclick",n),!0===n.cancel)return;e.toggleRowGroup(i)}}},mini._Grid_ColumnsMenu=function(t){this.owner=t,this.menu=this.createMenu(),mini.on(t.el,"contextmenu",this.__OnContextMenu,this),t.on("destroy",this.__OnGridDestroy,this)},mini._Grid_ColumnsMenu.prototype={__OnGridDestroy:function(t){this.menu&&this.menu.destroy(),this.menu=null},createMenu:function(){var t=mini.create({type:"menu",hideOnClick:!1});return t.on("itemclick",this.__OnItemClick,this),jQuery(t.el).addClass("mini-menu-open"),t},updateMenu:function(){for(var t=this.owner,e=this.menu,i=t.getBottomColumns(),n=[],s=0,o=i.length;s<o;s++){var r=i[s];if(!r.hideable){var l={};l.checked=r.visible,l.checkOnClick=!0,l.text=t._createHeaderText(r),"&nbsp;"==l.text&&("indexcolumn"==r.type&&(l.text=""),"checkcolumn"==r.type&&(l.text="")),n.push(l),l.enabled=r.enabled,l._column=r}}e.setItems(n)},__OnContextMenu:function(t){var e=this.owner;if(0!=e.showColumnsMenu&&0!=mini.isAncestor(e._columnsEl,t.target))return this.updateMenu(),this.menu.showAtPos(t.pageX,t.pageY),!1},__OnItemClick:function(t){for(var e=this.owner,i=this.menu,n=(e.getBottomColumns(),i.getItems()),s=t.item,o=s._column,r=0,l=0,a=n.length;l<a;l++){n[l].getChecked()&&r++}r<1&&s.setChecked(!0),s.getChecked()?e.showColumn(o):e.hideColumn(o)}},mini._Grid_CellToolTip=function(t){this.owner=t,mini.on(this.owner.el,"mousemove",this.__OnGridMouseMove,this)},mini._Grid_CellToolTip.prototype={__OnGridMouseMove:function(t){var i=this.owner;if(mini.hasClass(t.target,"mini-grid-headerCell-inner")){if((s=t.target).scrollWidth>s.clientWidth){var e=s.innerText||s.textContent||"";s.title=e.trim()}else s.title=""}else{var n=i._getCellByEvent(t),s=i._getCellEl(n[0],n[1]),o=i.getCellError(n[0],n[1]);if(s){if(o)return void setTimeout(function(){s.title=o.errorText},10);setTimeout(function(){var t=s;if(s.firstChild&&(mini.hasClass(s.firstChild,"mini-grid-cell-inner")&&(t=s.firstChild),mini.hasClass(s.firstChild,"mini-tree-nodetitle")&&(t=s.firstChild)),t.scrollWidth>t.clientWidth&&i.getShowCellTip()&&n[1].showCellTip){var e=t.innerText||t.textContent||"";s.title=e.trim()}else s.title=""},10)}}}},mini._Grid_Sorter=function(t){this.owner=t,this.owner.on("headercellclick",this.__OnGridHeaderCellClick,this),this.owner.on("headercelldblclick",this.__OnGridHeaderCellClick,this),mini.on(t._headerEl,"mousemove",this.__OnGridHeaderMouseMove,this),mini.on(t._headerEl,"mouseout",this.__OnGridHeaderMouseOut,this)},mini._Grid_Sorter.prototype={__OnGridHeaderMouseOut:function(t){this._focusedColumnEl&&mini.removeClass(this._focusedColumnEl,"mini-grid-headerCell-hover")},__OnGridHeaderMouseMove:function(t){var e=mini.findParent(t.target,"mini-grid-headerCell");e&&(mini.addClass(e,"mini-grid-headerCell-hover"),this._focusedColumnEl=e)},__OnGridHeaderCellClick:function(t){var e=this.owner,i=t.htmlEvent.type;if(("dblclick"!=i||e.sortDblClick)&&("click"!=i||!e.sortDblClick)&&mini.hasClass(t.htmlEvent.target,"mini-grid-headerCell-inner")&&e.allowSortColumn&&0==e.isEditing()){var n=t.column;if(!n.columns||0==n.columns.length){var s=n.sortField||n.field;if(s&&!1!==n.allowSort)if(e.allowCancelSort&&"desc"==e.getSortOrder())e.clearSort();else{var o="asc";e.getSortField()==s&&(o="asc"==e.getSortOrder()?"desc":"asc"),e.sortBy(s,o)}}}}},mini._Grid_ColumnMove=function(t){this.owner=t,mini.on(this.owner.el,"mousedown",this.__onGridMouseDown,this)},mini._Grid_ColumnMove.prototype={__onGridMouseDown:function(t){var e=this.owner;if(!e.isEditing()&&!mini.hasClass(t.target,"mini-grid-column-splitter")&&t.button!=mini.MouseButton.Right){var i=mini.findParent(t.target,e._headerCellCls);if(i){this._remove();var n=e._getColumnByEvent(t);e.allowMoveColumn&&n&&n.allowMove&&(this.dragColumn=n,this._columnEl=i,this.getDrag().start(t))}}},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!1,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){var e,i,n=this.owner;this._dragProxy=mini.append(document.body,'<div class="mini-grid-columnproxy"></div>'),this._dragProxy.innerHTML='<div class="mini-grid-columnproxy-inner" style="height:26px;">'+(e=this.dragColumn,"function"==typeof(i=e.header)&&(i=i.call(n,e)),!mini.isNull(i)&&""!==i||(i="&nbsp;"),i)+"</div>",mini.setXY(this._dragProxy,t.now[0]+15,t.now[1]+18),mini.addClass(this._dragProxy,"mini-grid-no"),this.moveTop=mini.append(document.body,'<div class="mini-grid-movetop"></div>'),this.moveBottom=mini.append(document.body,'<div class="mini-grid-movebottom"></div>')},_OnDragMove:function(t){var e=this.owner,i=t.now[0];if(mini.setXY(this._dragProxy,i+15,t.now[1]+18),this.targetColumn=this.insertAction=null,mini.findParent(t.event.target,e._headerCellCls)){var n=e._getColumnByEvent(t.event);if(n&&n!=this.dragColumn)if(e.getParentColumn(this.dragColumn)==e.getParentColumn(n)){this.targetColumn=n,this.insertAction="before";var s=e.getColumnBox(this.targetColumn);i>s.x+s.width/2&&(this.insertAction="after")}}if(this.targetColumn){mini.addClass(this._dragProxy,"mini-grid-ok"),mini.removeClass(this._dragProxy,"mini-grid-no");var o=e.getColumnBox(this.targetColumn);this.moveTop.style.display="block",this.moveBottom.style.display="block","before"==this.insertAction?(mini.setXY(this.moveTop,o.x-4,o.y-9),mini.setXY(this.moveBottom,o.x-4,o.bottom)):(mini.setXY(this.moveTop,o.right-4,o.y-9),mini.setXY(this.moveBottom,o.right-4,o.bottom))}else mini.removeClass(this._dragProxy,"mini-grid-ok"),mini.addClass(this._dragProxy,"mini-grid-no"),this.moveTop.style.display="none",this.moveBottom.style.display="none"},_remove:function(){this.owner;mini.removeNode(this._dragProxy),mini.removeNode(this.moveTop),mini.removeNode(this.moveBottom),this._dragProxy=this.moveTop=this.moveBottom=this.dragColumn=this.targetColumn=null},_OnDragStop:function(t){this.owner.moveColumn(this.dragColumn,this.targetColumn,this.insertAction),this._remove()}},mini._Grid_ColumnSplitter=function(t){this.owner=t,mini.on(t.el,"mousedown",this.__OnMouseDown,this)},mini._Grid_ColumnSplitter.prototype={__OnMouseDown:function(t){var e=this.owner,i=t.target;if(mini.hasClass(i,"mini-grid-column-splitter")){var n=e._getColumnById(i.id);if(e.isEditing())return;e.allowResizeColumn&&n&&n.allowResize&&(this.splitterColumn=n,this.getDrag().start(t))}},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!0,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){var e=this.owner,i=e.getColumnBox(this.splitterColumn);this.columnBox=i,this._dragProxy=mini.append(document.body,'<div class="mini-grid-proxy"></div>');var n=e.getGridViewBox();n.x=i.x,n.width=i.width,n.right=i.right,mini.setBox(this._dragProxy,n),e._ignoreClick=!0},_OnDragMove:function(t){var e=this.owner,i=mini.copyTo({},this.columnBox).width+(t.now[0]-t.init[0]);i<e.columnMinWidth&&(i=e.columnMinWidth),i>e.columnMaxWidth&&(i=e.columnMaxWidth),mini.setWidth(this._dragProxy,i)},_OnDragStop:function(t){var e=this.owner,i=mini.getBox(this._dragProxy),n=this,s=e.allowSortColumn;e.allowSortColumn=!1,setTimeout(function(){jQuery(n._dragProxy).remove(),n._dragProxy=null,e.allowSortColumn=s},10);var o=this.splitterColumn,r=parseInt(o.width);if(r+"%"!=o.width){var l=e.getColumnWidth(o),a=parseInt(r/l*i.width);a<e.columnMinWidth&&(a=e.columnMinWidth),e.setColumnWidth(o,a)}setTimeout(function(){e._ignoreClick=!1},100)}},mini._Grid_DragDrop=function(t){this.owner=t,this.owner.on("CellMouseDown",this.__OnGridCellMouseDown,this)},mini._Grid_DragDrop.prototype={__OnGridCellMouseDown:function(t){if(t.htmlEvent.button!=mini.MouseButton.Right){var e=this.owner;if(!e._dragging&&(this.dropObj=e,!mini.findParent(t.htmlEvent.target,"mini-tree-editinput")&&!e.isReadOnly()&&0!=e.isAllowDrag(t.record,t.column))){var i=e._OnDragStart(t.record,t.column);if(!i.cancel){this.dragText=i.dragText;var n=t.record;this.isTree=!!e.isTree,this.beginRecord=n,this._getDrag().start(t.htmlEvent)}}}},_OnDragStart:function(t){var e=this.owner;e._dragging=!0;var i=this.beginRecord;this.dragData=e._getDragData(),-1==this.dragData.indexOf(i)&&this.dragData.push(i),this.feedbackEl=mini.append(document.body,'<div class="mini-feedback"></div>'),this.feedbackEl.innerHTML=this.dragText,this.lastFeedbackClass="",this.enableHotTrack=e.getEnableHotTrack(),e.setEnableHotTrack(!1)},_getDropTargetObj:function(t){var e=mini.findParent(t.target,"mini-grid",500);if(e)return mini.get(e)},_OnDragMove:function(t){this.owner;var e=this._getDropTargetObj(t.event);this.dropObj=e;var i=t.now[0],n=t.now[1];if(mini.setXY(this.feedbackEl,i+15,n+18),e&&e.allowDrop){this.isTree=e.isTree;var s=e._getRecordByEvent(t.event);(this.dropRecord=s)?this.isTree?this.dragAction=this.getFeedback(s,n,3):this.dragAction=this.getFeedback(s,n,2):this.dragAction="no"}else this.dragAction="no";e&&e.allowDrop&&!s&&0==e.getData().length&&(this.dragAction="add"),this.lastFeedbackClass="mini-feedback-"+this.dragAction,this.feedbackEl.className="mini-feedback "+this.lastFeedbackClass,"no"==this.dragAction&&(s=null),this.setRowFeedback(s,this.dragAction)},_OnDragStop:function(t){var e=this.owner,i=this.dropObj;if(e._dragging=!1,mini.removeNode(this.feedbackEl),e.setEnableHotTrack(this.enableHotTrack),this.feedbackEl=null,this.setRowFeedback(null),this.isTree){for(var n=[],s=0,o=this.dragData.length;s<o;s++){for(var r=this.dragData[s],l=!1,a=0,h=this.dragData.length;a<h;a++){var u=this.dragData[a];if(u!=r&&(l=e.isAncestor(u,r)))break}l||n.push(r)}this.dragData=n}if(("add"!=this.dragAction||this.dropRecord||(this.dropRecord=i.getRootNode?i.getRootNode():{__root:!0}),this.dropRecord&&i&&"no"!=this.dragAction)&&!(f=i._OnDragDrop(this.dragData,this.dropRecord,this.dragAction)).cancel){n=f.dragNodes;var d=f.targetNode,c=f.action;if(i.isTree)e==i?i.moveNodes(n,d,c):("move"==i.dropAction?e.removeNodes(n):"copy"==i.dropAction&&(n=mini.clone(n)),i.addNodes(n,d,c));else{var m=i.indexOf(d);"after"==c&&(m+=1),e==i?i.moveRow(n,m):("move"==i.dropAction?e.removeRows(n):"copy"==i.dropAction&&(n=mini.clone(n)),"add"==this.dragAction?i.addRows(n):i.addRows(n,m))}var f={dragNode:f.dragNodes[0],dropNode:f.targetNode,dragAction:f.action,dragNodes:f.dragNodes,targetNode:f.targetNode};i.fire("drop",f)}this.dropRecord=null,this.dragData=null},setRowFeedback:function(t,e){this.owner;var i=this.dropObj;if(this.lastAddDomRow&&i&&i.removeRowCls(this.lastAddDomRow,"mini-tree-feedback-add"),null!=t&&"add"!=this.dragAction||(mini.removeNode(this.feedbackLine),this.feedbackLine=null),null!=(this.lastRowFeedback=t))if("before"==e||"after"==e){this.feedbackLine||(this.feedbackLine=mini.append(document.body,"<div class='mini-feedback-line'></div>")),this.feedbackLine.style.display="block";var n=i.getRowBox(t),s=n.x,o=n.y-1;"after"==e&&(o+=n.height),mini.setXY(this.feedbackLine,s,o);var r=i.getBox(!0);mini.setWidth(this.feedbackLine,r.width)}else i.addRowCls(t,"mini-tree-feedback-add"),this.lastAddDomRow=t},getFeedback:function(t,e,i){var n=this.owner,s=this.dropObj,o=s.getRowBox(t),r=o.height,l=e-o.y,a=null;if(-1!=this.dragData.indexOf(t))return"no";var h=!1;if(3==i){h=s.isLeaf(t);for(var u=0,d=this.dragData.length;u<d;u++){var c=this.dragData[u];if(s.isAncestor(c,t)){a="no";break}}}return null==a&&(a=2==i?r/2<l?"after":"before":h&&!1===s.allowLeafDropIn?r/2<l?"after":"before":r/3*2<l?"after":r/3<=l&&l<=r/3*2?"add":"before"),s._OnGiveFeedback(a,this.dragData,t,n).effect},_getDrag:function(){return this.drag||(this.drag=new mini.Drag({onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag}},mini._Grid_Events=function(t){this.owner=t,el=t.el,mini.on(el,"click",this.__OnClick,this),mini.on(el,"dblclick",this.__OnDblClick,this),mini.on(el,"mousedown",this.__OnMouseDown,this),mini.on(el,"mouseup",this.__OnMouseUp,this),mini.on(el,"mousemove",this.__OnMouseMove,this),mini.on(el,"mouseover",this.__OnMouseOver,this),mini.on(el,"mouseout",this.__OnMouseOut,this),mini.on(el,"keydown",this.__OnKeyDown,this),mini.on(el,"keyup",this.__OnKeyUp,this),mini.on(el,"contextmenu",this.__OnContextMenu,this),t.on("rowmousemove",this.__OnRowMouseMove,this),mini.on(window,"resize",this.__windowResize,this)},mini._Grid_Events.prototype={__windowResize:function(){var n=this.owner;setTimeout(function(){!function(){var t=n._getEditingControl();if(t){var e=n.getCurrentCell(),i=n.getCellBox(e[0],e[1]);n._getEditWrap(i,t),n._setEditorBox(t,i)}}()},100)},_row:null,__OnRowMouseMove:function(t){var e=this.owner,i=t.record;this._row!=i&&(t.record=i,t.row=i,e.fire("rowmouseenter",t)),this._row=i},__OnClick:function(t){this.owner._ignoreClick||this._fireEvent(t,"Click")},__OnDblClick:function(t){this._fireEvent(t,"Dblclick")},__OnMouseDown:function(e){var i=this.owner;if(!mini.findParent(e.target,"mini-tree-editinput")&&!mini.findParent(e.target,"mini-tree-node-ecicon")){this._fireEvent(e,"MouseDown");var t=300;"a"==e.target.tagName.toLowerCase()&&e.target.href&&(t=10),setTimeout(function(){!function(){var t=mini.findParent(e.target,"mini-grid-detailRow");mini.isAncestor(i.el,t)||i._editingCell||i._tryFocus(e)}()},t)}},__OnMouseUp:function(t){if(!mini.findParent(t.target,"mini-tree-editinput")&&!mini.findParent(t.target,"mini-tree-node-ecicon")&&!mini.findParent(t.target,"mini-tree-checkbox")){var e=this.owner;mini.isAncestor(e.el,t.target)&&this._fireEvent(t,"MouseUp")}},__OnMouseMove:function(t){this._fireEvent(t,"MouseMove")},__OnMouseOver:function(t){this._fireEvent(t,"MouseOver")},__OnMouseOut:function(t){this._fireEvent(t,"MouseOut")},__OnKeyDown:function(t){this._fireEvent(t,"KeyDown")},__OnKeyUp:function(t){this._fireEvent(t,"KeyUp")},__OnContextMenu:function(t){this._fireEvent(t,"ContextMenu")},_fireEvent:function(t,e){var i=this.owner,n=i._getCellByEvent(t),s=n[0],o=n[1];if(s){var r={record:s,row:s,htmlEvent:t};(l=i["_OnRow"+e])?l.call(i,r):i.fire("row"+e,r)}if(o){r={column:o,field:o.field,htmlEvent:t};(l=i["_OnColumn"+e])?l.call(i,r):i.fire("column"+e,r)}if(s&&o){r={sender:i,record:s,row:s,column:o,field:o.field,htmlEvent:t};(l=i["_OnCell"+e])?l.call(i,r):i.fire("cell"+e,r),o["onCell"+e]&&o["onCell"+e].call(o,r)}if(!s&&o&&mini.findParent(t.target,"mini-grid-headerCell")){var l;r={column:o,htmlEvent:t};if(l=i["_OnHeaderCell"+e])l.call(i,r);else{var a="onheadercell"+e.toLowerCase();o[a]&&(r.sender=i,o[a](r)),i.fire("headercell"+e,r)}}}},mini.DataGrid=function(t){mini.DataGrid.superclass.constructor.call(this,null),this._Events=new mini._Grid_Events(this),this._Select=new mini._Grid_Select(this),this._DragDrop=new mini._Grid_DragDrop(this),this._RowGroup=new mini._Grid_RowGroup(this),this._Splitter=new mini._Grid_ColumnSplitter(this),this._ColumnMove=new mini._Grid_ColumnMove(this),this._Sorter=new mini._Grid_Sorter(this),this._CellToolTip=new mini._Grid_CellToolTip(this),this._ColumnsMenu=new mini._Grid_ColumnsMenu(this),this._createPagers(),t&&mini.applyTo.call(this,t)},mini.extend(mini.DataGrid,mini.ScrollGridView,{uiCls:"mini-datagrid",selectOnLoad:!1,showHeader:!1,showPager:!0,validateOnAdd:!1,getValidateOnAdd:function(){return this.validateOnAdd},setValidateOnAdd:function(t){this.validateOnAdd=t},dropAction:"move",onlyCheckSelection:!1,_$onlyCheckSelection:!0,allowUnselect:!1,allowRowSelect:!0,allowCellSelect:!1,allowCellEdit:!1,cellEditAction:"cellclick",allowCellValid:!1,allowResizeColumn:!0,allowSortColumn:!0,allowMoveColumn:!0,showColumnsMenu:!1,virtualScroll:!1,enableHotTrack:!0,allowHotTrackOut:!0,showLoading:!0,columnMinWidth:8,_expandLoad:function(){},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.url;delete t.url;var n=t.data;delete t.data;var s=t.columns;delete t.columns;var o=t.defaultColumnWidth;return delete t.defaultColumnWidth,o&&this.setDefaultColumnWidth(o),mini.isNull(s)||this.setColumns(s),mini.DataGrid.superclass.set.call(this,t),mini.isNull(n)||this.setData(n),mini.isNull(i)||this.setUrl(i),mini.isNull(e)||this.setValue(e),this},doUpdate:function(){this._destroyEditors(),mini.DataGrid.superclass.doUpdate.apply(this,arguments)},_destroyEditors:function(){for(var t=mini.getChildControls(this),e=[],i=0,n=t.length;i<n;i++){var s=t[i];s.el&&mini.findParent(s.el,this._rowCls)&&(e.push(s),s.destroy())}},_OnDrawCell:function(){return mini.DataGrid.superclass._OnDrawCell.apply(this,arguments)},_bindSource:function(){var t=this._dataSource;t.on("beforeload",this.__OnSourceBeforeLoad,this),t.on("preload",this.__OnSourcePreLoad,this),t.on("load",this.__OnSourceLoadSuccess,this),t.on("loaderror",this.__OnSourceLoadError,this),t.on("loaddata",this.__OnSourceLoadData,this),t.on("cleardata",this.__OnSourceClearData,this),t.on("sort",this.__OnSourceSort,this),t.on("filter",this.__OnSourceFilter,this),t.on("pageinfochanged",this.__OnPageInfoChanged,this),t.on("selectionchanged",this.__OnSelectionChanged,this),t.on("currentchanged",function(t){this.fire("currentchanged",t)},this),t.on("add",this.__OnSourceAdd,this),t.on("update",this.__OnSourceUpdate,this),t.on("remove",this.__OnSourceRemove,this),t.on("move",this.__OnSourceMove,this),t.on("beforeadd",function(t){this.fire("beforeaddrow",t)},this),t.on("beforeupdate",function(t){this.fire("beforeupdaterow",t)},this),t.on("beforeremove",function(t){this.fire("beforeremoverow",t)},this),t.on("beforemove",function(t){this.fire("beforemoverow",t)},this),t.on("beforeselect",function(t){this.fire("beforeselect",t)},this),t.on("beforedeselect",function(t){this.fire("beforedeselect",t)},this),t.on("select",function(t){this.fire("select",t)},this),t.on("deselect",function(t){this.fire("deselect",t)},this)},_getMaskWrapEl:function(){return this.el},_initData:function(){this.data=this._dataSource.getSource(),this.pageIndex=this.getPageIndex(),this.pageSize=this.getPageSize(),this.totalCount=this.getTotalCount(),this.totalPage=this.getTotalPage(),this.sortField=this.getSortField(),this.sortOrder=this.getSortOrder(),this.url=this.getUrl(),this._mergedCellMaps={},this._mergedCells={},this._cellErrors=[],this._cellMapErrors={},this.isGrouping()&&(this.groupBy(this._groupField,this._groupDir),this.collapseGroupOnLoad&&this.collapseGroups())},__OnSourceBeforeLoad:function(t){this.fire("beforeload",t),1!=t.cancel&&this.showLoading&&this.loading()},__OnSourcePreLoad:function(t){this.fire("preload",t)},__OnSourceLoadSuccess:function(t){this.fire("load",t),this.unmask()},__OnSourceLoadError:function(t){this.fire("loaderror",t),this.unmask()},__OnSourceSort:function(t){this.deferUpdate(),this.fire("sort",t)},__OnSourceFilter:function(t){this.deferUpdate(),this.fire("filter",t)},__OnSourceAdd:function(t){this._doAddRowEl(t.record,t.index);var e=this;e._addTimer||(e._addTimer=setTimeout(function(){e._addTimer=null,e._doUpdateSummaryRow(),e._viewRegion=e._getViewRegion()},10)),this.fire("addrow",t)},__OnSourceUpdate:function(t){this._doUpdateRowEl(t.record),this._doUpdateSummaryRow(),this.fire("updaterow",t)},__OnSourceRemove:function(t){var e=this;this._doRemoveRowEl(t.record),e._toSummary||(e._toSummary=setTimeout(function(){e._toSummary=null,e._doUpdateSummaryRow()},10)),this.fire("removerow",t),this.isVirtualScroll()&&this.deferUpdate()},__OnSourceMove:function(t){this._doMoveRowEl(t.record,t.index),this._doUpdateSummaryRow(),this.fire("moverow",t)},__OnSelectionChanged:function(t){!1!==t.fireEvent&&(t.select?this.fire("rowselect",t):this.fire("rowdeselect",t));var e=this;this._selectionTimer&&(clearTimeout(this._selectionTimer),this._selectionTimer=null),this._selectionTimer=setTimeout(function(){e._selectionTimer=null,!1!==t.fireEvent&&e.fire("SelectionChanged",t),e.fire("_selectchange",t)},1);new Date;this._doRowSelect(t._records,t.select)},__OnPageInfoChanged:function(t){this._updatePagesInfo()},_updatePagesInfo:function(){for(var t=this.getPageIndex(),e=this.getPageSize(),i=this.getTotalCount(),n=(this.getTotalPage(),this._pagers),s=0,o=n.length;s<o;s++){var r=n[s];r.update(t,e,i),this._dataSource.totalPage=r.totalPage}},setPagerButtons:function(t){this._bottomPager.setButtons(t)},setPager:function(t){if("string"==typeof t){if(!mini.byId(t))return;mini.parse(t),t=mini.get(t)}t&&this.bindPager(t)},bindPager:function(t){t&&(this.unbindPager(t),this._pagers.add(t),t.on("beforepagechanged",this.__OnPageChanged,this))},unbindPager:function(t){t&&(this._pagers.remove(t),t.un("pagechanged",this.__OnPageChanged,this))},__OnPageChanged:function(t){t.cancel=!0,this.gotoPage(t.pageIndex,t.pageSize)},_canUpdateRowEl:!0,_doUpdateRowEl:function(t){var e,i,n=this.getFrozenColumns(),s=this.getUnFrozenColumns(),o=this.indexOf(t),r=this._createRowHTML(t,o,s,2);if(l=this._getRowEl(t,2)){if(jQuery(l).before(r),e=l.previousSibling,l&&l.parentNode.removeChild(l),this.isFrozen()){r=this._createRowHTML(t,o,n,1);var l=this._getRowEl(t,1);jQuery(l).before(r),i=l.previousSibling,jQuery(l).remove()}this.deferLayout(),e&&i&&this._doSyncRowHeight(e,i)}},_doAddRowEl:function(t,e){var i=this.getFrozenColumns(),n=this.getUnFrozenColumns(),s=this._rowsLockContentEl.firstChild,o=this._rowsViewContentEl.firstChild,r=mini.isNumber(e)?e:this.indexOf(t),l=this.getAt(r+1);function a(t,e,i,n){var s=this._createRowHTML(t,r,i,e);if(l){var o=this._getRowEl(l,e);jQuery(o).before(s)}else mini.append(n,s)}if(a.call(this,t,2,n,o),this.isFrozen()&&a.call(this,t,1,i,s),this.deferLayout(),this.showEmptyText){var h=jQuery(".mini-grid-emptyText",this._bodyEl)[0];h&&(h.style.display="none",h.parentNode.style.display="none")}},_doRemoveRowEl:function(t){var e=this._getRowEl(t,1),i=this._getRowEl(t,2);if(e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i),i){var n=this._getRowDetailEl(t,1),s=this._getRowDetailEl(t,2);if(n&&n.parentNode.removeChild(n),s&&s.parentNode.removeChild(s),this.deferLayout(),this.showEmptyText&&0==this.getVisibleRows().length){var o=jQuery(".mini-grid-emptyText",this._bodyEl)[0];o&&(o.style.display="",o.parentNode.style.display="")}}},_doMoveRowEl:function(t,e){this._doRemoveRowEl(t),this._doAddRowEl(t)},_getRowGroupEl:function(t,e){if(1==e&&!this.isFrozen())return null;var i=this._createRowGroupId(t,e);return mini.byId(i,this.el)},_getRowGroupRowsEl:function(t,e){if(1==e&&!this.isFrozen())return null;var i=this._createRowGroupRowsId(t,e);return mini.byId(i,this.el)},_getRowEl:function(t,e){if(null==e&&(e=2),1==e&&!this.isFrozen())return null;t=this.getRecord(t);var i=this._createRowId(t,e);return mini.byId(i,this.el)},_getHeaderCellEl:function(t,e){if(null==e&&(e=2),1==e&&!this.isFrozen())return null;t=this.getColumn(t);var i=this._createHeaderCellId(t,e);return mini.byId(i,this.el)},getRowEl:function(t,e){return this._getRowEl(t,e)},getHeaderCellEl:function(t,e){return this._getHeaderCellEl(t,e)},_getCellEl:function(t,e){if(t=this.getRecord(t),e=this.getColumn(e),!t||!e)return null;var i=this._createCellId(t,e);return mini.byId(i,this.el)},getCellEl:function(t,e){return this._getCellEl(t,e)},getRecordByEvent:function(t){return this._getRecordByEvent(t)},_getRecordByEvent:function(t){var e=mini.findParent(t.target,this._rowCls);if(!e)return null;var i=e.id.split("$"),n=i[i.length-1];return this._getRowByID(n)},getColumnByEvent:function(t){return t?this._getColumnByEvent(t):null},_getColumnByEvent:function(t){var e=mini.findParent(t.target,this._cellCls);if(e=e||mini.findParent(t.target,this._headerCellCls)){var i=e.id.split("$"),n=i[i.length-1];return this._getColumnById(n)}return null},_getCellByEvent:function(t){return[this._getRecordByEvent(t),this._getColumnByEvent(t)]},getColumnFromEvent:function(t){return t?this._getColumnByEvent(t):null},getCellFromEvent:function(t){return this._getCellByEvent(t)},getRowFromEvent:function(t){var e=this._getCellByEvent(t);return e?e[0]:null},getRowByEvent:function(t){return this.getRowFromEvent(t)},getColumnByEvent:function(t){return this.getColumnFromEvent(t)},getCellByEvent:function(t){return this.getCellFromEvent(t)},_getRowByID:function(t){return this._dataSource.getby_id(t)},_getColumnById:function(t){return this._columnModel._getColumnById(t)},hasRowCls:function(t,e){var i=this._rowClsHash[t._id];return!!i&&-1!=i.indexOf(e)},addRowCls:function(t,e,i){var n=this._getRowEl(t,1),s=this._getRowEl(t,2);if(n&&mini.addClass(n,e),s&&mini.addClass(s,e),t&&!1!==i){var o=this._rowClsHash[t._id];o?o.remove(e):o=this._rowClsHash[t._id]=[],o.push(e)}},removeRowCls:function(t,e){var i=this._getRowEl(t,1),n=this._getRowEl(t,2);if(i&&mini.removeClass(i,e),n&&mini.removeClass(n,e),t){var s=this._rowClsHash[t._id];s&&(s.remove(e),0==s.length&&delete this._rowClsHash[t._id])}},getCellBox:function(t,e){if(t=this.getRow(t),e=this.getColumn(e),!t||!e)return null;var i=this._getCellEl(t,e);return i?mini.getBox(i):null},getColumnBox:function(t){var e=this._createHeaderCellId(t,2),i=document.getElementById(e);if(i||(e=this._createHeaderCellId(t,1),i=document.getElementById(e)),i){var n=mini.getBox(i);return n.x-=1,n.left=n.x,n.right=n.x+n.width,n}},getRowBox:function(t){var e=this._getRowEl(t,1),i=this._getRowEl(t,2);if(!i)return null;var n=mini.getBox(i);if(e){var s=mini.getBox(e);n.x=n.left=s.left,n.width=n.right-n.x}return n},_doRowSelect:function(t,e){var i=this.isVirtualScroll(),n=this._viewRegion,s=i?n.start:-1,o=i?n.end:-1,r={};if(-1!=s)for(var l=this.getVisibleRows(),a=s,h=o;a<h;a++){var u=l[a];u&&(r[u._id]=!0)}for(new Date,a=0,h=t.length;a<h;a++){var d=t[a];-1!=s&&!r[d._id]||(e?this.addRowCls(d,this._rowSelectedCls,!1):this.removeRowCls(d,this._rowSelectedCls))}},_tryFocus:function(t){try{var e=t.target.tagName.toLowerCase();if("input"==e||"textarea"==e||"select"==e)return;if(mini.hasClass(t.target,"mini-placeholder-label"))return;mini.findParent(t.target,"mini-grid-rows-content")&&(mini.setXY(this._focusEl,t.pageX,t.pageY),this.focus(!1))}catch(t){}},focus:function(t){try{var e=this.getCurrentCell();if(e&&!1!==t){var i=this.getCellBox(e[0],e[1]);mini.setX(this._focusEl,i.x)}var n=this.getCurrent();if(n){var s=this._getRowEl(n,2);if(s){if(!1!==t){var o=mini.getBox(s);mini.setY(this._focusEl,o.top)}mini.isIE||mini.isIE11||mini.isChrome?mini.isChrome?this.el.focus():this._focusEl.focus():this.el.focus()}}else mini.isIE||mini.isIE11||mini.isChrome?this._focusEl.focus():this.el.focus()}catch(t){}},focusRow:function(t){this._focusRow!=t&&(this._focusRow&&this.removeRowCls(this._focusRow,this._rowHoverCls),(this._focusRow=t)&&this.addRowCls(t,this._rowHoverCls,!1),mini.isIE6&&mini.repaint())},scrollIntoView:function(t,e,i){if(t=this.getRow(t)){i=this.isVirtualScroll();try{if(e&&this._columnModel.isFrozenColumn(e)&&(e=null),e){var n=this._getCellEl(t,e);mini.scrollIntoView(n,this._rowsViewEl,!0,1!=i),this._syncScroll()}if(this.isVirtualScroll()){i=!0;var s=this.getScrollTop(),o=this._vscrollEl.offsetHeight,r=(this._getViewRegion(),this.getVisibleRows().indexOf(t)),l=this._getRangeHeight(0,r),a=l+(t._height||this.defaultRowHeight);l<s?(this.setScrollTop(l),this._updateScrollTop(l)):s+o<a&&(l=s+a-(s+o),this.setScrollTop(l),this._updateScrollTop(l))}else{var h=this._getRowEl(t,2);mini.scrollIntoView(h,this._rowsViewEl,!1),this._syncScroll()}}catch(t){}}},setShowLoading:function(t){this.showLoading=t},getShowLoading:function(){return this.showLoading},setEnableHotTrack:function(t){this.enableHotTrack=t},getEnableHotTrack:function(){return this.enableHotTrack},setAllowHotTrackOut:function(t){this.allowHotTrackOut=t},getAllowHotTrackOut:function(){return this.allowHotTrackOut},setOnlyCheckSelection:function(t){this.onlyCheckSelection=t},getOnlyCheckSelection:function(){return this.onlyCheckSelection},setAllowUnselect:function(t){this.allowUnselect=t},getAllowUnselect:function(){return this.allowUnselect},setAllowRowSelect:function(t){this.allowRowSelect=t},getAllowRowSelect:function(){return this.allowRowSelect},setAllowCellSelect:function(t){this.allowCellSelect=t},getAllowCellSelect:function(){return this.allowCellSelect},setAllowCellEdit:function(t){this.allowCellEdit=t},getAllowCellEdit:function(){return this.allowCellEdit},setCellEditAction:function(t){this.cellEditAction=t},getCellEditAction:function(){return this.cellEditAction},setAllowCellValid:function(t){this.allowCellValid=t},getAllowCellValid:function(){return this.allowCellValid},setAllowResizeColumn:function(t){this.allowResizeColumn=t,mini.removeClass(this.el,"mini-grid-resizeColumns-no"),t||mini.addClass(this.el,"mini-grid-resizeColumns-no")},getAllowResizeColumn:function(){return this.allowResizeColumn},setAllowSortColumn:function(t){this.allowSortColumn=t},getAllowSortColumn:function(){return this.allowSortColumn},setAllowMoveColumn:function(t){this.allowMoveColumn=t},getAllowMoveColumn:function(){return this.allowMoveColumn},setShowColumnsMenu:function(t){this.showColumnsMenu=t},getShowColumnsMenu:function(){return this.showColumnsMenu},setEditNextRowCell:function(t){this.editNextRowCell=t},getEditNextRowCell:function(){return this.editNextRowCell},setEditNextOnEnterKey:function(t){this.editNextOnEnterKey=t},getEditNextOnEnterKey:function(){return this.editNextOnEnterKey},setEditOnTabKey:function(t){this.editOnTabKey=t},getEditOnTabKey:function(){return this.editOnTabKey},setCreateOnEnter:function(t){this.createOnEnter=t},getCreateOnEnter:function(){return this.createOnEnter},_currentCell:null,_doCurrentCell:function(t){if(this._currentCell){var e=this._currentCell[0],i=this._currentCell[1],n=this._getCellEl(e,i);n&&(t?mini.addClass(n,this._cellSelectedCls):mini.removeClass(n,this._cellSelectedCls))}},setCurrentCell:function(t){if(this._currentCell!=t){if(this._doCurrentCell(!1),this._currentCell=t){var e=this.getRow(t[0]),i=this.getColumn(t[1]);this._currentCell=e&&i?[e,i]:null}if(this._doCurrentCell(!0),t)this._getAnchorCell(t[0],t[1])||(this.isFrozen()?this.scrollIntoView(t[0],null,!1):this.scrollIntoView(t[0],t[1],!1));this.fire("currentcellchanged")}},getCurrentCell:function(){var t=this._currentCell;return t&&-1==this.indexOf(t[0])&&(t=this._currentCell=null),t},_editingCell:null,isEditingCell:function(t){return this._editingCell&&this._editingCell[0]==t[0]&&this._editingCell[1]==t[1]},beginEditCell:function(t,e){this._pushUpdateCallback(function(t,e){new Date;var i=[t=this.getRow(t),e=this.getColumn(e)];if(t&&e&&this.setCurrentCell(i),i=this.getCurrentCell(),(!this._editingCell||!i||this._editingCell[0]!=i[0]||this._editingCell[1]!=i[1])&&(this._editingCell&&this.commitEdit(),i)){t=i[0];if("inline"!=(e=i[1]).editMode)!1!==this._OnCellBeginEdit(t,e,this.getCellEditor(e))&&(this.scrollIntoView(t,e,!1),this._editingCell=i,this._OnCellShowingEdit(t,e))}},this,[t,e])},cancelEdit:function(){if(this.allowCellEdit)this._editingCell&&this._OnCellEndEdit();else if(this.isEditing()){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){1==t[e]._editing&&this.cancelEditRow(e)}this._allowLayout=!0,this.doLayout()}},commitEdit:function(){if(this.allowCellEdit)this._editingCell&&(this._OnCellCommitEdit(this._editingCell[0],this._editingCell[1]),this._OnCellEndEdit());else if(this.isEditing()){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];1==n._editing&&this.commitEditRow(n)}this._allowLayout=!0,this.doLayout()}},getCellEditor:function(t,e){if(t=this.getColumn(t)){if(this.allowCellEdit){var i=t.__editor;return(i=i||mini.getAndCreate(t.editor))&&i!=t.editor&&(t.editor=i),i}if(e=this.getRow(e),t=this.getColumn(t),!(e=e||this.getEditingRow())||!t)return null;var n=this.uid+"$"+e._uid+"$"+t._id+"$editor";return mini.get(n)}},_OnCellBeginEdit:function(t,e,i,n){var s=mini._getMap(e.field,t),o={sender:this,rowIndex:this.indexOf(t),row:t,record:t,column:e,field:e.field,editor:i,value:s,cancel:!1};if(this.fire("cellbeginedit",o),!mini.isNull(e.defaultValue)&&(mini.isNull(o.value)||""===o.value)){var r=e.defaultValue,l=mini.clone({d:r});o.value=l.d}i=o.editor;if(s=o.value,o.cancel)return!1;if(!i&&"inline"!=e.editMode)return!1;if(!0===e.readOnly)return!1;if(!1===n)return!0;if("inline"!=e.editMode){if(mini.isNull(s)&&(s=""),i.setValue&&i.setValue(s),i.ownerRowID=t._uid,e.displayField&&i.setText){var a=mini._getMap(e.displayField,t);if(!mini.isNull(e.defaultText)&&(mini.isNull(a)||""===a))a=(l=mini.clone({d:e.defaultText})).d;i.setText(a)}this.allowCellEdit&&(this._editingControl=o.editor)}return!0},_OnCellCommitEdit:function(t,e,i,n){var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:n||this.getCellEditor(e),value:mini.isNull(i)?"":i,text:"",cancel:!1};if(s.editor&&s.editor.getValue){try{s.editor.blur()}catch(t){}s.value=s.editor.getValue()}s.editor&&s.editor.getText&&(s.text=s.editor.getText());var o=mini._getMap(e.field,t),r=s.value;if(s.oldValue=o,mini.isEquals(o,r))return s;if(this.fire("cellcommitedit",s),0==s.cancel&&this.allowCellEdit){var l={};l[e.field]=s.value,e.displayField&&(l[e.displayField]=s.text),this.updateRow(t,l)}return s},_OnCellEndEdit:function(t,e){if(this._editingCell||t){t=t||this._editingCell[0],e=e||this._editingCell[1];var i=mini._getMap(e.field,t),n={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:this._editingControl,value:i};if(this.fire("cellendedit",n),this.allowCellEdit&&n.editor){var s=n.editor;s&&s.setIsValid&&s.setIsValid(!0),this._editWrap&&(this._editWrap.style.display="none");for(var o=this._editWrap.childNodes,r=o.length-1;0<=r;r--){var l=o[r];this._editWrap.removeChild(l)}s&&s.hidePopup&&s.hidePopup(),s&&s.setValue&&s.setValue(""),this._editingControl=null,this._editingCell=null,this.allowCellValid&&this.validateCell(t,e)}}},_OnCellShowingEdit:function(t,e){if(!this._editingControl)return!1;var i=this.getCellBox(t,e);if(i){var n=document.body.scrollWidth;i.right>n&&(i.width=n-i.left,i.width<10&&(i.width=10),i.right=i.left+i.width)}var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,cellBox:i,editor:this._editingControl};this.fire("cellshowingedit",s);var o=s.editor;if(o&&o.setIsValid&&o.setIsValid(!0),i){this._getEditWrap(o);this._editWrap.style.zIndex=mini.getMaxZIndex(),this._setEditorBox(o,i),mini.on(document,"mousedown",this.__OnBodyMouseDown,this),e.autoShowPopup&&o.showPopup&&o.showPopup()}o&&this.navEditMode&&(o.keyNavEnabled=!(!1!==e.navUpdown))},_getEditingControl:function(){return this._editingControl},_setEditorBox:function(t,e){t.setWidth&&((n=e.width)<20&&(n=20),t.setWidth(n));if(t.setHeight&&"textarea"==t.type){var i=e.height-1;t.minHeight&&i<t.minHeight&&(i=t.minHeight),t.setHeight(i)}if(t.setWidth){var n=e.width-1;t.minWidth&&n<t.minWidth&&(n=t.minWidth),t.setWidth(n)}var s=e,o=t.getHeight(),r=s.y;o<s.height-2&&(r=Math.round(s.y+s.height/2-o/2)),mini.setXY(this._editWrap,s.x,r),mini.setWidth(this._editWrap,s.width);var l=document.body.scrollWidth;s.x>l&&mini.setX(this._editWrap,-1e3)},__OnBodyMouseDown:function(t){if(this._editingControl){var e=this._getCellByEvent(t);if(this._editingCell&&e&&this._editingCell[0]==e.record&&this._editingCell[1]==e.column)return!1;if(0==(this._editingControl.within?this._editingControl.within(t):mini.isAncestor(this._editWrap,t.target))){var i=this;if(0==mini.isAncestor(this._bodyEl,t.target))setTimeout(function(){i.commitEdit()},1);else{var n=i._editingCell;setTimeout(function(){var t=i._editingCell;n==t&&i.commitEdit()},70)}mini.un(document,"mousedown",this.__OnBodyMouseDown,this)}}},getEditWrap:function(){return this._editWrap},_getEditWrap:function(t){return this._editWrap||(this._editWrap=mini.append(this.cellEditorContainer||mini.cellEditorContainer||document.body,'<div class="mini-grid-editwrap" style="position:absolute;"></div>'),mini.on(this._editWrap,"keydown",this.___OnEditControlKeyDown,this)),this._editWrap.style.zIndex=1e9,this._editWrap.style.display="block",t.render?(t.render(this._editWrap),setTimeout(function(){t.focus(),t.selectText&&setTimeout(function(){t.selectText()},11)},50),t.setVisible&&t.setVisible(!0)):t.el&&(this._editWrap.appendChild(t.el),setTimeout(function(){try{t.el.focus()}catch(t){}},50)),this._editWrap},___OnEditControlKeyDown:function(t){var e=this._editingControl;if(13!=t.keyCode||!e||"textarea"!=e.type){if(13==t.keyCode){var i=new Date;if(this._enterTimestamp&&i-this._enterTimestamp<80)return;if(this._enterTimestamp=i,(n=this._editingCell)&&n[1]&&!1===n[1].enterCommit)return;this.commitEdit(),this.focus(),this.editNextOnEnterKey&&(this.fire("celleditenter",{record:n[0],column:n[1]}),this._beginEditNextCell(0==t.shiftKey))}else 27==t.keyCode?(this.cancelEdit(),this.focus()):9==t.keyCode&&(this.commitEdit(),this.editOnTabKey&&(t.preventDefault(),this.commitEdit(),this._beginEditNextCell(0==t.shiftKey,!0)));if(this.navEditMode){if(n=this._editingCell)if((o=n[1])&&!1===o.navUpdown&&e&&(38==t.keyCode||40==t.keyCode))return;switch(t.keyCode){case 37:this.focus(),t.preventDefault(),this.commitEdit(),this._beginEditNextCell(!1!==t.shiftKey);break;case 39:this.focus(),this.commitEdit(),this.editOnTabKey&&(t.preventDefault(),this.commitEdit(),this._beginEditNextCell(0==t.shiftKey,!0));break;case 38:this.focus(),t.preventDefault();var n=this._editingCell;this.commitEdit();var s=n[0],o=n[1];if(!s)return;0<(l=this.indexOf(s))&&(l-=1);var r=[this.getRow(l),o];this.setCurrentCell(r),this.beginEditCell();break;case 40:this.focus(),t.preventDefault();n=this._editingCell;this.commitEdit();var l;s=n[0],o=n[1];if(!s)return;(l=this.indexOf(s))<this.getData().length-1&&(l+=1);r=[this.getRow(l),o];this.setCurrentCell(r),this.beginEditCell()}}}},navEditMode:!1,setNavEditMode:function(t){this.navEditMode=t},getNavEditMode:function(){return this.navEditMode},editNextRowCell:!1,editNextOnEnterKey:!1,editOnTabKey:!0,createOnEnter:!1,skipReadOnlyCell:!1,setSkipReadOnlyCell:function(t){this.skipReadOnlyCell=t},getSkipReadOnlyCell:function(){return this.skipReadOnlyCell},isCellCanEdit:function(t,e){return this._OnCellBeginEdit(t,e,this.getCellEditor(e),!1)},_beginEditNextCell:function(t,e){var i=new Date;if(!(this._editTimestamp&&i-this._editTimestamp<80)){this._editTimestamp=i;var n=this;if(_=this.getCurrentCell()){this.focus();var s,o=n.getVisibleColumns(),r=_?_[1]:null,l=_?_[0]:null,a=o.indexOf(r),h=(s=l,n.getVisibleRows().indexOf(s)),u=n.getVisibleRows().length;if(!1===t){if(this.skipReadOnlyCell){var d=this;function c(){for(var t=a-1==0?o.length:a-1;0<t;t--){if(r=o[t],d.isCellCanEdit(l,r))return r}}if(!c()||0==a){a=o.length;c();m()}}else(r=o[a-=1])||(r=o[o.length-1],m());function m(){l=v(h-1)}}else if(this.editNextRowCell&&!e)h+1<u&&(l=v(h+1));else{function f(){if(!(l=n.getAt(h+1))){if(!n.createOnEnter)return;l={},n.addRow(l)}}function p(){for(var t=a+1==g?0:a+1;t<g;t++){if(r=o[t],d.isCellCanEdit(l,r))return r}}if(this.skipReadOnlyCell){d=this;var g=o.length;if(!p()||a+1==g){a=0;p();f()}}else(r=o[a+=1])||(r=o[0],f())}var _=[l,r];if(n.setCurrentCell(_),!n.onlyCheckSelection&&n.allowRowSelect&&n.getCurrent()!=l&&(n.deselectAll(),n.setCurrent(l)),n.scrollIntoView(l,r,!1),n.isReadOnly()||r.readOnly)return!1;n.beginEditCell()}}function v(t){return n.getVisibleRows()[t]}},getEditorOwnerRow:function(t){var e=t.ownerRowID;return this.getRowByUID(e)},beginEditRow:function(t){this.allowCellEdit||this._pushUpdateCallback(function(t){if(new Date,(t=this.getRow(t))&&(e=this._getRowEl(t,2))){t._editing=!0,this._doUpdateRowEl(t);var e=this._getRowEl(t,2);mini.addClass(e,"mini-grid-rowEdit");for(var i=this.getVisibleColumns(),n=0,s=i.length;n<s;n++){var o=i[n],r=(t[o.field],this._getCellEl(t,o));if(r){"string"==typeof o.editor&&(o.editor=window.eval("("+o.editor+")"));var l=mini.copyTo({},o.editor);l.id=this.uid+"$"+t._uid+"$"+o._id+"$editor";var a=mini.create(l);this._OnCellBeginEdit(t,o,a)&&a&&(mini.addClass(r,"mini-grid-cellEdit"),r.innerHTML="",r.appendChild(a.el),mini.addClass(a.el,"mini-grid-editor"))}}this.doLayout()}},this,[t])},cancelEditRow:function(t){if(!this.allowCellEdit&&(t=this.getRow(t))&&t._editing){delete t._editing;this._getRowEl(t);for(var e=this.getVisibleColumns(),i=0,n=e.length;i<n;i++){e[i];var s=this._createCellId(t,e[i]),o=document.getElementById(s);if(o){var r=o.firstChild,l=mini.get(r);l&&l.destroy()}}this._doUpdateRowEl(t),this.doLayout()}},commitEditRow:function(t){if(!this.allowCellEdit&&(t=this.getRow(t))&&t._editing){var e=this.getEditRowData(t,!1,!1);this._canUpdateRowEl=!1,this.updateRow(t,e),this._canUpdateRowEl=!0,this.cancelEditRow(t)}},isEditing:function(){for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){if(1==t[e]._editing)return!0}return!1},isEditingRow:function(t){return!!(t=this.getRow(t))&&!!t._editing},isNewRow:function(t){return"added"==t._state},getEditingRows:function(){for(var t=[],e=this.getDataView(),i=0,n=e.length;i<n;i++){var s=e[i];1==s._editing&&t.push(s)}return t},getEditingRow:function(){return this.getEditingRows()[0]},getEditData:function(t){for(var e=[],i=this.getDataView(),n=0,s=i.length;n<s;n++){if(1==i[n]._editing){var o=this.getEditRowData(n,t);e.push(o)}}return e},getEditRowData:function(t,e,i){if(!(t=this.getRow(t))||!t._editing)return null;for(var n=this.getIdField(),s=this.getParentField?this.getParentField():null,o={},r=this.getVisibleColumns(),l=0,a=r.length;l<a;l++){var h=r[l],u=this._createCellId(t,r[l]),d=document.getElementById(u);if(d){var c=null;if("checkboxcolumn"==h.type||"radiobuttoncolumn"==h.type){var m=h.isChecked(t,h)?h.trueValue:h.falseValue;c=this._OnCellCommitEdit(t,h,m)}else{var f=d.firstChild,p=mini.get(f);if(!p)continue;c=this._OnCellCommitEdit(t,h,null,p)}!1!==i?(mini._setMap(h.field,c.value,o),h.displayField&&mini._setMap(h.displayField,c.text,o)):(o[h.field]=c.value,h.displayField&&(o[h.displayField]=c.text))}}if(o[n]=t[n],s&&(o[s]=t[s]),e){var g=mini.copyTo({},t);o=mini.copyTo(g,o)}return o},collapseGroups:function(){if(this.isGrouping()){this._allowLayout=!1;for(var t=this.getGroupingView(),e=0,i=t.length;e<i;e++){var n=t[e];this.collapseRowGroup(n)}this._allowLayout=!0,this.doLayout()}},expandGroups:function(){if(this.isGrouping()){this._allowLayout=!1;for(var t=this.getGroupingView(),e=0,i=t.length;e<i;e++){var n=t[e];this.expandRowGroup(n)}this._allowLayout=!0,this.doLayout()}},toggleRowGroup:function(t){t.expanded?this.collapseRowGroup(t):this.expandRowGroup(t)},collapseRowGroup:function(t){if(t=this.getRowGroup(t)){t.expanded=!1;var e=this._getRowGroupEl(t,1),i=this._getRowGroupRowsEl(t,1),n=this._getRowGroupEl(t,2),s=this._getRowGroupRowsEl(t,2);i&&(i.style.display="none"),s&&(s.style.display="none"),e&&mini.addClass(e,"mini-grid-group-collapse"),n&&mini.addClass(n,"mini-grid-group-collapse"),this.doLayout()}},expandRowGroup:function(t){if(t=this.getRowGroup(t)){t.expanded=!0;var e=this._getRowGroupEl(t,1),i=this._getRowGroupRowsEl(t,1),n=this._getRowGroupEl(t,2),s=this._getRowGroupRowsEl(t,2);i&&(i.style.display=""),s&&(s.style.display=""),e&&mini.removeClass(e,"mini-grid-group-collapse"),n&&mini.removeClass(n,"mini-grid-group-collapse"),this.doLayout()}},showAllRowDetail:function(){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];this.showRowDetail(n)}this._allowLayout=!0,this.doLayout()},hideAllRowDetail:function(){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];this.hideRowDetail(n)}this._allowLayout=!0,this.doLayout()},isShowRowDetail:function(t){return!!(t="object"==typeof t?t:this.getRow(t))&&!!t._showDetail},toggleRowDetail:function(t){(t=this.getRow(t))&&(grid.isShowRowDetail(t)?grid.hideRowDetail(t):grid.showRowDetail(t))},showRowDetail:function(t){if((t=this.getRow(t))&&1!=t._showDetail){t._showDetail=!0;var e=this._getRowDetailEl(t,1,!0),i=this._getRowDetailEl(t,2,!0);e&&(e.style.display=""),i&&(i.style.display="");var n=this._getRowEl(t,1),s=this._getRowEl(t,2);n&&mini.addClass(n,"mini-grid-expandRow"),s&&mini.addClass(s,"mini-grid-expandRow"),this.fire("showrowdetail",{record:t});var o=this;this.isFrozen()&&setTimeout(function(){o.syncRowDetail(t)},1),this.doLayout()}},hideRowDetail:function(t){if((t=this.getRow(t))&&!0===t._showDetail){t._showDetail=!1;var e=this._getRowDetailEl(t,1),i=this._getRowDetailEl(t,2);e&&(e.style.display="none"),i&&(i.style.display="none");var n=this._getRowEl(t,1),s=this._getRowEl(t,2);n&&mini.removeClass(n,"mini-grid-expandRow"),s&&mini.removeClass(s,"mini-grid-expandRow"),this.fire("hiderowdetail",{record:t}),this.doLayout()}},_getRowDetailEl:function(t,e,i){if(!(t=this.getRow(t)))return null;var n=this._createRowDetailId(t,e),s=document.getElementById(n);return s||!0!==i||(s=this._createRowDetail(t,e)),s},_createRowDetail:function(t,e){var i=this.getFrozenColumns(),n=this.getUnFrozenColumns(),s=i.length;2==e&&(s=n.length);var o=this._getRowEl(t,e);if(!o)return null;var r=this._createRowDetailId(t,e),l='<tr id="'+r+'" class="mini-grid-detailRow"><td style="width:0"></td><td class="mini-grid-detailCell" colspan="'+s+'"></td></tr>';return jQuery(o).after(l),document.getElementById(r)},_createRowDetailId:function(t,e){return this._id+"$detail"+e+"$"+t._id},getRowDetailCellEl:function(t,e){e=e||2;var i=this._getRowDetailEl(t,e);if(i)return i.cells[1]},autoHideRowDetail:!0,setAutoHideRowDetail:function(t){this.autoHideRowDetail=t},getAutoHideRowDetail:function(){return this.autoHideRowDetail},mergeColumns:function(t){t&&0==mini.isArray(t)&&(t=[t]);var d=this.getVisibleColumns();t=t||d;var c=this.getDataView();c.push({});for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];if(s=this.getColumn(s)){var o=r(s);e.addRange(o)}}function r(t){if(t.field){for(var e=[],i=-1,n=1,s=d.indexOf(t),o=null,r=0,l=c.length;r<l;r++){var a=c[r],h=mini._getMap(t.field,a);if(-1!=i&&mini.isEquals(h,o))n++;else{if(1<n){var u={rowIndex:i,columnIndex:s,rowSpan:n,colSpan:1};e.push(u)}i=r,n=1,o=h}}return e}}this.mergeCells(e)},mergeCells:function(t){if(mini.isArray(t)){this._mergedCells=t;var h=this._mergedCellMaps={};if(t=this._mergedCells)for(var e=0,i=t.length;e<i;e++){var n=t[e];n.rowSpan||(n.rowSpan=1),n.colSpan||(n.colSpan=1),s(n.rowIndex,n.columnIndex,n.rowSpan,n.colSpan,n)}this.doUpdate()}function s(t,e,i,n,s){for(var o=t,r=t+i;o<r;o++)for(var l=e,a=e+n;l<a;l++)h[o+":"+l]=o!=t||l!=e||s}},margeCells:function(t){this.mergeCells(t)},_isCellVisible:function(t,e){return!this._mergedCellMaps||!(!0===this._mergedCellMaps[t+":"+e])},_getAnchorCell:function(t,e){if(!this._mergedCellMaps)return null;var i=this.indexOf(t),n=this.getBottomColumns().indexOf(e);return this._mergedCellMaps[i+":"+n]},_getCellEls:function(t,e,i,n){var s=[];if(!mini.isNumber(t))return[];if(!mini.isNumber(e))return[];this.getVisibleColumns(),this.getDataView();for(var o=t,r=t+i;o<r;o++)for(var l=e,a=e+n;l<a;l++){var h=this._getCellEl(o,l);h&&s.push(h)}return s},_getDragData:function(){var t=this.getSelecteds().clone(),s=this;return mini.sort(t,function(t,e){var i=s.indexOf(t),n=s.indexOf(e);return n<i?1:i<n?-1:0},this),t},_getDragText:function(t){return"Records "+t.length},allowDrag:!1,allowDrop:!1,allowLeafDropIn:!1,setAllowLeafDropIn:function(t){this.allowLeafDropIn=t},getAllowLeafDropIn:function(){return this.allowLeafDropIn},setAllowDrag:function(t){this.allowDrag=t},getAllowDrag:function(){return this.allowDrag},setAllowDrop:function(t){this.allowDrop=t},getAllowDrop:function(){return this.allowDrop},isAllowDrag:function(t,e){return!this.isReadOnly()&&0!=this.enabled&&(!(!this.allowDrag||!e.allowDrag)&&!1!==t.allowDrag)},_OnDragStart:function(t,e){var i={node:t,nodes:this._getDragData(),column:e,cancel:!1};return i.record=i.node,i.records=i.nodes,i.dragText=this._getDragText(i.nodes),this.fire("dragstart",i),i},_OnGiveFeedback:function(t,e,i,n){var s={};return s.from=n,s.effect=t,s.nodes=e,s.node=s.nodes[0],s.targetNode=i,s.dragNodes=e,s.dragNode=s.dragNodes[0],s.dropNode=s.targetNode,s.dragAction=s.action,this.fire("givefeedback",s),s},_OnDragDrop:function(t,e,i){var n={dragNodes:t=t.clone(),targetNode:e,action:i,cancel:!1};return n.dragNode=n.dragNodes[0],n.dropNode=n.targetNode,n.dragAction=n.action,this.fire("beforedrop",n),this.fire("dragdrop",n),n},moveUp:function(t){if(mini.isArray(t))for(var n=this,e=0,i=(t=t.sort(function(t,e){var i=n.indexOf(t);return n.indexOf(e)<i?1:-1})).length;e<i;e++){var s=t[e],o=this.indexOf(s);this.moveRow(s,o-1)}},moveDown:function(t){if(mini.isArray(t)){var n=this;(t=t.sort(function(t,e){var i=n.indexOf(t);return n.indexOf(e)<i?1:-1})).reverse();for(var e=0,i=t.length;e<i;e++){var s=t[e],o=this.indexOf(s);this.moveRow(s,o+2)}}},pageSize:20,pageIndex:0,totalCount:0,totalPage:0,sortField:"",sortOrder:"",url:"",setAjaxAsync:function(t){this._dataSource.ajaxAsync=t,this.ajaxAsync=t},getAjaxAsync:function(){return this._dataSource.ajaxAsync},setAjaxMethod:function(t){this._dataSource.ajaxMethod=t,this.ajaxMethod=t},getAjaxMethod:function(){return this._dataSource.ajaxMethod},setAjaxType:function(t){this._dataSource.ajaxType=t,this.ajaxType=t},getAjaxType:function(){return this._dataSource.ajaxType},setAjaxOptions:function(t){this._dataSource.setAjaxOptions(t)},getAjaxOptions:function(){return this._dataSource.getAjaxOptions()},setAutoLoad:function(t){this._dataSource.setAutoLoad(t)},getAutoLoad:function(){return this._dataSource.getAutoLoad()},setUrl:function(t){this._dataSource.setUrl(t),this.url=t},getUrl:function(){return this._dataSource.getUrl()},load:function(t,e,i,n){this._dataSource.load(t,e,i,n)},reload:function(t,e,i){this.accept(),this._dataSource.reload(t,e,i)},gotoPage:function(t,e){this._dataSource.gotoPage(t,e)},sortBy:function(t,e){if(!t)return null;var i=this._dataSource;if(this.sortField=i.sortField=t,this.sortOrder=i.sortOrder=e,"server"==this._dataSource.sortMode)this._dataSource.sortBy(t,e);else{var n=this._columnModel._getDataTypeByField(t);this._dataSource._doClientSortField(t,e,n)}},sortDblClick:!1,setSortDblClick:function(t){this.sortDblClick=t},getSortDblClick:function(){return this.sortDblClick},showCellTip:!0,setShowCellTip:function(t){this.showCellTip=t},getShowCellTip:function(){return this.showCellTip},setCheckSelectOnLoad:function(t){this._dataSource.setCheckSelectOnLoad(t),this.checkSelectOnLoad=t},getCheckSelectOnLoad:function(){return this._dataSource.getCheckSelectOnLoad()},setSelectOnLoad:function(t){this._dataSource.setSelectOnLoad(t),this.selectOnLoad=t},getSelectOnLoad:function(){return this._dataSource.getSelectOnLoad()},allowCancelSort:!1,setAllowCancelSort:function(t){this.allowCancelSort=t},getAllowCancelSort:function(){return this.allowCancelSort},setSortMode:function(t){this._dataSource.setSortMode(t),this.sortMode=t},getSortMode:function(){return this._dataSource.getSortMode()},setPageIndex:function(t){this._dataSource.setPageIndex(t),this.pageIndex=t},getPageIndex:function(){return this._dataSource.getPageIndex()},setPageSize:function(t){this._dataSource.setPageSize(t),this._virtualRows=t,this.pageSize=t},getPageSize:function(){return this._dataSource.getPageSize()},setTotalCount:function(t){this._dataSource.setTotalCount(t),this.totalCount=t},getTotalCount:function(){return this._dataSource.getTotalCount()},getTotalPage:function(){return this._dataSource.getTotalPage()},setSortField:function(t){this._dataSource.setSortField(t),this.sortField=t},getSortField:function(){return this._dataSource.sortField},setSortOrder:function(t){this._dataSource.setSortOrder(t),this.sortOrder=t},getSortOrder:function(){return this._dataSource.sortOrder},setPageIndexField:function(t){this._dataSource.pageIndexField=t,this.pageIndexField=t},getPageIndexField:function(){return this._dataSource.pageIndexField},setPageSizeField:function(t){this._dataSource.pageSizeField=t,this.pageSizeField=t},getPageSizeField:function(){return this._dataSource.pageSizeField},setStartField:function(t){this._dataSource.startField=t,this.startField=t},getStartField:function(){return this._dataSource.startField},setLimitField:function(t){this._dataSource.limitField=t,this.limitField=t},getLimitField:function(){return this._dataSource.limitField},setSortFieldField:function(t){this._dataSource.sortFieldField=t,this.sortFieldField=t},getSortFieldField:function(){return this._dataSource.sortFieldField},setSortOrderField:function(t){this._dataSource.sortOrderField=t,this.sortOrderField=t},getSortOrderField:function(){return this._dataSource.sortOrderField},setTotalField:function(t){this._dataSource.totalField=t,this.totalField=t},getTotalField:function(){return this._dataSource.totalField},setDataField:function(t){this._dataSource.dataField=t,this.dataField=t},getDataField:function(){return this._dataSource.dataField},setErrorField:function(t){this._dataSource.errorField=t,this.errorField=t},getErrorField:function(){return this._dataSource.errorField},setErrorMsgField:function(t){this._dataSource.errorMsgField=t,this.errorMsgField=t},getErrorMsgField:function(){return this._dataSource.errorMsgField},setStackTraceField:function(t){this._dataSource.stackTraceField=t,this.stackTraceField=t},getStackTraceField:function(){return this._dataSource.stackTraceField},setPageSizeWidth:function(t){this._bottomPager.setPageSizeWidth(t)},getPageSizeWidth:function(){return this._bottomPager.getPageSizeWidth()},getBottomPager:function(){return this._bottomPager},sizeText:"",setSizeText:function(t){this._bottomPager.sizeText=t},getSizeText:function(){return this.sizeText},showPagerButtonText:!1,setShowPagerButtonText:function(t){this._bottomPager.setShowButtonText(t)},getShowPagerButtonText:function(){return this.showPagerButtonText},showPagerButtonIcon:!1,setShowPagerButtonIcon:function(t){this._bottomPager.setShowButtonIcon(t)},getShowPagerButtonIcon:function(){return this.showPagerButtonIcon},setShowReloadButton:function(t){this._bottomPager.setShowReloadButton(t)},getShowReloadButton:function(){return this._bottomPager.getShowReloadButton()},setShowPageInfo:function(t){this._bottomPager.setShowPageInfo(t)},getShowPageInfo:function(){return this._bottomPager.getShowPageInfo()},setSizeList:function(t){mini.isArray(t)&&this._bottomPager.setSizeList(t)},getSizeList:function(){return this._bottomPager.getSizeList()},setShowPageSize:function(t){this._bottomPager.setShowPageSize(t)},getShowPageSize:function(){return this._bottomPager.getShowPageSize()},setShowPageIndex:function(t){this.showPageIndex=t,this._bottomPager.setShowPageIndex(t)},getShowPageIndex:function(){return this._bottomPager.getShowPageIndex()},setShowTotalCount:function(t){this._bottomPager.setShowTotalCount(t)},getShowTotalCount:function(){return this._bottomPager.getShowTotalCount()},setPagerStyle:function(t){this.pagerStyle=t,mini.setStyle(this._bottomPager.el,t)},setPagerCls:function(t){this.pagerCls=t,mini.addClass(this._bottomPager.el,t)},setDropAction:function(t){this.dropAction=t},getDropAction:function(){return this.dropAction},groupTitleCollapsible:!0,setGroupTitleCollapsible:function(t){this.groupTitleCollapsible=t},getGroupTitleCollapsible:function(){return this.groupTitleCollapsible},allowEmptyContextMenu:!1,setAllowEmptyContextMenu:function(t){this.allowEmptyContextMenu=t},getAllowEmptyContextMenu:function(){return this.allowEmptyContextMenu},_beforeOpenContentMenu:function(t,e){mini.isAncestor(this._bodyEl,e.htmlEvent.target)?t.fire("BeforeOpen",e):e.cancel=!0},__OnHtmlContextMenu:function(t){var e={popupEl:this.el,htmlEvent:t,cancel:!1};if(mini.isAncestor(this._columnsEl,t.target)){if(this.headerContextMenu){if(this.headerContextMenu.fire("BeforeOpen",e),1==e.cancel)return;if(this.headerContextMenu.fire("opening",e),1==e.cancel)return;this.headerContextMenu.showAtPos(t.pageX,t.pageY),this.headerContextMenu.fire("Open",e)}}else{var i=mini.findParent(t.target,"mini-grid-detailRow");if(i&&mini.isAncestor(this.el,i))return;if(!mini.findParent(t.target,"mini-tree-nodeshow")&&"tree"==this.type&&!this.allowEmptyContextMenu)return;if(!this.allowEmptyContextMenu&&!mini.findParent(t.target,"mini-grid-table"))return;if(mini.findParent(t.target,"mini-grid-filterRow"))return;if(mini.findParent(t.target,"mini-grid-summaryRow"))return;if(this.contextMenu){if(this._beforeOpenContentMenu(this.contextMenu,e),1==e.cancel)return;if(this.contextMenu.fire("opening",e),1==e.cancel)return;this.contextMenu.showAtPos(t.pageX,t.pageY),this.contextMenu.fire("Open",e)}}return!1},headerContextMenu:null,setHeaderContextMenu:function(t){var e=this._getContextMenu(t);e&&this.headerContextMenu!==e&&(this.headerContextMenu=e,mini.addClass(e.el,"mini-menu-open"),this.headerContextMenu.owner=this,mini.on(this.el,"contextmenu",this.__OnHtmlContextMenu,this))},getHeaderContextMenu:function(){return this.headerContextMenu},selectOnRightClick:!0,setSelectOnRightClick:function(t){this.selectOnRightClick=t},getSelectOnRightClick:function(){return this.selectOnRightClick},_get_originals:function(){return this._dataSource._originals},_set_originals:function(t){this._dataSource._originals=t},_set_clearOriginals:function(t){this._dataSource._clearOriginals=t},_set_originalIdField:function(t){this._dataSource._originalIdField=t},_set_autoCreateNewID:function(t){this._dataSource._autoCreateNewID=t},getAttrs:function(t){for(var e=mini.DataGrid.superclass.getAttrs.call(this,t),i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],r=mini.getAttr(o,"property");r&&("columns"==(r=r.toLowerCase())?(e.columns=mini._ParseColumns(o),mini.removeNode(o)):"data"==r&&(e.data=o.innerHTML,mini.removeNode(o)))}return mini._ParseString(t,e,["oncelleditenter","onselect","ondeselect","onbeforeselect","onbeforedeselect","url","sizeList","bodyCls","bodyStyle","footerCls","footerStyle","pagerCls","pagerStyle","onheadercellclick","onheadercellmousedown","onheadercellcontextmenu","onrowdblclick","onrowclick","onrowmousedown","onrowcontextmenu","onrowmouseenter","onrowmouseleave","oncellclick","oncellmousedown","oncellcontextmenu","oncelldblclick","onbeforeload","onpreload","onloaderror","onload","onupdate","ondrawcell","oncellbeginedit","onselectionchanged","ondrawgroup","onbeforeshowrowdetail","onbeforehiderowdetail","onshowrowdetail","onhiderowdetail","idField","valueField","pager","oncellcommitedit","oncellendedit","headerContextMenu","loadingMsg","emptyText","cellEditAction","sortMode","oncellvalidation","onsort","ondrawsummarycell","ondrawgroupsummarycell","onresize","oncolumnschanged","ajaxMethod","ajaxOptions","onaddrow","onupdaterow","onremoverow","onmoverow","onbeforeaddrow","onbeforeupdaterow","onbeforeremoverow","onbeforemoverow","pageIndexField","pageSizeField","sortFieldField","sortOrderField","startField","limitField","totalField","dataField","sortField","sortOrder","stackTraceField","errorField","errorMsgField","pagerButtons","onbeforegroupclick","dropAction","sizeText","pagerType","viewType","itemRenderer","summaryPosition"]),mini._ParseBool(t,e,["showColumns","showFilterRow","showSummaryRow","showPager","showFooter","enableGroupOrder","validateOnAdd","showHGridLines","showVGridLines","showSortIcon","allowSortColumn","allowMoveColumn","allowResizeColumn","fitColumns","showLoading","multiSelect","allowAlternating","resultAsData","allowRowSelect","allowUnselect","onlyCheckSelection","allowHotTrackOut","enableHotTrack","showPageIndex","showPageSize","showTotalCount","checkSelectOnLoad","allowResize","autoLoad","autoHideRowDetail","allowCellSelect","allowCellEdit","allowCellWrap","allowHeaderWrap","selectOnLoad","virtualScroll","virtualColumns","collapseGroupOnLoad","showGroupSummary","showEmptyText","alwaysShowEmptyText","allowCellValid","showModified","showColumnsMenu","showPageInfo","showReloadButton","showNewRow","editNextOnEnterKey","createOnEnter","skipReadOnlyCell","ajaxAsync","allowDrag","allowDrop","allowLeafDropIn","editNextRowCell","fixedRowHeight","showCellTip","showPagerButtonText","showPagerButtonIcon","groupTitleCollapsible","navEditMode","selectOnRightClick","sortDblClick","allowEmptyContextMenu","showGroupSummary","allowCancelSort"]),mini._ParseInt(t,e,["frozenStartColumn","frozenEndColumn","pageSizeWidth","pageIndex","pageSize","defaultRowHeight","defaultColumnWidth","wheelIncrement","summaryRows"]),"string"==typeof e.ajaxOptions&&(e.ajaxOptions=window.eval("("+e.ajaxOptions+")")),"string"==typeof e.sizeList&&(e.sizeList=window.eval("("+e.sizeList+")")),!e.idField&&e.valueField&&(e.idField=e.valueField),e.pagerButtons&&(e.pagerButtons=mini.byId(e.pagerButtons)),e.itemRenderer&&(e.itemRenderer=window[e.itemRenderer]),e}}),mini.regClass(mini.DataGrid,"datagrid"),mini_DataGrid_CellValidator_Prototype={getCellErrors:function(){for(var t=this._cellErrors.clone(),e=this._dataSource,i=0,n=t.length;i<n;i++){var s=t[i],o=s.record;if(!e.getby_id(o._id)){var r=s.column,l=o[this._rowIdField]+"$"+r._id;delete this._cellMapErrors[l],this._cellErrors.remove(s)}}return this._cellErrors},getCellError:function(t,e){if(t=this.getNode?this.getNode(t):this.getRow(t),e=this.getColumn(e),t&&e){var i=t[this._rowIdField]+"$"+e._id;return this._cellMapErrors?this._cellMapErrors[i]:null}},isValid:function(){return 0==this.getCellErrors().length},isCellValid:function(t,e){if(!this._cellMapErrors)return!0;var i=t[this._rowIdField]+"$"+e._id;return!this._cellMapErrors[i]},validate:function(t){t=t||this.getDataView(),mini.isArray(t)||(t=[]);for(var e=0,i=t.length;e<i;e++){var n=t[e];this.validateRow(n)}},validateRow:function(t){for(var e=this.getBottomColumns(),i=0,n=e.length;i<n;i++){var s=e[i];this.validateCell(t,s)}},validateCell:function(t,e){if(t=this.getNode?this.getNode(t):this.getRow(t),e=this.getColumn(e),t&&e&&0!=e.visible){var i=mini._getMap(e.field,t),n={record:t,row:t,node:t,column:e,field:e.field,value:i,isValid:!0,errorText:""};if(e.vtype&&mini._ValidateVType(e.vtype,n.value,n,e),1==n.isValid&&e.unique&&e.field)for(var s={},o=this.data,r=e.field,l=0,a=o.length;l<a;l++){var h=o[l],u=h[r];if(mini.isNull(u)||""===String(u).trim());else{var d=s[u];if(d&&h==t){n.isValid=!1,n.errorText=mini._getErrorText(e,"uniqueErrorText"),this.setCellIsValid(d,e,n.isValid,n.errorText);break}s[u]=h}}this.fire("cellvalidation",n),this.setCellIsValid(t,e,n.isValid,n.errorText)}},setIsValid:function(t){if(t)for(var e=this._cellErrors.clone(),i=0,n=e.length;i<n;i++){var s=e[i];this.setCellIsValid(s.record,s.column,!0)}},_removeRowError:function(t){for(var e=this.getColumns(),i=0,n=e.length;i<n;i++){var s=e[i],o=t[this._rowIdField]+"$"+s._id,r=this._cellMapErrors[o];r&&(delete this._cellMapErrors[o],this._cellErrors.remove(r))}},setCellIsValid:function(t,e,i,n){if(t=this.getRow(t),e=this.getColumn(e),t&&e){var s=t[this._rowIdField]+"$"+e._id,o=this._getCellEl(t,e),r=this._cellMapErrors[s];delete this._cellMapErrors[s],this._cellErrors.remove(r),!0===i?o&&r&&mini.removeClass(o,"mini-grid-cell-error"):(r={record:t,column:e,isValid:i,errorText:n},this._cellMapErrors[s]=r,this._cellErrors.add(r),o&&mini.addClass(o,"mini-grid-cell-error"))}}},mini.copyTo(mini.DataGrid.prototype,mini_DataGrid_CellValidator_Prototype),mini.TreeGrid=function(){mini.TreeGrid.superclass.constructor.apply(this,arguments),mini.addClass(this.el,"mini-tree"),this.setAjaxAsync(!1),this.setAutoLoad(!0),1==this.showTreeLines&&mini.addClass(this.el,"mini-tree-treeLine"),this._AsyncLoader=new mini._Tree_AsyncLoader(this),this._Expander=new mini._Tree_Expander(this),this.setShowArrow(this.showArrow)},mini.copyTo(mini.TreeGrid.prototype,mini._DataTreeApplys),mini.extend(mini.TreeGrid,mini.DataGrid,{isTree:!0,uiCls:"mini-treegrid",showPager:!1,showNewRow:!1,showCheckBox:!1,showRadioButton:!1,showTreeIcon:!0,showExpandButtons:!0,showTreeLines:!1,showArrow:!1,expandOnDblClick:!0,expandOnNodeClick:!1,loadOnExpand:!0,_checkBoxType:"checkbox",iconField:"iconCls",_treeColumn:null,leafIconCls:"mini-tree-leaf",folderIconCls:"mini-tree-folder",fixedRowHeight:!1,_checkBoxCls:"mini-tree-checkbox",_expandNodeCls:"mini-tree-expand",_collapseNodeCls:"mini-tree-collapse",_eciconCls:"mini-tree-node-ecicon",_inNodeCls:"mini-tree-nodeshow",isEditingNode:function(t){return this._editingNode==t},indexOf:function(t){return this._dataSource.indexOfList(t)},_getDragText:function(t){return"Nodes "+t.length},_initEvents:function(){mini.TreeGrid.superclass._initEvents.call(this),this.on("nodedblclick",this.__OnNodeDblClick,this),this.on("nodeclick",this.__OnNodeClick,this),this.on("cellclick",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodeclick",t)},this),this.on("cellmousedown",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodemousedown",t)},this),this.on("celldblclick",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodedblclick",t)},this),this.on("beforerowselect",function(t){t.node=t.selected,t.isLeaf=this.isLeaf(t.node),this.fire("beforenodeselect",t)},this),this.on("rowselect",function(t){t.node=t.selected,t.isLeaf=this.isLeaf(t.node),this.fire("nodeselect",t)},this)},setValue:function(t,e){if(mini.isNull(t)&&(t=""),t=String(t),this.getValue()!=t){var i=this.getCheckedNodes();if(this.uncheckNodes(i,this.checkRecursive),this.value=t,this.showCheckBox){var n=String(t).split(",");this._dataSource.doCheckNodes(n,!0,!1!==e)}else this.selectNode(t,!1)}},getValue:function(t){return this.showCheckBox?(!1===t&&(t="leaf"),this._dataSource.getCheckedNodesId(t)):this._dataSource.getSelectedsId()},getText:function(){var t=[];this.showCheckBox?t=this.getCheckedNodes():(o=this.getSelectedNode())&&t.push(o);for(var e=[],i=this.getTextField(),n=0,s=t.length;n<s;n++){var o=t[n];e.push(o[i])}return e.join(",")},isGrouping:function(){return!1},_createSource:function(){this._dataSource=new mini.DataTree},_bindSource:function(){mini.TreeGrid.superclass._bindSource.call(this);var t=this._dataSource;t.on("expand",this.__OnTreeExpand,this),t.on("collapse",this.__OnTreeCollapse,this),t.on("_checkchanged",this.__OnCheckChanged,this),t.on("addnode",this.__OnSourceAddNode,this),t.on("removenode",this.__OnSourceRemoveNode,this),t.on("movenode",this.__OnSourceMoveNode,this),t.on("beforeloadnode",this.__OnBeforeLoadNode,this),t.on("loadnode",this.__OnLoadNode,this)},__OnBeforeLoadNode:function(t){this.__showLoading=this.showLoading,this.showLoading=!1,this.addNodeCls(t.node,"mini-tree-loading"),this.fire("beforeloadnode",t)},__OnLoadNode:function(t){this.showLoading=this.__showLoading,this.removeNodeCls(t.node,"mini-tree-loading"),this.fire("loadnode",t)},_virtualUpdate:function(){var t=this;t._updateNodeTimer&&(clearTimeout(t._updateNodeTimer),t._updateNodeTimer=null),t._updateNodeTimer=setTimeout(function(){t._updateNodeTimer=null,t.doUpdateRows(),t.deferLayout(50)},5)},__OnSourceAddNode:function(t){var e=this._dataSource.isVisibleNode(t.node);if(1==this.isVirtualScroll())this._virtualUpdate();else if(e)this._doAddNodeEl(t.node);else{var i=this.getParentNode(t.node);this._dataSource.isVisibleNode(i)&&this._doUpdateTreeNodeEl(i)}this.fire("addnode",t)},__OnSourceRemoveNode:function(t){if(1==this.isVirtualScroll())this._virtualUpdate();else{this._doRemoveNodeEl(t.node);var e=this.getParentNode(t.node),i=this.getChildNodes(e);if(0==i.length)this._doUpdateTreeNodeEl(e);else{var n=t.index;1<n&&n==i.length&&this._doUpdateTreeNodeEl(i[i.length-1])}}this.fire("removenode",t)},__OnSourceMoveNode:function(t){this._doMoveNodeEl(t.node),this.fire("movenode",t);var e=t.oldParentNode;if(e!=t.parentNode){var i=this.getChildNodes(e);if(i){var n=i[i.length-1];n&&this._doUpdateTreeNodeEl(n)}}},_doAddNodeEl:function(t){var e=this.getFrozenColumns(),i=this.getUnFrozenColumns(),a=this.getParentNode(t),h=this.indexOf(t),u=!1;function n(t,e,i){var n=this._createRowHTML(t,h,e,i),s=this.indexOfNode(t)+1,o=this.getChildNodeAt(s,a);if(o){var r=this._getNodeEl(o,i);jQuery(r).before(n)}else{var l=this._getNodesEl(a,i);l?mini.append(l.firstChild,n):u=!0}}n.call(this,t,i,2),n.call(this,t,e,1),u&&this._doUpdateTreeNodeEl(a)},_doRemoveNodeEl:function(t){this._doRemoveRowEl(t);var e=this._getNodesEl(t,1),i=this._getNodesEl(t,2);e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i)},_doMoveNodeEl:function(t){if(1==this.isVirtualScroll())this._virtualUpdate();else{this._doRemoveNodeEl(t);var e=this.getParentNode(t);this._doUpdateTreeNodeEl(e)}},_doUpdateNodeTitle:function(t){this._doUpdateTreeNodeEl(t,!1)},_doUpdateTreeNodeEl:function(t,e){if(e=!1!==e,this.getRootNode()!=t){if(this.isVisibleNode(t)){var i=t,n=this.getFrozenColumns(),s=this.getUnFrozenColumns(),o=this._createNodeHTML(t,n,1,null,e),r=this._createNodeHTML(t,s,2,null,e),l=this._getNodeEl(t,1),a=this._getNodeEl(t,2),h=this._getNodesTr(t,1),u=this._getNodesTr(t,2),d=this._getRowDetailEl(t,1),c=this._getRowDetailEl(t,2),m=(t=(f=mini.createElements(o))[0],f[1]);l&&(mini.before(l,t),e&&(d?mini.after(d,m):mini.before(l,m)),mini.removeNode(l),e&&mini.removeNode(h));var f;t=(f=mini.createElements(r))[0],m=f[1];a&&(mini.before(a,t),e&&(c?mini.after(c,m):mini.before(a,m)),mini.removeNode(a),e&&mini.removeNode(u)),1==t.checked||this.isLeaf(t)||this._doCheckNodeEl(i)}}else this.doUpdate()},addNodeCls:function(t,e){this.addRowCls(t,e)},removeNodeCls:function(t,e){this.removeRowCls(t,e)},doUpdate:function(){mini.TreeGrid.superclass.doUpdate.apply(this,arguments)},setData:function(t){t=t||[],this._dataSource.setData(t)},loadList:function(t,e,i){e=e||this.getIdField(),i=i||this.getParentField();var n=mini.listToTree(t,this.getNodesField(),e,i);this.setData(n)},_createDrawCellEvent:function(t,e,i,n){var s=mini.TreeGrid.superclass._createDrawCellEvent.call(this,t,e,i,n);return s.node=s.record,s.isLeaf=this.isLeaf(s.node),this._treeColumn&&this._treeColumn==e.name&&(s.isTreeCell=!0,s.img=t[this.imgField],s.iconCls=this._getNodeIcon(t),s.nodeCls="",s.nodeStyle="",s.nodeHtml="",s.showTreeIcon=this.showTreeIcon,s.checkBoxType=this._checkBoxType,s.showCheckBox=this.showCheckBox,s.showRadioButton=this.showRadioButton,s.showCheckBox&&!s.isLeaf&&(s.showCheckBox=this.showFolderCheckBox),s.showRadioButton&&!s.isLeaf&&(s.showRadioButton=this.showFolderCheckBox),s.enabled=!1!==s.node.enabled,s.checkable=this.getCheckable(s.node)),s},_OnDrawCell:function(t,e,i,n){var s=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);return this._treeColumn&&this._treeColumn==e.name&&(this.fire("drawnode",s),s.nodeStyle&&(s.cellStyle=s.nodeStyle),s.nodeCls&&(s.cellCls=s.nodeCls),s.nodeHtml&&(s.cellHtml=s.nodeHtml),this._createTreeColumn(s)),s},_isViewFirstNode:function(t){if(this._viewNodes){var e=this.getParentNode(t);return this._getViewChildNodes(e)[0]===t}return this.isFirstNode(t)},_isViewLastNode:function(t){if(this._viewNodes){var e=this.getParentNode(t),i=this._getViewChildNodes(e);return i[i.length-1]===t}return this.isLastNode(t)},_isInViewLastNode:function(t,e){if(this._viewNodes){for(var i=null,n=this.getAncestors(t),s=0,o=n.length;s<o;s++){var r=n[s];this.getLevel(r)==e&&(i=r)}return!(!i||i==this.root)&&this._isViewLastNode(i)}return this.isInLastNode(t,e)},isInLastNode:function(t,e){for(var i=null,n=this.getAncestors(t),s=0,o=n.length;s<o;s++){var r=n[s];this.getLevel(r)==e&&(i=r)}return!(!i||i==this.root)&&this.isLastNode(i)},_createNodeTitle:function(t,e,i){var n=!e;e=e||[];var s=this.isLeaf(t),o=this.getLevel(t),r=i.nodeCls;s||(r=this.isExpandedNode(t)?this._expandNodeCls:this._collapseNodeCls),!1===t.enabled&&(r+=" mini-disabled"),s||(r+=" mini-tree-parentNode");var l=this.getChildNodes(t);l&&l.length;e[e.length]='<div class="mini-tree-nodetitle '+r+'" >';for(var a=this.getParentNode(t),h=0;h<=o;h++)if(h!=o&&!(s&&o-1<h)){var u="";this._isInViewLastNode(t,h)&&(u="background:none"),e[e.length]='<span class="mini-tree-indent " style="'+u+'"></span>'}var d="";if(this._isViewFirstNode(t)&&0==o?d="mini-tree-node-ecicon-first":this._isViewLastNode(t)&&(d="mini-tree-node-ecicon-last"),this._isViewFirstNode(t)&&this._isViewLastNode(t)&&(d="mini-tree-node-ecicon-firstAndlast",a==this.root&&(d="mini-tree-node-ecicon-firstLast")),e[e.length]=s?'<span class="'+this._eciconCls+" "+d+'" style="'+(this.showExpandButtons?"":"display:none")+'"></span>':'<a class="'+this._eciconCls+" "+d+'" style="'+(this.showExpandButtons?"":"display:none")+'" '+(mini.isChrome?"":'href="javascript:void(0);"')+' onclick="return false;" hidefocus></a>',e[e.length]='<span class="mini-tree-nodeshow mini-corner-all">',i.showTreeIcon)if(i.img){var c=this.imgPath+i.img;e[e.length]='<span class="mini-tree-icon mini-icon mini-iconfont" style="background-image:url('+c+');"></span>'}else e[e.length]='<span class="'+i.iconCls+' mini-tree-icon mini-icon mini-iconfont"></span>';if(i.showRadioButton&&!i.showCheckBox&&(e[e.length]='<span class="mini-tree-radio mini-icon" ></span>'),i.showCheckBox){var m=this._createCheckNodeId(t),f=this.isCheckedNode(t);i.enabled;!1!==i.enabled&&(!1===i.checkable?"disabled":""),e[e.length]='<span id="'+m+'" class="mini-icon '+this._checkBoxCls+" "+(f?"mini-tree-checkbox-checked":"")+'"></span>'}if(e[e.length]='<span class="mini-tree-nodetext">',this._editingNode==t){var p=this._id+"$edit$"+t._id,g=i.value;e[e.length]='<input id="'+p+'" type="text" class="mini-tree-editinput" value="'+g+'"/>'}else e[e.length]=i.cellHtml;if(e[e.length]="</span>",e[e.length]="</span>",e[e.length]="</div>",n)return e.join("")},_createCheckNodeId:function(t){return this._id+"$checkbox$"+t._id},_createTreeColumn:function(t){var e=t.record;t.column;t.headerCls+=" mini-tree-treecolumn",t.cellCls+=" mini-tree-treecell",t.cellStyle+=";padding:0;";var i=this.isLeaf(e);t.cellHtml=this._createNodeTitle(e,null,t),1==e.checked||i||t.showCheckBox&&this._renderCheckState(e)},_renderCheckState:function(t){if(this._renderCheckStateNodes||(this._renderCheckStateNodes=[]),this._renderCheckStateNodes.push(t),!this._renderCheckStateTimer){var n=this;this._renderCheckStateTimer=setTimeout(function(){n._renderCheckStateTimer=null;var t=n._renderCheckStateNodes;n._renderCheckStateNodes=null;for(var e=0,i=t.length;e<i;e++)n._doCheckNodeEl(t[e])},1)}},_createNodeHTML:function(t,e,i,n,s){var o=!n;n=n||[];var r=this._dataSource,l=r.getDataView().indexOf(t);if(this._createRowHTML(t,l,e,i,n),!1!==s){var a=r.getChildNodes(t),h=this.isVisibleNode(t);if(a&&0<a.length){var u=this.isExpandedNode(t);if(1==u){var d=u&&h?"":"display:none",c=this._createNodesId(t,i);n[n.length]='<tr class="mini-tree-nodes-tr" style="',mini.isIE&&(n[n.length]=d),n[n.length]='" ><td class="mini-tree-nodes-td" colspan="',n[n.length]=e.length+1,n[n.length]='" >',n[n.length]='<div class="mini-tree-nodes" id="',n[n.length]=c,n[n.length]='" style="',n[n.length]=d,n[n.length]='">',this._createNodesHTML(a,e,i,n),n[n.length]="</div>",n[n.length]="</td></tr>"}}}if(o)return n.join("")},_createNodesHTML:function(t,e,i,n){if(!t)return"";var s=!n;if((n=n||[]).push('<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'),n.push(this._createTopRowHTML(e,!0)),0<e.length)for(var o=0,r=t.length;o<r;o++){var l=t[o];this._createNodeHTML(l,e,i,n)}return n.push("</table>"),s?n.join(""):void 0},_createRowsHTML:function(t,e){if(this.isVirtualScroll())return mini.TreeGrid.superclass._createRowsHTML.apply(this,arguments);var i=this._dataSource,n=[],s=[],o=i.getRootNode();return!0!==this._useEmptyView&&(s=i.getChildNodes(o)),(2==e?this._rowsViewEl.firstChild:this._rowsLockEl.firstChild).id=this._createNodesId(o,e),this._createNodesHTML(s,t,e,n),n.join("")},_createNodesId:function(t,e){return this._id+"$nodes"+e+"$"+t._id},_getNodeEl:function(t,e){return this._getRowEl(t,e)},_getNodesEl:function(t,e){t=this.getNode(t);var i=this._createNodesId(t,e);return document.getElementById(i)},_getNodesTr:function(t,e){var i=this._getNodesEl(t,e);if(i)return i.parentNode.parentNode},checkOnTextClick:!1,setCheckOnTextClick:function(t){this.checkOnTextClick=t},getCheckOnTextClick:function(){return this.checkOnTextClick},setTreeColumn:function(t){this._treeColumn=t,this.deferUpdate()},getTreeColumn:function(){return this._treeColumn},setShowTreeIcon:function(t){this.showTreeIcon=t,this.deferUpdate()},getShowTreeIcon:function(){return this.showTreeIcon},setShowCheckBox:function(t){this.showCheckBox=t,this.deferUpdate()},getShowCheckBox:function(){return this.showCheckBox},setShowRadioButton:function(t){this.showRadioButton=t,this.deferUpdate()},getShowRadioButton:function(){return this.showRadioButton},setCheckBoxType:function(t){this._checkBoxType=t,this._doUpdateCheckState()},getCheckBoxType:function(){return this._checkBoxType},setIconsField:function(t){this._iconsField=t},getIconsField:function(){return this._iconsField},_getNodeIcon:function(t){var e=t[this.iconField];return e=e||(this.isLeaf(t)?this.leafIconCls:this.folderIconCls)},_getCheckBoxEl:function(t){if(0==this.isVisibleNode(t))return null;var e=this._id+"$checkbox$"+t._id;return mini.byId(e,this.el)},useAnimation:!0,_updateNodeTimer:null,_doExpandCollapseNode:function(t){(s=this)._updateNodeTimer&&(clearTimeout(s._updateNodeTimer),s._updateNodeTimer=null);new Date;if(1!=this.isVirtualScroll())if(mini.isIE6||!this.useAnimation||this.isFrozen())o.call(this);else{var e=this.isExpandedNode(t);function i(t,e,i){var n=this._getNodesEl(t,e);if(n){var s=mini.getHeight(n);n.style.overflow="hidden",n.style.height="0px";var o={height:s+"px"},r=this;r._inAniming=!0,jQuery(n).animate(o,250,function(){n.style.height="auto",r._inAniming=!1,r.doLayout(),mini.repaint(n)})}}function n(t,e,i){var n=this._getNodesEl(t,e);if(n){mini.getHeight(n);var s=this;s._inAniming=!0,jQuery(n).animate({height:"0px"},180,function(){n.style.height="auto",s._inAniming=!1,i&&i.call(s),s.doLayout(),mini.repaint(n)})}else i&&i.call(this)}var s=this;e?(o.call(this),i.call(this,t,2),i.call(this,t,1)):(n.call(this,t,2,o),n.call(this,t,1))}else this._updateTimer||(s._updateNodeTimer=setTimeout(function(){s._updateNodeTimer=null,s.doUpdateRows(),s.deferLayout(50)},5));function o(){this._doUpdateTreeNodeEl(t),this.deferLayout(20)}},__OnTreeCollapse:function(t){this._doExpandCollapseNode(t.node)},__OnTreeExpand:function(t){this._doExpandCollapseNode(t.node)},_doCheckNodeEl:function(t){var e=this._getCheckBoxEl(t);if(e){var i=this.getCheckModel();mini.removeClass(e,"mini-tree-checkbox-indeterminate");var n=t.indeterminate&&!t.checked;if("cascade"==i||n)"indeterminate"==(n?"indeterminate":this.getCheckState(t))?mini.addClass(e,"mini-tree-checkbox-indeterminate"):mini.removeClass(e,"mini-tree-checkbox-indeterminate");t.checked?mini.addClass(e,"mini-tree-checkbox-checked"):mini.removeClass(e,"mini-tree-checkbox-checked")}},__OnCheckChanged:function(t){for(var e=0,i=t._nodes.length;e<i;e++){var n=t._nodes[e];this._doCheckNodeEl(n)}this._checkChangedTimer&&(clearTimeout(this._checkChangedTimer),this._checkChangedTimer=null);var s=this;this._checkChangedTimer=setTimeout(function(){s._checkChangedTimer=null,s.fire("_checkchanged")},1)},_tryToggleCheckNode:function(t){if(!1!==t.enabled&&0!=this.getCheckable(t)){var e=this.isCheckedNode(t),i={node:t,cancel:!1,checked:e,isLeaf:this.isLeaf(t)};this.fire("beforenodecheck",i),i.cancel||(this._dataSource.doCheckNodes(t,!e,!0),this.fire("nodecheck",i))}},_tryToggleNode:function(t){var e={node:t,cancel:!1};if(this.isExpandedNode(t)){if(this.fire("beforecollapse",e),1==e.cancel)return;this.collapseNode(t),e.type="collapse",this.fire("collapse",e)}else{if(this.fire("beforeexpand",e),1==e.cancel)return;this.expandNode(t),e.type="expand",this.fire("expand",e)}},_OnCellMouseDown:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellmousedown",t)},_OnCellClick:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||(mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.checkOnTextClick?this._tryToggleCheckNode(t.record):this.fire("cellclick",t))},__OnNodeDblClick:function(t){},__OnNodeClick:function(t){},setNodeText:function(t,e){if(t=this.getNode(t)){var i={};i[this.getTextField()]=e,this.updateNode(t,i)}},setNodeIconCls:function(t,e){if(t=this.getNode(t)){var i={};i[this.iconField]=e,this.updateNode(t,i)}},setIconField:function(t){this.iconField=t},getIconField:function(){return this.iconField},setAllowSelect:function(t){this.setAllowRowSelect(t)},getAllowSelect:function(){return this.getAllowRowSelect()},setShowExpandButtons:function(t){this.showExpandButtons!=t&&(this.showExpandButtons=t,this.doUpdate())},getShowExpandButtons:function(){return this.showExpandButtons},setShowTreeLines:function(t){1==(this.showTreeLines=t)?mini.addClass(this.el,"mini-tree-treeLine"):mini.removeClass(this.el,"mini-tree-treeLine")},getShowTreeLines:function(){return this.showTreeLines},setShowArrow:function(t){1==(this.showArrow=t)?mini.addClass(this.el,"mini-tree-showArrows"):mini.removeClass(this.el,"mini-tree-showArrows")},getShowArrow:function(){return this.showArrow},setLeafIcon:function(t){this.leafIcon=t},getLeafIcon:function(){return this.leafIcon},setFolderIcon:function(t){this.folderIcon=t},getFolderIcon:function(){return this.folderIcon},getExpandOnDblClick:function(){return this.expandOnDblClick},setExpandOnNodeClick:function(t){(this.expandOnNodeClick=t)?mini.addClass(this.el,"mini-tree-nodeclick"):mini.removeClass(this.el,"mini-tree-nodeclick")},getExpandOnNodeClick:function(){return this.expandOnNodeClick},setLoadOnExpand:function(t){this.loadOnExpand=t},getLoadOnExpand:function(){return this.loadOnExpand},hideNode:function(t){if(t=this.getNode(t)){t.visible=!1,this._doUpdateTreeNodeEl(t);var e=this._getNodeEl(t,1),i=this._getNodeEl(t,2);e&&(e.style.display="none"),i&&(i.style.display="none")}},showNode:function(t){(t=this.getNode(t))&&(t.visible=!0,this._doUpdateTreeNodeEl(t))},enableNode:function(t){if(t=this.getNode(t)){t.enabled=!0;var e=this._getNodeEl(t,1),i=this._getNodeEl(t,2);e&&mini.removeClass(e,"mini-disabled"),i&&mini.removeClass(i,"mini-disabled");var n=this._getCheckBoxEl(t);n&&(n.disabled=!1)}},disableNode:function(t){if(t=this.getNode(t)){t.enabled=!1;var e=this._getNodeEl(t,1),i=this._getNodeEl(t,2);e&&mini.addClass(e,"mini-disabled"),i&&mini.addClass(i,"mini-disabled");var n=this._getCheckBoxEl(t);n&&(n.disabled=!0)}},imgPath:"",setImgPath:function(t){this.imgPath=t},getImgPath:function(){return this.imgPath},imgField:"img",setImgField:function(t){this.imgField=t},getImgField:function(){return this.imgField},getAttrs:function(t){var e=mini.TreeGrid.superclass.getAttrs.call(this,t);if(mini._ParseString(t,e,["value","url","idField","textField","iconField","nodesField","parentField","valueField","checkedField","leafIcon","folderIcon","leafField","ondrawnode","onbeforenodeselect","onnodeselect","onnodemousedown","onnodeclick","onnodedblclick","onbeforenodecheck","onnodecheck","onbeforeexpand","onexpand","onbeforecollapse","oncollapse","dragGroupName","dropGroupName","onendedit","expandOnLoad","ondragstart","onbeforedrop","ondrop","ongivefeedback","treeColumn","onaddnode","onremovenode","onmovenode","imgPath","imgField","hoverMode"]),mini._ParseBool(t,e,["allowSelect","showCheckBox","showRadioButton","showExpandButtons","showTreeIcon","showTreeLines","checkRecursive","enableHotTrack","showFolderCheckBox","resultAsTree","allowDrag","allowDrop","showArrow","expandOnDblClick","removeOnCollapse","autoCheckParent","loadOnExpand","expandOnNodeClick","useAnimation","checkOnTextClick"]),e.expandOnLoad){var i=parseInt(e.expandOnLoad);mini.isNumber(i)?e.expandOnLoad=i:e.expandOnLoad="true"==e.expandOnLoad}var f=e.idField||this.getIdField(),p=e.textField||this.getTextField(),g=e.iconField||this.getIconField(),_=e.nodesField||this.getNodesField();var n=function t(e){for(var i=[],n=0,s=e.length;n<s;n++){var o=e[n],r=mini.getChildNodes(o),l=r[0],a=r[1];l&&a||(l=o);var h=jQuery(l),u={};u[f]=l.getAttribute("value"),u[g]=h.attr("iconCls"),u[p]=l.innerHTML,i.add(u);var d=h.attr("expanded");d&&(u.expanded="false"!=d);var c=h.attr("allowSelect");if(c&&(u.allowSelect="false"!=c),a){var m=t(mini.getChildNodes(a));0<m.length&&(u[_]=m)}}return i}(mini.getChildNodes(t));return 0<n.length&&(e.data=n),!e.idField&&e.valueField&&(e.idField=e.valueField),e}}),mini.regClass(mini.TreeGrid,"TreeGrid"),mini.Tree=function(){mini.Tree.superclass.constructor.apply(this,arguments);var t=[{name:"node",header:"",field:this.getTextField(),width:"auto",allowDrag:!0,editor:{type:"textbox"}}];this._columnModel.setColumns(t),this._column=this._columnModel.getColumn("node"),mini.removeClass(this.el,"mini-treegrid"),mini.addClass(this.el,"mini-tree-nowrap"),this.setBorderStyle("border:0")},mini.extend(mini.Tree,mini.TreeGrid,{_userEmptyTd:!(mini.isChrome||mini.isIE6||mini.isIE7),setTextField:function(t){this._dataSource.setTextField(t),this._columnModel.updateColumn("node",{field:t}),this.textField=t},uiCls:"mini-tree",hoverMode:"title",_rowHoverCls:"mini-tree-node-hover",_rowSelectedCls:"mini-tree-selectedNode",_getRecordByEvent:function(t,e){"node"==this.hoverMode&&(e=!1);var i=mini.Tree.superclass._getRecordByEvent.call(this,t);return!1===e?i:i&&mini.findParent(t.target,"mini-tree-nodeshow")?i:null},_treeColumn:"node",defaultRowHeight:22,_getRowHeight:function(t){var e=this.defaultRowHeight;return t._height&&(e=parseInt(t._height),isNaN(parseInt(t._height))&&(e=rowHeight)),e},showHeader:!1,showTopbar:!1,showFooter:!1,showColumns:!1,showHGridLines:!1,showVGridLines:!1,showTreeLines:!0,setTreeColumn:null,setColumns:null,getColumns:null,frozen:null,unFrozen:null,showModified:!1,_OnCellMouseDown:function(t){this._editInput&&this._editInput.blur(),this.fire("cellmousedown",t)},beginEdit:function(e){if(e=this.getNode(e)){var t=this.getColumn(0),i=mini._getMap(t.field,e),n={record:e,node:e,column:t,field:t.field,value:i,cancel:!1};if(this.fire("cellbeginedit",n),1!=n.cancel){this._editingNode=e,this._doUpdateNodeTitle(e);var s=this;setTimeout(function(){o()},100),o()}}function o(){var t=s._id+"$edit$"+e._id;s._editInput=document.getElementById(t),s._editInput.focus(),mini.selectRange(s._editInput,0,1e3),mini.on(s._editInput,"keydown",s.__OnEditInputKeyDown,s),mini.on(s._editInput,"blur",s.__OnEditInputBlur,s)}},cancelEdit:function(t){var e=this._editingNode;this._editingNode=null,e&&(!1!==t&&this._doUpdateNodeTitle(e),mini.un(this._editInput,"keydown",this.__OnEditInputKeyDown,this),mini.un(this._editInput,"blur",this.__OnEditInputBlur,this)),this._editInput=null},__OnEditInputKeyDown:function(t){if(13==t.keyCode){var e=this._editingNode,i=this._editInput.value;this._editingNode=null,this.setNodeText(e,i),this.cancelEdit(!1),this.fire("endedit",{node:e,text:i})}else 27==t.keyCode&&this.cancelEdit()},__OnEditInputBlur:function(t){var e=this._editingNode;if(e){var i=this._editInput.value;this.cancelEdit(),this.setNodeText(e,i),this.fire("endedit",{node:e,text:i})}},addRowCls:function(t,e){var i=this._getRowEl(t,1),n=this._getRowEl(t,2);i&&mini.addClass(i,e),n&&mini.addClass(n,e),i&&mini.addClass(i.cells[1],e),n&&mini.addClass(n.cells[1],e)},removeRowCls:function(t,e){var i=this._getRowEl(t,1),n=this._getRowEl(t,2);i&&mini.removeClass(i,e),n&&mini.removeClass(n,e),i&&mini.removeClass(i.cells[1],e),n&&mini.removeClass(n.cells[1],e)},scrollIntoView:function(e){if(e=this.getNode(e)){this.isVisibleNode(e)||this.expandPath(e);var i=this;setTimeout(function(){if(i.isVirtualScroll())mini.Tree.superclass.scrollIntoView.call(i,e);else{var t=i._getNodeEl(e,2);mini.scrollIntoView(t,i._rowsViewEl,!1)}},10)}}}),mini.regClass(mini.Tree,"Tree"),mini._Tree_Expander=function(t){this.owner=t,mini.on(t.el,"click",this.__OnClick,this),mini.on(t.el,"dblclick",this.__OnDblClick,this)},mini._Tree_Expander.prototype={_canToggle:function(){return!this.owner._dataSource._isNodeLoading()},__OnClick:function(t){var e=this.owner,i=e._getRecordByEvent(t,!1);if(i&&!1!==i.enabled&&!mini.findParent(t.target,"mini-tree-checkbox")){var n=e.isLeaf(i);if(mini.findParent(t.target,e._eciconCls)){if(0==this._canToggle())return;e._tryToggleNode(i)}else if(e.expandOnNodeClick&&!n&&!e._inAniming){if(0==this._canToggle())return;e._tryToggleNode(i)}}},__OnDblClick:function(t){var e=this.owner,i=e._getRecordByEvent(t,!1);if(i&&!1!==i.enabled&&!e.isEditingNode(i)){var n=e.isLeaf(i);if(!e._inAniming&&!mini.findParent(t.target,e._eciconCls)&&!mini.findParent(t.target,"mini-tree-checkbox")&&!e.expandOnNodeClick&&e.expandOnDblClick&&!n){if(0==this._canToggle())return;t.preventDefault(),e._tryToggleNode(i)}}}},mini._Tree_AsyncLoader=function(t){(this.owner=t).on("expand",this.__OnBeforeNodeExpand,this)},mini._Tree_AsyncLoader.prototype={__OnBeforeNodeExpand:function(t){var e=this.owner,i=t.node,n=e.isLeaf(i),s=i[e.getNodesField()];n||s&&0!=s.length||e.loadOnExpand&&!1!==i.asyncLoad&&(t.cancel=!0,e.loadNode(i))}},mini.overwrite(mini.Button,{disableMultiClick:!0,iconPosition:"left",_iconOnlyCls:"mini-button-iconOnly",_iconPosCls:{left:"mini-button-iconLeft",right:"mini-button-iconRight",top:"mini-button-iconTop",bottom:"mini-button-iconBottom"},_loadingSvg:mini.isIE8||mini.isIE9?"":'<svg class="mini-button-loading-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="128" height="128" fill="currentColor" ><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg>',setIconPosition:function(t){this.iconPosition=t,this.doUpdate()},doUpdate:function(){if(!1!==this._allowUpdate){var t=this.text,e=this.iconCls,i=this.iconPosition,n=this.plain,s=[];if(""===t?this.addCls(this._iconOnlyCls):(this.removeCls(this._iconOnlyCls),s.push('<span class="mini-button-text">'+t+"</span>")),n?this.addCls(this._plainCls):this.removeCls(this._plainCls),e){mini.hasClass(this.el,this._iconOnlyCls)||(this.__prevIconPos&&this.removeCls(this._iconPosCls[this.__prevIconPos]),this.addCls(this._iconPosCls[i]),this.__prevIconPos=i);var o='<i class="mini-button-icon '+e+'"></i>';"top"==i||"left"==i?(s.unshift(o),s.unshift(this._loadingSvg)):(s.push(o),s.push(this._loadingSvg)),this.removeCls("mini-button-textOnly")}else this.addCls("mini-button-textOnly"),s.unshift(this._loadingSvg);this.allowCls&&s.push('<span class="mini-button-allow '+this.allowCls+'"></span>'),this.el.innerHTML=s.join("")}},setIsLoading:mini.isIE8||mini.isIE9?function(t){this.isLoading=!!t,this.setEnabled(!this.isLoading)}:function(t){this.enabled&&(this.isLoading=!!t,this.isLoading?this.addCls("mini-btn-loading"):this.removeCls("mini-btn-loading"))},getIsLoading:function(){return this.isLoading},_initEvents:function(){var t=this;mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"click",function(){t.isLoading||(t.__OnClick(),t.disableMultiClick&&t.enabled&&(t.setEnabled(!1),setTimeout(function(){t.setEnabled(!0)},1e3)))},this)},this)},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["disableMultiClick","isloading"]),e}}),function(){function t(t){var e=i.call(this,t);return this.menu&&this.menu.setyOffset&&this.menu.setyOffset(this.yOffset),e}var i=mini.MenuButton.prototype.setMenu;mini.overwrite(mini.MenuButton,{yOffset:2,setMenu:t}),mini.overwrite(mini.SplitButton,{yOffset:2,setMenu:t});var e=mini.Tabs.prototype._createHeaderMenu;mini.Tabs.prototype._createHeaderMenu=function(){var t=e.apply(this,arguments);return this._headerMenu&&this._headerMenu.setyOffset&&this._headerMenu.setyOffset(2),t}}(),mini.overwrite(mini.ButtonEdit,{setText:function(t){null==t&&(t=""),t=mini.htmlDecode(t);this.text;this.text=t,this._textEl.value=t,this._doEmpty()}}),mini.overwrite(mini.Calendar,{__OnClick:function(t){var e=this.viewDate;if(0!=this.enabled){var i=t.target,n=mini.findParent(t.target,"mini-calendar-title");if(mini.findParent(i,"mini-calendar-monthNext"))e.setDate(1),e.setMonth(e.getMonth()+1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-yearNext"))e.setDate(1),e.setFullYear(e.getFullYear()+1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-monthPrev"))e.setDate(1),e.setMonth(e.getMonth()-1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-yearPrev"))e.setDate(1),e.setFullYear(e.getFullYear()-1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-tadayButton")){var s=!!mini.findParent(i,"yesterday"),o=new Date;if(s&&o.setDate(o.getDate()-1),this.setViewDate(o),this.setSelectedDate(o),this.currentTime){var r=new Date;this.setTime(r)}this._OnDateClick(o,"today")}else mini.findParent(i,"mini-calendar-clearButton")?(this.setSelectedDate(null),this.setTime(null),this._OnDateClick(null,"clear")):mini.findParent(i,"mini-calendar-okButton")?this._OnDateClick(null,"ok"):n&&this.showMenu();var l=mini.findParent(t.target,"mini-calendar-date");if(l&&!mini.hasClass(l,"mini-calendar-disabled")){var a=l.id.split("$"),h=parseInt(a[a.length-1]);if(-1==h)return;var u=new Date(h);this._OnDateClick(u)}}}}),mini.supportRem&&mini.overwrite(mini.Calendar,{width:"2.20rem",height:"1.6rem"}),mini.overwrite(mini.ComboBox,{autoLoad:!0,__input:function(t){document.activeElement==this._textEl&&t.which&&this._tryQuery()},setUrl:function(t,e){this.getPopup(),this.autoLoad||e?(this._listbox.setUrl(t),this.url=this._listbox.url,this.data=this._listbox.data,this.doDataChange()):(this.url=t,this.isLoaded=!1)},load:function(t){"string"==typeof(t=t||this.url)?this.setUrl(t,!0):this.setData(t)},setAutoLoad:function(t){this.autoLoad=!!t},getAutoLoad:function(){return this.autoLoad},showPopup:function(){0==this.isLoaded&&this.load();var t={cancel:!1};if(this.fire("beforeshowpopup",t),this._firebeforeshowpopup=!1,1!=t.cancel){this._listbox.setHeight("auto"),mini.ComboBox.superclass.showPopup.call(this);var e=this.popup.el.style.height;""==e||"auto"==e?this._listbox.setHeight("auto"):this._listbox.setHeight("100%");if(!this.multiSelect){var i=jQuery("table .mini-listbox-checkbox",this._listbox.el),n=i.css("display");i.css("display","table-cell"),i.css("display",n)}this._listbox.setValueInCheckOrder(this.valueInCheckOrder),this._listbox.setValue(this.value),this.autoFocusItem&&(""==this.value||mini.isNull(this.value))&&this._listbox._focusItem(0)}},setValue:function(t){mini.isNull(t)&&(t="");var e=this._listbox.getValueAndText(t),i=e[0],n=e[1];""!==n&&!mini.isNull(n)||(n=t),this.valueFromSelect&&(""===i||mini.isNull(i))&&(t=n=""),this.value=t,this._valueEl.value=this.value,this.setText(n)},setText:function(t){null==t&&(t=""),t=mini.htmlDecode(t);this.text;this.text=t,this._textEl.value=t,this._doEmpty()},doDataChange:function(){var t=this._listbox.getValueAndText(this.value),e=t[0],i=t[1];""!==e||this.clearOnLoad||(e=this.value,i=this.text,this.value=null),this.text=this._textEl.value=i,this.setValue(e),this.isLoaded=!0},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["autoLoad"]),e}}),mini.htmlUnescape=function(t){return t+""!==t?t:mini.htmlDecode(t)},mini.htmlEscape=function(t){if(t+""!==t)return t;var e=document.createElement("div");e.appendChild(document.createTextNode(t));var i=e.innerHTML;return e=null,i},function(){var t=mini.GridView.prototype._createPagers;mini.overwrite(mini.DataGrid,{pagerType:"pagination",_createPagers:function(){t.apply(this,arguments),"pager"!==this.pagerType&&this.setPagerType(this.pagerType)}})}(),mini.overwrite(mini.DataGrid,{allowAlternating:!1,showHGridLines:!0,showVGridLines:!1,showSortIcon:!0,allowResize:!1,showEmptyText:!0,emptyText:"",getColumnData:function(t){for(var e=[],i=this.getData(),n=0,s=i.length;n<s;n++)e.push(i[n][t]);return e},_OnCellBeginEdit:function(t,e,i,n){var s=mini._getMap(e.field,t),o={sender:this,rowIndex:this.indexOf(t),row:t,record:t,column:e,field:e.field,editor:i,value:s,cancel:!1};if(this.fire("cellbeginedit",o),!mini.isNull(e.defaultValue)&&(mini.isNull(o.value)||""===o.value)){var r=e.defaultValue,l=mini.clone({d:r});o.value=l.d}i=o.editor;if(s=o.value,o.cancel)return!1;if(!i&&"inline"!=e.editMode)return!1;if(!0===e.readOnly)return!1;if(!1===n)return!0;if("inline"!=e.editMode){if(mini.isNull(s)&&(s=""),i.setValue&&i.setValue(mini.htmlUnescape(s)),i.ownerRowID=t._uid,e.displayField&&i.setText){var a=mini._getMap(e.displayField,t);if(!mini.isNull(e.defaultText)&&(mini.isNull(a)||""===a))a=(l=mini.clone({d:e.defaultText})).d;i.setText(mini.htmlUnescape(a))}this.allowCellEdit&&(this._editingControl=o.editor)}return!0},_OnCellCommitEdit:function(t,e,i,n){var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:n||this.getCellEditor(e),value:mini.isNull(i)?"":i,text:"",cancel:!1};if(s.editor&&s.editor.getValue){try{s.editor.blur()}catch(t){}s.value=s.editor.getValue()}s.editor&&s.editor.getText&&(s.text=s.editor.getText());var o=mini._getMap(e.field,t),r=s.value;if(s.oldValue=o,mini.isEquals(o,r))return s;if(this.fire("cellcommitedit",s),0==s.cancel&&(s.value=mini.htmlEscape(s.value),s.text=mini.htmlEscape(s.text),this.allowCellEdit)){var l={};l[e.field]=s.value,e.displayField&&(l[e.displayField]=s.text),this.updateRow(t,l)}return s},_initData:function(){this.data=this._dataSource.getSource(),this.pageIndex=this.getPageIndex(),this.pageSize=this.getPageSize(),this.totalCount=this.getTotalCount(),this.totalPage=this.getTotalPage(),this.sortField=this.getSortField(),this.sortOrder=this.getSortOrder(),this.url=this.getUrl(),0<this.totalPage&&this.pageIndex>this.totalPage-1&&this.setPageIndex(this.totalPage-1),this._mergedCellMaps={},this._mergedCells={},this._cellErrors=[],this._cellMapErrors={},this.isGrouping()&&(this.groupBy(this._groupField,this._groupDir),this.collapseGroupOnLoad&&this.collapseGroups())},_setEditorBox:function(t,e){if(t.setHeight&&"textarea"==t.type){var i=e.height-2;t.minHeight&&i<t.minHeight&&(i=t.minHeight),t.setHeight(i)}if(t.setWidth){var n=e.width-12;t.minWidth&&n<t.minWidth&&(n=t.minWidth),t.setWidth(n<20?20:n)}var s=e,o=s.y;mini.setXY(this._editWrap,s.x,o+1),mini.setWidth(this._editWrap,s.width-2),mini.setHeight(this._editWrap,s.height-2);var r=document.body.scrollWidth;s.x>r&&mini.setX(this._editWrap,-1e3)}}),$(document).on("keydown",".mini-calendar-timespinner",function(t){var e=t.target;"INPUT"!=e.nodeName&&"TEXTAREA"!=e.nodeName||e.focus()}),mini.overwrite(mini.DatePicker,{defaultTime:"",maxDate:"9999-12-31",minDate:"1753-01-01",showPopup:function(){var t={cancel:!1};if(this.fire("beforeshowpopup",t),1!=t.cancel){this._calendar=this._getCalendar(),this._calendar.beginUpdate(),this._calendar._allowLayout=!1,this._calendar.el.parentNode!=this.popup._contentEl&&this._calendar.render(this.popup._contentEl),this._calendar.set({monthPicker:this._monthPicker,showTime:this.showTime,timeFormat:this.timeFormat,showClearButton:this.showClearButton,showYesterdayButton:this.showYesterdayButton,showTodayButton:this.showTodayButton,showOkButton:this.showOkButton,showWeekNumber:this.showWeekNumber}),this._calendar.setValue(this.value||this.defaultTime),this.value?this._calendar.setViewDate(this.value):this._calendar.setViewDate(this.viewDate);(function(){if(this._calendar.hideMenu(),this._calendar._target){var t=this._calendar._target;this._calendar.un("timechanged",t.__OnTimeChanged,t),this._calendar.un("dateclick",t.__OnDateClick,t),this._calendar.un("drawdate",t.__OnDrawDate,t)}this._calendar.on("timechanged",this.__OnTimeChanged,this),this._calendar.on("dateclick",this.__OnDateClick,this),this._calendar.on("drawdate",this.__OnDrawDate,this),this._calendar.endUpdate(),this._calendar._allowLayout=!0,this._calendar.doLayout(),this._calendar.focus(),this._calendar._target=this}).call(this),mini.DatePicker.superclass.showPopup.call(this)}},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["defaultTime"]),e}}),mini.overwrite(mini.Form,{getValidateFields:function(t){for(var e,i=[],n=this.getFields(),s=0,o=n.length;s<o;s++){var r=n[s];r.validate&&r.isDisplay&&(e=r,!mini.isDisplay(e.el,function(t){if(mini.hasClass(t,"mini-tabs-body")||mini.hasClass(t,"fui-acc-bd")||mini.hasClass(t,"invisible"))return!0})&&!r.forceValidate||(r.enabled||t||r.forceValidate)&&i.push(r))}return i}}),mini.overwrite(mini.ListBox,{getItemText:function(t){var e=mini._getMap(this.textField,t);return mini.isNull(e)?"":mini.htmlDecode(String(e))},_OnDrawCell:function(t,e,i){var n=i?mini._getMap(i.field,t):this.getItemText(t),s={sender:this,index:e,rowIndex:e,record:t,item:t,column:i,field:i?i.field:null,value:n,cellHtml:n,rowCls:null,cellCls:i&&i.cellCls||"",rowStyle:null,cellStyle:i&&i.cellStyle||""};if(this.columns&&0<this.columns.length||0==e&&this.showNullItem&&(s.cellHtml=this.nullItemText),s.cellHtml=mini.htmlEncode(s.cellHtml),i){i.dateFormat&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(n,i.dateFormat):s.cellHtml=n);var o=i.renderer;o&&(fn="function"==typeof o?o:window[o],fn&&(s.cellHtml=fn.call(i,s)))}return this.fire("drawcell",s),null!==s.cellHtml&&void 0!==s.cellHtml&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s}}),mini.overwrite(mini.Menu,{_initEvents:function(){mini._BindEvents(function(){mini.on(document,"mousedown",this.__OnBodyMouseDown,this),mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this),this._disableContextMenu&&mini_onOne(this.el,"contextmenu",function(t){t.preventDefault()},this),mini_onOne(this._topArrowEl,"mousedown",this.__OnTopMouseDown,this),mini_onOne(this._bottomArrowEl,"mousedown",this.__OnBottomMouseDown,this)},this);var t=this;this.on("open",function(){t._onDocumentMousewheel()})},hide:function(){this.hideItems(),this._unDocumentMousewheel(),mini_Popup_prototype_hide.call(this)},_unDocumentMousewheel:function(){mini.un(document,"mousewheel",this.__OnDocumentMousewheel,this),this._mousewheelXY=null},_onDocumentMousewheel:function(){this._unDocumentMousewheel(),this._mousewheelXY=mini.getXY(this.el),mini.on(document,"mousewheel",this.__OnDocumentMousewheel,this)},__OnDocumentMousewheel:function(t){var n=this;setTimeout(function t(){if(n.isPopup){var e=n._mousewheelXY,i=mini.getXY(n.popupEl);e[0]!=i[0]||e[1]!=i[1]?n.hide():setTimeout(t,300)}},300)}}),mini.overwrite(mini.Pager,{update:function(t,e,i){mini.isNumber(t)&&(this.pageIndex=parseInt(t)),mini.isNumber(e)&&(this.pageSize=parseInt(e)),mini.isNumber(i)&&(this.totalCount=parseInt(i)),this.showTotalCount&&(this.totalPage=parseInt(this.totalCount/this.pageSize)+1,(this.totalPage-1)*this.pageSize==this.totalCount&&(this.totalPage-=1),0==this.totalCount&&(this.totalPage=0),0<=this.totalCount&&this.pageIndex>this.totalPage-1&&(this.pageIndex=this.totalPage-1),this.pageIndex<=0&&(this.pageIndex=0),this.totalPage<=0&&(this.totalPage=0)),this.firstButton.enable(),this.prevButton.enable(),this.nextButton.enable(),this.lastButton.enable(),0==this.pageIndex&&(this.firstButton.disable(),this.prevButton.disable()),this.showTotalCount&&this.pageIndex>=this.totalPage-1&&(this.nextButton.disable(),this.lastButton.disable());var n=-1<this.pageIndex?this.pageIndex+1:0;this.showTotalCount&&0==this.totalCount&&(n=0),this.numInput.value=n,this.pagesLabel.innerHTML="/ "+this.totalPage;var s=this.sizeList.clone();-1==s.indexOf(this.pageSize)&&(s.push(this.pageSize),s=s.sort(function(t,e){return t-e}),this.sizeList=s);for(var o=[],r=0,l=s.length;r<l;r++){var a=s[r],h={};h.text=a,h.id=a,o.push(h)}this.sizeCombo.setData(o),this.sizeCombo.setValue(this.pageSize),this.sizeTextEl.innerHTML=this.sizeText,this.sizeTextEl.style.display=this.sizeText?"":"none";var u=this.firstText,d=this.prevText,c=this.nextText,m=this.lastText,f=this.reloadText;0==this.showButtonText&&(u=d=c=m=f=""),this.firstButton.setText(u),this.prevButton.setText(d),this.nextButton.setText(c),this.lastButton.setText(m),this.reloadButton.setText(f),this.firstButton.setIconCls(this.showButtonIcon?"mini-pager-first":""),this.prevButton.setIconCls(this.showButtonIcon?"mini-pager-prev":""),this.nextButton.setIconCls(this.showButtonIcon?"mini-pager-next":""),this.lastButton.setIconCls(this.showButtonIcon?"mini-pager-last":""),this.reloadButton.setIconCls(this.showButtonIcon?"mini-pager-reload":""),this.reloadButton.setVisible(this.showReloadButton);var p=this.reloadButton.el.previousSibling;p&&(p.style.display=this.showReloadButton?"":"none"),this._rightEl.innerHTML=String.format(this.pageInfoText,this.pageSize,this.totalCount),this.indexEl.style.display=this.showPageIndex?"":"none",this.sizeEl.style.display=this.showPageSize?"":"none",this._rightEl.style.display=this.showPageInfo&&this.showTotalCount?"":"none",this.pagesLabel.style.display=this.showTotalCount?"":"none",this.showTotalCount?(this.firstButton.setVisible(0<=this.totalCount),this.lastButton.setVisible(0<=this.totalCount),this.totalCount<0&&(this.firstButton.enable(),this.nextButton.enable(),0==this.pageIndex&&this.firstButton.disable())):(this.firstButton.setVisible(!1),this.lastButton.setVisible(!1))},_OnPageChanged:function(t,e){var i={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};this.showTotalCount&&0<=this.totalCount&&i.pageIndex>this.totalPage-1&&(i.pageIndex=this.totalPage-1),i.pageIndex<0&&(i.pageIndex=0),this.fire("beforepagechanged",i),1!=i.cancel&&(this.fire("pagechanged",i),this.update(i.pageIndex,i.pageSize))},_initEvents:function(){function e(){if(!i){i=!0;var t=parseInt(this.numInput.value);isNaN(t)?(this.update(),n=1):n!=t&&(this._OnPageChanged(t-1),n=t),setTimeout(function(){i=!1},100)}}mini.Pager.superclass._initEvents.call(this),this.firstButton.set({disableMultiClick:!1}).on("click",function(t){this._OnPageChanged(0)},this),this.prevButton.set({disableMultiClick:!1}).on("click",function(t){this._OnPageChanged(this.pageIndex-1)},this),this.nextButton.set({disableMultiClick:!1}).on("click",function(t){this._OnPageChanged(this.pageIndex+1)},this),this.lastButton.set({disableMultiClick:!1}).on("click",function(t){this._OnPageChanged(this.totalPage)},this),this.reloadButton.on("click",function(t){this._OnPageChanged()},this);var i=!1,n=parseInt(this.numInput.value);mini.on(this.numInput,"change",function(t){e.call(this)},this),mini.on(this.numInput,"keydown",function(t){13==t.keyCode&&(e.call(this),t.stopPropagation())},this),this.sizeCombo.on("valuechanged",this.__OnPageSelectChanged,this)}}),mini.overwrite(mini.Panel,{_doTitle:function(){var t=""==this.title?"&nbsp":this.title;this._titleEl.innerHTML=t,this._titleEl.title=mini.htmlUnescape(t),this._iconEl.style.display=this.iconCls||this.iconStyle?"inline":"none",this._iconEl.className="mini-panel-icon mini-icon mini-iconfont "+this.iconCls,mini.setStyle(this._iconEl,this.iconStyle)}}),mini.Popup.prototype.yOffset=2,mini.Popup.prototype._getWindowOffset=function(){return[0,2]},mini.overwrite(mini.PopupEdit,{setText:function(t){null==t&&(t=""),t=mini.htmlDecode(t);this.text;this.text=t,this._textEl.value=t,this._doEmpty()}}),mini.overwrite(mini.ProgressBar,{_create:function(){this.el=document.createElement("div"),this.el.className="mini-progressbar";this.el.innerHTML='<div class="mini-progressbar-border"><div class="mini-progressbar-bar"><div class="mini-progressbar-bar-current"></div></div><div class="mini-progressbar-text"></div></div>',this._borderEl=this.el.firstChild,this._barEl=this._borderEl.firstChild.firstChild,this._textEl=this._borderEl.lastChild}}),function(){var i=mini.Tabs.prototype._createHeaderMenu;mini.Tabs.prototype._createHeaderMenu=function(){var t=i.apply(this,arguments),e=this._headerMenuEl;return this._headerMenu&&e&&(this._headerMenu.on("open",function(){$(e).addClass("popup")}),this._headerMenu.on("close",function(){$(e).removeClass("popup")})),t}}(),mini.overwrite(mini.TextBox,{setVtype:function(t){(-1<t.indexOf("int")||-1<t.indexOf("float")||-1<t.indexOf("decimalLength"))&&(this.inputStyle||this.setInputStyle("text-align: right;")),this.vtype=t},__OnMouseDown:function(t){var e=this;e._textEl.focus(),"textarea"!=this._InputType&&(mini.isAncestor(this._textEl,t.target)||setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e4,1e4)},1))},__OnBlur:function(t){this._focused=!1;var e=this;setTimeout(function(){0==e._focused&&e.removeCls(e._focusCls)},2),mini.isIE&&this.__OnInputTextChanged(),this.fire("blur",{htmlEvent:t}),this.validateOnLeave&&this.isEditable()&&this._tryValidate()},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["mobileErrorText","telErrorText","phoneErrorText","postCodeErrorText","orgCodeErrorText","idCardErrorText","validateErrorText","decimalLengthErroeText"]),e}}),mini.overwrite(mini.TextArea,{__OnMouseDown:function(t){var e=this;e._textEl.focus(),mini.isAncestor(this._textEl,t.target)||setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e3,1e3)},1)}}),mini.overwrite(mini.TextBoxList,{popupYOffset:2,showPopup:function(t){if(0!=this.isDisplay()){this.isShowPopup=!0;var e=this._createPopup();e.el.style.zIndex=mini.getMaxZIndex();var i=this._listbox;i.emptyText=this.popupEmptyText,"loading"==t?(i.emptyText=this.popupLoadingText,this._listbox.setData([])):"error"==t&&(i.emptyText=this.popupLoadingText,this._listbox.setData([])),this._listbox.doUpdate();var n=this.getBox(),s=n.x,o=n.y+n.height;this.popup.el.style.display="block",mini.setXY(e.el,-1e3,-1e3),this.popup.setWidth(n.width),this.popup.setHeight(this.popupHeight);var r=this.popup.getHeight();r>this.popupMaxHeight&&this.popup.setHeight(this.popupMaxHeight),r<this.popupMinHeight&&this.popup.setHeight(this.popupMinHeight),mini.setXY(e.el,s,o+this.popupYOffset)}}}),mini.overwrite(mini.ToolTip,{autoHide:!0,theme:"dark",defaultTheme:"dark",setTheme:function(t){if(t){this.theme=t;var e="mini-tooltip-theme-",i=jQuery.grep(this.el.className.split(" "),function(t){return-1!=t.indexOf(e)}).join(" ");jQuery(this.el).removeClass(i).addClass(e+t)}},getTheme:function(){return this.theme},applyTheme:function(){if(this._target){var t=jQuery(this._target).attr("data-theme");this.setTheme(t||this.defaultTheme)}},setContent:function(t){this.$element.children(".mini-tooltip-inner").html(t||"&nbsp;"),this.applyPlacement(),this.applyTheme()},_bindTooltip:function(){var t=jQuery(this.scope||document),e=this.selector,i="tooltip";this.setTheme(this.theme),t.unbind("."+i);for(var n=this.trigger.split(" "),s=n.length;s--;){var o=n[s];if("click"==o)t.on("click."+i,e,jQuery.proxy(this._toggle,this));else if("manual"!=o){var r="hover"==o?"mouseenter":"focus",l="hover"==o?"mouseleave":"blur";t.on(r+"."+i,e,jQuery.proxy(this._enter,this)),this.autoHide&&t.on(l+"."+i,e,jQuery.proxy(this._leave,this))}}},_toggle:function(t){"none"==this.$element.css("display")?this._enter(t):this._leave(t)},applyPlacement:function(){if(this._target&&"none"!=this.$element.css("display")){var t=this._target,e=jQuery(t).attr("data-placement")||this.placement,i=this.$element;if(t&&i[0]){i.show().css({left:"-2000px",top:"-2000px"});var n=mini.getBox(t),s=mini.getViewportBox(),o=n.top-s.top,r=s.bottom-n.bottom,l=n.left-s.left,a=s.right-n.right;f(e);var h,u=mini.getBox(i[0]),d=mini.getCalculatedOffset(e,n,u.width,u.height);if(0===e.indexOf("bottom")?r<o&&d.top+u.height>s.bottom&&(e=e.replace("bottom","top")):0===e.indexOf("top")&&o<r&&d.top<s.top&&(e=e.replace("top","bottom")),-1!==e.indexOf("left")?a<l&&u.width+d.left>s.width&&(e=e.replace("left","right")):-1!==e.indexOf("right")&&l<a&&(d.left<0||n.left+n.width<u.wihth)&&(e=e.replace("right","left")),"bottom"!==e&&"top"!==e||(a<l&&u.width+d.left>s.width?e+="right":l<a&&(d.left<0||n.left+n.width<u.wihth)&&(e+="left")),f(e),d=mini.getCalculatedOffset(e,n,u.width,u.height),"right"==e||"left"==e){var c=$(i).children(".mini-tooltip-arrow");function m(){var t=n.top+n.height/2-c.height()/2-d.top;c.css("top",t)}c.css("top",""),s=mini.getViewportBox(),d.top<s.y?(d.top=s.y,m()):d.top+u.height>s.bottom&&(d.top=s.bottom-u.height,m())}h=d,i.offset(h)}}function f(t){i.removeClass("mini-tooltip-left mini-tooltip-top mini-tooltip-right mini-tooltip-bottom mini-tooltip-bottomleft mini-tooltip-topleft mini-tooltip-bottomright mini-tooltip-topright").addClass("mini-tooltip-"+t)}},setAutoHide:function(t){this.autoHide!=t&&(this.autoHide=t,this._bindTooltip())},getAutoHide:function(){return this.autoHide},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["theme"]),mini._ParseBool(t,e,["autoHide"]),e}}),mini.overwrite(mini.DataTree,{loadNode:function(r,l){var t={node:this._loadingNode=r};this.fire("beforeloadnode",t);var e=new Date,a=this;a._doLoadAjax(a.loadParams,null,null,null,function(o){var t=new Date-e;t<60&&(t=60-t),setTimeout(function(){o.node=r,a._OnPreLoad(o),a._loadingNode=null,a.loadParams&&delete a.loadParams[a.idField];var t=r[a.nodesField];a.removeNodes(t);var e=o.data;if(e&&0<e.length){a.collapse(r),a.addNodes(e,r);for(var i=a.getAllChildNodes(r),n=0,s=i.length;n<s;n++){delete i[n]._state}!1!==l?a.expand(r,!0):a.collapse(r,!0)}else delete r[a.leafField],a.expand(r,!0);a.fire("loadnode",o),a.fire("load",o)},10)},!0)}}),mini.overwrite(mini.Tree,{showTreeLines:!1,showFullPath:!1,includeRootNode:!1,replaceNodes:function(t,e){var i=e[this.nodesField];this.removeNodes(i),this.addNodes(t,e)},_OnDrawCell:function(t,e,i,n){var s=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);if(this._treeColumn&&this._treeColumn==e.name){var o=s.node;!1===o.ckr&&(s.showCheckBox=!1,s.showRadioButton=!1),this.fire("drawnode",s),s.nodeStyle&&(s.cellStyle=s.nodeStyle),s.nodeCls&&(s.cellCls=s.nodeCls),s.nodeHtml?s.cellHtml=s.nodeHtml:o.textCls&&(s.cellHtml='<span class="'+o.textCls+'">'+s.cellHtml+"</span>"),this._createTreeColumn(s)}return s},getValueAndText:function(t,e){mini.isNull(t)&&(t=[]),e=e||this.delimiter,"string"==typeof t||"number"==typeof t?t=this._dataSource.getsByIds(t):mini.isArray(t)||(t=[t]);for(var i=[],n=[],s=0,o=t.length;s<o;s++){var r=t[s];r&&(i.push(this.getItemValue(r)),n.push(this.getItemText(r)))}return[i.join(e),n.join(e)]},getItemValue:function(t){if(!t)return"";var e=mini._getMap(this.idField,t);return mini.isNull(e)?"":String(e)},getItemText:function(t){if(!t)return"";var e="";return e=this.showFullPath?this.getFullPath(t):mini._getMap(this.textField,t),mini.isNull(e)?"":String(e).replace(/<\/?.+?>/g,"")},getFullPath:function(t){if(t.fullPath)return t.fullPath;for(var e=this.getAncestors(t),i="",n=0,s=e.length;n<s;n++)0==n&&!this.includeRootNode||(i+=mini._getMap(this.textField,e[n])+"-");return t.fullPath=i+=mini._getMap(this.textField,t),i},getText:function(){var t=[];this.showCheckBox?t=this.getCheckedNodes():(o=this.getSelectedNode())&&t.push(o);for(var e=[],i=this.getTextField(),n=0,s=t.length;n<s;n++){var o=t[n];e.push(o[i].replace(/<\/?.+?>/g,""))}return e.join(",")}}),mini.overwrite(mini.TreeGrid,{showSortIcon:!0,_setEditorBox:function(t,e){mini.DataGrid.prototype._setEditorBox.call(this,t,e)}}),function(i){var t=mini.TreeGrid.prototype._initEvents;mini.TreeGrid.prototype._initEvents=function(){t.call(this);var e=this;this.on("layout",function(){if(e.allowAlternating){var t=i(e._contentEl).find(".mini-grid-rows-content > .mini-grid-table > tbody");t.find("> .mini-grid-row").each(function(t,e){t%2==1&&i(e).addClass("mini-grid-row-alt")}),t.find("> .mini-tree-nodes-tr").each(function(t,e){i(e).prev().addClass("mini-treegrid-expandRow")})}else i(e.el).find(".mini-grid-row-alt").removeClass("mini-grid-row-alt")})}}(jQuery),mini._ValidateVType=function(t,e,i,n){(-1<t.indexOf("int")||-1<t.indexOf("float"))&&-1==t.indexOf("range")&&(t+=";range:0,"+mini._maximumNumber),-1<t.indexOf("float")&&-1==t.indexOf("rangeLength")&&(t+=";rangeLength:0,16"),-1<t.indexOf("decimalLength")&&-1==t.indexOf("range")&&(t+=";range:0,"+Math.floor(mini._maximumNumber/100));for(var s=t.split(";"),o=0,r=s.length;o<r;o++){var l=(t=s[o].trim()).split(":"),a=l[0],h=t.substr(a.length+1,1e3);h=h?h.split(","):[];var u=mini.VTypes[a];if(u)if(!0!==u(e,h)){i.isValid=!1;var d=l[0]+"ErrorText";i.errorText=n.validateErrorText||n[d]||mini.VTypes[d]||"",i.errorText=String.format(i.errorText,h[0],h[1],h[2],h[3],h[4]);break}}},mini._maximumNumber=999999999999999,jQuery.extend(mini.VTypes,{mobileErrorText:"",telErrorText:"",phoneErrorText:"",phoneWithShortNumErrorText:"",postCodeErrorText:"",orgCodeErrorText:"",idCardErrorText:"",decimalLengthErrorText:"{0}",projectCodeErrorText:"",decimalLength:function(t,e){if(0==mini.VTypes.float(t,e))return!1;if(mini.isNull(t)||""===t)return!0;var i=parseInt(e);if(!t||isNaN(i))return!0;var n=(t=String(t)).split(".");return 1==n.length||n[1].length<=i},mobile:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^1[3456789]\d{9}$/.test(t)},tel:function(t,e){return!(!mini.isNull(t)&&""!==t)||(/^0\d{2,3}-?\d{7,8}$/.test(t)||/^\(0\d{2,3}\)\d{7,8}$/.test(t))},phone:function(t,e){return!(!mini.isNull(t)&&""!==t)||(/^1[3456789]\d{9}$/.test(t)||/^0\d{2,3}-?\d{7,8}$/.test(t)||/^\(0\d{2,3}\)\d{7,8}$/.test(t))},phoneWithShortNum:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^\d[\d-]{2,10}(?!-)$/.test(t)},postCode:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^\d{6}$/.test(t)},orgCode:function(t,e){if(mini.isNull(t)||""===t)return!0;if(/^[A-Z0-9]{8}-[A-Z0-9]$/.test(t))return!0;return!!/^(?![IOSV])([0-9A-Y])([1239])([0-9]{6})(((?![IOSV])[0-9A-Y]){10})$/.test(t)},idCard:function(t,e){if(mini.isNull(t)||""===t)return!0;return function(t){if(!/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/.test(t))return!1;if(18==t.length){for(var e=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),i=new Array(1,0,10,9,8,7,6,5,4,3,2),n=0,s=0;s<17;s++)n+=t.substring(s,s+1)*e[s];var o=n%11,r=t.substring(17);return 2==o?"X"==r||"x"==r:r==i[o]}}(t)},projectCode:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^(19|20)\d{2}-\d{6}-\d{2}-\d{2}-\d{6}$/.test(t)}}),mini.overwrite(mini.Window,{showRefreshButton:!1,maskOnLoad:!1,_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);var e=this.createButton({name:"min",cls:"mini-tools-min",visible:this.showMinButton});this.buttons.push(e);var i=this.createButton({name:"max",cls:"mini-tools-max",visible:this.showMaxButton});this.buttons.push(i);var n=this.createButton({name:"refresh",cls:"mini-tools-refresh",visible:this.showRefreshButton});this.buttons.push(n);var s=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(s)},_OnButtonClick:function(t,e){var i=mini.Window.superclass._OnButtonClick.call(this,t,e);return 1==i.cancel||("max"==i.name?"max"==this.state?this.restore():this.max():"refresh"==i.name?this.refresh():"close"==i.name&&this.fire("close")),i},refresh:function(){return this.reload(),this},restore:function(){this.state="restore",this.show(this.x,this.y);var t=this.getButton("max");t&&(t.cls="mini-tools-max",this._doTools()),this.fire("restore")},setShowRefreshButton:function(t){this.showRefreshButton=t;var e=this.getButton("refresh");e&&(e.visible=t,this._doTools())},getShowRefreshButton:function(){return this.showRefreshButton},doLayout:function(){if(this.canLayout()){if("max"==this.state){var t=this.getParentBox();this.el.style.left="10px",this.el.style.top="10px",mini.setSize(this.el,t.width-20,t.height-20)}mini.Window.superclass.doLayout.call(this),this.allowDrag&&mini.addClass(this.el,this._dragCls),"max"==this.state&&(this._resizeGridEl.style.display="none",mini.removeClass(this.el,this._dragCls)),this._doModal()}},_doTitle:function(){var t=""==this.title?"&nbsp":this.title;this._titleEl.innerHTML=t,this._titleEl.title=t,this._iconEl.style.display=this.iconCls||this.iconStyle?"inline":"none",this._iconEl.className="mini-panel-icon mini-icon mini-iconfont "+this.iconCls,mini.setStyle(this._iconEl,this.iconStyle)},getExtraAttrs:function(t){var e={};mini._ParseString(t,e,["onrestore","onclose"]),mini._ParseBool(t,e,["showRefreshButton"])}}),mini.overwrite(mini.MessageBox,{show:function(e){(e=mini.copyTo({width:"360",height:"226",customCls:"",showModal:!0,timeout:0,minWidth:150,maxWidth:800,minHeight:50,maxHeight:350,showHeader:!0,title:"",titleIcon:"",iconCls:"",iconStyle:"",message:"",html:"",spaceStyle:"",showCloseButton:!0,buttons:null,buttonWidth:null,callback:null,showNoTipCheck:!1,clickNoTipCheck:!1},e)).message=String(e.message);var i=e.callback,n=new mini.Window;e.customCls&&n.addCls(e.customCls),n.addCls("mini-messagebox"),n.setBodyStyle("overflow:hidden"),n.setShowModal(e.showModal),n.setTitle(e.title||""),n.setIconCls(e.titleIcon),n.setShowHeader(e.showHeader),n.setShowCloseButton(e.showCloseButton);var t=n.uid+"$table",s=n.uid+"$content",o='<i class="mini-messagebox-icon mini-iconfont '+e.iconCls+'" style="'+e.iconStyle+'"></i><p class="mini-messagebox-msg">'+(e.message||"")+"</p>";n._bodyEl.innerHTML='<div class="mini-messagebox-content"></div><div class="mini-messagebox-buttons"></div>';var r=n._bodyEl.firstChild;if(e.html?"string"==typeof e.html?r.innerHTML=e.html:mini.isElement(e.html)&&r.appendChild(e.html):(r.innerHTML=o,n._content=r.lastChild),e.showNoTipCheck){var l=n._bodyEl.lastChild;l.innerHTML='<label class="mini-messagebox-checkbox"><input type="checkbox"></label>',mini.on(l.firstChild,"click",function(){if(e.clickNoTipCheck){var t=this.firstChild.checked;e.clickNoTipCheck.apply(this,[t])}})}n._Buttons=[];var a=n._bodyEl.lastChild;if(e.buttons&&0<e.buttons.length)for(var h=0,u=e.buttons.length;h<u;h++){var d=e.buttons[h],c=mini.MessageBox.buttonText[d];c=c||d;var m=new mini.Button;m.setText(c),m.setWidth(e.buttonWidth),m.render(a),m.action=d,m.on("click",function(t){var e=t.sender;i&&!1===i(e.action)||mini.MessageBox.hide(n)}),h!=u-1&&m.setStyle(e.spaceStyle),m.setCls("mini-messagebox-button"),"ok"==d&&(m.setCls("ok"),m.setCls("mini-btn-primary")),n._Buttons.push(m)}else a.style.display="none";n.setMinWidth(e.minWidth),n.setMinHeight(e.minHeight),n.setMaxWidth(e.maxWidth),n.setMaxHeight(e.maxHeight),n.setWidth(e.width),n.setHeight(e.height),n.show(e.x,e.y,{animType:e.animType});var f=n.getWidth();n.setWidth(f+"px");var p=$(r).outerHeight(!0),g=p?p+($(n._headerEl).is(":visible")?$(n._headerEl).outerHeight(!0):0)+($(a).is(":visible")?$(a).outerHeight(!0):0):n.getHeight();n.setHeight(g+"px");var _=document.getElementById(t);_&&(_.style.width="100%");var v=document.getElementById(s);if(v&&(v.style.width="100%"),mini.MessageBox.autoFocus){var w=n._Buttons[0];w?w.focus():n.focus()}return n.on("beforebuttonclick",function(t){i&&i("close"),t.cancel=!0,mini.MessageBox.hide(n)}),mini.on(n.el,"keydown",function(t){27==t.keyCode&&(i&&i("close"),mini.MessageBox.hide(n))}),e.timeout&&setTimeout(function(){mini.MessageBox.hide(n.uid)},e.timeout),n.uid},prompt:function(t,e,i,n){var s="prompt$"+(new Date).getTime(),o=t||mini.MessageBox.promptMessage;o=n?'<label class="mini-prompt-label">'+o+'</label><textarea id="'+s+'" class="mini-prompt-input"></textarea>':'<label class="mini-prompt-label">'+o+'</label><input type="text" id="'+s+'" class="mini-prompt-input">';var r=mini.MessageBox.show({title:e||mini.MessageBox.promptTitle,buttons:["ok","cancel"],width:250,html:'<div class="mini-messagebox-prompt" >'+o+"</div>",callback:function(t){var e=document.getElementById(s);if(i)return i(t,e.value)}});return document.getElementById(s).focus(),r},confirm:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.confirmTitle,buttons:["cancel","ok"],message:t,iconCls:"mini-messagebox-question",callback:i})}}),mini.prompt=mini.MessageBox.prompt,mini.showMessageBox=mini.MessageBox.show,mini.confirm=mini.MessageBox.confirm,mini.supportRem,mini.supportRem&&mini.overwrite(mini.Window,{setWidth:function(t){parseInt(t,10)==t&&(t=parseFloat(t/100/mini.getFontSizeRatio())+"rem"),this.width=t,this.el.style.width=t,this._sizeChanged()},setHeight:function(t){parseInt(t,10)==t&&(t=parseFloat(t/100/mini.getFontSizeRatio())+"rem"),this.height=t,this.el.style.height=t,this._sizeChanged()}}),mini.CatalogImport=function(){mini.CatalogImport.superclass.constructor.call(this)},mini.extend(mini.CatalogImport,mini.Control,{uiCls:"mini-catalogimport",url:"",pickerText:"",_create:function(){this.el=document.createElement("div"),this.uploader=new mini.WebUploader,this.uploader.set({uploadUrl:this.url,pickerText:this.pickerText,fileNumLimit:1,limitType:"xls,xlsx,xlsm",showDefaultUI:!1,auto:!1,renderTo:this.el}),this.uploader.on("beforefilequeued",this._onBeforeFileQueued,this),this.uploader.on("filesqueued",this._onFilesQueued,this),this.uploader.on("uploadbeforesend",this._onUploadBeforeSend,this),this.uploader.on("uploadprogress",this._onUploadProgress,this),this.uploader.on("uploadsuccess",this._onUploadSuccess,this),this.uploader._uploadBtn.hide(),this.fileList=document.createElement("div"),this.fileList.className="mini-catalogimport-filelist",this.el.appendChild(this.fileList),this._bindEvent()},_bindEvent:function(){var t=this;jQuery(this.fileList).on("click",".catalogimport-delete",function(){$(this).closest(".mini-catalogimport-item").remove(),t.uploader.clearFile()}).on("click",".catalogimport-export",function(){t.fire("exportresult",{attachGuid:t._curAttachGuid})})},_onFilesQueued:function(t){var i=t.files[0],n=this;if(i){var e=this._generateFileList({id:i.id,name:i.name,size:i.size});this.isImportFinished=!1,jQuery(e).appendTo(this.fileList),this.uploader._uploader.md5File(i).progress(function(t){}).then(function(t){var e={fileMD5:n._curFileMD5=t,fileName:i.name,fileSize:i.size};e[n.uploader.id+"_action"]="queryFileStatus",n.uploader.getCommonData&&(e.commonDto=mini.encode(n.uploader.getCommonData())),n._onPostFileMd5(e),$.ajax(n.url,{dataType:"json",data:e,type:"post",success:function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),n._onQueryFileStatus(t)}})})}},_onPostFileMd5:function(t){this.fire("postfilemd5",{data:t})},_curFileMD5:"",_curAttachGuid:"",_onQueryFileStatus:function(t){t.msg&&mini.alert(t.msg),this.setDetailStatus(t.detail),this._curAttachGuid=t.attachGuid,this._oldAttachGuid=t.attachGuidOld,t.end?this._onFinished(t.status):(t.pollingFrequency&&(this._pollingFrequency=t.pollingFrequency),"importStatus"==t.action?this.pollingStatus(t):"upload"==t.action?this.uploader._uploader.upload():jQuery(this.fileList).find(".mini-catalogimport-action").removeClass("hidden"))},_onUploadBeforeSend:function(t){this.isContinueImport&&(t.data.attachGuid=this._curAttachGuid),t.data.fileMD5=this._curFileMD5},_onUploadProgress:function(t){var e=t.file,i=t.percentage,n=mini.byId(e.id),s=jQuery(".mini-catalogimport-progressbar",n),o=jQuery(".progress-text",s),r=jQuery(".progress-body",s),l=Math.round(100*i)+"%";o.text(l),r.width(l)},_generateFileList:function(t){var e=[];return e.push('<div class="mini-catalogimport-item" id="'+t.id+'">'),e.push('<span class="mini-catalogimport-info">'+t.name+"</span>"),e.push('<span class="mini-catalogimport-size">('+this._getSize(t.size)+")</span>"),e.push('<span class="mini-catalogimport-action hidden"><a href="javascript:void(0)" class="catalogimport-delete"></a></span>'),e.push('<span class="mini-catalogimport-status"></span>'),e.push('<span class="mini-catalogimport-progressbar"><span class="progress-text">0%</span><div class="progress-body"></div></span>'),e.push("</div>"),e.join("")},_onPollingStatus:function(t){if(t.status){var e,i=mini.byId(this._currentFileId),n=jQuery(".mini-catalogimport-status",i),s=jQuery(".mini-catalogimport-progressbar",i),o=jQuery(".progress-text",s),r=jQuery(".progress-body",s);n.text(t.status),0<=t.handlepercent?(e=t.handlepercent+"%",s.removeClass("hidden"),o.text(e),r.width(e)):s.addClass("hidden")}},_generateStatuslist:function(t){var e,i,n,s=!0,o=!0,r=['<div class="catalogimport-status-item">'];if(r.push('<h3 class="catalogimport-status-title">'+t.sheetName+"</h3>"),r.push('<h4 class="catalogimport-status-type"></h4>'),r.push('<p class="catalogimport-status-count">'+t.checkCount+""+t.checkSuccessCount+""+t.checkErrorCount+""),(n=t.checkMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="catalogimport-status-toggle"></a></p>'),r.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else s=!1;if(t.saveCount)if(s||(r.push("</p>"),s=!0),r.push('<h4 class="catalogimport-status-type"></h4>'),r.push('<p class="catalogimport-status-count">'+t.saveCount+""+t.saveSuccessCount+""+t.saveErrorCount+""),(n=t.saveMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="catalogimport-status-toggle"></a></p>'),r.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else o=!1;if((n=t.taskMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="catalogimport-status-toggle"></a></p>'),r.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else s&&o||r.push("</p>");return r.push("</div>"),r.join("")},_getSize:function(t){return 1048576<(t=parseInt(t))?(t/1048576).toFixed(2)+"M":(t/1024).toFixed(2)+"K"},_pollingFrequency:1e3,_oldAttachGuid:"",_onUploadSuccess:function(t){var e=t.ret,i=t.file;if(mini.getSecondRequestData&&(e=mini.getSecondRequestData(e)),e=(e=e.data||e).extraDatas||e,this._pollingFrequency=e.pollingFrequency,"importStatus"==e.action)return this._curAttachGuid=e.attachGuid,this._oldAttachGuid=e.attachGuidOld,e.fileId=i.id,void this.pollingStatus(e);var n=this;mini.alert("","",function(){n._onFinished(e)})},_onFinished:function(t){var e=t.status||"",i=t.success;this.isImportFinished=!0;var n=mini.byId(this._currentFileId),s=jQuery(".mini-catalogimport-status",n),o=jQuery(".mini-catalogimport-progressbar",n),r=jQuery(".mini-catalogimport-action",n);s.text(e),o.addClass("hidden"),i?setTimeout(function(){s.addClass("hidden")},1e3):(s.addClass("error"),s.append('<a class="catalogimport-export"></a>'),r.removeClass("hidden")),this._events.importfinished&&this.fire("importfinished",t)},_onBeforeFileQueued:function(t){this._events.beforefilequeued&&this.fire("beforefilequeued",t)},_currentFileId:"",pollingStatus:function(t){t.fileId&&(this._currentFileId=t.fileId),this._onPollingStatus(t);var e=this,i={fileMD5:this._curFileMD5,attachGuid:this._curAttachGuid,attachGuidOld:this._oldAttachGuid};i[this.uploader.id+"_action"]="importStatus",this.uploader.getCommonData&&(i.commonDto=mini.encode(this.uploader.getCommonData())),jQuery.ajax({url:this.url,data:i,type:"POST",dataType:"json"}).done(function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),t.msg&&mini.alert(t.msg),t.end?e._onFinished(t):setTimeout(jQuery.proxy(e.pollingStatus,e,t),e._pollingFrequency),e.setDetailStatus(t.detail)})},setDetailStatus:function(t){this.detailStatus=t,this.isDetailShow&&this.renderDetailStatus()},renderDetailStatus:function(){var t,e=this.detailStatus,i=[],n=0;if(e)for(t=e.length;n<t;n++)i.push(this._generateStatuslist(e[n]));this.detailContent.innerHTML=i.join("")},showDetailStatus:function(){this.renderDetailStatus(),this.detailEl.style.display="block",this.isDetailShow=!0},hideDetailStatus:function(){this.detailEl.style.display="none",this.isDetailShow=!1},setUrl:function(t){this.url=t,this.uploader&&this.uploader.setUploadUrl(t)},getUrl:function(){return this.url},setPickerText:function(t){},setEnabled:function(t){mini.CatalogImport.superclass.setEnabled.call(this,t),this.uploader&&this.uploader.setEnabled(t)},getAttrs:function(t){var e=mini.CatalogImport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","pickerText","onbeforefilequeued","onpostfilemd5","onimportfinished","onexportresult"]),e}}),mini.regClass(mini.CatalogImport,"catalogimport"),function(l){function e(t){this.value={h:1,s:1,b:1,a:1},this.setColor(t)}e.prototype={constructor:e,setColor:function(o){o=o.toLowerCase();var r=this;l.each(h.stringParsers,function(t,e){var i=e.re.exec(o),n=i&&e.parse(i),s=e.space||"rgba";if(n)return r.value="hsla"===s?h.RGBtoHSB.apply(null,h.HSLtoRGB.apply(null,n)):h.RGBtoHSB.apply(null,n),!1})},setHue:function(t){this.value.h=1-t},setSaturation:function(t){this.value.s=t},setLightness:function(t){this.value.b=1-t},setAlpha:function(t){this.value.a=parseInt(100*(1-t),10)/100},toRGB:function(t,e,i,n){var s,o,r,l,a;return t||(t=this.value.h,e=this.value.s,i=this.value.b),t=(t*=360)%360/60,s=o=r=i-(a=i*e),s+=[a,l=a*(1-Math.abs(t%2-1)),0,0,l,a][t=~~t],o+=[l,a,a,l,0,0][t],r+=[0,0,l,a,a,l][t],{r:Math.round(255*s),g:Math.round(255*o),b:Math.round(255*r),a:n||this.value.a}},toHex:function(t,e,i,n){var s=this.toRGB(t,e,i,n);return"#"+(1<<24|parseInt(s.r)<<16|parseInt(s.g)<<8|parseInt(s.b)).toString(16).substr(1)},toHSL:function(t,e,i,n){t||(t=this.value.h,e=this.value.s,i=this.value.b);var s=(2-e)*i,o=e*i;return 1<(o/=0<s&&s<=1?s:2-s)&&(o=1),{h:t,s:o,l:s/=2,a:n||this.value.a}}};function o(t,e){this.element=l(t);var i=e.format||this.element.data("color-format")||"hex";this.format=h.translateFormats[i],this.isInput=this.element.is("input"),this.component=!!this.element.is(".color")&&this.element.find(".add-on"),this.picker=l(h.template).appendTo("body").on("mousedown",l.proxy(this.mousedown,this)),this.isInput?this.element.on({focus:l.proxy(this.show,this),keyup:l.proxy(this.update,this)}):this.component?this.component.on({click:l.proxy(this.show,this)}):this.element.on({click:l.proxy(this.show,this)}),"rgba"!==i&&"hsla"!==i||(this.picker.addClass("alpha"),this.alpha=this.picker.find(".colorpicker-alpha")[0].style),this.component?(this.picker.find(".colorpicker-color").hide(),this.preview=this.element.find("i")[0].style):this.preview=this.picker.find("div:last")[0].style,this.base=this.picker.find("div:first")[0].style,this.update()}o.prototype={constructor:o,show:function(t){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),l(window).on("resize",l.proxy(this.place,this)),this.isInput||t&&(t.stopPropagation(),t.preventDefault()),l(document).on({mousedown:l.proxy(this.hide,this)}),this.element.trigger({type:"show",color:this.color})},update:function(){this.color=new e(this.isInput?this.element.prop("value"):this.element.data("color")),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor()},setValue:function(t){this.color=new e(t),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor(),this.element.trigger({type:"changeColor",color:this.color})},hide:function(){this.picker.hide(),l(window).off("resize",this.place),this.isInput?this.element.prop("value",this.format.call(this)):(l(document).off({mousedown:this.hide}),this.component&&this.element.find("input").prop("value",this.format.call(this)),this.element.data("color",this.format.call(this))),this.element.trigger({type:"hide",color:this.color})},place:function(){var t=this.component?this.component.offset():this.element.offset();this.picker.css({top:t.top+this.height,left:t.left})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(t){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},pointer:null,slider:null,mousedown:function(t){t.stopPropagation(),t.preventDefault();var e=l(t.target).closest("div");if(!e.is(".colorpicker")){if(e.is(".colorpicker-saturation"))this.slider=l.extend({},h.sliders.saturation);else if(e.is(".colorpicker-hue"))this.slider=l.extend({},h.sliders.hue);else{if(!e.is(".colorpicker-alpha"))return!1;this.slider=l.extend({},h.sliders.alpha)}var i=e.offset();this.slider.knob=e.find("i")[0].style,this.slider.left=t.pageX-i.left,this.slider.top=t.pageY-i.top,this.pointer={left:t.pageX,top:t.pageY},l(document).on({mousemove:l.proxy(this.mousemove,this),mouseup:l.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(t){t.stopPropagation(),t.preventDefault();var e=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((t.pageX||this.pointer.left)-this.pointer.left))),i=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((t.pageY||this.pointer.top)-this.pointer.top)));return this.slider.knob.left=e+"px",this.slider.knob.top=i+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,e/100),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,i/100),this.previewColor(),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),l(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1}},l.fn.colorpicker=function(n,s){return this.each(function(){var t=l(this),e=t.data("colorpicker"),i="object"==typeof n&&n;e||t.data("colorpicker",e=new o(this,l.extend({},l.fn.colorpicker.defaults,i))),"string"==typeof n&&e[n](s)})},l.fn.colorpicker.defaults={},l.fn.colorpicker.Constructor=o;var h={translateFormats:{rgb:function(){var t=this.color.toRGB();return"rgb("+t.r+","+t.g+","+t.b+")"},rgba:function(){var t=this.color.toRGB();return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},hsl:function(){var t=this.color.toHSL();return"hsl("+Math.round(360*t.h)+","+Math.round(100*t.s)+"%,"+Math.round(100*t.l)+"%)"},hsla:function(){var t=this.color.toHSL();return"hsla("+Math.round(360*t.h)+","+Math.round(100*t.s)+"%,"+Math.round(100*t.l)+"%,"+t.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(t,e,i,n){var s,o;return t/=255,e/=255,i/=255,{h:((0==(o=(s=Math.max(t,e,i))-Math.min(t,e,i))?null:s==t?(e-i)/o:s==e?(i-t)/o+2:(t-e)/o+4)+360)%6*60/360||1,s:0==o?0:o/s,b:s,a:n||1}},HueToRGB:function(t,e,i){return i<0?i+=1:1<i&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t},HSLtoRGB:function(t,e,i,n){var s;e<0&&(e=0);var o=2*i-(s=i<=.5?i*(1+e):i+e-i*e),r=t+1/3,l=t,a=t-1/3;return[Math.round(255*h.HueToRGB(o,s,r)),Math.round(255*h.HueToRGB(o,s,l)),Math.round(255*h.HueToRGB(o,s,a)),n||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1]/360,t[2]/100,t[3]/100,t[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(window.jQuery),mini.ColorPicker=function(){mini.ColorPicker.superclass.constructor.call(this)},mini.extend(mini.ColorPicker,mini.Control,{value:"#ff0000",format:"hex",allowInput:!1,uiCls:"mini-colorpicker",_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<span class="mini-colorpicker-indication"><i></i></span>',this._valueBox=new mini.TextBox,this._indication=this.el.lastChild.firstChild,this._valueBox.setValue(this.value),this.allowInput||this._valueBox.setAllowInput(!1),this._valueBox.render(this.el,"prepend"),jQuery(this._indication).css("background",this.value),this.colorPicker=jQuery(this.el).attr("data-color",this.value).colorpicker({format:this.format})},_initEvents:function(){var e=this;this.colorPicker.on("changeColor",function(t){e.value=e._getValue(t.color),e._valueBox.setValue(e.value),jQuery(e._indication).css("background",e.value),e.fire("valuechanged",{sender:e,value:e.value,type:"valuechanged"})}),this._valueBox.on("blur",function(t){e.colorPicker.colorpicker("setValue",e._valueBox.getValue())})},_getValue:function(t){var e="";switch(this.format){case"rgb":e="rgb("+(i=t.toRGB()).r+","+i.g+","+i.b+")";break;case"rgba":var i;e="rgba("+(i=t.toRGB()).r+","+i.g+","+i.b+","+i.a+")";break;case"hsl":var n=t.toHSL();e="hsl("+Math.round(360*n.h)+","+Math.round(100*n.s)+"%,"+Math.round(100*n.l)+"%)";break;case"hsla":n=t.toHSL();e="hsla("+Math.round(360*n.h)+","+Math.round(100*n.s)+"%,"+Math.round(100*n.l)+"%,"+n.a+")";break;case"hex":e=t.toHex()}return e},setValue:function(t){this.colorPicker.colorpicker("setValue",t)},getValue:function(){return this.value},setFormat:function(t){this.colorPicker.colorpicker({format:t}),this.format=t,this.setValue(this.value)},getFormat:function(){return this.format},setAllowInput:function(t){this._valueBox.setAllowInput(t),this.allowInput=t},getAllowInput:function(){return this.allowInput},getAttrs:function(t){var e=mini.ColorPicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onvaluechanged","format"]),mini._ParseBool(t,e,["allowInput"]),e}}),mini.regClass(mini.ColorPicker,"colorpicker"),mini.DataExport=function(){mini.DataExport.superclass.constructor.call(this)},mini.extend(mini.DataExport,mini.Control,{gridId:"",exportUrl:"",fileName:"",position:"right",uiCls:"mini-dataexport",columnsValue:"",columnsText:"",paramName:"exportParams",dynamicColumns:!1,expandText:"",collapseText:"",exportText:" ",leftListTitle:"",rightListTitle:"",fromText:"",pageNumInfo:"",pageText:"",_create:function(){this.el=document.createElement("div"),this.button=new mini.Button,this.button.set({text:this.collapseText,iconCls:"icon-upload"}),this.button.render(this.el),this.panel=new mini.Panel,this.panel.set({width:370,showToolbar:!1,showFooter:!1,showHeader:!1}),this.panel.render(this.el);var t=['<div class="mini-export-list"><div class="mini-export-left"></div><div class="mini-export-middle"></div><div class="mini-export-right"></div></div>'];t.push('<div class="mini-export-line"><div id="'+this.id+'-rbl" class="mini-radiobuttonlist" repeatItems="1" repeatLayout="table" ></div></div>'),t.push('<a id="'+this.id+'-action" class="mini-button mini-btn-primary mini-export-btn">'+this.exportText+"</a>"),t.push('<div style="display:none;"></div>'),this.panel.setBody(t.join("")),this._panel=this.panel.el,mini.addClass(this._panel,"hidden"),this._exportBtn=mini.get(this.id+"-action",this._panel);var e=this.panel.getBodyEl();this._listContent=e.firstChild,this._exportRbl=mini.get(this.id+"-rbl",this._panel),this._exportRbl.setData([{text:"",id:"0"},{text:"",id:"1"},{text:"",id:"2"},{text:this.fromText+'<input type="text" class="mini-export-num" id="'+this.id+'-fromnum"/>'+this.pageNumInfo+'<input type="text" class="mini-export-num" id="'+this.id+'-tonum"/>'+this.pageText,id:"3"}]),this._radioTrs=this._exportRbl._innerEl.getElementsByTagName("tr"),this._rowTr=this._radioTrs[0],this._curPageTr=this._radioTrs[2],this._pageTr=this._radioTrs[3],this._fromNumInput=mini.byId(this.id+"-fromnum",this._pageTr),this._toNumInput=mini.byId(this.id+"-tonum",this._pageTr),this._exportFormWrap=e.lastChild,this._exportFormWrap.innerHTML='<form method="post" target="exportIFrame"><input type="hidden" name="'+this.paramName+'" /></form><iframe id="exportIFrame" name="exportIFrame" style="display:none;"></iframe>',this._exportForm=this._exportFormWrap.firstChild,this._exportFormField=this._exportForm.firstChild,this._exportIframe=this._exportFormWrap.lastChild,this._contentL=this._listContent.firstChild,this._contentM=this._listContent.childNodes[1],this._contentR=this._listContent.lastChild,this._contentL.innerHTML='<div class="mini-export-list-header">'+this.leftListTitle+'</div><div class="mini-export-list-content"></div>',this._contentR.innerHTML='<div class="mini-export-list-header">'+this.rightListTitle+'</div><div class="mini-export-list-content"></div>',this.leftListBox=new mini.ListBox,this.leftListBox.set({height:115,width:146,valueField:"field"}),this.leftListBox.render(this._contentL.lastChild),this.rightListBox=new mini.ListBox,this.rightListBox.set({height:115,width:146,valueField:"field"}),this.rightListBox.render(this._contentR.lastChild),this._initButtons()},_initEvents:function(){var s=this;this.button.on("click",function(){mini.hasClass(s._panel,"hidden")?s.showPanel():s.hidePanel()}),this._exportBtn.on("click",function(t){s._OnExport(t)}),mini.on(this._fromNumInput,"blur",function(){if(s.dataGrid){var t=s.dataGrid.getPageIndex()+1,e=s.dataGrid.getTotalPage(),i=parseInt(s._toNumInput.value,10),n=parseInt(this.value,10);n?e<n&&(n=e):n=t,i<n&&(n=i),this.value=n}}),mini.on(this._toNumInput,"blur",function(){if(s.dataGrid){s.dataGrid.getPageIndex();var t=s.dataGrid.getTotalPage(),e=parseInt(s._fromNumInput.value,10),i=parseInt(this.value,10);(!i||t<i)&&(i=t),i<e&&(i=e),this.value=i}}),mini.on(document,"mouseup",this._OnDocMouseUp,this),mini.on(this._exportIframe,"load",function(){s.fire("exportsuccess")})},_getExportData:function(){var t={columns:this.rightListBox.data,fileName:this.fileName};if(t.fileName||window.console&&window.console.error&&console.error("filename"),this.gridId){this.dataGrid||(this.dataGrid=mini.get(this.gridId));var e=this._exportRbl.value,i=this.dataGrid.getPageSize(),n=this.dataGrid.getTotalCount(),s=this.dataGrid.getSortField(),o=this.dataGrid.getSortOrder(),r=this.dataGrid.getTotalPage()-1,l=0,a=0,h=this.dataGrid.getPageIndex();switch(e){case"0":a=l=h,t.idField=this.dataGrid.idField,t.checkedRows={},t.checkedRows[this.dataGrid.idField]=this._getSelectedGridIds();break;case"1":l=0,a=r;break;case"2":a=l=h;break;case"3":l=parseInt(this._fromNumInput.value,10)-1,a=parseInt(this._toNumInput.value)-1,mini.isNumber(l)||(l=h),(!mini.isNumber(a)||a<l)&&(a=r)}mini.copyTo(t,{fromIndex:l,toIndex:a,pageSize:i,totalCount:n,sortField:s,sortOrder:o})}return t},_getSelectedGridIds:function(){var t=[],e=[],i=this.dataGrid.idField;this.dataGrid&&(e=this.dataGrid.getSelecteds());for(var n=0,s=e.length;n<s;n++){var o=e[n];t.push(o[i])}return t.join(",")},_OnExport:function(t){var e={htmlEvent:t,data:this._getExportData()};this.fire("beforeexport",e),this._exportFormField.value="string"==typeof e.data?e.data:mini.encode(e.data),this._exportForm.submit(),this.hidePanel()},_OnDocMouseUp:function(t){mini.isAncestor(this.el,t.target)||this.hidePanel()},_initButtons:function(){this._contentM.innerHTML='<button class="mini-export-listbtn mini-icon right" type="button"></button><button class="mini-export-listbtn mini-icon right-all" type="button"></button><button class="mini-export-listbtn mini-icon left" type="button"></button><button class="mini-export-listbtn mini-icon left-all" type="button"></button>';var n=this;mini.on(this._contentM,"click",function(t){var e,i=t.target;mini.hasClass(i,"right")?(e=n.leftListBox.getSelecteds(),n.leftListBox.removeItems(e),n.rightListBox.addItems(e)):mini.hasClass(i,"right-all")?(e=n.leftListBox.getData(),n.leftListBox.removeItems(e),n.rightListBox.addItems(e)):mini.hasClass(i,"left")?(e=n.rightListBox.getSelecteds(),n.rightListBox.removeItems(e),n.leftListBox.addItems(e)):mini.hasClass(i,"left-all")&&(e=n.rightListBox.getData(),n.rightListBox.removeItems(e),n.leftListBox.addItems(e))})},setExportUrl:function(t){this.exportUrl=t,this._exportForm.action=t},getExportUrl:function(){return this.exportUrl},getGridId:function(){return this.gridId},setGridId:function(t){this.gridId=t,this.dataGrid=mini.get(t)},showPanel:function(){if(this._adjustRadioLayout(),mini.removeClass(this._panel,"hidden"),this.button.setText(this.expandText),!this.isInit||this.dynamicColumns){var t=this.getColumns();"left"==this.position?(this.leftListBox.setData(t),this.rightListBox.setData([])):(this.rightListBox.setData(t),this.leftListBox.setData([])),this.isInit=!0}},_adjustRadioLayout:function(){!this.dataGrid&&this.gridId&&(this.dataGrid=mini.get(this.gridId)),this.dataGrid?(mini.removeClass(this._exportRbl.el,"hidden"),this.dataGrid.multiSelect&&this._getSelectedGridIds()?(mini.removeClass(this._rowTr,"hidden"),this._exportRbl.setValue("0")):(mini.addClass(this._rowTr,"hidden"),this._exportRbl.setValue("1"),this.dataGrid.showPager||(mini.addClass(this._curPageTr,"hidden"),mini.addClass(this._pageTr,"hidden")),this._fromNumInput.value=this.dataGrid.getPageIndex()+1)):mini.addClass(this._exportRbl.el,"hidden")},hidePanel:function(){mini.addClass(this._panel,"hidden"),this.button.setText(this.collapseText)},getColumns:function(){var t=[];if(this.columnsData)t=this.columnsData;else if(this.columnsValue)for(var e=this.columnsValue.split(","),i=this.columnsText.split(","),n=e.length,s=0;s<n;s++)t.push({text:i[s]?i[s]:e[s],field:e[s]});else this.gridId&&(this.dataGrid||(this.dataGrid=mini.get(this.gridId)),t=this._getColumns(this.dataGrid.columns));var o={columns:t};return this.fire("beforeupdatecolumn",o),t=o.columns,this.columnsData=t},_getColumns:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];if(s.field)e.push({text:s.header,field:s.field});else if(s.columns){var o=this._getColumns(s.columns);e=e.concat(o)}}return e},setCollapseText:function(t){this.collapseText=t,this.button&&this.button.setText(t)},getFileName:function(){return this.fileName},setFileName:function(t){this.fileName=t},getAttrs:function(t){var e=mini.DataExport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["gridId","exportUrl","onbeforeexport","fileName","columnsText","columnsValue","position","expandText","collapseText","onbeforeupdatecolumn","onexportsuccess"]),mini._ParseBool(t,e,["dynamicColumns"]),e}}),mini.regClass(mini.DataExport,"dataexport"),mini.DataImport=function(){mini.DataImport.superclass.constructor.call(this)},mini.extend(mini.DataImport,mini.Control,{uiCls:"mini-dataimport",url:"",pickerText:"",_create:function(){this.el=document.createElement("div"),this.uploader=new mini.WebUploader,this.uploader.set({uploadUrl:this.url,pickerText:this.pickerText,fileNumLimit:1,limitType:"xls,xlsx,xlsm",showDefaultUI:!1,auto:!1,renderTo:this.el}),this.uploader.on("beforefilequeued",this._onBeforeFileQueued,this),this.uploader.on("filesqueued",this._onFilesQueued,this),this.uploader.on("uploadbeforesend",this._onUploadBeforeSend,this),this.uploader.on("uploadprogress",this._onUploadProgress,this),this.uploader.on("uploadsuccess",this._onUploadSuccess,this),this.uploader._uploadBtn.hide(),this.maskEl=document.createElement("div"),this.maskEl.className="mini-dataimport-mask",this.maskEl.innerHTML='<div class="mini-dataimport-mask-content"></div>',this.maskContent=this.maskEl.firstChild,document.body.appendChild(this.maskEl),this.detailEl=document.createElement("div"),this.detailEl.className="mini-dataimport-detail",this.detailEl.innerHTML='<div class="mini-dataimport-detail-content"></div><i class="dataimport-detail-close">X</i>',this.detailContent=this.detailEl.firstChild,document.body.appendChild(this.detailEl),this._bindEvent()},_bindEvent:function(){var t=this;jQuery(this.maskEl).on("click",".dataimport-showdetail",function(){return t.showDetailStatus(),!1}).on("click",".dataimport-continue",function(){t.isContinueImport=!0,t.uploader._uploader.upload()}).on("click",".dataimport-restart",function(){t.uploader._uploader.upload()}).on("click",function(){t.isImportFinished&&!t.isDetailShow&&(t.maskEl.style.display="none")}),jQuery(this.detailEl).on("click",".dataimport-detail-close",function(){t.hideDetailStatus()}).on("click",".dataimport-status-toggle",function(){var t=$(this),e=t.parent();e.hasClass("opened")?(t.text(""),e.removeClass("opened")):(t.text(""),e.addClass("opened"))})},_onFilesQueued:function(t){var i=t.files[0],n=this;if(i){var e=this._generateFileList({id:i.id,name:i.name,size:i.size});this.isImportFinished=!1,this.maskContent.innerHTML=e,this.maskEl.style.display="block",this.uploader._uploader.md5File(i).progress(function(t){}).then(function(t){var e={fileMD5:n._curFileMD5=t,fileName:i.name,fileSize:i.size};e[n.uploader.id+"_action"]="queryFileStatus",n.uploader.getCommonData&&(e.commonDto=mini.encode(n.uploader.getCommonData())),n._onPostFileMd5(e),$.ajax(n.url,{dataType:"json",data:e,type:"post",success:function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),n._onQueryFileStatus(t)}})})}},_onPostFileMd5:function(t){this.fire("postfilemd5",{data:t})},_curFileMD5:"",_curAttachGuid:"",_onQueryFileStatus:function(t){t.msg&&mini.alert(t.msg),this.setDetailStatus(t.detail),this._curAttachGuid=t.attachGuid,this._oldAttachGuid=t.attachGuidOld,t.end?this._onFinished(t.status):(t.pollingFrequency&&(this._pollingFrequency=t.pollingFrequency),"importStatus"==t.action?this.pollingStatus(t):"upload"==t.action?this.uploader._uploader.upload():jQuery(this.maskContent).find(".mini-dataimport-action").removeClass("hidden"))},_onUploadBeforeSend:function(t){this.isContinueImport&&(t.data.attachGuid=this._curAttachGuid),t.data.fileMD5=this._curFileMD5},_onUploadProgress:function(t){var e=t.file,i=t.percentage,n=mini.byId(e.id),s=jQuery(".mini-dataimport-progressbar",n),o=jQuery(".progress-text",s),r=jQuery(".progress-body",s),l=Math.round(100*i)+"%";o.text(l),r.width(l)},_generateFileList:function(t){var e=[];return e.push('<div class="mini-dataimport-item">'),e.push('<span class="mini-dataimport-info">'+t.name+"</span>"),e.push('<span class="mini-dataimport-size">('+this._getSize(t.size)+")</span>"),e.push('<span class="mini-dataimport-progressbar"><span class="progress-text">0%</span><div class="progress-body"></div></span>'),e.push('<span class="mini-dataimport-action hidden"><a href="javascript:void(0)" class="dataimport-continue" title=""></a><a href="javascript:void(0)" class="dataimport-restart" title=""></a><a href="javascript:void(0)" class="dataimport-showdetail hidden"></a></span>'),e.push("</div>"),e.join("")},_generateImportStatus:function(t){var e=[];return e.push('<div class="mini-dataimport-item">'),e.push('<span class="mini-dataimport-info">'+(t.status||"")+"</span>"),0<=t.handlepercent&&e.push('<span class="mini-dataimport-progressbar"><span class="progress-text">'+t.handlepercent+'%</span><div class="progress-body" style="width:'+t.handlepercent+'%;"></div></span>'),t.end&&e.push('<span class="mini-dataimport-action"><a href="javascript:void(0)" class="dataimport-showdetail"></a></span>'),e.push("</div>"),e.join("")},_generateStatuslist:function(t){var e,i,n,s=!0,o=!0,r=['<div class="dataimport-status-item">'];if(r.push('<h3 class="dataimport-status-title">'+t.sheetName+"</h3>"),r.push('<h4 class="dataimport-status-type"></h4>'),r.push('<p class="dataimport-status-count">'+t.checkCount+""+t.checkSuccessCount+""+t.checkErrorCount+""),(n=t.checkMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="dataimport-status-toggle"></a></p>'),r.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else s=!1;if(t.saveCount)if(s||(r.push("</p>"),s=!0),r.push('<h4 class="dataimport-status-type"></h4>'),r.push('<p class="dataimport-status-count">'+t.saveCount+""+t.saveSuccessCount+""+t.saveErrorCount+""),(n=t.saveMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="dataimport-status-toggle"></a></p>'),r.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else o=!1;if((n=t.taskMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="dataimport-status-toggle"></a></p>'),r.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else s&&o||r.push("</p>");return r.push("</div>"),r.join("")},_getSize:function(t){return 1048576<(t=parseInt(t))?(t/1048576).toFixed(2)+"M":(t/1024).toFixed(2)+"K"},_pollingFrequency:1e3,_oldAttachGuid:"",_onUploadSuccess:function(t){var e=t.ret;t.file;if(mini.getSecondRequestData&&(e=mini.getSecondRequestData(e)),e=(e=e.data||e).extraDatas||e,this._pollingFrequency=e.pollingFrequency,"importStatus"==e.action)return this._curAttachGuid=e.attachGuid,this._oldAttachGuid=e.attachGuidOld,void this.pollingStatus(e);var i=this;mini.alert("","",function(){i._onFinished(e.status),i.maskEl.style.display="none"})},_onFinished:function(t){t=t||"",this.isImportFinished=!0,this.maskContent.innerHTML=t+'<a href="javascript:void(0);" class="dataimport-showdetail"></a>',this._events.importfinished&&this.fire("importfinished"),this.uploader.clearFile()},_onBeforeFileQueued:function(t){this._events.beforefilequeued&&this.fire("beforefilequeued",t)},pollingStatus:function(t){this.maskContent.innerHTML=this._generateImportStatus(t);var e=this,i={fileMD5:this._curFileMD5,attachGuid:this._curAttachGuid,attachGuidOld:this._oldAttachGuid};i[this.uploader.id+"_action"]="importStatus",this.uploader.getCommonData&&(i.commonDto=mini.encode(this.uploader.getCommonData())),jQuery.ajax({url:this.url,data:i,type:"POST",dataType:"json"}).done(function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),t.msg&&mini.alert(t.msg),t.end?e._onFinished(t.status):setTimeout(jQuery.proxy(e.pollingStatus,e,t),e._pollingFrequency),e.setDetailStatus(t.detail)})},setDetailStatus:function(t){this.detailStatus=t,this.isDetailShow&&this.renderDetailStatus()},renderDetailStatus:function(){var t,e=this.detailStatus,i=[],n=0;if(e)for(t=e.length;n<t;n++)i.push(this._generateStatuslist(e[n]));this.detailContent.innerHTML=i.join("")},showDetailStatus:function(){this.renderDetailStatus(),this.detailEl.style.display="block",this.isDetailShow=!0},hideDetailStatus:function(){this.detailEl.style.display="none",this.isDetailShow=!1},setUrl:function(t){this.url=t,this.uploader&&this.uploader.setUploadUrl(t)},getUrl:function(){return this.url},setPickerText:function(t){},setEnabled:function(t){mini.CatalogImport.superclass.setEnabled.call(this,t),this.uploader&&this.uploader.setEnabled(t)},getAttrs:function(t){var e=mini.DataImport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","pickerText","onbeforefilequeued","onpostfilemd5","onimportfinished"]),e}}),mini.regClass(mini.DataImport,"dataimport"),mini.DateRangePicker=function(){mini.DateRangePicker.superclass.constructor.call(this)},mini.extend(mini.DateRangePicker,mini.ValidatorBase,{uiCls:"mini-daterangepicker",allowInput:!0,rangeType:"date",format:"yyyy-MM-dd",delimiter:"~",minDate:null,maxDate:null,set:function(t){if("string"==typeof t)return this;var e=t.rangeType;delete t.rangeType;var i=t.format;return delete t.format,mini.DateRangePicker.superclass.set.call(this,t),mini.isNull(e)||this.setRangeType(e),mini.isNull(i)||this.setFormat(i),this},_create:function(){this.el=document.createElement("div"),this.el.className="mini-daterangepicker",this._buttonEdit=new mini.ButtonEdit,this._buttonEdit.render(this.el);var e=this;this._buttonEdit.set({allowInput:!1,width:"100%",onbuttonclick:function(t){t.htmlEvent.stopPropagation(),jQuery(e._inputEl).trigger("click")},onblur:function(t){e.isEditable()&&e._tryValidate()}}),this._borderEl=this.el.firstChild,this._inputEl=this._buttonEdit._textEl,this.externalSrc=this.externalSrc||mini.externalSrc,window.laydate?this._init():mini.loadJS(this.externalSrc+"laydate/laydate.js",function(){e._init()})},_fixedHoverScroller:function(){var t=mini._scrollBarWidth,e="fixed-hover-scroller-for-daterange";t&&!$("#"+e).length&&$("<style></style>",{id:e,text:[".laydate-time-list li ol {","margin-right: "+t+"px}",".laydate-time-list>li:hover ol{","margin-right:0;}"].join("")}).appendTo("head")},_fixedTimeScrollPos:function(){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.setTimeout;function t(t){var e=$(t.target||t.srcElement);e.closest(".laydate-time-list > li li").length&&i(function(){!function(t){var e=t.position().top,i=t.outerHeight(!0),n=t.parent(),s=n[0].offsetHeight;0<e&&e<s-i||(n[0].scrollTop=n[0].scrollTop+e)}(e)})}return document.addEventListener?function(){document.removeEventListener("click",t,!0),document.addEventListener("click",t,!0)}:function(){}}(),_init:function(){var n=this,t={elem:this._inputEl,range:this.delimiter,format:this._translateToLaydateFormat(this.format),type:this.rangeType,readOnly:this.readOnly,enabled:this.enabled,trigger:"click",done:function(t,e,i){n.setValue({startDate:n._formatDate(e),endDate:n._formatDate(i)}),n._tryValidate()}};this.minDate&&(t.min=mini.formatDate(this.minDate,"yyyy-MM-dd HH:mm:ss")),this.maxDate&&(t.max=mini.formatDate(this.maxDate,"yyyy-MM-dd HH:mm:ss")),this.laydate=laydate.render(t),this._fixedHoverScroller(),this._fixedTimeScrollPos()},_formatDate:function(t){if(!t||function(t){for(var e in t)return!1;return!0}(t))return"";var e=this.format.replace(/yyyy/g,t.year);return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/yy/g,(t.year+"").substring(2))).replace(/MM/g,t.month<10?"0"+t.month:t.month)).replace(/M/g,t.month)).replace(/dd/g,t.date<10?"0"+t.date:t.date)).replace(/d/g,t.date)).replace(/HH/g,t.hours<10?"0"+t.hours:t.hours)).replace(/H/g,t.hours)).replace(/mm/g,t.minutes<10?"0"+t.minutes:t.minutes)).replace(/m/g,t.minutes)).replace(/ss/g,t.seconds<10?"0"+t.seconds:t.seconds)).replace(/s/g,t.seconds)},setFormat:function(t){this.format=t,this.laydate&&(this.laydate.config.format=this._translateToLaydateFormat(t))},_translateToLaydateFormat:function(t){return t.replace(/(y)\1{1}/g,function(t,e,i,n){return"y"==n.charAt(i-1)||"y"==n.charAt(i+2)?"yy":"y"})},setMinDate:function(t){this.minDate=mini.parseDate(t),this.laydate&&(this.laydate.config.min=mini.formatDate(this.minDate,"yyyy-MM-dd HH:mm:ss"))},setMaxDate:function(t){this.maxDate=mini.parseDate(t),this.laydate&&(this.laydate.config.min=mini.formatDate(this.maxDate,"yyyy-MM-dd HH:mm:ss"))},setRangeType:function(t){this.rangeType=t,this.laydate&&(this.laydate.config.type=t),"datetime"==t&&(this.format="yyyy-MM-dd HH:mm:ss")},_oldValue:{startDate:"",endDate:""},value:{startDate:"",endDate:""},setValue:function(t){t.startDate&&t.endDate?(this.value={startDate:t.startDate,endDate:t.endDate},this._inputEl.value=t.startDate+" "+this.delimiter+" "+t.endDate):(this.value={startDate:"",endDate:""},this._inputEl.value=""),this.value.startDate==this._oldValue.startDate&&this.value.endDate==this._oldValue.endDate||(this.fire("valuechanged",{value:this.value,oldValue:this._oldValue}),this._oldValue=this.value)},setReadOnly:function(t){mini.DateRangePicker.superclass.setReadOnly.call(this,t),this._buttonEdit.setReadOnly(t),this.laydate&&(this.laydate.config.readOnly=t)},setEnabled:function(t){mini.DateRangePicker.superclass.setEnabled.call(this,t),this.laydate&&(this.laydate.config.enabled=t)},validate:function(){var t={value:this.getValue(),errorText:"",isValid:!0};return this.required&&(""!==String(t.value.startDate).trim()&&""!==String(t.value.endDate).trim()||(t.isValid=!1,t.errorText=this.requiredErrorText)),this.fire("validation",t),this.errorText=t.errorText,this.setIsValid(t.isValid),this.isValid()},setEmptyText:function(t){this.emptyText!=t&&(this.emptyText=t,this._buttonEdit.setEmptyText(t))},getEmptyText:function(){return this.emptyText},_errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl||(this._errorIconEl=mini.append(this.el,'<span class="mini-errorIcon"></span>')),this._errorIconEl},_RemoveErrorIcon:function(){if(this._errorIconEl){var t=this._errorIconEl;jQuery(t).remove()}this._errorIconEl=null},getAttrs:function(t){var e=mini.DateRangePicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["rangeType","format","minDate","maxDate","onvaluechanged","emptyText"]),e}}),mini.regClass(mini.DateRangePicker,"daterangepicker"),mini.FilterTree=function(){mini.FilterTree.superclass.constructor.call(this),this.initComponents(),this.bindEvents()},mini.extend(mini.FilterTree,mini.Tree,{filterMode:"client",filterUrl:"",height:"100%",emptyText:"",uiCls:"mini-filtertree",initComponents:function(){var t='<input name="filterInput" class="mini-buttonedit mini-filtertree-filter" emptyText="'+this.emptyText+'" />';this.set({showToolbar:!0,toolbar:t})},_filterKey:"",bindEvents:function(){var i=this;this._filterInput=mini.getbyName("filterInput",this),this._filterInput.on("keyup",function(t){var e;13==t.htmlEvent.keyCode&&(e=i._filterInput.value,i._doFilter(e))}),this._filterInput.on("buttonclick",function(){var t=i._filterInput.value;i._doFilter(t)}),this.on("load",function(t){var e=t.data;t.xhr&&"client"===this.filterMode&&(this._initialData=mini.clone(e))})},setData:function(t){mini.FilterTree.superclass.setData.call(this,t),"client"===this.filterMode&&(this._initialData=mini.clone(t))},_doFilter:function(e){var r=this;if(r._filterKey=e,"server"==r.filterMode){var l={data:{search_condition:e},url:r.getFilterUrl(),sender:r};r.fire("beforeload",l),jQuery.ajax({url:l.url,data:l.data,type:"post",success:function(t,e,i){t&&"null"!=t||(t="{ tatal: 0, data: [] }"),delete l.params;var n={text:t,result:null,sender:r,options:l,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(t){1==mini_debugger&&alert(url+"\n json is error.")}mini.isArray(s)&&(s={data:s}),r.dataField&&(s.data=mini._getMap(r.dataField,s)),s.data||(s.data=[]);var o={data:s.data,cancel:!1,result:s};r.fire("preload",o),1!=o.cancel&&(r.resultAsTree?r.loadData(o.data):r.loadList(o.data),r.fire("filter"),r.expandAll())}})}else""===e?(r.clearFilter(),r._initialData&&r.setData(r._initialData)):(e=e.toLowerCase(),r.filter(function(t){if(-1!=(t.text?t.text.toLowerCase():"").indexOf(e))return!0}),r.expandAll())},_OnCellClick:function(t){if(!mini.findParent(t.htmlEvent.target,this._eciconCls)){var e,i;if(this._filterKey&&(e=t.record[this.nodesField]))for(var n=0,s=e.length;n<s;n++)i=e[n][this.textField],e[n][this.textField]=i.replace(/<\/?.+?>/g,"");mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.checkOnTextClick?this._tryToggleCheckNode(t.record):this.fire("cellclick",t)}},_OnDrawCell:function(t,e,i,n){var s=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);if(this._treeColumn&&this._treeColumn==e.name){var o=s.node;if(!1===o.ckr&&(s.showCheckBox=!1,s.showRadioButton=!1),this._filterKey){var r=t[e.field];/<[^>]+>/.test(r)||(s.nodeHtml=r.replace(new RegExp(this._filterKey,"gi"),'<span class="mini-highlight">'+this._filterKey+"</span>"))}this.fire("drawnode",s),s.nodeStyle&&(s.cellStyle=s.nodeStyle),s.nodeCls&&(s.cellCls=s.nodeCls),s.nodeHtml?s.cellHtml=s.nodeHtml:o.textCls&&(s.cellHtml='<span class="'+o.textCls+'">'+s.cellHtml+"</span>"),this._createTreeColumn(s)}return s},getFilterUrl:function(){return this.filterUrl||this.url},setFilterUrl:function(t){this.filterUrl=t},getFilterMode:function(){return this.filterMode},setFilterMode:function(t){this.filterMode=t},setEmptyText:function(t){this.emptyText!=t&&(this._filterInput.emptyText=this.emptyText=t,this._filterInput._doEmpty())},getEmptyText:function(){return this.emptyText},getAttrs:function(t){var e=mini.FilterTree.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["filterMode","filterUrl","emptyText"]),e.filterUrl||(e.filterUrl=e.url),e}}),mini.regClass(mini.FilterTree,"filtertree"),mini.ImageUploader=function(){mini.ImageUploader.superclass.constructor.call(this)};var sourceLoader=function(t){$.Deferred()};mini.extend(mini.ImageUploader,mini.Control,{uiCls:"mini-imageuploader",_FILE_ITEM_TPL:'<div class="{{cls}}" data-id="{{id}}" data-guid="{{fileGuid}}" data-url="{{downloadUrl}}">        <img class="mini-imageuploader-img" src="{{downloadUrl}}" />        <span class="mini-imageuploader-edit"></span>        <span class="mini-imageuploader-remove action-icon icon-remove"></span>    </div>',_cropperOptions:{dragMode:"move",aspectRatio:NaN,cropBoxResizable:!0,viewMode:2,zoomOnWheel:!0,autoCropArea:.9,preview:".image-preview",crop:function(){}},set:function(t){return"string"==typeof t||(t.cropperOption&&(this._cropperOptions=$.extend({},this._cropperOptions,mini.decode(t.cropperOption)),delete t.cropperOption),mini.ImageUploader.superclass.set.call(this,t)),this},_create:function(){this.externalSrc=this.externalSrc||mini.externalSrc,this.__instanceIndex?this.__instanceIndex++:this.__instanceIndex=1;var t=this.uiCls;this.el=document.createElement("div"),this.el.className="clearfix",this._FILE_EL_ID=t+"-file-select-"+this.__instanceIndex,this.el.innerHTML=['<input id="'+this._FILE_EL_ID+'" style="display:block;" type="file" accept="image/*">','<div class="'+t+'-uploader-btn mini-imageuploader-add">','<label for="'+this._FILE_EL_ID+'">','<span class="'+t+'-upload-icon action-icon icon-remove" style="transform:rotate(45deg)"></span>','<span class="'+t+'-upload-text"></span>',"</label>","</div>",'<div class="'+t+'-list clearfix"></div>'].join(""),this.$fileList=$(this.el).find("."+t+"-list")},_afterApply:function(){this._initEvent(),this._createImageCropper()},_genderItem:function(t){var e=this.uiCls+"-item",i=$.extend({cls:e},t);return i.downloadUrl=(window._rootPath||"")+"/"+i.downloadUrl,window.Mustache||mini.loadJS(mini.externalSrc+"mustache.min.js"),Mustache.render(this._FILE_ITEM_TPL,i)},_addFileItem:function(t){return $(this._genderItem(t)).appendTo(this.$fileList)},setData:function(t){if("array"!=!$.type(t)){this.data=t,this.$fileList.empty();var i=this;$.each(t,function(t,e){i._addFileItem(e)})}},getData:function(){return this.data||[]},_initEvent:function(){var s="."+this.uiCls,o=this;$(this.el).on("click",s+"-uploader-btn",function(t){}).on("click",s+"-edit",function(t){var e=$(this).closest(s+"-item");o.imageCropper.show(e.data("url"),e.data("guid"))}).on("click",s+"-remove",function(t){var e=$(this).closest(s+"-item"),i=e.data("id"),n=e.data("guid");console.log({id:i,guid:n}),mini.confirm("","",function(t){"ok"==t&&(e.remove(),o.data=$.map(o.data,function(t){return t.guid!=n}))})}),$("#"+this._FILE_EL_ID).on("change",function(t){console.log("change");var e=this;this.files&&this.files.length&&o.__onAddImage(this.files[0],function(){e.value=""})})},__onAddImage:function(t,e){var i=new FileReader,n=this;i.onload=function(){i.onload=null,n.imageCropper.show(i.result),e&&e()},i.onerror=function(){i.onerror=null,console.log(arguments),e&&e()},i.readAsDataURL(t)},_createImageCropper:function(){if(window.HTMLCanvasElement&&window.HTMLCanvasElement.toString&&/\[native code\]/.test(window.HTMLCanvasElement.toString())){if("function"==$.type(window.$.fn.cropper))return this._initImageCropper();var t=this;mini.loadCSS(this.externalSrc+"cropper/cropper.min.css",this.uiCls+"-cropper-style"),mini.loadJS(this.externalSrc+"cropper/cropper.min.js",function(){t._initImageCropper()})}},setCropperOption:function(t,e){void 0===e&&$.type(t)},_initImageCropper:function(){var o=$("#head-sculpture-img"),i=this,n=mini.get("head-sculpture-window");return $(n.el).on("click",".save.btn",function(){var t=o.data("guid");i.saveCropperImage(t)}).on("click",".cancel.btn",function(){i.imageCropper.hide()}),this.imageCropper={show:function(t,e){o.attr("src",t),o.attr("data-guid",e).data("guid",e),n.setTitle(""),n.show(),o.cropper("destroy").cropper(i._cropperOptions)},hide:function(){o.attr("src",""),o.attr("data-guid",null).data("guid",null),n.hide()},zoomIn:function(){return o.cropper("zoom",.1)},zoomOut:function(){return o.cropper("zoom",-.1)},zoomTo:function(t){return o.cropper("zoomTo",void 0===t?1:t)},move:function(t,e){var i=void 0===t?-10:t,n=void 0===e?-10:e;return o.cropper("move",i,n)},moveTo:function(t,e){return o.cropper("moveTo",void 0===t?0:t,void 0===e?0:e)},move:function(t,e){var i=void 0===t?-10:t,n=void 0===e?-10:e,s=o.cropper("getData",!0);return s.x+=i,s.y+=n,s.x<0&&(s.x=0),s.y<0&&(s.y=0),o.cropper("setData",s)},moveTo:function(t,e){var i=o.cropper("getData",!0);return i.x=void 0===t?0:t,i.y=void 0===e?0:e,o.cropper("setData",i)},rotate:function(t){return o.cropper("clear").cropper("rotate",void 0===t?90:t).cropper("crop")},rotateTo:function(t){return o.cropper("clear").cropper("rotate",void 0===t?0:t).cropper("crop")},scaleX:function(){return o.cropper("scaleX",-o.cropper("getData").scaleX)},scaleY:function(){return o.cropper("scaleY",-o.cropper("getData").scaleY)},setAspectRatio:function(t){return o.cropper("setAspectRatio",t)},setCropperSize:function(t){var e={cropBoxResizable:!1,dragMode:"move",zoomable:!1,toggleDragModeOnDblclick:!1};e.data=$.extend({},o.cropper("getData",!0),t),o.cropper("destroy").cropper(e).cropper("crop")},reset:function(){o.cropper("destroy").cropper($.extend(this.nowOptions,this.useroptions))},getCropperImgInfo:function(t){return o.cropper("getData",void 0===t||!!t)},getData:function(t,e){var i={};return i.info=o.cropper("getData",!0),void 0===e&&(e="jpeg"),i.data=o.cropper("getCroppedCanvas",data).toDataURL("image/"+e),i},getImageData:function(t,e){return void 0===e&&(e="jpeg"),o.cropper("getCroppedCanvas",t).toDataURL("image/"+e)},getZoom:function(){var t=o.cropper("getCanvasData");return t.width/t.naturalWidth}}},saveCropperImage:function(e){mini.mask();var i=this,t={base64:this.imageCropper.getImageData()};return void 0!==e&&(t.fileGuid=e,t.mode="edit"),$.ajax({url:"./imageUploader.php",type:"post",data:t}).then(function(t){mini.unmask(),"string"===$.type(t)&&(t=JSON.parse(t)),i.data?i.data.push(t):i.data=[t],console.log(t.downloadUrl),e?i.$fileList.find('[data-guid="'+e+'"]').replaceWith(i._genderItem(t)):i._addFileItem(t),i.imageCropper.hide()}).fail(function(){mini.unmask(),console.error(arguments)})},getAttrs:function(t){var e=mini.ImageUploader.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["cropperOption"]),e}}),mini.regClass(mini.ImageUploader,"imageuploader"),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(E){var n,t=navigator.userAgent,T=/iphone/i.test(t),s=/chrome/i.test(t),S=/android/i.test(t);E.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},E.fn.extend({caret:function(t,e){var i;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof t?(e="number"==typeof e?e:t,this.each(function(){this.setSelectionRange?this.setSelectionRange(t,e):this.createTextRange&&((i=this.createTextRange()).collapse(!0),i.moveEnd("character",e),i.moveStart("character",t),i.select())})):(this[0].setSelectionRange?(t=this[0].selectionStart,e=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),t=0-i.duplicate().moveStart("character",-1e5),e=t+i.text.length),{begin:t,end:e})},unmask:function(){return this.trigger("unmask")},mask:function(e,_){var i,v,w,y,C,x,b;if(!e&&0<this.length){var t=E(this[0]).data(E.mask.dataName);return t?t():void 0}return _=E.extend({autoclear:E.mask.autoclear,placeholder:E.mask.placeholder,completed:null},_),i=E.mask.definitions,v=[],w=x=e.length,y=null,E.each(e.split(""),function(t,e){"?"==e?(x--,w=t):i[e]?(v.push(new RegExp(i[e])),null===y&&(y=v.length-1),t<w&&(C=v.length-1)):v.push(null)}),this.trigger("unmask").each(function(){function r(){if(_.completed){for(var t=y;t<=C;t++)if(v[t]&&f[t]===l(t))return;_.completed.call(m)}}function l(t){return _.placeholder.charAt(t<_.placeholder.length?t:0)}function a(t){for(;++t<x&&!v[t];);return t}function h(t,e){var i,n;if(!(t<0)){for(i=t,n=a(e);i<x;i++)if(v[i]){if(!(n<x&&v[i].test(f[n])))break;f[i]=f[n],f[n]=l(n),n=a(n)}d(),m.caret(Math.max(y,t))}}function o(){c(),m.val()!=g&&m.change()}function u(t,e){var i;for(i=t;i<e&&i<x;i++)v[i]&&(f[i]=l(i))}function d(){m.val(f.join(""))}function c(t){var e,i,n,s=m.val(),o=-1;for(n=e=0;e<x;e++)if(v[e]){for(f[e]=l(e);n++<s.length;)if(i=s.charAt(n-1),v[e].test(i)){f[e]=i,o=e;break}if(n>s.length){u(e+1,x);break}}else f[e]===s.charAt(n)&&n++,e<w&&(o=e);return t?d():o+1<w?_.autoclear||f.join("")===p?(m.val()&&m.val(""),u(0,x)):d():(d(),m.val(m.val().substring(0,o+1))),w?e:y}var m=E(this),f=E.map(e.split(""),function(t,e){return"?"!=t?i[t]?l(e):t:void 0}),p=f.join(""),g=m.val();m.data(E.mask.dataName,function(){return E.map(f,function(t,e){return v[e]&&t!=l(e)?t:null}).join("")}),m.one("unmask",function(){m.off(".mask").removeData(E.mask.dataName)}).on("focus.mask",function(){var t;m.prop("readonly")||(clearTimeout(n),g=m.val(),t=c(),n=setTimeout(function(){d(),t==e.replace("?","").length?m.caret(0,t):m.caret(t)},10))}).on("blur.mask",o).on("keydown.mask",function(t){if(!m.prop("readonly")){var e,i,n,s=t.which||t.keyCode;b=m.val(),8===s||46===s||T&&127===s?(i=(e=m.caret()).begin,(n=e.end)-i==0&&(i=46!==s?function(t){for(;0<=--t&&!v[t];);return t}(i):n=a(i-1),n=46===s?a(n):n),u(i,n),h(i,n-1),t.preventDefault()):13===s?o.call(this,t):27===s&&(m.val(g),m.caret(0,c()),t.preventDefault())}}).on("keypress.mask",function(t){if(!m.prop("readonly")){var e,i,n,s=t.which||t.keyCode,o=m.caret();if(!(t.ctrlKey||t.altKey||t.metaKey||s<32)&&s&&13!==s){if(o.end-o.begin!=0&&(u(o.begin,o.end),h(o.begin,o.end-1)),(e=a(o.begin-1))<x&&(i=String.fromCharCode(s),v[e].test(i))){if(function(t){var e,i,n,s;for(i=l(e=t);e<x;e++)if(v[e]){if(n=a(e),s=f[e],f[e]=i,!(n<x&&v[n].test(s)))break;i=s}}(e),f[e]=i,d(),n=a(e),S){setTimeout(function(){E.proxy(E.fn.caret,m,n)()},0)}else m.caret(n);o.begin<=C&&r()}t.preventDefault()}}}).on("input.mask paste.mask",function(){m.prop("readonly")||setTimeout(function(){var t=c(!0);m.caret(t),r()},0)}),s&&S&&m.off("input.mask").on("input.mask",function(){var t=m.val(),e=m.caret();if(t.length<b.length){for(c(!0);0<e.begin&&!v[e.begin-1];)e.begin--;if(0===e.begin)for(;e.begin<y&&!v[e.begin];)e.begin++;m.caret(e.begin,e.begin)}else{for(c(!0);e.begin<x&&!v[e.begin];)e.begin++;m.caret(e.begin,e.begin)}r()}),c()})}})}),mini.InputMask=function(){mini.InputMask.superclass.constructor.call(this)},mini.extend(mini.InputMask,mini.TextBox,{uiCls:"mini-inputmask",mask:"",set:function(t){if("string"==typeof t)return this;var e=t.mask;return delete t.mask,mini.InputMask.superclass.set.call(this,t),e&&this.setMask(e),this},setMask:function(t){this.mask=t,jQuery(this._textEl).mask(t)},getMask:function(){return this.mask},getAttrs:function(t){var e=mini.InputMask.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["mask"]),e}}),mini.regClass(mini.InputMask,"inputmask"),mini.LargeFileUploader=function(){mini.LargeFileUploader.superclass.constructor.call(this)},mini.extend(mini.LargeFileUploader,mini.Control,{uiCls:"mini-largefileuploader",uploadUrl:"",limitType:"",fileNumLimit:1,fileSizeLimit:0,fileSingleSizeLimit:0,multiSelect:!0,auto:!0,externalSrc:"",pickerText:"",startText:"",pauseText:"",numLimitErrorText:"</br>{0}",sizeLimitErrorText:"</br>{0}KB",typeDeniedErrorText:"</br>{0}",sizeErrorText:"</br>{0}KB",emptyFileErrorText:"",set:function(t){if("string"==typeof t)return this;var e=t.pickerText;delete t.pickerText;var i=t.needChunkLocal;return delete t.needChunkLocal,i&&(this.needChunkLocal=i),mini.LargeFileUploader.superclass.set.call(this,t),e&&(this._picker.innerHTML=e),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<div class="mini-uploader-btns"><div class="mini-ntko-pick">'+this.pickerText+'</div></div><div class="mini-uploader-list"></div><div class="mini-ntko"></div>',this._buttons=this.el.firstChild,this._fileList=this.el.children[1],this._ntkoContent=this.el.lastChild,this._picker=this._buttons.firstChild,this._uploadBtn=new mini.Button,this._uploadBtn.setText(this.startText),this._uploadBtn.render(this._buttons),this._ntkoContent.innerHTML='<object id="'+this.uid+'-ntko" classid="clsid:882C96AC-B79E-4f50-A7A6-6E5E42431A05" codebase="'+(this.externalSrc||mini.externalSrc)+'ntkoLFUploader/NtkoLFUploader.cab#version=6,1,1,8"><PARAM NAME="BackColor" VALUE="16744576"><PARAM NAME="ForeColor" VALUE="16777215"><PARAM NAME="IsUseUTF8Data" VALUE="true"><param name="ProductCaption" value="'+(window.NTKO_ProductCaption||"")+'"><param name="ProductKey" value="'+(window.NTKO_ProductKey||"3CF3019EA6883730AB34F0D5A8FACDB1CDB2A9EA")+'"><PARAM NAME="MakerCaption" VALUE=""><PARAM NAME="MakerKey" VALUE="39337AFCA7AFD1F882A3BF53CBE1E4AC804C65A6"><span style="color: red;">NTKO</span></object>',this._ntko=this._ntkoContent.firstChild,this._errorContent=""},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this._picker,"click",this.__OnPickerClick,this)},this);var s=this,n=this._ntko;if(this._uploadBtn.on("click",function(){n.IsUploading?(s.stopUpload(),s._uploadBtn.setText(s.pauseText)):(s.beginUpload(),s._uploadBtn.setText(s.startText))}),this.auto&&this._uploadBtn.hide(),n.attachEvent)n.attachEvent("BeforeFileAdded",function(t,e,i){n.CancelLastCommand=!s._beforeFileQueued(t,e,i)}),n.attachEvent("OnLocalFileAdded",function(t,e,i){s._onFilesQueued(t,e,i)}),n.attachEvent("OnFileProcessStatusChange",function(t,e,i,n){s._onUploadProgress(t,e,i,n)}),n.attachEvent("OnOneFileUploadFinished",function(t,e){s._onFileFinished(t,e)}),n.attachEvent("OnSaveToURLFinished",function(t){s._onUploadFinished(t)});else{var t=this.uid+"-ntko",e='var lfu = mini.getbyUID("'+this.uid+'");',i=e+"lfu._ntko.CancelLastCommand = !lfu._beforeFileQueued(filePath, fileName, fileSize);";o({target:t,event:"BeforeFileAdded(filePath, fileName, fileSize)",text:i}),o({target:t,event:"OnLocalFileAdded(filePath, fileName, fileSize)",text:i=e+"lfu._onFilesQueued(filePath, fileName, fileSize);"}),o({target:t,event:"OnFileProcessStatusChange(file, statusText, isPersent, persentNumber)",text:i=e+"lfu._onUploadProgress(file, statusText, isPersent, persentNumber);"}),o({target:t,event:"OnOneFileUploadFinished(file, isAllUploaded)",text:i=e+"lfu._onFileFinished(file, isAllUploaded);"}),o({target:t,event:"OnSaveToURLFinished(isAllSuccess)",text:i=e+"lfu._onUploadFinished(isAllSuccess);"})}function o(t){var e=document.createElement("script");e.language="JScript",e.setAttribute("for",t.target),e.event=t.event,e.text=t.text,document.body.appendChild(e)}},_afterApply:function(){void 0===this._ntko.StatusCode&&(this.el.innerHTML='<a class="noflash" title="NTKOIE"></a>',mini.showPageWarning({html:"NTKOIE"}))},__OnPickerClick:function(t){var e=this._ntko;try{e.AddLocalFile("",this.multiSelect,this._ntkoFileType),this.auto&&this.beginUpload()}catch(t){10==e.StatusCode?window.console&&console.log(""):window.console&&console.error("error"+t.number+":"+t.description)}},_blocksFileField:"NTKO_LF_BLOCK",beginUpload:function(){if(this._onStartUpload()){var t=this._ntko;t.QueryFileStatusURL=this._ntkoQueryFileStatusURL,t.FinishedUploadURL=this._ntkoFinishedUploadURL;var e={data:{}};this._onUploadBeforeSend(e),t.BeginSaveToURL(this.uploadUrl+"&query=upload",this._blocksFileField,function(t){var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")}(e.data))}},stopUpload:function(){this._ntko.StopSaveToURL(),this._onStopUpload()},reset:function(){this._ntko.Reset(),this._onReset()},removeFile:function(t){var e,i=this._ntko,n=this._getFileIndex(t);-1<n&&(e=i.GetFile(n),i.RemoveFile(n),this._fileIds[e.FilePath]=void 0,delete this._fileIds[e.FilePath],this._onFileDequeued(e))},_getFileIndex:function(t){var e=0;for(var i in this._fileIds){if(this._fileIds[i].id===t)return e;e++}return-1},_ntkoFileType:"*.*",setLimitType:function(t){this.limitType=t.toLowerCase(),this._ntkoFileType=this._getNtkoFileType(t)},getLimitType:function(){return this.limitType},setAuto:function(t){this.auto!=t&&((this.auto=t)?this._uploadBtn.hide():this._uploadBtn.show())},getAuto:function(){return this.auto},_getNtkoFileType:function(t){if(!t)return"*.*";for(var e=[],i=t.split(","),n=0,s=i.length;n<s;n++)e.push("*."+i[n]);return e.join(";")},getFileList:function(){return this._fileList},setFileNumLimit:function(t){t=parseInt(t)||0,this.fileNumLimit=t,this.multiSelect=1!==t},getFileNumLimit:function(){return this.fileNumLimit},setUploadUrl:function(t){var e=window.location.search.substring(1),i="?";0<t.indexOf("?")&&(i="&"),t+=i+"type=ntko",e&&(t+="&"+e),this.needChunkLocal&&(t+="&needChunkLocal=1"),this.uploadUrl=t,this._ntkoQueryFileStatusURL=t+"&query=getStatus",this._ntkoFinishedUploadURL=t+"&query=finished"},getUploadUrl:function(){return this.uploadUrl},setFileSingleSizeLimit:function(t){this.fileSingleSizeLimit=t},getFileSingleSizeLimit:function(){return this.fileSingleSizeLimit},_validateFile:function(t){var e=this._ntko.FilesCount;return this.fileNumLimit&&e>=this.fileNumLimit?(this._errorContent=String.format(this.numLimitErrorText,this.fileNumLimit),!1):this.fileSingleSizeLimit&&t.size>1024*this.fileSingleSizeLimit?(this._errorContent=String.format(this.sizeErrorText,this.fileSingleSizeLimit),!1):0===t.size?(this._errorContent=this.emptyFileErrorText,!1):!this.limitType||-1!=(","+this.limitType+",").indexOf(","+t.ext.toLowerCase()+",")||(this._errorContent=String.format(this.typeDeniedErrorText,this.limitType),!1)},_parseAttachFile:function(t){var e={path:t.FilePath,name:t.FileName,size:t.FileSize,md5:t.MD5ID};return e.ext=e.name.substr(e.name.lastIndexOf(".")+1),e.id=this._fileIds[e.path].id,e},_beforeFileQueued:function(t,e,i){var n={path:t,name:e,size:i,ext:e.substr(e.lastIndexOf(".")+1)};if(this._events.beforefilequeued){var s={source:this,sender:this,type:"beforefilequeued",file:n,cancel:!1};if(this.fire("beforefilequeued",s),s.cancel)return!1}return!!this._validateFile(n)||(this._errorContent&&mini.alert(this._errorContent),this._errorContent="",!1)},_fileIds:{},_onFilesQueued:function(t,e,i){var n={path:t,name:e,size:i,ext:e.substr(e.lastIndexOf(".")+1),id:UUID()};this._fileIds[n.path]={id:n.id},this.fire("filesqueued",{files:[n]})},_onFileDequeued:function(t){this.fire("filedequeued",{file:t})},_onUploadBeforeSend:function(t){this.fire("uploadbeforesend",t)},_onUploadProgress:function(t,e,i,n){t=this._parseAttachFile(t),console.log(arguments);var s=!1;i?s||0!==e.indexOf("")?this.fire("uploadprogress",{file:t,percentage:n/100}):(this.fire("md5progress",{file:t,percentage:n/100}),100==n&&(s=!0)):this._fileIds[t.path].started||(this.fire("uploadstart",{file:t}),this._fileIds[t.path].started=!0)},_onFileFinished:function(t,e){t=this._parseAttachFile(t),e?this._onUploadSuccess(t):this._onUploadError(t,this._parseNtkoRet(this._ntko.LastFinishedUploadRetMes)),this._onUploadComplete(t)},_onUploadSuccess:function(t){var e=this._parseNtkoRet(this._ntko.LastFinishedUploadRetMes);this.fire("uploadaccept",{ret:e,object:{file:t}}),this.fire("uploadsuccess",{file:t})},_onUploadError:function(t,e){this.fire("uploaderror",{file:t,reason:e})},_onUploadComplete:function(t){this.fire("uploadcomplete",{file:t})},_onStartUpload:function(){if(this._events.startupload){var t={source:this,sender:this,type:"startupload",cancel:!1};if(this.fire("startupload",t),t.cancel)return!1}return!0},_onStopUpload:function(){this.fire("stopupload")},_onUploadFinished:function(t){this._uploadBtn.setText(this.startText),this.fire("uploadfinished",{isAllSuccess:t})},_onReset:function(){this._fileIds={},this.fire("reset")},_parseNtkoRet:function(t){var o={},e=t.split("&");return $.each(e,function(t,e){var i=e.split("="),n=i[0],s=i[1];void 0===o[n]?o[n]=s:"string"==typeof o[n]?o[n]=[o[n],s]:o[n].push(s)}),o},getAttrs:function(t){var e=mini.LargeFileUploader.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["uploadUrl","limitType","onbeforefilequeued","onfilesqueued","onreset","onstartupload","onstopupload","onuploadfinished","onuploadstart","onuploadbeforesend","onuploadaccept","onuploadprogress","onmd5progress","onuploadsuccess","onuploaderror","onuploadcomplete","pickerText"]),mini._ParseBool(t,e,["auto"]),mini._ParseInt(t,e,["fileNumLimit","fileSingleSizeLimit"]),e}}),mini.regClass(mini.LargeFileUploader,"largefileuploader"),mini.Output=function(){mini.Output.superclass.constructor.apply(this,arguments)},mini.extend(mini.Output,mini.Control,{url:"",async:!1,escape:!1,autoLoad:!0,uiCls:"mini-output",_create:function(){this.el=document.createElement("div"),this.el.className="mini-output"},_initEvents:function(){},doLayout:function(){if(this.canLayout()){var t=this.el.childNodes;if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];mini.layout(n)}}},doUpdate:function(){var t=jQuery.ajax({url:this.url,async:this.async}),e=this;t.done(function(t){e.setValue(t)})},setUrl:function(t){this.url=t,this.autoLoad&&this.doUpdate()},getUrl:function(){return this.url},setAutoLoad:function(t){this.autoLoad=!!t},getAutoLoad:function(){return this.autoLoad},setEscape:function(t){this.escape=!!t},getEscape:function(){return this.escape},setAsync:function(t){this.async=t},getAsync:function(){return this.async},setValue:function(t){var e={value:t};this.fire("valuechanged",e),null==(t=e.value)&&(t=""),this.escape&&(t=mini.htmlEncode(t)),mini.innerHTML(this.el,t),mini.parse(this.el),this.doLayout()},getAttrs:function(t){var e=mini.Output.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","onvaluechanged"]),mini._ParseBool(t,e,["escape","async","autoLoad"]),e}}),mini.regClass(mini.Output,"output"),mini.OutputText=function(){mini.OutputText.superclass.constructor.apply(this,arguments)},mini.extend(mini.OutputText,mini.Control,{maxWidth:"",escape:!1,showTitle:!0,uiCls:"mini-outputtext",set:function(t){if("string"==typeof t)return this;var e=t.maxWidth;delete t.maxWidth;var i=t.escape;delete t.escape;var n=t.showTitle;return delete t.showTitle,e&&this.setMaxWidth(e),i&&(this.escape=i),mini.isNull(n)||this.setShowTitle(n),mini.OutputText.superclass.set.call(this,t),this},_create:function(){this.el=document.createElement("span")},setValue:function(t){null==t&&(t=""),this.value=t,!0===this.escape&&(t=(t=mini.htmlEncode(t)).replace(/\n/g,"<br/>")),this.el.innerHTML=t;var e=jQuery(this.el).text();this.showTitle&&mini.setAttr(this.el,"title",e)},setMaxWidth:function(t){(t=t.replace(/(^\s*)|(\s*$)/g,""))?("px"!=t.substr(t.length-2)&&(t+="px"),mini.addClass(this.el,"mini-text-ellipsis")):mini.removeClass(this.el,"mini-text-ellipsis"),this.el.style.maxWidth=t,this.maxWidth=t},getMaxWidth:function(){return this.maxWidth},getEscape:function(){return this.escape},getShowTitle:function(){return this.showTitle},setShowTitle:function(t){this.showTitle=t},getAttrs:function(t){var e=mini.OutputText.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["maxWidth"]),mini._ParseBool(t,e,["escape","showTitle"]),e}}),mini.regClass(mini.OutputText,"outputtext"),mini.PagerTree=function(){mini.PagerTree.superclass.constructor.call(this),mini.addClass(this.el,"mini-tree"),mini.addClass(this.el,"mini-treegrid"),this._Expander=new mini._PagerTree_Expander(this),this._collapseNodes=[],this._expandNodes=[],this.on("beforeload",this.__OnBeforeLoad,this)},mini.extend(mini.PagerTree,mini.DataGrid,{uiCls:"mini-pagertree",treeColumn:"",idField:"id",parentField:"pid",showTreeIcon:!0,iconField:"iconCls",imgField:"img",imgPath:"",leafIconCls:"mini-tree-leaf",folderIconCls:"mini-tree-folder",_expandNodeCls:"mini-tree-expand",_collapseNodeCls:"mini-tree-collapse",_eciconCls:"mini-tree-node-ecicon",_OnCellMouseDown:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellmousedown",t)},_OnCellClick:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellclick",t)},_OnDrawCell:function(t,e,i,n){var s=mini.PagerTree.superclass._OnDrawCell.call(this,t,e,i,n);return this.treeColumn&&this.treeColumn==e.name&&(s.headerCls+=" mini-tree-treecolumn",s.cellCls+=" mini-tree-treecell",s.cellStyle+=";padding:0;",s.img=t[this.imgField],s.iconCls=this._getNodeIcon(t),s.showTreeIcon=this.showTreeIcon,s.nodeCls="",s.nodeStyle="",this._createTreeCell(s)),s},_createTreeCell:function(t){var e=[],i=t.record,n=this.isLeafNode(i),s=this.getNodeLevel(i),o=this.isExpandedNode(i),r=t.nodeCls;n||(r=o?this._expandNodeCls:this._collapseNodeCls),n||(r+=" mini-tree-parentNode"),e[e.length]='<div class="mini-tree-nodetitle '+r+'" style="'+t.nodeStyle+'">';for(var l=0;l<s-1;l++)e[e.length]='<span class="mini-tree-indent " ></span>';if(e[e.length]=n?'<span class="'+this._eciconCls+'" ></span>':'<i class="'+this._eciconCls+'"></i>',e[e.length]='<span class="mini-tree-nodeshow">',t.showTreeIcon)if(t.img){var a=this.imgPath+t.img;e[e.length]='<span class="mini-tree-icon" style="background-image:url('+a+');"></span>'}else e[e.length]='<span class="'+t.iconCls+' mini-tree-icon mini-icon"></span>';e[e.length]='<span class="mini-tree-nodetext">',e[e.length]=t.cellHtml,e[e.length]="</span>",e[e.length]="</span>",e[e.length]="</div>",t.cellHtml=e.join("")},__OnBeforeLoad:function(t){t.data.__ecconfig=this._getEcConfig()},_getEcConfig:function(){var t={collapseNodes:this._collapseNodes,expandNodes:this._expandNodes};return mini.encode(t)},load:function(){return this._collapseNodes=[],this._expandNodes=[],mini.PagerTree.superclass.load.apply(this,arguments)},expandNode:function(t){if((t=this._dataSource.getbyId(t))&&!this.isLeafNode(t)){var e=t[this.getIdField()];e&&(this._expandNodes.remove(e),this._collapseNodes.remove(e),this._expandNodes.add(e))}this.reload()},collapseNode:function(t){if((t=this._dataSource.getbyId(t))&&!this.isLeafNode(t)){var e=t[this.getIdField()];e&&(this._expandNodes.remove(e),this._collapseNodes.remove(e),this._collapseNodes.add(e))}this.reload()},toggleNode:function(t){(t=this._dataSource.getbyId(t))?this.isExpandedNode(t)?this.collapseNode(t):this.expandNode(t):this.reload()},isExpandedNode:function(t){return void 0===t.expanded||"true"==t.expanded.toString()},isLeafNode:function(t){return t.isLeaf&&"true"==t.isLeaf.toString()},getNodeLevel:function(t){return t._level},_getNodeIcon:function(t){var e=t[this.iconField];return e=e||(this.isLeafNode(t)?this.leafIconCls:this.folderIconCls)},getAttrs:function(t){var e=mini.PagerTree.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["treeColumn","iconField","imgField","imgPath","idField","parentField"]),mini._ParseBool(t,e,["showTreeIcon"]),e}}),mini.regClass(mini.PagerTree,"pagertree"),mini._PagerTree_Expander=function(t){this.owner=t,mini.on(t.el,"click",this.__OnClick,this)},mini._PagerTree_Expander.prototype={__OnClick:function(t){var e=this.owner,i=e.getRecordByEvent(t,!1);if(i){e.isLeafNode(i);if(mini.findParent(t.target,e._eciconCls)){if(e.isLeafNode(i))return;e.toggleNode(i)}}}};var Pagination=function(){Pagination.superclass.constructor.apply(this,arguments)};mini.extend(Pagination,mini.Control,{pageIndex:0,pageSize:10,totalCount:0,totalPage:0,sizeList:[10,20,50,100],set:function(t){if("string"==typeof t)return this;var e=t.pageIndex;return delete t.pageIndex,Pagination.superclass.set.call(this,t),mini.isNull(e)||this.setPageIndex(e),this},uiCls:"mini-pagination",_create:function(){this.el=document.createElement("div"),this._updatePager()},_updatePagerButtons:function(){var t=parseInt(this.pageSize),e=parseInt(this.pageIndex),i=parseInt(this.totalCount),n=Math.ceil(i/t),s=[];s.push('<div class="pagination-buttons">');var o="";0==e&&(o="disabled");var r='<a class="pagination-button pagination-prev mini-icon '+o+'" action="prev"></a>';if(s.push(r),n<8)for(var l=0;l<n;l++){o="";e==l&&(o="pagination-current");var a='<a class="pagination-button '+o+'">'+(l+1)+"</a>";s.push(a)}else if(e<6){for(l=0;l<6;l++){o="";e==l&&(o="pagination-current");a='<a class="pagination-button '+o+'">'+(l+1)+"</a>";s.push(a)}s.push('<a class="pagination-button pagination-button-ellipsis" action="none">...</a>'),s.push('<a class="pagination-button">'+n+"</a>")}else if(n-6<e){s.push('<a class="pagination-button">1</a>'),s.push('<a class="pagination-button pagination-button-ellipsis" action="none">...</a>');for(l=6;0<l;l--){o="";e==n-l&&(o="pagination-current"),s.push('<a class="pagination-button '+o+'">'+(n-l+1)+"</a>")}}else{s.push('<a class="pagination-button">1</a>'),s.push('<a class="pagination-button pagination-button-ellipsis" action="none">...</a>');for(l=0;l<3;l++){a='<a class="pagination-button">'+(e-(2-l))+"</a>";s.push(a)}s.push('<a class="pagination-button pagination-current">'+(e+1)+"</a>"),s.push('<a class="pagination-button pagination-button-ellipsis" action="none">...</a>'),s.push('<a class="pagination-button">'+n+"</a>")}o="";e==n-1&&(o="disabled");var h='<a class="pagination-button pagination-next  mini-icon '+o+'" action="next"></a>';s.push(h),s.push("</div>");var u=s.join(" ");this.el.innerHTML=u},_updatePagerInfo:function(){for(var i=this,t=parseInt(i.pageSize),e=parseInt(i.pageIndex),n=parseInt(i.totalCount),s=(i.totalCount,Math.min(t*(e+1),n),i.sizeList),o=!1,r=0,l=s.length;r<l;r++)s[r]==t&&(o=!0);o||s.push(t),s.sort(function(t,e){return t-e});var a=[];for(r=0,l=s.length;r<l;r++)a.push({id:s[r],text:s[r]});i.sizeCombo=new mini.ComboBox,i.sizeCombo.setData(a),i.sizeCombo.setValue(t),i.sizeCombo.on("valuechanged",function(t){var e=parseInt(t.value);i._OnPageChanged(0,e)}),i.sizeCombo.render(i.el);var h=document.createElement("span");h.className="pagination-pagerchange";h.innerHTML='&nbsp&nbsp&nbsp   <input class="pagination-number"  />\t<a class="pagination-button pagination-go" action="go"></a>',i.el.appendChild(h)},_updatePager:function(){this._updatePagerButtons(),this._updatePagerInfo()},_initEvents:function(){Pagination.superclass._initEvents.call(this);var l=this;function a(t){var e=l.pageSize,i=l.totalCount,n=Math.ceil(i/e),s=parseInt(t.val());isNaN(s)?t.val(""):(n<s&&(s=n,t.val(s)),l._OnPageChanged(s-1))}setTimeout(function(){$(l.el).on("click",".pagination-button",function(t){var e=l.pageSize,i=l.pageIndex,n=l.totalCount,s=Math.ceil(n/e),o=$(t.target).attr("action");if("prev"==o)0!=i&&l._OnPageChanged(i-1);else if("next"==o)i<s-1&&l._OnPageChanged(l.pageIndex+1);else if("go"==o)a($(l.el).find(".pagination-number"));else if("none"==o);else if(!$(t.target).hasClass("current")){var r=parseInt($(t.target).text());0<r&&l._OnPageChanged(r-1)}}),$(l.el).bind("keydown",".pagination-number",function(t){13==t.keyCode&&a($(t.target))})},100)},_OnPageChanged:function(t,e){var i={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};i.pageIndex>this.totalPage-1&&(i.pageIndex=this.totalPage-1),i.pageIndex<0&&(i.pageIndex=0),this.fire("beforepagechanged",i),1!=i.cancel&&(this.fire("pagechanged",i),this.update(i.pageIndex,i.pageSize))},update:function(t,e,i){var n=this;mini.isNumber(t)&&(n.pageIndex=parseInt(t)),mini.isNumber(e)&&(n.pageSize=parseInt(e)),mini.isNumber(i)&&(n.totalCount=parseInt(i)),n.totalPage=parseInt(n.totalCount/n.pageSize)+1,(n.totalPage-1)*n.pageSize==n.totalCount&&(n.totalPage-=1),0==n.totalCount&&(n.totalPage=0),n.pageIndex>n.totalPage-1&&(n.pageIndex=n.totalPage-1),n.pageIndex<=0&&(n.pageIndex=0),n.totalPage<=0&&(n.totalPage=0),this._updatePager()},setPageIndex:function(t){isNaN(t)||(this.pageIndex=t,this.update())},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){isNaN(t)||(this.pageSize=t,this.update())},getPageSize:function(){return this.pageSize},setTotalCount:function(t){t=parseInt(t),isNaN(t)||(this.totalCount=t,this.update())},getTotalCount:function(){return this.totalCount},setSizeList:function(t){mini.isArray(t)&&(this.sizeList=t,this.update())},getSizeList:function(){return this.sizeList},setShowReloadButton:function(t){},getShowReloadButton:function(){return!1},getAttrs:function(t){var e=mini.Pager.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onpagechanged","sizeList","onbeforepagechanged","buttons","sizeText"]),mini._ParseInt(t,e,["pageIndex","pageSize","totalCount"]),"string"==typeof e.sizeList&&(e.sizeList=window.eval(e.sizeList)),e.buttons&&(e.buttons=mini.byId(e.buttons)),e}}),mini.regClass(Pagination,"pagination"),mini.PanelTip=function(){mini.PanelTip.superclass.constructor.apply(this,arguments)},mini.extend(mini.PanelTip,mini.ToolTip,{selector:".paneltip",trigger:"click",uiCls:"mini-paneltip",url:"",tplUrl:"",tpl:"",cssUrl:"",externalSrc:"",_create:function(){this.el=jQuery('<div class="mini-tooltip mini-paneltip"><div class="mini-tooltip-arrow"></div><i class="mini-paneltip-close"></i><div class="mini-tooltip-inner"></div></div>')[0],this.$element=jQuery(this.el),this.$close=jQuery(".mini-paneltip-close",this.$element),this.$element.appendTo(document.body),this.externalSrc=this.externalSrc||mini.externalSrc},_initEvents:function(){var t=this;this.$close.on("click",function(){t.close()}),this._bindTooltip()},_opened:"",open:function(t){t=jQuery(t)[0]||this.target;var e=jQuery(t).attr("data-guid"),i={element:t,data:{guid:e},cancel:!1};this.fire("beforeopen",i),i.cancel||(this.$element.show(),this._target=t,this._getData(i.data,e),this.fire("open",{element:t}))},_getData:function(t,i){var n=this;this.showLoading(),mini.ajax({url:this.url,data:t,async:!0,success:function(t){var e=mini.decode(t)||"";n._opened=i,window.Mustache?n._renderContent(e):mini.loadJS(n.externalSrc+"mustache.min.js",function(){n._renderContent(e)})}})},_renderContent:function(t){var e=Mustache.render(this.tpl,t);this.setContent(e),this.$close.removeClass("hidden")},_toggle:function(t){if(this._opened&&jQuery(t.currentTarget).attr("data-guid")===this._opened)return void this.applyPlacement();this.close(),this._enter(t)},_leave:function(t){clearTimeout(this.openTimer)},showLoading:function(){this.setContent('<div class="mini-tooltip-loading"></div>'),this.$close.addClass("hidden")},close:function(){this._target=null,this.$element.hide(),this._opened=""},setTplUrl:function(t){this.tplUrl=t,this.tpl=jQuery.trim(mini.loadText(t))},setCssUrl:function(t){this.cssUrl=t,mini.loadCSS(t)},getAttrs:function(t){var e=mini.PanelTip.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["trigger"]),e}}),mini.regClass(mini.PanelTip,"paneltip"),mini.Repeat=function(){mini.Repeat.superclass.constructor.call(this)},mini.extend(mini.Repeat,mini.ListControl,{templateId:"",templateUrl:"",url:"",externalSrc:"",uiCls:"mini-repeat",_create:function(){this.el=document.createElement("div"),this.externalSrc=this.externalSrc||mini.externalSrc},setTemplateUrl:function(t){this.templateUrl=t;var e=jQuery.ajax({url:t,async:!1}),i=this;e.done(function(t){i.template=jQuery.trim(t)}).fail(function(t,e,i){throw new Error("template not found")})},getTemplateUrl:function(){return this.templateUrl},setTemplateId:function(t){this.templateId=t;var e=document.getElementById(t);if(!e)throw new Error("template not found");this.template=jQuery.trim(e.innerHTML)},getTemplateId:function(){return this.templateId},setData:function(t){if(this.data=t||[],!this.template)throw new Error("template not init");var e=this;window.Mustache?this._renderHtml():mini.loadJS(this.externalSrc+"mustache.min.js",function(){e._renderHtml()})},_renderHtml:function(){var t,e,i,n,s=this.data.control,o=this.data.template||this.data,r=[];for(t=0,e=o.length;t<e;t++)r.push(Mustache.render(this.template,o[t]));if(this.el.innerHTML=r.join(""),mini.parse(this.el),s)for(mini.isArray(s)||(s=[]),t=0,e=s.length;t<e;t++)for(var l in i=s[t])(n=mini.get(l,this.el))&&i[l]&&(i[l].data&&(n.loadList?n.loadList(i[l].data):n.setData&&(n.setData(i[l].data),i[l].total&&n.setTotalCount&&n.setTotalCount(i[l].total))),"object"!=typeof i[l]&&n.setValue&&n.setValue(i[l]),i[l].value&&n.setValue&&n.setValue(i[l].value))},getAttrs:function(t){var e=mini.Repeat.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["templateId","templateUrl"]),e}}),mini.regClass(mini.Repeat,"repeat"),mini.Slider=function(){mini.Slider.superclass.constructor.call(this)},mini.extend(mini.Slider,mini.Control,{uiCls:"mini-slider",width:"200px",formField:!0,minValue:0,maxValue:100,step:1,precision:0,showTooltip:!0,set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value,mini.Slider.superclass.set.call(this,t),mini.isNull(e)||this.setValue(e)},_create:function(){this.el=document.createElement("div"),this.el.className="mini-slider",this.el.innerHTML='<div class="mini-slider-runway"><div class="mini-slider-bar"></div><div class="mini-slider-pointer"></div></div>',this.runway=this.el.firstChild,this.bar=this.runway.firstChild,this.pointer=this.runway.lastChild},_initEvents:function(){var t,e,i=this;function n(){e=i.value,$(window).off("mousemove",s),$(window).off("mouseup",s),$(window).off("mouseup",n),t!=e&&i.fire("valuechanged",{value:e,oldValue:t})}function s(t){i._handleChange(t)}$(this.el).on("mousedown",function(){t=i.value,$(window).on("mousemove",s),$(window).on("mouseup",s),$(window).on("mouseup",n)})},_afterApply:function(){this.showTooltip&&(this.toolTip=new mini.ToolTip,this.toolTip.set({target:document,scope:this.el,selector:"[data-tooltip]",placement:"top"}),this.toolTip.on("beforeopen",this._onBeforeShowToolTip,this))},_onBeforeShowToolTip:function(t){var e={content:t.content};this.fire("beforeshowtooltip",e),t.content=e.content},_handleChange:function(t){t.preventDefault&&t.preventDefault();var e,i,n,s,o,r,l,a,h,u=this.el,d=u.clientWidth,c=u.getBoundingClientRect().left+window.pageXOffset,m=t.pageX||(t.touches?t.touches[0].pageX:0),f=(o=(n=d)-(e=m-c),(i=0)<=(s=e-i)&&0<=o?e:Math.abs(s)>=Math.abs(o)?n:i);r=f<=0?(l=0,this.minValue):d<=f?(l=100,this.maxValue):(l=100*f/d,a=100/((this.maxValue-this.minValue)/this.step),r=Math.round(l/a)*a*(this.maxValue-this.minValue)*.01+this.minValue,parseFloat(r.toFixed(this.precision))),this.setValue(r,l),this.showTooltip&&(h={content:r},this.fire("beforeshowtooltip",h),this.toolTip.setContent(h.content))},setPosition:function(t){this.bar.style.width=t+"%",this.pointer.style.left=t+"%"},setValue:function(t,e){t=parseFloat(t),isNaN(t)&&(t=this.minValue),0<=this.precisions&&(t=t.toFixed(this.precisions)),t>this.maxValue?t=this.maxValue:t<this.minValue&&(t=this.minValue),this.value!=t&&(this.value=t,e=mini.isNumber(e)?e:(t-this.minValue)/(this.maxValue-this.minValue)*100,this.setPosition(e),this.showTooltip&&this.pointer.setAttribute("data-tooltip",t))},getValue:function(){return this.value},setMaxValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.maxValue!=t&&(this.maxValue=t,this._ValueLimit()))},getMaxValue:function(t){return this.maxValue},setMinValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.minValue!=t&&(this.minValue=t,this._ValueLimit()))},getMinValue:function(){return this.minValue},setStep:function(t){t=parseFloat(t),isNaN(t)||this.step!=t&&(this.step=t,this._adjustPrecision())},getStep:function(){return this.step},_ValueLimit:function(){this.minValue>this.maxValue&&(this.maxValue=this.minValue+100),this.value<this.minValue&&this.setValue(this.minValue),this.value>this.maxValue&&this.setValue(this.maxValue),this._adjustPrecision()},_adjustPrecision:function(){var t=[this.minValue,this.maxValue,this.step].map(function(t){var e=(""+t).split(".")[1];return e?e.length:0});this.precision=Math.max.apply(null,t)},getAttrs:function(t){var e=mini.Slider.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["maxValue","minValue","step","onvaluechanged","onbeforeshowtooltip"]),e}}),mini.regClass(mini.Slider,"slider"),mini.TabsTreeSelect=function(){mini.TabsTreeSelect.superclass.constructor.call(this)},mini.extend(mini.TabsTreeSelect,mini.ValidatorBase,{text:"",value:"",width:660,height:353,expandOnLoad:!1,idField:"id",textField:"text",nodesField:"children",url:"",filterUrl:"",filterMode:"",autoLoad:!0,data:[],tabsConfig:[],tabKeys:[],showTreeIcon:!0,showTreeLines:!0,resultAsTree:!0,showFolderCheckBox:!0,loadChildWhenChecked:!0,parentField:"pid",canCheckParent:!1,checkRecursive:!0,autoCheckParent:!1,checkOnTextClick:!0,showSelectedCount:!0,showSort:!1,selectedPanelTitle:"",delimiter:",",showFullPath:!1,includeRootNode:!1,showBorder:!1,uiCls:"mini-tabstreeselect",set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;delete t.text;var n=t.data;delete t.data;var s=t.showBorder;delete t.showBorder;var o=t.tabs;delete t.tabs;var r=t.url;delete t.url;var l=t.filterUrl;delete t.filterUrl;var a=t.filterMode;delete t.filterMode;var h=t.autoLoad;delete t.autoLoad;var u=t.showFullPath;delete t.showFullPath;var d=t.includeRootNode;delete t.includeRootNode;var c=t.showSort;return delete t.showSort,mini.TabsTreeSelect.superclass.set.call(this,t),mini.isNull(h)||this.setAutoLoad(h),mini.isNull(r)||this.setUrl(r),mini.isNull(o)||this.setTabs(o,this.autoLoad),mini.isNull(n)||this.setData(n),mini.isNull(e)||this.setValue(e),mini.isNull(i)||this.setText(i),mini.isNull(l)||this.setFilterUrl(l),mini.isNull(a)||this.setFilterMode(a),mini.isNull(u)||(this.showFullPath=u,this.tree.showFullPath=u),mini.isNull(d)||(this.includeRootNode=d,this.tree.includeRootNode=d),s&&(this.el.style.borderWidth="1px"),c?this.showSort=c:this._buttons.removeChild(this.sortBtn),this},actionTitles:{sort:"",top:"",bottom:"",remove:"",removeall:"",recover:""},sortTitles:{none:"",asc:"",desc:""},_getActionBtn:function(t,e){var i=document.createElement("span");return i.className="mini-tabstreeselect-action mini-icon "+t+("sort"===t?" none":"")+(e?" disabled":""),i.title=this.actionTitles[t],i},_create:function(){this.el=document.createElement("div"),this.el.className="mini-tabstreeselect",this.el.innerHTML='<div class="mini-tabstreeselect-left"><div class="mini-tabstreeselect-header"></div><div class="mini-tabstreeselect-content"></div></div><div class="mini-tabstreeselect-right"><div class="mini-tabstreeselect-header"><div class="mini-tabstreeselect-header-main"><span class="mini-tabstreeselect-header-title">'+this.selectedPanelTitle+'</span><span class="mini-tabstreeselect-header-count hidden"></span></div></div><div class="mini-tabstreeselect-content"></div></div>',this._leftPanel=this.el.firstChild,this._rightPanel=this.el.lastChild,this._leftHeader=this._leftPanel.firstChild,this._rightHeader=this._rightPanel.firstChild.firstChild,this._rightTitle=this._rightHeader.firstChild,this._rightCount=this._rightHeader.lastChild,this._leftHeader.innerHTML='<ul class="mini-tabstreeselect-tabs clearfix"></ul>',this._tabs=this._leftHeader.firstChild,this._leftContent=this._leftPanel.lastChild,this._rightContent=this._rightPanel.lastChild,this.tree=new mini.FilterTree,this.tree.setShowTreeIcon(!0),this.tree.setStyle("border:0;width:100%;height:100%;overflow:hidden;"),this.tree.setResultAsTree(this.resultAsTree),this.tree.setCheckRecursive(this.checkRecursive),this.tree.setShowCheckBox(!0),this.tree.setShowFolderCheckBox(this.showFolderCheckBox),this.tree.setExpandOnNodeClick(this.expandOnNodeClick),this.tree.setCheckOnTextClick(this.checkOnTextClick),this.tree.setAutoLoad(!0),this.tree.on("load",this.__OnLoad,this),this.tree.on("nodeclick",this.__OnNodeClick,this),this.tree.on("nodecheck",this.__OnCheckedChanged,this),this.tree.on("expand",this.__OnTreeExpand,this),this.tree.on("collapse",this.__OnTreeCollapse,this),this.tree.on("beforenodecheck",this.__OnTreeBeforeNodeCheck,this),this.tree.on("beforenodeselect",this.__OnTreeBeforeNodeSelect,this),this.tree.on("drawnode",this.__OnDrawNode,this),this.tree.on("loadnode",this.__OnLoadNode,this),this.tree.on("beforeload",this.__OnBeforeLoad,this),this.tree.on("filter",this.__OnFilter,this),this.tree.useAnimation=!0,this.tree.render(this._leftContent),this._rightContent.innerHTML='<div class="mini-tabstreeselect-buttons"></div><ul class="mini-tabstreeselect-list"></ul>',this._buttons=this._rightContent.firstChild,this._selectList=this._rightContent.lastChild,this._buttons.appendChild(this.sortBtn=this._getActionBtn("sort")),this._buttons.appendChild(this.topBtn=this._getActionBtn("top",!0)),this._buttons.appendChild(this.bottomBtn=this._getActionBtn("bottom",!0)),this._buttons.appendChild(this.recoverBtn=this._getActionBtn("recover")),this._buttons.appendChild(this.removeallBtn=this._getActionBtn("removeall")),this.selectNodes={},this.selectedCount=0,this._listItemTempl='<li class="mini-tabstreeselect-item" guid="{{value}}"><span class="item-name" title="{{name}}">{{name}}</span><i class="mini-tabstreeselect-action mini-icon remove" title="'+this.actionTitles.remove+'"></i></li>',this.bindEvents()},__OnDrawNode:function(t){this.fire("drawnode",t)},__OnTreeBeforeNodeCheck:function(t){t.tree=t.sender,this.fire("beforenodecheck",t)},__OnTreeBeforeNodeSelect:function(t){t.tree=t.sender,this.fire("beforenodeselect",t)},__OnTreeExpand:function(t){this.fire("treeexpand",t)},__OnTreeCollapse:function(t){this.fire("treecollapse",t)},__OnNodeClick:function(t){this.fire("nodeclick",{node:t.node})},__OnBeforeLoad:function(t){this.fire("beforeload",t)},__OnCheckedChanged:function(t){var e=t.node;e.checked?this._addNode(e):this._removeNode(e)},__OnLoadNode:function(t){var e=t.node,i=this.idField,n=this.tree,s=this.selectNodes;n.eachChild(e,function(t){s[t[i]]?n.checkNode(t):t.checked&&!t.isLeaf?n.checkNode(t):n.uncheckNode(t)})},__OnLoad:function(t){this.fire("load",t)},__OnFilter:function(t){this.tree.uncheckAllNodes();for(var e=this.getValue().split(","),i=0,n=e.length;i<n;i++){var s=this.tree.getNode(e[i]);s&&this.tree.checkNode(s)}},_addNode:function(t){var e=t[this.idField];if(this.canCheckParent||this.tree.isLeaf(t)&&!this.selectNodes[e])this.selectNodes[e]=t,"none"!=this._curAutoSortDirection?this._addNodeByDirection(t,this._curAutoSortDirection):mini.append(this._selectList,this._getItemHtml(t));else{var i=this.tree.getChildNodes(t);if(i.length||this.tree.isLeaf(t))for(var n=0,s=i.length;n<s;n++)this._addNode(i[n]);else this.loadChildWhenChecked&&(this.tree._dataSource.loadParams.needAll=!0,this.tree.loadNode(t),this.tree._dataSource.loadParams.needAll=!1)}this._selectList.style.height||(this._selectList.style.height=jQuery(this._rightContent).height()-jQuery(this._buttons).outerHeight(!0)+"px"),this._setSelectedCount()},_addNodeByDirection:function(t,e){for(var i,n,s=this.tree.getValue().split(","),o=t[this.idField],r=0,l=s.length;r<l&&s[r]!==o;r++);(i="asc"===e?s[r-1]:s[r+1])&&(n=jQuery(this._selectList).find('[guid="'+i+'"]')),n&&n.length?$(this._getItemHtml(t)).insertAfter(n):$(this._selectList).prepend(this._getItemHtml(t))},_removeNode:function(t){var e=t[this.idField];if(delete this.selectNodes[e],jQuery(this._selectList).find('li[guid="'+e+'"]').remove(),this.checkRecursive&!this.tree.isLeaf(t))for(var i=this.tree.getChildNodes(t),n=0,s=i.length;n<s;n++)this._removeNode(i[n]);this._setSelectedCount()},_getItemHtml:function(t){return this._listItemTempl.replace(/{{name}}/g,this.tree.getItemText(t)).replace("{{value}}",t[this.idField])},bindEvents:function(){var n=this;jQuery(this._tabs).on("click","> li",function(){var t=jQuery(this),e=t.index();t.hasClass("active")||n.activeTab(e)}),jQuery(this._selectList).on("click",".remove",function(){var t=jQuery(this.parentNode),e=t.attr("guid"),i=n.tree.getNode(e);t.hasClass("selected")&&(n.selectedListNode=null),i?(n._removeNode(i),n.tree.uncheckNode(i)):(t.remove(),delete n.selectNodes[e],n._setSelectedCount()),n._updateButtons()}).on("mousedown",".mini-tabstreeselect-item",function(t){n.dragItem=this,n.getDrag().start(t)}).on("click",".mini-tabstreeselect-item",function(){var t=jQuery(this);t.hasClass("selected")||(n.selectedListNode&&n.selectedListNode.removeClass("selected"),t.addClass("selected"),n.selectedListNode=t,n._updateButtons())}),jQuery(this._buttons).on("click",".mini-tabstreeselect-action",function(){mini.hasClass(this,"disabled")||(mini.hasClass(this,"sort")&&n.toggleAutoSort(),mini.hasClass(this,"top")?(n.selectedListNode.insertBefore(n._selectList.firstChild),n.toggleAutoSort(!0)):mini.hasClass(this,"bottom")?(n.selectedListNode.insertAfter(n._selectList.lastChild),n.toggleAutoSort(!0)):mini.hasClass(this,"removeall")?n.clearAll():mini.hasClass(this,"recover")&&(n.setValue(n.value),n.setText(n.text)),n._updateButtons())})},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!1,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){this._dragProxy=mini.append(document.body,'<div class="mini-tabstreeselect-proxy"></div>'),this._dragProxy.innerHTML='<div class="mini-tabstreeselect-proxy-inner">'+this.dragItem.outerHTML+"</div>",mini.setXY(this._dragProxy,t.now[0]+15,t.now[1]+18),mini.setWidth(this._dragProxy,mini.getBox(this.dragItem).width),this.feedbackLine=mini.append(document.body,"<div class='mini-feedback-line'></div>"),mini.addClass(this.dragItem,"dragging")},_OnDragMove:function(t){var e=t.now[0],i=t.now[1];mini.setXY(this._dragProxy,e+15,i+18),this.targetItem=this.insertAction=null;var n=mini.findParent(t.event.target,"mini-tabstreeselect-item");if(n){this.targetItem=n,this.insertAction="before";var s=mini.getBox(this.targetItem);i>s.y+s.height/2&&(this.insertAction="after"),this.feedbackLine.style.display="block","after"==this.insertAction?mini.setXY(this.feedbackLine,s.x,s.y+s.height):mini.setXY(this.feedbackLine,s.x,s.y),mini.setWidth(this.feedbackLine,s.width)}else this.feedbackLine.style.display="none"},_removeDrag:function(){mini.removeNode(this._dragProxy),mini.removeNode(this.feedbackLine),this._dragProxy=this.feedbackLine=this.dragItem=this.targetItem=null},_OnDragStop:function(t){this.targetItem&&("before"==this.insertAction?this._selectList.insertBefore(this.dragItem,this.targetItem):this._selectList.lastChild==this.targetItem?this._selectList.appendChild(this.dragItem):this._selectList.insertBefore(this.dragItem,this.targetItem.nextSibling),this.toggleAutoSort(!0)),mini.removeClass(this.dragItem,"dragging"),this._removeDrag()},_curAutoSortDirection:"none",toggleAutoSort:function(t){if(this.showSort){var e=t?"none":this._getNextAutoSortDirection();mini.removeClass(this.sortBtn,"asc desc none"),mini.addClass(this.sortBtn,e),this.sortBtn.setAttribute("title",this.sortTitles[e]),"none"!=(this._curAutoSortDirection=e)&&this._serverSort(e)}},_getNextAutoSortDirection:function(){switch(this._curAutoSortDirection){case"asc":return"desc";case"desc":default:return"asc"}},_serverSort:function(t){var e=this.getValue(),i={value:e,direction:t,eventType:"sortChanged"},n={url:this.treeUrl,data:i,sender:this};this.fire("beforesortchanged",n),e&&1<e.split(",").length&&this._loadValue(n)},_loadValue:function(t){var a=this,e=setTimeout(function(){a.mask(),a.isMask=!0},100);jQuery.ajax({url:t.url,data:t.data,type:"post",dataType:"json",success:function(t){if(t=mini.getSecondRequestData(t)){var e,i,n,s=a.getValue(),o=0,r=0,l=[];if(a._selectList.innerHTML="",a.selectNodes={},t.value){for(e=t.value.split(","),i=t.text.split(","),r=e.length;o<r;o++)(n={})[a.idField]=e[o],n[a.textField]=i[o],a.selectNodes[e[o]]=n,l.push(a._getItemHtml(n));a._selectList.insertAdjacentHTML("afterbegin",l.join(""))}a._updateButtons(),a._setSelectedCount(r),s!=a.getValue()&&a._OnValueChanged()}},complete:function(){e&&clearTimeout(e),a.isMask&&(a.unmask(),a.isMask=!1)}})},_updateButtons:function(){function t(t){mini.removeClass(t,"disabled")}function e(t){mini.addClass(t,"disabled")}this.selectedListNode&&this.selectedListNode.siblings().length?this.selectedListNode.prev().length?this.selectedListNode.next().length?(t(this.topBtn),t(this.bottomBtn)):(t(this.topBtn),e(this.bottomBtn)):(e(this.topBtn),t(this.bottomBtn)):(e(this.topBtn),e(this.bottomBtn))},getSelectedNodes:function(){var n=[];return jQuery(this._selectList).children("li").each(function(t,e){var i=jQuery(e);n.push({value:i.attr("guid"),text:i.text()})}),n},setSelectedNodes:function(t){for(var e=0,i=t.length;e<i;e++){var n=this.tree.getNode(t[e].value);n?this.tree.selectNode(n):((n={})[this.textField]=t[e].text,n[this.idField]=t[e].value,this.selectNodes[t[e].value]=n,mini.append(this._selectList,this._getItemHtml(n)))}},clearAll:function(){this._selectList.innerHTML&&(this._selectList.innerHTML="",this.selectNodes={},this.selectedListNode=null,this.tree.uncheckAllNodes(),this._setSelectedCount(0))},setValue:function(t){var e=(this.value=t).split(","),i=[];if(this.clearAll(),t){for(var n=0,s=e.length;n<s;n++){var o=this.tree.getNode(e[n]);o?this.tree.checkNode(o):(o={})[this.textField]=o[this.idField]=e[n],this.selectNodes[e[n]]=o,i.push(this._getItemHtml(o))}mini.append(this._selectList,i.join("")),this._updateButtons(),this._setSelectedCount()}},getValue:function(){var i=[];return jQuery(this._selectList).children("li").each(function(t,e){i.push(jQuery(e).attr("guid"))}),i.join(",")},setText:function(t){if(this.text=t)for(var e,i,n=t.split(","),s=this.value.split(","),o=0,r=s.length;o<r;o++)i=s[o],(e=this.selectNodes[i])&&(e[this.textField]=n[o],jQuery(this._selectList).find('li[guid="'+i+'"]').find(".item-name").attr("title",n[o]).html(n[o]))},getText:function(){var i=[];return jQuery(this._selectList).children("li").each(function(t,e){i.push(jQuery(e).find(".item-name").text())}),i.join(",")},setSelectedPanelTitle:function(t){this.selectedPanelTitle=t,this._rightTitle.innerHTML=t},_setSelectedCount:function(t){this.showSelectedCount&&(0!==(t=0<=t?t:jQuery(this._selectList).children("li").length)?mini.removeClass(this._rightCount,"hidden"):mini.addClass(this._rightCount,"hidden"),this._rightCount.innerHTML=t)},setShowSelectedCount:function(t){this.showSelectedCount=!0===t,this.showSelectedCount?mini.removeClass(this._rightCount,"hidden"):mini.addClass(this._rightCount,"hidden")},getShowSelectedCount:function(){return this.showSelectedCount},doLayout:function(){var t=jQuery(this.el).height();this._leftPanel.style.height=t+"px",this._rightPanel.style.height=t+"px";var e=jQuery(this._rightContent).height()-jQuery(this._buttons).outerHeight(!0);this._selectList.style.height=(0<=e?e:0)+"px",this.tree.doLayout()},setTabs:function(t,e){var i,n,s=[],o=0<this.url.indexOf("?");for(this.tabsConfig=[],this.tabKeys=[],i=0,n=t.length;i<n;i++){s.push("<li>"+t[i].tabText+"</li>");var r=(o?"&":"?")+"tabKey="+t[i].tabKey;this.tabsConfig.push({url:this.url+r,filterMode:t[i].filterMode,filterUrl:this.filterUrl?this.filterUrl+r:void 0}),this.tabKeys.push(t[i].tabKey)}this._tabs.innerHTML=s.join(""),this.doLayout(),this.activeTab(0,e)},addTab:function(t,e){var i=(0<this.url.indexOf("?")?"&":"?")+"tabKey="+t.tabKey;this.tabsConfig.push({url:this.url+i,filterMode:t.filterMode,filterUrl:this.filterUrl?this.filterUrl+i:void 0}),this.tabKeys.push(t.tabKey),jQuery("<li>"+t.tabText+"</li>").appendTo(this._tabs),this.doLayout(),!1!==e&&this.activeTab(this.tabsConfig.length-1,!0)},_activeTabIndex:0,activeTab:function(t,e){var i=this.tabsConfig[t],n=jQuery(this._tabs).children().eq(t);if(i){n.hasClass("active")||(n.siblings(".active").removeClass("active"),n.addClass("active")),this._activeTabIndex=t;var s=this.tree._filterInput.getValue();this.tree._filterKey=s,i.filterMode&&this.tree.setFilterMode(i.filterMode),i.filterUrl&&this.tree.setFilterUrl(i.filterUrl);var o=s&&"server"===this.tree.filterMode;o?(this.tree.setAutoLoad(!1),this.tree.setUrl(i.url),this.treeUrl=i.url,this.tree._doFilter(s)):(!1===e?this.tree.setAutoLoad(!1):this.tree.setAutoLoad(!0),this.tree._dataSource.ajaxData={activeTab:!0},this.tree.setUrl(i.url),this.tree._dataSource.ajaxData=null,this.tree._dataSource.loadParams&&(this.tree._dataSource.loadParams.activeTab=!1),this.treeUrl=i.url,!o&&!1!==e||this.tree.setAutoLoad(!0),s&&this.tree._doFilter(s))}},setData:function(data){"string"==typeof data&&(data=eval("("+data+")")),mini.isArray(data)||(data=[]),this.resultAsTree?this.tree.setData(data):this.tree.loadList(data),this.data=this.tree.data},getData:function(){return this.data},setUrl:function(t){this.url=t,this._updateTabsUrl()},getUrl:function(){return this.url},getAutoLoad:function(){return this.autoLoad},setAutoLoad:function(t){this.autoLoad=t},setTabKeys:function(t){this.tabKeys=t,this._updateTabsUrl()},_updateTabsUrl:function(){var t,e=Math.min(this.tabKeys.length,this.tabsConfig.length),i=0<this.url.indexOf("?");if(0<e){for(t=0;t<e;t++){var n=(i?"&":"?")+"tabKey="+this.tabKeys[t];this.tabsConfig[t].url=this.url+n,this.tabsConfig[t].filterUrl=this.filterUrl?this.filterUrl+n:void 0}this.activeTab(0,this.autoLoad)}},load:function(){this.tree.load()},setResultAsTree:function(t){this.resultAsTree=t,this.tree&&this.tree.setResultAsTree(t)},getResultAsTree:function(){return this.resultAsTree},setParentField:function(t){this.parentField=t,this.tree&&this.tree.setParentField(t)},getParentField:function(){return this.parentField},setIdField:function(t){this.tree&&this.tree.setIdField(t),this.idField=t},getIdField:function(){return this.idField},getTextField:function(){return this.textField},setTextField:function(t){this.textField=t,this.tree&&this.tree.setTextField(t)},getNodesField:function(){return this.nodesField},setNodesField:function(t){this.nodesField=t,this.tree&&this.tree.setNodeField(t)},setShowTreeIcon:function(t){this.showTreeIcon=t,this.tree&&this.tree.setShowTreeIcon(t)},getShowTreeIcon:function(){return this.showTreeIcon},setShowTreeLines:function(t){this.showTreeLines=t,this.tree&&this.tree.setShowTreeLines(t)},getShowTreeLines:function(){return this.showTreeLines},setShowFolderCheckBox:function(t){this.showFolderCheckBox=t,this.tree&&this.tree.setShowFolderCheckBox(t)},getShowFolderCheckBox:function(){return this.showFolderCheckBox},setFilterUrl:function(t){this.filterUrl=t,this.tree&&this.tree.setFilterUrl(t)},getFilterUrl:function(){return this.filterUrl},setFilterMode:function(t){this.filterMode=t,this.tree&&this.tree.setFilterMode(t)},getFilterMode:function(){return this.filterMode},setCanCheckParent:function(t){this.canCheckParent=t,this.tree&&this.tree.setCheckRecursive(!t)},getCanCheckParent:function(){return this.canCheckParent},setCheckRecursive:function(t){this.checkRecursive=t,this.tree&&this.tree.setCheckRecursive(t)},getCheckRecursive:function(){return this.checkRecursive},setAutoCheckParent:function(t){this.autoCheckParent=t,this.tree&&this.tree.setAutoCheckParent(t)},getAutoCheckParent:function(){return this.AutoCheckParent},setExpandOnLoad:function(t){this.expandOnLoad=t,this.tree&&this.tree.setExpandOnLoad(t)},getExpandOnLoad:function(){return this.expandOnLoad},setCheckOnTextClick:function(t){this.checkOnTextClick=t,this.tree&&this.tree.setCheckOnTextClick(t)},getAttrs:function(t){var e=mini.TabsTreeSelect.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["data","textField","pinyinField","idField","nodesField","parentField","onbeforenodecheck","onbeforenodeselect","onnodeclick","url","filterUrl","filterMode","onbeforeload","onload","ontreeexpand","ontreecollapse","ondrawnode","selectedPanelTitle"]),mini._ParseBool(t,e,["expandOnNodeClick","expandOnLoad","resultAsTree","showTreeIcon","showTreeLines","showFolderCheckBox","canCheckParent","showBorder","loadChildWhenChecked","autoLoad","checkRecursive","autoCheckParent","showFullPath","includeRootNode","checkOnTextClick","showSelectedCount","showSort"]);var i,n,s=[],o=mini.getChildNodes(t),r=null;for(i=0,n=o.length;i<n;i++)r={},mini._ParseString(o[i],r,["tabText","tabKey","filterMode"]),s.push(r);return e.tabs=s,e}}),mini.regClass(mini.TabsTreeSelect,"tabstreeselect"),mini.TreeSelect=function(){this.data=[],mini.TreeSelect.superclass.constructor.apply(this,arguments)},mini.extend(mini.TreeSelect,mini.PopupEdit,{valueFromSelect:!1,text:"",value:"",autoCheckParent:!1,expandOnLoad:!1,valueField:"id",textField:"text",nodesField:"children",dataField:"",delimiter:",",multiSelect:!1,data:[],url:"",allowInput:!1,showTreeIcon:!1,showTreeLines:!0,resultAsTree:!1,parentField:"pid",checkRecursive:!1,showFolderCheckBox:!1,showRadioButton:!1,showFilter:!1,filterMode:"client",filterUrl:"",showFullPath:!1,includeRootNode:!1,popupHeight:200,popupWidth:"100%",popupMaxHeight:250,popupMinWidth:100,setAjaxData:function(t){this.ajaxData=t,this.tree.setAjaxData(t)},setAjaxType:function(t){this.ajaxType=t,this.tree.setAjaxType(t)},setAjaxOptions:function(t){this.ajaxOptions=t,this.tree.setAjaxOptions(t)},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;delete t.text;var n=t.url;delete t.url;var s=t.data;delete t.data;var o=t.showFullPath;delete t.showFullPath;var r=t.includeRootNode;return delete t.includeRootNode,mini.TreeSelect.superclass.set.call(this,t),mini.isNull(s)||this.setData(s),mini.isNull(n)||this.setUrl(n),mini.isNull(e)||this.setValue(e),mini.isNull(i)||this.setText(i),mini.isNull(o)||(this.showFullPath=o,this.tree.showFullPath=o),mini.isNull(r)||(this.includeRootNode=r,this.tree.includeRootNode=r),this},uiCls:"mini-treeselect",_createPopup:function(){mini.TreeSelect.superclass._createPopup.call(this),this.tree=new mini.FilterTree,this.tree.setShowTreeIcon(!0),this.tree.setStyle("border:0;width:100%;height:100%;overflow:hidden;"),this.tree.setResultAsTree(this.resultAsTree),this.tree.render(this.popup._contentEl),this.tree.setCheckRecursive(this.checkRecursive),this.tree.setShowFolderCheckBox(this.showFolderCheckBox),this.tree.setShowRadioButton(this.showRadioButton),this.tree.setExpandOnNodeClick(this.expandOnNodeClick),mini.isNull(this.defaultRowHeight)||(this.tree.defaultRowHeight=this.defaultRowHeight);var e=this;this.tree.on("nodeclick",function(t){setTimeout(function(){e.__OnNodeClick(t)},10)},this),this.tree.on("nodecheck",this.__OnCheckedChanged,this),this.tree.on("expand",this.__OnTreeExpand,this),this.tree.on("collapse",this.__OnTreeCollapse,this),this.tree.on("beforenodecheck",this.__OnTreeBeforeNodeCheck,this),this.tree.on("beforenodeselect",this.__OnTreeBeforeNodeSelect,this),this.tree.on("drawnode",this.__OnDrawNode,this),this.tree.useAnimation=!1,this.tree.set({showToolbar:this.showFilter,filterMode:this.filterMode,filterUrl:this.filterUrl});e=this;this.tree.on("beforeload",function(t){e.fire("beforeload",t)},this),this.tree.on("load",function(t){e.fire("load",t)},this),this.tree.on("loaderror",function(t){e.fire("loaderror",t)},this)},__OnDrawNode:function(t){this.fire("drawnode",t)},__OnTreeBeforeNodeCheck:function(t){t.tree=t.sender,this.fire("beforenodecheck",t)},__OnTreeBeforeNodeSelect:function(t){t.tree=t.sender,this.fire("beforenodeselect",t),t.cancel&&(this._nohide=!0)},__OnTreeExpand:function(t){},__OnTreeCollapse:function(t){},findItems:function(t){return this.tree.findNodes(this.tree.getIdField(),t)},findNodes:function(t){return this.tree.getNodesByValue(t)},getSelectedNode:function(){return this.getSelectedNodes()[0]},getCheckedNodes:function(t){var e=this.tree.getNodesByValue(this.value);return!1===t&&(t="leaf"),e=this.tree._dataSource.doGetCheckedNodes(e,t)},getSelectedNodes:function(){return this.tree.getNodesByValue(this.value)},getParentNode:function(t){return this.tree.getParentNode(t)},getChildNodes:function(t){return this.tree.getChildNodes(t)},showPopup:function(){var t={cancel:!1};if(this.fire("beforeshowpopup",t),this._firebeforeshowpopup=!1,1!=t.cancel){this.popup.el.style.height;mini.TreeSelect.superclass.showPopup.call(this),this.tree.setValue(this.value,!1),this.expandOnPopup&&this.tree.expandPath(this.value),this._nohide=!1}},expandOnPopup:!1,setExpandOnPopup:function(t){this.expandOnPopup=t},getExpandOnPopup:function(){return this.expandOnPopup},__OnPopupHide:function(t){this.__doFocusCls(),this.tree.clearFilter(),this.fire("hidepopup")},getItem:function(t){return"object"==typeof t?t:this.data[t]},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},loadList:function(t,e,i){this.tree.loadList(t,e,i),this.data=this.tree.getData(),this._getCheckedValue()},getList:function(){return this.tree.getList()},load:function(t){this.tree.load(t),this.data=this.tree.data,this._getCheckedValue()},_eval:function(_){return eval("("+_+")")},setData:function(t){"string"==typeof t&&(t=this._eval(t)),mini.isArray(t)||(t=[]),this.tree.setData(t),this.data=this.tree.data,this._getCheckedValue()},getData:function(){return this.data},_getCheckedValue:function(){var t=this.tree.getValue();this.setValue(t)},setUrl:function(t){this.getPopup(),this.tree.setUrl(t),this.url=this.tree.url,this.data=this.tree.data,this._getCheckedValue()},getUrl:function(){return this.url},virtualScroll:!1,setVirtualScroll:function(t){this.tree&&this.tree.setVirtualScroll(t),this.virtualScroll=t},getVirtualScroll:function(){return this.virtualScroll},defaultRowHeight:23,setDefaultRowHeight:function(t){this.tree&&(this.tree.defaultRowHeight=t),this.defaultRowHeight=t},getDefaultRowHeight:function(){return this.defaultRowHeight},pinyinField:"tag",setPinyinField:function(t){this.pinyinField=t},getPinyinField:function(){return this.pinyinField},setTextField:function(t){this.tree&&this.tree.setTextField(t),this.textField=t},getTextField:function(){return this.textField},setNodesField:function(t){this.tree&&this.tree.setNodesField(t),this.nodesField=t},getNodesField:function(){return this.nodesField},setDataField:function(t){this.tree&&this.tree.setDataField(t),this.dataField=t},getDataField:function(){return this.dataField},getValue:function(){var t=mini.TreeSelect.superclass.getValue.call(this);return this.valueFromSelect&&t&&0==this.findItems(t).length?"":t},setValue:function(t){var e=this.tree.getValueAndText(t);""!=e[1]||this.valueFromSelect||(e[0]=t,e[1]=t),this.value=t,this._valueEl.value=t,this.text=this._textEl.value=mini.htmlDecode(e[1]),this._doEmpty()},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t,this.tree.setShowCheckBox(t),this.tree.setAllowSelect(!t),this.tree.setEnableHotTrack(!t))},getMultiSelect:function(){return this.multiSelect},__OnNodeClick:function(t){if(!this.multiSelect){var e=this.tree.getSelectedNode(),i=this.tree.getValueAndText(e)[0],n=this.getValue();this.setValue(i),n!=this.getValue()&&this._OnValueChanged(),!0!==this._nohide&&(this.hidePopup(),isMobile||this.focus()),this._nohide=!1,this.fire("nodeclick",{node:t.node})}},__OnCheckedChanged:function(t){if(this.multiSelect){var e=this.tree.getValue(),i=this.getValue();this.setValue(e),i!=this.getValue()&&this._OnValueChanged(),isMobile||this.focus()}},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(!this.isReadOnly())switch(t.keyCode){case 27:this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 13:var i=this;setTimeout(function(){i.fire("enter",e)},10);break;case 37:break;case 38:t.preventDefault();break;case 39:break;case 40:t.preventDefault(),this.showPopup();break;default:if(0==this.allowInput);else{i=this;setTimeout(function(){i._doQuery()},10)}}}else this.isShowPopup()&&this.hidePopup()},_doQuery:function(){if(!this.multiSelect){var n=this.textField,s=this.pinyinField,o=this._textEl.value.toLowerCase();this.tree.filter(function(t){var e=String(t[n]?t[n]:"").toLowerCase(),i=String(t[s]?t[s]:"").toLowerCase();return-1!=e.indexOf(o)||-1!=i.indexOf(o)}),this.tree.expandAll(),this.showPopup()}},setCheckRecursive:function(t){this.checkRecursive=t,this.tree&&this.tree.setCheckRecursive(t)},getCheckRecursive:function(){return this.checkRecursive},setResultAsTree:function(t){this.resultAsTree=t,this.tree&&this.tree.setResultAsTree(t)},getResultAsTree:function(){return this.resultAsTree},setParentField:function(t){this.parentField=t,this.tree&&this.tree.setParentField(t)},getParentField:function(){return this.parentField},setValueField:function(t){this.tree&&this.tree.setIdField(t),this.valueField=t},getValueField:function(){return this.valueField},setShowTreeIcon:function(t){this.showTreeIcon=t,this.tree&&this.tree.setShowTreeIcon(t)},getShowTreeIcon:function(){return this.showTreeIcon},setShowTreeLines:function(t){this.showTreeLines=t,this.tree&&this.tree.setShowTreeLines(t)},getShowTreeLines:function(){return this.showTreeLines},setShowFolderCheckBox:function(t){this.showFolderCheckBox=t,this.tree&&this.tree.setShowFolderCheckBox(t)},getShowFolderCheckBox:function(){return this.showFolderCheckBox},setShowRadioButton:function(t){this.showRadioButton=t,this.tree&&this.tree.setShowRadioButton(t)},getShowRadioButton:function(){return this.showRadioButton},setAutoCheckParent:function(t){this.autoCheckParent=t,this.tree&&this.tree.setAutoCheckParent(t)},getAutoCheckParent:function(){return this.autoCheckParent},setExpandOnLoad:function(t){this.expandOnLoad=t,this.tree&&this.tree.setExpandOnLoad(t)},getExpandOnLoad:function(){return this.expandOnLoad},setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},setAjaxData:function(t){this.ajaxData=t,this.tree.setAjaxData(t)},setAjaxType:function(t){this.ajaxType=t,this.tree.setAjaxType(t)},expandOnNodeClick:!1,setExpandOnNodeClick:function(t){this.expandOnNodeClick=t,this.tree&&this.tree.setExpandOnNodeClick(t)},getExpandOnNodeClick:function(){return this.expandOnNodeClick},getFilterUrl:function(){return this.filterUrl||this.url},getShowFilter:function(){return this.showFilter},setShowFilter:function(t){this.showFilter=t,this.tree.set({showToolbar:t})},setFilterUrl:function(t){this.filterUrl=t,this.tree.setFilterUrl(t)},getFilterMode:function(){return this.filterMode},setFilterMode:function(t){this.filterMode=t,this.tree.setFilterMode(t)},clear:function(){this.tree._filterInput.setValue(""),this.tree._doFilter("")},getAttrs:function(t){var e=mini.TreeSelect.superclass.getAttrs.call(this,t);if(mini._ParseString(t,e,["url","data","textField","pinyinField","valueField","nodesField","parentField","onbeforenodecheck","onbeforenodeselect","expandOnLoad","onnodeclick","onbeforeload","onload","onloaderror","ondrawnode","filterMode","filterUrl"]),mini._ParseBool(t,e,["expandOnNodeClick","multiSelect","resultAsTree","checkRecursive","showTreeIcon","showTreeLines","showFolderCheckBox","showRadioButton","autoCheckParent","valueFromSelect","virtualScroll","expandOnPopup","showFilter","showFullPath","includeRootNode"]),mini._ParseInt(t,e,["defaultRowHeight"]),e.expandOnLoad){var i=parseInt(e.expandOnLoad);mini.isNumber(i)?e.expandOnLoad=i:e.expandOnLoad="true"==e.expandOnLoad}return e}}),mini.regClass(mini.TreeSelect,"TreeSelect"),jQuery(function(){setTimeout(function(){try{var t=mini.getActiveElement();if(t){var e=jQuery(t).closest(".mini-buttonedit, .mini-textbox");if(e.length){var i=mini.get(e[0]);i&&(i.blur(),i.focus())}}}catch(t){}},100)}),mini.VerifyCode=function(){mini.VerifyCode.superclass.constructor.apply(this,arguments)},mini.extend(mini.VerifyCode,mini.Control,{url:"",autoLoad:!0,width:78,height:26,charLength:4,uiCls:"mini-verifycode",set:function(t){if("string"==typeof t)return this;var e=t.url;return delete t.url,mini.VerifyCode.superclass.set.call(this,t),e&&this.setUrl(e),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<img title=""></img>',this._img=this.el.firstChild},_initEvents:function(){var t=this;mini.on(this._img,"click",function(){t._doLoad({width:parseInt(this.width),height:parseInt(this.height),charLength:t.charLength})})},setData:function(t){this.value=t.value,this._img.src=t.src,this.uuid=t.uuid},setUrl:function(t){this.url=t,this.autoLoad&&this._doLoad({width:parseInt(this.width),height:parseInt(this.height),charLength:this.charLength})},getUrl:function(){return this.url},_doLoad:function(t){t=t||{};var r={url:this.url,async:!1,type:this.ajaxType?this.ajaxType:"post",data:t,params:t,cache:!1,cancel:!1};if(this.fire("beforeload",r),r.data!=r.params&&r.params!=t&&(r.data=r.params),1!=r.cancel){var l=me=this,a=r.url;mini.copyTo(r,{success:function(t,e,i){delete r.params;var n={text:t,result:null,sender:me,options:r,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(o){1==mini_debugger&&alert(a+"\njson is error.")}var o={data:(s={data:s}).data,cancel:!1,result:s};l.fire("preload",o),1!=o.cancel&&(l.setData(o.data),delete o.cancel,l.fire("load",o))},error:function(t,e,i){var n={xhr:t,text:t.responseText,textStatus:e,errorMsg:t.responseText,errorCode:t.status};1==mini_debugger&&alert(a+"\n"+n.errorCode+"\n"+n.errorMsg),l.fire("loaderror",n)}}),this._ajaxer=mini.ajax(r)}},getAttrs:function(t){var e=mini.VerifyCode.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","data","onbeforeload","onload","onloaderror","onpreload"]),mini._ParseBool(t,e,["autoLoad"]),mini._ParseInt(t,e,["charLength"]),e}}),mini.regClass(mini.VerifyCode,"verifycode"),mini.WebEditor=function(){mini.WebEditor.superclass.constructor.call(this)},mini.extend(mini.WebEditor,mini.Control,{width:"100%",height:"350px",readOnly:!1,editstyle:"coolblue",editSkin:"flat10",value:"",uiCls:"mini-webeditor",formField:!0,_editorModel:window.mini_editor_model||"ewebeditor",_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<textarea style="display:none"></textarea>',this._fromEditor=this.el.firstChild,this._editor=new mini.TextArea,this._editor.setVisible(!1),this._editor.render(this.el);var t=this;this.externalSrc=this.externalSrc||mini.externalSrc,"ewebeditor"===this._editorModel?window.EWEBEDITOR?this._initEditor():mini.loadJS(this.externalSrc+"ewebeditor/ewebeditor.js",function(){t._initEditor()}):window.UE?this._initEditor():mini.loadJS(this.externalSrc+"ueditor/ueditor.config.js",function(){mini.loadJS(t.externalSrc+"ueditor/ueditor.all.js",function(){t._initEditor()})})},render:function(t){mini.WebEditor.superclass.constructor.call(this,t)},_initEditor:function(){var t=this;setTimeout(function(){t._doInitEditor()},1)},_doInitEditor:function(){if(!1!==this.isRender()&&!this.editor){var t=this;this._editor.set({name:this.id,id:this.id+"_editor"}),this._fromEditor.id=this.id+"_fromEditor","ewebeditor"===this._editorModel?(this.editor=EWEBEDITOR.Replace(this._fromEditor.id,{width:this.width.replace("px",""),height:this.height.replace("px",""),readonly:this.readOnly?"2":"",style:this.editstyle,skin:this.editSkin}),this.fire("init",{sender:this,type:"init"})):(this.editor=UE.getEditor(this._fromEditor.id,{initialFrameWidth:this.width.replace("px",""),readonly:this.readOnly}),this.editor.ready(function(){t.editor.container.parentElement.style.display="",t.value&&t.editor.setContent(t.value),t._$toolbar=jQuery(t.editor.container).find(".edui-editor-toolbarbox"),t._$footer=jQuery(t.editor.container).find(".edui-editor-bottomContainer"),t.setHeight(t.height),t.fire("init",{sender:t,type:"init"})}))}},getEditor:function(){return this.editor},getEditorPromise:function(i){var n=this,s=jQuery.Deferred(),o=0;return function t(){if(50<o++)return s.reject(new Error(""));var e=n.editor;e?setTimeout(function(){s.resolve(e),"function"==typeof i&&i(e)}):setTimeout(t,20)}(),s.promise()},setValue:function(t){this.value=this._fromEditor.value=t,"ewebeditor"===this._editorModel?window.EWEBEDITOR&&EWEBEDITOR.SetHtmlAsync(this._fromEditor.id,t):this.editor&&this.editor.isReady&&this.editor.setContent(t)},getValue:function(){if("ewebeditor"===this._editorModel){if(this.editor&&this.editor.getHTML)return this.editor.getHTML()}else if(this.editor&&this.editor.isReady)return this.editor.getContent();return this.value},setSubmitData:function(){this._editor&&this._editor.setValue(this.getValue())},getSubmitData:function(){return this._editor?this._editor.getValue():this.getValue()},setReadOnly:function(t){this.editor&&("ewebeditor"===this._editorModel?this.editor.setReadOnly(t?"2":""):this.editor.isReady&&(t?this.editor.setDisabled("fullscreen"):this.editor.setEnabled())),this.readOnly=t},getReadOnly:function(){return this.readOnly},setHeight:function(t){"ueditor"===this._editorModel&&(t="100%"==t?jQuery(this.el.parentElement).height():parseInt(t))&&(this.height=t,this.editor&&this.editor.isReady&&this.editor.setHeight(t-this._$toolbar.height()-this._$footer.height()))},getAttrs:function(t){var e=mini.WebEditor.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["value","text","editstyle","editSkin","oninit"]),mini._ParseBool(t,e,["readOnly"]),e}}),mini.regClass(mini.WebEditor,"webeditor"),mini.WebUploader=function(){mini.WebUploader.superclass.constructor.call(this)},mini.extend(mini.WebUploader,mini.Control,{uiCls:"mini-webuploader",uploadUrl:"",limitType:"",mimeTypes:"",auto:!0,fileNumLimit:void 0,fileSizeLimit:void 0,fileSingleSizeLimit:void 0,fileNameLengthLimit:100,chunked:!1,chunkSize:5120,chunkRetry:2,duplicate:void 0,needMD5:!1,compress:!1,timeout:12e4,externalSrc:"",state:"pending",pickerText:"",startText:"",pauseText:"",numLimitErrorText:"</br>{0}",sizeLimitErrorText:"</br>{0}KB",typeDeniedErrorText:"</br>{0}",sizeErrorText:"</br>{0}KB",emptyFileErrorText:"",duplicateErrorText:"",fileNameLengthErrorText:"</br>{0}",set:function(t){if("string"==typeof t)return this;var e=t.pickerText;return delete t.pickerText,mini.WebUploader.superclass.set.call(this,t),e&&(this.pickerText=e,this._picker.innerHTML=e),this._initUploader(),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<div class="mini-uploader-btns"><div class="mini-btn-pick">'+this.pickerText+'</div></div><div class="mini-uploader-list"></div>',this._buttons=this.el.firstChild,this._fileList=this.el.lastChild,this._picker=this._buttons.firstChild,this._uploadBtn=new mini.Button,this._uploadBtn.setText(this.startText),this._uploadBtn.render(this._buttons),this._errorContent="",this._buttons.style.visibility="hidden",this.on("render",this._initUploader,this)},_isInit:!1,_initUploader:function(){var t=this;this.isInit||(this.externalSrc=this.externalSrc||mini.externalSrc,window.WebUploader?this._createUploader():mini.loadJS(this.externalSrc+"webuploader/webuploader.min.js",function(){t._createUploader()}),this.isInit=!0)},_createUploader:function(){var t=null,o=this;this.limitType&&(t={extensions:this.limitType,mimeTypes:this.mimeTypes}),this._fileMD5={},this.chunked&&!this._isInit?(this._hasFinishedList={},window.isRegWebUploader||(WebUploader.Uploader.register({"before-send-file":"preupload","before-send":"checkchunk","after-send-file":"finished"},{preupload:function(i){var t=this.owner,n=this.options.server,s=WebUploader.Deferred(),e=$(i.source._refer).closest(".mini-webuploader");if((o=mini.getAndCreate(e[0])).chunked)return t.md5File(i.source).fail(function(){s.reject()}).then(function(t){o._fileMD5[i.id]=t,i.uuid=UUID();var e={url:n,data:{fileMD5:t,fileName:i.name,fileSize:i.size,uploadGuid:i.uuid}};o._onBeforeMd5File(e),$.ajax(e.url,{dataType:"json",data:e.data,type:"post",success:function(t){o._onMd5File(t,i),s.resolve()},error:function(){s.reject(),$.ajaxSettings.error&&$.ajaxSettings.error.apply(this,arguments)}})}),s.promise()},checkchunk:function(t){if(o.chunked){var e=","+t.chunk+",",i=$.Deferred();return-1<o._existFileParts.indexOf(e)?i.reject():i.resolve(),i.promise()}},finished:function(e){var t=WebUploader.Deferred();if(o.chunked){if(o._hasFinishedList[e.id])return o._hasFinishedList[e.id]=!1,void delete o._hasFinishedList[e.id];var i={url:o.uploadUrl,data:{fileMD5:o._fileMD5[e.id],fileName:e.name,fileSize:e.size,uploadGuid:e.uuid,contentType:e.type}};o._onBeforeMd5FileFinished(i),$.ajax(i.url,{dataType:"json",data:i.data,type:"post",success:function(t){o._onMd5FileFinished(t,e),delete o._fileMD5[e.id]},error:function(){t.reject(),$.ajaxSettings.error&&$.ajaxSettings.error.apply(this,arguments)}})}}}),window.isRegWebUploader=!0)):this.needMD5&&WebUploader.Uploader.register({"before-send-file":"preupload"},{preupload:function(e){var t=this.owner,i=WebUploader.Deferred();return t.md5File(e.source).fail(function(){i.reject()}).then(function(t){o._fileMD5[e.id]=t,i.resolve()}),i.promise()}});try{this._uploader=WebUploader.create({swf:this.externalSrc+"webuploader/Uploader.swf",server:this.uploadUrl,pick:{id:this._picker,multiple:1!=this.fileNumLimit},auto:this.auto,fileNumLimit:this.fileNumLimit,fileSizeLimit:1024*this.fileSizeLimit,fileSingleSizeLimit:1024*this.fileSingleSizeLimit,accept:t,chunked:this.chunked,chunkSize:1024*this.chunkSize,chunkRetry:this.chunkRetry,compress:this.compress,duplicate:this.duplicate,timeout:this.timeout})}catch(t){if("Runtime Error"!=t.message)throw t;if(mini.isIE9||mini.isIE8||mini.isIE7||mini.isIE6)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){o.el.innerHTML='<a class="noflash" title="Falsh" href="http://get.adobe.com/flashplayer/" target="_blank"></a>',mini.showPageWarning({html:'Flash<a href="http://get.adobe.com/flashplayer/" target="_blank">Falsh</a>'})}return}this._uploader.on("beforeFileQueued",function(t){return o._beforeFileQueued(t)}).on("filesQueued",function(t){o._onFilesQueued(t)}).on("fileDequeued",function(t){o._onFileDequeued(t)}).on("reset",function(){o._onReset()}).on("startUpload",function(){o._onStartUpload()}).on("stopUpload",function(){o._onStopUpload()}).on("uploadFinished",function(){o._onUploadFinished()}).on("uploadStart",function(t){o._onUploadStart(t)}).on("uploadBeforeSend",function(t,e,i){o._onUploadBeforeSend(t,e,i)}).on("uploadAccept",function(t,e){return o._onUploadAccept(t,e)}).on("uploadProgress",function(t,e){o._onUploadProgress(t,e)}).on("uploadSuccess",function(t,e){o._onUploadSuccess(t,e)}).on("uploadError",function(t,e){o._onUploadError(t,e)}).on("uploadComplete",function(t){o._onUploadComplete(t)}).on("all",function(t){"startUpload"===t?o.state="uploading":"stopUpload"===t?o.state="paused":"uploadFinished"===t&&(o.state="done"),o.auto||"uploading"!==o.state?o._uploadBtn.setText(o.startText):o._uploadBtn.setText(o.pauseText)}).on("error",function(t){switch(t){case"Q_EXCEED_NUM_LIMIT":o._errorContent=String.format(o.numLimitErrorText,o.fileNumLimit);break;case"Q_EXCEED_SIZE_LIMIT":o._errorContent=String.format(o.sizeLimitErrorText,o.fileSizeLimit);break;case"Q_TYPE_DENIED":o._errorContent=String.format(o.typeDeniedErrorText,o.limitType);break;case"F_EXCEED_SIZE":o._errorContent=String.format(o.sizeErrorText,o.fileSingleSizeLimit);break;case"Q_EMPTY_FILE":o._errorContent=o.emptyFileErrorText;break;case"F_DUPLICATE":o._errorContent=o.duplicateErrorText}}).on("ready",function(){o.enabled||o._uploader.disable(),o.fire("init",{sender:o,type:"init"})}),this.auto?this._uploadBtn.hide():this._uploadBtn.on("click",function(){"uploading"===o.state?o._uploader.stop(!0):o._uploader.upload()}),this._buttons.style.visibility="visible",this._isInit=!0},getFileList:function(){return this._fileList},getUploader:function(){return this._uploader},getUploaderPromise:function(i){var n=this,s=jQuery.Deferred(),o=0;return function t(){if(50<o++)return s.reject(new Error(""));var e=n._uploader;e?setTimeout(function(){s.resolve(e),"function"==typeof i&&i(e)}):setTimeout(t,20)}(),s.promise()},retry:function(t){this._uploader.retry(t)},removeFile:function(t){this._uploader.removeFile(t,!0)},clearFile:function(){for(var t=this._uploader.getFiles(),e=t.length-1;0<=e;e--)this.removeFile(t[e])},refresh:function(){this._uploader.refresh()},_beforeFileQueued:function(t){if(this._events.beforefilequeued){var e={source:this,sender:this,type:"beforefilequeued",file:t,cancel:!1};return this.fire("beforefilequeued",e),!e.cancel}},_onFilesQueued:function(t){this._errorContent&&mini.alert(this._errorContent),this._errorContent="",this.fire("filesqueued",{files:t})},_onFileDequeued:function(t){this.fire("filedequeued",{file:t})},_onReset:function(){this.fire("reset")},_onStartUpload:function(){this.fire("startupload")},_onStopUpload:function(){this.fire("stopupload")},_onUploadFinished:function(){this.fire("uploadfinished")},_onUploadStart:function(t){this.fire("uploadstart",{file:t})},_onUploadBeforeSend:function(t,e,i){!this.chunked&&this.needMD5&&(e.fileMD5=this._fileMD5[e.id],delete this._fileMD5[e.id]),this.fire("uploadbeforesend",{object:t,data:e,headers:i})},_onUploadAccept:function(t,e){if(this._events.uploadaccept){var i={source:this,sender:this,type:"uploadaccept",object:t,ret:e,cancel:!1};return this.fire("uploadaccept",i),!i.cancel}},_onUploadProgress:function(t,e){this.fire("uploadprogress",{file:t,percentage:e})},_onUploadSuccess:function(t,e){this.fire("uploadsuccess",{file:t,ret:e})},_onUploadError:function(t,e){this.fire("uploaderror",{file:t,reason:e})},_onUploadComplete:function(t){this.fire("uploadcomplete",{file:t})},_onBeforeMd5File:function(t){this.fire("beforemd5file",t)},_onBeforeMd5FileFinished:function(t){this.fire("beforemd5filefinished",t)},_existFileParts:"",_onMd5File:function(t,e){t.fileFinished?(this._uploader.skipFile(e),this._hasFinishedList[e.id]=!0):(this._existFileParts=t.existFileParts||"",this._existFileParts=","+this._existFileParts+",")},_onMd5FileFinished:function(t,e){},setUploadUrl:function(t){this.uploadUrl=t,this._uploader&&this._uploader.option("server",t)},getUploadUrl:function(){return this.uploadUrl},setAuto:function(t){this.auto=t,this._uploader&&this._uploader.option("auto",t)},getAuto:function(){return this.auto},defaultCompres:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0,noCompressIfLarger:!1,compressSize:0},setCompress:function(t){this.compress=!!t&&this.defaultCompres,this._uploader&&this._uploader.option("compress",this.compress)},getCompress:function(){return!!this.compress},setFileNumLimit:function(t){this.fileNumLimit=t,this._uploader&&this._uploader.option("fileNumLimit",t)},getFileNumLimit:function(){return this.fileNumLimit},setFileSizeLimit:function(t){this.fileSizeLimit=t,this._uploader&&this._uploader.option("fileSizeLimit",1024*t)},getFileSizeLimit:function(){return this.fileSizeLimit},setFileSingleSizeLimit:function(t){this.fileSingleSizeLimit=t,this._uploader&&this._uploader.option("fileSingleSizeLimit",1024*t)},getFileSingleSizeLimit:function(){return this.fileSingleSizeLimit},getLimitType:function(){return this.limitType},setLimitType:function(t){this.limitType!=t&&(this.limitType=t,this._uploader&&(this._uploader.options.accept||(this._uploader.options.accept=[{}]),this._uploader.options.accept[0].extensions=this.limitType,this._uploader._init({accept:this._uploader.options.accept})))},getMimeTypes:function(){return this.mimeTypes},setMimeTypes:function(t){if(this.mimeTypes!=t&&(this.mimeTypes=t,this._uploader&&(this._uploader.options.accept||(this._uploader.options.accept=[{}]),this._uploader.options.accept[0].mimeTypes=this.mimeTypes,"flash"!=this._uploader.predictRuntimeType()))){var n=this._uploader;!function t(e){var i=jQuery(n.options.pick.id).find('input[type="file"]');i.length?i.attr("accept",e):setTimeout(function(){t(e)},100)}(this.mimeTypes)}},setVisible:function(t){this.visible=t,this.el&&(t?(mini.removeClass(this.el,"invisible"),mini.removeClass(this._buttons,"webuploader-element-invisible")):(mini.addClass(this.el,"invisible"),mini.addClass(this._buttons,"webuploader-element-invisible")))},setEnabled:function(t){this.enabled=t,this.enabled?(this.removeCls(this._disabledCls),this._uploader&&this._uploader.enable()):(this.addCls(this._disabledCls),this._uploader&&this._uploader.disable()),this._doReadOnly()},getDuplicate:function(){return this.duplicate},setPickerText:function(t){this.pickerText=t;var e=this._picker.children[0];e?e.innerHTML=t:this._picker.innerHTML=t},getPickerText:function(){return this.pickerText},getAttrs:function(t){var e=mini.WebUploader.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["uploadUrl","limitType","mimeTypes","onbeforefilequeued","onfilesqueued","onfiledequeued","onreset","onstartupload","onstopupload","onuploadfinished","onuploadstart","onuploadbeforesend","onuploadaccept","onuploadprogress","onuploadsuccess","onuploaderror","onuploadcomplete","pickerText","onbeforemd5file","onbeforemd5filefinished","oninit"]),mini._ParseBool(t,e,["auto","chunked","compress","needMD5","duplicate"]),mini._ParseInt(t,e,["fileNumLimit","fileSizeLimit","fileSingleSizeLimit","chunkSize","chunkRetry","timeout"]),e}}),mini.regClass(mini.WebUploader,"webuploader");