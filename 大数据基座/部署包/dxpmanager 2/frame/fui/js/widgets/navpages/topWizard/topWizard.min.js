(function(y,c){var u=c("#wizard-bar"),m=c("#wizard-nav"),k,n=c(".next",m),p=c(".prev",m),q=c(".finish",m),v=c("#wizard-iframe"),z=Mustache,A=c.trim(c("#flow-item-templ").html()),r=c(".wizard-list",u),l=function(a){for(var b in a)"status"==b?"disabled"==a.status&&(this._disabled=1):this["_"+b]=a[b]};l._readyOnlyProps=["code","name","title"];c.extend(l.prototype,{next:function(){return this.isLast()?null:g[this._index+1]},prev:function(){return this.isFirst()?null:g[this._index-1]},getIndex:function(){return this._index},isFirst:function(){return 0==this._index},isLast:function(){return this._index==l._length-1},disable:function(){this._disabled=1;$flow=k.eq(this._index);$flow.removeClass("default done active error").addClass("disabled");Util.redrawPseudoEl($flow[0])},enable:function(){this._disabled=0;$flow=k.eq(this._index);$flow.removeClass("disabled active default error").addClass("done");Util.redrawPseudoEl($flow[0])},isDisabled:function(){return!!this._disabled},getData:function(){return c.extend({},t[this._index])},setUrl:function(a){this._setData("url",a)},_setData:function(a,b){-1==c.inArray(a,l._readyOnlyProps)&&(this["_"+a]=b,t[this._index][a]=b)},_active:function(){var a=this._index,b=k.eq(a),c=b.removeClass("default done disabled error").addClass("active").siblings(".active").removeClass("active");v[0].src=Util.getRightUrl(this._url);e=a;Util.redrawPseudoEl(b[0]);Util.redrawPseudoEl(c[0])},_error:function(){var a=k.eq(this._index);a.removeClass("default active disabled done").addClass("error");Util.redrawPseudoEl(a[0])},_done:function(){var a=k.eq(this._index);a.removeClass("default active disabled error").addClass("done");Util.redrawPseudoEl(a[0])}});var g=[],t=[],e=null,B=function(a){var b=[];l._length=a.length;c.each(a,function(h,d){var f=c.extend({},d);f.index=h;f.title||(f.title=d.name);h==a.length-1&&(f.isLast=!0);null==e&&"active"==d.status&&(e=h);b.push(z.render(A,f));d.index=h;g.push(new l(d))});r.html(Util.clearHtml(b.join("")))},C=function(a){t=a;B(a);k=r.find(".wizard-item");WizardNav.onInit&&c.proxy(WizardNav.onInit,y,g[e])();v[0].src=Util.getRightUrl(a[e].url);w(e)},x=function(){p.removeClass("disabled");n.removeClass("disabled");n.removeClass("hidden");q.addClass("hidden")},w=function(a){a=g[a];x();(a.isFirst()||a.prev()._disabled)&&p.addClass("disabled");a.isLast()&&(n.addClass("hidden"),q.removeClass("hidden"))};m.on("click",".wizard-step",function(a){a.preventDefault();var b=c(this);a=b.hasClass("next")?1:0;if(!b.hasClass("disabled")){var h=1,d=g[e],f=WizardNav.onStepChange;b.hasClass("finish")?f&&c.proxy(f,this,"over",d)():(f&&(h=c.proxy(f,this,a?"next":"prev",d)()),!1===h?d._error():(b=g[a?e+1:e-1],x(),(b.isFirst()||d._disabled&&a||b.prev()._disabled&&!a)&&p.addClass("disabled"),b.isLast()&&(n.addClass("hidden"),q.removeClass("hidden")),d._disabled||d._done(),b._active()))}});r.on("click",".done",function(a){a.preventDefault();var b=c(this);a=Util.toInt(b.data("index"));b.hasClass("disabled")||(b=g[a],g[e]._done(),b._active(),w(a),WizardNav.onFlowClick&&c.proxy(WizardNav.onFlowClick,this,b)())});(function(){var a=c.extend({query:"init-wizard"},WizardNav.params);Util.ajax({type:"POST",dataType:"json",url:Util.getRightUrl(WizardNav.loadUrl),data:a,success:function(a){a&&a.length&&C(a);Util.loadJs("frame/fui/js/widgets/jquery.nicescroll.min.js",function(){u.niceScroll({cursorcolor:"#666"})})},error:Util._ajaxErr})})()})(this,jQuery);