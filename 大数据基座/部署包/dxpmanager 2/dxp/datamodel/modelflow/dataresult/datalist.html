<!DOCTYPE html>
<html>
<head>
<title>查看数据</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script src="../../../../fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>
	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-dataexport" style="left: 2px" id="dataexport"
				gridId="datagrid" fileName="导出结果" action="getExportModel"
				position="left" collapseText="导出excel"
				onbeforeexport="beforeexportfc" exportAction="datalistaction.export"
				extraId="fui-form"></a>
		</div>
	</div>

	<!-- 条件区域 -->
	<div class="fui-condition">
		<div class="fui-form" id="fui-form">
			<div role="form">
				<div role="row">
					<div role="control" label="历史批次">
						<input class="mini-combobox" bind="historytime" id="historytime"
							style="width: 350px" action="getHistoryDate" showNullItem="true"
							nullItemText="请选择..." emptyText="请选择..." />
					</div>

					<div role="control" label="字段查询">
						<input class="mini-combobox" style="width: 150px"
							bind="queryfield1" id="queryfield1" action="getQueryFields"
							showNullItem="true" nullItemText="请选择..." emptyText="请选择..." />
						<input class="mini-textbox" style="width: 200px;"
							bind="fieldValue1" id="fieldValue1" />
					</div>

				</div>

				<div role="row">
					<div role="control" label="字段查询">
						<input class="mini-combobox" style="width: 150px"
							bind="queryfield2" id="queryfield2" action="getQueryFields"
							showNullItem="true" nullItemText="请选择..." emptyText="请选择..." />
						<input class="mini-textbox" style="width: 200px;"
							bind="fieldValue2" id="fieldValue2" />
					</div>

					<div role="control" label="字段查询">
						<input class="mini-combobox" style="width: 150px"
							bind="queryfield3" id="queryfield3" action="getQueryFields"
							showNullItem="true" nullItemText="请选择..." emptyText="请选择..." />
						<input class="mini-textbox" style="width: 200px;"
							bind="fieldValue3" id="fieldValue3" />
					</div>

				</div>
			</div>
			<input class="mini-hidden" bind="uuid" id="uuid" />
		</div>
		<!-- 搜索按钮 -->
		<a role="searcher" callback="searchData"></a>
	</div>

	<div class="fui-content">
		<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="rowguid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			emptyText="数据未生成,请耐心等待!" action="getGridModelData" showPager="true">
			<div property="columns"></div>
		</div>
	</div>
	<script src="../../../../fui/js/jsboot.js"></script>
	<script src="../../../../fui/js/IndexWebsocket.js"></script>
	<script src="../../../../fui/js/atmosphere.js"></script>
	<script>
		//<![CDATA[  
		//初始化页面
		var IndexWebSocket;
		var uuid;
		var grid = mini.get("datagrid");
		epoint.initPage("datalistaction", null, callbackinit);

		// 初始化回掉，动态生成列
		function callbackinit(data) {
			if (data.msg) {
				epoint.alertAndClose(data.msg);
			} else if (data) {
				uuid = getUUID();//此次的标识
				mini.get("uuid").setValue(uuid);
				IndexWebSocket = new IndexWebSocket(uuid, "",
						"../../../../../websocket/demo");
				//mini.get("adjustContentHeight").select(0);
				adjustContentHeight();//隐藏的condition出来 要重新计算一次高度
				drawDynamicColumn(data);
			}
		}

		// 绘制动态列
		function drawDynamicColumn(data) {
			var tmp = data.columns;
			var columns = eval('(' + tmp + ')');
			grid.set(columns);
		}

		// formThe search of
		function searchData() {
			if (epoint.validate()) {
				epoint.refresh([ 'datagrid', 'fui-form' ], function(ret) {

				}, true);
			}
		}

		function beforeexportfc() {
			epoint.showLoading();
		}

		function getUUID() {
			return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,
					function(c) {
						var r = Math.random() * 16 | 0, v = c == 'x' ? r
								: (r & 0x3 | 0x8);
						return v.toString(16);
					});
		}

		function hideloding(obj) {
			epoint.hideLoading();
			if (obj.msg) {
				epoint.alert(obj.msg, null, null, 'info');
			}
		}

		//_$t
	</script>
</body>
</html>