<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>新增组件</title>
    <!-- 请修改相对路径 -->
    <script src="../../../frame/fui/js/cssboot.js"></script>
    <style type="text/css">
.id_connection_row .form-control {
	width: 70%;
}






    </style>
</head>

<body>
<!-- 必须有，加载时的loading效果 -->
<div class="page-loading"></div>
<!-- toolbar区域 -->
<div class="fui-toolbar">
    <div class="btn-group mr10">
        <a class="mini-button" id="save" onclick="saveModify">保存并关闭</a> <a
            class="mini-button" onclick="epoint.closeDialog(0)">取消修改</a>
    </div>
</div>

<!-- 内容区域 -->
<div id="fui-form" class="fui-form">
    <div role="form">
        <div role="row">
            <div role="control" label="组件名称" starred="true" starred="true">
                <input id="pluginname" class="mini-textbox"
                       bind="assembly.name" required="true"
                       requiredErrorText="组件名称不能为空!"/>
            </div>
        </div>
        <div role="row">
            <div role="control" label="排序">
                <input id="ordernum" class="mini-textbox" bind="assembly.ordernum"/>
            </div>
        </div>
        <div role="row">
            <div role="control" label="参数模板" starred="true">
                <input class="mini-textArea" height="100px" id="jsontemplate"
                       bind="assembly.jsontemplate" required="true"
                       requiredErrorText="参数模板不能为空"/>
            </div>
        </div>
        <input class="mini-hidden" height="50px" id="parameter" name="parameter"
               bind="parameter"/>
    </div>
</div>
<div class="fui-toolbar" id="btns" style="padding-top: 1px">
    <div class="btn-group mr10">
        <a class="mini-button mini-btn-primary"
           onclick="getParamsAuto"
           style="margin-left: 20px">获取参数</a>
        <a class="mini-button mini-btn-primary"
           onclick="addParams"
           style="margin-left: 20px">添加参数</a>
        <a id="deleteParams"
           class="mini-button mini-btn-danger"
           onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择要删除的记录!', '', null, 'warning');} else {epoint.confirm('确认删除?','',deleteSelected);}">删除</a>
    </div>
</div>
<!-- 内容区域 -->
<div class="mini-fit" style="padding-top: 1px">
    <div id="datagrid" name="datagrid" class="mini-datagrid"
         idField="id" multiSelect="true" allowCellValid="true"
         allowCellEdit="true" style="width: 100%; height: 100%"
         allowResize="true" showPager="false" allowCellSelect="true"
         editNextOnEnterKey="true" action="getDataGridData"
         >
        <div property="columns">
            <div type="checkcolumn" width="45"></div>
            <div type="indexcolumn" width="55" headerAlign="center">序</div>
            <div field="name" headerAlign="center" align="center"
                 width="80" maxLength="8">
                参数字段<input property="editor" class="mini-textbox" showClose="true"
                           emptyText="请选择填写模板中占位符名称" data="sourceFieldList" style="width: 100%"/>
            </div>
            <div width="90" headerAlign="center" align="center" field="chinesename">
                中文注解<input property="editor" class="mini-textbox"
                           style="width: 100%;" inputStyle="text-align:left" required="true"/>
            </div>
            <div width="90" headerAlign="center" align="center" field="prompt">
                参数提示<input property="editor" class="mini-textbox"
                           style="width: 100%;" inputStyle="text-align:left" required="true"/>
            </div>
            <div width="90" headerAlign="center" align="center" field="ordernum">
                排序<input property="editor" class="mini-textbox"
                           style="width: 100%;" inputStyle="text-align:left" vtype="int" required="true"/>
            </div>
        </div>
    </div>
</div>
<!-- 请修改相对路径 -->
<script src="../../../frame/fui/js/jsboot.js"></script>
<script>
        var datagrid=mini.get('datagrid');
		// 初始化页面
		epoint.initPage('dxpmodelspecialsubassemblyaddaction');

		function saveModify() {
			if (epoint.validate()) {
			    setGridData();
				epoint.execute('save', 'fui-form', closeCallback);
			}
		}

		// 关闭操作的回调
		function closeCallback(data) {
			if (data.msg.indexOf('成功') != -1) {
				epoint.alertAndClose(data.msg, '', '', 'success');
			} else {
				epoint.alert(data.msg);
			}
		}

        function setGridData() {
			var datas = datagrid.getData();
			var paramters = [];
			for (var i = 0; i < datas.length; i++) {
				paramters.push({
					"name" : datas[i].name,
					"chinesename" : datas[i].chinesename,
					"prompt" : datas[i].prompt,
					"ordernum" : datas[i].ordernum,
				});
			}
			mini.get('parameter').setValue(JSON.stringify(paramters));
		}

        function getParamsAuto(){
            if(epoint.validate()){
                var jsontemplate=mini.get('jsontemplate').getValue();
                epoint.execute('getParamsAuto','',jsontemplate,function(data){
                    if(data.length==0){
                         mini.showTips({
 							content : "获取参数失败：未找到占位符",
 							state : "danger",
 							x : "center",
 							y : "center",
 							timeout : 3000
 						});
                    }else{
                       datagrid.setData(data);
                    }

                });
            }
        }

        //新增参数
		function addParams() {
			var newRow = {};
			datagrid.addRow(newRow, 'last');

		}

		//删除选中
		function deleteSelected() {
			datagrid.removeRows(datagrid.getSelecteds(), false);
			setGridData();
		}


</script>
</body>
</html>