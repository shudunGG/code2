<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
<title></title>
<script src="../../frame/fui/js/cssboot.js"></script>
<script>
	SrcBoot.output([ "../css/common.css", "./css/mission.css" ]);
</script>
</head>
<body>
	<div class="fui-condition">
		<div class="mission-line"></div>
	</div>
	<div class="fui-content" style="overflow:hidden;">
		<div class="fui-content">
			<div id="datagrid" name="datagrid" class="mini-datagrid"
				idField="rowguid" multiSelect="true" allowResize="true"
				showPager="true" action="getDataGridData" style="height:95%">
				<div property="columns">
					<div field="batchnum" headerAlign="center" width="100">批次号</div>
					<div field="starttime" headerAlign="center" align="center"
						width="100" data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}">开始时间</div>
					<div field="endtime" headerAlign="center" align="center"
						width="100" data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}">结束时间</div>
					<div field="totalseconds" headerAlign="center" align="center"
						width="60">耗时(s)</div>
					<div header="成功数" headerAlign="center">
						<div property="columns">
							<div field="successinsert" headerAlign="center" width="50"
								align="center">插入</div>
							<div field="successupdate" headerAlign="center" width="50"
								align="center">更新</div>
							<div field="successdelete" headerAlign="center" width="50"
								align="center">删除</div>
						</div>
					</div>
					<div header="失败数" headerAlign="center">
						<div property="columns">
							<div field="errorinsert" headerAlign="center" width="50"
								align="center">插入</div>
							<div field="errorupdate" headerAlign="center" width="50"
								align="center">更新</div>
							<div field="errordelete" headerAlign="center" width="50"
								align="center">删除</div>
						</div>
					</div>
					<div field="logid" width="60" headerAlign="center" align="center"
						renderer="onDownLoadRenderer">日志下载</div>
					<div width="50" headerAlign="center" align="center" visible="false"
						renderer="onOptRenderer">操作</div>
					<div field="flowguid" width="80" visible="false"></div>
				</div>
			</div>
			<form id="download_form" method="post" enctype="multipart/form-data"></form>
		</div>
	</div>
	<script src="../../frame/fui/js/jsboot.js"></script>
	<script>
		SrcBoot.output([ "../js/echarts.min.js",
				"../../../fui/js/libs/mustache.min.js", "../js/common.js" ]);
	</script>
	<script>
		epoint.initPage('dxptranscountmissiondetail', '', function(data) {
			initLine(data.list);
		});

		function onDetailRenderer(e) {
			return '查看';
		}
		
		function onDownLoadRenderer(e) {
			return epoint.renderCell(e, "action-icon icon-download",
					"download", 'logid,flowguid');
		}

		function download(e) {
			
			var form = document.getElementById('download_form');
			form.action = "dxpschedulerloglistaction.action?cmd=downloadLog&rowGuid="
					+ e.logid+"&guid="+e.flowguid;
			form.submit();
		}

		function onOptRenderer(e) {

		}

		var lineTrend = echarts.init($(".mission-line")[0]);
		function initLine(data) {
			lineTrend.setOption({
				legend : {
					show : true,
					left : 'right',
					top : 'top',
					textStyle : {
						color : "#999",
						fontSize : 12
					}
				},
				tooltip : {
					trigger : 'axis',
					axisPointer : {
						type : 'cross',
						label : {
							backgroundColor : '#6a7985',
						},
					},
					formatter : function(e) {
						return '耗时趋势' + '<br/>' + '耗时：' + e[0].value + '秒';
					}
				},
				grid : {
					left : '5%',
					right : '5%',
					top : '15%',
					bottom : '8%',
					containLabel : true
				},
				xAxis : [ {
					type : 'category',
					boundaryGap : false,
					data : Util.getArrayData(data, 'name'),
					axisLabel : {
						show : true,
						textStyle : {
							color : '#abadab',
							fontSize : 12,
						}
					},
					axisLine : {
						show : false
					},
					axisTick : {
						show : false
					}
				} ],
				yAxis : [ {
					name : '任务执行耗时趋势（秒）',
					nameTextStyle : {
						fontSize : 12,
						color : "#858585"
					},
					type : 'value',
					axisLabel : {
						show : true,
						textStyle : {
							color : '#abadab',
							fontSize : 12,
						}
					},
					splitLine : {
						show : true,
						lineStyle : {
							type : 'dashed',
							color : '#eee'
						}
					},
					axisLine : {
						show : false
					},
					axisTick : {
						show : false
					}
				} ],
				series : [ {
					type : 'line',
					smooth : true,
					symbol : "none",
					itemStyle : {
						color : "#50b956",
						borderColor : "#50b956",
						borderWidth : 2
					},
					areaStyle : {
						normal : {
							color : new echarts.graphic.LinearGradient(0, 0, 0,
									1, [ {
										offset : 0,
										color : 'rgba(80, 185, 86, .3)'
									}, {
										offset : 1,
										color : 'rgba(80, 185, 86, 0)'
									} ], false),
						}
					},
					data : Util.getArrayData(data, 'seconds')
				} ]
			});
		}
	</script>
</body>
</html>