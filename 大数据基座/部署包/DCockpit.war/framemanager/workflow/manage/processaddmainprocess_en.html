<!DOCTYPE html>
<html>

<head>
<title>Select the affiliated</title>
<meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>

	<!-- toolbar area -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addbtn" onclick="addNew()">add the affiliated</a> <a
				class="mini-button" id="addclosebtn" onclick="addClose()">and close the call</a><a
				class="mini-button" id="cancelbtn" onclick="epoint.closeDialog()">cancel the add</a>
		</div>
	</div>

	<div class="fui-content" id="fui-content">
		<div class="fui-form" id="fui-form">
			<div role="form">
				<!-- 2column -->
				<div role="row">
					<div role="control" label="affiliatedmainprocess" starred="true">
						<input class="mini-buttonedit" allowInput="false"
							id="mainProcessName" required="true" emptyText="Affiliated main process can not be empty"
							style="width: 100%;" onbuttonclick="selMainProcess" onvaluechanged="subProcessActivityChange"/>
					</div>
				</div>
				<div role="row">
					<div role="control" label="childprocessactivities" starred="true">
						<input id="subProcessActivity" bind="selectSubProcessActivity"
							emptyText="The child process activitiesCan't be empty" textField="text" valueField="id" class="mini-combobox" style="width: 100%" />
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<input id="hidProcessVersionGuid" bind="hidProcessVersionGuid" class="mini-hidden"></input>

	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../rest/resource/jsboot"></script>
	
	<script>
		//<![CDATA[ 
		epoint.initPage("processaddmainprocessaction");

		function selMainProcess() {
			epoint.openDialog('Select the affiliatedprocess', "framemanager/workflow/manage/selectprocess",
					selMainProcessOperJS, {
						'width' : 300,
						'height' : 500
					});
		}

		function selMainProcessOperJS(rtnValue) {
			if (rtnValue && rtnValue != "close") {
				var s = rtnValue.split(";");
				mini.get('mainProcessName').setText(s[0]);
				mini.get('mainProcessName').setValue(s[0]);
				mini.get('hidProcessVersionGuid').setValue(s[1]);
				subProcessActivityChange();
			}
		}

		function addNew() {
			epoint.execute('addNew', 'fui-form', function(data) {
				if (data && data.message) {
					if (data.message.indexOf("Alert|") != -1) {
						var s = data.message.split("|");
						epoint.alert(s[1], '', null, 'info');
					} else {
						window.returnValue = data.message;
					}
				}
			});
		}

		function addClose() {
			epoint.execute('addClose', 'fui-form', function(data) {
				if (data) {
					if (data.indexOf("Alert|") != -1) {
						var s = data.split("|");
						epoint.alert(s[1], '', null, 'info');
					} else {
						window.returnValue = data;
						epoint.closeDialog();
					}
				}
			});
		}
		
		function subProcessActivityChange(){
        	var hidPVGuid=mini.get("hidProcessVersionGuid").getValue(); 
        	if(hidPVGuid){
        		epoint.execute("subProcessActivityChange","fui-form",[hidPVGuid],mcallback);
        	}
        }
		
		function mcallback(data) {
            if (data) {
            	mini.get("subProcessActivity").setData(data);
            	mini.get("subProcessActivity").select(0);
            }
       }
		//]]>
	</script>
</body>
</html>
