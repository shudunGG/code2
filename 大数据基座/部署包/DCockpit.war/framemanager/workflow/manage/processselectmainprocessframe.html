<!DOCTYPE html>
<html>
<head>
<title>选择挂靠</title>
<meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<link rel="stylesheet"
	href="../css/workflowicons.css?releaseNo=#{version.version}" />
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" iconCls="icon-addcircle" id="addbtn"
				onclick="openAddPage()">新增挂靠</a> <a class="mini-button"
				iconCls="icon-removecircle" id="btnok" onclick="btnOK()">确认选择</a> <a
				class="mini-button mini-btn-danger" iconCls="icon-removecircle" id="cancelbtn"
				onclick="btnDelSelect()">删除选中</a>
		</div>
	</div>

	<input id="hidMainPVActivityGuid" bind="hidMainPVActivityGuid"
		class="mini-hidden"></input>

	<ul id="tree" class="mini-tree" style="height: 100%"
		action="getTreeModel" showRadioButton="true" showTreeIcon="true"></ul>

	<script src="../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[ 
		epoint.initPage("processselectmainprocessframeaction");

		var processVersionGuid = Util.getUrlParams('processVersionGuid');

		//树js对象
		var tree = mini.get("tree");
		// 点击左侧树刷新右侧表格
		tree.on("nodeselect", function(e) {
			var id = e.node.id;
			// 将左侧树点击的节点id放到隐藏域中
			// 在表格发二次请求时，会自动带上条件区域中的内容
			mini.get('hidMainPVActivityGuid').setValue(id);
		});

		function openAddPage() {
			epoint.openDialog('选择挂靠流程',
					"framemanager/workflow/manage/processaddmainprocess?processVersionGuid="
							+ processVersionGuid, searchData, {
						'width' : 900
					});
		}

		function searchData() {
			epoint.refresh('tree','',true);
		}

		function btnOK() {
			epoint.execute('btnOK', '', addCallBack);
		}

		function btnDelSelect() {
			epoint.execute('btnDelSelect', '', callBack);
		}
		
		function addCallBack(data){
			var options = {
					backParam: mini.get('hidMainPVActivityGuid').getValue(),
				};
			if(data && data.msg){
				epoint.alert(data.msg, '', null, 'info');
			}else{
				epoint.alertAndClose("挂靠成功",'','',options, 'success');
			}
		}
		
		function callBack(data){
			if(data && data.msg){
				epoint.alert(data.msg, '', null, 'warning');
			}else{
				epoint.alertAndClose("删除成功", '', null, null, 'success');
			}
		}

		//]]>
	</script>
</body>
</html>