<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>The relevant data</title>
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>
<body>

	<!-- This must have,it is loaded with some loading effect -->
	<div class="page-loading"></div>

	<!-- toolbar area -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="add" onclick="addContext">new data</a> <a
				class="mini-button" id="delete" onclick="deleteSelect">delete data</a>
		</div>
	</div>

	<!-- content area -->
	<div id="fui-content" class="fui-content">
		<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="fieldGuid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			showPager="true" action="getDefaultModel" allowCellEdit="true"
			allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true">
			<div property="columns">
				<div type="checkcolumn" width="80"></div>
				<div type="indexcolumn" width="80" headerAlign="center">
					order
				</div>
				<div field="fieldName" headerAlign="center" width="100%">relevant data name</div>
				<div field="dataType" headerAlign="center" align="center"
					width="150">data type</div>
				<div field="valueSourceName" headerAlign="center" align="center"
					width="150">data source</div>
				<div field="contextValue" headerAlign="center" width="100">data values</div>
				<div width="150" align="center" headerAlign="center"
					renderer="onEditRenderer">edit</div>
			</div>
		</div>
	</div>

	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[ 
        // Initialize the page
        epoint.initPage ('contextfieldlistaction', null, initCallBack);
        
        var processVersionGuid;
        var mainPVActivityGuid;
        
        //Initializes the callback event
        function initCallBack (data)
        {
	        processVersionGuid = data.processVersionGuid;
	        mainPVActivityGuid = data.mainPVActivityGuid;
        }

        //newThe relevant data
        function addContext ()
        {
	        epoint.openDialog ("new relevant data", "framemanager/workflow/design/contextfield?processVersionGuid="
	                + processVersionGuid + "&mainPVActivityGuid=" + mainPVActivityGuid, function (data)
	        {
	        	if(data){
	        		refreshTable ();
	        	}
	        },
	        {
	            width : 1000,
	            height : 450
	        });
        }

        //Apply colours to a drawingeditbutton
        function onEditRenderer (e)
        {
	        return epoint.renderCell (e, "action-icon icon-edit", "editContext", "fieldGuid");
        }

        //editThe relevant data
        function editContext (fieldGuid)
        {
	        epoint.openDialog ("edit relevant data", "framemanager/workflow/design/contextfield?fieldGuid=" + fieldGuid
	                + "&mainPVActivityGuid=" + mainPVActivityGuid, function (data)
	        {
	        	if(data){
	        		refreshTable ();
	        	}
	        },
	        {
	            width : 1000,
	            height : 450
	        });
        }

        //Delete the selected row
        function deleteSelect ()
        {
	        var datagrid = mini.get ('datagrid');
	        var ids = datagrid.getSelectedIds ();
	        if (ids.length > 0)
	        {
		        epoint.confirm ("Sure to delete the selected record?", "", function (action)
		        {
			        epoint.execute ("deleteContext", "", function (data)
			        {
				        if (data.message)
				        {
					        epoint.alert (data.message, '', null, 'info');
					        refreshTable ();
				        }
			        });
		        });
	        }
	        else
	        {
		        epoint.alert ("Please choose to delete records!", '', null, 'warning');
	        }
        }

        function refreshTable ()
        {
        	 epoint.refresh (['datagrid'],'',true);
        }

        //]]>
	</script>

</body>
</html>
