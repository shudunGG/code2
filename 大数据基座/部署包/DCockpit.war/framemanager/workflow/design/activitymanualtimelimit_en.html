<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Activity time limit set</title>
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- This must have,it is loaded with some loading effect -->
	<div class="page-loading"></div>
	<!-- toolbar area -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addNew" onclick="saveModify" iconCls="icon-save">Confirm to save</a>
		</div>
	</div>
	<!-- content area -->
	<div class="fui-content">
		<!-- The form area -->
		<div id="fui-form" class="fui-form">
			<div role="form">
				<!-- 2column -->
				<div role="row">
					<div role="control" label="To enable time limit control">
						<input id="chkTimeLimit" bind="chkTimeLimit" class="mini-checkbox"
							style="width: 20%" onvaluechanged="onValueChangedTimeLimit" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="Time limit">
						<input id="txtTimeLimit" bind="txtTimeLimit" class="mini-textbox"
							style="width: 20%" required="true" />
						<div id="timeLimitUnit" name="timeLimitUnit" showNullItem="false"
							bind="workflowActivity.timeLimitUnit"
							action="activitymanualtimelimitaction.getTiemUnitList"
							class="mini-combobox" textField="text" valueField="id"
							style="width: 30%" ></div>
					</div>
				</div>
				<div role="row">
					<div role="control" label="Timeout remind way">
						<input id="chkOverTimeRemindType" bind="overTimeRemindType"
							action="activitymanualtimelimitaction.getChkOverTimeRemindType"
							textField="text" valueField="id" class="mini-checkboxlist"
							style="width: 100%" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="Timeout to remindcontent">
						<input id="overTimeRemindContent"
							bind="workflowActivity.overTimeRemindContent"
							class="mini-textbox" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="The automatic processing of action after the timeout">
						<input id="rdoOverTimeTransaction"
							bind="overTimeTransaction"
							action="getRdoOverTimeTransactionList" textField="text"
							valueField="id" class="mini-radiobuttonlist" style="width: 100%" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="Notify the other staff overtime">
						<a id="btnSetOverTimePerson" class="mini-button"
							onclick="SetOverTimePerson" style="width: 20%">Set up personnel</a>
					</div>
				</div>
				<div role="row">
					<div role="control" label="Enable the warning">
						<input id="chkWarning" bind="chkWarning" class="mini-checkbox"
							style="width: 20%" onvaluechanged="onValueChangedWarning" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="Early warning time">
						<input id="txtWarningTime" bind="txtWarningTime"
							class="mini-textbox" style="width: 20%" required="true"
							requiredErrorText="@local.paramValEmptyErr" />
						<div id="earlyWarningTimeUnit" name="earlyWarningTimeUnit"
							showNullItem="false" bind="workflowActivity.earlyWarningTimeUnit"
							action="getEarlyWarningTimeUnitList" class="mini-combobox"
							textField="text" valueField="id" style="width: 30%" ></div>
					</div>
				</div>
				<div role="row">
					<div role="control" label="Warnings that way">
						<input id="chkEarlyWarningRemindType"
							bind="earlyWarningRemindType"
							action="getChkEarlyWarningRemindType" textField="text"
							valueField="id" class="mini-checkboxlist" style="width: 100%" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="The early warning alertcontent">
						<input id="earlyWarningRemindContent"
							bind="workflowActivity.earlyWarningRemindContent"
							class="mini-textbox" />
					</div>
				</div>
			</div>
		</div>
	</div>
	<input class="mini-hidden" id="activityGuid" bind="activityGuid" />
	
	<!-- jsboot.js will automatically put all the js required for the frame page to be loaded in. -->
	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../rest/resource/jsboot"></script>
	<script type="text/javascript">
		//<![CDATA[ 
		//Initialization request 
		epoint.initPage('activitymanualtimelimitaction', '', initCallBack);

		// Initialization callback
		function initCallBack(data) {
			var checkedTimeLimit = mini.get("chkTimeLimit").getChecked();
			if (checkedTimeLimit) {
				controlTimeLimit(true);
				mini.get("chkWarning").setEnabled(true);
			} else {
				controlTimeLimit(false);
				//Enable the warning
				mini.get("chkWarning").setValue(false);
				mini.get("chkWarning").setEnabled(false);
				controlWarning(false);
			}
			var checkedWarning = mini.get("chkWarning").getChecked();
			controlWarning(checkedWarning);

		}
		// The callback for the save operation
		function callback(data) {
			//The automatic processing of action after the timeout
			var isMessageWaring = mini.get("rdoOverTimeTransaction").value;
			var checkedTimeLimit = mini.get("chkTimeLimit").getChecked();
			if (data.msg) {
				epoint.alert(data.msg, '', function() {
					if (isMessageWaring != '0' && checkedTimeLimit == true) {
						epoint.alert('Tip: automatic processing requires the default processing', 'prompt', '', 'warning');
					}
				}, 'info');
			}
		}
		// The save operation
		function saveModify() {
			if (epoint.validate()) {
				epoint.execute('activitymanualtimelimitaction.saveConfig',
						'fui-form', callback);
			}
		}
		//Set up personnel
		function SetOverTimePerson() {
			var activityGuid = mini.get("activityGuid").getValue();
			var url = "framemanager/workflow/design/activitymanualtimelimitovertimepersonlist?activityGuid="
					+ activityGuid;
			epoint.openDialog("Set up personnel", url, "", {
				width : 800,
				height : 500
			});
		}

		//Time limitCheck box event
		function onValueChangedTimeLimit() {
			var checked = this.getChecked();
			//alert(checked);
			if (checked) {
				controlTimeLimit(true);
				mini.get("chkWarning").setEnabled(true);
			} else {
				controlTimeLimit(false);
				//Enable the warning
				mini.get("chkWarning").setValue(false);
				mini.get("chkWarning").setEnabled(false);
				controlWarning(false);
			}

		}
		//Early warningCheck box event
		function onValueChangedWarning() {
			var checked = this.getChecked();
			controlWarning(checked);
		}
		function controlTimeLimit(value) {
			//Time limit of time
			mini.get("txtTimeLimit").setEnabled(value);
			mini.get("timeLimitUnit").setEnabled(value);
			//Timeout remind way
			mini.get("chkOverTimeRemindType").setEnabled(value);
			//Timeout to remindcontent
			mini.get("overTimeRemindContent").setEnabled(value);
			//The automatic processing of action after the timeout
			mini.get("rdoOverTimeTransaction").setEnabled(value);
			//Notify the other staff overtime
			mini.get("btnSetOverTimePerson").setEnabled(value);
		}
		function controlWarning(value) {
			//Early warning time
			mini.get("txtWarningTime").setEnabled(value);
			mini.get("earlyWarningTimeUnit").setEnabled(value);
			//Warnings that way
			mini.get("chkEarlyWarningRemindType").setEnabled(value);
			//The early warning alertcontent
			mini.get("earlyWarningRemindContent").setEnabled(value);
		}
		//]]>
	</script>
</body>
</html>
