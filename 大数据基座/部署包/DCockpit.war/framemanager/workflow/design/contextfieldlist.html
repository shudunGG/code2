<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>相关数据</title>
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>
<body>

	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="add" onclick="addContext">新增数据</a> <a
				class="mini-button mini-btn-danger" id="delete" onclick="deleteSelect">删除数据</a>
		</div>
	</div>

	<!-- 内容区域 -->
	<div id="fui-content" class="fui-content">
		<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="fieldGuid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			showPager="true" action="getDefaultModel" allowCellEdit="true"
			allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true">
			<div property="columns">
				<div type="checkcolumn" width="50"></div>
				<div type="indexcolumn" width="50" headerAlign="center">
					序
				</div>
				<div field="fieldName" headerAlign="center" width="100%">相关数据名称</div>
				<div field="dataType" headerAlign="center" align="center"
					width="150">数据类型</div>
				<div field="valueSourceName" headerAlign="center" align="center"
					width="150">数据来源方式</div>
				<div field="contextValue" headerAlign="center" width="100">数据值</div>
				<div width="150" align="center" headerAlign="center"
					renderer="onEditRenderer">修改</div>
			</div>
		</div>
	</div>

	<script src="../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[ 
        // 初始化页面
        epoint.initPage ('contextfieldlistaction', null, initCallBack);
        
        var processVersionGuid;
        var mainPVActivityGuid;
        
        //初始化回调事件
        function initCallBack (data)
        {
	        processVersionGuid = data.processVersionGuid;
	        mainPVActivityGuid = data.mainPVActivityGuid;
        }

        //新增相关数据
        function addContext ()
        {
	        epoint.openDialog ("新增相关数据", "framemanager/workflow/design/contextfield?processVersionGuid="
	                + processVersionGuid + "&mainPVActivityGuid=" + mainPVActivityGuid, function (data)
	        {
	        	if(data){
	        		refreshTable ();
	        	}
	        },
	        {
	            width : 1000,
	            height : 450
	        });
        }

        //渲染修改按钮
        function onEditRenderer (e)
        {
	        return epoint.renderCell (e, "action-icon icon-edit", "editContext", "fieldGuid");
        }

        //修改相关数据
        function editContext (fieldGuid)
        {
	        epoint.openDialog ("修改相关数据", "framemanager/workflow/design/contextfield?fieldGuid=" + fieldGuid
	                + "&mainPVActivityGuid=" + mainPVActivityGuid, function (data)
	        {
	        	if(data){
	        		refreshTable ();
	        	}
	        },
	        {
	            width : 1000,
	            height : 450
	        });
        }

        //删除选中行
        function deleteSelect ()
        {
	        var datagrid = mini.get ('datagrid');
	        var ids = datagrid.getSelectedIds ();
	        if (ids.length > 0)
	        {
		        epoint.confirm ("确定删除选中记录？", "", function (action)
		        {
			        epoint.execute ("deleteContext", "", function (data)
			        {
				        if (data.message)
				        {
					        epoint.alert (data.message, '', null, 'info');
					        refreshTable ();
				        }
			        });
		        });
	        }
	        else
	        {
		        epoint.alert ("请选择要删除的记录!", '', null, 'warning');
	        }
        }

        function refreshTable ()
        {
	        epoint.refresh (['datagrid'],'',true);
        }

        //]]>
	</script>

</body>
</html>