<!DOCTYPE html>
<html>

	<head>
		<title>Management type</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<script src="../../../frame/fui/js/cssboot.js"></script>
	</head>

	<body>
		<div class="page-loading"></div>

		<div class="fui-left">
			<div role="head" title="choose type"></div>

			<div role="body">
				<ul id="tree" class="mini-tree" style="height: 100%" textField="text"
				idField="id" parentField="pid" action="getTreeData" resultAsTree="false"></ul>
			</div>
		</div>

		<div class="fui-right">
			<!-- toolbar area -->
			<div class="fui-toolbar">
				<div class="btn-group mr10">
					<a class="mini-button" iconCls="icon-addcircle" onclick="add()">new type</a>
					<a class="mini-button" iconCls="icon-save" onclick="save()">save the new type</a>
					<a class="mini-button" iconCls="icon-minuscircle"
					onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('Please select you want to delete type.', '', null, 'warning');} else {epoint.confirm('Sure to delete?','',deleteSelected);}">delete the type</a>
				</div>
			</div>

			<div class="fui-condition">
				<!-- The form layout -->
				<div class="fui-form" id="fui-form">
					<div role="form">
						<!-- 2column -->
						<div role="row">
							<div role="control" label="type name" starred="true">
								<input id="cName" bind="tableCategory.categoryName"
								class="mini-textbox" required="true"
								requiredErrorText="Name of the type Can't be empty" vtype="maxLength:50" />

							</div>
							<div role="control" label="order no" starred="false">
								<input id="oNum" bind="tableCategory.orderNum"
								class="mini-textbox" vtype="maxLength:5;int" />
							</div>
						</div>
						<!-- Add a hidden field to the tree and the linkage of the table -->
						<input bind="tableCategory.categoryNum"
						id="categoryNum" class="mini-hidden" />
					</div>
				</div>
			</div>
			<div class="fui-content">
				<div id="datagrid" class="mini-datagrid" sortOrder="desc"
				idField="categoryNum" multiSelect="true"
				style="width: 100%; height: 100%;" allowResize="true"
				allowCellValid="true" action="getDataGridData"
				showPager="true" allowCellEdit="true" allowCellSelect="true"
				editNextOnEnterKey="true" editNextRowCell="true">
					<div property="columns">
						<div type="checkcolumn" width="50"></div>
						<div type="indexcolumn" headerAlign="center" width="80">
							order
						</div>
						<div field="categoryName" width="100%" headerAlign="center"
						vtype="maxLength:50;required">
							type name
							<input property="editor" class="mini-textbox" minWidth="200" />
						</div>
						<div field="categoryNum" width="200" headerAlign="center">
							type number
						</div>
						<div field="orderNum" width="80" headerAlign="center" align="right"
						vtype="maxLength:5;int;required">
							order no
							<input property="editor" class="mini-textbox" minWidth="80"
							inputStyle="text-align:right" />
						</div>
					</div>
				</div>
			</div>
		</div>
 
     <input class="mini-hidden" id="appGuid" bind="appGuid"/>
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../rest/resource/jsboot"></script>

		<!-- Configuration Variables -->
		<script>
			//Initialize the page
			epoint.initPage("epointsformtablecategorylistaction");

			//The treejsobject
			var tree = mini.get("tree");
			// Click on the left side of theThe treeRefresh the form on the right side
			tree.on("nodeselect", function(e) {
				var id = e.node.id;
				// To the leftThe treeClick on the nodeidIn a hidden field
				// Send the second request, in the table will automatically bring conditions areaThe contents of the
				mini.get('categoryNum').setValue(id);
				//Refresh the table
				searchData_treeExp();
			});

			// new
			function add() {
				if (epoint.validate()) {
					epoint.execute('add', '' ,msgCallBack);
				}
			}

			// save
			function save() {
				var grid = mini.get("datagrid");
				if (grid.isValid() == false) {
					var error = grid.getCellErrors()[0];
					grid.beginEditCell(error.record, error.column);
					return;
				}
				epoint.execute('save', '', msgCallBack);
			}

			// delete
			function deleteSelected() {
				epoint.execute('deleteSelected', '', msgCallBack);
			}

			// Back off to remind
			function msgCallBack(data) {
				var msg = data.msg;
				if (msg) {
					if (data.success) {
						mini.get("cName").setValue("");
						mini.get("oNum").setValue("");
						epoint.alert(msg, '', function(){
							epoint.refresh(['datagrid', 'fui-form'],'',true);
						}, 'info');
					} else {
						epoint.alert(msg, '', '', 'warning');
					}
				}
			}

			// Form,The treeThe search of
			function searchData() {
				epoint.refresh(['datagrid', 'fui-form']);
			}

			// formThe search of
			function searchData_treeExp() {
				epoint.refresh(['datagrid', 'fui-form']);
			}
		</script>
	</body>
</html>
