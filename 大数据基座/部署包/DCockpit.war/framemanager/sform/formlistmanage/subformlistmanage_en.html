<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Child table list</title>
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- This must have,it is loaded with some loading effect -->
	<div class="page-loading"></div>

	<!-- toolbar area -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addSubForm" iconCls="icon-save" onclick="addSubFormClick();">The new child table</a> 
			<a class="mini-button" id="saveSubForm" iconCls="icon-addcircle"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('Please select you want to save record!', '', null, 'warning');} else {save();}">Save the child table</a>
			<a class="mini-button" id="delSubForm" iconCls="icon-removecircle" 
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('Please choose to delete the record!', '', null, 'warning');} else {del();}">Delete child table</a>
		</div>
	</div>

	<!-- div class="fui-condition"-->
		<!-- The form layout -->
		<!--div class="fui-form" id="fui-form"-->
			<!-- div role="form"-->
				<!-- 4column -->
				<!-- div role="row">
					<div role="control" label="Form name" starred="false">
						<input bind="searchString" class="mini-textbox" onkeypress="searchData();"/>
					</div>
					<div role="control" label="Form the name of the table" starred="false">
						<input bind="searchString1" class="mini-textbox" onkeypress="searchData();"/>
					</div>
				</div-->
			<!-- /div-->
		<!-- /div-->
		<!-- Search button -->
		<!-- a role="searcher" callback="searchData"></a>
	</div-->

	<div class="fui-content">
	    <div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="tableID" multiSelect="true" style="width: 100%; height: 100%;" 
			allowCellEdit="true" allowCellSelect="true" allowCellValid="true" action="getTableModal">
			<div property="columns">
				<div type="checkcolumn" width="20"></div>
				<div type="indexcolumn" headerAlign="center" width="20">order</div>
				<div field="tableID" headerAlign="center" align="left" width="80">IDNo.</div>
				<div field="tableName" headerAlign="center" align="left" width="100">Data table name in Chinese</div>
				<!-- div field="sql_TableName" headerAlign="center" align="left" width="150">SQLThe data table name</div-->
				<div field="orderNum" width="50" headerAlign="center" align="right">
					roworderNo.<input property="editor" class="mini-textbox" minWidth="50"
						inputStyle="text-align:right" vtype="int" />
				</div>
				<div width="30" headerAlign="center" align="center" renderer="edit">
					edit</div>
				<div width="30" headerAlign="center" align="center"
					renderer="showDesign">design</div>
				<div width="30" headerAlign="center" align="center"
					renderer="showPreview">preview</div>
				<div width="30" headerAlign="center" align="center"
					renderer="showVersion">version</div>
				<div width="30" headerAlign="center" align="center"
					renderer="showDetail">detail</div>
			</div>
		</div>
	</div>

	<input bind="parentTableId" id="parentTableId" class="mini-hidden" />
    <input class="mini-hidden" id="appGuid" bind="appGuid"/>
	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[ 
		// Initialize the page
		epoint.initPage('subformlistmanageaction');
		
		function addSubFormClick(){
    		var tableId = mini.get("parentTableId").getValue();
    		var appGuid = mini.get("appGuid").getValue();
    		epoint.openDialog("new childTable","framemanager/sform/formlistmanage/maintableadd?parentTableId="+tableId+"&appGuid="+appGuid, 
    				addCallBack ,{
     					'width':700,
    			        'height':450
    			     });
    	}
		
		function save() {
			epoint.execute('save', 'datagrid', msgCallBack);
		}
		
		function del() {
			epoint.execute('del', 'datagrid', msgCallBack);
		}
		
		//The callback for the add operation
		function addCallBack(param) {
			if (param) {
				epoint.refresh(['datagrid'],'',true);
			}
		}
		
		// The callback to remind
		function msgCallBack(data) {
			if (data) {
				var msg = data.msg;
			    epoint.alert(msg, '', function(){
			    	epoint.refresh(['datagrid'],'',true);
			    }, 'info');
			}
		}
		
		//修改
		function edit(e) {
			return epoint.renderCell(e, "action-icon icon-edit", "createEditDialog");
		}
		
		function createEditDialog(data) {
			epoint.openDialog("修改表单","framemanager/sform/formlistmanage/maintableadd?tableId="+ data, addCallBack, {
    			'width':700,
    			'height':450
    		});
		}
		
		//版本
		function showVersion(e) {
			return epoint.renderCell(e, "action-icon icon-doc", "showVersionDialog");
		}

		function showVersionDialog(tableId) {
			epoint.openDialog("表单版本","framemanager/sform/formlistmanage/formversiondesign?tableId=" + tableId, addCallBack);
		}
    	
    	//设计
    	function showDesign(e) {
			return epoint.renderCell(e, "action-icon icon-gear", "showDesignDialog");
		}
    	
    	function showDesignDialog(tableId) {
			//根据tableId获取版本个数确定跳转方案
			epoint.execute('getDesignUrl', '', [tableId], function(args) {
				window.open("formdesign?tableId=" + tableId + "&versionId=" + args.Versionid);
			});
		}
    	
    	//预览
		function showPreview(e) {
			return epoint.renderCell(e, "action-icon icon-search", "showPreviewDialog");
		}

		function showPreviewDialog(tableId) {
			epoint.execute('getPreviewUrl', '', [tableId], showUrl);
		}
		
		//明细
		function showDetail(e) {
			return epoint.renderCell(e, "action-icon icon-search", "showDetailDialog");
		}

		function showDetailDialog(tableId) {
			epoint.openDialog("记录明细", "frame/pages/epointsform/showdetaillist?tableId=" + tableId, addCallBack);
		}
		
		function showUrl(args) {
			if (args.previewUrl) {
				top.epoint.openDialog("表单预览", args.previewUrl, addCallBack);
			} else {
				epoint.alertAndClose("当前表单没有预览页面或没有启用的版本！", '', null, null, 'warning');//edit 状态都为停用时，给提示
			}
		}
		
		//]]>
	</script>
</body>
</html>
