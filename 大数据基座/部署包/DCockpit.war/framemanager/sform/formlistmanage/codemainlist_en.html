<!DOCTYPE html>
<html>
<head>
<title>Code item management</title>
<meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>

	<!-- toolbar area -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" iconCls="icon-addcircle" onclick="addCodeMain()">Add code</a>
			<a class="mini-button" iconCls="icon-save" onclick="saveCodeMain()">Save the code</a>
			<a class="mini-button" iconCls="icon-minuscircle" onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('Please choose to delete the record!', '', null, 'warning');} else {epoint.confirm('Delete the main code item will sync delete child items,Sure you want to delete?','',deleteSelected);}">Delete item code</a>
		</div>
		<!--Help button -->
		<a role="helper" class="mr10">Description information</a>
	</div>

	<!-- Help information area Hidden by default-->
	<div class="fui-notice hidden">
		<p>
			<font style="color: blue;">button“To generate the script A”.The generated script will determine whether</font>
			<font style="color: red;">there are CodeID</font>
			<font style="color: blue;">,There are,Do not add; Don't exist,Then add.The codeID after adding and in the source database are </font>
		    <font style="color: red;">consistent</font>
		</p>
		<p>
			<font style="color: blue;">button“To generate the script B”.The generated script will determine whether</font>
			<font style="color: red;">there are CodeName</font>
			<font style="color: blue;">,There are,Modify the code item; Don't exist,Then add.The CodeID after adding and in the source database may</font>
		    <font style="color: red;">be not consistent</font>
		</p>
	</div>
	<div class="fui-condition">
		<!-- The form layout -->
		<div class="fui-form" id="fui-form">
			<div role="form">
				<!-- 2column -->
				<div role="row">
					<div role="control" label="Code name" starred="true">
						<input bind="codeMain.codeName" class="mini-textbox" required="true" 
						    requiredErrorText="The code name can not be empty" vtype="maxLength:50" />
					</div>
					<div role="control" label="Code instructions">
						<input bind="codeMain.description" vtype="maxLength:50" class="mini-textbox" />
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="fui-content">
		<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="codeID" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			action="getTableModal" showPager="true" allowCellSelect="true"
			allowCellValid="true" editNextOnEnterKey="true"
			editNextRowCell="true">
			<div property="columns">
				<div type="checkcolumn" width="50"></div>
				<div type="indexcolumn" headerAlign="center" width="50">order</div>
				<div field="codeName" headerAlign="center" width="220">Code name</div>
				<div field="description" headerAlign="center">
					Code instructions<input property="editor" class="mini-textbox" style="width: 100%" />
				</div>
				<div width="80" align="center" headerAlign="center" renderer="onEditRenderer">Item management</div>
			</div>
		</div>
	</div>

	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../rest/resource/jsboot"></script>

	<!-- Configuration Variables -->
	<script>
		//<![CDATA[
		//Initialize the page
		epoint.initPage("formcodemainlistaction");

		// Table object
		var grid = mini.get("datagrid");

		// Load data in the table after open the table editor
		grid.on("load", function(e) {
			var rows = e.sender.findRows();
			for (var i = 0; i < rows.length; i++) {
				grid.beginEditRow(rows[i]);
			}
		});

		// The new codeitem
		function addCodeMain() {
			if (epoint.validate()) {
				epoint.execute('addCodeMain', '', msgCallBack);
			}
		}

		// save
		function saveCodeMain() {
			var grid = mini.get("datagrid");
			if (grid.isValid() == false) {
				var error = grid.getCellErrors()[0];
				grid.beginEditCell(error.record, error.column);
				return;
			}
			epoint.execute('saveCodeMain', 'datagrid', msgCallBack);
		}

		// delete
		function deleteSelected() {
			epoint.execute('deleteAllSelected', 'datagrid', msgCallBack);
		}

		// Back off to remind
		function msgCallBack(data) {
			var msg = data.msg;
			if (msg) {
				epoint.alert(msg, '', searchData(), 'info');
			}
		}

		// table,the search tree
		function searchData() {
			epoint.refresh(['datagrid'],'',true);
		}
		
		// Draw the line editbutton
		function onEditRenderer(e) {
			return epoint.renderCell(e, "action-icon icon-edit", "openEdit","codeID");
		}
		
		function openEdit(codeID) {
            epoint.openDialog("Code changes","framemanager/sform/formlistmanage/codeitemslist?codeID=" + codeID,
            		addCallBack,{
				      'width':1200,
		              'height':550
		            });
        }
		
        //The callback for the add operation
		function addCallBack(param) {
			if (param) {
				searchData();
			}
		}
		//]]>
	</script>
</body>
</html>
