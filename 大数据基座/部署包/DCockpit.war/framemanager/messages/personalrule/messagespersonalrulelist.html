<!DOCTYPE html>
<html>

<head>
<title>个人自定义消息规则列表</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<style type="text/css">
.hideCheck {
	
}
</style>
<!-- 请修改相对路径 -->
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" iconCls="icon-save" onclick="saveAll()">保存禁用</a>
		</div>
	</div>
	<div class="fui-condition">
		<div class="fui-form" id="fui-form">
			<div role="form">
				<p>
					<em>设置方式：</em><font color="red">1.已配置并启用的消息规则会显示成可勾选2.已配置被禁用的规则会显示成灰色，这里只能勾选第1种已配置并启用的规则，勾选表示本人不接收这条渠道消息</font>
				</p>
			</div>
		</div>
	</div>

	<!-- 内容区域 -->
	<div id="fuiContent" class="fui-content">
		<div id="datagrid" class="mini-datagrid" idField="rowguid"
			action="getDataGridData" sortOrder="desc" showPager="true"
			style="height: 100%;" allowResize="true" multiSelect="true"
			allowCellEdit="true" allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true" ondrawcell="onCheckRender">
			<div property="columns">
				<div type="indexcolumn" width="20" headerAlign="center">序</div>
			</div>
		</div>
	</div>




	<!-- 请修改相对路径 -->
	<script src="../../../rest/resource/jsboot"></script>
	<link
		href="../../../frame/fui/js/miniui/plugin/gridcheckall/checkall.css"
		rel="stylesheet" type="text/css" />
	<script
		src="../../../frame/fui/js/miniui/plugin/gridcheckall/checkall.js"
		type="text/javascript"></script>
	<script>
		// 初始化页面
		epoint.initPage('messagespersonalrulelistaction', null, function() {
			epoint.execute('initDynamicChannel', null, function(data) {
				drawDynamicColumn(data);
			});
		});

		// 绘制行编辑按钮
		var onEditRenderer = function(e) {
			return epoint.renderCell(e, "action-icon icon-edit", "openEdit");
		};

		function callback(data) {
			if (data.msg) {
				epoint.alert(data.msg, '', searchData, 'info');
			}
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid' ]);
		}

		var grid = mini.get('datagrid');
		function saveAll() {
			grid.validate();
			if (grid.isValid() == false) {
				var error = grid.getCellErrors()[0];
				grid.beginEditCell(error.record, error.column);
				return;
			}
			epoint.execute('saveAll', '', callback);
		}
		// 绘制动态列
		function drawDynamicColumn(data) {
			var tmp = data.columns;
			var columns = Util.safeEval('(' + tmp + ')');
			grid.set(columns);

			var tmpObj = epoint.decodeJson(tmp);
			var columnsObj = tmpObj.columns;
			if (columnsObj && columnsObj.length) {
				$.each(columnsObj, function(k, v) {
					if (columnsObj[k].type == 'checkboxcolumn') {
						new CheckAll(grid, columnsObj[k].name);
					}
				});
			}
		}
		function onCheckRender(e) {
			//此功能只是隐藏掉选择框，但是还是可以被选到的，注意！！！！，要配合beforeselect使用
			if (e.record[e.field + 'hide'] == "true") {
				e.cellHtml = "";
			}
			if (e.record[e.field + 'hide'] == "disabled") {
				var id = e.cellHtml.split("\"")[1];
				e.cellHtml = "<span  id="+id+" class=\"mini-grid-checkbox mini-grid-checkbox-checked\" disabled=\"disabled\" style=\"background:#CCCCCC\" ></span>";
			}

		}
		grid.on("beforeselect", function(e) {
			var hide = e.record[e.field + 'hide'];
			if (hide) {
				e.cancel = true;
			}
		});
	</script>
</body>
</html>