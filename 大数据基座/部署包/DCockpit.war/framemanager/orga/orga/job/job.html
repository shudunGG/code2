<!DOCTYPE html>
<html lang="zh-CN">

<head>
<title>职位管理</title>
<meta charset="UTF-8" />
<meta http-equiv="content-type" content="text/html" />
<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addNew" iconCls="icon-save"
				onclick="if(epoint.validate()){epoint.execute('addNew','',newCallback);}">保存并新建</a>
			<a class="mini-button" id="addClose" iconCls="icon-save"
				onclick="if(epoint.validate()){epoint.execute('addJob','',closeCallback);}">保存并关闭</a>
			<a class="mini-button" id="save" iconCls="icon-save"
				onclick="if(epoint.validate()){epoint.execute('update','',closeCallback);}">保存修改</a>
		</div>
	</div>

	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="fui-form" class="fui-form">
			<div role="row">
				<div role="control" label="所属部门" starred="true">
					<input id="ouName" class="mini-buttonedit" bind="jobaction.ouName"
						onbuttonclick="selectOu" required="true" emptyText=""
						allowInput="false" selectOnFocus="true"
						requiredErrorText="所属部门不能为空!" />
				</div>
			</div>
			<div role="row">
				<div role="control" label="职位名称" starred="true">
					<input id="jobName" class="mini-textbox" bind="frameJob.jobName"
						required="true" requiredErrorText="职位名称不能为空!" vtype="maxLength:50" />
				</div>
			</div>
			<div role="row">
				<div role="control" label="描述">
					<input id="description" class="mini-textbox"
						bind="frameJob.description" vtype="maxLength:50" />
				</div>
			</div>
			<div role="row">
				<div role="control" label="排序号">
					<input id="orderNumber" class="mini-textbox"
						bind="frameJob.orderNumber" vtype="int;range:0,99999999"/>
				</div>
			</div>
			<div role="row">
				<div role="control" label="所属人员" starred="true">
					<input id="belongDisplayName" class="mini-buttonedit"
						selectOnFocus="true" bind="frameJob.belongDisplayName"
						onbuttonclick="selectPerson" allowInput="false" required="true"
						requiredErrorText="所属人员不能为空!" />
				</div>
			</div>
			<input bind="jobaction.ouGuid" id="ouGuid" class="mini-hidden" /> <input
				bind="jobaction.jobGuid" id="jobGuid" class="mini-hidden" /> <input
				bind="jobaction.userGuid" id="userGuid" class="mini-hidden" /> <input
				bind="jobaction.username" id="userName" class="mini-hidden" /> <input
				bind="frameJob.belongUserGuid" id="belongUserGuid"
				class="mini-hidden" />
		</div>

	</div>


	<script src="../../../../rest/resource/jsboot"></script>
	<script type="text/javascript">
		//<![CDATA[
		// 初始化页面
		epoint.initPage('jobaction', '', initCallBack);

		//由list页面传参时进行触发
		function initCallBack(data) {
			mini.get("ouName").setText(mini.get("ouName").getValue());
			mini.get("belongDisplayName").setText(
					mini.get("belongDisplayName").getValue());
			//如果新增
			if (data.add) {
				//隐藏修改按钮
				mini.get('save').setVisible(false);
			}
			//如果修改
			else {
				//隐藏新增按钮
				mini.get('addNew').setVisible(false);
				mini.get('addClose').setVisible(false);
			}
		}

		function selectOu(e) {
			epoint.openDialog('选择部门',
					"framemanager/orga/orga/ou/selectou?type=1",
					function(param) {
						if (param && param != 'close') {
							s = param.split(";");
							if (s[1] == 'f9root') {
								mini.get("ouName").setText('根');
								mini.get("ouName").setValue('根');
								mini.get("ouGuid").setValue('');
							} else {
								mini.get("ouName").setText(s[0]);
								mini.get("ouName").setValue(s[0]);
								mini.get("ouGuid").setValue(s[1]);
							}
						}
					}, {
						'width' : 300,
						'height' : 500
					});
		}

		function selectPerson() {
			var uGid = mini.get("belongUserGuid").getValue();
			var uName = mini.get("belongDisplayName").getValue();
			var ouGuid = mini.get("ouGuid").getValue();
			if (!ouGuid) {
				epoint.alert("请先选择部门!", '', null, 'info');
			} else {
				epoint.openDialog('选择职位对应的人员',
						"framemanager/orga/orga/user/selectuser?ouGuid="
								+ ouGuid, openiconOperJS, {
							'width' : 680,
							'height' : 900,
							param : {
								userGuid : uGid
							}
						});
			}
		}

		function openiconOperJS(rtnValue) {
			if (rtnValue && rtnValue != 'close') {
				var s = rtnValue.split("_SPLIT_");
				mini.get("userGuid").setValue(s[0]);
				mini.get("belongUserGuid").setValue(s[0]);
				mini.get("belongDisplayName").setValue(s[1]);
				mini.get("belongDisplayName").setText(s[1]);
				mini.get("userName").setValue(s[1]);
			}
		}

		function newCallback(data) {
			if (data.msg) {
				epoint.alert(data.msg, '', null, 'info');
				// 清空表单
				//if (data.msg.indexOf("成功") != -1) {
				if (data.success) {
					epoint.clear('fui-form');
				}
			}
		}

		// 关闭操作的回调
		function closeCallback(data) {
			var msg = data.msg;
			if (msg) {
				//if (msg.indexOf("成功") != -1) {
				if (data.success) {
					epoint.alertAndClose(msg, '', null, null, 'success');
				} else {
					epoint.alert(msg, '', null, 'error');
				}
			}
		}
		//]]>
	</script>

</body>
</html>