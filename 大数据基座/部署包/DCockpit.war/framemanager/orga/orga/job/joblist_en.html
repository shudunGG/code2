<!DOCTYPE html>
<html lang="zh-CN">

<head>
<title>Position management list</title>
<meta charset="UTF-8"/>
<meta http-equiv="content-type" content="text/html" />
<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>
<body>
	<div class="page-loading"></div>

	<div class="fui-left">
		<div role="head" title="choose department"></div>
		<div role="body">
			<ul id="tree" name="tree" class="mini-tree"
				style="width: 100%; height: 100%" autoLoad="false"
				showTreeIcon="true" textField="text" idField="id" parentField="pid"
				action="getTreeModel" resultAsTree="false">
			</ul>
		</div>
	</div>

	<div class="fui-right">
		<!-- toolbar area -->
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button" iconCls="icon-addcircle" id="btnAddRecord" onclick="addJob();">new position</a> 
				<a class="mini-button" iconCls="icon-minuscircle" id="btnDel"
					onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('Please choose to delete records!', '', null, 'warning');} else {epoint.confirm('Confirm to delete?','',deleteSelect);}">delete selected
				</a> 
				<a class="mini-button" iconCls="icon-save" id="btnUpdate" onclick="numberUpdate();">update sort</a>
			</div>
		</div>

		<!-- conditions area -->
		<div class="fui-condition">
			<div class="fui-form" id="fui-form">
				<div id="cform" role="form">
					<div role="row">
						<div role="control" label="job title">
							<input id="search_JobName" class="mini-textbox"
								bind="joblistaction.searchString" emptyText="" onkeyenter="searchData();" />
						</div>
						<div role="control" label="belongs user">
							<input id="search_BelongDisplayName" class="mini-textbox"
								bind="joblistaction.searchString1" onkeyenter="searchData();" />
						</div>
					</div>
				</div>
				<input bind="joblistaction.leftTreeNodeGuid" id="ouGuid" class="mini-hidden" /> 
				<input bind="joblistaction.frameJob.jobGuid" id="jobGuid" class="mini-hidden" />
			</div>
			<a role="searcher" callback="searchData"></a>
		</div>

		<!-- content area -->
		<div id="fuiContent" class="fui-content">
			<div id="datagrid" name="datagrid" class="mini-datagrid"
				idField="jobGuid" multiSelect="true" action="getDataGridData"
				showPager="true" style="width: 100%; height: 100%;"
				allowResize="true" allowCellEdit="true"
				allowCellSelect="true" allowCellValid="true"
				editNextOnEnterKey="true" editNextRowCell="true">
				<div property="columns">
					<div type="checkcolumn" width="50"></div>
					<div type="indexcolumn" width="50" headerAlign="center">order</div>
					<div field="jobName" width="150"  headerAlign="center">job title</div>
					<div field="ouName" width="150" headerAlign="center">department</div>
					<div field="belongUserName" headerAlign="center" width="100%">belongs to the user</div>
					<div field="orderNumber" width="150" headerAlign="center" align="right" vtype="int">
						roworderNo.<input property="editor" class="mini-textbox" minWidth="20" 
						  inputStyle="text-align:right" maxLength="6" />
					</div>
					<div width="80" align="center" headerAlign="center"
						renderer="onEditRenderer">edit</div>
				</div>
			</div>
		</div>
	</div>
	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../../rest/resource/jsboot"></script>

	<script>
	//<![CDATA[
		// Initialize the page
		epoint.initPage('joblistaction');

		//The treejsobject
		var tree = mini.get("tree");
		
		var grid = mini.get("datagrid");

		// Click on the left side of theThe treeRefresh the form on the right side
		tree.on("nodeselect", function(e) {
			var id = e.node.id;
			//To the leftThe treeClick on the nodeidIn a hidden field
			mini.get('ouGuid').setValue(id=='f9root'?"":id);
			//Refresh the table
			updateTable_tree();
		});
		
		function addJob() {
			var ouGuid = mini.get('ouGuid').getValue();
			var settings = {
				'width' : 1000,
				'height' : 520
			};
			epoint.openDialog('new position', 'framemanager/orga/orga/job/job?ouGuid=' + ouGuid, addCallBack, settings);
		}

		// Draw Edit Columns button
		var onEditRenderer = function(e) {
			return epoint.renderCell(e, "action-icon icon-edit", "editJob","jobGuid");
		};
		
		function editJob(jobGuid) {
			var settings = {
				'width' : 1000,
				'height' : 520
			};
			epoint.openDialog('editposition', 'framemanager/orga/orga/job/job?jobGuid=' + jobGuid, addCallBack, settings);
		}

		//The callback for the add operation
		function addCallBack(param) {
			if (param) {
				epoint.refresh([ 'datagrid', 'fui-form', "tree" ],'',true);
			}
		}

		// saveroworderCode page refresh
		function numberUpdate() {
			grid.validate();
			if (grid.isValid() == false) {
				var error = grid.getCellErrors()[0];
				grid.beginEditCell(error.record, error.column);
				return;
			}
			epoint.execute('numberUpdate', '', callback);
		}

		function callback(data) {
			if (data.msg) {
				epoint.alert(data.msg, '', function(){
					epoint.refresh([ 'datagrid', 'fui-form', "tree" ],'',true);
				}, 'info');
			}
		}

		// delete data
		function deleteSelect() {
			epoint.execute("deleteSelect", ['datagrid','fui-form'], callback);
		}
		
		function updateTable_tree() {
			epoint.refresh([ "datagrid", "fui-form" ]);
		}
		
		// Search for tables
		function searchData() {
			epoint.refresh([ 'datagrid', 'fui-form', "tree" ]);
		}
		//]]>
	</script>
</body>
</html>
