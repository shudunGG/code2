<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>客户端配置列表</title>
<script src="../../../../../frame/fui/js/cssboot.js"></script>
<style type="text/css">
        .btn-in-column{margin-right:5px;}
        .btn-in-column-text{margin-left:5px;margin-right:5px;}
</style>
</head>
<body>
	<div class="page-loading"></div>
	
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a id="addConfig" class="mini-button" onclick="addConfig">新增配置</a>
		</div>
	</div>
	
	<!-- 条件区域 -->
	<div class="fui-condition">
		<div class="fui-form" id="fui-form">
			<div id="cform" role="form">
				<div role="row">
					<div role="control" label="操作系统类型">
						<div id="search_clientOsType" class="mini-combobox" style="width:150px;"
						textField="text" valueField="id" bind="clientOsTypeId" showClose="true" 
						onkeyenter="searchData();" oncloseclick="onCloseClick"
						onvaluechanged="onClientOsTypeValueChanged"></div>
					</div>
					<div role="control" label="版本号">
						<div id="search_clientVersion" class="mini-combobox" style="width:200px;"  popupWidth="200" textField="text" valueField="id" 
						    bind="clientVersionGuid" showClose="true" oncloseclick="onCloseClick" 
						    onkeyenter="searchData();">     
						</div>
					</div>
					<div role="control" label="配置名称">
						<input id="search_clientConfigName" class="mini-textbox"
							bind="clientConfigName" onkeyenter="searchData();" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="配置类型">
						<div id="globalConfig"  class="mini-checkbox" bind="isGlobalConfig" readOnly="false" text="全局配置" 
						onvaluechanged="onGlobalConfigValueChanged" onkeyenter="searchData();"></div>
					</div>
				</div>
			</div>
		</div>
		<a role="searcher" callback="searchData"></a>
	</div>
	
	
	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="versionGuid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			showPager="true" action="getDataGridData">
			<div property="columns">
				<div type="indexcolumn" width="50" headerAlign="center">序</div>
				<div field="configName" headerAlign="center" width="150">参数名称</div>
				<div field="configValue" headerAlign="center" width="150">参数值</div>
				<div field="configDesc" headerAlign="center" align="center" width="100%"">配置描述</div>
				<div field="clientVersion" headerAlign="center" width="150">版本号</div>
				<div field="clientOsTypeName" headerAlign="center" align="left" width="150">操作系统</div>
				<div field="creatorName" headerAlign="center" align="center" width="150">创建者</div>
				<div field="gmtCreateTime" headerAlign="center" renderer="onTimeRender"
					align="center" width="150">创建时间</div>
				<div name="operation" headerAlign="center" renderer="onOperationRender"
				align="center" width="200">操作</div>
			</div>
		</div>
	</div>

	<script src="../../../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[
		                      
		//初始化页面
		epoint.initPage('clientconfiglistaction', '', initCallBack);

		// 初始化页面回调函数
		function initCallBack(e){
			
			// 初始化客户端系统类型单选按钮
			mini.get('search_clientOsType').set({data:e.clientOsTypeListJson});
		}
		
		// 表格对象
		var grid = mini.get("datagrid");

		// 格式化时间列
		function onTimeRender(e) {
			
			var time = e.value;
			
			time = new Date(time);
			
			// 格式化时间
			var year = time.getFullYear();
			var month = time.getMonth() + 1;
			month = fixZero(month);
			var date = time.getDate();
			date = fixZero(date);
			var hours = time.getHours();
			hours = fixZero(hours);
			var minutes = time.getMinutes();
			minutes = fixZero(minutes);
			var seconds = time.getSeconds();
			seconds = fixZero(seconds);
			
			return year + '-' + month + '-' + date + ' ' + hours + ':' + minutes + ':' + seconds;
		}

		function fixZero(data){
			if (data < 10) {
				data = '0' + data;
			}
			return data;
		}
		
		// 搜索条件状态清除
		function onCloseClick(e) {
            var obj = e.sender;
            obj.setText("");
            obj.setValue("");
        }
		
		// 客户端系统类型修改触发操作
		function onClientOsTypeValueChanged(){
			epoint.execute('getClientVersionList','search_clientOsType', getClientVersionListCallBack);
		}
		
		// 获取版本号回调函数
		function getClientVersionListCallBack(data){
			if (data) {
				if(data.success === 'success'){
					// 客户端版本号下拉选择框
					var versionNumberArrayCombobox = mini.get("search_clientVersion");
					// 清空版本号下拉框数据
					versionNumberArrayCombobox.setValue('');
					versionNumberArrayCombobox.setValue('');
					// 设置版本号下拉框数据
					versionNumberArrayCombobox.set({data:data.clientVersionListJson});
				} else {
					epoint.alert(data.msg, '', '', 'warning');
				}
			} else {
				epoint.alert('操作失败', '', '', 'warning');
			}
		}
		
		function onGlobalConfigValueChanged(){
			// 获取选中状态
			var checked = this.getChecked();
			
			// 选中则将系统类型和版本号置为不可操作，且清空对应值
			// 非选中则将系统类型和版本号置为可操作
			if (checked) {
				mini.get("search_clientOsType").disable();
				mini.get("search_clientVersion").disable();
			} else {
				mini.get("search_clientOsType").enable();
				mini.get("search_clientVersion").enable();
			}
			
		}
		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid', 'fui-form']);
		}

		// 绘制操作按钮
		function onOperationRender(e) {
			var configGuid = e.row['configguid'];
			
			// 编辑
			var editHtml = '<a class="mini-button btn-in-column" id="btnEdit" onclick="editConfig(\'' + configGuid + '\');"><div class="btn-in-column-text">编辑</div></a>';
			// 删除
			var deleteHtml = '<a class="mini-button mini-btn-danger btn-in-column" id="btnDelete" onclick="deleteConfig(\'' + configGuid + '\');"><div class="btn-in-column-text">删除</div></a>'
		
			var renderHtml = '<div>' + editHtml + deleteHtml + '</div>';
			return renderHtml;
		}	
		
		// 新增配置
		function addConfig() {
			epoint.openDialog("新增配置", 'framemanager/orga/openplatform/client/config/clientconfigadd', dealConfigCallBack, {'width': 500, 'height': 350});
		}
		
		// 编辑配置
		function editConfig(configGuid){
			epoint.openDialog("编辑配置", 'framemanager/orga/openplatform/client/config/clientconfigedit?configGuid=' + configGuid, dealConfigCallBack, {'width': 500, 'height': 350});
		}
		
		// 删除配置
		function deleteConfig(configGuid){
			
			epoint.execute('deleteConfig', '', [configGuid], dealConfigCallBack);
		}
		
		// 配置操作回调函数
		function dealConfigCallBack(data){
			if (data) {
				epoint.refresh(['datagrid', 'fui-form'],'',true);
			} 
		}

		//]]>
	</script>


</body>
</html>