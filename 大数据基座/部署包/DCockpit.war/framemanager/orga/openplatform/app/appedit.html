<!DOCTYPE html>
<html>

<head>
<title>应用详情</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script src="../../../../frame/fui/js/cssboot.js"></script>
<style>
.mini-webuploader {
	height: 17px;
	vertical-align: text-top;
}
.mini-uploader-btns .webuploader-pick {
	line-height: 17px;
	background: transparent;
	color: #d2322d;
	font-weight: bold;
	padding: 0 4px;
}
</style>
</head>
<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>
	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<div id='audit'>
				<a class="mini-button" id="pass" onclick="passAudit">通过</a>
				<a class="mini-button mini-btn-danger" id="notPass" onclick="notPassAudit">拒绝</a>
	            <a class="mini-button" onclick="epoint.closeDialog">关闭</a>
			</div>
			<div id='detail'>
				<a class="mini-button mini-btn-danger" id="save" onclick="saveModify">保存</a>
	            <a class="mini-button" onclick="epoint.closeDialog">关闭</a>
			</div>
		</div>
	</div>
	<!-- 内容区域 -->
	<div class="fui-content">
		<div class="fui-accordions" id="fui-accordions">
			<div role="accordion" opened="true">
				<div role="head" title="应用基本信息" ></div>
				<div role="body">
					<div class="fui-form">
						<div role="form">
							<div role="row">
								<label class="form-label" >应用logo:</label>
								<div class="form-control span2" starred="true">
									<div class="icon-view">
									<img id="appIcon" width="100px" height="100px"/>
									</div>
								</div>
							</div>
							<div role="row">
								<label class="form-label" >应用名称:</label>
								<div id="appName" class="form-control span2">
									<input id="appName" bind="appInfo.appname"
										class="mini-textbox" required="true"
										requiredErrorText="应用名不能为空" vtype="maxLength:100"/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="功能介绍">
									<input id="appDesc" bind="appInfo.appdesc" class="mini-textarea" style="width:100%;height:120px;"/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="适用地区">
									<input id="selectedDistrict" bind="allowDistrict" allowInput="false"
										class="mini-buttonedit" emptyText="" required="true" requiredErrorText="请选择适用地区"
										onbuttonclick="selectDistrict"
										selectOnFocus="true" />
										<!-- 隐藏域 -->
									<input bind="appInfo.allowdistrictcodeid" id="allowdistrictcodeid" class="mini-hidden" />
								</div>
								<div role="control" label="应用分类">
									<input id="selectedServiceType" bind="serviceType" allowInput="false"
										class="mini-buttonedit" emptyText="" required="true" requiredErrorText="请选择应用分类"
										onbuttonclick="selectServiceType"
										selectOnFocus="true" />
										<!-- 隐藏域 -->
									<input bind="appInfo.servicetype" id="servicetype" class="mini-hidden" />
								</div>
							</div>
							<div role="row">
								<label class="form-label" >后台地址:</label>
								<div class="form-control span2" starred="true">
									<input bind="appInfo.appconfigurl" class="mini-textbox" />
								</div>
								<label class="form-label" >首页地址:</label>
								<div id="mobilepageurl" class="form-control span2">
									<input id="mobilepageurl" bind="appInfo.mobilepageurl"
										class="mini-textbox" required="true"
										requiredErrorText="首页地址不能为空"/>
								</div>
							</div>
							<div role="row">
								<label class="form-label" >PC版首页地址:</label>
								<div class="form-control span2" starred="true">
									<input bind="appInfo.pcindexurl" class="mini-textbox" />
								</div>
								<div role="control" label=""></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div role="accordion" opened="true">
				<div role="head" title="开发者基本信息" ></div>
				<div role="body">
					<div class="fui-form">
						<div role="form">
							<div role="row">
								<label class="form-label" >开发者登录名:</label>
								<div class="form-control span2" starred="true">
									<input bind="platformUser.loginId" class="mini-textbox"
										allowInput=false vtype="maxLength:50" />
								</div>
								<label class="form-label" >开发者姓名:</label>
								<div id="displayName" class="form-control span2">
									<input id="displayName" bind="platformUser.displayName"
										class="mini-textbox" allowInput=false/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="手机号">
									<input id="mobile" bind="platformUser.mobile" class="mini-textbox" allowInput=false/>
								</div>
								<div role="control" label=""></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div role="accordion" opened="true">
				<div role="head" title="企业信息" ></div>
				<div role="body">
					<div class="fui-form">
						<div role="form">
							<div role="row">
								<div role="control" label="企业名称">
									<input id="companyName" bind="platformCompany.companyName" 
									class="mini-textbox" allowInput=false/>
								</div>
								<div role="control" label="行业">
									<input bind="industryCategory"  starred="true" class="mini-textbox" allowInput=false/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="规模">
									<input id="scale" bind="platformCompany.scale" 
									class="mini-textbox" allowInput=false/>
								</div>
								<div role="control" label=""></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<input id="controlIds" class="mini-hidden" />
	</div>

	<script src="../../../../rest/resource/jsboot"></script>



	<script>
		//<![CDATA[
		
		//初始化请求
		epoint.initPage('appeditaction', '', initCallBack);
		
		var appGuid = '';
		function initCallBack(e){
			appGuid = e.appGuid;
			
			mini.get("selectedServiceType").setText(e.serviceType);
			mini.get("selectedServiceType").setValue(e.serviceType);
			
			mini.get("selectedDistrict").setText(e.allowDistrict);
			mini.get("selectedDistrict").setValue(e.allowDistrict);
			
			$("#appIcon").attr('src', e.appIconUrl);
			
			if(e.showMode=='audit'){
				document.getElementById("detail").style.display = 'none';
			}else{
				document.getElementById("audit").style.display = 'none';
			}
		}
		
		// 审核通过
		function passAudit(){
			if (epoint.validate()) {
				epoint.execute('passAudit', '', appGuid, passAuditCallBack);
			}
		}
		
		// 审核通过回调
		function passAuditCallBack(data){
			var msg =data.msg;
			if (msg) {
				if(data.success){
					epoint.closeDialog("success");
				} else {
					epoint.alert(msg, '', '', 'warning');
				}
			} else {
				epoint.alert('操作失败', '', '', 'warning');
			}
		}
		
		// 审核不通过
		function notPassAudit(){
			epoint.openDialog("输入拒绝理由",
					'framemanager/orga/openplatform/user/inputreason', function(rtnValue){
				if (rtnValue != 'close') {
					epoint.execute('notPassAudit', '', [appGuid, rtnValue], notPassAuditCallBack);
				}
			}, {
						'width' : 350,
						'height' : 260
					});
			
		}
		
		// 审核不通过回调
		function notPassAuditCallBack(data){
			var msg =data.msg;
			if (msg) {
				if(data.success){
					epoint.closeDialog("success");
				} else {
					epoint.alert(msg, '', '', 'warning');
				}
			} else {
				epoint.alert('操作失败', '', '', 'warning');
			}
		}
		
		// 选择应用分类
		function selectServiceType(){
			epoint.openDialog("选择应用分类",
					'framemanager/orga/openplatform/app/selectcodeitem?codeName=应用分类',
					dealSelectServiceTypeBackValue, {
						'width' : 300,
						'height' : 400
					});
		}
		
		// 选择代码项回调
		function dealSelectServiceTypeBackValue(rtnValue){
			if (rtnValue && rtnValue != 'close') {
				// codeid_SPLIT_名称
				var idAndName = rtnValue.split("_SPLIT_");
				var id = idAndName[0];
				var	name = idAndName[1];
			
				mini.get("selectedServiceType").setText(name);
				mini.get("servicetype").setValue(id);
				
			}
		}
		
		// 选择应用适用地区
		function selectDistrict(){
			epoint.openDialog("选择应用适用地区",
					'framemanager/orga/openplatform/app/selectcodeitem?codeName=地区',
					dealSelectDistrictBackValue, {
						'width' : 300,
						'height' : 400
					});
		}
		
		// 选择应用分类回调
		function dealSelectDistrictBackValue(rtnValue){
			if (rtnValue && rtnValue != 'close') {
				// codeid_SPLIT_名称
				var idAndName = rtnValue.split("_SPLIT_");
				var id = idAndName[0];
				var	name = idAndName[1];
			
				mini.get("selectedDistrict").setText(name);
				mini.get("allowdistrictcodeid").setValue(id);
				
			}
		}
		
		// 保存
		function saveModify(){
			if (epoint.validate()) {
				epoint.execute('saveModify', '', appGuid, saveModifyCallBack);
			}
		}
		
		function saveModifyCallBack(data){
			var msg = data.msg;
			if (msg) {
				if(data.success){
					epoint.closeDialog("success");
				} else {
					epoint.alert(msg, '', '', 'warning');
				}
			} else {
				epoint.alert('操作失败', '', '', 'warning');
			}
		}
		//]]>
	</script>

</body>
</html>