<!DOCTYPE html>
<html>

<head>
<title>报表分类</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../frame/fui/js/cssboot.js"></script>
</head>
<body>

	<div class="page-loading"></div>


	<!-- 左侧树 -->
	<div class="fui-left">
		<div role="body">
			<ul id="tree" class="mini-tree" style="height: 100%" textField="text"
				idField="id" parentField="pid" action="getTreeData"
				resultAsTree="false"></ul>
		</div>
	</div>

	<!-- 右侧内容区域 -->
	<div class="fui-right">
		<!-- toolbar区域 -->
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button" id="addbtn" onclick="addCat();">新增类别</a> <a
					class="mini-button" id="addbtn" onclick="saveCat();">保存修改</a> <a
					class="mini-button mini-btn-danger" id="addbtn"
					onclick="deleteCat();">删除选中</a>
			</div>
			<!-- 添加隐藏域，用于树与表格的联动 -->
			<input bind="leftTreeNodeGuid" id="leftTreeNodeGuid"
				class="mini-hidden" />
		</div>

		<!-- 列表区域 -->
		<div class="fui-content">
			<div id="datagrid" name="datagrid" class="mini-datagrid"
				idField="rowguid" multiSelect="true"
				style="width: 100%; height: 100%;" allowResize="true"
				showPager="true" action="getDataGridData" allowCellSelect="true"
				editNextOnEnterKey="true" editNextRowCell="true"
				allowCellEdit="true">
				<!-- allowCellEdit="true" -->
				<div property="columns">
					<div type="checkcolumn" width="80"></div>
					<div type="indexcolumn" width="80" headerAlign="center">序</div>
					<div field="categoryname" headerAlign="center" width="100%">
						子类别名称<input property="editor" class="mini-textbox" />
					</div>
					<div field="categorynum" headerAlign="center" width="250">子类别编号</div>
					<div field="ordernum" headerAlign="center" width="250">
						排序号<input property="editor" class="mini-textbox" vtype="int;range:0,99999999"/>
					</div>
				</div>
			</div>
		</div>


	</div>


	<script src="../../rest/resource/jsboot"></script>

	<!-- 配置变量 -->
	<script>
		//初始化页面
		epoint.initPage("reportcategorylistaction");

		//树js对象
		var tree = mini.get("tree");

		//点击树节点刷新表格
		tree.on("nodeselect", function(e) {
			if (e.node) {
				//将左侧树点击的节点id放到隐藏域中
				mini.get('leftTreeNodeGuid').setValue(e.node.id);
				//mini.get('parentName').setValue(e.node.text);
			}
			//刷新表格
			epoint.refresh([ 'datagrid', 'leftTreeNodeGuid' ]);
		});

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid', 'leftTreeNodeGuid', 'tree' ]);
		}

		//新增分类
		/* 	function addCat() {
				if (epoint.validate()) {
					epoint.execute("add", "fui-form", function(data) {
						epoint.alert(data.message, '', null, 'info');
						mini.get("categoryname").setValue("");
						mini.get("ordernum").setValue("");
						epoint
								.refresh([ 'datagrid', 'fui-form', 'tree' ], '',
										true);
					});
				}
			} */
		function addCat() {
			var newRow = {};
			mini.get("datagrid").addRow(newRow, 0);
			mini.get("datagrid").beginEditRow(newRow);
		}

		//保存分类
		function saveCat() {
			epoint.execute("save", "datagrid", function(data) {
				epoint.alert(data.message, '', null, 'info');
				epoint.refresh([ 'datagrid', 'leftTreeNodeGuid', 'tree' ], '', true);
			});
		}

		//删除分类
		function deleteCat() {
			if (mini.get("datagrid").getSelectedIds().length > 0) {
				epoint.confirm("确定删除选中记录？", "", function(action) {
					epoint.execute("delete", "datagrid", function(data) {
						epoint.alert(data.message, '', null, 'info');
						epoint.refresh([ 'datagrid', 'leftTreeNodeGuid', 'tree' ], '',
								true);
					});
				});
			} else {
				epoint.alert("请选择要删除的记录!", '', null, 'warning');
			}
		}
	</script>
</body>
</html>