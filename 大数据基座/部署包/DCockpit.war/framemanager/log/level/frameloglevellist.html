<!DOCTYPE html>
<html>

<head>
<title>日志等级设置</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" iconCls="icon-addcircle" onclick="addLevel">新增日志级别</a>
			<a class="mini-button" iconCls="icon-save"
				onclick="epoint.execute('frameloglevellistaction.editLevel','',saveCallback);">保存设置</a>
			<a class="mini-button mini-btn-danger" iconCls="icon-minuscircle"
				onclick="deleteSelect">删除日志级别</a>
		</div>
	</div>

	<div class="fui-search" opened="false" primaryControl="name">
		<!-- 表单布局 -->
		<div class="fui-form" id="fui-form">
			<div id="cform" role="form">
				<!-- 2列 -->
				<div role="row">
					<div role="control" label="日志名称">
						<input bind="frameLogLevel.logname" id="name" class="mini-textbox"
							style="width: 100%;" />
					</div>
					<div role="control" label="当前日志等级">
						<input id="level"
							data="[{text:'',id:''},{text:'DEBUG',id:'DEBUG'},{text:'INFO',id:'INFO'},{text:'WARN',id:'WARN'},{text:'ERROR',id:'ERROR'},{text:'FATAL',id:'FATAL'},{text:'ALL',id:'ALL'},{text:'OFF',id:'OFF'}]"
							textField="text" valueField="id" bind="frameLogLevel.loglevel"
							class="mini-combobox" style="width: 100%" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="默认日志级别">
						<input id="defaultlevel"
							data="[{text:'',id:''},{text:'DEBUG',id:'DEBUG'},{text:'INFO',id:'INFO'},{text:'WARN',id:'WARN'},{text:'ERROR',id:'ERROR'},{text:'FATAL',id:'FATAL'},{text:'ALL',id:'ALL'},{text:'OFF',id:'OFF'}]"
							textField="text" valueField="id"
							bind="frameLogLevel.defaultlevel" class="mini-combobox"
							style="width: 100%" />
					</div>
				</div>
			</div>
		</div>

		<!-- 搜索按钮 -->
		<a role="searcher" callback="searchData"></a>
	</div>

	<div id="fuiContent" class="fui-content">
		<div id="datagrid" class="mini-datagrid" idField="levelguid"
			multiSelect="true" style="width: 100%; height: 100%;"
			allowResize="true" showPager="true"
			action="frameloglevellistaction.loglevelModel" allowCellEdit="true"
			allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true">
			<div property="columns">
				<div type="checkcolumn" width="50"></div>
				<div field="logname" width="100%" headerAlign="center">
					日志名称 <input property="editor" class="mini-textbox"
						style="width: 100%;" minWidth="200" />
				</div>
				<div field="loglevel" width="120" align="center"
					headerAlign="center">
					当前日志等级 <input property="editor" class="mini-combobox"
						data="[{text:'DEBUG',id:'DEBUG'},{text:'INFO',id:'INFO'},{text:'WARN',id:'WARN'},{text:'ERROR',id:'ERROR'},{text:'FATAL',id:'FATAL'},{text:'ALL',id:'ALL'},{text:'OFF',id:'OFF'}]"
						style="width: 100%;" minWidth="200" />
				</div>
				<div field="isworking" width="80" align="center"
					headerAlign="center" type="checkboxcolumn">
					启用
					<div class="mini-checkbox" value="1" truevalue="1" falsevalue="0"></div>
				</div>
				<div field="description" headerAlign="center" width="150">
					备注 <input property="editor" class="mini-textbox"
						style="width: 100%;" />
				</div>
			</div>
		</div>

	</div>

	<script src="../../../rest/resource/jsboot"></script>

	<!-- 配置变量 -->
	<script>
		//初始化页面
		epoint.initPage("frameloglevellistaction");

		var combox = mini.get("appenderListN");
		var appenderList;
		combox.on("load", function(e) {
			console.log(e.sender.data);
			appenderList = e.sender.data;
		});

		function addLevel() {
			var settings = {
				'width' : 700,
				'height' : 360
			};
			epoint.openDialog('新增日志级别', 'framemanager/log/level/frameloglevel',
					addCallBack, settings);
		}

		//新增回调
		function addCallBack(param) {
			if (param) {
				epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
			}
		}

		//新增代码后的回调
		function saveCallback(data) {
			if (data.msg) {
				epoint.alert(data.msg, '', null, 'info');
				//刷新表格
				epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
			}
		}

		function searchData() {
			epoint.refresh([ 'datagrid', 'fui-form' ]);
		}

		function deleteSelect() {
			var datagrid = mini.get('datagrid');
			var ids = datagrid.getSelectedIds();

			if (ids.length > 0) {
				epoint.confirm("确定删除选中记录？", "", function(action) {
					epoint.execute('frameloglevellistaction.deleteLevel', '',
							saveCallback);
				});
			} else {
				epoint.alert("请选择要删除的记录!", '', null, 'warning');
			}
		}
	</script>

</body>

</html>
