<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>代办事宜配置</title>
    <script src="../../../../frame/fui/js/cssboot.js"></script>
    <!-- <script>
        SrcBoot.output([
            './manage.css'
        ]);
    </script> -->
    <style>
        .title-img-item {
            width: 20px;
            height: 20px;
            margin: 10px;
        }
    </style>
</head>

<body>
    <div class="fui-toolbar">
        <div class="btn-group">
            <span class="mini-button" onclick="saveAndClose">保存并关闭</span>
            <span class="mini-button">保存</span>
            <span class="mini-button">取消</span>
        </div>
    </div>
    <div class="fui-content">
        <div class="fui-accordions">
            <div role="accordion" opened="true">
                <div role="head" title="总览">
                </div>
                <div role="body">
                    <div class="fui-form">
                        <div role="form">
                            <div role="row">
                                <div role="control" label="无边框" starred="true">
                                    <div class="mini-radiobuttonlist" repeatItems="3" textField="text" valueField="value" value="false" data="[{value:true,text:'是'},{value:false,text:'否'}]"
                                        onvaluechanged="onBorderValueChanged">
                                    </div>
                                </div>
                            </div>
                            <div role="row" id="border-color-row">
                                <div role="control" label="边框颜色">
                                    <input class="mini-colorpicker" allowInput="true" format="hex" value="#ddd" />
                                </div>
                                <div role="control"></div>
                                <div role="control"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div role="accordion" opened="true">
                <div role="head" title="标题栏">
                </div>
                <div role="body">
                    <div class="fui-form">
                        <div role="form">
                            <div role="row">
                                <div role="control" label="显示标题栏" starred="true">
                                    <div class="mini-radiobuttonlist" repeatItems="3" textField="text" valueField="value" value="true" data="[{value:'true',text:'是'},{value:'false',text:'否'}]"
                                        onvaluechanged="onShowTitleBarChanged">
                                    </div>
                                </div>
                            </div>
                            <div role="row" id="title-settings-el">
                                <div role="control" label="标题图标">

                                    <input id="title-img-select" class="mini-buttonedit" emptyText="请选择..." selectOnFocus="true" onbuttonclick="showTitleImgList"
                                    />
                                </div>
                                <div role="control" label="标题字体颜色" starred="true">
                                    <input class="mini-colorpicker" allowInput="true" format="hex" value="#f96e41" />
                                </div>
                                <div role="control" label="标题栏背景颜色" starred="true">
                                    <input class="mini-colorpicker" allowInput="true" format="hex" value="#efefef" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div role="accordion" opened="true">
                <div role="head" title="工具栏">
                </div>
                <div role="body">
                    <div class="fui-form">
                        <div role="form">
                            <div role="row">
                                <div role="control" label="工具栏按钮" starred="true">
                                    <div class="mini-checkboxlist" repeatItems="3" textField="text" valueField="value" value="more,refresh" data="[{value:'more',text:'更多'},{value:'refresh',text:'刷新'}]"
                                        onvaluechanged="onToolbarValueChanged">
                                    </div>
                                </div>
                            </div>
                            <div role="row" id="element-opentype-el">
                                <div role="control" label="更多按钮打开方式" starred="true">
                                    <div class="mini-radiobuttonlist" repeatItems="3" textField="text" valueField="value" value="dialog" data="[{value:'dialog',text:'弹窗'},{value:'tabsNav',text:'tabsNav'},{value:'blank',text:'新窗口'}]">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div role="accordion" opened="true">
                <div role="head" title="内容">
                </div>
                <div role="body">
                    <div class="fui-form">
                        <div role="form">
                            <div role="row">
                                <div role="control" label="栏目选择" starred="true">
                                    <input class="mini-buttonedit" emptyText="请选择..." selectOnFocus="true" />
                                </div>
                            </div>
                            <div role="row">
                                <div role="control" label="内容背景色" starred="true">
                                    <input class="mini-colorpicker" allowInput="true" format="hex" value="#ffffff" />
                                </div>
                                <div role="control"></div>
                                <div role="control"></div>
                            </div>
                            <div role="row">
                                <div role="control" label="链接打开方式" starred="true">
                                    <div class="mini-radiobuttonlist" repeatItems="3" textField="text" valueField="value" value="dialog" data="[{value:'dialog',text:'弹窗'},{value:'tabsNav',text:'tabsNav'},{value:'blank',text:'新窗口'}]">
                                    </div>
                                </div>
                            </div>
                            <div role="row">
                                <div role="control" label="信息条数" starred="true">
                                    <input changeOnMousewheel="false" class="mini-spinner" minValue="1" maxValue="50" value="5" />
                                </div>
                            </div>
                            <div role="row">
                                <div role="control" label="高度" starred="true">
                                    <input changeOnMousewheel="false" class="mini-spinner" minValue="100" maxValue="1000" value="500" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="title-img-dialog" class="mini-window" title="标题图片选择" style="width:400px;height:250px;" showMaxButton="true" showCollapseButton="true"
            showShadow="true" showModal="false" allowResize="true" allowDrag="true">
            <div id="title-img-container">
                <div class="img-list clearfix"></div>
            </div>
        </div>
    </div>
    <script>
        SrcBoot.mock = true;
        SrcBoot.debug = true;
    </script>
    <script src="../../../../frame/fui/js/jsboot.js"></script>

    <script>
        SrcBoot.output([
            './test/data.js', // 模拟数据
            './manage.js'
        ]);
    </script>
    <script>
        // 元件ID
        var elementID = Util.getUrlParams('elementID');

        // // 页面初始化 回传元件ID
        epoint.initPage('abcdedf', {
            elementID: elementID
        }, initCallback);

        // =====================================
        // 边框选择变化时 调整颜色可见性
        // 边框颜色
        var $borderColorEl = $('#border-color-row');

        function onBorderValueChanged(e) {
            if (e.value == 'true') {
                adjustBorderColorVisible(false);
            } else {
                adjustBorderColorVisible(true);
            }
        }

        function adjustBorderColorVisible(show) {
            if (show) {
                $borderColorEl.show();
            } else {
                $borderColorEl.hide();
            }
        }


        // =====================================
        // 是否显示标题栏变化时 调整标题相关可见性
        // 标题图片和颜色
        var $titleSettingsEl = $('#title-settings-el');

        function onShowTitleBarChanged(e) {
            if (e.value == 'true') {
                adjustTitleSettingsVisible(true)
            } else {
                adjustTitleSettingsVisible(false);
            }
        }

        function adjustTitleSettingsVisible(show) {
            if (show) {
                $titleSettingsEl.show();
            } else {
                $titleSettingsEl.hide();
            }
        }

        // =====================================
        // 工具栏按钮变化时 调整打开方式可见性
        // 更多按钮打开方式
        var $elementOpentypeEl = $('#element-opentype-el');

        function onToolbarValueChanged(e) {
            if (/more/.test(e.value)) {
                adjustMoreOpentypeVisible(true);
            } else {
                adjustMoreOpentypeVisible(false);
            }
        }

        function adjustMoreOpentypeVisible(show) {
            if (show) {
                $elementOpentypeEl.show();
            } else {
                $elementOpentypeEl.hide();
            }
        }

        // 
        // 标题图片点击 选择
        var titleImgDialog = mini.get('title-img-dialog');

        function showTitleImgList() {
            titleImgDialog.show();
        }
        // 点击选择图片
        var titleImgSelect = mini.get('title-img-select');
        $('body').on('click', '.title-img-item', function (e) {
            var $this = $(this),
                url = $this.data('src');
            titleImgSelect.setValue(url);
            titleImgSelect.setText(url);
            titleImgDialog.hide();
        });

        function saveAndClose() {
            // 约定close时传递save过去 可以触发元件拉取最新数据进行更新
            epoint.closeDialog('save');
        }

        // 使用数据初始化标题图片选择
        function initCallback(data) {
            if (data && data.imgList) {
                // 渲染标题图片
                renderTitleImgs(data.imgList)
            }

        }

        // 初始化拉取数据后 进行如下的可视化调整
        function epoint_preload(controls, custom) {
            // 根据有无边框确定是否显示边框颜色的选择
            // adjustBorderColorVisible(true/false);
            // 是否展示标题栏的相关设置
            // adjustTitleSettingsVisible(true/false);
            // 是否展示更多的打开方式
            // adjustMoreOpentypeVisible(true/false);
        }
    </script>

</body>

</html>