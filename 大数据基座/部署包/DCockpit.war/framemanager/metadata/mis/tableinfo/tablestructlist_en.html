<!DOCTYPE html>
<html>

	<head>
		<title>The data table structure</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<script src="../../../../frame/fui/js/cssboot.js"></script>
	</head>

	<body>
		<div class="page-loading"></div>

		<!-- toolbar area -->
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button" iconCls="icon-addcircle" onclick="add()">add</a>
				<a class="mini-button" iconCls="icon-save" onclick="saveAll()">save & synchronize</a>
				<a class="mini-button" iconCls="icon-minuscircle"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('Please choose to delete the record!', '', null, 'warning');} else {deleteSelected();}">delete & synchronize</a>
				<!-- <a class="mini-button" iconCls="icon-start"
				onclick="rebuildDatabase()">synchronize physical table structure</a><a class="mini-button"
				iconCls="icon-refresh" onclick="sysStruct()">get physical table structure</a> --><a
				class="mini-button" iconCls="icon-forward"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('Please select a record to be exported!', '', null, 'warning');} else {epoint.execute('tablestructlistaction.export','',exporttc)}">script export</a>
			</div>

			<input id="database" autoLoad="false"
			action="tablestructlistaction.getDsTypes" textField="text"
			valueField="id" class="mini-combobox mr10" width="80"/>

			<!--Help button -->
			<a role="helper" class="mr10">precautions</a>
		</div>

		<!-- Help information area Hidden by default-->
		<div class="fui-notice hidden">
			<p>
				The current table<em>You must set up the primary key</em>, if the database table has a primary key, do not need to set up; If not, please check here1A field as a query the primary key
			</p>
			<!-- <p>
				button<em>synchronize physical table structure:</em>When our database physical table is deleted or not, we can through good configuration structure field inversion to generate physical tables
			</p>
			<p>
				button<em>get physical table structure:</em>If the structure of our field do not agree with our real physical table, we can through thisbuttonFor differences in sync。The synchronization process is to read new physical table field、edit、deletemisThe fields in the table
			</p> -->
		</div>

		<div class="fui-condition">
			<!-- The form layout -->
			<div class="fui-form" id="fui-form">
				<div role="form">
					<!-- 2column -->
					<div role="row">
						<div role="control" label="current data table name">
							<input bind="tablestructlistaction.tableInfo.tableName"
							class="mini-outputtext" />

						</div>
						<div role="control" label="SQL data table name">
							<input bind="tablestructlistaction.tableInfo.sqlTableName"
							class="mini-outputtext" />
						</div>
					</div>
					<!-- 2column -->
					<div role="row">
						<div role="control" label="field name in Chinese">
							<input bind="tablestructlistaction.fieldChineseName"
							class="mini-textbox" />

						</div>
						<div role="control" label="field English name">
							<input bind="tablestructlistaction.fieldName" class="mini-textbox" />
						</div>
					</div>
				</div>
			</div>

			<!-- searchbutton -->
			<a role="searcher" callback="searchData"></a>

			<div id="tableid" class="mini-hidden" bind="tableInfo.tableid"></div>

		</div>
		<div class="fui-content">
			<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="fieldid" multiSelect="true"
			style="width: 100%; height: 100%;" allowCellValid="true"
			action="tablestructlistaction.getDataGridData" showFooter="false"
			allowSortColumn="false">
				<div property="columns">
					<div type="checkcolumn" width="50"></div>

					<div type="indexcolumn" headerAlign="center" width="50">
						order
					</div>

					<div field="fieldchinesename" headerAlign="center" width="100%">
						display name
						<input property="editor" class="mini-textbox"
						style="width: 99%" />
					</div>
					<div field="fieldname" width="180" headerAlign="center">
						field name
					</div>
					<div field="fieldtype" width="120" headerAlign="center">
						data type
					</div>
					<div field="fielddisplaytype" width="120" headerAlign="center">
						display type
					</div>
					<div width="60" align="center" headerAlign="center"
					renderer="onEditRenderer">
						edit
					</div>
					<div field="ordernumingrid" width="80" headerAlign="center"
					align="right" vType="maxLength:5;int;">
						roworderNo.
						<input property="editor" class="mini-textbox"
						style="width: 99%" inputStyle="text-align:right" />
					</div>
					<div type="comboboxcolumn" field="controlwidth" width="80"
					autoShowPopup="true" headerAlign="center" align="center">
						control the width
						<input autoLoad="false" data="selectItems.controlwidth"
						property="editor" class="mini-combobox" style="width: 99%" />
					</div>
					<div field="todispingrid" width="50" headerAlign="center"
					align="center">
						columntable
						<div class="mini-checkbox" property="editor"></div>
					</div>
					<div field="isquerycondition" width="50" headerAlign="center"
					align="center">
						query
						<div class="mini-checkbox" property="editor"></div>
					</div>
					<div field="uniquefield" width="50" headerAlign="center"
					align="center">
						index
						<div class="mini-checkbox" property="editor"></div>
					</div>
					<div field="isorderfield" width="50" headerAlign="center"
					align="center">
						roworderNo.
						<div class="mini-checkbox" property="editor"></div>
					</div>
					<div field="mustfill" width="50" headerAlign="center" align="center">
						mandatory
						<div class="mini-checkbox" property="editor"></div>
					</div>
					<div field="dispInAdd" width="50" headerAlign="center"
					align="center">
						page
						<div class="mini-checkbox" property="editor"></div>
					</div>
					<div field="isexportexcel" width="50" headerAlign="center"
					align="center">
						export
						<div class="mini-checkbox" property="editor"></div>
					</div>
					<div field="isforeignkey" width="50" headerAlign="center"
					align="center">
						primary key
						<div class="mini-checkbox" property="editor"></div>
					</div>
				</div>
			</div>
		</div>
		
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../../rest/resource/jsboot"></script>

		<!-- Configuration Variables -->
		<script>
			//<![CDATA[
			//Initialize thepage
			epoint.initPage("tablestructlistaction", '', initDataBase);

			var grid = mini.get("datagrid");
			grid.setFrozenStartColumn(0);
			grid.setFrozenEndColumn(6);
			
			function initDataBase(e) {
				mini.get("database").setValue("oracle");
				mini.get("database").setText("Oracle");
			}

			var selectItems = {
				'controlwidth' : [{
					id : 2,
					text : 'Double wide'
				}, {
					id : 1,
					text : 'Haploid wide'
				}]
			};

			grid.on("load", function(e) {
				var rows = e.sender.findRows();
				for (var i = 0; i < rows.length; i++) {
					grid.beginEditRow(rows[i]);
				}
			});

			// draweditbutton
			var onEditRenderer = function(e) {
				return epoint.renderCell(e, "action-icon icon-edit", "updateInfo");
			};

			// edit
			function updateInfo(fieldid) {
				epoint.openDialog('editstructure', 'framemanager/metadata/mis/tableinfo/tablestructadd?fieldID=' + fieldid, function() {
					epoint.refresh(['datagrid', 'fui-form'],'',true);
				}, {
					'width' : 1000,
					'height' : 450
				});
			}

			// new
			function add() {
				epoint.openDialog('addstructure', 'framemanager/metadata/mis/tableinfo/tablestructadd?tableID=' + mini.get("tableid").getValue(), function() {
					epoint.refresh(['datagrid', 'fui-form'],'',true);
				}, {
					'width' : 1000,
					'height' : 450
				});
			}

			// deletestructure
			function deleteSelected() {
				epoint.execute('tablestructlistaction.deleteSelected', ['datagrid', 'fui-form'], msgCallBack);
			}

			// savestructure
			function saveAll() {
				if (grid.isValid() == false) {
					var error = grid.getCellErrors()[0];
					grid.beginEditCell(error.record, error.column);
					return;
				}
				epoint.execute('tablestructlistaction.saveAll', ['datagrid', 'fui-form'], msgCallBack);
			}

			// Reconstruction of the datatable
			function rebuildDatabase() {
				epoint.execute('tablestructlistaction.rebuildDatabase', 'datagrid', msgCallBack);
			}

			// synchronousstructure
			function sysStruct() {
				epoint.execute('tablestructlistaction.sysStruct', 'datagrid', msgCallBack);
			}

			// exportsqlstatements
			function exporttc(data) {
				var combox = mini.get("database");
				epoint.openDialog(combox.getText() + 'Script export', "framemanager/metadata/mis/tableinfo/tablestructexport?tableID=" + mini.get("tableid").getValue() + "&databaseType=" + combox.getValue() + "&structID=" + data.structID, '', {
					'width' : 1000,
					'height' : 400
				});
			}

			// Back off to remind
			function msgCallBack(data) {
				if (data.msg) {
					epoint.alert(data.msg, '', function() {
						epoint.refresh(['datagrid', 'fui-form'],'',true);
					}, 'info');
				}
			}

			// tablelatticesearch
			function searchData() {
				epoint.refresh(['datagrid', 'fui-form']);
			}

			//]]>
		</script>
	</body>

</html>
