<!DOCTYPE html>
<html>

	<head>
		<title>配置管理</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<script src="../../../../frame/fui/js/cssboot.js"></script>

		<style>
			.link:hover {
				cursor: pointer;
				color: red;
				text-decoration: underline;
			}
		</style>
	</head>

	<body>
		<div class="page-loading"></div>

		<!-- toolbar区域 -->
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button" iconCls="icon-addcircle" onclick="openAdd()">新增配置</a>

				<a class="mini-button mini-btn-danger" iconCls="icon-minuscircle"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择要删除的记录!', '', null, 'warning');} else {epoint.confirm('确认要删除吗？','',deleteSelect);}">删除选中</a>
			</div>
		</div>

		<div class="fui-content">
			<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="rowguid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			allowCellValid="true" action="getDataGridData"
			showPager="true" allowCellEdit="true" allowCellSelect="true"
			editNextOnEnterKey="true" editNextRowCell="true">
				<div property="columns">
					<div type="checkcolumn" width="40"></div>

					<div type="indexcolumn" headerAlign="center" width="40">
						序
					</div>
					<div field="tasktrigname" width="100%" headerAlign="center">
						触发配置名称
					</div>
					<div width="80" headerAlign="center" align="center" renderer="onEditRenderer">
						修改
					</div>
					<div field="executetype" width="80" headerAlign="center" align="center" renderer="onExecuteTypeRenderer">
						执行方式
					</div>
					<div field="state" width="300" headerAlign="center" align="center" renderer="onStateRenderer">
						状态
					</div>
					<div width="80" headerAlign="center" align="center" renderer="onStartRenderer">
						启动
					</div>
					<div width="80" headerAlign="center" align="center" renderer="onStopRenderer">
						停止
					</div>
					<div width="80" headerAlign="center" align="center" renderer="onPauseRenderer">
						暂停
					</div>
					<div width="80" headerAlign="center" align="center" renderer="onResumeRenderer">
						恢复
					</div>
				</div>
			</div>
			<input class="mini-hidden" id="taskGuid" bind="taskGuid"/>
		</div>

		<script src="../../../../rest/resource/jsboot"></script>

		<!-- 配置变量 -->
		<script>
			//<![CDATA[
			//初始化页面
			epoint.initPage("frametasktriglistaction");

			// 执行方式取值
			function onExecuteTypeRenderer(e) {
				if (e.value == '0') {
					return '手动';
				} else {
					return '自动';
				}
			}

			// 修改
			function onEditRenderer(e) {
				return epoint.renderCell(e, "action-icon icon-edit", "openEdit");
			}

			function openEdit(id) {
				epoint.openDialog('修改配置', "framemanager/metadata/taskmanager/tasktrigger/frametasktrig?rowguid=" + id, searchData,{
					'width' : 900,
					'height' : 480
				});
			}
			

			// 执行方式取值
			function onExecuteTypeRenderer(e) {
				if (e.value == '1') {
					return '自动';
				} else {
					return '手动';
				}
			}

			// 状态
			function onStateRenderer(e) {
				return "<font style=\"color:red\">" + e.value + "</red>";
			}

			// 启动
			function onStartRenderer(e) {
				return "<a class=\"link\" onclick=\"webmethodCall('" + e.record.rowguid + "','startOperation')\">启动</a>";
			}

			// 停止
			function onStopRenderer(e) {
				return "<a class=\"link\" onclick=\"webmethodCall('" + e.record.rowguid + "','stopOperation')\">停止</a>";
			}

			// 暂停
			function onPauseRenderer(e) {
				return "<a class=\"link\" onclick=\"webmethodCall('" + e.record.rowguid + "','pauseOperation')\">暂停</a>";
			}

			// 恢复
			function onResumeRenderer(e) {
				return "<a class=\"link\" onclick=\"webmethodCall('" + e.record.rowguid + "','resumeOperation')\">恢复</a>";
			}

			function openAdd() {
				epoint.openDialog('新增配置', "framemanager/metadata/taskmanager/tasktrigger/frametasktrig?taskguid=" + mini.get("taskGuid").getValue(), searchData,
						{
					'width' : 900,
					'height' : 480
				});
			}

			function deleteSelect() {
				epoint.execute('deleteSelect', 'datagrid', msgcallback);
			}

			function webmethodCall(rowguid, method) {
				epoint.execute(method, null, [rowguid], msgcallback);
			}

			function msgcallback(data) {
				if (data && data.msg) {
					epoint.alert(data.msg, '', searchData, 'info');
				} else {
					searchData();
				}
			}

			// 表格搜索
			function searchData() {
				epoint.refresh(['datagrid'],'',true);
			}

			//]]>
		</script>

	</body>

</html>
