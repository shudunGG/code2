/*
 * @Author: chends
 * @Date: 2018-07-04 08:24:11
 * @LastEditors: chends
 * @LastEditTime: 2018-07-20 16:35:02
 * @Description: 
 */

// 全局变量处理
(function(d,b){d._graceEvent_=new Util.UserEvent;var f=b("#cover-wrap");d.createMainContentCover=Util.browsers.isIE&&window.hasObjectTag?function(){var e=document.createElement("iframe");e.width="100%";e.height="100%";e.scrolling="no";e.frameBorder=0;e.style.background="transparent";e.src="../../activexcover/activexcover.html";return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').append(e).appendTo(f)}:function(){return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').appendTo(f)};d._getData_=function(b,d){return Util.ajax({url:epoint.dealRestfulUrl(getDataUrl+"/"+b),data:d})};d.dealLinkOpen=function(b){switch(b.openType){case "tabsnav":TabsNav.addTab(b);break;case "dialog":epoint.openTopDialog(b.name,Util.getRightUrl(b.url));break;case "blank":d.open(Util.getRightUrl(b.url),b.id)}};d._ANIMATION_TIME_={slide:200};d.useWebsocket=!0===Util.getFrameSysParam("useWebsocket");d.eWebSocket=void 0;d.creatWebSocket=function(b,g,a){if(eWebSocket)a&&a();else{var c=d.EWebSocketConfig?d.EWebSocketConfig:{url:EmsgConfig.websocketUrl};c.uid=b;c.uname=g;d.EWebSocket?(eWebSocket=new EWebSocket(c),a&&a(),_graceEvent_.fire("websocketCreated")):Util.loadJs("fui/pages/ewebsocket/ewebsocket.js",function(){eWebSocket=new EWebSocket(c);a&&a();_graceEvent_.fire("websocketCreated")})}}})(this,jQuery);(function(d,b){"[object Function]"===Object.prototype.toString.call(d.EpTabsNav)?(window.TabsNav=new EpTabsNav({ifrContainer:"#main-ifr-wrap",tabContainer:"#main-tab-wrap",needScrollBtn:!1,scrollBtnSite:"sides",smoothItems:3,needQuickNav:!0,position:"bottom",tabWidth:112}),TabsNav._$pageCover=createMainContentCover()):console.error('The TabsNav is required! , please add the "fui/pages/tabsnav/tabsnav.js" before theme\'s javascript file')})(this,jQuery);(function(d,b){var f=b("#theme-bg-img"),e=function(b){b=b||mini.Cookie.get("_grace_skin_")||"default";var a="./skins/"+b+"/images/bg.png";b=new Image;b.src=a;b.onload=function(){f[0].src=a}};b(window).on("message",function(b){b=b.originalEvent;if(b.data)try{var a=JSON.parse(b.data);"skinChange"==a.type&&a.skin&&e(a.skin)}catch(c){console.error(c)}})})(this,jQuery);(function(d,b){function f(){if(!p&&(p=c.children().length,0===p))return;var b=e.width();if(0>=b)return setTimeout(f,17);b=(b-m-l-80-30)/95>>0;p>b?a.addClass("is-over").css("width",95*b):a.removeClass("is-over").css("width",95*p);k&&q.text(".top-menu-wrap.active{max-height:"+38*Math.ceil(p/b)+"px}")}var e=b("#header-main-nav"),g=b("#main"),a=b("#top-menu"),c=b(".top-menu-list",a),m=b("#top-portal").outerWidth()||120,l=b("#quick-menu").outerWidth()||80,h=document.createElement("div"),k="transition"in h.style,h=null,q=b("\x3cstyle\x3e\x3c/style\x3e").appendTo("head"),p=0,u;b(window).on("resize.topmenuadjust",function(){clearTimeout(u);u=setTimeout(f,17)});_graceEvent_.on("headerSearchLoad",f);var n=createMainContentCover();a.on("click",".top-menu-trigger",function(){a.hasClass("is-over")&&(a.hasClass("active")?(k&&a.addClass("hold-color"),a.removeClass("active"),n.addClass("hidden")):(a.addClass("active"),n.removeClass("hidden")))}).on("transitionend",function(b){b.target===this&&a.removeClass("hold-color")}).on("click",".top-menu-item",function(){var c=b(this),h=c.data("url"),d=this.getAttribute("title")||this.innerText,e=c.data("opentype"),m=c.data("hassub");c.addClass("active").siblings().removeClass("active");m?(g.removeClass("left-none"),getLefMenu({code:this.getAttribute("data-id"),name:this.getAttribute("title")||this.innerText},!0)):g.addClass("left-none");h&&dealLinkOpen({openType:e,name:d,id:c.data("id"),url:h});a.removeClass("active");n.addClass("hidden")});b("body").on("click",function(c){b(c.target).closest("#top-menu").length||(a.removeClass("active"),n.addClass("hidden"))});(function(){_getData_("getMenu",{query:"top"}).done(function(a){if(a&&a.items){var h=a.code,d="";h?b.each(a.items,function(b,c){if(c.code==h)return c.isActived=!0,d=c.name,!1}):(a.items[0].isActived=!0,h=a.items[0].code,d=a.items[0].name);b(Mustache.render('{{#items}}\x3cli class\x3d"top-menu-item l {{#isActived}}active{{/isActived}}" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" data-hassub\x3d"{{hasSub}}" title\x3d"{{name}}"\x3e{{name}}\x3c/li\x3e{{/items}}',a)).appendTo(c);_graceEvent_.fire("topMenuLoad");f();getLefMenu({code:h,name:d},!0)}})})()})(this,jQuery);(function(d,b){var f=b("#sys-logo-img"),e=b("#user-info"),g=b(".user-portrait",e),a=createMainContentCover();e.on("click",".user-info-summary",function(){e.hasClass("active")?(e.removeClass("active"),a.addClass("hidden")):(e.addClass("active"),a.removeClass("hidden"))}).on("click",".user-action-item",function(){var c=b(this);if(c.hasClass("person-info"))TabsNav.addTab({id:this.getAttribute("data-id"),name:this.getAttribute("data-name"),url:this.getAttribute("data-url")});else if(c.hasClass("logout"))mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(b){"ok"==b&&(eWebSocket&&eWebSocket.close(),UserSettins.logout())});else if(c.hasClass("role-change"))UserSettins.changeRole(_userGuid_);else{var d=c.data("opentype"),f=c.data("id"),h=c.attr("url"),g=c.text(),q=c.attr("script");f||(f=Util.uuid(),c.data("id",f).attr("data-id",f));if(h)dealLinkOpen({id:f,openType:d,name:g,url:h});else if(q)try{eval(q)}catch(p){console.error(p)}}e.removeClass("active");a.addClass("hidden")});b("body").on("click",function(c){b(c.target).closest("#user-info").length||(e.removeClass("active"),a.addClass("hidden"))});_getData_("getUserInfo").done(function(c){d._userName_=c.name;d._userGuid_=c.guid;useWebsocket&&creatWebSocket(_userGuid_,_userName_);if(c.portrait){var a=Util.getRightUrl(epoint.dealRestfulUrl(c.portrait));g.attr("src",a)}c.logo&&(/^data:/.test(c.logo)?f.attr("src",c.logo):f.attr("src",Util.getRightUrl(c.logo)));c.hasParttime&&e.find(".user-action-item.role-change").removeClass("hidden");a=b("#user-info-detail");a.find(".user-name").text(c.name).attr("title",c.name);a.find(".user-dept").text(c.ouName).attr("title",c.ouName);c.title&&(document.title=c.title,d.systemTitle=c.title);c.fullSearchUrl&&(d._fullSearchUrl_=c.fullSearchUrl);var l={closeIcon:!1,refresh:!0};b.each(c.homes,function(a,d){var h=!1;d.items&&b.each(d.items,function(b,a){if(c.defaultHome){if(a.code==c.defaultHome)return l.id=a.code||"home",l.url=a.url,l.name=a.name,h=!0,!1}else if("tabsnav"==a.openType)return l.id=a.code||"home",l.url=a.url,l.name=a.name,h=!0,!1});if(h)return!1});initPortal(c.homes,l);TabsNav.addTab(l);_graceEvent_.fire("afterPageInfo")});b(d).on("message",function(b){try{var a=JSON.parse(b.originalEvent.data);"userPortraitChange"===a.type&&g.attr("src",a.imgData)}catch(l){}});_getData_("getExtTabsInfo").done(function(a){if(a&&a.length){var c="";b.each(a,function(b,a){a.icon=a.icon||"modicon-8";/^icon-/.test(a.icon)&&(a.icon="action-icon "+a.icon);c+=Mustache.render('\x3cli class\x3d"user-action-item" title\x3d"{{name}}" url\x3d"{{url}}" data-opentype\x3d"{{openType}}" \x3e\x3cspan class\x3d"{{icon}}"\x3e\x3c/span\x3e{{name}}\x3c/li\x3e',a)});b(c).insertAfter("#person-info-setting")}})})(this,jQuery);(function(d,b){function f(a,c){var d=createMainContentCover();if(a){var f=g.find(".top-portal-cate-item:eq(0)").addClass("active");g.find('.portal-sub-list[data-cate\x3d"'+f.data("target")+'"]').removeClass("hidden").siblings().addClass("hidden");e.on("click",".top-portal-cate-item",function(){var a=b(this);a.addClass("active").siblings().removeClass("active");g.find('.portal-sub-list[data-cate\x3d"'+a.data("target")+'"]').removeClass("hidden").siblings().addClass("hidden")})}else e.on("click",".top-portal-cate-trigger, .top-portal-cate-name",function(){var a=b(this).closest(".top-portal-cate-item"),c=a.next();a.data("target")==c.data("cate")&&(a.hasClass("close")?(a.removeClass("close"),c.stop(!0).slideDown(_ANIMATION_TIME_.slide)):(a.addClass("close"),c.stop(!0).slideUp(_ANIMATION_TIME_.slide)))});e.on("click",".portal-trigger",function(){e.hasClass("active")?(e.removeClass("active"),d.addClass("hidden")):(e.addClass("active"),d.removeClass("hidden"))}).on("click",".top-portal-item",function(){var a=b(this),c=a.data("id"),f=a.data("opentype"),g=a.data("url"),a=a.attr("title");"tabsnav"==f?TabsNav.addTab({id:c,name:a,url:g}):"blank"==f&&window.open(Util.getRightUrl(g),c);e.removeClass("active");d.addClass("hidden")}).on("click",".portal-curr",function(){TabsNav.addTab(c)});b("body").on("click",function(a){b(a.target).closest("#top-portal").length||(e.removeClass("active"),d.addClass("hidden"))})}var e=b("#top-portal"),g=b(".portal-box-inner",e);d.initPortal=function(a,c){var d="",l=3<=a.length?!0:!1,h,k;l?(e.addClass("multi"),h='\x3cdiv class\x3d"portal-category-list"\x3e',k='\x3cdiv class\x3d"portal-sub-container"\x3e',b.each(a,function(b,a){h+=Mustache.render('\x3cdiv class\x3d"top-portal-cate-item" data-target\x3d"{{code}}"\x3e\x3cspan class\x3d"top-portal-cate-name"\x3e{{name}}\x3c/span\x3e\x3cspan class\x3d"top-portal-cate-trigger"\x3e\x3c/span\x3e\x3c/div\x3e',a);k+='\x3cdiv class\x3d"portal-sub-list" data-cate\x3d"'+a.code+'"\x3e';k+=Mustache.render('{{#items}}\x3cdiv class\x3d"top-portal-item" data-id\x3d"{{code}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}" data-url\x3d"{{url}}"\x3e{{name}}\x3c/div\x3e{{/items}}',a);k+="\x3c/div\x3e"}),h+="\x3c/div\x3e",k+="\x3c/div\x3e",d=h+k):b.each(a,function(b,a){d+=Mustache.render('\x3cdiv class\x3d"top-portal-cate-item" data-target\x3d"{{code}}"\x3e\x3cspan class\x3d"top-portal-cate-name"\x3e{{name}}\x3c/span\x3e\x3cspan class\x3d"top-portal-cate-trigger"\x3e\x3c/span\x3e\x3c/div\x3e',a);d+='\x3cdiv class\x3d"portal-sub-list" data-cate\x3d"'+a.code+'"\x3e';d+=Mustache.render('{{#items}}\x3cdiv class\x3d"top-portal-item" data-id\x3d"{{code}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}" data-url\x3d"{{url}}"\x3e{{name}}\x3c/div\x3e{{/items}}',a);d+="\x3c/div\x3e"});b(d).appendTo(g.empty());f(l,c);a&&1===a.length&&1===a[0].length&&e.addClass("hidden")}})(this,jQuery);(function(d,b){var f=b("#quick-menu"),e=b(".quick-menu-list",f),g=createMainContentCover();f.on("click",".quick-menu-header",function(){f.hasClass("active")?(f.removeClass("active"),g.addClass("hidden")):(f.addClass("active"),g.removeClass("hidden"))}).on("click",".quick-menu-item",function(){var a=b(this),c=a.data("opentype"),e=a.data("id"),l=this.title,a=a.data("url");"tabsnav"==c?TabsNav.addTab({id:e,name:l,url:a}):d.open(Util.getRightUrl(a),e);f.removeClass("active");g.addClass("hidden")});b("body").on("click",function(a){b(a.target).closest("#quick-menu").length||(g.addClass("hidden"),f.removeClass("active"))});_getData_("getQuickMenu").done(function(a){if(a&&a.length){var c="";b.each(a,function(b,a){c+=Mustache.render('\x3cli class\x3d"quick-menu-item" data-id\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}" data-url\x3d"{{url}}"\x3e{{name}}\x3c/li\x3e',a)});b(c).appendTo(e.empty())}else f.addClass("hidden")})})(this,jQuery);(function(d,b){function f(a,c){var d="";b.each(a,function(a,e){e.hasSub=!(!e.items||!e.items.length);e.rowkey=void 0===c?a+"":c+"-"+a;var h=e.rowkey.split("-").length;e.isTop=1===h;e.level="level-"+h;var g;g=h||e.rowkey.split("-").length;e.indent=36+13*(g-1);1===h&&(e.icon=e.icon||"modicon-1");d=e.hasSub?d+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',b.extend(e,{subMenu:f(e.items,e.rowkey)})):d+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',e)});return d}function e(a){if(k[a])return TabsNav.addTab(k[a]);var b="",c="";l.find("#left-menu-"+a).find(".left-menu-item-link").each(function(d,e){c=e.getAttribute("data-url");b=e.getAttribute("data-opentype");if(c&&"tabsnav"==b)return k[a]={id:e.getAttribute("data-id"),name:e.title,url:c},TabsNav.addTab(k[a]),!1})}var g={},a=b("#main"),c=b("#left-menu"),m=b(".left-nav-trigger",c),l=b(".left-nav-container",c),h;(function(){function d(a){localStorage.setItem("_grace_leftmenu_state_",a)}var e=localStorage.getItem("_grace_leftmenu_state_")||"normal";a["normal"==e?"removeClass":"addClass"]("left-narrow");var f=Util.browsers.isIE8||Util.browsers.isIE9,g=createMainContentCover();b(".left-nav-trigger").on("click",function(){a.hasClass("left-narrow")?(d(e="normal"),a.removeClass("left-narrow"),g.addClass("hidden")):(d(e="narrow"),a.addClass("left-narrow"),h&&(h.find(".left-menu-item.level-1.opened").length?g.removeClass("hidden"):c.trigger("hide-trans")))});c.on("hide-trans",function(){!f&&c.addClass("hide-trans")}).on("transitionend",function(a){a.target===this&&c.removeClass("hide-trans")}).on("click",".left-menu-link",function(){var a=b(this),d=a.parent(),f=d.hasClass("level-1"),l=a.data("hassub"),k={url:a.data("url"),openType:a.data("opentype"),name:this.title,id:a.data("id")},m="narrow"===e;l?(a=f?a.next().find(".left-menu-sub-list:eq(0)"):a.next(),d.hasClass("opened")?(d.removeClass("opened"),a.stop(!0).slideUp(_ANIMATION_TIME_.slide),f&&m&&g.addClass("hidden")):(d.addClass("opened"),f&&m&&g.removeClass("hidden"),a.stop(!0).slideDown(_ANIMATION_TIME_.slide),d.siblings(".opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").stop(!0).slideUp(_ANIMATION_TIME_.slide))):k.url&&(dealLinkOpen(k),m&&(h.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp(_ANIMATION_TIME_.slide),g.addClass("hidden"),c.removeClass("has-opened")));if(f&&m)c[h.find(".left-menu-item.level-1.opened").length?"addClass":"removeClass"]("has-opened")});b("body").on("click",function(a){b(a.target).closest("#left-menu").length||(g.addClass("hidden"),"narrow"===e&&h&&h.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp())})})();d.getLefMenu=function(a,d){var k=a.code;if(!g[k]||"reject"===g[k])return _getData_("getMenu",{query:"sub",code:k}).done(function(n){n&&n.length&&(n=f(n),h=b(Mustache.render('\x3cdiv class\x3d"left-menu-wrap" id\x3d"left-menu-{{code}}"\x3e\x3cdiv class\x3d"left-menu-header"\x3e{{name}}\x3c/div\x3e\x3cul class\x3d"left-menu-list"\x3e{{{leftMenuItems}}}\x3c/ul\x3e\x3c/div\x3e',{code:a.code,name:a.name,leftMenuItems:n})),h.appendTo(l).siblings(".left-menu-wrap").addClass("hidden"),Util.browsers.isIE8&&h.find(".left-menu-list").height(c.height()-m.height()||36));g[k]="resolve";d&&e(k+"")}).fail(function(){g[k]="reject"});"resolve"===g[k]&&(h=b("#left-menu-"+k),h.removeClass("hidden").siblings(".left-menu-wrap").addClass("hidden"),d&&e(k))};var k={}})(this,jQuery);window.OpenEMsg=function(d,b,f){window.eMsg?"undefined"===typeof b?eMsg.open(d):eMsg.openSession(d,b,f):creatWebSocket(_userGuid_,_userName_,function(){eWebSocket.openEmsg(d,b,f)})};(function(d,b){function f(){ThemeSelection._styleLoaded=!0;a=new ThemeSelection({getThemesUrl:getThemesUrl,saveThemeUrl:saveThemeUrl,showCallback:function(){g.removeClass("hidden")},hideCallback:function(){e.removeClass("active");g.addClass("hidden")}});window.themeSelection=a;e.on("click",function(){e.hasClass("active")?(e.removeClass("active"),a.hide()):(a.show(),e.addClass("active"))});b("body").on("click",function(c){b(c.target).closest(".theme-selection-container, #theme-skin-switch").length||(e.removeClass("active"),a.hide())})}var e=b("#theme-skin-switch"),g=createMainContentCover(),a;window.ThemeSelection?f():Util.loadJs("fui/pages/themeselection/themeselection.js",f)})(this,jQuery);(function(d,b){function f(){D=new MessageList({container:F,getUrl:epoint.dealRestfulUrl(getDataUrl+"/getMsgData"),ignoreUrl:epoint.dealRestfulUrl(getDataUrl+"/ignoreRemind"),afterOpenMsg:function(){g()},afterIgnore:function(){w()}})}function e(){x=new EMsgList({content:B,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:function(){g()},onDecEmsgCount:G});d.RefreshEMsg=b.proxy(x.getData,x)}function g(){z.addClass("hidden");r.stop(!0).animate({right:-350},function(){r.addClass("hidden")});u.find("[data-ref].active").removeClass("active")}var a="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",c=0,m="",l={roll:function(){m=d.systemTitle||document.title;document.title=a;clearTimeout(c);c=setTimeout(function H(){document.title=a.substring(1,a.length)+a.substring(0,1);a=document.title;c=setTimeout(H,300)},300)},stop:function(){clearTimeout(c);document.title=m||document.title;a="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}},h=b("#msg-sound"),k,q;Util.browsers.isIE?k=b('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden" id\x3d"msgcenter-sound"\x3e\x3c/iframe\x3e').appendTo(h):(h.html('\x3caudio id\x3d"msgcenter-sound-audio" controls\x3d"controls" src\x3d"../../msgsound/newsms.wav" class\x3d"hidden-accessible"\x3e\x3c/audio\x3e'),q=document.getElementById("msgcenter-sound-audio"));var p=function(a){a=parseInt(a,10);return 99<a?"99+":0>=a?"":a+""},u=b("#header-action-btns"),n=b(".remind-num",u),t=b(".emsg-num",u),r=b("#msg-panel"),h=b("#msgRemind",r),F=b(".msg-panel-content",h),h=b("#msgEMsg",r),A=b(".msg-panel-content",h),B=b(".emsg-recent-list",A),C=b(".online-user-num",h),I=document.getElementById("online-user"),v=b("#new-remind-wrap"),y={show:function(){RemindTipsCfg.show&&(v.removeClass("hidden"),this.autoHide())},autoHide:function(){return 0!=RemindTipsCfg.timeout?function(){clearTimeout(y.timer);y.timer=setTimeout(function(){v.addClass("hidden")},RemindTipsCfg.timeout)}:function(){}}(),initEvent:function(){if(RemindTipsCfg.show)v.on("click",".icon, .text",function(){v.addClass("hidden")}).on("click",".close",function(a){a.stopPropagation();v.addClass("hidden")})}};y.initEvent();var w=function(a){var b={haseXun:!0,needNum:!0};a&&(b.inCache=!0);return _getData_("getMsgCount",b).done(function(a){E(a)})},E=function(a){var b=0,c=!1;a.remind?(b=parseInt(n.data("num"),10)||0,a.remind>b&&(c=!0,y.show()),n.removeClass("hidden").text(p(a.remind)),n.data("num",a.remind)):n.text("").addClass("hidden");a.eXun?(b=parseInt(t.data("num"),10)||0,a.eXun>b&&(c=!0),t.removeClass("hidden").text(p(a.eXun)),t.data("num",a.eXun)):t.text("").addClass("hidden");if(c){if(!1!==Util.getFrameSysParam("messageSound"))if(Util.browsers.isIE)k[0].src=Util.getRightUrl("../../msgsound/sound.html?_\x3d"+ +new Date);else try{q&&q.play()["catch"](function(){var a=new window.SpeechSynthesisUtterance;a.text="\u60a8\u6709\u65b0\u77ed\u6d88\u606f\uff0c\u8bf7\u6ce8\u610f\u67e5\u6536\uff01";window.speechSynthesis.speak(a)})}catch(J){}l.roll()}else l.stop()};_graceEvent_.on("afterPageInfo",function(){w();useWebsocket||setInterval(function(){w(!0)},6E4)});if(useWebsocket)_graceEvent_.on("websocketCreated",function(){eWebSocket.socketEvent.on("messagecount",function(a){E(a.data)})});d.getMessageCount=w;var D;d.MessageList?f():Util.loadJs("../../messagelist/messagelist.js",function(){f()});var G=function(){var a=t.text();a&&(a=parseInt(a,10)-1);0==a&&(a="",t.data("num",0).addClass("hidden"));t.text(a)},x;d.EMsgList?e():Util.loadJs("../../emsglist/emsglist.js",function(){e()});d.OnlineUserSettings&&d.OnlineUserSettings.show&&(h.find(".msg-panel-head").addClass("tab").find(".panel-hd-tab.hidden").removeClass("hidden"),I.src=OnlineUserSettings.url,h.on("click",".panel-hd-tab",function(){var a=b(this),c=a.data("ref"),d=a.data("hasShow"),e=B;a.hasClass("active")||(a.addClass("active").siblings().removeClass("active"),c&&(e=b("#"+c,A),d||setTimeout(function(){OnlineUserSettings.onRefreshData(function(a){C.html(a)});a.data("hasShow",!0)},500)),e.removeClass("hidden").siblings().addClass("hidden"))}));d.hideMessagePanel=g;var z=createMainContentCover();u.on("click","[data-ref]",function(){var a=b(this),c=a.data("ref"),e=b("#"+c,r);if(a.hasClass("active"))g(),z.addClass("hidden");else{a.addClass("active").siblings(".active").removeClass("active");if("msgRemind"==c)D.getData();else if("msgEMsg"==c){if(x.getData(),d.OnlineUserSettings&&d.OnlineUserSettings.show)OnlineUserSettings.onRefreshData(function(a){C.html(a)})}else"msgSkin"==c&&d.initSkinView&&d.initSkinView();e.removeClass("hidden").siblings(".msg-panel-detail").addClass("hidden");e.find(".msg-panel-content").removeClass("hidden");r.removeClass("hidden");r.stop(!0).animate({right:0});z.removeClass("hidden")}});r.on("click",".msg-panel-hide",function(){g()});b("body").on("click",function(a){b(a.target).closest("#msg-panel , .header-action-btn[data-ref]").length||hideMessagePanel()})})(this,jQuery);(function(d,b){function f(){return Util.ajax({url:d.fullSearchCateUrl}).done(function(a){e(a.categories)})}function e(c){c=c||[];"string"==typeof c&&(c=JSON.parse(c));var e=[];b.each(c,function(a,b){e.push({id:b.guid,name:b.name,iconCls:b.icon||"view"})});e.length||e.push({id:"all",name:"\u5168\u6587\u68c0\u7d22",iconCls:"modicon-25"});ClassifySearch._styleLoaded=!0;ClassifySearch._$pageCover=createMainContentCover();new ClassifySearch({id:"header-search",searchTarget:"\u5185\u5bb9",category:e,placeholder:"\u8bf7\u8f93\u5165",maxShowCharacter:5,enter:function(a,b){var c;c=a||"all";try{TabsNav.removeTab("fullsearch")}catch(q){}TabsNav.addTab({id:"fullsearch",name:"\u5168\u6587\u68c0\u7d22",url:d._fullSearchUrl_+"?wd\x3d"+d.encodeURI(b)+"\x26type\x3d"+c})}});setTimeout(function(){a.removeClass("invisible")},200)}var g=b(".header-container"),a=b("#top-search").addClass("invisible");_graceEvent_.on("afterPageInfo",function(){d._fullSearchUrl_?(f(),g.addClass("has-search")):g.removeClass("has-search");_graceEvent_.fire("headerSearchLoad")})})(this,jQuery);(function(d,b){function f(){if(l)try{l.abort()}catch(q){}var b=e();b.join("")!==h?l=Util.ajax({url:topMenuSaveUrl,data:{sort:JSON.stringify(b)}}).done(function(){mini.showTips({content:"\u4fdd\u5b58\u6210\u529f",state:"success",x:"center",y:"center",timeout:3E3});h=e().join("")}):mini.showTips({content:"\u6392\u5e8f\u672a\u66f4\u6539",state:"info",x:"center",y:"center",timeout:3E3});a.removeClass("active in-sort");g.addClass("hidden")}function e(){return c.sortable("toArray",{attribute:"data-id"})}if(1==Util.getFrameSysParam("enableCustomSort")){var g=createMainContentCover(),a=b("#top-menu"),c=a.find(".top-menu-list");c.sortable({revert:200,delay:300,distance:30,forcePlaceholderSize:!0,containment:"parent",update:function(){clearTimeout(m);m=setTimeout(f,1E3)},stop:function(){clearTimeout(m);m=setTimeout(f,1E3)},sort:function(){clearTimeout(m)},start:function(){clearTimeout(m);g.removeClass("hidden");a.addClass("active in-sort")}});var m,l,h;_graceEvent_.on("topMenuLoad",function(){h=e().join("")})}})(this,jQuery);