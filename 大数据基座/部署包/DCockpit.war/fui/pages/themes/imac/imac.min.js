/* jshint -W030 */
// 分屏页码模板
var SCREEN_PAGE_TPL='\x3ca href\x3d"javascript:void(0);" data-page\x3d"{{page}}" class\x3d"page-item l mr10"\x3e\x3cspan\x3e{{pageNum}}\x3c/span\x3e\x3c/a\x3e',SCREEN_TPL='\x3cdiv class\x3d"imac-screen l" title\x3d"\u7b2c{{page}}\u5206\u5c4f"\x3e\x3c/div\x3e',SCREEN_APP_TPL='\x3cdiv class\x3d"app-item trans" title\x3d"{{name}}" style\x3d"top:{{top}}px;left:{{left}}px"data-id\x3d"{{id}}"\x3e{{#count}}\x3cspan class\x3d"unread"\x3e{{count}}\x3c/span\x3e{{/count}}\x3cimg src\x3d"{{icon}}" alt\x3d"" class\x3d"app-icon"\x3e\x3cp class\x3d"app-name"\x3e{{name}}\x3c/p\x3e\x3c/div\x3e',TASK_ITEM_TPL='\x3ca href\x3d"javascript:void(0);" data-id\x3d"{{id}}" class\x3d"task-item l clearfix" title\x3d"{{name}}"\x3e\x3cimg src\x3d"{{icon}}" alt\x3d"" class\x3d"l task-icon"\x3e\x3cp class\x3d"task-name l"\x3e{{name}}\x3c/p\x3e\x3c/a\x3e',DOCK_APP_TPL='\x3cdiv class\x3d"dock-app" data-id\x3d"{{id}}" title\x3d"{{name}}"\x3e{{#count}}\x3cspan class\x3d"unread"\x3e{{count}}\x3c/span\x3e{{/count}}\x3cimg src\x3d"{{icon}}" alt\x3d"" \x3e\x3cp class\x3d"name"\x3e{{{sname}}}\x3c/p\x3e\x3c/div\x3e',IMAC_ELEM_TPL='\x3cdiv class\x3d"epdialog imac-elem {{#noBorder}}no-border{{/noBorder}} hidden-accessible" data-id\x3d"{{id}}"\x3e\x3cdiv class\x3d"epdialog-hd clearfix"\x3e\x3ch4 class\x3d"epdialog-title l"\x3e{{name}}\x3c/h4\x3e\x3cdiv class\x3d"epdialog-hd-btns clearfix r"\x3e{{#btns}}\x3ca href\x3d"javascript:void(0);" btn-role\x3d"{{role}}" class\x3d"epdialog-hd-btn {{role}} l" title\x3d"{{title}}"\x3e\x3c/a\x3e{{/btns}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"epdialog-bd"\x3e\x3ciframe src\x3d"{{url}}" frameborder\x3d"0" scrolling\x3d"no" width\x3d"100%" height\x3d"100%"\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e';(function(g,a){var d=a("#imac-skin-bg");a.extend(Util,{setIMacSkinBg:function(a){d[0].src=a},getAppShortName:function(a){a=a.substr(0,2);return a[0]+"\x26nbsp;"+a[1]},fixPath:function(c){var f=a.extend({},c);f.url=Util.getRightUrl(c.url);f.icon=Util.getRightUrl(c.icon);return f},switchIcon:function(a,f){var c=a.icon,d=c.lastIndexOf("."),g=c.substr(d),c=c.substring(0,d),d="";"taskbar"==f?d=a.hasTaskbarIcon?c+"-taskbar"+g:a.icon:"toolbar"==f&&(d=a.hasToolbarIcon?c+"-toolbar"+g:a.icon);return d},highlightApp:function(a){var c=function(){a.animate({opacity:.3},200,g)},d=function(){a.animate({opacity:1},200,g)},g=function(){a.queue("highlight").length?a.dequeue("highlight"):a.clearQueue("highlight")};a.queue("highlight",[c,d,c,d,c,d,c,d]);g()},configAppCmOpers:function(a,d){!1!==d.uninstallable?a.enableItem("uninstall-app"):a.disableItem("uninstall-app");!1!==d.movable?a.enableItem("move-app"):a.disableItem("move-app");!1!==d.openable?a.enableItem("open-app"):a.disableItem("open-app")}});EpDialog.setMaxCoord({top:50,left:0,right:50,bottom:50})})(this,jQuery);(function(g,a){var d=function(a){var k=a.linkedApp;a.url=Util.getRightUrl(a.url);a.cfgUrl&&(a.cfgUrl=Util.getRightUrl(a.cfgUrl));k&&(k.icon=Util.getRootPath()+k.icon,k.url=Util.getRightUrl(k.url))},c=Mustache,f={id:"",name:"",width:800,height:500,minWidth:200,minHeight:200,top:65,left:25,url:"",page:0,btns:[],linkedApp:!1,noBorder:!0,closable:!0,draggable:!0,resizable:!0},p={refresh:function(){this.refresh()}},r=a.trim(IMAC_ELEM_TPL);g.IMacElem=function(k){this.cfg=a.extend(!0,{},f,k);this._init()};IMacElem.prototype={constructor:IMacElem,_init:function(){this._initConfig();this._initView();this._initEvent()},_initConfig:function(){var a=this.cfg;a.options={};a.btns.push({role:"refresh",title:"\u5237\u65b0"});a.cfgUrl&&a.btns.push({role:"config",title:"\u6253\u5f00\u914d\u7f6e",click:function(){(new EpDialog({title:"\u8be6\u7ec6\u914d\u7f6e",width:600,height:500,draggable:!0,resizable:!0,url:a.cfgUrl,btns:[{role:"close",title:"\u5173\u95ed",click:function(a){ElemMgr.getElem(a.id).refresh();this.hide().destroy();return!1}}]})).setOptions("id",a.id).show(1,1)}});a.closable&&a.btns.push({role:"close",title:"\u5378\u8f7d\u5143\u4ef6",click:function(){mini.confirm("\u60a8\u786e\u5b9a\u5378\u8f7d\u5143\u4ef6\u3010"+a.name+"\u3011\u5417\uff1f\u5378\u8f7d\u540e\uff0c\u53ef\u4ece\u5e94\u7528\u4ed3\u5e93\u4e2d\u518d\u6b21\u6dfb\u52a0\u5230\u684c\u9762\u3002","\u7cfb\u7edf\u63d0\u793a",function(k){"ok"==k&&ElemMgr.getElem(a.id).uninstall()})}});a.width&&a.height||(a.isFullView=!0,a.draggable=!1,a.resizable=!1)},_getFullViewInfo:function(){var a=Util.getWinSize();return{top:75,left:25,width:a.width-25-75,height:a.height-75-75}},_initView:function(){var k=this.cfg,h=ImacScreen.getScreen(k.page),h=a(c.render(r,k)).appendTo(h);a.extend(this,{$widget:h,$iframe:a("iframe",h),$title:a(".epdialog-title",h),$hd:a(".epdialog-hd",h)});k.hd_h=this.$hd.height();k.noBorder||h.css("border-color",this.$hd.css("background-color"));k.linkedApp&&this.$title.attr("title","\u6253\u5f00\u5173\u8054\u5e94\u7528\u3010"+k.linkedApp.name+"\u3011").addClass("title-link")},_initEvent:function(){var k=this.cfg,h=this,b={},c=this.$widget;a.each(k.btns,function(a,e){b[e.role]=e.click});if(k.linkedApp)c.on("click",".epdialog-title",function(a){a=k.linkedApp.id;AppMgr.getAppData(a)||AppMgr.cacheAppData(a,k.linkedApp);AppMgr.openApp(a)});k.draggable&&c.draggable({handle:".epdialog-hd",containment:"body",start:function(){h.$widget.css("z-index",Util.getZIndex())},stop:function(a,b){h._sendElemUpdate({id:k.id,left:b.position.left,top:b.position.top},"update-elem-pos")}});k.resizable&&c.resizable({containment:"body",minWidth:k.minWidth,minHeight:k.minHeight,resize:function(a,b){h.setSize(b.size)},stop:function(a,b){h._sendElemUpdate({id:k.id,width:b.size.width,height:b.size.height},"update-elem-size")}});if(k.isFullView)a(g).on("resize",function(){var a=h._getFullViewInfo();h.setSize(a)});c.on("click","[btn-role]",function(){var c=this.getAttribute("btn-role"),e;b[c]&&(e=a.proxy(b[c],h,k.options,this)());p[c]&&!1!==e&&a.proxy(p[c],h,this)()});Util.browsers.isIE8&&this.__fixIE8HeadHover()},__fixIE8HeadHover:function(){var c=this.$hd,h,b="";c.css("position","relative");c=a("\x3cp\x3e\x3c/p\x3e").appendTo(c).css({position:"absolute",top:0,left:0,zIndex:-1,lineHeight:"32px",fontSize:18,cursor:"move",color:"transparent",width:"9999em",height:c.height()});for(h=0;50>h;h++)b+="______________";c.html(b)},_sendElemUpdate:function(c,h){var b=a.extend(c,{query:h});Util.ajax({url:g.updateElemUrl,data:b,success:Util.noop,error:Util._ajaxErr})},uninstall:function(){var a=this.cfg,c=this;Util.ajax({url:g.updateElemUrl,data:{id:a.id,query:"uninstall-elem"},success:function(){c.$widget.fadeOut(300,function(){c.destroy();ElemMgr.delElem(a.id)})},error:Util._ajaxErr})},setSize:function(a){this.$widget.css({width:a.width,height:a.height});return this},show:function(){var c=this.$widget;if(this.isHidden()){var h=this.cfg,b=Util.getZIndex(),d;h.isFullView&&(d=this._getFullViewInfo(),a.extend(h,d));c.css({zIndex:b,position:"absolute",top:h.top,left:h.left,height:0,width:0}).removeClass("hidden-accessible");c.animate({height:h.height,width:h.width},600);return this}},isHidden:function(){return this.$widget.hasClass("hidden-accessible")},hide:function(){this.$widget.addClass("hidden-accessible");return this},refresh:function(){this.$iframe[0].contentWindow.location.reload();return this},setOptions:function(a,c){this.cfg.options[a]=c;return this},setUrl:function(a){a+=(-1!=a.indexOf("?")?"\x26":"?")+"refresh_timestamp\x3d"+Util.uuid(8,16);this.$iframe[0].src=a;return this},setTitle:function(a){this.$title[0].innerHTML=a;return this},destroy:function(){var a=this.cfg,c=this.$widget,b=this.$iframe;a.draggable&&c.draggable("destroy");a.resizable&&c.resizable("destroy");c.off("click");b.attr("src","").remove();c.remove();this.cfg=this.$hd=this.$title=this.$iframe=this.$widget=null}};var q=function(c){a.each(c,function(a,b){d(b);ElemMgr.cacheElem(b.id,(new IMacElem(b)).show())})},n={};g.ElemMgr={cacheElem:function(a,c){n[a]=c},getElem:function(a){return(a=n[a])?a:!1},delElem:function(a){n[a]=null},installElem:function(a){var c=ImacScreen.getActivePage();Util.ajax({url:g.updateElemUrl,data:{query:"install-elem",page:c,id:a},success:function(a){a&&(d(a),a.page=c,ElemMgr.cacheElem(a.id,(new IMacElem(a)).show()),mini.showMessageBox({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u5143\u4ef6\u3010"+a.name+"\u3011\u5b89\u88c5\u6210\u529f\uff01",buttons:["ok"],iconCls:"mini-messagebox-info"}))},error:Util._ajaxErr})},getIMacElems:function(){Util.ajax({url:g.elementsUrl,data:{query:"imac-elements"},success:function(a){a&&a.length&&q(a)},error:Util._ajaxErr})}}})(this,jQuery);(function(g,a){var d=a("#imac-right-bar"),c=function(){var c=a("body").height()-50;d.css("height",c)};a(g).on("resize",c);c()})(this,jQuery);(function(g,a){var d=a("#imac-screen-pages");a(".pages-wrap",d);var c=a(".page-list",d),f=a(".scroll-l",d),p=a(".scroll-r",d),r=a("#imac-screens-container"),q=a(".screen-list"),n=Mustache,k=a.trim(SCREEN_PAGE_TPL),h=a.trim(SCREEN_TPL),b=a.trim(SCREEN_APP_TPL),l=0;g.PAGE_NUM=5;var t=DEFAULT_ACTIVE_PAGE-1,e=APP_COUNT_PER_COLUMN,u={};g.AppMgr={cacheAppData:function(m,b){u[m]=a.extend({},b)},deleteAppData:function(a){u[a]=null},getAppData:function(m){return(m=u[m])?a.extend({},m):!1},screenToToolbar:function(a){QuickApps.isFull()||(ImacScreen.removeApp(a),QuickApps.addApp(a),AppMgr.sendAppUpdate(a,"screen-to-toolbar"))},moveToScreen:function(a,b,c){"screen"==c?ImacScreen.removeApp(a):"toolbar"==c&&QuickApps.removeApp(a);ImacScreen.addApp(a,b);AppMgr.sendAppUpdate(a,c+"-to-screen")},uninstallApp:function(a,b){"screen"==b?ImacScreen.removeApp(a):"toolbar"==b&&QuickApps.removeApp(a);TaskBar.removeTask(a);AppMgr.sendAppUpdate(a,"uninstall-app");AppMgr.deleteAppData(a)},installApp:function(a){var b=ImacScreen.getScreen(t).find(".app-item").length;a.index=b;a.page=t;AppMgr.cacheAppData(a.id,Util.fixPath(a));ImacScreen.addApp(a.id,t);mini.showMessageBox({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u5e94\u7528\u3010"+a.name+"\u3011\u5b89\u88c5\u6210\u529f\uff01",buttons:["ok"],iconCls:"mini-messagebox-info"});this.sendAppUpdate(a,"install-app")},sendAppUpdate:function(b,c){var m=a.isPlainObject(b)?b:AppMgr.getAppData(b),m=a.extend({},m,{query:c});Util.ajax({url:g.updateAppUrl,data:m,success:Util.noop,error:Util._ajaxErr})},openApp:function(a){var b=AppMgr.getAppData(a);b.isBlank?g.open(b.url):TaskBar.addOrActiveTask(a)},getApp:function(a){var b=ImacScreen.getApp(a);a=QuickApps.getApp(a);a.length&&(b=a);return b},updateAppReminder:function(b){Util.ajax({url:g.updateAppUrl,data:{query:"update-app-reminder",id:b},success:function(c){c=c.count;var m=AppMgr.getApp(b),e=m.find(".unread");0>=c?e.remove():(e.length||(e=a('\x3cspan class\x3d"unread"\x3e\x3c/span\x3e'),e.appendTo(m)),e.html(99<=c?99:c))},error:Util._ajaxErr})}};g.ImacScreen={getActivePage:function(){return t},getApp:function(a){return r.find('[data-id\x3d"'+a+'"]')},getScreen:function(a){return r.find(".imac-screen").eq(a)},addApp:function(c,e,d){var m=this.getScreen(e),l=AppMgr.getAppData(c),y;void 0===d&&(d=m.find(".app-item").length);y=v(d);a.extend(l,{index:d,page:e});$app=a(n.render(b,l));$app.appendTo(m).css(y);Util.highlightApp($app);AppMgr.cacheAppData(c,l);AppDragMgr.enableScreenApp(c)},removeApp:function(a){var b=this.getApp(a);a=AppMgr.getAppData(a);b.addClass("hidden");ImacScreen.adjustAppsPosFromIndex(a.page,a.index+1,1);AppDragMgr.destroy(b);b.remove()},getAppByIndex:function(b,c){var m=!1;this.getScreen(b).find(".app-item").each(function(b,e){var d=a(e).data("id");if(AppMgr.getAppData(d).index==c)return m=a(e),!1});return m},getAppIndexByPos:function(a){var b;a.top>145*(e-1)+117.5?b=-1:(b=Math.round((a.left-25)/145),a=Math.round((a.top-65)/145),b=b*APP_COUNT_PER_COLUMN+a);return b},adjustAppPosByIndex:function(a,b){var c=AppMgr.getAppData(a),e=v(b),m=ImacScreen.getApp(a);Util.browsers.isIE8||Util.browsers.isIE9?m.stop(!0).animate(e,200):m.css(e);c.index!=b&&(c.index=b,AppMgr.cacheAppData(a,c),AppMgr.sendAppUpdate(a,"update-app-index"))},adjustAppsPosFromIndex:function(b,c,e){for(var m=ImacScreen.getScreen(b).find(".app-item").length,d,l,h,f,g=[];c<m;c++)g.push(ImacScreen.getAppByIndex(b,c));a.each(g,function(a,b){h=b.data("id");l=AppMgr.getAppData(h);f=e?l.index-1:l.index+1;d=v(f);b.css(d);l.index=f;AppMgr.cacheAppData(h,l);AppMgr.sendAppUpdate(h,"update-app-index")})}};var z=function(){var a=r.find(".imac-screen"),b=Util.getBdSize(),c=t*b.width;r.add(a).css(b);q.css("margin-left",-c)},A=function(b){var e=[],m=b.length;a.each(b,function(a,b){e.push(n.render(k,{page:a,pageNum:a+1}))});5<m&&(p.add(f).removeClass("invisible"),l=44*m,PAGE_NUM=m);c.html(e.join(""))},B=function(b){var c=[];a.each(b,function(a,b){c.push(n.render(h,{page:a+1}))});q.html(c.join(""))},v=function(a){var b=Util.toInt(a/e);a=Util.toInt(a%e);return{left:25+145*b,top:65+145*a}},C=function(c,e){var d=null,m=[];e.length&&(d=q.find(".imac-screen").eq(c),a.each(e,function(e,d){d=Util.fixPath(d);var l=v(e),l=a.extend({},d,l);d.page=c;d.index=e;AppMgr.cacheAppData(d.id,d);m.push(n.render(b,l))}),d.html(m.join("")))},D=function(b){a.each(b,function(a,b){C(a,b)})},x=function(b){var e=b*a("body").width();c.find(".page-item").eq(b).addClass("active").siblings().removeClass("active");q.stop(!0).animate({marginLeft:-e},200);w.enableItem("page-"+t).disableItem("page-"+b);t=b;var e=0,d=Util.toInt(2.5),l=PAGE_NUM-1;b+d<=l&&0<=b-d?e=b-d:0>b-d?e=0:b+d>l&&(e=PAGE_NUM-5);c.stop(!0).animate({marginLeft:44*-e},300)};d.on("click",".scroll-r",function(a){a=Math.abs(Util.toInt(c.css("margin-left")));var b=l-a-210-20,e=0;-10!=b&&(210<=b?e=a+210+10:210>b&&(e=a+b+10),c.stop(!0).animate({marginLeft:-e},300))}).on("click",".scroll-l",function(a){a=Math.abs(Util.toInt(c.css("margin-left")));delta=a-10;dis=0;-10!=delta&&(210>delta?dis=0:210<=delta&&(dis=a-220),c.stop(!0).animate({marginLeft:-dis},300))}).on("click",".page-item",function(b){b=a(this);var c=Util.toInt(a(this).data("page"));b.hasClass("active")||x(c)});g.AppCmFuncs={moveToScreen:function(a,b){AppMgr.moveToScreen(a.id,b.page,a.from)},screenToToolbar:function(a){AppMgr.screenToToolbar(a.id)},uninstallApp:function(a){mini.confirm("\u60a8\u786e\u5b9a\u5378\u8f7d\u8be5\u5e94\u7528\u5417\uff1f\u5378\u8f7d\u540e\uff0c\u53ef\u4ece\u5e94\u7528\u4ed3\u5e93\u4e2d\u518d\u6b21\u6dfb\u52a0\u5230\u684c\u9762\u3002","\u7cfb\u7edf\u63d0\u793a",function(b){"ok"==b&&AppMgr.uninstallApp(a.id,a.from)})},openApp:function(a){AppMgr.openApp(a.id)}};var w=function(){var a=[],b,c=[],e=AppCmFuncs;a.push({text:"\u6253\u5f00\u5e94\u7528",role:"open-app",click:e.openApp});a.push("sep");c.push({text:"\u53f3\u4fa7\u5de5\u5177\u680f",click:e.screenToToolbar});c.push("sep");for(b=1;b<=PAGE_NUM;b++)c.push({text:"\u667a\u6167\u684c\u9762"+b,role:"page-"+(b-1),page:b-1,click:e.moveToScreen});a.push({text:"\u79fb\u52a8\u5e94\u7528\u5230",role:"move-app",items:c});a.push({text:"\u5378\u8f7d\u5e94\u7528",role:"uninstall-app",click:e.uninstallApp});return(new EpContextMenu({items:a})).setOptions("from","screen")}();a(document).on("keydown",function(a){a=a.which;var b;37==a?b=t-1:39==a&&(b=t+1);void 0!==b&&(a=b,0>b?a=0:b>PAGE_NUM-1&&(a=PAGE_NUM-1),x(a))});a(g).on("resize",z);r.on("click",".app-item",function(b){b=a(this).data("id");AppMgr.openApp(b)}).on("contextmenu",".app-item",function(b){var c=a(this).data("id"),e=AppMgr.getAppData(c);w.setOptions("id",c).show({x:b.pageX,y:b.pageY});Util.configAppCmOpers(w,e);return!1});(function(){Util.ajax({url:g.screenAppsUrl,data:{query:"screen-apps"},success:function(a){a&&(A(a),B(a),D(a),AppDragMgr.enableAllScreenApps(),z(),x(t),setTimeout(function(){ElemMgr.getIMacElems()},500))},error:Util._ajaxErr})})()})(this,jQuery);(function(g,a){var d=a("#imac-screens-container"),c=a("#imac-right-bar .quick-apps"),f=a(".app-list",c),p=a(".list-wrap",c),r={containment:"parent",scroll:!1,opacity:.5,distance:10,start:function(){a(this).removeClass("trans").addClass("app-drag-zindex")},stop:function(c,d){var h=a(this),b=h.data("id"),l=AppMgr.getAppData(b),f;f=h.parent().find(".app-item").length;var e=ImacScreen.getAppIndexByPos(d.offset);h.addClass("trans").removeClass("app-drag-zindex");h=d.offset;180>=a(window).width()-h.left?QuickApps.isFull()?ImacScreen.adjustAppPosByIndex(b,l.index):(ImacScreen.removeApp(b),QuickApps.addApp(b),AppMgr.sendAppUpdate(b,"screen-to-toolbar")):-1==e||e+1>f||e==l.index?ImacScreen.adjustAppPosByIndex(b,l.index):(f=ImacScreen.getAppByIndex(ImacScreen.getActivePage(),e),ImacScreen.adjustAppPosByIndex(b,e),ImacScreen.adjustAppPosByIndex(f.data("id"),l.index))}},q={containment:"body",scroll:!1,opacity:.5,distance:10,start:function(c,d){p.css("overflow","visible");a(this).addClass("app-drag-zindex")},stop:function(c,d){p.css("overflow","hidden");var f=a(this),b=f.data("id"),l=ImacScreen.getActivePage(),g=Math.abs(Util.toInt(d.position.left)),e=ImacScreen.getScreen(l).find(".app-item").length,u=ImacScreen.getAppIndexByPos(d.offset);f.removeClass("app-drag-zindex");100>=g?f[0].style.cssText="":(QuickApps.removeApp(b),-1==u||u+1>e?ImacScreen.addApp(b,l,e):(ImacScreen.adjustAppsPosFromIndex(l,u,0),ImacScreen.addApp(b,l,u)),AppMgr.sendAppUpdate(b,"toolbar-to-screen"))}};g.AppDragMgr={enableAllScreenApps:function(){d.find(".app-item").draggable(r)},enableScreenApp:function(a){ImacScreen.getApp(a).draggable(r)},enableAllToolbarApps:function(){f.find(".dock-app").draggable(q)},enableToolbarApp:function(a){QuickApps.getApp(a).draggable(q)},destroy:function(a){a.draggable("destroy")}}})(this,jQuery);(function(g,a){var d=a("#imac-screen-pages"),c=d.width(),f=function(){var f=(a("body").width()-c)/2;d.css("left",f)};a(g).on("resize",f);f()})(this,jQuery);(function(g,a){var d=a("#imac-taskbar"),c=a(".tasks-wrap",d),f=a(".task-list",d),p=d.find(".scroll-wrap"),r=Mustache,q=a.trim(TASK_ITEM_TPL),n=function(){var b=a("body").width()-50,l=b-100;d.css("width",b);c.css("width",l);114*f.find(".task-item").length>l?p.removeClass("hidden"):(p.addClass("hidden"),f.css("margin-left",0))},k=new EpContextMenu({items:[{text:"\u663e\u793a\u684c\u9762",click:function(a){TaskBar.minAllTasks()}},"sep",{text:"\u5173\u95ed\u6b64\u4efb\u52a1",click:function(a){TaskBar.removeTask(a.id)}},{text:"\u53ea\u663e\u793a\u6b64\u4efb\u52a1\u7a97\u53e3",click:function(a){TaskBar.minAllTasks(a.id)}},"sep",{text:"\u5173\u95ed\u5176\u4ed6\u4efb\u52a1",click:function(a){TaskBar.removeOthers(a.id)}},{text:"\u5173\u95ed\u6240\u6709\u4efb\u52a1",click:function(){TaskBar.removeAll()}},"sep",{text:"\u53d6\u6d88",role:"cancel"}]}),h={};g.TaskBar={openTask:function(a){var b=AppMgr.getAppData(a),c=null,c=Util.getBdSize();h[a]?(c=h[a],c.show(0,0)):(c=(new EpDialog({title:b.name,url:b.url,draggable:!0,resizable:!0,width:(b.widthRatio||DIALOG_SIZE_RATIO[0])*c.width,height:(b.heightRatio||DIALOG_SIZE_RATIO[1])*c.height,btns:[{role:"min",title:"\u6700\u5c0f\u5316",click:function(){this.hide()}},{role:"maxwin",title:"\u6700\u5927\u5316"},{role:"refresh",title:"\u5237\u65b0"},{role:"close",title:"\u5173\u95ed",click:function(a){TaskBar.removeTask(a.id);return!1}}]})).setOptions("id",a),b.isFullView?c.show(0,0).maxWin():c.show(0,1),h[a]=c)},minAllTasks:function(a){var b,c;for(b in h)h.hasOwnProperty(b)&&(c=h[b],b!=a?c.hide():(c.show(0,0),TaskBar.activeTask(b)))},addOrActiveTask:function(b){var c=h[b],d=AppMgr.getAppData(b);c||(a(r.render(q,{id:d.id,name:d.name,icon:Util.switchIcon(d,"taskbar")})).appendTo(f),n());TaskBar.openTask(b);TaskBar.activeTask(b)},makeTaskVisiable:function(a){a=114*TaskBar.getTask(a).prevAll().length;var b=Math.abs(Util.toInt(f.css("margin-left"))),d=c.width(),e=0;a<b?e=a:a+114-d>b&&(e=a+114-d);e&&f.stop(!0).animate({marginLeft:-e},300)},getTask:function(a){return f.find('[data-id\x3d"'+a+'"]')},removeTask:function(a){var b=TaskBar.getTask(a);b.length&&(b.remove(),h[a].hide().destroy(),h[a]=null,n())},removeOthers:function(b){var c=f.find(".task-item");c.length&&(c.each(function(c,e){var d=a(e),f=d.data("id");b!=f&&(d.remove(),h[f].hide().destroy(),h[f]=null)}),n())},removeAll:function(){var b=f.find(".task-item");b.length&&(b.each(function(b,c){var e=a(c),d=e.data("id");e.remove();h[d].hide().destroy();h[d]=null}),n())},activeTask:function(a){var b=TaskBar.getTask(a);b.hasClass("active")||b.addClass("active").siblings().removeClass("active");TaskBar.makeTaskVisiable(a)}};a(g).on("resize",n).on("resize",function(){var a,c;for(a in h)h.hasOwnProperty(a)&&(c=h[a],!c.isHidden()&&c.isMax()&&c.maxWin())});d.on("click",".scroll-l",function(a){a=Math.abs(Util.toInt(f.css("margin-left")));var b=a-200;a&&(0>b&&(b=0),f.stop(!0).animate({marginLeft:-b},200))}).on("click",".scroll-r",function(a){a=Math.abs(Util.toInt(f.css("margin-left")));var b=114*f.find(".task-item").length,d=c.width(),e=b-d;dis=a+200;a!=b-d&&(dis>e&&(dis=e),f.stop(!0).animate({marginLeft:-dis},300))}).on("click",".task-item",function(b){b=a(this);var c=b.data("id"),c=h[c];b.hasClass("active")?c.toggle():(b.addClass("active").siblings().removeClass("active"),c.show(0,0))}).on("contextmenu",".task-item",function(b){var c=a(this).data("id");k.setOptions("id",c).show({x:b.pageX,y:b.pageY});return!1});n();g.TabsNav={addTab:function(a){var b=a.id;AppMgr.getAppData(b)||AppMgr.cacheAppData(b,{name:a.name,icon:a.icon||"./images/app/8.png",id:b,url:a.url});TaskBar.addOrActiveTask(b)},refreshTabContent:function(a){(a=h[a])&&a.refresh&&a.refresh()}}})(this,jQuery);(function(g,a){var d=a("#msg-sound"),c,f;Util.browsers.isIE?c=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden" id\x3d"msgcenter-sound"\x3e\x3c/iframe\x3e').appendTo(d):(d.html('\x3caudio id\x3d"msgcenter-sound-audio" controls\x3d"controls" src\x3d"../../msgsound/newsms.wav" class\x3d"hidden-accessible"\x3e\x3c/audio\x3e'),f=document.getElementById("msgcenter-sound-audio"));var p=a("#imac-right-bar .message"),r=document.title,q="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",n=0,k=function(){document.title=q;clearTimeout(n);n=setTimeout(function l(){document.title=q.substring(1,q.length)+q.substring(0,1);q=document.title;n=setTimeout(l,300)},300)},h=function(){Util.ajax({url:g.msgCountUrl,global:!1,data:{haseXun:!0,needNum:!0},success:function(a){a.remind?(d.hasClass("triggered")||(Util.browsers.isIE?c[0].src=Util.getRightUrl("../../msgsound/sound.html")+"?timestamp\x3d"+ +new Date:f.play(),d.addClass("triggered")),p.removeClass("message").addClass("message-new"),k()):(Util.browsers.isIE&&(c[0].src=""),p.removeClass("message-new").addClass("message"),d.removeClass("triggered"),clearTimeout(n),document.title=r,q="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01");updateEmsgCount(parseInt(a.eXun)||0)},error:Util.noop,complete:Util.noop})};h();setInterval(h,6E4)})(this,jQuery);(function(g,a){a("#imac-right-bar .quick-btns").on("click",".logout",function(a){a.preventDefault();mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(a){"ok"==a&&g.onLogout&&(eWebSocket&&eWebSocket.close(),g.onLogout())})})})(this,jQuery);(function(g,a){var d=a("#imac-right-bar .quick-apps"),c=a(".list-wrap",d),f=a(".app-list",d),p=a(".scroll-up",d),r=a(".scroll-dw",d),q=d.prev().outerHeight(),n=d.next().outerHeight(),k=Mustache,h=a.trim(DOCK_APP_TPL),b=function(){var b=a("body").height()-(50+q+n+50),d=51*f.find(".dock-app").length;c.css("height",b);d>b?p.add(r).removeClass("hidden"):(p.add(r).addClass("hidden"),f.css("margin-top",0))},l=function(b){var c=[];a.each(b,function(b,d){d=Util.fixPath(d);var e=a.extend({},d);e.sname=Util.getAppShortName(d.name);e.icon=Util.switchIcon(e,"toolbar");c.push(k.render(h,e));AppMgr.cacheAppData(d.id,d)});f.html(c.join(""))},t=function(){var a=[],b,c=AppCmFuncs,d=[];a.push({text:"\u6253\u5f00\u5e94\u7528",click:c.openApp});a.push("sep");for(b=1;b<=PAGE_NUM;b++)d.push({text:"\u667a\u6167\u684c\u9762"+b,page:b-1,click:c.moveToScreen});a.push({text:"\u8fd8\u539f\u5e94\u7528\u5230",items:d});a.push({text:"\u5378\u8f7d\u5e94\u7528",click:c.uninstallApp});return(new EpContextMenu({items:a})).setOptions("from","toolbar")}();d.on("click",".scroll-up",function(a){if(a=Math.abs(Util.toInt(f.css("margin-top"))))a=0>a-60?0:a-60,f.stop(!0).animate({marginTop:-a},300)}).on("click",".scroll-dw",function(a){a=Math.abs(Util.toInt(f.css("margin-top")));var b=c.height(),d=51*f.find(".dock-app").length;a!=d-b&&(a=a+b+60>d?d-b:a+60,f.stop(!0).animate({marginTop:-a},300))}).on("click",".dock-app",function(b){b=a(this).data("id");AppMgr.openApp(b)}).on("contextmenu",".dock-app",function(b){var c=a(this).data("id");t.setOptions("id",c).show({x:b.pageX,y:b.pageY});return!1});g.QuickApps={isFull:function(){var a=f.find(".dock-app").length;a==MAX_DOCK_APP_NUM&&mini.showMessageBox({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u5f88\u62b1\u6b49\uff0c\u5de5\u5177\u680f\u4e2d\u7684\u5feb\u6377\u5e94\u7528\u5df2\u6ee1\uff08\u5f53\u524d\u914d\u7f6e\u4e3a\u6700\u591a"+MAX_DOCK_APP_NUM+"\u4e2a\uff09,\u5efa\u8bae\u79fb\u9664\u4e2a\u522b\u4e0d\u5e38\u7528\u7684\u5e94\u7528\u3002",buttons:["ok"],iconCls:"mini-messagebox-info"});return a==MAX_DOCK_APP_NUM},addApp:function(b){var c=AppMgr.getAppData(b);c.icon=Util.switchIcon(c,"toolbar");c.sname=Util.getAppShortName(c.name);c=a(k.render(h,c));c.appendTo(f);this.makeAppVisiable(b);Util.highlightApp(c);AppDragMgr.enableToolbarApp(b)},makeAppVisiable:function(a){var b=Math.abs(Util.toInt(f.css("margin-top")));a=51*this.getApp(a).prevAll().length;var d=c.height(),e=0;a<b?e=a:a+51-d>b&&(e=a+51-d);e&&f.stop(!0).animate({marginTop:-e},300)},getApp:function(a){return f.find('[data-id\x3d"'+a+'"]')},removeApp:function(a){a=this.getApp(a);AppDragMgr.destroy(a);a.remove();b()}};a(g).on("resize",b);(function(){Util.ajax({url:g.toolbarAppsUrl,data:{query:"toolbar-apps"},success:function(a){a&&a.length&&(l(a),b(),AppDragMgr.enableAllToolbarApps())},error:Util._ajaxErr})})()})(this,jQuery);(function(g,a){Util.ajax({url:g.getMsgAppUrl,data:{query:"get-msg-app-url"}}).done(function(c){c&&c.url&&a.each(g.defaultApps,function(a,d){if("sys-msg-reminder"===d.id)return d.url=c.url,!1});d()}).fail(function(a){console&&console.error&&console.error(a);d()});var d=function(){a.each(g.defaultApps,function(a,d){d=Util.fixPath(d);d.hasTaskbarIcon=!0;AppMgr.cacheAppData(d.id,d)});a("body").on("click",".default-app-btn",function(c){c.preventDefault();c=a(this).data("id");AppMgr.openApp(c)})}})(this,jQuery);(function(g,a){var d=a("#online-user-count"),c=function(){Util.ajax({url:g.onlineUserCountUrl,data:{query:"online-user-count"},success:function(a){d.html("("+a.count+")")},error:Util._ajaxErr})};c();setInterval(c,6E4)})(this,jQuery);(function(g,a){var d=a("#user-info");(function(){Util.ajax({url:g.userInfoUrl,data:{query:"user-info"},success:function(a){d.html(a.userName+"\uff08"+a.ouName+"\uff09");g._userName_=a.userName;g._userGuid_=a.userGuid},error:Util._ajaxErr})})()})(this,jQuery);window.eWebSocket=void 0;window.creatWebSocket=function(g,a,d){if(eWebSocket)d&&d();else{var c=window.EWebSocketConfig?window.EWebSocketConfig:{url:EmsgConfig.websocketUrl};c.uid=g;c.uname=a;window.EWebSocket?(eWebSocket=new EWebSocket(c),d&&d()):Util.loadJs("fui/pages/ewebsocket/ewebsocket.js",function(){eWebSocket=new EWebSocket(c);d&&d()})}};window.OpenEMsg=function(g,a,d){window.eMsg?"undefined"===typeof a?eMsg.open(g):eMsg.openSession(g,a,d):creatWebSocket(_userGuid_,_userName_,function(){eWebSocket.openEmsg(g,a,d)})};(function(g,a){function d(){c=new ThemeSelection({getThemesUrl:getThemesUrl,saveThemeUrl:saveThemeUrl,showCallback:function(){},hideCallback:function(){f.removeClass("active")}});window.themeSelection=c;f.on("click",function(){f.hasClass("active")?(f.removeClass("active"),c.hide(),hidePageCover()):(c.show(),f.addClass("active"))})}var c,f=a("#theme-btn");window.ThemeSelection?d():Util.loadJs("fui/pages/themeselection/themeselection.js",d);a("body").on("click",function(d){d=a(d.target);a.contains(c.$container[0],d[0])||d.closest("#theme-btn").length||c.hide()})})(this,jQuery);(function(g,a){function d(){n=new EMsgList({content:q,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:function(){c()},onDecEmsgCount:k});g.RefreshEMsg=a.proxy(n.getData,n)}function c(){f.removeClass("active");p.stop(!0).animate({right:-350},function(){p.addClass("hidden")})}var f=a("#msgTrigger"),p=a("#msgEMsg"),r=a(".msg-panel-content",p),q=a(".emsg-recent-list",r),n,k=function(){var a=f.data("num")||0;a&&(a=parseInt(a,10)-1);h(a)},h=function(a){0>=a?f.data("num",0).removeClass("new-msg"):f.data("num",a).addClass("new-msg")};g.EMsgList?d():Util.loadJs("../../emsglist/emsglist.js",function(){d()});f.on("click",function(){a(this).hasClass("active")?c():(n.getData(),f.addClass("active"),p.removeClass("hidden"),p.stop(!0).animate({right:50}))});p.on("click",".msg-panel-hide",function(){c()});a("body").on("click",function(b){a(b.target).closest("#msgEMsg , #msgTrigger").length||c()});g.updateEmsgCount=h})(this,jQuery);