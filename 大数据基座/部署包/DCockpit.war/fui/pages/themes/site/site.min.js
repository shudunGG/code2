/*
 * @Author: jjj
 * @Date: 2019-06-12 08:24:11
 * @LastEditors: jjj
 * @LastEditTime: 2019-06-12 08:24:11
 * @Description: 
 */

// 全局变量处理
(function(a,b){a._graceEvent_=new Util.UserEvent;var g=b("#cover-wrap");a.createMainContentCover=Util.browsers.isIE&&window.hasObjectTag?function(){var d=document.createElement("iframe");d.width="100%";d.height="100%";d.scrolling="no";d.frameBorder=0;d.style.background="transparent";d.src="../../activexcover/activexcover.html";return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').append(d).appendTo(g)}:function(){return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').appendTo(g)};a._getData_=function(b,a){return Util.ajax({url:epoint.dealRestfulUrl(getDataUrl+"/"+b),data:a})};a.dealLinkOpen=function(b){switch(b.openType){case "tabsnav":TabsNav.addTab(b);break;case "dialog":epoint.openTopDialog(b.name,Util.getRightUrl(b.url));break;case "blank":a.open(Util.getRightUrl(b.url),b.id)}};a._ANIMATION_TIME_={slide:200};a.useWebsocket=!0===Util.getFrameSysParam("useWebsocket");a.eWebSocket=void 0;b("#quit").on("click",function(){onQuit&&"function"==typeof onQuit&&onQuit()})})(this,jQuery);(function(a,b){"[object Function]"===Object.prototype.toString.call(a.EpTabsNav)?(window.TabsNav=new EpTabsNav({ifrContainer:"#main-ifr-wrap",tabContainer:"#main-tab-wrap",needScrollBtn:!1,scrollBtnSite:"sides",smoothItems:3,needQuickNav:!0,position:"bottom",tabWidth:112}),TabsNav._$pageCover=createMainContentCover()):console.error('The TabsNav is required! , please add the "fui/pages/tabsnav/tabsnav.js" before theme\'s javascript file')})(this,jQuery);(function(a,b){var g=b("#theme-bg-img"),d=function(b){b=b||mini.Cookie.get("_site_skin_")||"default";var c="./skins/"+b+"/images/bg.png";b=new Image;b.src=c;b.onload=function(){g[0].src=c}};b(window).on("message",function(b){b=b.originalEvent;if(b.data)try{var c=JSON.parse(b.data);"skinChange"==c.type&&c.skin&&d(c.skin)}catch(e){console.error(e)}})})(this,jQuery);(function(a,b){var g=b("#sys-logo-img"),d=b("#user-info"),n=b(".user-portrait",d);createMainContentCover();_getData_("getUserInfo").done(function(c){a._userName_=c.name;a._userGuid_=c.guid;c.logo&&(/^data:/.test(c.logo)?g.attr("src",c.logo):g.attr("src",Util.getRightUrl(c.logo)));c.title&&(document.title=c.title,a.systemTitle=c.title);var e={closeIcon:!1,refresh:!0};b.each(c.homes,function(a,d){var k=!1;d.items&&b.each(d.items,function(b,a){if(c.defaultHome){if(a.code==c.defaultHome)return e.id=a.code||"home",e.url=a.url,e.name=a.name,k=!0,!1}else if("tabsnav"==a.openType)return e.id=a.code||"home",e.url=a.url,e.name=a.name,k=!0,!1});if(k)return!1});TabsNav.addTab(e);_graceEvent_.fire("afterPageInfo")});b(a).on("message",function(b){try{var a=JSON.parse(b.originalEvent.data);"userPortraitChange"===a.type&&n.attr("src",a.imgData)}catch(k){}});_getData_("getExtTabsInfo").done(function(a){if(a&&a.length){var c="";b.each(a,function(b,a){a.icon=a.icon||"modicon-8";/^icon-/.test(a.icon)&&(a.icon="action-icon "+a.icon);c+=Mustache.render('\x3cli class\x3d"user-action-item" title\x3d"{{name}}" url\x3d"{{url}}" data-opentype\x3d"{{openType}}" \x3e\x3cspan class\x3d"{{icon}}"\x3e\x3c/span\x3e{{name}}\x3c/li\x3e',a)});b(c).insertAfter("#person-info-setting")}})})(this,jQuery);(function(a,b){function g(a,c){var h="";b.each(a,function(a,f){f.hasSub=!(!f.items||!f.items.length);f.rowkey=void 0===c?a+"":c+"-"+a;var d=f.rowkey.split("-").length;f.isTop=1===d;f.level="level-"+d;var e;e=d||f.rowkey.split("-").length;f.indent=36+13*(e-1);1===d&&(f.icon=f.icon||"modicon-1");h=f.hasSub?h+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',b.extend(f,{subMenu:g(f.items,f.rowkey)})):h+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',f)});return h}function d(a,d){var h=a.code;if(!c[h]||"reject"===c[h])return _getData_("getMenu",{query:"all"}).done(function(e){e&&e.length&&(e=g(e),l=b(Mustache.render('\x3cdiv class\x3d"left-menu-wrap" id\x3d"left-menu-{{code}}"\x3e\x3cul class\x3d"left-menu-list"\x3e{{{leftMenuItems}}}\x3c/ul\x3e\x3c/div\x3e',{code:a.code,name:a.name,leftMenuItems:e})),l.appendTo(p).siblings(".left-menu-wrap").addClass("hidden"),Util.browsers.isIE8&&l.find(".left-menu-list").height(k.height()-q.height()||36));c[h]="resolve";d&&n(h+"")}).fail(function(){c[h]="reject"});"resolve"===c[h]&&(l=b("#left-menu-"+h),l.removeClass("hidden").siblings(".left-menu-wrap").addClass("hidden"),d&&n(h))}function n(b){if(m[b])return TabsNav.addTab(m[b]);var a="",c="";p.find("#left-menu-"+b).find(".left-menu-item-link").each(function(d,f){c=f.getAttribute("data-url");a=f.getAttribute("data-opentype");if(c&&"tabsnav"==a)return m[b]={id:f.getAttribute("data-id"),name:f.title,url:c},TabsNav.addTab(m[b]),!1})}var c={},e=b("#main"),k=b("#left-menu"),q=b(".left-nav-trigger",k),p=b(".left-nav-container",k),l;(function(){function a(b){localStorage.setItem("_site_leftmenu_state_",b)}var c=localStorage.getItem("_site_leftmenu_state_")||"normal";e["normal"==c?"removeClass":"addClass"]("left-narrow");var d=Util.browsers.isIE8||Util.browsers.isIE9,g=createMainContentCover();b(".left-nav-trigger").on("click",function(){e.hasClass("left-narrow")?(a(c="normal"),e.removeClass("left-narrow"),g.addClass("hidden")):(a(c="narrow"),e.addClass("left-narrow"),l&&(l.find(".left-menu-item.level-1.opened").length?g.removeClass("hidden"):k.trigger("hide-trans")))});k.on("hide-trans",function(){!d&&k.addClass("hide-trans")}).on("transitionend",function(b){b.target===this&&k.removeClass("hide-trans")}).on("click",".left-menu-link",function(){var a=b(this),d=a.parent(),e=d.hasClass("level-1"),h=a.data("hassub"),n={url:a.data("url"),openType:a.data("opentype"),name:this.title,id:a.data("id")},m="narrow"===c;h?(a=e?a.next().find(".left-menu-sub-list:eq(0)"):a.next(),d.hasClass("opened")?(d.removeClass("opened"),a.stop(!0).slideUp(_ANIMATION_TIME_.slide),e&&m&&g.addClass("hidden")):(d.addClass("opened"),e&&m&&g.removeClass("hidden"),a.stop(!0).slideDown(_ANIMATION_TIME_.slide),d.siblings(".opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").stop(!0).slideUp(_ANIMATION_TIME_.slide))):n.url&&(dealLinkOpen(n),m&&(l.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp(_ANIMATION_TIME_.slide),g.addClass("hidden"),k.removeClass("has-opened")));if(e&&m)k[l.find(".left-menu-item.level-1.opened").length?"addClass":"removeClass"]("has-opened")});b("body").on("click",function(a){b(a.target).closest("#left-menu").length||(g.addClass("hidden"),"narrow"===c&&l&&l.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp())})})();a.getLefMenu=d;d({code:"home",name:"\u9996\u9875"});var m={}})(this,jQuery);