<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>应用注册添加</title>
<!-- 请修改相对路径 -->
<script src="../../../../../fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>
	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addNew" onclick="saveAndNew">保存并新建</a> <a
				class="mini-button" id="addClose" onclick="saveAndClose">保存并关闭</a> <a
				class="mini-button" onclick="epoint.closeDialog">关闭</a>
		</div>
		<!--帮助按钮 -->
		<a role="helper" class="mr10">注意事项</a>
	</div>

	<div class="fui-notice hidden">
		<p>
			<em>应用回调地址：接了统一认证后，sso信息回传需要配置的地址，一般配置接入应用的地址。不过不接入统一认证，填写的内容不重要。</em><br>
			<em>应用类型：分为pc端应用和移动端应用，区别为配置的内容不一样。移动端应用用于手机app管理使用。</em><br> <em>移动应用类型：分为内部应用和外部应用。外部应用一般为第三方应用。区别为：内部应用的用户为组织架构的用户，外部应用为第三方使用时发送过来的用户。</em><br>
			<em>移动应用支持平台：分为AndroidPhone/AndroidPad/iPhone/iPad/AndroidUniversal/iOSUniversal/others。用于区分app在哪里使用，或者下载安装的应用适配哪种系统。</em>
			<em style="color: red">
				（当选择AndroidUniversal，则AndroidPhone和AndroidPad选择无效；当选择iOSUniversal，则iPhone和iPad选择无效。）</em><br>

		</p>
	</div>

	<!-- 内容区域 -->
	<div class="fui-content">


		<div id="fui-form" class="fui-form">
			<div role="form">

				<div role="row">
					<div role="control" label="应用类别">
						<input id="appclassname" bind="appclassname" allowInput="false"
							class="mini-buttonedit" onbuttonclick="selectAppClass"
							selectOnFocus="true" />
					</div>
				</div>
				<input bind="dataBean.appclass" id="appclass" class="mini-hidden" />
				<div role="row">
					<div role="control" label="应用名称" starred="true">
						<input id="appname" class="mini-textbox" bind="dataBean.appname"
							required="true" maxLength="50" vType="maxLength:50;"
							requiredErrorText="应用名称不能为空" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="应用回调地址" starred="true">
						<input id="callbackurl" class="mini-textbox" required="true"
							maxLength="500" vType="maxLength:500;"
							requiredErrorText="应用回调地址不能为空" bind="dataBean.callbackurl" />
					</div>
				</div>
				<div role="row">
					<div role="control">统一认证跳转,如有内外网,逗号间隔,例:http://192.168.112.53:8080/EpointOA9,http://218.4.136.114:7009/EpointOA9</div>
				</div>
				<div role="row">
					<div role="control" label="应用类型">
						<div class="mini-radiobuttonlist" showNullItem="true"
							bind="dataBean.apptype" id="apptype" action="getAppTypeList"
							textField="text" valueField="id"></div>
					</div>
				</div>

				<div role="row">
					<div role="control" label="移动跳转地址">
						<input id="mobilepageurl" class="mini-textbox" maxLength="100"
							vType="maxLength:100;" bind="dataBean.mobilepageurl" />
					</div>
				</div>
				<div role="row">
					<div role="control">移动消息端推送跳转的静态页面部署地址头,例:http://192.168.112.53:8080/oarest9V7</div>
				</div>
				<div role="row">
					<div role="control" label="PC跳转地址">
						<input id="approoturl" class="mini-textbox" maxLength="1000"
							vType="maxLength:1000;" bind="dataBean.approoturl" />
					</div>
				</div>
				<div role="row">
					<div role="control">统一消息点击详情的跳转地址头,如有内外网和域名,需要另外填写在下面</div>
				</div>
				<div role="row">
					<div role="control" label="PC跳转外网地址">
						<input id="appconfigurl" class="mini-textbox" maxLength="1000"
							vType="maxLength:1000;" bind="dataBean.appconfigurl" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="PC跳转域名">
						<input id="apprealurl" class="mini-textbox" maxLength="1000"
							vType="maxLength:1000;" bind="dataBean.apprealurl" />
					</div>
				</div>


				<div role="row" id="mobileisexternalrow">
					<div role="control" label="移动应用类型">
						<div id="IsExternal" name="level" bind="dataBean.isexternal"
							data="[{text:'内部应用',id:'0'},{text:'外部应用',id:'1'}]"
							textField="text" valueField="id" value="0"
							class="mini-radiobuttonlist" style="width: 200px"></div>
					</div>
				</div>
				<div role="row" id="mobileplatformrow">
					<div role="control" label="移动应用支持平台">
						<div id="platform" class="mini-checkboxlist" showNullItem="true"
							bind="dataBean.platform" action="getPlatformList" repeatItems="3"
							repeatLayout="table" textField="text" valueField="id"
							multiSelect="true"></div>
					</div>
				</div>

				<div role="row" id="icon2">
					<div role="control" label="应用图标" id="cc">
						<div style="position: relative; float: left;">
							<span id="photo1" class="text-minor">暂无应用图标， </span>
							<div id="uploader" class="mini-webuploader"
								action="appinfoaddaction.getFileUploadModel"
								fileSingleSizeLimit="1024" limitType="png" mimeTypes="image/*"
								showDefaultUI="false" auto="true" pickerText="请上传"
								onfilesuccess="OnPhotoSuccess"></div>
							<span class="text-minor" style="width: 300px" id="photo3">（最佳图片尺寸：50px<em>*</em>50px;
								1M以内）
							</span>
						</div>

						<div class="img-view" id="photo">
							<img id="lblPicture" src="" width="50px" height="50px" alt="应用图标" />
							<i class="action-icon icon-removecirclefilled"
								style="position: absolute; left: 110px; top: 20px;"
								onclick="delPhoto();"></i>
						</div>
					</div>
				</div>

				<!-- <div role="row">
								<div role="control" label="应用类型">
									<input id="apptype" class="mini-combobox"
										bind="dataBean.apptype" action="selectTypeModel" />
								</div>
							</div> 
							
							<div role="row">
								<div role="control" label="访问入口名称">
									<input id="appentryname" class="mini-textbox" maxLength="50"
										vType="maxLength:50;" bind="dataBean.appentryname" />
								</div>
							</div>
							<div role="row">
								<div role="control" label="范围">
									<input id="scope" class="mini-combobox" bind="dataBean.scope"
										action="selectScopeModel" />
								</div>
							</div>
							<div role="row">
								<div role="control" label="授权类型">
									<input id="granttypes" class="mini-checkboxlist"
										bind="dataBean.granttypes" action="selectGrantTypesModel" />
								</div>
							</div>
							<div role="row">
								<div role="control" label="应用状态">
									<input id="appstatus" class="mini-combobox"
										bind="dataBean.appstatus" action="selectStatusModel" />
								</div>
							</div> -->
				<div role="row">
					<div role="control" label="排序号">
						<input id="ordernum" bind="dataBean.ordernum" class="mini-textbox"
							vtype="int;range:0,99999999" allowSort="true" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="应用摘要描述">
						<input id="appdesc" class="mini-textarea" bind="dataBean.appdesc"
							vtype="maxLength:255" maxLength="255" />
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- 请修改相对路径 -->
	<script src="../../../../../../rest/resource/jsboot"></script>
	<script>
		// 初始化页面
		epoint.initPage('appinfoaddaction', '', function(e) {
			if (e.appclassname) {
				mini.get("appclassname").setText(e.appclassname);
				mini.get("appclass").setValue(Util.getUrlParams('classguid'));
			}
			mini.get("apptype").setValue("0");
			mini.get("IsExternal").setValue("0");

			$("#mobileplatformrow").hide();
			$("#mobileisexternalrow").hide();

			showPhoto(null);
		});

		function saveAndNew() {
			if (epoint.validate()) {
				epoint.execute('addNew', 'fui-form', newCallback);
			}
		}

		function saveAndClose() {
			if (epoint.validate()) {
				epoint.execute('add', 'fui-form', closeCallback);
			}
		}

		// 新增操作的回调
		function newCallback(data) {
			if (data.success) {
				epoint.alert(data.msg, null, null, 'success');
				// 清空表单
				epoint.clear('fui-form');
				mini.get("uploader").clearFile();
				//移动端内容（恢复）
				$("#mobileplatformrow").hide();
				$("#mobileisexternalrow").hide();
				showPhoto();
				mini.get("appclassname").setText(data.appclassname);
				mini.get("appclassname").setValue(data.appclassguid);
				mini.get("appclass").setValue(data.appclassguid);
				mini.get("apptype").setValue("0");
				mini.get("platform").setValue("5,6");
			} else {
				epoint.alert(data.msg, null, null, 'warning');
			}
		}

		// 关闭操作的回调
		function closeCallback(data) {
			if (data.success) {
				if (data.msg) {
					epoint.alertAndClose(data.msg, null, null, null, 'success');
				}
			} else {
				if (data.msg) {
					epoint.alert(data.msg, null, null, null, 'warning');
				}
			}
		}
		function selectAppClass(e) {
			epoint
					.openDialog(
							'选择应用类别',
							"frame/pages/basic/gateway/app/appinfomanage/selectappclass",
							selectAppClassOperJS, {
								'width' : 300,
								'height' : 400
							});
		}
		function selectAppClassOperJS(rtnValue) {
			if (rtnValue && rtnValue != 'close') {
				var s = rtnValue.split(";");
				if (s[0] != "") {
					mini.get("appclassname").setText(s[0]);
					mini.get("appclassname").setValue(s[1]);
					mini.get("appclass").setValue(s[1]);
				}
			}
		}

		mini.get("apptype").on("valuechanged", function(e) {
			if (this.getValue() == "0") {
				//移动端内容
				$("#mobileplatformrow").hide();
				$("#mobileisexternalrow").hide();
			} else {
				//移动端内容
				$("#mobileplatformrow").show();
				$("#mobileisexternalrow").show();
			}
		});

		//上传成功
		function OnPhotoSuccess(args) {
			if (args.data.extraDatas.lblPicture) {
				showPhoto(args.data.extraDatas.lblPicture);
			}
		}

		//删除个性签名图片
		function delPhoto() {
			epoint.execute("appinfoaddaction.delUserSign", "",
					function delPhotoCallback(data) {
						if (data.msg) {
							mini.get("uploader").clearFile();
							showPhoto();
						}
					});
		}

		//控制照片显隐
		function showPhoto(url) {
			if (url) {
				$("#lblPicture").attr("src", url);
				mini.get("uploader").setVisible(false);
				$("#photo1").hide();
				$("#photo3").hide();

				$("#photo").show();
			} else {
				$("#photo").hide();
				$("#lblPicture").attr("src", "");
				mini.get("uploader").setVisible(true);
				$("#photo1").show();
				$("#photo3").show();
			}
		}
	</script>
</body>
</html>