<!DOCTYPE html>
<html>

<head>
<title>Change the password</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>
<body>
	<!-- Wait for the tooltip -->
	<div class="page-loading"></div>

	<!-- Button area -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" onclick="save">save changes</a> <a
				id="notthistime" class="mini-button" onclick="redirectFrame">temporarily
				not modify</a>
		</div>
		<div>
			<span id="valid" style="color: red"> The password has expired.
				Please reset your password.</span><span id="force" style="color: red">The
				password can not be an initialization value. Please reset it.</span>
		</div>
	</div>


	<!-- Content area -->
	<div class="fui-content">
		<div class="fui-form" id="fui-form">
			<div role="form">
				<div role="row">
					<div role="control" label="original password" starred="true">
						<input id="txtOldPsd" class="mini-password" required="true"
							emptyText="Please enter the original password" style="width: 100%;"
							bind="mypasswordmodifyaction.txtOldPsd" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="new password" starred="true">
						<input id="txtNewPsd" class="mini-password" required="true"
							emptyText="Please enter the new password" style="width: 100%;"
							bind="mypasswordmodifyaction.txtNewPsd" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="confirm password" starred="true">
						<input id="txtNewPsdCon" class="mini-password" required="true"
							emptyText="Please enter the confirm password" style="width: 100%;"
							bind="mypasswordmodifyaction.txtNewPsdCon" />
					</div>

				</div>
			</div>
		</div>
		<!-- Hide area -->
		<input bind="mypasswordmodifyaction.complexPassWord"
			id="complexPassWord" class="mini-hidden" /> <input
			bind="mypasswordmodifyaction.neededit" id="neededit"
			class="mini-hidden" />
	</div>


	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../../rest/resource/jsboot"></script>



	<script>
		//<![CDATA[  
		//Initialize the page
		epoint.initPage("mypasswordmodifyaction", "", initCallback);

		//Not to modifyButton to display
		function initCallback() {
			var reason=Util.getUrlParams("reason");
			 if(reason&&reason=="valid"){
				$('#valid').css('display','block');
				$('#force').css('display','none');
			}else if(reason&&reason=="force"){
				$('#valid').css('display','none');
				$('#force').css('display','block');
			}else{
				$('#valid').css('display','none');
				$('#force').css('display','none');
			} 
			if (mini.get("neededit").getValue() != 1) {
				mini.get("notthistime").setVisible(false);
			}
		}

		//Check the complexity
		function checkPass1(s) {
			if (s.length < 8)
				return 0;
			var ls = 0;
			if (s.match(/([a-z])+/))
				ls++;
			if (s.match(/([0-9])+/))
				ls++;
			if (s.match(/([A-Z])+/))
				ls++;
			if (s.match(/[^a-zA-Z0-9]+/))
				ls++;
			return ls
		}

		//Modify the callback event
		function saveCallback(data) {
			epoint.alert(data.msg,'',function(){
				//Jump to the home page
				if (data.success) {
					redirectFrame();
				} else {
					//Empty form
					epoint.clear('fui-form');
				}
			}, 'info');
		}

		//Confirm the change
		function save() {
			if (epoint.validate()) {
				var txtOldPsd = mini.get("txtOldPsd").getValue();
				var txtNewPsd = mini.get("txtNewPsd").getValue();
				var txtNewPsdCon = mini.get("txtNewPsdCon").getValue();
				//The judgment of old and new passwords are the same
				if (txtOldPsd == txtNewPsd) {
					epoint.alert("The new password cannot be the same as the old one!", null, null, 'warning');
					return false;
				}
				//judgeConfirm passwordWhether or not the same
				if (txtNewPsd != txtNewPsdCon) {
					epoint.alert("The confirm password cannot be the same as the new one!", null, null, 'warning');
					return false;
				}
				//The complexity of the check
				var complexPassWord = mini.get("complexPassWord").getValue();
				if ("1" == complexPassWord) {
					if (checkPass1(txtNewPsd) == 0) {
						epoint.alert("The length of the password must be greater than 8, please reset!", null, null, 'warning');
						return false;
					}
				}else if("2" == complexPassWord) {
					if (checkPass1(txtNewPsd) < 2) {
						epoint.alert("Password complexity is not enough,please reset!", null, null, 'warning');
						return false;
					}
				}else if("3" == complexPassWord) {
					if (checkPass1(txtNewPsd) < 3) {
						epoint.alert("Password complexity is not enough,please reset!", null, null, 'warning');
						return false;
					}
				}
				//Performing background method modification
				epoint.execute("sure", "", saveCallback);
			}
		}
		
		function redirectCallBack(e) {
			var url = Util.getUrlParams('uri');
			if (!url) {
				return;
			}
			if (url && url.indexOf('http') < 0) {
				url = Util.getRootPath() + url;
			}
			window.location.href = url;
		}

		//Not to modify ,Jump to the home page
		function redirectFrame() {
			//First insessionPut a sign bit,An infinite loop or behindChange the password
			epoint.execute("notModify", "", redirectCallBack);
		}

		//]]>
	</script>

</body>
</html>
