<!DOCTYPE html>
<html>

<head>
<title>Address book management</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../../fui/js/cssboot.js"></script>
</head>
<body>
	<!-- Wait for the tooltip -->
	<div class="page-loading"></div>

	<!-- the left tree -->
	<div class="fui-left">

		<div role="head" title="Grouping settings">
			<div class="btn-group r">
				<a class="mini-button" iconCls="icon-gear" style="margin-top: 5px;"
					onclick="openGroup()">Grouping settings</a>
			</div>
		</div>

		<div role="body">
			<ul id="tree" class="mini-tree" style="height: 100%" textField="text"
				idField="id" parentField="pid" action="getTreeData"
				resultAsTree="false"></ul>
		</div>
	</div>


	<!-- Right-side content area -->
	<div class="fui-right">
		<!-- Button area -->
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button" onclick="openAdd">add contact</a> <a
					class="mini-button" onclick="saveOrderNum">save sort</a><a
					class="mini-button mr10" onclick="deleteSelect">delete selected</a>


				<!--Help button -->
				<a role="helper" class="mr10">precautions</a>
			</div>
		</div>

		<!-- Condition area -->
		<div class="fui-condition">
			<div class="fui-form" id="fui-form">
				<div role="form">
					<div role="row">
						<div role="control" label="name">
							<input bind="txtName" class="mini-textbox" />
						</div>
						<div role="control" label="phone number">
							<input bind="tel" class="mini-textbox" vtype="int"/>
						</div>
					</div>
					
					<!-- Add a hidden field for tree-to-table linkage -->
					<input bind="leftTreeCode" id="leftTreeNodeGuid"
						class="mini-hidden" /> <input bind="userGuid" id="userGuid"
						class="mini-hidden" />
				</div>
			</div>
			<!-- Search button -->
			<a role="searcher" callback="searchData"></a>
		</div>

		<!-- Help information area Hidden by default-->
		<div class="fui-notice hidden">
			<p>Note: If the user finds a contact in this department has been deleted, you need to delete this contact!</p>
		</div>


		<!-- List area -->
		<div class="fui-content">
			<div id="datagrid" name="datagrid" class="mini-datagrid"
				idField="objectguid" multiSelect="true"
				style="width: 100%; height: 100%;" allowResize="true"
				showPager="true" action="getDataGridData" allowCellSelect="true"
				editNextOnEnterKey="true" editNextRowCell="true"
				allowCellEdit="true">
				<!-- allowCellEdit="true" -->
				<div property="columns">
					<div type="checkcolumn" width="50"></div>
					<div type="indexcolumn" width="50" headerAlign="center">
						order
					</div>
					<div field="objectName"  width="100%" headerAlign="center">name</div>
					<div field="ouName" width="220" headerAlign="center" align="center">department</div>
					<div field="telphone" width="220" headerAlign="center" align="center">phone number</div>
					<div field="orderNumber" width="50" headerAlign="center" align="right">
						order no <input property="editor" class="mini-textbox" vtype="int" />
					</div>
				</div>
			</div>
		</div>
	</div>

</body>




 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../../../rest/resource/jsboot"></script>

<!-- Configuration Variables -->
<script>
	//<![CDATA[  
    //Initialize the page
    epoint.initPage ("addressbooklistaction");
    
    //The treejsobject
    var tree = mini.get ("tree");
    
    //formjsobject
    var grid = mini.get ("datagrid");
    
    //The new callback event
    function addCallBack ()
    {
	    searchData ();
    }

    //Open the new address book page
    function openAdd ()
    {
	    if (tree.getValue () && tree.getValue () != "f9root")
	    {
		    epoint.openDialog ("Select personnel", 'frame/communication/addressbook/addressuserselect?groupguid='
		            + tree.getValue (), addCallBack,
		    {
		        'width' : 660,
		        'height' : 470
		    });
	    }
	    else
	    {
		    epoint.alert ("Please select the address group!", null, null, 'warning');
	    }
    }

   
	//Save the callback event
	function saveCallback(data) {
		if (data.msg) {
			if (data.msg == "There is noroworder") {
				searchData();
			} else {
				epoint.alert(data.msg, null, null, 'info');
				searchData();
			}

		}
	}

	//save sort number
	function saveOrderNum() {
		if (epoint.validate()) {
			var ids = grid.getColumnData("objectguid");
			var ordernums = grid.getColumnData("orderNumber");
			epoint.execute('addressbooklistaction.saveOrderNum', '', [
					ids.join(';'), ordernums.join(';') ], saveCallback);
		}
	}

	// formThe search of
	function searchData() {
		if(epoint.validate()){
			epoint.refresh([ 'datagrid', 'fui-form' ]);
		}
	}

	//Click on theThe treeNode to refreshform
	tree.on("nodeselect", function(e) {
		if (e.node) {
			var id = e.node.id;
			//willthe left treeClick on theThe nodes of theidIn a hidden field
			mini.get('leftTreeNodeGuid').setValue(id);
		}
		//The refreshform
		searchData();
	});

	//Delete the callback event
	function callback(data) {
		epoint.alert(data.msg, null, null, 'info');
	}

	//delete selectedline
	function deleteSelect() {
		var datagrid = mini.get('datagrid');
		var ids = datagrid.getSelectedIds();
		if (ids.length > 0) {
			epoint.confirm("determinedelete selectedRecord?", "", function(action) {
				epoint.execute("addressbooklistaction.delete", "", [ ids
						.join(',') ], function(data) {
					if (data.msg) {
						epoint.alert(data.msg, null, null, 'info');
						searchData();
					}
				});
			});
		} else {
			epoint.alert("Please choose to delete records!", null, null, 'warning');
		}
	}

	//Grouping settingsThe callback event
	function groupCallBack() {
		epoint.refresh([ 'datagrid', 'tree', 'fui-form' ], '', true);
	}

	//Grouping settings
	function openGroup() {
		var userGuid = mini.get('userGuid').getValue();
		epoint.openDialog("Grouping settings",
				'frame/communication/addressbook/addressgrouplist?userGuid='
						+ userGuid, groupCallBack, {
					'width' : 1000,
					'height' : 600
				});
	}

	//]]>
</script>
</html>
