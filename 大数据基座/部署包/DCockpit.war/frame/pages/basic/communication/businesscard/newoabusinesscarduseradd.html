<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>外部通讯录列表</title>
    <script src="../../../fui/js/cssboot.js"></script>
    <style type="text/css">
        /*个性化上传控件按钮，为普通按钮样式*/
        #uploader .mini-uploader-btns .webuploader-pick {
            box-sizing: border-box;
            border: 1px solid;
            background-color: #51a6ef;
            padding: 1px 14px;
            border-color: #33a1d1;
        }

        #uploader .mini-uploader-btns .webuploader-pick:hover {
            background-color: #31afe5;
            border-color: #31afe5;
        }
    </style>
    <script>
        SrcBoot.output([
            './css/communicate.css'
        ]);
    </script>
</head>

<body>
<!-- 必须有，加载时的loading效果 -->
<div class="page-loading"></div>

<div class="fui-left">
    <div id="tree" name="tree" class="mini-tree"
         autoLoad="false"
         showTreeIcon="true" textField="text" idField="id"
         parentField="pid" action="getCategoryModal()" resultAsTree="false"
         showCheckBox="false" checkRecursive="false" autoCheckParent="false" expandOnLoad="true"
         showRadioButton="true" style="height:100%"
    ></div>
</div>

<div class="fui-right" >
    <!-- 内容区域 -->
    <div class="fui-content">
        <div class="content nicescroll" style="height:100%;overflow:auto">
            <!--<img src="http://localhost:8081/EpointOA9/rest/oa9/communication/businesscard/outerdetailviewaction/loadImg?uid=0eb96dff-184c-484b-9ed4-7fab3c73fb48&isCommondto=true">-->

            <!-- 头像信息栏 -->
            <div class="staff-baseinfo clearfix">
                <div class="staff-portrait big">
                    <img alt="portrait" class="icon-portrait" id="linkpic"/> <img
                        src="images/icon-girl.png" alt="gender" class="icon-gender"
                        id="icon-sex">
                </div>
                <div>姓 名:
                    <input id="linkdisplayname" class="mini-textbox" bind="dataBean.linkdisplayname"
                           required="true" vtype="maxLength:15"/>
                </div>
                <div style="margin-top: 40px">性 别:
                    <!--<input id="sex" class="mini-textbox" bind="dataBean.sex"/>-->
                    <input class="mini-combobox" id="sex"
                           bind="dataBean.sex" textField="text" valueField="id" onvaluechanged="Change"
                           data="[{id:'男',text:'男'},{id:'女',text:'女'}]"
                           emptyText="请选择..."/>
                </div>
                <div role="control" label="mini-webuploader" style="margin-top: 40px">
                    <div id="uploader" class="mini-webuploader"
                         action="oabusinesscarduseraddaction.getFileUploadModel"
                         fileSingleSizeLimit="5120" limitType="jpeg,jpg,gif,png,bmp" auto="true"
                         onfilesuccess="OnPhotoSuccess" showDefaultUI="false"></div>
                    <a class="mini-button" style="float:none;width:auto;vertical-align:top;" id="delpic"
                       onclick="delpic">删除照片</a>
                </div>
                <div class="staff-btn">
                    <a class="mini-button mini-btn-primary" plain="true" iconCls="icon-minuscircle"
                       onclick="saveAndClose">保存并关闭</a>
                </div>
            </div>
            <!-- 详细信息栏 -->
            <div class="detailsinfo">
                <!-- 联系方式 -->
                <div class="fui-form" id="fui-form">
                    <div role="form">
                        <div role="row" style="display: none">
                            <div role="control" label="排序">
                                <span class="mini-outputtext" bind="dataBean.ordernumber" vtype="int;range:0,99999999"></span>
                            </div>
                        </div>
                        <div role="row">
                            <div role="control" label="手机号码">
                                <input id="mobile" class="mini-textbox" bind="dataBean.mobile" vtype="mobile"/>
                            </div>
                            <div role="control" label="办公电话">
                                <input id="telephoneoffice" class="mini-textbox" bind="dataBean.telephoneoffice"
                                       vtype="tel"/>
                            </div>
                        </div>
                        <div role="row">
                            <div role="control" label="QQ号码">
                                <input id="qqnumber" class="mini-textbox" bind="dataBean.qqnumber"
                                       vtype="maxLength:15"/>
                            </div>
                            <div role="control" label="电子邮件">
                                <input id="email" class="mini-textbox" bind="dataBean.email" vtype="email"/>
                            </div>

                        </div>
                        <div role="row">
                            <div role="control" label="家庭电话">
                                <input id="telephonehome" class="mini-textbox" bind="dataBean.telephonehome"
                                       vtype="phone"/>
                            </div>
                            <div role="control" label="其他通讯">
                                <input id="otherimnumber" class="mini-textbox" bind="dataBean.otherimnumber"
                                       vtype="maxLength:20"/>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 其他 -->
                <div class="otherinfo">
                    <div class="fui-form">
                        <div role="form">
                            <div role="row">
                                <div role="control" label="部门">
                                    <input id="deptname" class="mini-textbox" bind="dataBean.deptname"
                                           vtype="maxLength:15"/>
                                </div>
                                <div role="control" label="传真">
                                    <input id="fax" class="mini-textbox" bind="dataBean.fax" vtype="maxLength:15"/>
                                </div>
                            </div>
                            <div role="row">
                                <div role="control" label="职务">
                                    <input id="title" class="mini-textbox" bind="dataBean.title" vtype="maxLength:15"/>
                                </div>
                                <div role="control" label="邮编">
                                    <input id="postaldddress" class="mini-textbox" bind="dataBean.postaladdress"
                                           vtype="postCode"/>
                                </div>
                            </div>

                            <div role="row">
                                <div role="control" label="单位">
                                    <input id="companyname" class="mini-textbox" bind="dataBean.companyname"
                                           vtype="maxLength:15"/>
                                </div>
                                <div role="control" label="地址">
                                    <input id="workaddress" class="mini-textbox" bind="dataBean.workaddress"
                                           vtype="maxLength:15"/>
                                </div>
                            </div>
                            <div role="row">
                                <div role="control" label="主页">
                                    <input id="weburl" class="mini-textbox" bind="dataBean.weburl" vtype="url"/>
                                </div>
                                <div role="control" label="个人博客">
                                    <input id="txtpersonweburl" class="mini-textbox" bind="dataBean.txtpersonweburl"
                                           vtype="maxLength:20"/>
                                </div>
                            </div>
                            <div role="row">
                                <div role="control" label="说明">
                                    <input id="note" class="mini-textarea" bind="dataBean.note"/>
                                </div>
                            </div>
                            <div class="hidden">
                                <input id="linkuserguid" class="mini-textbox" bind="dataBean.linkuserguid"/>
                                <input id="owneruserguid" class="mini-textbox" bind="dataBean.owneruserguid"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../../../rest/resource/jsboot"></script>
<script>
    SrcBoot.output([
        '../../../fui/js/lib/jquery.nicescroll.min.js'
    ]);
</script>
<script>
    var sex = mini.get("sex");
    var imgdata = "";
    // 初始化页面
    epoint.initPage('oabusinesscarduseraddaction', null, function (data) {
        if (Util.getUrlParams().categoryguid != "") {
            mini.get("tree").setValue(Util.getUrlParams().categoryguid);
        }
        $("#linkpic").attr('src', '');
        sex.setValue("男");
        if (sex.getValue() == "男") {
            $("#linkpic").attr('onerror', "javascript:this.src='images/photo-boy.png';");
            $("#icon-sex").attr('src', 'images/icon-boy.png');
        } else {
            $("#linkpic").attr('onerror', "javascript:this.src='images/photo-girl.png';");
            $("#icon-sex").attr('src', 'images/icon-girl.png');
        }
    });

    /*名字校验*/
    function checkname() {
        var name = mini.get("linkdisplayname").getValue();
        var ret = /^[a-zA-Z\u2E80-\u9FFF][0-9a-zA-Z\u2E80-\u9FFF]+$/;
        if (ret.test(name) && name.toLowerCase() != "null") {
            return true;
        } else {
            return false;
        }
    }

    /*上传成功之后*/
    function OnPhotoSuccess(args) {
        epoint.alert("上传成功", "", function () {
            epoint.execute("loadImg", null, function (data) {
                if (data) {
                    $("#linkpic").attr('src', data.imgdata);
                    if (data.imgdata) {
                        imgdata = data.imgdata;
                    }
                }
            });
        });

    }

    /*保存并关闭*/
    function saveAndClose() {
        var selectgroup = mini.get('tree').getSelectedNodes();
        if (selectgroup == ''||mini.get('tree').getValue()=='f9root') {
            epoint.showTips("请先选择分组！", {
                state: 'danger',
                y: 'center'
            });
            return;
        }
        if (epoint.validate()) {
            if (checkname()) {
                epoint.execute('checkUserName', '', null, function (data) {
                    if (data.isrepeat) {
                        epoint.confirm("该姓名已存在是否确认增加？", "", function (action) {
                            epoint.execute('add', '', [selectgroup[0].id], closeCallback);
                        });
                    } else {
                        epoint.execute('add', '', [selectgroup[0].id], closeCallback);
                    }
                });
                //epoint.execute('add','fui-form',closeCallback);
            } else {
                epoint.showTips("名字不合法，请输入中文或英文！", {
                    state: 'danger',
                    y: 'center'
                });
            }

        }
    }

    // 关闭操作的回调
    function closeCallback(data) {
        if (data.msg) {
            epoint.alertAndClose(data.msg);
        }
    }

    //性别
    function Change() {

        //判断头像是否存在
        if (imgdata == "") {
            $("#linkpic").attr('src', '');

            /*换照片*/
            if (sex.getValue() == "男") {
                $("#linkpic").attr('onerror', "javascript:this.src='images/photo-boy.png';");
            } else {
                $("#linkpic").attr('onerror', "javascript:this.src='images/photo-girl.png';");
            }
        }
        /*换性别图标*/
        if (sex.getValue() == "男") {
            $("#icon-sex").attr('src', 'images/icon-boy.png');
        }
        else {
            $("#icon-sex").attr('src', 'images/icon-girl.png');
        }
    }
    /*删除图片*/
    function delpic() {
        epoint.execute("delpic", '', function () {
            $("#linkpic").attr('src', '');
            mini.get("uploader").clearFile();
        });
    }
</script>
</body>

</html>
