<!DOCTYPE html>
<html>

<head>
<title>E- chat</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../../../frame/fui/js/cssboot.js"></script>
</head>
<body>
	<!-- Wait for the tooltip -->
	<div class="page-loading"></div>

	<!-- the left tree -->
	<div class="fui-left">
		<div role="head" title="Online personnel"></div>
		<div role="body">
			<ul id="tree" class="mini-tree" style="height: 100%" textField="text"
				idField="id" parentField="pid" action="getTreeData"
				resultAsTree="false"></ul>
		</div>
	</div>


	<!-- Right-side content area -->
	<div class="fui-right">

		<!-- Button area -->
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button mr10" onclick="deleteSelect">delete selected</a>
			</div>
		</div>

		<!-- Condition area -->
		<div class="fui-condition">
			<div class="fui-form" id="fui-form">
				<div role="form">
					<div role="row">
						<div role="control" label="time">
							<input name="dateFrom" id="time1" class="mini-datepicker"
								style="width: 44%;" format="yyyy-MM-dd H:mm:ss"
								timeFormat="H:mm:ss" showTime="true" bind="dateFrom"
								showClearButton="true" onValuechanged="validateDate(this)"
								allowInput="false" /> <span
								style="width: 12%; text-align: center">to</span> <input
								name="dateTo" id="time2" class="mini-datepicker"
								style="width: 44%;" format="yyyy-MM-dd H:mm:ss"
								timeFormat="H:mm:ss" showTime="true" bind="dateTo"
								showClearButton="true" onValuechanged="validateDate(this)"
								allowInput="false" />
						</div>
						<div role="control" label="content">
							<div class="mini-textbox" bind="content"></div>
						</div>
					</div>
					<div role="row">
						<div role="control" label="The sender">
							<div class="mini-textbox" bind="fromUserDisplayName"></div>
						</div>
						<div role="control" label="recipient">
							<div class="mini-textbox" bind="toUserDisplayName"></div>
						</div>
					</div>
				</div>
			</div>
			<!-- Search button -->
			<a role="searcher" callback="searchData"></a>
		</div>


		<!-- content area -->
		<div class="fui-content">
			<div id="datagrid" name="datagrid" class="mini-datagrid"
				idField="messageguid" multiSelect="true"
				style="width: 100%; height: 100%;" allowResize="true"
				showPager="true" action="getDataGridData" allowCellEdit="true"
				allowCellSelect="true" editNextOnEnterKey="true"
				editNextRowCell="true">
				<div property="columns">
					<div type="checkcolumn" width="20"></div>
					<div type="indexcolumn" width="30" headerAlign="center">order</div>
					<div field="fromUserDisplayName" headerAlign="center"
						align="center">The sender</div>
					<div field="toUserDisplayName" headerAlign="center"
						align="center">recipient</div>
					<div field="content" headerAlign="center" width="30%">content</div>
					<div field="sendTime" headerAlign="center"
						data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}"
						dateFormat="yyyy-MM-dd HH:mm:ss" align="center">sendtime</div>
				</div>
			</div>
		</div>
	</div>



	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../../../rest/resource/jsboot"></script>



	<script>
		//<![CDATA[  
		//Initialize the page
		epoint.initPage("exunmessagelist");
		
		 //The treejsobject
	    var tree = mini.get ("tree");

		//delete selectedline
	    function deleteSelect ()
	    {
		    var datagrid = mini.get ('datagrid');
		    var ids = datagrid.getSelectedIds ();
		    if (ids.length > 0)
		    {
			    epoint.confirm ("determinedelete selectedRecord?", "", function (action)
			    {
				    epoint.execute ("exunmessagelist.delete", "", [
					    ids.join (',')
				    ], function (data)
				    {
					    if (data.msg)
					    {
						    epoint.alert (data.msg, null, null, 'info');
						    epoint.refresh(['datagrid', 'fui-form'], '', true);
					    }
				    });
			    });
		    }
		    else
		    {
			    mini.alert ("Please choose to delete records!", null, null, 'warning');
		    }
	    }
		
		// Search for tables
		function searchData() {
			epoint.refresh(['datagrid', 'fui-form']);
		}
		
		
		 //Click on theThe treeNode to refresh the form
	    tree.on ("nodeclick", function (e)
	    {
		    if (e.node)
		    {
		    	var isSubNode = e.node.isSubNode;
		    	if(isSubNode == 'true'){
		    		var id = e.node.id;
				    //Open the chat window
				    top.OpenEMsg(id);
		    	}
		    }
	    });
		 
	 	//ã€€Period, the control,validation
		
		var start = mini.get("time1");
		var end = mini.get("time2");

		function validateDate(e) {
			if (start.getValue() && end.getValue()) {
				if (!epoint.validateDateInterval(start, end, 0)) {
					if (e.id == 'time1') {
						epoint.alert("starttimeIs not greater than endtime!", null, null, 'warning');
						start.setValue(null);
					} else {
						epoint
								.alert("The end of thetimeNot less thanstarttime!", null, null, 'warning');
						end.setValue(null);
					}
				}
			}
		}

		//]]>
	</script>

</body>
</html>
