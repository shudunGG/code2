<!DOCTYPE html>
<html>

	<head>
		<title>Internal contacts</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<script src="../../../../../frame/fui/js/cssboot.js"></script>
	</head>

	<body>
		<div class="page-loading"></div>

		<div class="fui-left">
			<div role="head" title="Choose department"></div>

			<div role="body">
				<ul id="tree" class="mini-tree" style="height: 100%" textField="text"
				idField="id" parentField="pid"
				action="getTreeData" resultAsTree="false"></ul>
			</div>
		</div>

		<div class="fui-right">
			<!-- toolbar area -->
			<div class="fui-toolbar">
				<div class="btn-group mr10">
					<a class="mini-dataexport" id="dataexport" gridId="datagrid"  fileName="Internal contacts"
					action="getExportModel" extraId="fui-form"></a>
				</div>
			</div>

			<div class="fui-condition">
				<!-- The form layout -->
				<div class="fui-form" id="fui-form">
					<div role="form">
						<!-- 2column -->
						<div role="row">
							<div role="control" label="name">
								<input bind="txtDisplayName" class="mini-textbox" />

							</div>
							<div role="control" label="contact number">
								<input bind="txtLink" class="mini-textbox" />
							</div>
						</div>
						<!-- Add a hidden field to the tree and the linkage of the table -->
						<input bind="ouguid"
						id="ouguid" class="mini-hidden" />

						<input bind="showDept"
						id="showDept" class="mini-hidden" />

						<input bind="showShortDept"
						id="showShortDept" class="mini-hidden" />
					</div>
				</div>
				<!-- Search button -->
				<a role="searcher" callback="searchData"></a>
			</div>
			<div class="fui-content">
				<div id="datagrid" class="mini-datagrid" sortOrder="desc"
				idField="userguid" multiSelect="true"
				style="width: 100%; height: 100%;" allowResize="true" 
				allowCellValid="true" action="getDataGridData"
				showPager="true" allowCellEdit="true" allowCellSelect="true"
				editNextOnEnterKey="true" editNextRowCell="true">
					<div property="columns">
						<div type="indexcolumn" headerAlign="center" width="40">
							order
						</div>
						<div field="displayName" width="150" headerAlign="center">
							username
						</div>
						<div name="szbm" field="ouname" width="150" headerAlign="center">
							department
						</div>
						<div name="bmjc" field="oushortName" width="150" headerAlign="center">
							abbreviation of department
						</div>
						<div field="title" width="150" headerAlign="center">
							position
						</div>
						<div field="telephoneOffice" width="150" headerAlign="center">
							office phone
						</div>
						<div field="usermobile" width="150" headerAlign="center">
							cellphone number
						</div>
						<div field="shortMobile" width="150" headerAlign="center">
							cornet
						</div>
						<div field="telephoneHome" width="150" headerAlign="center">
							home phone
						</div>
						<div width="80" headerAlign="center" align="center" renderer="onSendMailRenderer">
							email
						</div>
						<div width="80" headerAlign="center" align="center" renderer="onChatRenderer">
							message
						</div>
					</div>
				</div>
			</div>
		</div>

		
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../../../rest/resource/jsboot"></script>

		<!-- Configuration Variables -->
		<script>
		//<![CDATA[
			//Initialize the page
			epoint.initPage("innerconlistframeaction","", initCallback);
			
			var SendMailAddress;
			var OpenType;

			function initCallback(data) {
				if (data) {
					SendMailAddress = data.SendMailAddress+"&ToUserGuid=";
					OpenType = data.OpenType;
				}
			}

			// Table object
			var grid = mini.get("datagrid");

			//The treejsobject
			var tree = mini.get("tree");
			// Click on the left side of theThe treeRefresh the form on the right side
			tree.on("nodeselect", function(e) {
				var id = e.node.id == 'f9root' ? '' : e.node.id;
				// To the leftThe treeClick on the nodeidIn a hidden field
				// Send the second request, in the table will automatically bring conditions areaThe contents of the
				mini.get('ouguid').setValue(id);
				//Refresh the table
				searchData_treeExp();
			});

			// hiddencolumn
			grid.on("load", function(e) {
				var showDept = mini.get("showDept").getValue();
				var showShortDept = mini.get("showShortDept").getValue();
				if (!!!showDept) {
					grid.hideColumn("szbm");
				}
				if (!!!showShortDept) {
					grid.hideColumn("bmjc");
				}
			});

			function onSendMailRenderer(e) {
				return epoint.renderCell(e, "action-icon icon-mail", "sendMail");
			}

			function onChatRenderer(e) {
				return epoint.renderCell(e, "action-icon icon-chat", "chat");
			}

			// Form,The treeThe search of
			function searchData() {
				epoint.refresh(['datagrid', 'fui-form']);
			}

			// formThe search of
			function searchData_treeExp() {
				epoint.refresh(['datagrid', 'fui-form']);
			}
			
			//send mail
			//modify the url!
		/* 	function sendMail(e) {
				if (SendMailAddress) {
					if (OpenType == "div") {
						epoint.openDialog("send mail", SendMailAddress + e);
					} else if (OpenType == "tab") {
						top.TabsNav.addTab({
							'url' : SendMailAddress + e,
							'name' : "send mail",
							'id' : Math.round(Math.random() * 1000),
							'maxIcon' : true,
							'closeIcon' : true
						});
					}

				}
			} */
			
			function chat(e) {
				top.OpenEMsg(e);
			}
			//]]>
		</script>

	</body>

</html>
