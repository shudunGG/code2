<!DOCTYPE html>
<html>

<head>
<title>群组设置</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../../fui/js/cssboot.js"></script>
</head>
<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" onclick="add">确定添加</a> <a class="mini-button"
				onclick="saveAll">保存修改</a>
		</div>
	</div>

	<div class="fui-condition">
		<!-- 条件区域 -->
		<div class="fui-form" id="fui-form" style="width: 95%">
			<div role="form">
				<div role="row">
					<div role="control" label="父级群组">
						<input class="mini-treeselect" multiSelect="false" id="tree1"
							showRadioButton="true" bind="frameMyAddressGroup.parentgroupguid"
							allowSelect="false" action="getTreeData" />
					</div>
					<div role="control" label="群组名称" starred="true">
						<input id="groupName" bind="frameMyAddressGroup.groupName"
							class="mini-textbox" required="true" requiredErrorText="群组名称不能为空"
							vtype="maxLength:50" />
					</div>
					<!--  <div role="control" label="是否过滤">
						<input id="isFilter" class="mini-checkbox" 
							bind="frameMyAddressGroup.isFilter" trueValue="1" falseValue="0">
						</input>
					</div>-->
					<div role="control" label="排序号">
						<input id="orderNum" bind="frameMyAddressGroup.orderNumber"
							class="mini-textbox" vtype="int;range:0,99999999"/>
					</div>
				</div>
				<input bind="serarchId" id="serarchId" class="mini-hidden" /> 
				<input class="mini-hidden" id="appKey" bind="appGuid" />
			</div>
		</div>
	</div>

	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="datagrid" name="datagrid" class="mini-pagertree"
			idField="groupguid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			showPager="true" action="getDataGridData" allowCellEdit="true"
			allowCellSelect="true" treeColumn="groupname"
			editNextOnEnterKey="true" editNextRowCell="true">
			<div property="columns">
				<div type="indexcolumn" width="50" headerAlign="center">序</div>
				<div name="groupname" field="groupname" width="100%"
					headerAlign="center" vtype="required;maxLength:50">
					群组名称 <input property="editor" class="mini-textbox" required="true"/>
				</div>
				<div field="ordernumber" width="100" headerAlign="center"
					align="right" vtype="int;range:0,99999999">
					排序值 <input property="editor" class="mini-textbox"/>
				</div>
				<div field="isfilter" width="150" headerAlign="center"
					align="center" type="checkboxcolumn" trueValue="1" falseValue="0">
					是否过滤
				</div>
				<div field="sum" width="150" headerAlign="center" align="center">包含联系人数量</div>
				<div width="100" align="center" headerAlign="center"
					renderer="onDelRenderer">删除</div>
			</div>
		</div>
	</div>
</body>

<script src="../../../../../rest/resource/jsboot"></script>

<!-- 配置变量 -->
<script>
	//<![CDATA[  
	//初始化页面
	epoint.initPage("groupmanagelistaction", "", function() {
		//树js对象
		var tree = mini.get("tree1");
		// 点击左侧树刷新右侧表格
		tree.on("nodeclick", function(e) {
			if (e.node) {
				var id = e.node.id;
				mini.get("tree1").setValue(id);
			}
		});

		if (mini.get("tree1").getText() == "群组") {
			mini.get("tree1").setText("");
		}
	});

	// 表格对象
	var grid = mini.get("datagrid");
	
	// 表格的搜索
	function searchDataExcludeTree() {
		epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
	}

	// 绘制行删除按钮
	var onDelRenderer = function(e) {
		return epoint.renderCell(e, "action-icon icon-remove", "deleteSelect",
				"groupguid");
	};

	// 新增操作的回调
	function newCallback(data) {
		if (data.msg) {
			epoint.alert(data.msg, null, null, 'info');
			if (data.success) {
				mini.get("groupName").setValue("");
				mini.get("orderNum").setValue("");
				epoint.refresh([ "datagrid", "fui-form" ], '', true);
			}
		}
	}

	//新增按钮
	function add() {
		if (epoint.validate()) {
			epoint.execute('add', 'fui-form', newCallback);
		}
	}

	//删除按钮
	function deleteSelect(groupguid) {
		epoint.confirm("确定删除选中这个节点和它的子节点吗？", "", function(action) {
			epoint.execute("delete", "", [ groupguid ], function(data) {
				if (data.msg) {
					epoint.alert(data.msg, null, null, 'info');
					epoint.refresh([ "datagrid", "fui-form" ], '', true);
				}
			});
		});
	}

	//保存回调事件
	function saveCallback(data) {
		epoint.alert(data.msg, null, null, 'info');
		epoint.refresh([ "datagrid", "fui-form" ], '', true);
	}

	//保存修改
	function saveAll() {
		grid.validate();
		if (grid.isValid() == false) {
			//alert("请校验输入单元格内容");
			var error = grid.getCellErrors()[0];
			grid.beginEditCell(error.record, error.column);
			return;
		}
		epoint.execute('saveAll', 'datagrid', saveCallback);
	}

	//]]>
</script>
</html>