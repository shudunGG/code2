<!DOCTYPE html>
<html>

	<head>
		<title>public opinion</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<script src="../../../../frame/fui/js/cssboot.js"></script>
	</head>
	<body>
		<!-- Wait for the tooltip -->
		<div class="page-loading"></div>

		<!-- Button area -->
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button" onclick="newOpinion" iconCls="icon-addcircle">The new opinion</a><a
				class="mini-button" onclick="saveOpinion" iconCls="icon-save">Save the opinion</a><a
				class="mini-button" onclick="deleteOpinion" iconCls="icon-minuscircle">Delete the opinion</a>
			</div>
		</div>

		<!-- Condition area -->
		<div class="fui-condition">
			<div class="fui-form" id="fui-form">
				<div role="form">
					<div role="row">
						<div role="control" label="Name of opinion" starred="true">
							<input bind="publicopinionlistaction.txtOpinionText"
								class="mini-textbox" required="true"
								requiredErrorText="Name of opinionCan't be empty,And the length is not greater than50" vtype="maxLength:50" />
						</div>
						<div role="control" label="order no">
							<input bind="publicopinionlistaction.txtOrderNumber"
								class="mini-textbox" vtype="int" selectOnFocus="true" />
						</div>
					</div>
				</div>
			</div>
			<!-- Search button -->
			<a role="searcher" callback="searchData"></a>
		</div>

		<!-- Content area -->
		<div class="fui-content">
			<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="opinionGuid" multiSelect="true" 
			style="width: 100%; height: 100%;" allowResize="true" allowCellValid="true" allowCellEdit="true"
			showPager="true" action="publicopinionlistaction.getDataGridData" 
			allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true">
				<div property="columns">
					<div type="checkcolumn" width="50"></div>
					<div type="indexcolumn" width="50" headerAlign="center">
						order
					</div>
					<div field="opinionText" headerAlign="center" vtype="required;maxLength:50"  width="100%">
						Name of opinion
						<input property="editor" class="mini-textbox" style="width:100%" maxLength="50" />
					</div>
					<div field="orderNumber" headerAlign="center" width="80" align="right" vtype="int" >
						order no
						<input property="editor" class="mini-textbox" maxLength="8"  inputStyle="text-align:right" style="width:100%"  />
					</div>
				</div>
			</div>
		</div>

		<script src="../../../../rest/resource/jsboot"></script>

		<script>
			//<![CDATA[
			//Initialize the page
			epoint.initPage("publicopinionlistaction");
			
			
			// Table object
			var grid = mini.get("datagrid");
			// Load data in the table after open the table editor
			//grid.on("load", function(e) {
			//	var rows = e.sender.findRows();
			//	for (var i = 0; i < rows.length; i++) {
			//		grid.beginEditRow(rows[i]);
			//	}
			//});

			//The new callback event
			function newCallback(data) {
				epoint.alert(data.msg,'',searchData);
				if (data.success) {
					// Empty form
					epoint.refresh(["datagrid"],'',true);
					epoint.clear('fui-form');
				}
			}

			//The new opinion
			function newOpinion() {
				if (epoint.validate(['fui-form'])) {
					//Perform the background of new method
					epoint.execute("add", "fui-form", newCallback);
				}
			}

			//Save the callback event
			function saveCallback(data) {
				epoint.alert(data.msg, '', searchData);
			}

			// Search for tables
			function searchData() {
				epoint.refresh(['datagrid', 'fui-form'],'',true);
			}

			//Save the opinion
			function saveOpinion() {
				grid.validate();
	            if (grid.isValid() == false) {
	                //alert("Please check the input content of cells");
	                var error = grid.getCellErrors()[0];
	                grid.beginEditCell(error.record, error.column);
	                return;
	            }
	            epoint.execute("save", "datagrid", saveCallback);
			}

			//Delete the opinion
			function deleteOpinion() {
				var datagrid = mini.get('datagrid');
				var ids = datagrid.getSelectedIds();
				if (ids.length > 0) {
					epoint.confirm("Sure to delete the selected record?", "", function(action) {
						epoint.execute("delete", "", [ids.join(',')], function(data) {
							if (data.msg) {
								epoint.alert(data.msg);
								epoint.refresh(["datagrid"],'',true);
							}
						});
					});
				} else {
					mini.alert("Please choose to delete records!");
				}
			}

			//]]>
		</script>

	</body>
</html>
