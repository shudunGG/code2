<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Account to choose</title>
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>
<body>
	<div class="page-loading"></div>
	<!-- Content area -->
	<div class="fui-content">
		<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="row_Id" multiSelect="true" 
			style="width: 100%; height: 100%;" allowResize="true"
			showPager="true" action="getDataGridData" allowCellSelect="true"
				editNextOnEnterKey="true" editNextRowCell="true">
			<div property="columns">
				<div type="indexcolumn" width="10" headerAlign="center">
					order
				</div>
				<div field="ouName" headerAlign="center" >
					department
				</div>
				<div field="currentText" name="dl" headerAlign="center" renderer="onDlRender" align="center" width="40">
					log in
				</div>
				<div field="defaultText" width="40" align="center" headerAlign="center" renderer="onDefRender" >
					default
				</div>
				
			</div>
		</div>
	</div>

	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[  
		//Initialize the page
		epoint.initPage('switchparttimeaction');
		
		var grid = mini.get("datagrid");
		
		// Load data in the table after open the table editor
		//grid.on("load", function(e) {
		//	var rows = e.sender.findRows();
		//	for (var i = 0; i < rows.length; i++) {
		//		grid.beginEditRow(rows[i]);
		//	}
		//});
		
		function changeCallBack(data){
			var msg=data.msg;
			if(msg=='needlogin'){
				epoint.closeDialog(0+';'+data.userguid+';'+data.ouguid);
			}else{
				epoint.closeDialog('success');
			}
		}
		
		function checkChanggeOU(userguid,ouguid){
			epoint.confirm("Are you sure to log in??",'',function(){
				epoint.execute('changgeOU', '',[userguid,ouguid], changeCallBack);
			});
		}
		
		
		function onDlRender(e){
			var defaultOu=e.defaultOu;
			//userGuid=e.row['userguid'];
			//ouGuid=e.row['ouguid'];
			//var text="To log in";
			//if(defaultOu==e.row['ouguid']){
			//	text="The current login identity";
			//}
			var url=e.value;
			if(e.value!='The current login identity'){
				url="<a class=\"link\" style=\"cursor:pointer\" onclick=\"checkChanggeOU('"+e.row['userguid']+"','"+e.row['ouguid']+"')\" >"+e.value+"</a>";
			}
			return url;
		}
		
		function onDefRender(e){
			var url=e.value;
			
			if(e.value=='Set up the'){
				url="<a class=\"link\" style=\"cursor:pointer\" onclick=\"saveOrUpdateUserConfig('"+e.row['userguid']+"','IsDefaultOU','"+e.row['ouguid']+"')\" >"+e.value+"</a>";
			}
			return url;
		}
		
		function saveOrUpdateUserConfig(userguid,configname,ouguid){
			epoint.execute('saveOrUpdateUserConfig', '',[userguid,configname,ouguid],saveDefaultCallBack);
		}
		
		// Search for tables
		function searchData() {
			epoint.refresh([ 'datagrid'],'',true);
		}
		
		function saveDefaultCallBack(data){
			searchData();
		}
		
		
		//]]>
	</script>


</body>
</html>
