<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>账号选择</title>
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>
<body>
	<div class="page-loading"></div>
	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="row_Id" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			showPager="true" action="getDataGridData" allowCellSelect="true"
			editNextOnEnterKey="true" editNextRowCell="true">
			<div property="columns">
				<div type="indexcolumn" width="10" headerAlign="center">序</div>
				<div field="ouName" headerAlign="center">部门名称</div>
				<div field="currentText" name="dl" headerAlign="center"
					renderer="onDlRender" align="center" width="40">以此身份登录</div>
				<div field="defaultText" width="40" align="center"
					headerAlign="center" renderer="onDefRender">默认以此身份登录</div>

			</div>
		</div>
	</div>

	<script src="../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[  
		//初始化页面
		epoint.initPage('switchparttimeaction');

		var grid = mini.get("datagrid");

		// 在表格数据加载完之后打开表格编辑状态
		//grid.on("load", function(e) {
		//	var rows = e.sender.findRows();
		//	for (var i = 0; i < rows.length; i++) {
		//		grid.beginEditRow(rows[i]);
		//	}
		//});

		function changeCallBack(data) {
			var msg = data.msg;
			if (msg == 'needlogin') {
				epoint.closeDialog(0 + ';' + data.userguid + ';' + data.ouguid);
			} else {
				epoint.closeDialog('success');
			}
		}

		function checkChanggeOU(userguid, ouguid) {
			epoint.confirm("您确定以此身份登录？", '', function() {
				epoint.execute('changgeOU', '', [ userguid, ouguid ],
						changeCallBack);
			});
		}

		function onDlRender(e) {
			var defaultOu = e.defaultOu;
			//userGuid=e.row['userguid'];
			//ouGuid=e.row['ouguid'];
			//var text="以此身份登录";
			//if(defaultOu==e.row['ouguid']){
			//	text="当前登录身份";
			//}
			var url = e.value;
			if (e.value != '当前登录身份') {
				url = "<a class=\"link\" style=\"cursor:pointer\" onclick=\"checkChanggeOU('"
						+ e.row['userguid']
						+ "','"
						+ e.row['ouguid']
						+ "')\" >" + e.value + "</a>";
			}
			return url;
		}

		function onDefRender(e) {
			var url = e.value;

			if (e.value == '设置') {
				url = "<a class=\"link\" style=\"cursor:pointer\" onclick=\"saveOrUpdateUserConfig('"
						+ e.row['userguid']
						+ "','IsDefaultOU','"
						+ e.row['ouguid'] + "')\" >" + e.value + "</a>";
			}
			return url;
		}

		function saveOrUpdateUserConfig(userguid, configname, ouguid) {
			epoint.execute('saveOrUpdateUserConfig', '', [ userguid,
					configname, ouguid ], saveDefaultCallBack);
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid'],'',true);
		}

		function saveDefaultCallBack(data) {
			searchData();
		}

		//]]>
	</script>


</body>
</html>