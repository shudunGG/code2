<!DOCTYPE html>
<html>

<head>
<title></title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script src="../../../../fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>

	<!-- toolbar area -->
	<div class="fui-toolbar">
		<div class="uc-handlecontrols" id="handlecontrols"
			action="handlecontrolsaction.handleCtrl" style="width: 100%"></div>
	</div>

	<div class="fui-content">
		<!-- Hide button id Do not modify -->
		<div class="hidden">
			<a class="mini-button" id="btnSaveFrom" onclick="saveFrom();">save</a>
			<a class="mini-button" id="btnSubmit" onclick="submit();">submit</a>
		</div>
		<div class="fui-left">
			<!-- On the left side of the title of the
             @local The internationalization of identity     Said in the language pack'sysParamCategory'The values-->
			<div role="head" title="">
				<!--             <a class="action-icon icon-gear" title="Classification management" onclick="openType();"></a> -->
			</div>
			<!-- The content of the left area -->
			<div role="body">
				<ul id="tree" name="tree" class="mini-tree" style="width: 100%;"
					showTreeIcon="true" textField="text" idField="id"
					action="getTreeModal">
				</ul>
			</div>
		</div>
		<!-- About the layout on the right side of the content of the page -->
		<div class="fui-right" id="fui-right">
			<div id="tabs1" class="mini-tabs" activeIndex="0"
				style="width: 100%; height: 100%;" bodyStyle="padding:0;border:0;">
			</div>
		</div>
		
		<!-- 
		showmode(According to opinion template pattern)
		   1:(The default)According to opinion template areaTemplate, but only show personal opinion
		   2:According to opinion template areaTemplate, public and personal opinion
		   3:Don'tAccording to opinion template area
		-->
		<div class="uc-workflowfloatopinion" id="workflowfloatopinion"
			action="workflowopinionaction.floatOpinionCtrl" 
			data-options="{'showmode' : 1}"></div>
	</div>

	<input class="mini-hidden" id="pageUrl" bind="map" />

	<script src="../../../../../rest/resource/jsboot"></script>
	
 
 	<script type="text/javascript">var miniLocal='en_US.js';</script>
 	<script src="../../js/workflowjsboot.js"></script>

	<script>
		//<![CDATA[ 
		//Initialize the page
		epoint.initPage("handlemainaction");

		var tree = mini.get("tree");
		var tabs = mini.get("tabs1");
		var openNodesArray = [];
		var openEdit = [];
		var formNum = 0;

		function saveFrom() {
			var tabsCount = tabs.getTabs().length;
			if(!tabsCount){
				HeaderSubmit();
				return;
			}
			for (var n = 0; tabsCount != null && tabsCount > 0 && n < tabsCount; n++) {
				if (tabs.getTabIFrameEl(tabs.getTab(n)) != null) {
					if (tabs.getTabIFrameEl(tabs.getTab(n)).contentWindow.mini
							.get("btnSaveFrom") != null) {
						tabs.getTabIFrameEl(tabs.getTab(n)).contentWindow.mini
								.get("btnSaveFrom").doClick();
					}
				}
			}
		}

		function submit() {
			var tabNum = tabs.getTabs().length;
			if(!tabNum){
				HeaderSubmit();
				return;
			}
			formNum = 0;
			for (var n = 0; tabNum != null && tabNum > 0 && n < tabNum; n++) {
				if (tabs.getTabIFrameEl(tabs.getTab(n)) != null
						&& tabs.getTabIFrameEl(tabs.getTab(n)).contentWindow.mini
								.get('btnSubmit') != null) {
					formNum += 1;
				}
			}
			for (var n = 0; tabNum != null && tabNum > 0 && n < tabNum; n++) {
				if (tabs.getTabIFrameEl(tabs.getTab(n)) != null) {
					if (tabs.getTabIFrameEl(tabs.getTab(n)).contentWindow.mini
							.get('btnSubmit') != null) {
						tabs.getTabIFrameEl(tabs.getTab(n)).contentWindow.mini
								.get('btnSubmit').doClick();
					}
				}
			}
		}

		function headerMainSubmit() {
			formNum -= 1;
			if (formNum == 0) {
				HeaderSubmit();
			}
		}

		// Click on the left side of the tree to refresh the right form
		tree.on("nodeselect", function(e) {
			//Per click to get at a time tabs,will array In theDon'tContains the removal
			tabs = mini.get("tabs1");
			openEdit = [];
			for (var n = 0; openNodesArray != null && openNodesArray.length > 0
					&& n < openNodesArray.length; n++) {
				if (containsTwo(tabs, openNodesArray[n])) {
					openEdit.push(openNodesArray[n]);
				}
			}
			
			openNodesArray = openEdit;

			//The second straton node
			if (e.node._level == 2) {
				var id = e.node.id;
				//Get the address
				var add = mini.get("pageUrl").getValue();
				if (add != null && add[e.node.id] != null
						&& add[e.node.id] != "") {
					var src = Util.getRightUrl(add[e.node.id]);

					if (contains(openNodesArray, e.node.id)) {
						var tab2 = {
							title : e.node.text,
							name : e.node.id,
							showCloseButton : true,
							url : src
						};
						tabs.addTab(tab2);
						tabs.activeTab(tabs.getTab(tab2));
						openNodesArray.push(e.node.id);
					}
				}
			}
		});

		function contains(arr, obj) {
			if(!arr || arr.length == 0) return true;
			var i = arr.length;
			while (i--) {
				if (arr[i] == obj) {
					return false;
				}
			}
			return true;
		}

		function containsTwo(arr, obj) {
			if(!arr || arr.length == 0) return false;
			var i = arr.getTabs().length;
			while (i--) {
				if (arr.getTab(i).name == obj) {
					return true;
				}
			}
			return false;
		}

		//]]>
	</script>

</body>

</html>
