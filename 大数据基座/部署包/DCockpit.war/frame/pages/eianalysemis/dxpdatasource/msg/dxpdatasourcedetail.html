<!DOCTYPE html>
<html>

<head>
<title>数据源管理子页面</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../../fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>
	<!-- toolbar区域 -->

	<div class="fui-content">
		<!-- 表单布局 -->
		<div class="fui-form" id="fui-form">
			<div role="form">
				<!-- 2列 -->
				<!-- 加2个input防止密码浏览器自动填入 -->
				<input type="text" name="username" class="hidden-accessible" /><input
					type="password" class="hidden-accessible" />
				<div role="row">
					<div role="control" label="数据源名称">
						<input class="mini-outputtext" bind="dataBean.dsName"
							required="true" requiredErrorText="数据源名称不能为空"
							vtype="maxLength:50" />
					</div>
					<div role="control" label="数据源类型">
						<input name="dsType" bind="dataBean.dsType" id="dsType"
							class="mini-outputtext" />
					</div>
				</div>
				<div role="row" id="loginRow">
					<div role="control" label="登录帐户">
						<input id="loginUser" class="mini-outputtext"
							bind="dataBean.loginUser" required="true"
							requiredErrorText="登录帐户不能为空" />
					</div>
					<div role="control" label="登录密码">
						<input id="loginPwd" class="mini-outputtext"
							bind="dataBean.loginPwd" required="true"
							requiredErrorText="登录密码不能为空" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="所属部门">
						<input id="id_ouguid" class="mini-outputtext" textField="text"
							bind="dataBean.ouname" />
					</div>
					<div role="control" label="排序号">
						<input class="mini-outputtext" bind="dataBean.OrderNumber" />
					</div>
				</div>
				<div role="row" id="conntype">
					<div role="control" label="配置类型">
						<div id="conntype" class="mini-outputtext"
							bind="dataBean.conntype"></div>
					</div>
				</div>
				<div role="row" id="serverdbname">
					<div role="control" label="服务器名称或地址">
						<input id="serverName" class="mini-outputtext"
							bind="dataBean.serverName" required="true"
							requiredErrorText="服务器名称或地址不能为空" />
					</div>
				</div>
				<div role="row" id="dbname">
					<div role="control" label="数据库名称">
						<input id="dbname" class="mini-outputtext" bind="dataBean.dbname"
							required="true" requiredErrorText="数据库名称不能为空" />
					</div>
				</div>
				<div role="row" id="schemaRow" style="display: none;">
					<div role="control" label="模式名称">
						<input class="mini-outputtext" bind="dataBean.schemaname"
							required="true" requiredErrorText="模式名称不能为空" />
					</div>
				</div>
				<div role="row" id="encodeRow" style="display: none;">
					<div role="control" label="服务器编码">
						<input class="mini-outputtext" bind="dataBean.encode" />
					</div>
				</div>
				<div role="row" id="zookeeperRow" style="display: none;">
					<div role="control" label="ZookeeperHostname">
						<input class="mini-outputtext" bind="dataBean.zookeeperhostname" />
					</div>
					<div role="control" label="ZookeeperPath">
						<input class="mini-outputtext" bind="dataBean.zookeeperpath"
							required="true" requiredErrorText="ZookeeperPath不能为空" />
					</div>
				</div>
				<div role="row" id="kafkaHelpRow">
					<div role="control" style="color: red">
						kafka：需先向大数据管理平台申请kafka超级管理员账号：kafkaclient@epoint，获取认证文件kafkaclient.keytab和krb5.conf并上传。</div>
				</div>
				<div role="row" id="kafkaRow">
					<div role="control" label="Kafka超级管理员">
						<input class="mini-outputtext" bind="dataBean.principal" />
					</div>
					<div role="control" label="认证文件">
						<div id="uploader" class="mini-webuploader" pickerText="上传"
							action="getFileUploadModel" limitType="keytab,conf"
							fileNumLimit="2" dataImport="true" auto=true></div>
					</div>
				</div>
				<div role="row" id="debeziumApiUrlRow">
					<div role="control" label="debeziumApiUrl">
						<input class="mini-outputtext" bind="dataBean.debeziumApiUrl" />
					</div>
				</div>
				<div role="row" id="connectionstr">
					<div role="control" label="数据源连接字符串">
						<input id="connectionString" class="mini-outputtext"
							bind="dataBean.connectionString" required="true"
							requiredErrorText="数据源连接字符串不能为空" />
					</div>
				</div>
				<!-- 				<div role="row" id="relateHive" style="display: none;">
					<div role="control" id="relateHive" label="关联hive数据源"  >
						<input id="relateHiveDs" class="mini-combobox"
							bind="hiveDsid" 
							action="getHiveDsList" requiredErrorText="关联hive数据源不能为空!" />
					</div>
				</div>
				<div role="row" id="relateHdfs" style="display: none;">
					<div role="control" id="relateHdfs" label="关联hdfs数据源"  >
						<input id="relateHdfsDs" class="mini-combobox"
							bind="hdfsDsid" required="true"
							action="getHdfsDsList" requiredErrorText="关联hdfs数据源不能为空!" />
					</div>
				</div> -->
				<div role="row" id="dsdesc">
					<div role="control" label="数据源描述">
						<input class="mini-outputtext" bind="dataBean.dsDesc"
							vtype="maxLength:100" />
					</div>
				</div>

				<div role="row" id="apirequest">
					<div role="control" label="请求类型">
						<input id="requestType" bind="requestType"
							class="mini-radiobuttonlist" action="getRequestTypeList"
							required="true" requiredErrorText="请求类型/方法不能为空"
							onvaluechanged="setmethod3" readOnly="true"/>
					</div>
					<div role="control" label="服务源类型" starred="true" id="apitype">
						<input id="apiurltype" bind="apiurltype"
							class="mini-radiobuttonlist"
							data="[{value:'0',text:'RestAPI'},{value:'1',text:'WebService'}]"
							textField="text" valueField="value" required="true"
							onvaluechanged="setmethod" readOnly="true"/>
					</div>

				</div>
				<div role="row" id="apicontype">
					<div role="control" label="Content-Type">
						<input id="contentType" bind="contentType"
							class="mini-radiobuttonlist"
							data="[{value:'0',text:'application/x-www-form-urlencoded'},{value:'1',text:'application/json'}]"
							textField="text" valueField="value" required="true" readOnly="true"/>
					</div>
				</div>
				<div role="row" id="apiurl">
					<div role="control" label="接口源地址" id="apiUrlDiv" starred="true">
						<input bind="apiUrl" id="apiurl" style="margin-right: 10px"
							class="mini-outputtext" onvalidation="urlCheck" required="true"
							requiredErrorText="接口源地址不能为空" onvaluechanged="change()" /> 
					</div>
				</div>
				<div role="row" id="wsdlFileUploadRow">
					<div role="control" label="方法名" id="methodrow" starred="true">
						<input class="mini-outputtext" showNullItem="true" required="true"
							onvaluechanged="methodChanged" bind="method" showClose="true"
							oncloseclick="onCloseClick" emptyText="请选择..."
							nullItemText="请选择..." id="method" textField="text"
							allowInput="true" valueField="value"
							requiredErrorText="WebService方法名不能为空" />
					</div>
					<div role="control"></div>
				</div>
			</div>
		</div>
	</div>
	<script src="../../../../fui/js/jsboot.js"></script>

	<!-- 配置变量 -->
	<script>
		// 初始化页面
		epoint.initPage('dxpdatasourcedetailaction', '', initCallBack);

		// 初始化操作的回调
		function initCallBack(data) {
			if (mini.get('conntype').getValue()) {
				if (mini.get('conntype').getValue() == '连接字符串配置') {//连接字符串配置
					$('#serverdbname').hide();
					$('#connectionstr').show();
				} else {//服务器数据库名称配置
					$('#connectionstr').hide();
					$('#serverdbname').show();
				}
			}
			var dsType = mini.get('dsType').getValue();
			//Util.form.showField('#node');
			//mini.get('belongNode').setVisible(true);
			if (dsType == 'dm' || dsType == 'postgresql'
					|| dsType == 'GaussDB200') {
				$('#schemaRow').show();
				$('#encodeRow').hide();
				$('#zookeeperRow').hide();
				$('#dbname').show();
				$('#loginRow').show();
				$('#kafkaHelpRow').hide();
				$('#kafkaRow').hide();
				$('#debeziumApiUrlRow').hide();
				//$('#relateHive').hide();
				//$('#relateHdfs').hide();
			} else if (dsType == 'HDFS' || dsType == 'HadoopCluster') {
				$('#schemaRow').hide();
				$('#encodeRow').hide();
				$('#zookeeperRow').show();
				$('#dbname').hide();
				$('#loginRow').show();
				$('#kafkaHelpRow').hide();
				$('#kafkaRow').hide();
				$('#debeziumApiUrlRow').hide();
				//$('#relateHive').hide();
				//$('#relateHdfs').hide();
			} else if (dsType == 'SFTP') {
				$('#schemaRow').hide();
				$('#encodeRow').show();
				$('#zookeeperRow').hide();
				$('#dbname').hide();
				$('#loginRow').show();
				$('#kafkaHelpRow').hide();
				$('#kafkaRow').hide();
				$('#debeziumApiUrlRow').hide();
				//$('#relateHive').hide();
				//$('#relateHdfs').hide();
			} else if (dsType == 'mongodb') {
				$('#schemaRow').hide();
				$('#encodeRow').hide();
				$('#zookeeperRow').hide();
				$('#dbname').hide();
				$('#loginRow').show();
				$('#kafkaHelpRow').hide();
				$('#kafkaRow').hide();
				$('#debeziumApiUrlRow').hide();
				//$('#relateHive').hide();
				//$('#relateHdfs').hide();
			} else if (dsType == 'kafka') {
				$('#schemaRow').hide();
				$('#encodeRow').hide();
				$('#zookeeperRow').hide();
				$('#dbname').hide();
				$('#loginRow').hide();
				$('#kafkaHelpRow').show();
				$('#kafkaRow').show();
				$('#debeziumApiUrlRow').show();
				//$('#relateHive').hide();
				//$('#relateHdfs').hide();
				//mini.get('belongNode').setVisible(false);
				//Util.form.hideField('#node');
			} else if (dsType == 'presto') {
				$('#schemaRow').hide();
				$('#encodeRow').hide();
				$('#zookeeperRow').hide();
				$('#dbname').show();
				$('#loginRow').show();
				$('#kafkaHelpRow').hide();
				$('#kafkaRow').hide();
				$('#debeziumApiUrlRow').hide();
				//$('#relateHive').show();
			} else if (dsType == 'hive2') {
				$('#schemaRow').hide();
				$('#encodeRow').hide();
				$('#zookeeperRow').hide();
				$('#dbname').show();
				$('#loginRow').show();
				$('#kafkaHelpRow').hide();
				$('#kafkaRow').hide();
				$('#debeziumApiUrlRow').hide();
				//$('#relateHive').hide();
				//$('#relateHdfs').show();
			} else if (dsType == 'API') {
				$('#schemaRow').hide();
				$('#encodeRow').hide();
				$('#zookeeperRow').hide();
				$('#dbname').hide();
				$('#loginRow').hide();
				$('#kafkaHelpRow').hide();
				$('#kafkaRow').hide();
				$('#debeziumApiUrlRow').hide();
				$('#relateHive').hide();
				$('#serverdbname').hide();
				$('#dsdesc').hide();
				$('#apirequest').show();
				$('#apicontype').show();
				$('#apiurl').show();
				$('#wsdlFileUploadRow').show();
				$('#conntype').hide();
				$('#connectionstr').hide();
				$('#conntype').hide();
				$('#dsdesc').hide();
				var apiurltype = mini.get('apiurltype').getValue();
				if (apiurltype == '0') {
					Util.form.hideField('#methodrow');
					var requestType = mini.get('requestType').getValue();
					if (requestType == '1') {
						$('#contype').css('display', 'none');
					} else {
						$('#contype').css('display', 'block');
					}
					$('#parseWsUrl').css('display', 'none');
					$('#wsdlFileUploadRow').css('display', 'none');
				} else {
					Util.form.showField('#methodrow');
					$('#contype').css('display', 'none');
					$('#parseWsUrl').css('display', 'block');
					$('#wsdlFileUploadRow').css('display', 'block');
					mini.get('method').enable();
				}
			} else {
				$('#schemaRow').hide();
				$('#encodeRow').hide();
				$('#zookeeperRow').hide();
				$('#dbname').show();
				$('#loginRow').show();
				$('#kafkaHelpRow').hide();
				$('#kafkaRow').hide();
				$('#debeziumApiUrlRow').hide();
				//$('#relateHive').hide();
				//$('#relateHdfs').hide();
			}
		}

		// 文件加入列表时，向文件列表中添加记录
		function onFilesQueued(event) {
			var files = event.files, html = [], item = '';
			// 向文件列表中添加记录
			for (var i = 0, len = files.length; i < len; i++) {
				item = '<div id="' + files[i].id + '" class="mini-uploader-item">'
						+ '<span class="mini-uploader-info">'
						+ files[i].name
						+ '</span>'
						+ '<a href="#" onclick="deletet(this)" class="mini-uploader-remove" fileId="'
						+ files[i].id + '">删除</a></div>';
				html.push(item);
			}
			if (event.sender.id == "uploader1") {
				jQuery(transList).append(html.join(''));
			} else {
				jQuery(jobList).append(html.join(''));
			}
		}
	</script>

</body>

</html>
