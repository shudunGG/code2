<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>新增卡片主题</title>
<!-- 请修改相对路径 -->
<script src="../../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" iconCls="icon-save" id="addClose"
				onclick="saveAndClose">保存并关闭</a>
		</div>
	</div>

	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="fui-form" class="fui-form">
			<div role="form">
				<div class="fui-accordions">
					<div role="accordion" opened="true" ontoggle="onToggle">
						<div role="head" title="基本信息"></div>
						<div role="body">
							<div role="row">
								<div role="control" label="卡片名称" starred="true">
									<input class="mini-textbox" bind="dataBean.CardName"
										required="required" requiredErrorText="卡片名称不能为空"
										vtype="maxLength:50;" emptyText="请填写卡片名称..." />
								</div>
							</div>
							<div role="row">
								<div role="control" label="卡片描述">
									<input class="mini-textarea" bind="dataBean.Remark"
										emptyText="请填写卡片描述..." />
								</div>
							</div>
							<div role="row">
								<div role="control" label="卡片高度">
									<input class="mini-textbox" bind="dataBean.cardHeight"
										vtype="double;range:0,99999;" emptyText="请填写卡片高度..." />
								</div>
							</div>
							<div role="row">
								<div role="control" label="排序号">
									<input class="mini-textbox" bind="dataBean.OrderNum"
										vtype="int;range:0,99999;" emptyText="请填写排序号..." />
								</div>
							</div>
							<!-- <div role="row">
								<div role="control" label="卡片类型" starred="true">
									<input class="mini-combobox" allowInput="false"
										action="getCardTypeModel" bind="dataBean.CardType"
										textField="text" valueField="id" emptyText="请选择卡片类型..."
										required="required" requiredErrorText="卡片类型不能为空" />
								</div>
							</div>
							<div role="row">
								<div role="control" label="卡片模板" starred="true">
									<input class="mini-buttonedit" bind="dataBean.TemplateGuid"
										id="TemplateGuid" onbuttonclick="onTemplateChoose"
										emptyText="请选择卡片模板..." required="required"
										requiredErrorText="卡片模板不能为空" />
								</div>
							</div>
							<div role="row">
								<div role="control" label="卡片色系" starred="true">
									<input id="cardColor" class="mini-colorpicker"
										bind="dataBean.cardColor" format="hex" allowInput="true" />
								</div>
							</div> -->
						</div>
					</div>
					<div role="accordion" opened="true" ontoggle="onToggle">
						<div role="head" title="专班配置"></div>
						<div role="body">
							<div role="row">
								<div role="control" label="专班名称">
									<input id="classname" class="mini-combobox"
										action="getSpecialClassModel" bind="dataBean.specialclassguid"
										showClose="true" oncloseclick="onCloseClick"
										onValueChanged="nameChange" />
								</div>
							</div>
							<div role="row">
								<div role="control" label="责任部门">
									<input id="liableou" class="mini-treeselect"
										action="selectouaction.getLazyTreeModal"
										bind="dataBean.liableouguid" showFolderCheckBox="true"
										showRadioButton="true" showTreeIcon="true" textField="text"
										idField="id" expandOnLoad="true" enabled="false"/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="责任人">
									<input id="liablePer" class="mini-treeselect"										
										action="selectouuseraction.getTreeModel"
										bind="dataBean.liablePerGuid" showFolderCheckBox="true"
										showRadioButton="true" showTreeIcon="true" textField="text"
										idField="id" expandOnLoad="true" enabled="false"/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="分管领导">
									<input id="leader" class="mini-treeselect"
										action="selectouuseraction.getTreeModel"
										bind="dataBean.leaderguid" showFolderCheckBox="true"
										showRadioButton="true" showTreeIcon="true" textField="text"
										idField="id" expandOnLoad="true" enabled="false"/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="组长">
									<input id="groupleader" class="mini-treeselect"
										action="selectouuseraction.getTreeModel"
										bind="dataBean.groupleaderguid" showFolderCheckBox="true"
										showRadioButton="true" showTreeIcon="true" textField="text"
										idField="id" expandOnLoad="true" enabled="false"/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="副组长">
									<input id="deputygroupleader" class="mini-treeselect"
										action="selectouuseraction.getTreeModel"
										bind="dataBean.deputygroupleaderguid"
										showFolderCheckBox="true" showRadioButton="true"
										showTreeIcon="true" textField="text" idField="id"
										expandOnLoad="true" enabled="false"/>
								</div>
							</div>
							<div role="row">
								<div role="control" label="组员">
									<input id="groupmembers" class="mini-treeselect"
										multiSelect="true" action="selectouuseraction.getTreeModel"
										bind="dataBean.groupmemberguids" textField="text"
										valueField="id" parentField="pid" autoCheckParent="true"
										checkRecursive="true" showFolderCheckBox="true"
										expandOnLoad="true" showClose="true"
										oncloseclick="onCloseClick" enabled="false"/>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- 请修改相对路径 -->
		<script src="../../../../../rest/resource/jsboot"></script>

		<script>
			// 初始化页面
			epoint.initPage('cockpitcardaddaction', null, function(data) {
				if (data.msg) {
					epoint.alertAndClose(data.msg);
					return;
				}
				if (data.templateName) {
					mini.get('TemplateGuid').setText(data.templateName);
				}
				mini.get("groupmembers").setText(data.groupMemberNames);
				mini.get("liablePer").setText(data.liablePerName);
				mini.get("leader").setText(data.leaderName);
				mini.get("groupleader").setText(data.groupleaderName);
				mini.get("deputygroupleader").setText(
						data.deputygroupleaderName);
			});

			function saveAndClose() {
				if (epoint.validate()) {
					epoint.execute('save', 'fui-form', closeCallback);
				}
			}

			// 新增操作的回调
			function closeCallback(data) {
				if (data.msg) {
					epoint.alertAndClose(data.msg);
				}
			}

			function beforenodeselect(e) {
				//禁止选中 ckr=false节点
				if (e.node.ckr == false) {
					e.cancel = true;
				}
			}

			function onCloseClick(e) {
				var obj = e.sender;
				obj.setText("");
				obj.setValue("");
			}

			//弹出隶属系统选择页面
			function onTemplateChoose(e) {
				epoint
						.openTopDialog(
								'选择卡片模板',
								"frame/pages/eianalysemis/cockpit/cockpitcard/cockpitcardtemplatechooselist",
								ondestroy, {
									'width' : 1200,
									'height' : 800
								});
			}

			function ondestroy(action) {
				var templateGuid = mini.get("TemplateGuid");
				if (action == "ok") {
					var iframe = this.getIFrameEl();
					var data = iframe.contentWindow.GetData();
					if (data) {
						templateGuid.setValue(data[0]);
						templateGuid.setText(data[1]);
						epoint.validate('TemplateGuid');
					}
				}
			}

			//方法改变时发生
			function nameChange(e) {
				epoint.execute('getSpecialClassInfo', '', e.selected.id,
						function(data) {
							if (data.msg) {
								mini.get('liableou').setValue(data.msg.liableouguid);
								mini.get("groupmembers").setText(data.groupMemberNames);
								mini.get("liablePer").setText(data.liablePerName);
								mini.get("leader").setText(data.leaderName);
								mini.get("groupleader").setText(data.groupleaderName);
								mini.get("deputygroupleader").setText(data.deputygroupleaderName);								
							}
						});
			}
		</script>
</body>
</html>