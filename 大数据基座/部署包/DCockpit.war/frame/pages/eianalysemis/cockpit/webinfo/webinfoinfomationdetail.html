<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>信息发布</title>
    <!-- 请修改相对路径 -->
    <script>
        var pathName = window.document.location.pathname;
        var projectName = pathName.substring(0, pathName.substr(1).indexOf('/') + 1);
        window.UEDITOR_HOME_URL = projectName + "/frame/pages/eianalysemis/cockpit/js/ueditor/";
    </script>
    <script src="../../../../../frame/fui/js/cssboot.js"></script>
    <script type="text/javascript" charset="utf-8"
            src="../js/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8"
            src="../js/ueditor/_examples/editor_api.js"></script>
    <style>
        #editor {
            height: 300px;
        }
    </style>
</head>

<body>
<!-- 必须有，加载时的loading效果 -->
<div class="page-loading"></div>
<!-- toolbar区域 -->

<!-- 内容区域 -->
<div class="fui-content">
    <div id="fui-form" class="fui-form">
        <div role="form">
            <div role="row">
                <div role="control" label="信息标题">
                    <div class="mini-outputtext" bind="dataBean.title"></div>
                </div>
                <div role="control" label="所属栏目">
                    <div class="mini-outputtext" bind="dataBean.categoryname"></div>
                </div>
            </div>
            <div role="row">
                <div role="control" label="信息类型">
                    <div class="mini-outputtext" bind="dataBean.infotypename"></div>
                </div>
                <div role="control" label="标题类型" id="titletypename">
                    <div class="mini-outputtext" bind="dataBean.titletypename"></div>
                </div>
            </div>
            <div role="row">
                <div role="control" label="发布日期">
                    <div class="mini-outputtext" bind="dataBean.publishdate"
                         data-options="{'format':'yyyy-MM-dd'}" dateFormat="yyyy-MM-dd"></div>
                </div>
                <div role="control" label="截止有效期">
                    <div class="mini-outputtext" bind="dataBean.publishenddate"
                         data-options="{'format':'yyyy-MM-dd'}" dateFormat="yyyy-MM-dd"></div>
                </div>
            </div>
            <div role="row" id="apiUrl">
                <div role="control" label="创建日期">
                    <div class="mini-outputtext" bind="dataBean.pubtime"
                         data-options="{'format':'yyyy-MM-dd'}" dateFormat="yyyy-MM-dd"></div>
                </div>
                <div role="control" label="状态">
                    <div class="mini-outputtext" bind="dataBean.status"></div>
                </div>
            </div>
            <div role="row">
                <div role="control" label="发布人">
                    <div class="mini-outputtext" bind="dataBean.createusername"></div>
                </div>
            </div>
            <div role="row" id="picrow">
                <div role="control" label="标题图片">
                    <div id="uploader" class="mini-webuploader" pickerText="上传图片"
                         action="getPicModel" limitType="jpeg,jpg,gif,png,bmp"
                         auto="true" fileNumLimit="1" onfilesuccess="OnPictureSuccess"
                         fileSizeLimit="100k"></div>
                    <div class="img-view" id="picture" style="display: none;"></div>

                </div>
                <div role="control" label="轮播图片">
                    <div id="uploader2" class="mini-webuploader" pickerText="上传图片"
                         action="getListPicModel" limitType="jpeg,jpg,gif,png,bmp"
                         auto="true" fileNumLimit="1" onfilesuccess="OnPictureSuccess2"
                         fileSizeLimit="100k"></div>
                    <div class="img-view" id="picture2" style="display: none;"></div>
                </div>
            </div>
            <div role="row" id="radiorow">
                <div role="control" label="视频上传">
                    <div id="uploader4" class="mini-webuploader" pickerText="上传视频"
                         action="getRadiomodel" limitType="mp4,avi,mpeg,navi,asf,mov,wmv,3gp,flv,f4v,rm,rmvb"
                         auto="true" fileNumLimit="1" fileSizeLimit="10240k"></div>
                </div>
                <div role="control" label=""></div>
            </div>
            <div role="row" id="introduce">
                <div role="control" label="简介">
                    <div class="mini-outputtext" bind="dataBean.overview"></div>
                </div>
            </div>
            <div role="row" id="content">
                <div role="control" label="发布内容">
                    <script id="container" name="content" type="text/plain"></script>
                    <script type="text/javascript">
                        var ue = UE.getEditor('container');
                    </script>
                </div>
            </div>
            <div role="row" id="url">
                <div role="control" label="链接地址">
                    <input class="mini-outputtext"" bind="dataBean.url" />
                </div>
            </div>
            <div role="row" id="attachfile">
                <div role="control" label="附件">
                    <div id="uploader3" class="mini-webuploader" pickerText="上传附件"
                         action="getAttachModel" showDefaultUI="true" onload="onload"
                         limitType="xls,xlsx,docx,doc,txt,ppt,pptx,pdf,rar,zip,7z,mp3,mp4"
                         auto="true" fileNumLimit="5" fileSizeLimit="10000k"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 请修改相对路径 -->
<script src="../../../../../rest/resource/jsboot"></script>

<script>
    // 初始化页面
    epoint.initPage('webinfoinfomationdetailaction', null, function (data) {
        if ('news' == data.infotype) {
            $("#url").hide();
            if (data.content) {
                var content = escape2html(data.content);
                ue.ready(function () {
                    ue.setContent(content);
                    ue.setDisabled();
                });
            }
            if ("1" == data.titletype) {
                $("#picrow").hide();
                $("#radiorow").hide();
            } else if ("2" == data.titletype) {
                $("#radiorow").hide();
            } else if ("3" == data.titletype) {
                $("#picrow").hide();
            }
        }
        if ('link' == data.infotype) {
            $("#content").hide();
            $("#introduce").hide();
            $("#attachfile").hide();
            $("#titletypename").hide();
            $("#picrow").hide();
            $("#radiorow").hide();
        }
        $(".mini-uploader-btns").css("display", "none");
        // 展示图片
        if (data.pic1) {
            showPicture(data.pic1);
        }
        if (data.pic2) {
            showPicture2(data.pic2);
        }
    });

    function escape2html(str) {
        var arrEntities = {
            'lt': '<', 'gt': '>',
            'nbsp': ' ',
            'amp': '&',
            'quot': '"'
        };
        return str.replace(/&(lt|gt|nbsp|amp|quot);/ig, function (all, t) {
            return arrEntities[t];
        });
    }

    //上传成功
    function OnPictureSuccess(args) {
        if (args.data.extraDatas.obj) {
            showPicture(args.data.extraDatas.obj);
        }
    }

    //展示图片
    function showPicture(tb) {
        $(".mini-uploader-list:eq(0)").empty();
        $("#picture").show();
        $("#picture")
            .html(
                '<img id="tb" src="" width="120px" height="120px" alt="图标" /> ');
        $("#tb").attr("src", tb.picture);
        mini.get("uploader").setVisible(false);
    }

    //轮播图片上传成功
    function OnPictureSuccess2(args) {
        if (args.data.extraDatas.obj) {
            showPicture2(args.data.extraDatas.obj);
        }
    }

    //展示图片
    function showPicture2(tb) {
        $(".mini-uploader-list:eq(1)").empty();
        $("#picture2").show();
        $("#picture2")
            .html(
                '<img id="tb2" src="" width="120px" height="120px" alt="图标" /> ');
        $("#tb2").attr("src", tb.picture);
        mini.get("uploader2").setVisible(false);
    }
</script>
</body>
</html>