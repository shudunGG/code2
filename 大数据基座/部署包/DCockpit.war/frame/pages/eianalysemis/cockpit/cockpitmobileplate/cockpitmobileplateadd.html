<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>新增版块</title>
<!-- 请修改相对路径 -->
<script src="../../../../../frame/fui/js/cssboot.js"></script>
<link rel="stylesheet" type="text/css"
	href="../cockpitcolumn/css/addcolumn.css">
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" iconCls="icon-save" id="addClose"
				onclick="saveAndClose">保存并关闭</a> <a class="mini-button"
				iconCls="icon-minuscircle" onclick="epoint.closeDialog">关闭</a>
		</div>
	</div>

	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="fui-form" class="fui-form">
			<div role="form">
				<div role="row">
					<div role="control" label="版块名称" starred="true">
						<input class="mini-textbox" bind="dataBean.PlateName"
							required="required" requiredErrorText="版块名称不能为空"
							vtype="maxLength:50;" emptyText="请填写版块名称..." />
					</div>
					<div role="control" label="ApiCode">
						<input class="mini-textbox" readonly="true" emptyText="提交后自动生成">
					</div>
				</div>
				<div role="row">
					<div role="control" label="版块描述">
						<input class="mini-textarea" bind="dataBean.remark"
							emptyText="请填写版块描述..." vtype="maxLength:9999;"/>
					</div>
				</div>
				<!-- <div role="row">
					<div role="control" label="所属部门" starred="true">
						<input id="belongOuGuid" class="mini-treeselect" required="required"
							action="selectouaction.getLazyTreeModal"
							bind="dataBean.belongOuGuid" showFolderCheckBox="true"
							showRadioButton="true" showTreeIcon="true" textField="text"
							idField="id" expandOnLoad="true" onvaluechanged="change"/>
					</div>
					<div role="control" label="所属专题" starred="true">
						<input
							bind="dataBean.projectGuid" id="projectGuid"
							action="getCockpitProject" class="mini-combobox"/>
					</div>
				</div> -->
				<div role="row">
					<div role="control" label="卡片分类">
						<div>
							<input class="mini-textbox" style="display: inline-block;"
								id="special-textbox"> <a
								class="mini-button mini-btn-primary" id="add-classify"
								onclick="" iconCls="icon-add">添加分类</a>
						</div>
						<ul class="classify-list clearfix" id="classify-list">
						</ul>
					</div>
					<div role="control" label="排序号">
						<input id="ordernum" class="mini-textbox" bind="dataBean.ordernum"
							vtype="int;range:0,99999" />
					</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/html" id="classify-tmpl">
        {{#list}}
        <li class="classify-item">
            <span class="classify-item-name" title="{{name}}" guid="{{guid}}" onclick="oncateedit('{{guid}}')">{{name}}</span>
            <span class="action-icon icon-removethin classify-item-close" data-name="{{name}}" data-guid="{{guid}}" title="删除"></span>
        </li>
        {{/list}}
    </script>
	<!-- 请修改相对路径 -->
	<script src="../../../../../rest/resource/jsboot"></script>
	<script src="../cockpitcolumn/js/addcolumn.js"></script>
	<script>
		var uploader = mini.get("uploader");
		// 初始化页面
		epoint.initPage('cockpitmobileplateaddaction', null, function(data) {
			if (data.msg) {
				epoint.alertAndClose(data.msg);
				return;
			}
		});

		function change() {
			epoint.refresh([ 'belongOuGuid', 'projectGuid' ], function() {
			});
		}

		function saveAndClose() {
			if (epoint.validate()) {
				epoint.execute('save', 'fui-form', getProjectCate(),
						closeCallback);
			}
		}

		// 新增操作的回调
		function closeCallback(data) {
			if(data.error){
				epoint.alert(data.error);
			}else if(data.warn){
				epoint.alertAndClose(data.warn);
			}else if (data.msg) {
				epoint.alertAndClose(data.msg);
			}
		}

		//展示图标
		function OnPictureSuccess(args) {
			if (args.data.extraDatas.obj) {
				showPicture(args.data.extraDatas.obj);
			}
		}

		//展示图标
		function showPicture(tb) {
			console.log(tb);
			$(".mini-uploader-list").empty();
			$("#picture").show();
			$("#picture")
					.html(
							'<img id="tb" src="" width="120px" height="180px" alt="图标" /> <i class="action-icon icon-error" style="position: absolute; left: 110px; top: 0px;" onclick="delPicture(\''
									+ tb.filepath + '\');" ></i>');
			$("#tb").attr("src", tb.picture);
			mini.get("uploader").setVisible(false);
		}

		//删除图标
		function delPicture(filepath) {
			epoint.execute('deletePicture', '', filepath, function(data) {
				if (data.msg) {
					mini.get("uploader").clearFile();
					$("#picture").hide();
					mini.get("uploader").setVisible(true);
					epoint.refresh('uploader');
				}
			});
		}

		function getProjectCate() {
			var cateNames = '';
			$(".classify-item-name").each(function(i, v) {
				cateNames += ';' + v.getAttribute("title");
			});
			return cateNames.substring(1);
		}
	</script>
</body>
</html>