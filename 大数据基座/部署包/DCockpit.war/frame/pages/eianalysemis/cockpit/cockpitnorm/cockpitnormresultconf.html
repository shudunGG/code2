<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>指标作业添加</title>
<!-- 请修改相对路径 -->
<script src="../../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>
	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addNew" onclick="confirmadd">生成</a> <a
				class="mini-button" id="cancleadd" onclick="epoint.closeDialog">取消</a>
		</div>
	</div>

	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="fui-form" class="fui-form">
			<div role="form">
				<div role="row">
					<div role="control" label="图表类型">
						<input id="charttype" bind="dataBean.charttype"
							class="mini-combobox" textField="text" valueField="value"
							action="getChartType" showClose="true"
							oncloseclick="onCloseClick" onvaluechanged="onConnectTypeChanged" />
					</div>
					<div role="control"></div>
				</div>
				<div role="row" id="xaxisdiv">
					<div role="control" label="X轴" starred="true">
						<input id="xaxis" bind="dataBean.xaxis" class="mini-combobox"
							textField="text" valueField="value" action="getXaxisList"
							showClose="true" oncloseclick="onCloseClick" required="ture" />
					</div>
					<div role="control"></div>
				</div>
				<div role="row" id="legenddiv">
					<div role="control" label="legend" starred="true">
						<input id="legend" bind="dataBean.legend" class="mini-combobox"
							textField="text" valueField="value" action="getXaxisList"
							showClose="true" oncloseclick="onCloseClick" required="ture" />
					</div>
					<div role="control"></div>
				</div>
				<div role="row" id="groupTypeDiv">
					<div role="control" label="聚合方式" starred="true">
						<input class="mini-combobox" action="groupbytypeModel1"
							id="groupbytype" bind="dataBean.jhfs" textField="text"
							valueField="id" emptyText="请选择" />
					</div>
					<div role="control"></div>
				</div>
				<div class="mini-hidden" bind="dataBean.normtype"></div>
			</div>
			<div role="control">
				<div class="img-view" id="picture" style="display: none;"></div>
			</div>
		</div>
	</div>
	<!-- 请修改相对路径 -->
	<script src="../../../../../frame/fui/js/jsboot.js"></script>
	<script src="../js/echarts.min.js"></script>
	<script>
		// 初始化页面
		var wdsize;
		var configtype;
		epoint
				.initPage(
						'cockpitnormresultconfaction',
						null,
						function(data) {
							if (data.charttype == '3' || data.charttype == '4') {//连接字符串配置
								$('#xaxisdiv').show();
							} else {//服务器数据库名称配置
								$('#xaxisdiv').hide();
							}
							if (data.wdsize) {
								wdsize = data.wdsize;
							}
							if (data.configtype) {
								configtype = data.configtype;
							}
							if ((data.charttype == '3' || data.charttype == '4')
									&& data.wdsize >= 3) {
								if ((data.configtype == '2'
										|| data.configtype == '4' || data.configtype == '5')) {
									$('#groupTypeDiv').show();
								} else {
									$('#groupTypeDiv').hide();
								}
								$('#legenddiv').show();
							} else {
								$('#groupTypeDiv').hide();
								$('#legenddiv').hide();
							}
							if (data.pic) {
								showPicture1(data.pic);
							}
						});

		function onConnectTypeChanged(e) {
			if (e.value == '3' || e.value == '4') {//连接字符串配置
				$('#xaxisdiv').show();
				if (wdsize >= 3) {
					if ((configtype == '2' || configtype == '4' || configtype == '5')) {
						$('#groupTypeDiv').show();
					} else {
						$('#groupTypeDiv').hide();
					}
					$('#legenddiv').show();
				}
			} else {//服务器数据库名称配置
				$('#xaxisdiv').hide();
				if (wdsize < 3) {
					$('#groupTypeDiv').hide();
					$('#legenddiv').hide();
				}
			}
		}

		function confirmadd() {
			if (epoint.validate()) {
				var charttype = mini.get('charttype').getValue();
				var xaxis = mini.get('xaxis').getValue();
				epoint.execute('save', 'fui-form', [ charttype, xaxis ],
						function(data) {
							if (data.attachguid) {
								epoint.execute('getPicObj', '',
										data.attachguid, function(data) {
											console.log(data);
											if (data.picture) {
												showPicture(data.picture);
											}
										});
							}
						});

			}
		}

		//展示图片
		function showPicture(tb) {
			$("#picture").show();
			$("#picture")
					.html(
							'<img id="tb" src="" width="1000px" height="600px" alt="图标" />');
			$("#tb").attr("src", tb);
		}

		function showPicture1(tb) {
			$("#picture").show();
			$("#picture")
					.html(
							'<img id="tb" src="" width="1000px" height="600px" alt="图标" />');
			$("#tb").attr("src", tb.picture);
		}

		function onCloseClick(e) {
			var obj = e.sender;
			obj.setText("");
			obj.setValue("");
		}
		// 新增操作的回调
		function newCallback(data) {
			if (data) {
				if (data.indexOf("成功") > 0) {
					epoint.alertAndClose(data, '', null, null, 'info');
				} else {
					epoint.alert(data);
				}
			}
		}
	</script>
</body>
</html>