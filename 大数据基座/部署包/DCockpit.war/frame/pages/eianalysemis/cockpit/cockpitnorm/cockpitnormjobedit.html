<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>指标作业添加</title>
<!-- 请修改相对路径 -->
<script src="../../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>
	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addNew" onclick="confirmadd">保存</a> <a class="mini-button" id="cancleadd" onclick="epoint.closeDialog">取消</a>
		</div>
	</div>
	
	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="fui-form" class="fui-form">
			<div role="form">
				<div role="row">
					<div role="control" label="定时任务类型" starred="true">
						<input id="tasktiming" bind="dataBean.tasktiming" class="mini-combobox" textField="text" valueField="value" action="getTaskType" required="true"
							requiredErrorText="定时任务类型不能为空" onvaluechanged="onSchedulerTypeChanged" width="90%" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="以秒计算的间隔">
						<input id="intervalSeconds" bind="dataBean.intervalSeconds" format="#,0" width="90%" minValue="0" maxValue="86400" class="mini-spinner" minValue="0" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="以分钟计算的间隔">
						<input id="intervalMinutes" bind="dataBean.intervalMinutes" format="#,0" width="90%" minValue="0" maxValue="1440" class="mini-spinner" minValue="0" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="时间">
						<input id="hour" bind="dataBean.hour" class="mini-spinner" format="#,0" minValue="0" maxValue="23" style="width: 45%;" /><input id="minutes"
							bind="dataBean.minutes" class="mini-spinner" format="#,0" minValue="0" maxValue="59" style="width: 45%;" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="星期">
						<input id="weekDay" bind="dataBean.weekDay" width="90%" class="mini-combobox" textField="text" valueField="id" action="getWeekDayCombobox" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="日期">
						<input id="dayOfMonth" bind="dataBean.dayOfMonth" width="90%" class="mini-spinner" format="#,0" minValue="1" maxValue="31" />
					</div>
				</div>
			</div>
			<input class="mini-hidden" bind="dataBean.rowguid" id="rowguid" />
		</div>
	</div>
	<!-- 请修改相对路径 -->
	<script src="../../../../../frame/fui/js/jsboot.js"></script>
	<script>
		// 初始化页面
		var rowguid;
		epoint.initPage('cockpitnormjobeditaction', null, function(data) {
			rowguid = mini.get('rowguid').getValue();
			specialControlStyle(mini.get("tasktiming").getValue());
		});

		function onSchedulerTypeChanged(e) {
			specialControlStyle(e.value);
		}
		// 类型决定显隐
		function specialControlStyle(schedulerTypeValue) {
			if (schedulerTypeValue == '0' || schedulerTypeValue == '0.0') {
				disables([ 'intervalSeconds', 'intervalMinutes', 'hour', 'minutes', 'weekDay', 'dayOfMonth' ]);
			} else if (schedulerTypeValue == '1' || schedulerTypeValue == '1.0') {
				disables([ 'hour', 'minutes', 'weekDay', 'dayOfMonth' ]);
				enables([ 'intervalSeconds', 'intervalMinutes' ]);
			} else if (schedulerTypeValue == '2' || schedulerTypeValue == '2.0') {
				disables([ 'intervalSeconds', 'intervalMinutes', 'weekDay', 'dayOfMonth' ]);
				enables([ 'hour', 'minutes' ]);
			} else if (schedulerTypeValue == '3' || schedulerTypeValue == '3.0') {
				disables([ 'intervalSeconds', 'intervalMinutes', 'dayOfMonth' ]);
				enables([ 'hour', 'minutes', 'weekDay' ]);
				defaultWeekDay();
			} else if (schedulerTypeValue == '4' || schedulerTypeValue == '4.0') {
				disables([ 'intervalSeconds', 'intervalMinutes', 'weekDay' ]);
				enables([ 'hour', 'minutes', 'dayOfMonth' ]);
			}
		}

		function confirmadd() {
			if (epoint.validate()) {
				epoint.execute('save', 'fui-form', newCallback);
			}
		}

		// 新增操作的回调
		function newCallback(data) {
			if (data) {
				if (data.indexOf("成功") > 0) {
					epoint.alertAndClose(data, '', null, null, 'info');
				} else {
					epoint.alert(data);
				}
			}
		}

		// 设置控件为不可选
		function disable(id) {
			var t = mini.get(id);
			t.disable();
		}

		// 设置控件为不可选 -多个-ids为数组
		function disables(ids) {
			var l = ids.length;
			if (l > 0) {
				for (var i = 0; i < l; i++) {
					disable(ids[i]);
				}
			}
		}

		// 设置控件为可选 -多个-ids为数组
		function enables(ids) {
			var l = ids.length;
			if (l > 0) {
				for (var i = 0; i < l; i++) {
					enable(ids[i]);
				}
			}
		}

		// ---method
		// 设置控件为可选
		function enable(id) {
			var t = mini.get(id);
			t.enable();
		}

		// 周设置默认为周日
		function defaultWeekDay() {
			var t = mini.get('weekDay');
			if(t.getValue() == ''){
				t.setValue(0);
			}
		}
	</script>
</body>
</html>