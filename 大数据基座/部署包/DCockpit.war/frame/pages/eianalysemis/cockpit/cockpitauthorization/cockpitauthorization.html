<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>配置授权</title>
<script src="../../../../../frame/fui/js/cssboot.js"></script>
</script>
<style type="text/css">
</style>
</head>

<body>
	<div class="page-loading"></div>
	<!-- 页面内容区域 -->
	<div class="fui-content">
		<p class="text-special mr10">请至少选择一个【专题或专题分类】</p>
		<div class="fui-form" id="fui-form">
			<div role="row">
				<div class="form-control " label=""
					style="border: 1px solid #ebebeb; height: 550px; width: 30%; overflow: auto;">
					<div class="mini-tree" id="tree" action="getTreeModel"
						showCheckBox="true" autoCheckParent="true"></div>
				</div>
				<div class="form-control span4" label="用户设置">
					<div id="tabstreeselect" class="mini-tabstreeselect"
						selectedPanelTitle="已选择记录" style="width: 99%; height: 550px"
						action="getTreeModel2" loadWhenChecked="true" filterMode="server"
						showBorder="true">
						<div tabText="授权用戶" tabKey="user"></div>
					</div>
				</div>
				<div style="width: 100%; text-align: center;">
					<a class="mini-button mini-btn-primary"
						style="margin: 5px auto; width: 120px;" iconCls="icon-addcircle"
						onclick="saveAndClose" id="initBtn">保存授权</a> <a
						class="mini-button" style="margin: 5px auto; width: 120px;"
						onclick="epoint.closeDialog">取消</a>
				</div>


			</div>
		</div>
	</div>


	<script src="../../../../../rest/resource/jsboot"></script>
	<script>
		epoint.initPage('cockpitauthorizationaction', '@all', function(data) {
		});

		//树js对象
		var tree = mini.get("tree");
		var tree2 = mini.get("tabstreeselect");
		tree.on("nodeselect", function(a) {
			$(".cockpit").each(function(i, e){
				e.title = "驾驶舱";
			});
			$(".modicon-75").each(function(i, e){
				e.title = "驾驶舱";
			});
			$(".cate").each(function(i, e){
				e.title = "专题分类";
			});
			$(".modicon-138").each(function(i, e){
				e.title = "专题分类";
			});
			$(".project").each(function(i, e){
				e.title = "专题";
			});
			$(".modicon-22").each(function(i, e){
				e.title = "专题";
			});
		});

		function saveAndClose() {
			var nodeList = tree.getList();
			var categuids = '';
			var pguids = '';
			for (var i = 0; i < nodeList.length; i++) {
				if (nodeList[i].type != 'cockpit' && nodeList[i].checked) {
					if (nodeList[i].type == 'cate') {
						categuids += ',' + nodeList[i].id;
					}
					if (nodeList[i].type == 'project') {
						pguids += ',' + nodeList[i].id;
					}
				}
			}
			if (categuids == '' && pguids == '') {
				epoint.alert("请至少选择一个【专题或专题分类】！");
				return;
			}
			epoint.execute("save", 'tabstreeselect', [ categuids.substring(1),
					pguids.substring(1) ], function(data) {
				epoint.alertAndClose("授权成功");
			});
		}
	</script>
</body>

</html>