<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>配置授权</title>
<script src="../../../../../frame/fui/js/cssboot.js"></script>
</script>
<style type="text/css">
</style>
</head>

<body>
	<div class="page-loading"></div>
	<!-- 页面内容区域 -->
	<div class="fui-content">
		<div class="fui-form" id="fui-form">
			<div role="row" id="target">授权对象：</div>
			<div role="row">
				<div class="form-control " label=""
					style="border: 1px solid #ebebeb; height: 540px; width: 100%; overflow: auto;">
					<div class="mini-tree" id="tree" action="getTreeModel"
						showCheckBox="true"></div>
				</div>
			</div>
			<div style="width: 100%; text-align: center;">
				<a class="mini-button mini-btn-primary"
					style="margin: 5px auto; width: 120px;" iconCls="icon-addcircle"
					onclick="saveAndClose">保存授权</a>
			</div>
		</div>
	</div>


	<script src="../../../../../rest/resource/jsboot"></script>
	<script>
		var projectguids;
		var tree = mini.get("tree");
		epoint.initPage('cockpitauthorizationaction', '@all', function(data) {
			if (data.projectguids) {
				projectguids = data.projectguids.split(",");
				for (var i = 0; i < projectguids.length; i++) {
					var node = tree.getNode(projectguids[i]);
					tree.checkNode(node);
				}
			}
			if (data.username) {
				document.getElementById("target").innerHTML = "授权对象："
						+ data.username;
			}
		});

		function saveAndClose() {
			var nodeList = tree.getList();
			var categuids = '';
			var pguids = '';
			for (var i = 0; i < nodeList.length; i++) {
				if (nodeList[i].type != 'cockpit' && nodeList[i].checked) {
					if (nodeList[i].type == 'cate') {
						categuids += ',' + nodeList[i].id;
					}
					if (nodeList[i].type == 'project') {
						pguids += ',' + nodeList[i].id;
					}
				}
			}
			if (categuids == '' && pguids == '') {
				epoint.alert("请至少选择一个【专题或专题分类】！");
				return;
			}
			epoint.execute("saveContent", '@none', [ categuids.substring(1),
					pguids.substring(1) ], function(data) {
				epoint.alert("授权成功");
				epoint.closeDialog();
			});
		}
	</script>
</body>

</html>