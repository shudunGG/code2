<!DOCTYPE html>
<html>

<head>
<title>预警结果查询</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<!-- 请修改相对路径 -->
<script src="../../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>
	<div class="fui-condition">
		<div class="fui-form" id="fui-form">
			<div id="cform" role="form">
				<div role="row">
					<div role="control" label="指标名称">
						<input class="mini-textbox" bind="normname" />
					</div>
				</div>
			</div>
		</div>
		<a role="searcher" callback="searchData"></a>
	</div>
	<!-- 内容区域 -->
	<div id="fuiContent" class="fui-content">
		<div id="datagrid" class="mini-datagrid" idField="rowguid"
			action="getDataGridData" sortOrder="desc" showPager="true"
			style="height: 100%;" allowResize="true" multiSelect="true"
			allowCellEdit="true" allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true">
			<div property="columns">
				<div type="indexcolumn" width="40" headerAlign="center">序</div>
				<div field="normname" headerAlign="center" align="center">指标名称</div>
				<div field="warninguser" headerAlign="center" align="center">预警对象</div>
				<div field="rulename" headerAlign="center" align="center">规则描述</div>
				<div field="reason" headerAlign="center" align="center">预警原因</div>
				<div field="maxTime" headerAlign="center"
					data-options="{'format':'yyyy-MM-dd HH:mm:ss'}"
					dateFormat="yyyy-MM-dd HH:mm:ss" align="center">预警时间</div>
				<div field="userguid" visible="false"></div>
				<div width="40" align="center" headerAlign="center"
					renderer="onDetailRenderer">预警历史</div>
			</div>
		</div>
	</div>


	<!-- 请修改相对路径 -->
	<script src="../../../../../rest/resource/jsboot"></script>
	<script>
		// 初始化页面
		epoint.initPage('cockpitwarningresultaction', null, function(data) {
			if (data.msg) {
				epoint.alert(data.msg, '', null, 'info');
			}
		});

		// 绘制行查看按钮
		var onDetailRenderer = function(e) {
			return '<span type="action" style=\"color:blue\" onclick="openDetail(\''
			+ e.row.computeguid + '\',\''+e.row.userguid+'\')">查看</span>'
		};

		// 弹出明细窗口
		function openDetail(computeguid, userguid) {
			epoint
					.openDialog(
							'预警历史',
							"frame/pages/eianalysemis/cockpit/cockpitnormwarning/cockpitwarningresulthistorylist?computeguid="
									+ computeguid + "&userguid=" + userguid, {
								'width' : 1000,
								'height' : 550
							});
		}

		function callback(data) {
			if (data.msg) {
				epoint.alert(data.msg, '', searchData, 'info');
			}
			epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
		}

		//忽略本次预警
		function cancelWarning(e) {
			epoint.confirm('确认忽略本条预警？', '确认', function() {
				console.log(e);
				epoint.execute("cancelWarning", "", e.computeguid, callback);
			});
		}

		function selectuser() {
			epoint.openDialog("选择人员", 'framemanager/orga/orga/user/selectuser',
					saveAndClose, {
						'width' : 800,
						'height' : 600
					});
		}
		//回调
		function saveAndClose(rtnValue) {
			if (rtnValue && rtnValue != 'close') {
				var s = rtnValue.split("_SPLIT_");
				if (s[1] != 'f9root') {
					mini.get("search_userguid").setValue(s[0]);
					mini.get("search_userguid").setText(s[1]);
				} else {
				}
			}
		}

		function onCloseClick(e) {
			var obj = e.sender;
			obj.setText("");
			obj.setValue("");
		}
	</script>
</body>
</html>