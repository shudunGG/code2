<!DOCTYPE html>
<html>

	<head>
		<title>分类管理</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<script src="../../../fui/js/cssboot.js"></script>
	</head>

	<body>
		<div class="page-loading"></div>

		<div class="fui-left">
			<div role="head" title="选择分类"></div>

			<div role="body">
				<ul id="tree" class="mini-tree" style="height: 100%" textField="text"
				idField="id" parentField="pid"
				action="getTreeData" resultAsTree="false"></ul>
			</div>
		</div>

		<div class="fui-right">
			<!-- toolbar区域 -->
			<div class="fui-toolbar">
				<div class="btn-group mr10">
				<a class="mini-button" iconCls="icon-save" onclick="save()">保存分类</a>
					<a class="mini-button" iconCls="icon-addcircle" onclick="add()">新增分类</a>
					
					<a class="mini-button mini-btn-danger" iconCls="icon-minuscircle"
					onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择想要删除的分类！', '', null, 'warning');} else {epoint.confirm('是否确定删除？','',deleteSelected);}">删除分类</a>
				</div>
			</div>

			<div class="fui-condition"> 
				<!-- 表单布局 -->
				<div class="fui-form" id="fui-form">
					<div role="form">
						<!-- 2列 -->
						<div role="row">
							<div role="control" label="分类名称" starred="true">
								<input id="cName" bind="commCategoryManage.cCategoryName"
								class="mini-textbox" required="true"
								requiredErrorText="分类名称不能为空" vtype="maxLength:50" />

							</div>
							<div role="control" label="排序号" starred="false">
								<input id="oNum" bind="commCategoryManage.orderNum"
								class="mini-textbox" vtype="int;range:0,99999999" />
							</div>
						</div>
						<!-- 添加隐藏域，用于树与表格的联动 -->
						<input bind="commCategoryManage.cCategoryNum"
						id="cCategoryNum" class="mini-hidden" />
					</div>
				</div>
			</div>
			<div class="fui-content">
				<div id="datagrid" class="mini-datagrid" sortOrder="desc"
				idField="ccategorynum" multiSelect="true"
				style="width: 100%; height: 100%;" allowResize="true"
				allowCellValid="true" action="getDataGridData"
				showPager="true" allowCellEdit="true" allowCellSelect="true"
				editNextOnEnterKey="true" editNextRowCell="true">
					<div property="columns">
						<div type="checkcolumn" width="50"></div>
						<div type="indexcolumn" headerAlign="center" width="50">
							序
						</div>
						<div field="ccategoryname" width="100%" headerAlign="center"
						vtype="maxLength:50;required">
							分类名称
							<input property="editor" class="mini-textbox" minWidth="200" />
						</div>
						<div field="ccategorynum" width="150" headerAlign="center">
							分类编号
						</div>
						<div field="ordernum" width="150" headerAlign="center" align="right"
						vtype="int;range:0,99999999">
							排序号
							<input property="editor" class="mini-textbox" minWidth="80"
							inputStyle="text-align:right" />
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="../../../../rest/resource/jsboot"></script>

		<!-- 配置变量 -->
		<script>
			//初始化页面
			epoint.initPage("commcategorymanagelistaction");
			
			//树js对象
			var tree = mini.get("tree");
			// 点击左侧树刷新右侧表格
			tree.on("nodeselect", function(e) {
				var id = e.node.id;
				// 将左侧树点击的节点id放到隐藏域中
				// 在表格发二次请求时，会自动带上条件区域中的内容
				mini.get('cCategoryNum').setValue(id);
				//刷新表格
				searchData_treeExp();
			});

			// 新增
			function add() {
				if (epoint.validate()) {
					epoint.execute('add', '' ,msgCallBack);
				}
			}

			// 保存
			function save() {
				var grid = mini.get("datagrid");
				if (grid.isValid() == false) {
					var error = grid.getCellErrors()[0];
					grid.beginEditCell(error.record, error.column);
					return;
				}
				epoint.execute('save', '', msgCallBack);
			}

			// 删除
			function deleteSelected() {
				epoint.execute('deleteSelected', '', msgCallBack);
			}

			// 回掉提醒
			function msgCallBack(data) {
				var msg = data.msg;
				if (msg) {
					if (data.success) {
						mini.get("cName").setValue("");
						mini.get("oNum").setValue("");
						epoint.alert(msg, '', function(){
							epoint.refresh(['tree','datagrid', 'fui-form'],'',true);
						}, 'info');
					} else {
						epoint.alert(msg, '', '', 'warning');
					}
				}
			}

			// 表格，树的搜索
			function searchData() {
				epoint.refresh(['datagrid', 'fui-form']);
			}

			// 表格的搜索
			function searchData_treeExp() {
				epoint.refresh(['datagrid', 'fui-form']);
			}
			
		</script>
	</body>
</html>
