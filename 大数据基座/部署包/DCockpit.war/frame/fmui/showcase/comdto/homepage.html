<!DOCTYPE html>
<html>

<head>
    <title>首页</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <script>
        document.write(
            "<script src='../../js/cssboot.js?" + Math.random() + "'></scr" + "ipt>"
        );
    </script>
    <script>
        SrcBoot.output([
            './css/homepage.css'
        ]);
    </script>

<body style="
    width: 375px;
    margin: 0 auto;
">
    <!-- 内容区域 -->
    <div class="mui-content" id="homepage">
        <div class="ep-header">
            <h1>新点工作平台</h1>
            <div class="ep-time-quick">
                <div class="ep-time-left">
                    <div class="ep-time-span">
                    </div>
                    <div class="ep-week-span">
                        星期三
                    </div>
                </div>
                <div class="ep-quick-right">
                </div>
            </div>
        </div>
        <div class="ep-main">
            <div class="ep-main-header">
                常用应用
            </div>
            <div class="ep-main-app">

                <div class="mui-slider">
                    <div class="mui-slider-group">
                        <!--第一个内容区容器-->
                        <div class="mui-slider-item">
                            <!-- 具体内容 -->
                        </div>
                        <!--第二个内容区-->
                        <div class="mui-slider-item">
                            <!-- 具体内容 -->
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <script type="text/template" id="tpl-module">
    <div class="ep-app-item" pageurl="{{pageUrl}}">
        <img src="{{logo}}" alt="" srcset="">
        <div>{{modulename}}</div>
    </div>
  </script>
    <script type="text/template" id="tpl-module-enter">
                <img pageurl="{{pageUrl}}" src="{{logo}}" alt="">
  </script>

    <script>
        document.write(
            "<script src='../../js/jsboot.js?" + Math.random() + "'></scr" + "ipt>"
        );
    </script>

    <script>
        var appguid = Util.getExtraDataByKey('appguid') || '';
        var platform = Util.getExtraDataByKey('platform') || '';
        var data = {
            params: JSON.stringify({
                appguid: appguid,
                platform: platform
            })
        };
        Util.ajax({
            // url: Util.getProjectBasePath() + 'http://192.168.206.65:6087/epoint-web/rest/mobileappclient/getmodulelist',
            url: Util.getProjectBasePath() + 'rest/mobileappclient/getmodulelist',
            data: data,
            success: function (result) {
                console.log(result);

                // var data = { "custom": { "entermodule": [{ "menuguid": "a91875e6-c66b-4bbe-aa61-b43adc8d5b86", "menuname": "scan", "menulogo": "rest/frame/base/attach/attachAction/getContent?isCommondto=true&attachGuid=4d4d8aa8-ac49-4ba9-a866-3e3c81d8dd02", "params": [{ "name": "rest-url", "value": "" }, { "name": "h5-enter", "value": "" }, { "name": "ios-enter", "value": "" }, { "name": "android-enter", "value": "" }, { "name": "can-search", "value": "" }, { "name": "menukey", "value": "scan" }] }], "module": [{ "modulename": "待办事宜", "params": [{ "name": "rest-url", "value": "" }, { "name": "h5-enter", "value": "http://192.168.206.65:6087/epoint-web/frame/pages/basic/communication/waithandle/mobilehandlelist" }, { "name": "ios-enter", "value": "" }, { "name": "android-enter", "value": "" }, { "name": "can-search", "value": "" }], "moduleguid": "9ecd7365-7bde-4395-bca2-e3ad813b187a" }, { "modulename": "设备安全", "logo": "rest/frame/base/attach/attachAction/getContent?isCommondto=true&attachGuid=e12d4429-9ba7-4061-b6be-9758a797d147", "params": [{ "name": "rest-url", "value": "" }, { "name": "h5-enter", "value": "http://192.168.206.65:6088/epoint-web/h5/mobileapp/pages/equipments/equipments_index.html" }, { "name": "ios-enter", "value": "" }, { "name": "android-enter", "value": "" }, { "name": "can-search", "value": "" }], "moduleguid": "990d1bf7-b95e-4406-9459-f413056026ce" }, { "modulename": "应用分享", "logo": "rest/frame/base/attach/attachAction/getContent?isCommondto=true&attachGuid=ea00dd86-8222-4bd5-8a39-4e221501728d", "params": [{ "name": "rest-url", "value": "" }, { "name": "h5-enter", "value": "http://192.168.206.65:6088/epoint-web/h5/mobileapp/pages/shareAPP/d.html?appguid=2f4b9b9e-15d9-4991-8dd6-e712e554a4cf" }, { "name": "ios-enter", "value": "" }, { "name": "android-enter", "value": "" }, { "name": "can-search", "value": "" }], "moduleguid": "c9968b40-43fe-4ca1-924e-acce6e7a60de" }, { "modulename": "表单", "params": [{ "name": "rest-url", "value": "" }, { "name": "h5-enter", "value": "http://192.168.206.65:6087/epoint-web/epointtemp/epointsform/list/2/V3/mobilelist" }, { "name": "ios-enter", "value": "" }, { "name": "android-enter", "value": "" }, { "name": "can-search", "value": "" }], "moduleguid": "d8779f2a-fe39-4ab9-be75-cd5c69fd5212" }] }, "status": { "code": 1, "text": "请求成功" } }
                var data = result;
                // console.log(data);
                var enterModuleData = data.custom.entermodule;
                var moduleData = data.custom.module;

                console.log(enterModuleData);
                console.log(moduleData);
                var jsonstr = moduleData;
                var template = document.getElementById('tpl-module').innerHTML;//HTML 模板
                var output = '';

                var eachLength = 8;
                var sliceData = [];
                for (var i = 0; i < moduleData.length; i += eachLength) {
                    sliceData.push(moduleData.slice(i, i + eachLength));
                }
                console.log(sliceData);
                sliceData.forEach(function (item) {
                    output += '<div class="mui-slider-item">';
                    mui.each(item, function (key, value) {
                        value.pageUrl = value.params.filter(function (e) {
                            return e.name == 'h5-enter'
                        })[0].value
                        value.logo = Util.getFullPath('') + value.logo;
                        console.log(value);
                        output += Mustache.render(template, value);
                    });
                    output += '</div>';
                })

                // console.log(output);
                document.querySelector('.mui-slider-group').innerHTML = output;//渲染节点
                /* mui.each(jsonstr, function (key, value) {
                    value.pageUrl = value.params.filter(function (e) {
                        return e.name == 'h5-enter'
                    })[0].value
                    value.logo = Util.getFullPath('') + value.logo;
                    console.log(value);
                    output += '<div class="mui-slider-item">';
                    output += Mustache.render(template, value);
                    output += '</div>';
                });
                // console.log(output);
                document.querySelector('.mui-slider-group').innerHTML = output;//渲染节点 */


                var templateEnter = document.getElementById('tpl-module-enter').innerHTML;//HTML 模板
                var outputEnter = '';
                mui.each(enterModuleData, function (key, value) {
                    value.pageUrl = value.params.filter(function (e) {
                        return e.name == 'h5-enter'
                    })[0].value
                    value.logo = Util.getFullPath('') + value.menulogo;
                    console.log(value);
                    outputEnter += Mustache.render(templateEnter, value);
                });
                // console.log(outputEnter);
                document.querySelector('.ep-quick-right').innerHTML = outputEnter;//渲染节点

                mui('.ep-main-app').on('tap', '.ep-app-item', function () {
                    ejs.page.open({
                        pageUrl: this.getAttribute('pageUrl'),
                        pageStyle: 1,
                        orientation: 1,
                        success: function (result) { }
                    });
                })

                mui('.ep-quick-right').on('tap', 'img', function () {
                    if (this.getAttribute('pageUrl')) {
                        ejs.page.open({
                            pageUrl: this.getAttribute('pageUrl'),
                            pageStyle: 1,
                            orientation: 1,
                            success: function (result) { }
                        });
                    }

                })
                // http://192.168.206.65:6087/epoint-web/rest/frame/getmodulelist返回的result.data直接就是 custom 节点下的数据，注意为null的情况，这时候没有这个节点数据
            }
        });
        var dateString = new Date().toLocaleDateString().replace(/\//g, '-');
        document.querySelector('.ep-time-span').innerText = dateString;

        var a = new Array('日', '一', '二', '三', '四', '五', '六');
        var week = new Date().getDay();

        var weekDay = '星期' + a[week];
        document.querySelector('.ep-week-span').innerText = weekDay;

    </script>
</body>

</html>