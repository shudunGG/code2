<!-- 
        作者： 孙尊路
        创建时间：2017-07-14 13:26:47
        版本： [1.0, 2017/7/14]
        版权： 江苏国泰新点软件有限公司
        描述： 日历组件
        场景：比如需求要做一个填写日志功能，关系到每天的日程的一个计划安排，这时使用日历组件是必不可少的！
        效果：打开手机OA-扩展功能-二维码扫描（ejs应用测试）可看到效果
-->
<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="format-detection" content="telephone=no, address=no, email=no">
		<title>日历组件</title>
		<script>
			document.write("<script src='../../../js/cssboot.js?" + Math.random() + "'></scr" + "ipt>");
		</script>
	</head>

	<body>

		<div class="mui-content">

			<!-- 日历样式-->
			<div id="calendarBorder">
				<div id="chooseYearMonth">
					<div id="yearMonth"></div>
					<div class="today">今</div>
				</div>

				<!--日历容器-->
				<div id="calendar">
				</div>

			</div>

		</div>

		<script>
			document.write("<script src='../../../js/jsboot.js?" + Math.random() + "'></scr" + "ipt>");
		</script>

		<script>
			"use strict";

			var dateObj = new Date();
			var currYear = dateObj.getFullYear(),
				currMonth = dateObj.getMonth() + 1,
				currDay = dateObj.getDate(),
				currMonth = String(currMonth),
				ymText = document.getElementById("yearMonth");

			if(currMonth.length == 1) {
				currMonth = "0" + currMonth;
			}
			ymText.innerText = currYear + '年 ' + currMonth + '月';

			var calendar;
			Util.loadJs([
				'js/widgets/calendar/calendar.css',
				'js/widgets/calendar/calendar.js',
			], function() {
				initPage();
				initListener();
			});

			/**
			 * 页面初始化请走这个函数
			 */
			function initPage() {
				calendar = new Calendar({
					// 日历容器
					container: "#calendar",
					// 支持左右滑动切换日历
					isSwipeH: true,
					// 滑动回调
					swipeCallback: function(dateObj) {
						ymText.innerText = dateObj.year + '年 ' + dateObj.month + '月';
					},
					// 点击事件
					itemClick: function(item) {
						// console.log(item.date + " 农历：" + item.lunar);
						Util.ejs.ui.toast(item.date + " 农历：" + item.lunar);
					},
					// 调试
					isDebug: true
				});

			};

			function initListener() {
				// 手动选择日期
				Zepto("#yearMonth").on("tap", function() {
					ejs.nativeUI.pickDate({
						'title': '选择日期',
						'beginYear': 2010,
						'endYear': 2080
					}, function(result, msg, detail) {

						var dateObj = result.date;
						var year = dateObj.substr(0, 4);
						var month = dateObj.substr(5, 2);
						var day = dateObj.substr(7, 2);
						calendar.refresh(year, month, day);
						ymText.innerText = year + "年" + month + "月";
					});
				});
				// 返回今天
				Zepto(".today").on("tap", function() {
					ymText.innerText = currYear + '年 ' + currMonth + '月';
					calendar.refresh(currYear, currMonth, currDay);
				});
			}
		</script>
	</body>

</html>