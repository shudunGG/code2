// jshint -W030
// 主菜单的顶级菜单模板
var NAV_TPL='{{^isOverall}}\x3cli class\x3d"fui-nav-item top"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link"data-url\x3d"{{url}}"data-rowkey\x3d"{{rowkey}}" data-code\x3d"{{code}}" title\x3d"{{name}}"data-opentype\x3d"{{openType}}"\x3e\x3ci class\x3d"fui-nav-icon {{icon}}"\x3e\x3c/i\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{name}}\x3c/span\x3e\x3c/a\x3e{{/isOverall}}{{#hasSub}}\x3cdiv class\x3d"fui-nav second"\x3e\x3ch4 class\x3d"fui-nav-title" title\x3d"{{name}}" data-rowkey\x3d"{{rowkey}}"\x3e{{name}}\x3c/h4\x3e{{^isOverall}}\x3cdiv class\x3d"ajax-loading" \x3e\x3c/div\x3e{{/isOverall}}\x3cul class\x3d"fui-nav-items"\x3e{{{subItem}}}\x3c/ul\x3e\x3c/div\x3e{{/hasSub}}{{^isOverall}}\x3c/li\x3e{{/isOverall}}',SUBNAV_TPL='\x3cli class\x3d"fui-nav-item"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link"{{#indent}}style\x3d"padding-left: {{indent}}px"{{/indent}} data-url\x3d"{{url}}" data-code\x3d"{{code}}" data-rowkey\x3d"{{rowkey}}" title\x3d"{{name}}"data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"fui-nav-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}\x3cul class\x3d"fui-nav sub"\x3e{{{subItem}}}\x3c/ul\x3e{{/hasSub}}\x3c/li\x3e',QUICKNAV_TPL='\x3cli class\x3d"fui-nav-item top"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link quick-link-js" title\x3d"{{name}}"\x3e\x3ci class\x3d"fui-nav-icon modicon-1"\x3e\x3c/i\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{name}}\x3c/span\x3e\x3c/a\x3e\x3cdiv class\x3d"fui-nav second"\x3e\x3ch4 class\x3d"fui-nav-title"\x3e\x3cspan class\x3d"fui-quicknav-text"\x3e{{name}}\x3c/span\x3e\x3ci data-url\x3d"{{editUrl}}" title\x3d"\u7f16\u8f91\u81ea\u5b9a\u4e49\u83dc\u5355" class\x3d"fui-nav-edit modicon-64"\x3e\x3c/i\x3e\x3c/h4\x3e\x3cul class\x3d"fui-nav-items"\x3e{{#quickNav}}\x3cli class\x3d"fui-nav-item"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link" style\x3d"padding-left: 20px" data-url\x3d"{{url}}" data-code\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{name}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e{{/quickNav}}\x3c/ul\x3e\x3c/div\x3e\x3c/li\x3e',RESULTNAV_TPL='\x3cli class\x3d"fui-nav-item"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link"style\x3d"padding-left: 20px"data-url\x3d"{{url}}"data-code\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{{resultName}}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e',TAB_ITEM_TPL='\x3cli id\x3d"tab-{{id}}" class\x3d"fui-main-tab" ref\x3d"tab-content-{{id}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"fui-tab-text"\x3e{{name}}\x3c/span\x3e{{#closeIcon}}\x3ci class\x3d"fui-tab-close" title\x3d"\u5173\u95ed"\x3e\x3c/i\x3e{{/closeIcon}}{{^closeIcon}}\x3ci class\x3d"fui-tab-refresh" title\x3d"\u5237\u65b0"\x3e\x3c/i\x3e{{/closeIcon}}\x3c/li\x3e',TAB_CONTENT_TPL='\x3cdiv class\x3d"fui-tab-content" id\x3d"tab-content-{{id}}"\x3e\x3ciframe src\x3d"{{url}}" allowTransparency\x3d"true" height\x3d"100%" width\x3d"100%" frameborder\x3d"0" scrolling\x3d"no"\x3e\x3c/iframe\x3e\x3c/div\x3e',TAB_CURRENT_TPL='\x3cli class\x3d"fui-current-item {{#isActive}}active{{/isActive}}" data-tabId\x3d"tab-{{id}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"fui-current-text"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',MSG_TPL='{{^hasHead}}\x3cdiv class\x3d"msg-category" data-code\x3d"{{code}}"\x3e\x3ch3 class\x3d"msg-category-head"data-url\x3d"{{url}}"data-title\x3d"{{name}}"\x3e\x3cspan class\x3d"msg-category-title" title\x3d"{{name}}"\x3e{{{name}}} (\x3cspan class\x3d"msg-category-num"\x3e{{num}}\x3c/span\x3e)\x3c/span\x3e\x3ci class\x3d"msg-category-remove" title\x3d"\u5ffd\u7565\u5168\u90e8"\x3e\x3c/i\x3e\x3c/h3\x3e\x3cul class\x3d"msg-list"\x3e{{/hasHead}}{{#items}}\x3cli class\x3d"msg-list-item {{#hasNew}}newmsg{{/hasNew}}" data-url\x3d"{{url}}" data-guid\x3d"{{guid}}" data-title\x3d"{{title}}" data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"msg-item-text" title\x3d"{{title}}"\x3e{{{name}}}\x3c/span\x3e\x3cspan class\x3d"msg-item-date"\x3e{{date}}\x3c/span\x3e\x3ci class\x3d"msg-item-ignore" title\x3d"\u5ffd\u7565"\x3e\x3c/i\x3e\x3c/li\x3e{{/items}}{{^hasHead}}\x3c/ul\x3e\x3c/div\x3e{{/hasHead}}',EMSG_RECENT_TPL='{{#items}}\x3cli class\x3d"emsg-recent-item {{^hasRead}}newmsg{{/hasRead}}" data-sessionid\x3d"{{sessionId}}" data-uid\x3d"{{uid}}" data-type\x3d"{{type}}"\x3e\x3cdiv class\x3d"emsg-user-img"\x3e\x3cimg src\x3d"{{imgUrl}}" onerror\x3d"this.onerror\x3d\'\';this.src\x3d\'../../emsg/images/emsg-user-error.jpg\';" /\x3e\x3c/div\x3e\x3cdiv class\x3d"emsg-recent-record"\x3e\x3ch2\x3e\x3cspan class\x3d"emsg-user-name" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e{{^hasRead}}\x3ci class\x3d"emsg-not-read"\x3e\x3c/i\x3e{{/hasRead}}\x3cspan class\x3d"emsg-recent-date"\x3e{{date}}\x3c/span\x3e\x3c/h2\x3e\x3cp class\x3d"emsg-recent-message"\x3e{{message}}\x3c/p\x3e{{^hasRead}} \x3cspan class\x3d"emsg-ignore-icon"\x3e\u5ffd\u7565\x3c/span\x3e{{/hasRead}}\x3c/div\x3e\x3c/li\x3e{{/items}}',SOUND_URL="../../msgsound/sound.html";(function(g,a){var f=a("#headerUser"),e=a("#userDropdown"),l=a(".fui-user-hello",f),n=a(".fui-user-org",f),p=a(".fui-userinfo-name",e),k=a(".fui-userinfo-org",e),q=a("#headerSearch");a("input",q);a(".fui-search-icon",q);a("#headerHelp");var t=a("#bg-img"),u=a("#logo-img"),x="",z=a("#page-cover"),v=function(){e.addClass("hidden")},A=function(){e.hasClass("hidden")?(e.removeClass("hidden"),z.removeClass("hidden")):v()},B=function(){mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(a){"ok"==a?UserConfig.onLogout&&(eMsgSocket&&eMsgSocket.close(),UserConfig.onLogout()):v()})},D=function(){var a="./skins/"+(mini.Cookie.get("_dream_skin_")||"default")+"/images/bg.png",b=new Image;b.src=a;b.onload=function(){t[0].src=a}},K=function(){Util.ajax({type:"POST",dataType:"json",url:UserConfig.getUrl,success:function(f){x=f.guid;l.html(f.name+"\uff0c\u60a8\u597d\uff01");n.html(f.ouName);g._userName_=f.name;g._userGuid_=x;var b=f.title,q=f.homes,y=f.logo;b&&(document.title=b);y&&u.attr("src",Util.getRightUrl(epoint.dealRestfulUrl(y)));g.FixedTabs&&0!==FixedTabs.length||(FixedTabs=[],a.each(q,function(a,b){FixedTabs.push({id:"home-"+a,name:b.name,url:b.url})}));initFixedTab();setTimeout(function(){p.html(f.name);k.html(f.ouName);f.hasParttime&&a("#user-btns",e).addClass("switch")},800)}})},w=function(){f.on("click",A);a("body").on("click",function(e){a.contains(f[0],e.target)||v()});e.on("click",".fui-user-linkitem",function(){var e=a(this),b=e.data("url"),f=e.text(),e="userlink-"+e.index();TabsNav.addTab({id:e,name:f,url:b});v()}).on("click",".fui-user-logout",function(){B()}).on("click",".fui-user-switch",function(){if(UserConfig.onSwitch)UserConfig.onSwitch(x)})};a(function(){D();K();w()})})(this,jQuery);(function(g,a){var f=a("#fuiBody"),e=a("#sidebar",f),l=a("#leftNav",e),n=a(".fui-sidebar-toggle",e),p=a("#page-cover"),k=a("#navOverall",e),q=a(".fui-overall-content",k),t=a(".fui-overall-navs",q),f=a(".fui-overall-footer",q),u=a(".fui-overall-scroller",f),x=a(".fui-scroller-left",u),z=a(".fui-scroller-right",u),v=a("#navResult",k),A=a("#navSearch",f).children("input"),B=a("#fuiHeader").outerHeight(),D=k.outerHeight(),K=n.outerHeight(),w=k.find(".fui-overall-content").width(),H=0,b=0,I=function(){var d=a(g).height()-B-K-D;l.css("height",d)},y=Mustache,Q=a.trim(NAV_TPL),R=a.trim(SUBNAV_TPL),J=a.trim(QUICKNAV_TPL),E=a.trim(RESULTNAV_TPL),r={},L=!1,C={_cache:{},searchNodes:[],cacheNodeData:function(a){var d,c=a.rowkey;this._cache[c]={};for(d in a)"items"!==d&&(this._cache[c][d]=a[d])},getNodeData:function(a){return(a=this._cache[a])?a:null},cacheSearchNode:function(a){a.url&&this.searchNodes.push({name:a.name,url:a.url,code:a.code})}},O=function(d,e){var c=[];a.each(d,function(h,m){var d={name:m.name,icon:m.icon||"modicon-1",url:m.url,code:m.code,openType:m.openType,hasSub:m.hasSub};d.rowkey=void 0===e?h+"":e+"-"+h;C.cacheNodeData(a.extend({},m,d));d.hasSub||(r[d.code]=!0);c.push(y.render(Q,d))});return c.join("")},P=function(d,e){var c=[];a.each(d,function(h,m){var d={name:m.name,icon:m.icon,url:m.url,code:m.code,openType:m.openType,hasSub:m.items&&m.items.length};d.rowkey=void 0===e?h+"":e+"-"+h;C.cacheNodeData(a.extend({},m,d));var b=a.extend({},m,d);b.isOverall=!0;b.hasSub=!0;d.hasSub?(d=M(m.items,d.rowkey,!0),c.push(y.render(Q,a.extend(b,{subItem:d})))):(c.push(y.render(Q,b)),C.cacheSearchNode(d))});return c.join("")},M=function(d,e,c){var h=[];a.each(d,function(m,d){var b={name:d.name,url:d.url,code:d.code,openType:d.openType,hasSub:d.items&&d.items.length};b.rowkey=void 0===e?m+"":e+"-"+m;var f=b.rowkey.split("-").length;b.indent=1!==f?20+15*(f-2):!1;C.cacheNodeData(a.extend({},d,b));b.hasSub?h.push(y.render(R,a.extend(b,{subItem:M(d.items,b.rowkey,c)}))):(h.push(y.render(R,b)),c&&C.cacheSearchNode(b))});return h.join("")},T=function(d){d&&d.length&&(d=y.render(J,{name:QuickNav.name,icon:QuickNav.icon,editUrl:QuickNav.editUrl,quickNav:d}),a(Util.clearHtml(d)).appendTo(l))},U=function(d){d&&d.items.length&&(html=O(d.items),a(Util.clearHtml(html)).appendTo(l))},W=function(d){var b=[];a.each(C.searchNodes,function(a,h){if(h.url){var c=h.name.indexOf(d);if(0<=c){var e={url:h.url,code:h.code,name:h.name,openType:h.openType},f=[];f.push(h.name.substr(0,c));f.push('\x3cspan class\x3d"keynote"\x3e'+h.name.substr(c,d.length)+"\x3c/span\x3e");f.push(h.name.substring(c+d.length));e.resultName=f.join("");b.push(y.render(E,e))}}});return b.join("")},N=function(a,e){if(e){if(a==b)return;a-=w;a<b&&(a=b)}else{if(0===a)return;a+=w;0<a&&(a=0)}0===a?(x.addClass("disabled"),z.removeClass("disabled")):a>b?(x.removeClass("disabled"),z.removeClass("disabled")):(x.removeClass("disabled"),z.addClass("disabled"));t.stop(!0).animate({left:a},800)},F=function(){l.on("mousewheel",function(d){a(d.target).closest(".fui-nav.second").length||(d.preventDefault(),this.scrollTop+=d.deltaY*d.deltaFactor*-1)})},S=function(){e.on("click",".fui-nav-link",function(c){c.preventDefault();c=a(this);var h=c.data("url"),m=c.data("code"),d=c.attr("title"),b=c.data("rowkey"),e=c.data("opentype"),f=c.parent(),n=!!f.find("\x3e .fui-nav").length,y=SidebarNav.onNodeClick;if(!b||!y||!1!==y.call(this,C.getNodeData(b))){if(f.hasClass("top"))if(f.hasClass("opened")?p.addClass("hidden"):p.removeClass("hidden"),f.hasClass("fui-overall"))q.removeClass("small"),A.val(""),f.toggleClass("opened"),l.children(".opened").removeClass("opened");else{f.toggleClass("opened").siblings(".opened").removeClass("opened");k.removeClass("opened");b=f.children("a.fui-nav-link");if(b.hasClass("quick-link-js"))return;b=b.data("code");f.hasClass("fui-nav-item top")&&!r[b]&&X(b,f)}else n&&(f.hasClass("opened")?f.removeClass("opened"):f.siblings(".opened").removeClass("opened").end().addClass("opened"));if(!n&&(c.closest(".fui-nav-item.top,.fui-overall").removeClass("opened"),p.addClass("hidden"),h))return"blank"==e?g.open(Util.getRightUrl(h)):TabsNav.addTab({id:m,name:d,url:h}),c=c.closest(".fui-nav-item.top"),c.length?c.removeClass("opened"):k.removeClass("opened"),!1}}).on("click",".fui-nav-edit",function(){var c=a(this),h=c.data("url"),m=c.parent().text();TabsNav.addTab({id:"editNav",name:m,url:h});c.closest(".fui-nav-item.top").removeClass("opened")}).on("click",".fui-overall-link",function(c){c=a(this).parent();L||G();q.removeClass("small");A.val("");c.hasClass("opened")?p.addClass("hidden"):p.removeClass("hidden");c.toggleClass("opened");l.children(".opened").removeClass("opened")});a("body").on("click",function(c){a.contains(l[0],c.target)||a.contains(k[0],c.target)||e.find(".fui-nav-item.top, .fui-overall").removeClass("opened")});var d=null;A.on("keyup",function(c){var h=a.trim(this.value);h.length?(d&&clearTimeout(d),d=setTimeout(function(){var a=W(h);v.find(".fui-nav-items").html(Util.clearHtml(a))},500),q.addClass("small")):q.removeClass("small")});u.on("click",".fui-scroller-left",function(){if(a(this).hasClass("disabled"))return!1;var c=parseInt(t.css("left"));N(c)}).on("click",".fui-scroller-right",function(){if(a(this).hasClass("disabled"))return!1;var c=parseInt(t.css("left"));N(c,!0)});n.on("click",function(){e.hasClass("big")?(e.removeClass("big"),a("#tabs-nav").css("marginLeft","46px"),a.cookie("isBigSidebar","0")):(e.addClass("big"),a("#tabs-nav").css("marginLeft","146px"),a.cookie("isBigSidebar","1"))});a.fn.mousewheel?F():Util.loadJs("frame/fui/js/lib/jquery.mousewheel.min.js",F);var b=0;a(g).on("resize",function(){b&&clearTimeout(b);b=setTimeout(I,50)})},V=function(){Util.ajax({url:SidebarNav.loadUrl,data:{query:"top"}}).done(U,S,I).fail(S,I)},X=function(b,e){r[b]="pedding";Util.ajax({url:SidebarNav.loadUrl,data:{query:"sub",code:b}}).done(function(c){var h=e.find(".fui-nav-items"),m=h.siblings(".ajax-loading");c&&c.length&&(html=M(c),a(Util.clearHtml(html)).appendTo(h),m.addClass("hidden"));r[b]=!0}).fail(function(){r[b]=!1})},G=function(){Util.ajax({url:SidebarNav.loadUrl,data:{query:"all"}}).done(function(d){d&&d.length&&(html=P(d),a(Util.clearHtml(html)).appendTo(t),H=t.children().eq(0).outerWidth()*d.length,b=w-H,t.css("width",H),0<=b&&z.addClass("disabled"),q.find(".ajax-loading").addClass("hidden"),L=!0)},I).fail(I)};"0"==a.cookie("isBigSidebar")&&(e.removeClass("big"),a("#tabs-nav").css("marginLeft","46px"));setTimeout(function(){Util.ajax({url:QuickNav.loadUrl}).done(T,V).fail(V)},1)})(this,jQuery);(function(g,a){var f=a("#tabs-nav"),e=a(".fui-main-head",f),l=a(".fui-main-tabcontainer",e),n=a(".fui-main-tabs",e),p=n.filter("#fixedTabs"),k=n.filter("#mainTabs"),q=a(".fui-taboperation-scroller",e),t=a(".fui-tabscroller-left",e),u=a(".fui-tabscroller-right",e),x=a(".fui-taboperation-close",e),z=a(".fui-taboperation-more",e),v=a(".fui-taboperation-dropdown",e);a(".fui-taboperation-history",v);var A=a(".fui-taboperation-current",v),B=A.filter("#currentFixed"),D=A.filter("#currentCommon"),K=a("#mainframe",f),w=Mustache,H=a.trim(TAB_ITEM_TPL),b=a.trim(TAB_CONTENT_TPL),I=a.trim(TAB_CURRENT_TPL),y=a(".fui-main-taboperation",e).outerWidth(!0),Q=a(".fui-main-msg",e).outerWidth(!0),R=0,J=0,E=0,r={},L=[],C="",O=!1,P=null,M={_cache:[],_reSort:function(a){for(var c=this._cache[a],b=0;b<=a;b++){var d=this._cache[b];this._cache[b]=c;c=d}},_inHistory:function(a){for(var c=0,b=this._cache.length;c<b;c++)if(this._cache[c].id==a.id)return c;return-1},addHistory:function(a){var c=this._inHistory(a);-1<c?0<c&&this._reSort(c):(3<=this._cache.length&&this._cache.pop(),this._cache.unshift(a))},removeHistory:function(a){for(var c=0,b=this._cache.length;c<b;c++)if(this._cache[c].id==a.id){this._cache.splice(c,1);break}}},T=function(c){c?(B.empty(),a.each(L,function(c,b){var h={id:r[b].id,name:r[b].name,isFixed:!0};b==P&&(h.isActive=!0);a(Util.clearHtml(w.render(I,h))).appendTo(B)})):(D.empty(),a.each(r,function(c,b){if(b&&b.closeIcon){var h={id:b.id,name:b.name};"tab-"+b.id==P&&(h.isActive=!0,B.find(".active").removeClass("active"));a(Util.clearHtml(w.render(I,h))).appendTo(D)}}));O=!1},U=function(){k.children().length?x.removeClass("disabled"):x.addClass("disabled")},W={closeIcon:!0};g.TabsNav={_tab_w:null,_getTabWidth:function(){this._tab_w||(this._tab_w=k.children().eq(0).outerWidth(!0));return this._tab_w},addTab:function(c,h){var d=a.extend({},W,c),e="tab-"+d.id;r[e]||(h?(d.realUrl=Util.getRightUrl(d.url),d.url="about:blank"):d.url=Util.getRightUrl(d.url),d.closeIcon?a(Util.clearHtml(w.render(H,d))).appendTo(k):a(Util.clearHtml(w.render(H,d))).appendTo(p),a(Util.clearHtml(w.render(b,d))).appendTo(K),r[e]=d,h&&(r[e].notInit=!0),this.adjustSize(),O=!0,U());h||this.activeTab(e)},getActiveTab:function(){var a=n.find("li.active");return new N(r[a[0].id])},getTabByIndex:function(a){},activeTab:function(c){var b=a("#"+c);if(b.length){var d=a("#"+b[0].getAttribute("ref")),e=r[c];b.hasClass("active")||(n.find("li.active").removeClass("active"),b.addClass("active"),e.notInit&&(d.find("iframe")[0].src=e.realUrl,e.notInit=!1),d.addClass("active").siblings(".fui-tab-content").removeClass("active"),P=c,b=A.find('[data-tabid\x3d"'+P+'"]'),b.length&&!b.hasClass("active")&&(A.find(".active").removeClass("active"),b.addClass("active")),-1==a.inArray(c,L)&&this.adjustTabPosOnActive(c))}},adjustTabPosOnActive:function(c){if(!q.hasClass("invisible")){var b=a("#"+c).prevAll();c=this._getTabWidth();var d=Math.ceil(Math.abs(parseFloat(k.css("margin-left"),10))),e=d,b=c*b.length;b<d?e=b:b>=E+d?e=b+c-E:b>d&&b<E+d&&b+c>E+d&&(e=b+c-E);k.stop(!0).animate({marginLeft:-e},500);0===e?(t.addClass("disabled"),u.removeClass("disabled")):e==J?(t.removeClass("disabled"),u.addClass("disabled")):(t.removeClass("disabled"),u.removeClass("disabled"))}},removeTab:function(c){var b=a("#"+c),d=a("#"+b[0].getAttribute("ref"));b.hasClass("active")&&(b.prev().length?this.activeTab(b.prev()[0].id):b.next().length?this.activeTab(b.next()[0].id):this.activeTab(C));b.remove();Util.clearIframe(d.find("\x3eiframe"));d.remove();delete r[c];this.adjustSize();O=!0;U()},removeAll:function(a){k.find(".fui-main-tab").each(function(c,b){var d=b.id;d!=a&&TabsNav.removeTab(d)});a||TabsNav.activeTab(C)},adjustSize:function(){var a=e.width()-y-Q-R-1,b=this._getTabWidth()*k.children().length;0<b&&k.css("width",b);a>b?(q.addClass("invisible"),k.stop(!0).css("margin-left",0),l.css("width","auto")):(q.removeClass("invisible"),u.addClass("disabled"),t.removeClass("disabled"),J=b-a,E=a,k.stop(!0).css("margin-left",-J),l.css("width",E))},refreshTabContent:function(c){var b=a("#"+c),b=a("#"+b[0].getAttribute("ref"));a("iframe",b)[0].src="about:blank";a("iframe",b)[0].src=Util.getRightUrl(r[c].realUrl||r[c].url)}};var N=function(a){this._data=a};a.extend(N.prototype,{remove:function(){var c="tab-"+this._data.id;-1<a.inArray(c,L)?console.warn("\u8b66\u544a\uff1a\u56fa\u5b9aTab\u662f\u4e0d\u80fd\u5220\u9664\u7684\uff01"):TabsNav.removeTab(c)},getData:function(){var c=this._data;return a.extend({},c,{tabId:"tab-"+c.id})},refreshContent:function(){TabsNav.refreshTabContent("tab-"+this._data.id)},active:function(){TabsNav.activeTab("tab-"+this._data.id)},prev:function(){var c=a("#tab-"+this._data.id).prev();if(c.length)return new N(r[c[0].id]);console.warn("\u5df2\u7ecf\u5230\u5934\u4e86\uff01")},next:function(){var c=a("#tab-"+this._data.id).next();if(c.length)return new N(r[c[0].id]);console.warn("\u5df2\u7ecf\u5230\u5c3e\u4e86\uff01")}});var F=function(){z.hasClass("active")&&(z.removeClass("active"),v.addClass("hidden"))},S=!1,V=function(){mini.showMessageBox({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u5173\u95ed\u6240\u6709tab\uff1f",buttons:["ok","cancel"],iconCls:"mini-messagebox-question",showNoTipCheck:!0,clickNoTipCheck:function(a){S=a},callback:function(a){"ok"==a&&TabsNav.removeAll()}})};a(g).on("resize",function(a){TabsNav.adjustSize()});f.on("click",".fui-main-tab",function(a){TabsNav.activeTab(this.id)}).on("click",".fui-tab-refresh",function(a){a.stopPropagation();TabsNav.refreshTabContent(this.parentNode.id);F()}).on("click",".fui-tab-close",function(a){a.stopPropagation();a=this.parentNode.id;M.addHistory(r[a]);TabsNav.removeTab(a);F()});u.on("click",function(a){a=parseInt(k.css("marginLeft"));a!=-J&&(a-=100,a<=-J&&(a=-J,u.addClass("disabled")),k.stop(!0,!0).animate({marginLeft:a},500));t.removeClass("disabled")});t.on("click",function(a){a=parseInt(k.css("marginLeft"));0!==a&&(a+=100,0<=a&&(a=0,t.addClass("disabled")),k.stop(!0,!0).animate({marginLeft:a},500));u.removeClass("disabled")});x.on("click",function(){x.hasClass("disabled")||(S?TabsNav.removeAll():V())});var X=a("#page-cover");z.on("click",function(){var b=a(this);b.hasClass("active")?F():(b.addClass("active"),O&&T(),v.removeClass("hidden"),X.removeClass("hidden"))});var G=null;v.on("click",".fui-history-item",function(){var b=a(this);if(!b.hasClass("empty")){var d=b.data("url"),e=b.data("tabid"),b=b.text();TabsNav.addTab({id:e.substr(4),name:b,url:d});M.removeHistory(r[e]);F()}}).on("click",".fui-current-item",function(){var b=a(this),d=b.data("tabid");b.hasClass("active")||(TabsNav.activeTab(d),A.find(".active").removeClass("active"),b.addClass("active"));F()});a("body").on("click",function(b){0===a(b.target).closest(".fui-main-taboperation").length&&F()});g.tabContextMenu={refresh:function(a){TabsNav.refreshTabContent(a.sender.ownerMenu.tabId)},closeOther:function(a){TabsNav.removeAll(a.sender.ownerMenu.tabId)},close:function(a){a=a.sender.ownerMenu.tabId;M.addHistory(r[a]);TabsNav.removeTab(a)}};var d=mini.get("tabContextMenu");a(d.el).on("mouseout",function(){G&&(clearTimeout(G),G=null);G=setTimeout(function(){d.hide()},500)}).on("mouseover",function(){G&&(clearTimeout(G),G=null)});k.on("contextmenu",".fui-main-tab",function(a){d.set({tabId:this.id}).showAtPos(a.pageX,a.pageY);return!1});g.initFixedTab=function(){a.each(FixedTabs,function(a,b){TabsNav.addTab({id:b.id,name:b.name,url:b.url,closeIcon:!1},!0);L.push("tab-"+b.id);C="tab-"+b.id});TabsNav.activeTab("tab-"+FixedTabs[0].id);R=p.outerWidth(!0);T(!0);a.niceScroll?Y():Util.loadJs("frame/fui/js/lib/jquery.nicescroll.min.js",Y)};var Y=function(){D.niceScroll({cursorcolor:"#666"})}})(this,jQuery);(function(g,a){function f(){D=new MessageList({container:t,getUrl:MsgRemind.getUrl,ignoreUrl:MsgRemind.ignoreUrl,afterOpenMsg:B,afterIgnore:function(a){v()}})}function e(){w=new EMsgList({content:K,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:B,onDecEmsgCount:H});g.RefreshEMsg=a.proxy(w.getData,w)}var l=a("#rightMessage"),n=a(".fui-msg-iconlist",l),p=a(".msg-panel",l),k=a(".icon-info",n).next(),q=a(".icon-emsg",n).next(),l=a("#msgRemind",p),t=a(".msg-panel-content",l),l=a("#msg-sound"),u,x;Util.browsers.isIE?u=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden" id\x3d"msgcenter-sound"\x3e\x3c/iframe\x3e').appendTo(l):(l.html('\x3caudio id\x3d"msgcenter-sound-audio" controls\x3d"controls" src\x3d"../../msgsound/newsms.wav" class\x3d"hidden-accessible"\x3e\x3c/audio\x3e'),x=document.getElementById("msgcenter-sound-audio"));a.trim(MSG_TPL);var z=function(a){a=parseInt(a);return 99<a?"99+":0>=a?"":a+""},v=function(){var a=!1,e=!1,f,g;Util.ajax({url:MsgNumUrl,data:{haseXun:!0,needNum:!0}}).done(function(b){b.remind?(g=parseInt(b.remind),f=k.data("num")||0,g>f?a=!0:g&&(e=!0),k.text(z(g)).data("num",g)):k.text("").data("num",0);b.eXun?(g=parseInt(b.eXun),a||(f=q.data("num")||0,g>f?a=!0:g&&(e=!0)),q.text(z(g)).data("num",g)):q.text("").data("num",0);a?(Util.browsers.isIE?u[0].src=Util.getRightUrl(SOUND_URL+"?_\x3d"+ +new Date):x.play(),docTitle.roll()):e||docTitle.stop()})},A=a("#page-cover"),B=function(){p.animate({right:-350},function(){p.addClass("hidden")});n.find(".active").removeClass("active")},D;g.MessageList?f():Util.loadJs("../../messagelist/messagelist.js",function(){f()});n.on("click",".fui-msg-iconitem",function(b){b.stopPropagation();b=a(this);var e=b.data("ref"),f=a("#"+e,p);b.hasClass("active")?B():(b.addClass("active").siblings(".active").removeClass("active"),"msgRemind"==e?D.getData():"msgEMsg"==e&&w.getData(),f.removeClass("hidden").siblings().addClass("hidden"),f.find(".msg-panel-content").removeClass("hidden"),p.removeClass("hidden"),p.animate({right:0}),A.removeClass("hidden"))});a("body").on("click",function(b){0===a(b.target).closest(".msg-panel").length&&B()});l=a("#msgEMsg",p);a("li[data-ref\x3d'msgEMsg']",n);var l=a(".msg-panel-content",l),K=a(".emsg-recent-list",l),w;g.EMsgList?e():Util.loadJs("../../emsglist/emsglist.js",function(){e()});var H=function(){var a=q.text();a&&(a=parseInt(a)-1);0==a&&(a="");q.text(a)};p.on("click",".msg-panel-hide",function(){B()});a(function(){v();setInterval(v,6E4)})})(this,jQuery);(function(g,a){var f=function(){a("[placeholder]").placeholder()};a.placeholder?f():Util.loadJs("frame/fui/js/lib/jquery.placeholder.min.js",f)})(this,jQuery);(function(g,a){var f,e="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",l=0;g.docTitle={roll:function(){f||(f=document.title);document.title=e;clearTimeout(l);l=setTimeout(function p(){document.title=e.substring(1,e.length)+e.substring(0,1);e=document.title;l=setTimeout(p,300)},300)},stop:function(){clearTimeout(l);document.title=f||document.title;e="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}}})(window,jQuery);var eMsgSocket;window.OpenEMsg=function(g,a,f){window.eMsg?"undefined"==typeof a?eMsg.open(g):eMsg.openSession(g,a,f):Util.loadPageModule({templ:"frame/fui/pages/emsg/emsg.tpl",js:"frame/fui/pages/emsg/emsg.js",css:"frame/fui/pages/emsg/emsg.css",callback:function(){eMsgSocket=new EMsgSocket(_userGuid_,_userName_);"undefined"==typeof a?eMsg.open(g):eMsg.openSession(g,a,f)}})};(function(g){var a=g("#headerUser"),f=g("#leftNav,#navOverall"),e=g("#page-cover");g("body").on("click",function(l){var n=l.target,p=g(n),k=!0;0!==g(l.target).closest(".msg-panel").length&&(k=!1);g.contains(a[0],n)&&(k=!1);if(g.contains(f[0],n)||g.contains(f[1],n))k=!1;0!==p.closest(".fui-main-taboperation").length&&(k=!1);k&&e.addClass("hidden")})})(jQuery);