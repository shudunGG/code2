// 应用模板
var METRO_APP_TPL='\x3cdiv class\x3d"metro-app" data-id\x3d"{{id}}" title\x3d"{{name}}" style\x3d"top:{{top}}px;left:{{left}}px;width:{{width}}px;height:{{height}}px;"\x3e\x3cdiv class\x3d"app-inner" style\x3d"background-color:{{bgcolor}}"\x3e{{#innerUrl}}\x3ciframe src\x3d"{{innerUrl}}" frameborder\x3d"0" width\x3d"{{ifrWidth}}" height\x3d"{{ifrHeight}}" allowtransparency\x3d"true" class\x3d"app-iframe" scrolling\x3d"no"\x3e\x3c/iframe\x3e{{/innerUrl}}{{#icon}}{{{icon}}}{{/icon}}\x3cp class\x3d"app-name"\x3e{{name}}\x3c/p\x3e\x3cspan class\x3d"app-unread unread {{^count}}hidden{{/count}}"\x3e{{count}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',METRO_SCREEN_TPL='\x3cdiv class\x3d"screen-item l" data-name\x3d"{{name}}" data-server-index\x3d"{{screenIndex}}"\x3e\x3ch2 class\x3d"screen-header"\x3e{{name}}\x3c/h2\x3e\x3cdiv class\x3d"apps-wrap"\x3e{{{appHtml}}}\x3c/div\x3e\x3c/div\x3e',METRO_SCREEN_NAV_TPL='\x3cli class\x3d"screen-nav-item" title\x3d"{{name}}" data-server-index\x3d"{{screenIndex}}"\x3e\x3c/li\x3e',COMMON_APP_TPL='\x3cdiv class\x3d"common-app" data-id\x3d"{{id}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"common-app-unread app-unread unread {{^count}}hidden{{/count}}"\x3e{{count}}\x3c/span\x3e\x3cspan class\x3d"common-app-icon-wrap"\x3e{{#icon}}{{{icon}}}{{/icon}}\x3c/span\x3e\x3cspan class\x3d"common-app-name"\x3e{{sname}}\x3c/span\x3e\x3c/div\x3e',METRO_TASK_TPL='\x3ca href\x3d"javascript:void(0);" data-id\x3d"{{id}}" class\x3d"task-item l clearfix" title\x3d"{{name}}"\x3e\x3cp class\x3d"task-name"\x3e{{name}}\x3c/p\x3e\x3c/a\x3e',BOARD_CONTENT_TPL='\x3ciframe src\x3d"{{url}}" class\x3d"board-content hidden" id\x3d"board-content-{{id}}" height\x3d"100%" width\x3d"100%" frameborder\x3d"0" scrolling\x3d"no"\x3e\x3c/iframe\x3e';(function(e,a){function h(a){Object.freeze(a);for(var d in a)"object"==typeof a[d]&&Object.prototype.hasOwnProperty.call(a,d)&&Object.freeze(a[d])}Util.browsers.isIE8||a.ajax({url:"./images/app/svg.svg",dataType:"html",async:!1,success:function(f){a('\x3cdiv hidden class\x3d"hidden"\x3e\x3c/div\x3e').append(f).appendTo("body")}});EpDialog.setMaxCoord({top:50,left:0,right:0,bottom:40});e.METRO_SETTINGS||(e.METRO_SETTINGS={});METRO_SETTINGS=a.extend({},{columns:4,rows:4,activePage:1,dialogSizeRadio:[.6,.6],scrollDirection:0,appSize:[200,90],baseSize:[1200,600]},METRO_SETTINGS);Object.freeze&&h(e.METRO_SETTINGS);e.useWebsocket=!0===Util.getFrameSysParam("useWebsocket");e.eWebSocket=void 0;e.creatWebSocket=function(a,d,b){if(eWebSocket)b&&b();else{var f=e.EWebSocketConfig?e.EWebSocketConfig:{url:EmsgConfig.websocketUrl};f.uid=a;f.uname=d;e.EWebSocket?(eWebSocket=new EWebSocket(f),b&&b(),_aideEvent_.fire("websocketCreated")):Util.loadJs("frame/fui/js/widgets/ewebsocket/ewebsocket.js",function(){eWebSocket=new EWebSocket(f);b&&b();_aideEvent_.fire("websocketCreated")})}};a.extend(Util,{debounce:function(a,d,b){d=d||17;var f;return function(){var e=arguments,h=b||this;clearTimeout(f);f=setTimeout(function(){a.apply(h,e)},d)}},throttle:function(a,d,b){d=d||200;var f,e=+new Date;return function(){clearTimeout(f);var h=arguments,l=b||this,r=+new Date-e;r>=d?(a.apply(l,h),e=+new Date):f=setTimeout(function(){a.apply(l,h);e=+new Date},d-r)}},sortArr:function(a,d){var b=Array.prototype.slice.call(a,0),f;d||(d="asc");"asc"==d?f=function(a,b){return a-b}:"desc"==d&&(f=function(a,b){return b-a});return b.sort(f)},fixPath:function(f){var d=a.extend({},f);d.url=Util.getRightUrl(f.url);f.innerUrl&&(d.innerUrl=Util.getRightUrl(f.innerUrl));return d},_genderIconHtml:function(){return Util.browsers.isIE8?function(a,d){return'\x3cimg src\x3d"'+Util.getRightUrl("./images/app/"+a+".png")+'" class\x3d"'+d+'" alt\x3d""\x3e'}:function(a,d){return'\x3csvg class\x3d"'+d+'"\x3e\x3cuse xlink:href\x3d"#metro-app-icon-'+a+'"\x3e\x3c/use\x3e\x3c/svg\x3e'}}(),highlightApp:function(a){var d=function(){a.animate({opacity:.3},200,f)},b=function(){a.animate({opacity:1},200,f)},f=function(){a.queue("highlight").length?a.dequeue("highlight"):a.clearQueue("highlight")};a.queue("highlight",[d,b,d,b,d,b,d,b]);f()},configAppCmOpers:function(a,d){!1!==d.uninstallable?a.enableItem("uninstall-app"):a.disableItem("uninstall-app");!1!==d.movable?a.enableItem("move-app"):a.disableItem("move-app");!1!==d.openable?a.enableItem("open-app"):a.disableItem("open-app")},getAppShortName:function(a){return a.substr(0,4)},_jsPromise:{},loadJsPromise:function(f){if(this._jsPromise[f])return this._jsPromise[f];var d=a.Deferred(),b=document.createElement("script");b.type="text/javascript";(this.browsers.isIE67||this.browsers.isIE8)&&b.readyState?b.onreadystatechange=function(){if("loaded"==b.readyState||"complete"==b.readyState)d.resolve(),b.onreadystatechange=null}:(b.onload=function(){d.resolve();b.onload=null},b.onerror=function(){d.reject();b.onerror=null;Util._jsPromise[f]=null});b.src=Util.getRightUrl(f);document.getElementsByTagName("head")[0].appendChild(b);return this._jsPromise[f]=d.promise()},doNiceScroll:function(a,d){this.loadJsPromise("frame/fui/js/widgets/jquery.nicescroll.min.js").done(function(){a.niceScroll(d)})}});e._MetroEvent_=new Util.UserEvent})(this,jQuery);(function(e,a){var h=a("#metro-skin-bg");Util.ajax({url:MetroDataActionUrl.getBgUrl}).done(function(a){a&&a.bg?(h[0].src=Util.getRightUrl(a.bg),localStorage.setItem("_imac_bg_",a.bg)):(h[0].src=Util.getRightUrl("frame/fui/pages/themes/metro/images/skinbg/new.jpg"),console&&console.error("\u672a\u8fd4\u56de\u80cc\u666f\uff0c\u52a0\u8f7d\u9ed8\u8ba4\u80cc\u666f\uff01"),localStorage.setItem("_imac_bg_","frame/fui/pages/themes/metro/images/skinbg/new.jpg"))});e.setBg=function(a){h[0].src=Util.getRightUrl(a);localStorage.setItem("_umplatform_bg_",a)}})(this,jQuery);(function(e,a){var h=a("#top-user"),f=a(".user-img",h),d=a("#sys-logo");(function(){return Util.ajax({url:e.MetroDataActionUrl.userInfoUrl,success:function(b){h.find(".user-name").text(b.name);h.find(".user-ou").text(b.ouName);e._userName_=b.name;e._userGuid_=b.guid;e._msgcenterConfig_=a.extend({},MsgCenterConfig,{isMsgCenterMaxSize:b.isMsgCenterMaxSize||!1,msgCenterOrder:b.msgCenterOrder||"asc",hideCallback:function(){$cover.addClass("hidden")}});useWebsocket&&creatWebSocket(_userGuid_,_userName_);if(b.portrait){var d=Util.getRightUrl(epoint.dealRestfulUrl(b.portrait));f.attr("src",d)}b.hasParttime&&h.find(".user-action-item.role-change").removeClass("hidden");_MetroEvent_.fire("afterUserInfo",b)}})})();(function(){return Util.ajax({url:MetroDataActionUrl.pageInfoUrl}).done(function(a){a.logo&&d.attr("src",Util.getRightUrl(a.logo));a.title&&(document.title=a.title,e.systemTitle=a.title);e._fullSearchUrl_=a.fullSearchUrl;_MetroEvent_.fire("afterPageInfo",a)})})()})(this,jQuery);(function(e,a){function h(){var a=Util.getWinSize(),b=1;a.width>METRO_SETTINGS.baseSize[0]&&a.height>METRO_SETTINGS.baseSize[1]&&(b=parseFloat(Math.min(a.width/METRO_SETTINGS.baseSize[0],a.height/METRO_SETTINGS.baseSize[1]),10));a=METRO_SETTINGS.appSize[0]*b>>0;b=METRO_SETTINGS.appSize[1]*b>>0;A=a==q&&b==m?!1:!0;q=a;m=b;w=e.METRO_SETTINGS.columns*q;x=e.METRO_SETTINGS.rows*m;B=x/2;z=w/2}function f(){A&&b.children().each(function(g,b){a(b).find(".metro-app").each(function(g,b){var c=b.getAttribute("data-id");if(c=AppMgr.getAppData(c))c=C(c),a(b).css({top:c.top,left:c.left,width:c.width,height:c.height}).find(".app-iframe").css({width:c.ifrWidth,height:c.ifrHeight})})})}var d=a("#metro-screens"),b=a(".screen-list",d),r=a("#screen-nav"),t=a(".screen-btn",d),v=t.filter(".prev"),l=t.filter(".next");b[0].setAttribute("data-direction",0===METRO_SETTINGS.scrollDirection?"0":"1");t.attr("data-direction",0===METRO_SETTINGS.scrollDirection?"0":"1");var u=a("#left-bar").width()||90,n=a("#metro-top-bar").height()||50,c=a("#metro-task-bar").height()||40,k={width:0,height:0},p=0==METRO_SETTINGS.scrollDirection?"margin-left":"margin-top",q=METRO_SETTINGS.appSize[0],m=METRO_SETTINGS.appSize[1],w=(e.METRO_SETTINGS.columns||4)*q,x=(e.METRO_SETTINGS.rows||4)*m,B=x/2,z=w/2,A=!0;h();var I=function(){h();var a=Util.getWinSize();k={width:a.width-u,height:a.height-n-c};a=600>a.height?!1:!0;d.css(k).find(".screen-item").css(k).find(".screen-header").css({width:w,marginLeft:-(w/2),marginTop:-(x/2+80),display:a?"block":"none"});b.find(".apps-wrap").css({marginTop:-B,marginLeft:-z,width:w,height:x});r.css({marginTop:x/2+40});t.css("margin-top",-x/2);v.css("margin-left",-(w/2+v.outerHeight()));l.css("margin-left",w/2);0==METRO_SETTINGS.scrollDirection?b.css("margin-left",-y*k.width):b.css("margin-top",-y*k.height)},C=function(g){var b={},c=g.index,d=q*g.colspan-6,k=m*g.rowspan-6,f=d-28,e=k-6-35,p=c%METRO_SETTINGS.rows*m,c=Util.toInt(c/METRO_SETTINGS.rows)*q;a.extend(b,{width:d,height:k,ifrWidth:f,ifrHeight:e,top:p,left:c,bgcolor:g.bgcolor||"#2a6ebb"});return b};a(e).on("resize",Util.debounce(function(){I();f()},17));var D,y=(e.METRO_SETTINGS.activePage||1)-1,J=a.trim(METRO_APP_TPL),F,L=function(g){var c={},d=g.length;g=a.map(g,function(a,g){c={name:a.leftNav.name,icon:a.leftNav.icon,screenIndex:a.leftNav.screenIndex,isFirst:0===g,isLast:g===d-1,appHtml:G(a.screenApps,a.leftNav.screenIndex)};return Mustache.render(METRO_SCREEN_TPL,c)});g=a(g.join(""));g.find(".apps-wrap").css({marginTop:-B,marginLeft:-z,width:w,height:x});b.append(g)},G=function(g,c){return a.map(g,function(g){g=Util.fixPath(g);g.icon&&(g.icon=Util._genderIconHtml(g.icon,"app-icon"));g.screenIndex=c;AppMgr.cacheAppData(g.id,g);return Mustache.render(J,a.extend({},g,C(g)))}).join("")},K=[],H=function(a){var g=a;0>a?g=0:a>=D&&(g=D-1);return g};a(document).on("keydown",function(a){a=a.which;var g;if(38==a||37==a)g=y-1;else if(40==a||39==a)g=y+1;void 0!==g&&(g=H(g),MetroScreen.setPageActive(g))});r.on("click",".screen-nav-item",function(g){g.preventDefault();g=a(this).index();MetroScreen.setPageActive(g)});v.click(function(){this.disabled||MetroScreen.goPrev()});l.click(function(){this.disabled||MetroScreen.goNext()});Util.loadJs(Util.getRightUrl("frame/fui/js/libs/jquery.mousewheel.min.js"),function(){var a;d.on("mousewheel",function(g){console.log(g.deltaX,g.deltaY,g.deltaFactor);clearTimeout(a);a=setTimeout(function(){var a;0>g.deltaY?a=y+1:0<g.deltaY&&(a=y-1);void 0!==a&&(a=H(a),MetroScreen.setPageActive(a))},200)})});e.MetroScreen={setPageActive:function(a){a=H(a);var g=r.find(".screen-nav-item").eq(a);if(!g.hasClass("active")){v.prop("disabled",0===a);l.prop("disabled",a===D-1);var c={};c[p]=-((0==METRO_SETTINGS.scrollDirection?k.width:k.height)*a);b.stop(!0).animate(c,300);g.addClass("active").siblings().removeClass("active");appContextmenu&&F.enableItem("page-"+y).disableItem("page-"+a);y=a}},getActivePage:function(){return y},goPrev:function(){return this.setPageActive(this.getActivePage()-1)},goNext:function(){return this.setPageActive(this.getActivePage()+1)},getActiveNavItem:function(){return r.find(".page-item").eq(y)},getScreen:function(a){return b.find(".screen-item").eq(a)},getApp:function(a){return d.find('[data-id\x3d"'+a+'"]')},addApp:function(g,c){var d=b.find(".screen-item").eq(c),k=a(Mustache.render(J,a.extend({},g,C(g))));k.find(".app-center-item-icon").attr("class","app-icon");k.appendTo(d.find(".apps-wrap"));AppDragMgr.enableApp(k);g.screenIndex=d.data("server-index");AppMgr.cacheAppData(g.id,g);Util.highlightApp(k)},removeApp:function(a){var g=this.getApp(a);AppDragMgr.destroy(g);g.fadeOut(200,function(){g.remove()})},getOccupiedGrids:function(g){var c=[];g=this.getScreen(g).find(".metro-app");a.each(g,function(g,b){var d=a(b),k=d.data("id");d.hasClass("ignored")||(c=c.concat(MetroScreen.getAppOccupiedGrids(k)))});2<=c.length&&(c=Util.sortArr(c));return Array.prototype.slice.call(c,0)},getAppOccupiedGrids:function(g){var c=a.isPlainObject(g)?g:AppMgr.getAppData(g);g=[];var b=c.rowspan,d=c.colspan,c=c.index,k=0,f,e;if(1==d&&1==b)g.push(c);else for(;k<b;k++)for(e=c+k,g.push(e),f=1;f<d;f++)g.push(e+f*METRO_SETTINGS.rows);2<=g.length&&(g=Util.sortArr(g));return Array.prototype.slice.call(g,0)},getAppByIndex:function(g,c){var b=!1;this.getScreen(g).find(".metro-app").each(function(g,d){var k=a(d).data("id");if((k=AppMgr.getAppData(k))&&k.index==c)return b=a(d),!1});return b},getAppIndexByPos:function(a){var g;a.left>(METRO_SETTINGS.columns-1)*q+q/2||a.top>(METRO_SETTINGS.rows-1)*m+m/2?g=-1:(g=(0>a.left?0:a.left)/q,a=(0>a.top?0:a.top)/m,g=Math.round(g)*METRO_SETTINGS.rows+Math.round(a));return g},adjustAppPosByIndex:function(a,c){var g=a.data("id"),b=AppMgr.getAppData(g),d;d=Util.toInt(c/METRO_SETTINGS.rows);var k=Util.toInt(c%METRO_SETTINGS.rows);d={left:q*d,top:m*k};b&&(a.stop(!0).animate(d,200),b.index!=c&&(b.index=c,AppMgr.cacheAppData(g,b),AppMgr.sendAppUpdate(g,"update-app-index")))},isOneBlock:function(a){var g=a.index;a=a.rowspan;for(var c=Util.toInt(g/METRO_SETTINGS.rows),b=1;b<a;b++)if(Util.toInt((g+b)/METRO_SETTINGS.rows)!=c)return!1;return!0},getEmptyGrids:function(g){var c=METRO_SETTINGS.columns*METRO_SETTINGS.rows;g=MetroScreen.getOccupiedGrids(g);for(var b=[],d=0;d<c;d++)-1==a.inArray(d,g)&&b.push(d);return Array.prototype.slice.call(b,0)},getInsertIndex:function(g,c){var b=g.rowspan,d=g.colspan,k=MetroScreen.getEmptyGrids(c),f=0,e=!0,m,p,h;p=k.length;h=b*d;if(!p||h>p)f=-1;else if(1==b&&1==d)f=k[0];else{for(d=0;d<p;d++)if(e=!0,g.index=k[d],MetroScreen.isOneBlock(g)){b=MetroScreen.getAppOccupiedGrids(g);for(m=0;m<h;m++)if(-1==a.inArray(b[m],k)){e=!1;break}if(e){f=g.index;break}}e||-1==f}return f}};var M=function(){var a=[],c,b=[],d=function(a,c){AppMgr.moveToScreen(a.id,c.page)};a.push({text:"\u6253\u5f00\u5e94\u7528",role:"open-app",click:function(a){AppMgr.openApp(a.id)}});a.push("sep");for(c=1;c<=D;c++)b.push({text:K[c-1].name,role:"page-"+(c-1),page:c-1,click:d});a.push({text:"\u79fb\u52a8\u5e94\u7528\u5230",role:"move-app",items:b});a.push({text:"\u5378\u8f7d\u5e94\u7528",role:"uninstall-app",click:function(a){mini.confirm("\u60a8\u786e\u5b9a\u5378\u8f7d\u8be5\u5e94\u7528\u5417\uff1f\u5378\u8f7d\u540e\u53ef\u4ece\u5e94\u7528\u4ed3\u5e93\u4e2d\u518d\u6b21\u6dfb\u52a0\u5230\u684c\u9762\u3002","\u7cfb\u7edf\u63d0\u793a",function(c){"ok"==c&&AppMgr.uninstallApp(a.id)})}});return new EpContextMenu({items:a})},E={};e.sss=E;e.AppMgr={msgRemindApps:[],cacheAppData:function(c,b){E[c]=a.extend({},b);b.needMsgRemind&&AppMgr.msgRemindApps.push(b.id)},getAppData:function(c){if(E[c])return a.extend({},E[c])},delAppData:function(a){E[a]=null},openApp:function(a){var c=AppMgr.getAppData(a);c.isBlank?e.open(c.url):TabsNav.addOrActiveTask(a)},installApp:function(a){if(a.rowspan&&a.colspan){var c=MetroScreen.getActivePage();a=Util.fixPath(a);var b=MetroScreen.getInsertIndex(a,c);if(-1===b)return epoint.showTips("\u5f88\u62b1\u6b49\uff0c\u5f53\u524d\u9875\u6ca1\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u5b89\u88c5\u8be5\u5e94\u7528\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u5176\u4ed6\u5206\u5c4f\u6216\u8005\u8c03\u6574\u5e94\u7528\u5e03\u5c40\u540e\u518d\u5b89\u88c5\u3002",{state:"error"}),!1;a.index=b;MetroScreen.addApp(a,c);epoint.showTips("\u5e94\u7528\u3010"+a.name+"\u3011\u5b89\u88c5\u6210\u529f\uff01",{state:"success"});AppMgr.sendAppUpdate(a,"install-app")}else console.error("\u5e94\u7528\u6570\u636e\u4e0d\u5b8c\u6574\u65e0\u6cd5\u5b89\u88c5",a)},moveToScreen:function(a,c){var b=AppMgr.getAppData(a);if(b){var d=MetroScreen.getInsertIndex(b,c);-1==d?mini.showMessageBox({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u5f88\u62b1\u6b49\uff0c\u7b2c"+(c+1)+"\u5206\u5c4f\u6ca1\u6709\u8db3\u591f\u7684\u7a7a\u95f4\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u5176\u4ed6\u5206\u5c4f\u6216\u8005\u8c03\u6574\u5e94\u7528\u5e03\u5c40\u540e\u518d\u79fb\u52a8\u3002",buttons:["ok"],iconCls:"mini-messagebox-warn"}):(b.index=d,MetroScreen.removeApp(a),MetroScreen.addApp(b,c),MetroScreen.setPageActive(c),AppMgr.sendAppUpdate(a,"screen-to-screen"))}},uninstallApp:function(a){TabsNav.removeTab(a);MetroScreen.removeApp(a);AppMgr.sendAppUpdate(a,"uninstall-app");AppMgr.delAppData(a)},sendAppUpdate:function(c,b){var d=a.isPlainObject(c)?c:AppMgr.getAppData(c),d=a.extend({},d,{query:b});Util.ajax({type:"POST",url:MetroDataActionUrl.updateAppUrl,dataType:"json",data:d,success:Util.noop,error:Util._ajaxErr})}};d.on("click",".metro-app",function(c){c=a(this).data("id");AppMgr.openApp(c)});if(appContextmenu)d.on("contextmenu",".metro-app",function(c){var b=a(this).data("id"),d=AppMgr.getAppData(b);if(d)return F.setOptions("id",b).show({x:c.pageX,y:c.pageY}),Util.configAppCmOpers(F,d),!1});(function(){Util.ajax({type:"POST",dataType:"json",url:e.MetroDataActionUrl.screenInfoUrl,data:{query:"screen-apps"},success:function(a){if(a&&a.length){L(a);for(var c=a.length,b,d=[],k=0;k<c;k++)b=a[k].leftNav,K.push(b),d.push(Mustache.render(METRO_SCREEN_NAV_TPL,{page:k,name:b.name,icon:b.icon,screenIndex:b.screenIndex}));a=20*c;r.css({marginLeft:-a/2,width:a}).html(d.join(""));D=c;appContextmenu&&(F=M());AppDragMgr.enableAllApps();I();MetroScreen.setPageActive(y)}_MetroEvent_.fire("afterAllAppsLoad")},error:Util._ajaxErr})})()})(this,jQuery);(function(e,a){var h=a("#metro-screens"),f={containment:"body",scroll:!1,opacity:.5,distance:10,iframeFix:!0,start:function(d,b){a(this).addClass("app-drag-zindex")},stop:function(d,b){var f=a(this),e=f.data("id"),h=AppMgr.getAppData(e);if(h){var l=h.index,u=MetroScreen.getAppIndexByPos(b.position),n=[],c=[],k=[],p=[],q=[],m=[],n=!1,w=MetroScreen.getActivePage();h.index=u;-1==u?n=!1:MetroScreen.isOneBlock(h)?(n=MetroScreen.getAppOccupiedGrids(h),c=MetroScreen.getAppOccupiedGrids(a.extend({},h,{index:l})),q=MetroScreen.getEmptyGrids(w),a.each(n,function(a,c){var b=MetroScreen.getAppByIndex(w,c);b&&b.data("id")!=e&&k.push(b.addClass("ignored"))}),k.length&&a.each(k,function(a,c){var b=c.data("id");p=p.concat(MetroScreen.getAppOccupiedGrids(b))}),a.each(n,function(b,d){-1==a.inArray(d,q)&&-1==a.inArray(d,c)||m.push(d)}),m=Util.sortArr(m.concat(p)),n=m[0]==n[0]&&m[m.length]==n[n.length]&&m.length==n.length):n=!1;n||(u=l);MetroScreen.adjustAppPosByIndex(f,u);k.length&&(n?a.each(k,function(a,c){var b=c.data("id");if(b=AppMgr.getAppData(b))b=MetroScreen.getInsertIndex(b,w),MetroScreen.adjustAppPosByIndex(c.removeClass("ignored"),b)}):a.each(k,function(a,c){c.removeClass("ignored")}));f.removeClass("app-drag-zindex")}}};e.AppDragMgr={enableAllApps:function(){h.find(".metro-app").draggable(f)},enableApp:function(a){a.draggable(f)},destroy:function(a){a.draggable("destroy")}}})(this,jQuery);(function(e,a){function h(){r().always(function(){setTimeout(h,3E4)})}var f=a("body"),d={},b=function(){var b=a.Deferred();b.resolve();return b.promise()}(),r=function(){var e=a.unique(AppMgr.msgRemindApps);return e?Util.ajax({url:MetroDataActionUrl.updateAppMsgCountUrl,data:{appIds:e}}).done(function(b){b&&a.each(b,function(a,b){b=parseInt(b,10)||0;b=99<b?"99+":b;var e=d[a]?d[a]:d[a]=f.find('[data-id\x3d"'+a+'"]').find(".unread");b?e.text(b).removeClass("hidden"):e.addClass("hidden")})}):b};_MetroEvent_.on("afterAllAppsLoad",h)})(this,jQuery);(function(e,a){var h=a("#metro-task-bar"),f=a(".tasks-wrap",h),d=a(".task-list",h),b=h.find(".scroll-wrap"),r=a.trim(METRO_TASK_TPL),t=function(){var c=a("body").width()-100-0;f.css("width",c);114*d.find(".task-item").length>c?b.removeClass("hidden"):(b.addClass("hidden"),d.css("margin-left",0))},v=new EpContextMenu({items:[{text:"\u663e\u793a\u684c\u9762",click:function(a){TabsNav.minAllTabs()}},"sep",{text:"\u5173\u95ed\u6b64\u4efb\u52a1",click:function(a){TabsNav.removeTab(a.id)}},{text:"\u53ea\u663e\u793a\u6b64\u4efb\u52a1\u7a97\u53e3",click:function(a){TabsNav.minAllTabs(a.id)}},"sep",{text:"\u5173\u95ed\u5176\u4ed6\u4efb\u52a1",click:function(a){TabsNav.removeOthers(a.id)}},{text:"\u5173\u95ed\u6240\u6709\u4efb\u52a1",click:function(){TabsNav.removeAll()}},"sep",{text:"\u53d6\u6d88",role:"cancel"}]}),l={},u=a(e).width()-66,n=a(e).height()-50-40;e.TabsNav={openTask:function(a){var b=AppMgr.getAppData(a),c=null;b&&(l[a]?(c=l[a],c.show(0,0)):(c=(new EpDialog({id:a+"-epdialog",title:b.name,url:b.url,draggable:!0,resizable:!0,width:(b.widthRatio||METRO_SETTINGS.dialogSizeRadio[0])*u,height:(b.heightRatio||METRO_SETTINGS.dialogSizeRadio[1])*n,btns:[{role:"min",title:"\u6700\u5c0f\u5316",click:function(){this.hide()}},{role:"maxwin",title:"\u6700\u5927\u5316"},{role:"refresh",title:"\u5237\u65b0"},{role:"close",title:"\u5173\u95ed",click:function(a){TabsNav.removeTab(a.id);return!1}}]})).setOptions("id",a),b.isFullView?c.show(0,0).maxWin():c.show(0,1),l[a]=c))},minAllTabs:function(a){var b,c;for(b in l)l.hasOwnProperty(b)&&(c=l[b],b!=a?c.hide():(c.show(0,0),TabsNav.activeTask(b)))},addOrActiveTask:function(b){var c=l[b],e=AppMgr.getAppData(b);e&&(c||(a(Mustache.render(r,{id:e.id,name:e.name})).appendTo(d),t()),TabsNav.openTask(b),TabsNav.activeTask(b))},makeTaskVisiable:function(a){a=114*TabsNav.getTask(a).prevAll().length;var b=Math.abs(Util.toInt(d.css("margin-left"))),c=f.width(),e=0;a<b?e=a:a+114-c>b&&(e=a+114-c);e&&d.stop(!0).animate({marginLeft:-e},300)},getTask:function(a){return d.find('[data-id\x3d"'+a+'"]')},removeTab:function(a){var b=TabsNav.getTask(a);b.length&&(b.remove(),l[a].hide().destroy(),l[a]=null,delete l[a],t())},removeOthers:function(b){var c=d.find(".task-item");c.length&&(c.each(function(c,d){var e=a(d),k=e.data("id");b!=k&&(e.remove(),l[k].hide().destroy(),l[k]=null,delete l[k])}),t())},removeAll:function(){var b=d.find(".task-item");b.length&&(b.each(function(b,c){var d=a(c),e=d.data("id");d.remove();l[e].hide().destroy();l[e]=null;delete l[e]}),t())},activeTask:function(a){var b=TabsNav.getTask(a);b.hasClass("active")||b.addClass("active").siblings().removeClass("active");TabsNav.makeTaskVisiable(a)}};a(e).on("resize",Util.debounce(function(){u=a(e).width()-66;n=a(e).height()-50-40;t();var b,d;for(b in l)l.hasOwnProperty(b)&&(d=l[b])&&!d.isHidden()&&d.isMax()&&d.maxWin()},50));h.on("click",".scroll-l",function(a){a=Math.abs(Util.toInt(d.css("margin-left")));var b=a-200;a&&(0>b&&(b=0),d.stop(!0).animate({marginLeft:-b},200))}).on("click",".scroll-r",function(a){a=Math.abs(Util.toInt(d.css("margin-left")));var b=114*d.find(".task-item").length,c=f.width(),e=b-c;dis=a+200;a!=b-c&&(dis>e&&(dis=e),d.stop(!0).animate({marginLeft:-dis},300))}).on("click",".task-item",function(b){b=a(this);var c=b.data("id"),c=l[c];b.hasClass("active")?c.toggle():(b.addClass("active").siblings().removeClass("active"),c.show(0,0))}).on("contextmenu",".task-item",function(b){var c=a(this).data("id");v.setOptions("id",c).show({x:b.pageX,y:b.pageY});return!1});a("body").on("click",".epdialog-hd",function(b){b.preventDefault();b.stopPropagation();/^epdialog-hd(?!-btn)/.test(b.target.className)&&(b=a(this).parent(".epdialog")[0].id.replace(/(.+)-epdialog$/,"$1"))&&TabsNav.addOrActiveTask(b)});t()})(this,jQuery);(function(e,a){a("#metro-top-bar .top-btns").on("click",".logout",function(a){a.preventDefault();mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(a){"ok"==a&&e.onLogout&&(eMsgSocket&&eMsgSocket.close(),e.onLogout())})})})(this,jQuery);(function(e,a){function h(a){var b,c=!1;a.remind?(b=parseInt(k.data("num"),10)||0,a.remind>b&&(c=!0),k.removeClass("hidden").text(v(a.remind)),k.data("num",a.remind)):k.text("").addClass("hidden");a.eXun?(b=parseInt(q.data("num"),10)||0,a.eXun>b&&(c=!0),q.removeClass("hidden").text(v(a.eXun)),q.data("num",a.eXun)):q.text("").addClass("hidden");c?(l(100),t.roll()):t.stop()}function f(a){a?(p.addClass("active"),m.removeClass("hidden"),m.stop(!0).animate({right:0})):function(){m.stop(!0).animate({right:-350},function(){m.addClass("hidden")});p.removeClass("active")}()}var d="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",b=0,r="",t={roll:function(){r=e.systemTitle||document.title;document.title=d;clearTimeout(b);b=setTimeout(function C(){document.title=d.substring(1,d.length)+d.substring(0,1);d=document.title;b=setTimeout(C,300)},300)},stop:function(){clearTimeout(b);document.title=r||document.title;d="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}},v=function(a){a=parseInt(a,10);return 99<a?"99+":0>=a?"":a+""},l=function(b,c,d){if(!1===Util.getFrameSysParam("messageSound"))return Util.noop;c=Util.getRightUrl(c);if(Util.browsers.isIE){var e=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden"\x3e\x3c/iframe\x3e').appendTo(b);return function(){e[0].src=c+"?_\x3d"+ +new Date}}var f=document.createElement("audio");f.src=Util.getRightUrl(d);f.className="hidden-accessible";b.append(f);var k=null;return function G(a){void 0===a&&(a=100);f.play()["catch"](function(){clearTimeout(k);0<a&&(k=setTimeout(function(){G(--a)},50))})}}(a("#msg-sound"),"../../msgsound/sound.html","../../msgsound/newsms.wav"),u=function(a){return Util.ajax({url:e.MetroDataActionUrl.msgCountUrl,dataType:"json",global:!1,data:{haseXun:!0,needNum:!0}}).done(h)},n=a("#top-btns"),c=a(".msg-remind",n),k=a(".unread",c),p=a(".chat",n),q=a(".unread",p),m=a("#msgEMsg"),w=a(".msg-panel-content",m),x=a(".emsg-recent-list",w),B=a(".online-user-num",m),n=document.getElementById("online-user"),z,A=function(){A=Util.noop;return Util.loadJs("frame/fui/js/widgets/emsglist/emsglist.js",function(){z=new EMsgList({content:x,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:function(){f(!1)},onDecEmsgCount:function(){var a=q.text();a&&(a=parseInt(a,10)-1);0==a&&(a="",q.data("num",0).addClass("hidden"));q.text(a)}});e.RefreshEMsg=a.proxy(z.getData,z);f(!0)})};p.on("click",function(){if(!z)return A();f(!p.hasClass("active"))});m.find(".msg-panel-hide").on("click",function(){f(!1)});a(document).on("click",function(b){a(b.target).closest(m.add(p)).length||f(!1)});e.OnlineUserSettings&&e.OnlineUserSettings.show&&(m.find(".msg-panel-head").addClass("tab").find(".panel-hd-tab.hidden").removeClass("hidden"),n.src=OnlineUserSettings.url,m.on("click",".panel-hd-tab",function(){var b=a(this),c=b.data("ref"),d=b.data("hasShow"),e=x;b.hasClass("active")||(b.addClass("active").siblings().removeClass("active"),c&&(e=a("#"+c,w),d||setTimeout(function(){OnlineUserSettings.onRefreshData(function(a){B.html(a)});b.data("hasShow",!0)},10)),e.removeClass("hidden").siblings().addClass("hidden"))}));_MetroEvent_.on("afterPageInfo",function(){u(!1);useWebsocket||setInterval(function(){u(!0)},6E4)})})(this,jQuery);(function(e,a){var h=a("#metro-top-bar .top-btns");a.each(e.defaultApps,function(a,d){d=Util.fixPath(d);AppMgr.cacheAppData(d.id,d)});h.on("click",".default-app-btn",function(e){e.preventDefault();e=a(this).data("id");AppMgr.openApp(e)})})(this,jQuery);var eMsgSocket;window.OpenEMsg=function(e,a,h){window.eMsg?"undefined"==typeof a?eMsg.open(e):eMsg.openSession(e,a,h):Util.loadPageModule({templ:"frame/fui/pages/emsg/emsg.tpl",js:"frame/fui/pages/emsg/emsg.js",css:"frame/fui/pages/emsg/emsg.css",callback:function(){eMsgSocket=new EMsgSocket(_userGuid_,_userName_);"undefined"==typeof a?eMsg.open(e):eMsg.openSession(e,a,h)}})};(function(e,a){function h(e,h){if(e){for(var c={closeIcon:!1,refresh:!0},k=[],p=0;p<e.length;p++){var l=e[p],m=!1;void 0!=l.items?!m&&a.each(l.items,function(a,b){if(h){if(b.code==h)return c.id=b.code||"home",c.url=b.url,c.name=b.name,m=!0,!1}else if("tabsnav"==b.openType)return c.id=b.code||"home",c.url=b.url,c.name=b.name,m=!0,!1}):(m||(h?l.code==h&&(c.id=l.code||"home",c.url=l.url,c.name=l.name,m=!0):"tabsnav"==l.openType&&(c.id=l.code||"home",c.url=l.url,c.name=l.name,m=!0)),k=k.concat(e.splice(p,1)),p--)}d(k,e);f(c)}else console.error("\u672a\u83b7\u53d6\u5230\u95e8\u6237\u6570\u636e"),b.addClass("hidden")}function f(d){function f(a){a?(v.addClass("active"),TabsNav.minAllTabs(),BoardCenter.hide()):v.removeClass("active")}function c(){var b=a(e).height()-140;0<b&&k.css("max-height",b)}b.on("click",function(){f(!v.hasClass("active"))});r.on("click",".portal-item",function(){var b=a(this),c=b.data("opentype"),b=Util.getRightUrl(b.data("url"));"blank"==c?e.open(b):BoardCenter.show(a(this).data("id"));f(!1)}).on("click",".portal-cate",function(){a(this).parent().toggleClass("collapse")});l.on("click",".board-close",function(){BoardCenter.hide()});a("body").on("click",function(b){a(b.target).closest(v).length||f(!1)});var k=v.find(".portal");c();a(e).on("resize",Util.debounce(c,17))}function d(b,d){var c=[];b&&(c.push('\x3cul class\x3d"portal-list"\x3e'),a.each(b,function(a,b){b.icon=b.icon||"default-modicon";c.push(Mustache.render('\x3cli class\x3d"portal-item" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"portal-icon {{icon}}"\x3e\x3c/span\x3e\x3cspan class\x3d"portal-name"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',b));BoardCenter.data[b.code]=b}),c.push("\x3c/ul\x3e"));a.each(d,function(b,d){c.push('\x3cdiv class\x3d"portal-block"\x3e\x3ch3 class\x3d"portal-cate"\x3e'+d.name+'\x3cspan class\x3d"portal-cate-trigger"\x3e\x3c/span\x3e\x3c/h3\x3e\x3cul class\x3d"portal-list" style\x3d"max-height:'+30*d.items.length+'px"\x3e');a.each(d.items,function(a,b){b.icon=b.icon||"default-modicon";c.push(Mustache.render('\x3cli class\x3d"portal-item" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"portal-icon {{icon}}"\x3e\x3c/span\x3e\x3cspan class\x3d"portal-name"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',b));BoardCenter.data[b.code]=b});c.push("\x3c/ul\x3e\x3c/div\x3e")});a(c.join("")).appendTo(t)}var b=a("#portal-btn"),r=a("#portal-wrap"),t=a("#portal-content"),v=b.add(r),l=a("#board-panel");e.BoardCenter={data:{},cache:{},show:function(b){b=this.cache[b]?this.cache[b]:this.cache[b]=a(Mustache.render(BOARD_CONTENT_TPL,BoardCenter.data[b])).appendTo(l);TabsNav.minAllTabs();l.removeClass("hidden");b.removeClass("hidden").siblings(".board-content").addClass("hidden")},hide:function(){l.addClass("hidden")}};_MetroEvent_.on("afterPageInfo",function(a){h(a.data.homes,a.data.defaultHome)})})(this,jQuery);(function(e,a){var h=a("#left-bar"),f=a("#common-apps"),d=a(".list-wrap",f),b=a(".common-cfg-btn",f),r=a("#portal-btn").outerHeight(!0)||50,t=0;Util.doNiceScroll(d,{cursorwidth:"2px",cursorcolor:"rgba(0,0,0,.3)",cursorborder:"1px solid rgba(0,0,0,.6)",horizrailenabled:!1});var v=function(){r=f.position().top;t=h.height()-(r+0);f.css("height",t);d.css("max-height",t-50)};a(e).on("resize",Util.debounce(v,50));e.QuickApps={isInit:!1,init:function(){QuickApps.isInit||(v(),QuickApps._init())},_init:function(){return this.getData().done(function(a){QuickApps._initView(a)._initEvent()})},update:function(){return this._init()},getData:function(){return Util.ajax({url:MetroDataActionUrl.commonAppsUrl})},_initView:function(c){if(!c||!c.length)return this;var e=[];a.each(c,function(a,b){b=Util.fixPath(b);b.sname=Util.getAppShortName(b.name);99<parseInt(b.count,10)&&(b.count="99");b.id||(b.id=b.code);AppMgr.getAppData(b.id)||AppMgr.cacheAppData(b.id,b);b.icon&&(b.icon=Util._genderIconHtml(b.icon,"common-app-icon"));e.push(Mustache.render(COMMON_APP_TPL,b))});a(e.join("")).appendTo(d.empty());b.removeClass("hidden");return this},_initEvent:function(){!this.isInit&&f.on("click",".common-app",function(){var b=a(this).data("id");AppMgr.openApp(b)});return this}};_MetroEvent_.on("afterAllAppsLoad",QuickApps.init);var l=MetroDataActionUrl.commonAppCfgUrl,u=function(){var a=location.href.match(/^https?:\/\/.*\/fui\/pages\/themes\/(\w+)\/\1/i);return a&&a[1]}(),n=Util.getUrlParams("pageId")||u,l=Util.addUrlParams(l,{themeId:u,pageId:n}),c=!1;b.on("click",function(){if(!c){c=!0;var a={width:920,height:500},b=Util.getWinSize();a.height=b.height<a.height?b.height:.6*b.height>>0;b.width<a.width&&(a.width=b.width);epoint.openDialog("\u5e38\u7528\u5e94\u7528\u914d\u7f6e",l,function(a){!0===a&&QuickApps.update();c=!1},a)}})})(this,jQuery);(function(e,a){var h=null,f=function(){f=Util.noop;return Util.loadJs("frame/fui/js/widgets/appcenter/appcenter.js",function(){h=new AppCenterDialog({getDataUrl:MetroDataActionUrl.appCenterDataUrl,on:{show:function(){d.addClass("active")},hide:function(){d.removeClass("active")},installApp:function(a){var b=a.data;console.log(b);AppMgr.installApp(b,function(){h._afterInstallApp(b.id)})},uninstallApp:function(a){var b=a.data;AppMgr.uninstallApp(b.id,function(){this._afterUninstallApp(b.id)})}}});h.show()})},d=a("#top-btns .appstore");d.on("click",function(){h?h.show():f()})})(this,jQuery);(function(e,a){function h(){return Util.ajax({url:e._searchCfg.fullSearchCateUrl}).done(function(a){f(a.categories)})}function f(b){b=b||[];"string"==typeof b&&(b=JSON.parse(b));var f=[];a.each(b,function(a,b){f.push({id:b.guid,name:b.name,iconCls:b.icon||"view"})});f.length||f.push({id:"all",name:"\u5168\u6587\u68c0\u7d22",iconCls:"modicon-25"});ClassifySearch._styleLoaded=!0;ClassifySearch.CLASSIFICATION_TPL='\x3cdiv class\x3d"classify-search-classify-item {{#isActive}}active{{/isActive}}" data-id\x3d"{{id}}" data-title-tpl\x3d"\u4e0e${keyword}\u76f8\u5173\u7684{{name}}"\x3e\x3cspan class\x3d"classify-search-classify-icon {{iconCls}}"\x3e\x3c/span\x3e\u4e0e\x3cspan class\x3d"classify-search-classify-kw"\x3e\x3c/span\x3e\u76f8\u5173\u7684{{name}}\x3cspan class\x3d"classify-search-classify-target hidden"\x3e{{target}}\x3c/span\x3e\x3c/div\x3e';b=new ClassifySearch({id:"header-search-container",searchTarget:"\u5185\u5bb9",category:f,placeholder:"\u8bf7\u8f93\u5165",maxShowCharacter:3,enter:function(a,b){var d;d=a||"all";e.open(e._fullSearchUrl_+"?wd\x3d"+e.encodeURI(b)+"\x26type\x3d"+d,"fullsearch")}});d(b);b.$input.on("focus",function(){TabsNav.minAllTabs()})}function d(b){function d(){var c=a.trim(b.$input.val());k&&k.abort();c&&(k=Util.ajax({url:epoint.dealRestfulUrl(_searchCfg.userModuleSearchUrl),data:{cnum:"user,app",key:c,rn:3,location:"search"}}),k.done(function(b){b=mini.decode(b.frameinfo);var d=[],e=[],f=new RegExp(c,"ig");b.users&&a.each(b.users,function(a,b){b.portrait=Util.getRightUrl(b.portrait);b.hlname=b.name.replace(f,'\x3cspan class\x3d"fulltext-search-kw"\x3e'+c+"\x3c/span\x3e");d.push(Mustache.render(p,b))});b.apps&&a.each(b.apps,function(a,b){b.icon=Util.getRightUrl(b.icon);b.hlname=b.name.replace(f,'\x3cspan class\x3d"fulltext-search-kw" \x3e'+c+"\x3c/span\x3e");e.push(Mustache.render(q,b))});a(d.join("")).appendTo(h.empty());a(e.join("")).appendTo(u.empty())}))}var e=b.$classifyList.find('[data-id\x3d"user"]'),f=b.$classifyList.find('[data-id\x3d"app"]');if(e.length&&f.length){var h=a('\x3cul class\x3d"fulltext-search-user-list"\x3e\x3c/ul\x3e'),u=a('\x3cul class\x3d"fulltext-search-app-list"\x3e\x3c/ul\x3e');e.length&&(h.insertAfter(e),h.on("click",".fulltext-search-user-item",function(){_searchCfg.userClick&&_searchCfg.userClick(this.getAttribute("data-id"),this.title);b.$input.blur().val("");b.hidePopup()}));f.length&&(u.insertAfter(f),u.on("click",".fulltext-search-app-item",function(){var c=a(this);c.data("url")&&dealLinkOpen({id:c.data("id"),name:this.title,url:c.data("url"),openType:c.data("opentype")});b.$input.blur().val("");b.hidePopup()}));var n,c=[13,16,17,18,27,37,38,39,40];if("oninput"in document.createElement("input"))b.$input.on("input",function(){clearTimeout(n);n=setTimeout(d,50)});else b.$input.on("keyup",function(b){-1==a.inArray(b.which,c)&&(clearTimeout(n),n=setTimeout(d,50))});b.$input.on("setHistoryValue",d);var k,p='\x3cli class\x3d"fulltext-search-user-item" data-id\x3d"{{guid}}" title\x3d"{{name}}" \x3e\x3cimg class\x3d"fulltext-search-user-item-img" src\x3d"{{portrait}}" \x3e{{{hlname}}}\x3c/li\x3e',q='\x3cli class\x3d"fulltext-search-app-item" data-id\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}" data-url\x3d"{{url}}"\x3e\x3cimg class\x3d"fulltext-search-app-item-icon" src\x3d"{{icon}}"/\x3e{{{hlname}}}\x3c/li\x3e'}}a("#header-search-container");_MetroEvent_.on("afterPageInfo",function(){e._fullSearchUrl_&&h()})})(this,jQuery);(function(e,a){function h(e){var d=a.extend({},MsgCenterConfig,{isMsgCenterMaxSize:e.isMsgCenterMaxSize||!1,msgCenterOrder:e.msgCenterOrder||"asc",hideCallback:function(){}}),b=null,f=function(){f=Util.noop;return Util.loadJs("frame/fui/js/widgets/msgcenter/msgcenter.js",function(){b=new MsgCenter(d);b.show()})};a("#top-btns .msg-remind").on("click",function(){if(!b)return f();b.isShow?b.hide():b.show()})}_MetroEvent_.on("afterUserInfo",function(a){h(a.data)})})(this,jQuery);(function(e,a){var h=a("#theme-switch"),f,d=function(){d=Util.noop;return Util.loadJs("frame/fui/js/widgets/themeselection/themeselection.js",function(){ThemeSelection._styleLoaded=!0;f=new ThemeSelection({getPagesUrl:MetroDataActionUrl.getPagesUrl,savePageUrl:MetroDataActionUrl.savePageUrl,hideCallback:function(){h.removeClass("active")}});e.themeSelection=f;f.show();h.addClass("active");a("body").on("click",function(b){a(b.target).closest(".theme-selection-container, #theme-switch").length||(h.removeClass("active"),f.hide())})})};(function(){h.on("click",function(){if(!f)return d();h.hasClass("active")?(h.removeClass("active"),f.hide()):(f.show(),h.addClass("active"))})})()})(this,jQuery);