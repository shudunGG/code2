// jshint -W030

// 一级菜单
var FIRST_MENU_TPL='\x3cul class\x3d"first-menu l clearfix" id\x3d"firstmenu"\x3e{{#items}}\x3cli class\x3d"item-first l {{#selected}}select{{/selected}}" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-openType\x3d"{{openType}}" data-hassub\x3d"{{hasSub}}"\x3e{{name}}\x3c/li\x3e{{/items}}\x3c/ul\x3e \x3ca href\x3d"javascript:void(0)" class\x3d"menu-down {{#hideTrigger}}hidden{{/hideTrigger}} l"\x3e\x3c/a\x3e',QUICK_MENU_TPL='\x3cli class\x3d"quick-menu-item" data-code\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}"\x3e{{name}}\x3c/li\x3e',LEFT_MENU_TPL='\x3cli class\x3d"left-menu-item {{#isTop}}top-item{{/isTop}} {{#hasSub}}sub-item{{/hasSub}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}"  title\x3d"{{name}}" data-openType\x3d"{{openType}}" class\x3d"item-link" style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}} {{^isTop}}\x3ci class\x3d"left-menu-dot"\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"item-link-text"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}\x3cdiv class\x3d"slide-second-menu"\x3e\x3cspan class\x3d"slide-second-span"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"left-menu-sub"\x3e {{{subMenu}}}\x3c/ul\x3e{{/hasSub}} \x3c/li\x3e',SEARCH_MENU_TPL='\x3cli class\x3d"menu-search-item" data-code\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}"\x3e{{{name}}}\x3c/li\x3e',BOTTOM_TAB_ITEM='\x3cli class\x3d"tabs-nav-item" id\x3d"tab-{{id}}" data-id\x3d"tab-{{uid}}" data-target\x3d"tab-content-{{id}}"\x3e\x3cspan class\x3d"tabs-nav-name" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e {{#refresh}}\x3cspan class\x3d"tabs-nav-item-refresh"\x3e\x3c/span\x3e{{/refresh}} {{#closeIcon}}\x3ci class\x3d"tabs-nav-item-close"\x3e\x3c/i\x3e{{/closeIcon}}\x3c/li\x3e',TAB_NAV_CONTENT_TPL='\x3ciframe class\x3d"tab-content hidden" id\x3d"tab-content-{{id}}" src\x3d"{{url}}" height\x3d"100%" width\x3d"100%" frameborder\x3d"0" scrolling\x3d"no"\x3e\x3c/iframe\x3e',TAB_SLIDE_TPL='\x3cli class\x3d"slide-list-item" id\x3d"tab-{{id}}" data-id\x3d"tab-{{uid}}"\x3e{{name}}\x3c/li\x3e',CONTEXT_MENU_TPL='\x3cdiv class\x3d"context-menu hidden" id\x3d"{{id}}"\x3e\x3cul\x3e{{#items}}{{#text}}\x3cli\x3e\x3ca class\x3d"menu-item" role\x3d"{{role}}" href\x3d"javascript:void(0);"\x3e\x3cspan class\x3d"item-txt"\x3e{{text}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e{{/text}}{{^text}}\x3cli class\x3d"sep"\x3e\x3c/li\x3e{{/text}}{{/items}}\x3c/ul\x3e\x3c/div\x3e',SKIN_TPL='\x3cdiv class\x3d"skin-choose  {{#selected}}{{selected}}{{/selected}}" data-name\x3d"{{name}}" style\x3d"background-color:{{color}}" title\x3d"{{name}}"\x3e\x3ci class\x3d"choose-skin"\x3e\x3c/i\x3e\x3c/div\x3e',$topMenu=$("#top-menu"),$quickMenu=$("#quick-menu"),$leftContainer=$("#left-menu"),$pageCover=$("#page-cover"),$msgPanel=$("#msg-panel"),$dropBox=$("#bottom-drop"),$dropPanel=$("#bottom-slide-box"),$userInfo=$("#top-user"),$bgImg=$("#bg-img"),_graceEvent_=new Util.UserEvent,_getData_=function(c,a){return Util.ajax({url:epoint.dealRestfulUrl(getDataUrl+"/"+c),data:$.extend({pageId:Util.getUrlParams("pageId")||"grace"},a)})},_getNiceSroll_xhr,_getNiceSroll_cbs=[],_getNiceSroll_=function(c){$.fn.niceScroll?c():(_getNiceSroll_xhr||(_getNiceSroll_xhr=$.ajax({url:"../../../js/widgets/jquery.nicescroll.min.js",dataType:"script"}).done(function(){for(var a=0,c=_getNiceSroll_cbs.length;a<c;a++)_getNiceSroll_cbs[a]();_getNiceSroll_cbs=[]})),_getNiceSroll_cbs.push(c))},loadBgImg=function(){var c="./skins/"+(mini.Cookie.get("_grace_skin_")||"default")+"/images/bg.png",a=new Image;a.src=c;a.onload=function(){$bgImg[0].src=c}};$(loadBgImg);(function(c,a){var d=a("#logo-img"),k=a("#head-img"),g=a("#drop-head-img"),b=function(){$userInfo.removeClass("showPanel");$pageCover.addClass("hidden")};$userInfo.on("click",".head-img",function(){$userInfo.hasClass("showPanel")?b():($userInfo.addClass("showPanel"),$pageCover.removeClass("hidden"))}).on("click",".setting-item",function(){var l=a(this).data("target");TabsNav.addTab(h[l]);b()}).on("click",".loginout",function(){mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(a){"ok"==a&&(eMsgSocket&&eMsgSocket.close(),UserSettins.logout())});b()}).on("click",".role-change",function(){b();UserSettins.changeRole(_userGuid_)});var h={personal:{name:"\u4e2a\u4eba\u8d44\u6599",url:UserSettins.datum,id:"personal-datum"},page:{name:"\u754c\u9762\u914d\u7f6e",url:UserSettins.interfaceUrl,id:"personal-interface"},"function":{name:"\u529f\u80fd\u914d\u7f6e",url:UserSettins.functionUrl,id:"personal-function"}},e=function(a,b){var l=new Image;l.onload=function(){b.src=a};l.onerror=function(){console.error(a+"\u5bf9\u5e94\u7684\u56fe\u7247\u8d44\u6e90\u65e0\u6cd5\u52a0\u8f7d\uff01")};l.src=a};_getData_("getUserInfo").done(function(b){c._userName_=b.name;c._userGuid_=b.guid;b.portrait&&(url=Util.getRightUrl(epoint.dealRestfulUrl(b.portrait)),k.attr("src",url),g.attr("src",url));b.hasParttime&&$userInfo.find(".cancel-out").addClass("hasRoles");var h=a(".user-txt");h.find(".username").text(b.name);h.find(".departname").text(b.ouName)});_getData_("getPageInfo").done(function(b){var h=a("#top-full-search");b.title&&(document.title=b.title,c.systemTitle=b.title);e(Util.getRightUrl(b.logo||c.DEFAULT_LOGO_URL),d[0]);var l=[],m=!1;b.defaultUrl&&(l.push({id:"home-default",name:"\u6211\u7684\u684c\u9762",url:b.defaultUrl,active:!0}),m=!0);a.each(b.homes,function(a,h){l.push(h);m||b.defaultHome!=h.id||(m=!0,h.active=!0)});!m&&b.defaultHome&&epoint.alert("\u95e8\u6237\u5730\u5740\u914d\u7f6e\u4e0d\u6b63\u786e",null,null,"error");!m&&b.homes&&b.homes.length&&(b.homes[0].active=!0);a.each(l,function(a,b){TabsNav.addTab({id:b.id||"home-"+a,url:b.url,name:b.name,closeIcon:!1,refresh:!0},!b.active)});b.fullSearchUrl?h[0].action=Util.getRightUrl(b.fullSearchUrl):h.addClass("hidden");_graceEvent_.fire("afterPageInfo")})})(this,jQuery);(function(c,a){$topMenu.on("click",".item-first",function(){var b=a(this),h=b.data("id"),e=b.data("url"),l=b.data("hassub"),f=b.text(),d=b.data("opentype");b.addClass("select").siblings().removeClass("select");e&&("tabsnav"===d?TabsNav.addTab({id:h,name:f,url:e}):(c.open(Util.getRightUrl(e),h),b.removeClass("select")));l?c.getLeftMenu(h,f):c.hideLeftMenu();$topMenu.hasClass("showPanel")&&($topMenu.removeClass("showPanel"),$pageCover.addClass("hidden"))}).on("click",".menu-down",function(){$topMenu.hasClass("showPanel")?($topMenu.removeClass("showPanel"),$pageCover.addClass("hidden")):($topMenu.addClass("showPanel"),$pageCover.removeClass("hidden"))});var d,k;a(c).on("resize.topMunu",function(){clearTimeout(k);k=setTimeout(function(){var a=$topMenu.find(".item-first").length,h=$topMenu.find("#firstmenu").width();95*a>h?d.removeClass("hidden"):d.addClass("hidden")},200)});var g=function(){a(c).off("resize.topMunu");var b=a(c).width();1800<=b?$topMenu.css({width:"994px","margin-left":"-497px"}).find("#firstmenu").css({width:"950px"}):1500<=b&&$topMenu.css({width:"804px","margin-left":"--402px"}).find("#firstmenu").css({width:"760px"})};_getData_("getMenu",{query:"top"}).done(function(b){if(b&&b.items){var h=b.code,e="",l;if(h)for(var f=0,q=b.items.length;f<q;f++){var m=b.items[f];if(m.code==h){m.selected=!0;e=m.name;l=m.hasSub;break}}else b.items[0].selected=!0,h=b.items[0].code,e=b.items[0].name,l=b.items[0].hasSub;f=b.items.length;q=a(c).width();(Util.browsers.isIE8||Util.browsers.isIE67)&&setTimeout(g,20);f<=(1800<=q?10:1500<=q?8:5)&&(b.hideTrigger=!0);b=Mustache.render(FIRST_MENU_TPL,b);$topMenu.html(b);d=$topMenu.find(".menu-down");l&&c.getLeftMenu(h,e)}})})(this,jQuery);(function(c,a){var d=a(".quick-menu-panel",$quickMenu),k=a(".quick-menu-list",$quickMenu);$quickMenu.on("click",".quick-menu-title",function(){$quickMenu.hasClass("open")?($quickMenu.removeClass("open"),$pageCover.addClass("hidden")):($quickMenu.addClass("open"),$pageCover.removeClass("hidden"))}).on("click",".quick-menu-item",function(){var b=a(this),e=b.data("url"),l=b.data("code"),f=b.text(),b=b.data("opentype");e&&("tabsnav"===b?TabsNav.addTab({url:e,name:f,id:l}):c.open(Util.getRightUrl(e),guid));g()}).on("click",".quick-menu-btn",function(){a(this).hasClass("edit")?(TabsNav.addTab({id:"editNav",name:"\u5feb\u6377\u83dc\u5355",url:QuickNav.editUrl}),g()):b()});var g=function(){$quickMenu.removeClass("open");$pageCover.addClass("hidden")},b=function(){_getData_("getQuickMenu").done(function(a){if(a&&a.length){for(var b=[],h=0,c=a.length;h<c;h++)b.push(Mustache.render(QUICK_MENU_TPL,a[h]));d.removeClass("empty");k.html(b.join(""))}else d.addClass("empty"),k.empty()})};b();_getNiceSroll_(function(){k.niceScroll({cursorcolor:"#2590cc",cursorborder:"1px solid #d5dee6",cursorwidth:"3px"})})})(this,jQuery);(function(c,a){c.leftMenuStatus={};var d=$leftContainer.find(".left-menu-wrap"),k=$leftContainer.find(".name-txt"),g={};c._leftIsWide=!1;$leftContainer.on("click",".icon-triggle",function(){$leftContainer.hasClass("wide")?($leftContainer.find(".top-item").removeClass("open"),$leftContainer.removeClass("wide"),a.cookie("_leftStatus_","narrow",{expires:30}),$pageCover.addClass("hidden"),_leftIsWide=!1):($leftContainer.addClass("wide"),a.cookie("_leftStatus_","wide",{expires:30}),_leftIsWide=!0);setTimeout(function(){d.getNiceScroll(0).resize()},800);TabsNav.adjustSize()});a(function(){"wide"==(a.cookie("_leftStatus_")||"wide")?($leftContainer.addClass("wide"),_leftIsWide=!0):($leftContainer.removeClass("wide"),_leftIsWide=!1)});$leftContainer.on("click",".item-link",function(){var b=a(this),e=b.parent(".left-menu-item"),d=!!b.siblings(".left-menu-sub").length,f=b.data("url");if(d)e.hasClass("open")?e.removeClass("open"):e.removeClass("active").addClass("open").siblings().removeClass("active").removeClass("open"),!_leftIsWide&&e.hasClass("top-item")&&(e.hasClass("open")||e.siblings().hasClass("open")?$pageCover.removeClass("hidden"):$pageCover.addClass("hidden"));else if(f){var d=b.data("opentype"),g=b.attr("title");"blank"==d?c.open(Util.getRightUrl(f),g):TabsNav.addTab({id:b.data("id"),name:g,url:f});_leftIsWide||e.hasClass("top-item")||(e.closest(".top-item").removeClass("open").addClass("active"),$pageCover.addClass("hidden"))}});var b=function(c,d){var h=[];a.each(c,function(c,e){var f={name:e.name,code:e.code,url:e.url,icon:e.icon||"modicon-1",openType:e.openType,hasSub:!(!e.items||!e.items.length)};f.rowkey=void 0===d?c+"":d+"-"+c;if(1===f.rowkey.split("-").length)f.isTop=!0,f.indent=13;else{f.isTop=!1;var g=f.rowkey.split("-").length;f.indent=35+10*(g-1)}f.hasSub?h.push(Mustache.render(LEFT_MENU_TPL,a.extend(f,{subMenu:b(e.items,f.rowkey)}))):h.push(Mustache.render(LEFT_MENU_TPL,f))});return h.join("")};c.getLeftMenu=function(c,e){$leftContainer.removeClass("noleft");k.text(e);g[c]?$leftContainer.find("#left-menu-"+c).removeClass("hidden").siblings(".left-menu-list").addClass("hidden"):(g[c]="waiting",_getData_("getMenu",{query:"sub",code:c}).done(function(e){g[c]=!0;e&&e.length&&(e=b(e),a('\x3cul id\x3d"left-menu-'+c+'" class\x3d"left-menu-list"\x3e\x3c/ul\x3e').append(Util.clearHtml(e)).appendTo(d).siblings(".left-menu-list").addClass("hidden"))}).fail(function(){g[c]=!1}))};c.hideLeftMenu=function(){$leftContainer.addClass("noleft")};_getNiceSroll_(function(){d.niceScroll({cursorcolor:"#2590cc",cursorborder:"1px solid #d5dee6",cursorwidth:"3px"})})})(this,jQuery);(function(c,a){function d(){y=new MessageList({container:w,getUrl:epoint.dealRestfulUrl(getDataUrl+"/getMsgData"),ignoreUrl:epoint.dealRestfulUrl(getDataUrl+"/ignoreRemind"),afterOpenMsg:function(){hidePanel();$pageCover.addClass("hidden")},afterIgnore:function(){u()}})}function k(){x=new EMsgList({content:t,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:function(){hidePanel();$pageCover.addClass("hidden")},onDecEmsgCount:z});c.RefreshEMsg=a.proxy(x.getData,x)}var g="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",b=0,h="";c.docTitle={roll:function(){h=c.systemTitle||document.title;document.title=g;clearTimeout(b);b=setTimeout(function v(){document.title=g.substring(1,g.length)+g.substring(0,1);g=document.title;b=setTimeout(v,300)},300)},stop:function(){clearTimeout(b);document.title=h||document.title;g="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}};var e=a("#msg-sound"),l,f;Util.browsers.isIE?l=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden" id\x3d"msgcenter-sound"\x3e\x3c/iframe\x3e').appendTo(e):(e.html('\x3caudio id\x3d"msgcenter-sound-audio" controls\x3d"controls" src\x3d"../../msgsound/newsms.wav" class\x3d"hidden-accessible"\x3e\x3c/audio\x3e'),f=document.getElementById("msgcenter-sound-audio"));var q=function(a){a=parseInt(a);return 99<a?"99+":0>=a?"":a+""},e=a("#top-right-content"),m=a(".top-right",e),p=a(".remind-num",m),r=a(".remind-msg-num",m),e=a("#msgRemind",$msgPanel),w=a(".msg-panel-content",e),e=a("#msgEMsg",$msgPanel),A=a(".msg-panel-content",e),t=a(".emsg-recent-list",A),u=function(){var a=0,b=!1;return _getData_("getMsgCount",{haseXun:!0,needNum:!0}).done(function(n){n.remind?(a=parseInt(p.data("num"))||0,n.remind>a&&(b=!0),p.removeClass("hidden").text(q(n.remind)),p.data("num",n.remind)):p.text("").addClass("hidden");n.eXun?(a=parseInt(r.data("num"))||0,n.eXun>a&&(b=!0),r.removeClass("hidden").text(q(n.eXun)),r.data("num",n.eXun)):r.text("").addClass("hidden");b?(Util.browsers.isIE?l[0].src=Util.getRightUrl("../../msgsound/sound.html?_\x3d"+ +new Date):f&&f.play(),docTitle.roll()):docTitle.stop()})};_graceEvent_.on("afterPageInfo",function(){u();setInterval(u,6E4)});var y;c.MessageList?d():Util.loadJs("frame/fui/js/widgets/messagelist/messagelist.js",function(){d()});var z=function(){var a=r.text();a&&(a=parseInt(a)-1);0==a&&(a="",r.data("num",0).addClass("hidden"));r.text(a)},x;c.EMsgList?k():Util.loadJs("frame/fui/js/widgets/emsglist/emsglist.js",function(){k()});c.hidePanel=function(){$msgPanel.stop(!0).animate({right:-350},function(){$msgPanel.addClass("hidden")});m.find(".active").removeClass("active").hasClass("menu-search")&&resetSearchPanel()};m.on("click",".js-panel",function(){var b=a(this),e=b.data("ref"),f=a("#"+e,$msgPanel);b.hasClass("active")?(hidePanel(),$pageCover.addClass("hidden")):(b.addClass("active").siblings(".active").removeClass("active"),"msgRemind"==e?y.getData():"msgEMsg"==e?x.getData():"msgSkin"==e&&c.initSkinView&&c.initSkinView(),f.removeClass("hidden").siblings(".js-detail").addClass("hidden"),f.find(".msg-panel-content").removeClass("hidden"),$msgPanel.removeClass("hidden"),$msgPanel.stop(!0).animate({right:0}),$pageCover.removeClass("hidden"))});$msgPanel.on("click",".msg-panel-hide",function(a){hidePanel();$pageCover.addClass("hidden")});_getNiceSroll_(function(){a([w,A,a("#menuSearch").find(".menu-search-list")]).each(function(a,b){b.niceScroll({cursorcolor:"#ccc"})})})})(this,jQuery);(function(c,a){var d=a("#menuSearch"),k=a(".msg-srh-input",d),g=a(".menu-search-history",d),b=a(".menu-search-result",d),h=a(".menu-search-list",g),e=a(".menu-search-list",b),l=a.trim(SEARCH_MENU_TPL),f=[],q=function(a,b,c){var e=[],f=0,d=a.length,h,g;c&&(g=new RegExp(c,"g"));if(d){for(;f<d;f++)c&&(h=a[f].name,h=h.replace(g,'\x3cspan class\x3d"keyword"\x3e'+c+"\x3c/span\x3e"),a[f].name=h),e.push(Mustache.render(l,a[f]));b.removeClass("empty").html(e.join(""))}else b.addClass("empty").empty()},m;d.on("click",".menu-search-item",function(){var b=a(this),e=b.data("url"),d=b.data("code"),g=b.text(),b=b.data("opentype");if(e){"tabsnav"===b?TabsNav.addTab({url:e,name:g,id:d}):c.open(Util.getRightUrl(e),guid);hidePanel();d={url:e,name:g,code:d,openType:b};e=f.unshift(d);d=d.code;for(g=1;g<e;g++)if(f[g].code===d){f.splice(g,1);break}15<f.length&&(f.length=15);localStorage.setItem("menuSearchHistory",JSON.stringify(f));q(f,h)}}).on("keyup",".msg-srh-input",function(a){a=a.which;var c=k.val();13===a&&c!==m&&(m=c,_getData_("searchModule",{key:c}).done(function(a){a&&q(a,e,c);b.removeClass("hidden");g.addClass("hidden")}));c||(b.addClass("hidden"),g.removeClass("hidden"))});(function(){var a=localStorage.getItem("menuSearchHistory");a&&(f=JSON.parse(a));q(f,h)})();c.resetSearchPanel=function(){b.addClass("hidden");g.removeClass("hidden");k.val("");m=""}})(this,jQuery);(function(c,a){var d={id:!1,items:[{text:"",role:"",icon:"",click:Util.noop}],selector:!1},k=Mustache,g=a.trim(CONTEXT_MENU_TPL);c.ContextMenu=function(b){this.cfg=a.extend({},d,b);this._init()};ContextMenu.prototype={constructor:ContextMenu,_init:function(){this.cfg.options={};this._initView();this._initEvent()},_getSize:function(){var a=this.$widget,c;a.addClass("hidden-accessible").removeClass("hidden");c={width:a.outerWidth(),height:a.outerHeight()};a.addClass("hidden").removeClass("hidden-accessible");return c},_initView:function(){var b=this.cfg;b.id||(b.id=Util.uuid(8,16)+"-contextmenu");this.$widget=a(Util.clearHtml(k.render(g,b))).appendTo("body");this.size=this._getSize()},_initEvent:function(){var b=this.cfg,c=this,e={},d;a.each(b.items,function(a,b){e[b.role]=b.click});this.$widget.on("click",".menu-item",function(d){d.preventDefault();var f=this.getAttribute("role"),f=e[f],g;f&&(g=a.proxy(f,c,b.options,d)());!1!==g&&c.hide()});a(document).on("click",function(b){a.contains(c.$widget[0],b.target)||c.hide()});b.selector&&(d=a(b.selector),d.length&&d.on("contextmenu",function(a){c.show({x:a.pageX,y:a.pageY});return!1}))},hide:function(){this.$widget.addClass("hidden");return this},show:function(a){this.$widget.css({top:a.x,left:a.y,zIndex:Util.getZIndex()}).removeClass("hidden");return this},setOptions:function(a,c){this.cfg.options[a]=c;return this}}})(this,jQuery);(function(c,a){var d=a("#all-tabs-list"),k=a("#tabs-list"),g=k.find(".bottom-tab-line"),b=a("#tabs-fixed-list"),h=a("#maincontent"),e=$dropPanel.find(".slide-list"),l=a.trim(BOTTOM_TAB_ITEM),f=a.trim(TAB_NAV_CONTENT_TPL),q=a.trim(TAB_SLIDE_TPL),m=Mustache,p={},r={},w="",A={closeIcon:!0,refresh:!1},t=a("#footer").width()-40-b.outerWidth(!0)-1;c.TabsNav={_tab_w:0,_activeId:"",_getTabWidth:function(){this._tab_w||(this._tab_w=b.children().eq(0).outerWidth(!0)||115);return this._tab_w},addTab:function(n,c){var d=a.extend({},A,n),v="tab-"+d.id;if(!p[v]){c?(d.realUrl=Util.getRightUrl(d.url),d.url="about:blank"):d.url=Util.getRightUrl(d.url);d.uid=d.id;var k=Util.clearHtml(m.render(l,d));d.closeIcon?(a(k).appendTo(g),k=a.extend({},d),k.id+="-drop",a(Util.clearHtml(m.render(q,k))).appendTo(e)):(a(k).appendTo(b),r[v]=!0,w=v);a(Util.clearHtml(m.render(f,d))).appendTo(h);p[v]=d;c&&(p[v].notInit=!0);this.adjustSize()}c||this.activeTab(v)},getActiveTab:function(){var a=$allTabs.find("#"+this._activeId);return new u(p[a[0].id])},activeTab:function(b){0!==b.indexOf("tab-")&&(b="tab-"+b);var c=a("#"+b);if(c.length){var n=a("#"+c.data("target")),e=p[b];r[b]||this.adjustTabPosOnActive(b);c.hasClass("active")||(d.find("li.active").removeClass("active"),c.addClass("active"),this._activeId=b,e.notInit&&(n[0].src=e.realUrl,e.notInit=!1),n.removeClass("hidden").siblings(".tab-content").addClass("hidden"))}},adjustTabPosOnActive:function(b){0!==b.indexOf("tab-")&&(b="tab-"+b);var c=a("#"+b).prevAll();b=this._getTabWidth();var d=Math.ceil(Math.abs(parseFloat(g.css("margin-left"),10))),n=d,c=b*c.length;c<d?n=c:c>=t+d?n=c+b-t:c>d&&c<t+d&&c+b>t+d&&(n=c+b-t);g.stop(!0).animate({marginLeft:-n},500)},removeTab:function(b){0!==b.indexOf("tab-")&&(b="tab-"+b);var c=a("#"+b),d=a("#"+c.data("target"));c.hasClass("active")&&(c.prev().length?this.activeTab(c.prev()[0].id):c.next().length?this.activeTab(c.next()[0].id):this.activeTab(w));c.remove();e.find("#"+b+"-drop").remove();Util.clearIframe(d);d.remove();delete p[b];this.adjustSize()},removeAll:function(a){a&&0!==a.indexOf("tab-")&&(a="tab-"+a);g.find(".tabs-nav-item").each(function(b,c){var d=c.id;d!=a&&TabsNav.removeTab(d)});a||TabsNav.activeTab(w)},adjustSize:function(){t=a("#footer").width()-40-b.outerWidth(!0)-1;var c=this._getTabWidth()*g.children().length+1;0<c&&g.css("width",c);t>c?(g.stop(!0).animate({marginLeft:0},500),k.css("width","auto")):(c-=t,g.stop(!0).animate({marginLeft:-c},500),k.css("width",t))},refreshTabContent:function(b){0!==b.indexOf("tab-")&&(b="tab-"+b);var c=a("#"+b),c=a("#"+c.data("target"));c[0].src="about:blank";c[0].src=Util.getRightUrl(p[b].realUrl||p[b].url)}};var u=function(a){this._data=a};a.extend(u.prototype,{remove:function(){var a="tab-"+this._data.id;r[a]?console&&console.warn("\u8b66\u544a\uff1a\u56fa\u5b9aTab\u662f\u4e0d\u80fd\u5220\u9664\u7684\uff01"):TabsNav.removeTab(a)},getData:function(){var b=this._data;return a.extend({},b,{tabId:"tab-"+b.id})},refreshContent:function(){TabsNav.refreshTabContent("tab-"+this._data.id)},active:function(){TabsNav.activeTab("tab-"+this._data.id)},prev:function(){var b=a("#tab-"+this._data.id).prev();if(b.length)return new u(p[b[0].id]);console&&console.warn("\u5df2\u7ecf\u5230\u5934\u4e86\uff01")},next:function(){var b=a("#tab-"+this._data.id).next();if(b.length)return new u(p[b[0].id]);console&&console.warn("\u5df2\u7ecf\u5230\u5c3e\u4e86\uff01")}});var y;a(c).on("resize",function(a){clearTimeout(y);y=setTimeout(function(){TabsNav.adjustSize();TabsNav.activeTab(TabsNav._activeId)},200)});d.on("click",".tabs-nav-item",function(a){TabsNav.activeTab(this.id)}).on("click",".tabs-nav-item-close",function(a){a=this.parentNode.getAttribute("data-id");TabsNav.removeTab(a)}).on("click",".tabs-nav-item-refresh",function(a){a.stopPropagation();a=this.parentNode.getAttribute("data-id");TabsNav.refreshTabContent(a)}).on("contextmenu",".tabs-nav-item",function(b){b=this.id;if(!r[b]){var c=a(this),d=c.offset().top+68,c=c.offset().left+3;x.setOptions("tabId",b).show({x:d,y:c});return!1}});$dropPanel.on("click",".slide-list-item",function(a){a=this.getAttribute("data-id");TabsNav.activeTab(a);z()});$dropBox.on("click",".drop-btn",function(a){z()});var z=function(){$dropBox.hasClass("showPanel")?($dropPanel.stop(!0).animate({bottom:-$dropPanel.height()}),$pageCover.addClass("hidden")):($dropPanel.stop(!0).animate({bottom:30}),$pageCover.removeClass("hidden"));$dropBox.toggleClass("showPanel")},x=new ContextMenu({items:[{text:"\u5173\u95ed",role:"close-self",click:function(a){TabsNav.removeTab(a.tabId)}},{icon:"remove",text:"\u5173\u95ed\u5176\u4ed6\u9875",role:"close-others",click:function(a){TabsNav.removeAll(a.tabId)}},{icon:"remove",text:"\u5173\u95ed\u5168\u90e8",role:"close-all",click:function(a){TabsNav.removeAll()}},{text:"\u5237\u65b0",role:"refresh-self",click:function(a){TabsNav.refreshTabContent(a.tabId)}},"sep",{text:"\u53d6\u6d88",role:"quit",click:function(a){}}]});_getNiceSroll_(function(){$dropPanel.niceScroll({cursorcolor:"#d5dee6"})})})(this,jQuery);(function(c,a){a("body").on("click",function(c){c=a(c.target);var d=!0;a.contains($userInfo[0],c[0])?(hidePanel(),d=!1):$userInfo.removeClass("showPanel");a.contains($topMenu[0],c[0])?d=!1:$topMenu.removeClass("showPanel");a.contains($quickMenu[0],c[0])?d=!1:$quickMenu.removeClass("open");c.closest(".bottom-drop").length?d=!1:($dropBox.removeClass("showPanel"),$dropPanel.stop(!0).animate({bottom:-$dropPanel.height()}));a.contains($msgPanel[0],c[0])||c.closest(".js-panel").length?d=!1:hidePanel();_leftIsWide||(c.closest(".left-menu").length?d=!1:$leftContainer.find(".top-item.open").removeClass("open"));d&&$pageCover.addClass("hidden")})})(this,jQuery);(function(c,a){var d=function(){a("[placeholder]").placeholder()};a.placeholder?d():Util.loadJs("frame/fui/js/widgets/jquery.placeholder.min.js",d)})(this,jQuery);var eMsgSocket;window.OpenEMsg=function(c,a,d){window.eMsg?"undefined"==typeof a?eMsg.open(c):eMsg.openSession(c,a,d):Util.loadPageModule({templ:"frame/fui/js/widgets/emsg/emsg.tpl",js:"frame/fui/js/widgets/emsg/emsg.js",css:"frame/fui/js/widgets/emsg/emsg.css",callback:function(){eMsgSocket=new EMsgSocket(_userGuid_,_userName_);"undefined"==typeof a?eMsg.open(c):eMsg.openSession(c,a,d)}})};