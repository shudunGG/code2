/* jshint -W030 */
// 分屏页码模板
var SCREEN_PAGE_TPL='\x3ca href\x3d"javascript:void(0);" data-page\x3d"{{page}}" class\x3d"page-item l mr10"\x3e\x3cspan\x3e{{pageNum}}\x3c/span\x3e\x3c/a\x3e',SCREEN_TPL='\x3cdiv class\x3d"imac-screen l" data-title\x3d"\u7b2c{{page}}\u5206\u5c4f"\x3e\x3c/div\x3e',SCREEN_APP_TPL='\x3cdiv class\x3d"app-item trans" title\x3d"{{name}}" style\x3d"top:{{top}}px;left:{{left}}px" data-id\x3d"{{id}}"\x3e\x3cspan class\x3d"unread {{^count}}hidden{{/count}}"\x3e{{count}}\x3c/span\x3e\x3cimg src\x3d"{{icon}}" alt\x3d"" class\x3d"app-icon"\x3e\x3cp class\x3d"app-name"\x3e{{name}}\x3c/p\x3e\x3c/div\x3e',TASK_ITEM_TPL='\x3ca href\x3d"javascript:void(0);" id\x3d"{{id}}-task" data-id\x3d"{{id}}" class\x3d"task-item l clearfix" title\x3d"{{name}}"\x3e\x3cp class\x3d"task-name l"\x3e{{name}}\x3c/p\x3e\x3c/a\x3e',DROP_ITEM_TPL='\x3cli id\x3d"{{id}}-drop" data-id\x3d"{{id}}" class\x3d"drop-item" title\x3d"{{name}}"\x3e{{name}}\x3c/li\x3e',DOCK_APP_TPL='\x3cdiv class\x3d"dock-app" data-id\x3d"{{id}}" title\x3d"{{name}}"\x3e{{#count}}\x3cspan class\x3d"unread"\x3e{{count}}\x3c/span\x3e{{/count}}\x3cimg src\x3d"{{icon}}" alt\x3d"" \x3e\x3cp class\x3d"name"\x3e{{{sname}}}\x3c/p\x3e\x3c/div\x3e',SEARCH_APPS_TPL='\x3cdiv class\x3d"app-item trans in-panel l" title\x3d"{{name}}" id\x3d"{{id}}-search" data-id\x3d"{{id}}"\x3e\x3cimg src\x3d"{{icon}}" alt\x3d"" class\x3d"app-icon"\x3e\x3cp class\x3d"app-name"\x3e{{name}}\x3c/p\x3e\x3c/div\x3e',BOARD_BTN_TPL='\x3cdiv class\x3d"right-board-btn" data-id\x3d"{{id}}" data-url\x3d"{{url}}"\x3e{{name}}\x3c/div\x3e',BOARD_CONTENT_TPL='\x3ciframe src\x3d"{{url}}" class\x3d"board-content hidden" id\x3d"board-content-{{id}}" height\x3d"100%" width\x3d"100%" frameborder\x3d"0" scrolling\x3d"no"\x3e\x3c/iframe\x3e';window.ImacEvent=new Util.UserEvent;(function(g,a){a.extend(Util,{debounce:function(a,b,d){b=b||17;var f;return function(){var e=arguments,g=d||this;clearTimeout(f);f=setTimeout(function(){a.apply(g,e)},b)}},throttle:function(a,b,d){b=b||200;var f,e=+new Date;return function(){clearTimeout(f);var k=arguments,g=d||this,n=+new Date-e;n>=b?(a.apply(g,k),e=+new Date):f=setTimeout(function(){a.apply(g,k);e=+new Date},b-n)}},localMemory:{_get:function(a){return JSON.parse(localStorage.getItem(a))||[]},_add:function(e,b,d){var f=this._get(b),k=a.inArray(e,f);if(-1!=k)return f.splice(k,1),f.unshift(e),!1;f.unshift(e)>d&&(f.length=d);localStorage.setItem(b,JSON.stringify(f));return!0},_del:function(e,b){var d=this._get(b),f=a.inArray(e,d);-1!==f&&(d.splice(f,1),localStorage.setItem(b,JSON.stringify(d)))},SearchHistory:{get:function(){return Util.localMemory._get("_search-history_")},add:function(a){return Util.localMemory._add(a,"_search-history_",20)},remove:function(a){return Util.localMemory._del(a,"_search-history_")}},QuickApps:{get:function(){return Util.localMemory._get("_quick-apps_")},add:function(a){return Util.localMemory._add(a,"_quick-apps_",10)},remove:function(a){return Util.localMemory._del(a,"_quick-apps_")}},RecentApps:{get:function(){return Util.localMemory._get("_recent-apps_")},add:function(a){return Util.localMemory._add(a,"_recent-apps_",10)},remove:function(a){return Util.localMemory._del(a,"_recent-apps_")}}},getBdSize:function(){return{width:a(g).width()-60,height:a(g).height()-50-44}},getAppShortName:function(a){return a.substr(0,4)},fixPath:function(e){var b=a.extend({},e);b.url=Util.getRightUrl(e.url);b.icon=Util.getRightUrl(e.icon);return b},highlightApp:function(a){var b=function(){a.animate({opacity:.3},200,f)},d=function(){a.animate({opacity:1},200,f)},f=function(){a.queue("highlight").length?a.dequeue("highlight"):a.clearQueue("highlight")};a.queue("highlight",[b,d,b,d,b,d,b,d]);f()},_jsPromise:{},loadJsPromise:function(e){if(this._jsPromise[e])return this._jsPromise[e];var b=a.Deferred(),d=document.createElement("script");d.type="text/javascript";(this.browsers.isIE67||this.browsers.isIE8)&&d.readyState?d.onreadystatechange=function(){if("loaded"==d.readyState||"complete"==d.readyState)b.resolve(),d.onreadystatechange=null}:(d.onload=function(){b.resolve();d.onload=null},d.onerror=function(){b.reject();d.onerror=null;Util._jsPromise[e]=null});d.src=Util.getRightUrl(e);document.getElementsByTagName("head")[0].appendChild(d);return this._jsPromise[e]=b.promise()},doNiceScroll:function(a,b){this.loadJsPromise("frame/fui/js/widgets/jquery.nicescroll.min.js").done(function(){a.niceScroll(b)})},doPlaceHolder:function(a){this.loadJsPromise("frame/fui/js/widgets/jquery.placeholder.min.js").done(function(){a.placeholder()})}});EpDialog.setMaxCoord({top:50,left:0,right:60,bottom:50});g.eWebSocket=void 0;g.creatWebSocket=function(a,b,d){if(eWebSocket)d&&d();else{var f=g.EWebSocketConfig?g.EWebSocketConfig:{url:EmsgConfig.websocketUrl};f.uid=a;f.uname=b;g.EWebSocket?(eWebSocket=new EWebSocket(f),d&&d(),ImacEvent.fire("websocketCreated")):Util.loadJs("frame/fui/js/widgets/ewebsocket/ewebsocket.js",function(){eWebSocket=new EWebSocket(f);d&&d();ImacEvent.fire("websocketCreated")})}}})(this,jQuery);(function(g,a){var e=a("#imac-skin-bg");Util.ajax({url:ImacDataActionUrl.getBgUrl}).done(function(a){a&&a.bg?(e[0].src=Util.getRightUrl(a.bg),localStorage.setItem("_imac_bg_",a.bg)):(e[0].src=Util.getRightUrl("frame/fui/pages/themes/imac/images/skinbg/bg.jpg"),console&&console.error("\u672a\u8fd4\u56de\u80cc\u666f\uff0c\u52a0\u8f7d\u9ed8\u8ba4\u80cc\u666f\uff01"),localStorage.setItem("_imac_bg_","frame/fui/pages/themes/imac/images/skinbg/bg.jpg"))});g.setBg=function(a){e[0].src=Util.getRightUrl(a);localStorage.setItem("_umplatform_bg_",a)}})(this,jQuery);(function(g,a){var e=a("#imac-page-list"),b=a("#imac-screens-container"),d=a(".screen-list"),f=Mustache,k=a.trim(SCREEN_PAGE_TPL),t=a.trim(SCREEN_TPL),p=a.trim(SCREEN_APP_TPL),n,h=DEFAULT_ACTIVE_PAGE-1,l=(a(g).height()-94-15)/145>>0,m,q=function(){var a=b.find(".imac-screen"),c=Util.getBdSize(),f=h*c.width;b.add(a).css(c);d.css("margin-left",-f)},r=function(c){var d=[],b=38*c.length;a.each(c,function(a){d.push(f.render(k,{page:a,pageNum:a+1}))});e.css({marginLeft:-b/2,width:b}).append(d.join(""))},c=function(c){var b=[];a.each(c,function(a,c){var d={page:a+1};ImacScreen._screenCache[a]={id:c.id,name:c.name};b.push(f.render(t,d))});d.html(b.join(""))};a(g).on("resize",Util.debounce(function(){var c=(a(g).height()-94-15)/145>>0;c!==l&&(l=c,a.each(d.children(),function(c,d){a(d).find(".app-item").each(function(c,d){var b=a(d),f=u(c);b.removeClass("trans").css(f).addClass("trans")})}))},50));var u=function(a){var c=Util.toInt(a/l);a=Util.toInt(a%l);return{left:25+145*c,top:15+145*a}},w=function(c,b){var v=null,e=[];b.length&&(v=d.find(".imac-screen").eq(c),a.each(b,function(d,b){b=Util.fixPath(b);var v=u(d),v=a.extend({},b,v);b.page=c;b.index=d;AppMgr.cacheAppData(b.id,b);b.needMsgRemind&&AppMgr.msgRemindApps.push(b.id);e.push(f.render(p,v))}),v.html(e.join("")))},z=function(c){c.length&&a.each(c,function(a,c){w(a,c.apps)})};(function(){return Util.ajax({url:g.ImacDataActionUrl.screenAppsUrl}).done(function(a){a&&("[object Array]"!=Object.prototype.toString.call(a)?console.error("\u5c4f\u5e55\u5e94\u7528\u6570\u636e\u9519\u8bef\uff01"):(r(a),c(a),z(a),ImacEvent.fire("afterAllAppsLoad"),n=a.length,m=A(),AppDragMgr.enableAllScreenApps(),q(),x(h)))})})();var x=function(a){var c=a*Util.getBdSize().width;e.find(".page-item").eq(a).addClass("active").siblings().removeClass("active");d.stop(!0).animate({marginLeft:-c},200);m.enableItem("page-"+h).disableItem("page-"+a);h=a};e.on("click",".page-item",function(){var c=a(this),b=Util.toInt(a(this).data("page"));c.hasClass("active")||x(b)});g.AppCmFuncs={moveToScreen:function(a,c){AppMgr.moveToScreen(a.id,c.page)},screenToToolbar:function(a){AppMgr.screenToToolbar(a.id)},openApp:function(a){AppMgr.openApp(a.id)},uninstallApp:function(a){epoint.confirm("\u786e\u5b9a\u8981\u5378\u8f7d\u6b64\u5e94\u7528\u5417\uff1f\u5378\u8f7d\u4e4b\u540e\u60a8\u53ef\u4ee5\u91cd\u65b0\u4ece\u5e94\u7528\u4ed3\u5e93\u4e2d\u5b89\u88c5","\u5378\u8f7d\u63d0\u9192",function(){AppMgr.uninstallApp(a.id)})}};var A=function(){var a=[],c,b=[],d=AppCmFuncs;a.push({text:"\u6253\u5f00\u5e94\u7528",role:"open-app",click:d.openApp});a.push("sep");a.push({text:"\u5378\u8f7d\u5e94\u7528",role:"uninstall-app",click:d.uninstallApp});a.push("sep");for(c=1;c<=n;c++)b.push({text:ImacScreen._screenCache[c-1].name||"\u684c\u9762-"+c,role:"page-"+(c-1),page:c-1,click:d.moveToScreen});a.push({text:"\u79fb\u52a8\u5e94\u7528\u5230",role:"move-app",items:b});a.push({text:"\u53d6\u6d88",role:"hide",click:function(){m.hide()}});return(new EpContextMenu({items:a})).setOptions("from","screen")};a(document).on("keydown",function(a){a=a.which;var c;37==a?c=h-1:39==a&&(c=h+1);void 0!==c&&(a=c,0>c?a=0:c>n-1&&(a=n-1),x(a))});a(g).on("resize",q);b.on("click",".app-item",function(){var c=a(this).data("id");AppMgr.openApp(c)}).on("contextmenu",".app-item",function(c){var b=a(this).data("id");m.setOptions("id",b).show({x:c.pageX,y:c.pageY});return!1});g.AppMgr={_data:{},msgRemindApps:[],cacheAppData:function(c,b){this._data[c]=a.extend({},b)},deleteAppData:function(a){this._data[a]=null},getAppData:function(c){return(c=this._data[c])?a.extend({},c):!1},screenToToolbar:function(a){QuickApps.isFull()||QuickApps.addApp(a,!1,!0)},moveToScreen:function(a,c){var b=ImacScreen.getScreen(c).find(".app-item").last(),b=b.length?b.data("id"):null;ImacScreen.removeApp(a);ImacScreen.addApp(a,c);Util.ajax({url:ImacDataActionUrl.appToScreenUrl,data:{appId:a,screenId:ImacScreen._screenCache[c].id,prevAppId:b}})},openApp:function(a){var c=AppMgr.getAppData(a);"blank"==c.openType?g.open(c.url):TabsNav.addOrActiveTab(a)},installApp:function(a,c){var b=ImacScreen.getScreen(h).find(".app-item").last(),b=b.length?b.data("id"):null;return Util.ajax({url:ImacDataActionUrl.installAppUrl,data:{appId:a,screenId:ImacScreen._screenCache[h].id,prevAppId:b}}).done(function(a){a&&(c&&c(),a=Util.fixPath(a),AppMgr.cacheAppData(a.id,a),a.needMsgRemind&&AppMgr.msgRemindApps.push(a.id),ImacScreen.addApp(a.id,h))})},uninstallApp:function(a){if(TabsNav._data[a])epoint.alert("\u6b64\u5e94\u7528\u5df2\u7ecf\u6253\u5f00\uff0c\u8bf7\u5173\u95ed\u540e\u518d\u5378\u8f7d\uff01",null,null,"info");else return Util.ajax({url:ImacDataActionUrl.uninstallAppUrl,data:{appId:a}}).done(function(c){if(c)if("success"==c.status){if((c=AppMgr.getAppData(a))&&c.msgCountUrl){c=0;for(var b=AppMgr.msgRemindApps.length;c<b;++c)if(AppMgr.msgRemindApps[c]==a){AppMgr.msgRemindApps.splice(c,1);break}}ImacScreen.removeApp(a);QuickApps.removeApp(a);AppMgr.deleteAppData(a);ImacEvent.fire("afterAppUninstall",a);epoint.showTips("\u5e94\u7528\u5378\u8f7d\u6210\u529f\uff01",{state:"success"})}else c.description&&epoint.alert(c.description,null,null,"info")})}};g.ImacScreen={_screenCache:[],getActivePage:function(){return h},getApp:function(a){return b.find('[data-id\x3d"'+a+'"]')},getScreen:function(a){return b.find(".imac-screen").eq(a)},addApp:function(c,b,d){var e=this.getScreen(b),k=AppMgr.getAppData(c),g;void 0===d&&(d=e.find(".app-item").length);g=u(d);a.extend(k,{index:d,page:b});$app=a(f.render(p,k));$app.appendTo(e).css(g);Util.highlightApp($app);AppMgr.cacheAppData(c,k);AppDragMgr.enableScreenApp(c)},removeApp:function(a){var c=this.getApp(a);a=AppMgr.getAppData(a);c.addClass("hidden");ImacScreen.adjustAppsPosFromIndex(a.page,a.index+1,1);AppDragMgr.destroy(c);c.remove()},getAppByIndex:function(c,b){var d=!1;this.getScreen(c).find(".app-item").each(function(c,f){var u=a(f).data("id");if(AppMgr.getAppData(u).index==b)return d=a(f),!1});return d},getAppIndexByPos:function(a){var c;a.top>145*(l-1)+67.5?c=-1:(c=Math.round((a.left-25)/145),a=Math.round((a.top-15)/145),c=c*l+a);return c},adjustAppPosByIndex:function(a,c){var b=AppMgr.getAppData(a),d=u(c),f=ImacScreen.getApp(a);Util.browsers.isIE8||Util.browsers.isIE9?f.stop(!0).animate(d,200):f.css(d);b.index!=c&&(b.index=c,AppMgr.cacheAppData(a,b))},adjustAppsPosFromIndex:function(c,b,d){for(var f=ImacScreen.getScreen(c).find(".app-item").length,e,k,g,h,m=[];b<f;b++)m.push(ImacScreen.getAppByIndex(c,b));a.each(m,function(a,c){g=c.data("id");k=AppMgr.getAppData(g);h=d?k.index-1:k.index+1;e=u(h);c.css(e);k.index=h;AppMgr.cacheAppData(g,k)})},getAppsSort:function(c){var b=[];this.getScreen(c).find(".app-item").each(function(c,d){b.push(a(d).data("id"))});return b}}})(this,jQuery);(function(g,a){var e=a("#imac-screens-container"),b={containment:"parent",scroll:!1,opacity:.5,distance:10,start:function(){a(this).removeClass("trans").addClass("app-drag-zindex")},stop:function(b,f){var d=a(this),e=d.data("id"),p=AppMgr.getAppData(e),n=f.offset,h=d.parent(),l=null,l=h.find(".app-item").length,m=ImacScreen.getAppIndexByPos(n);d.addClass("trans").removeClass("app-drag-zindex");var n=!1,q=[];-1==m||m==p.index?ImacScreen.adjustAppPosByIndex(e,p.index):m+1>l?(h=h.children(".app-item").last(),d.nextAll().each(function(a,c){q.push({id:c.getAttribute("data-id"),index:p.index+a})}),d.insertAfter(h),q.push({id:e,index:l-1}),n=!0):(l=ImacScreen.getAppByIndex(ImacScreen.getActivePage(),m),n=!0,q.push({id:e,index:m}),m<p.index?(d.insertBefore(l),d.nextAll().each(function(a,c){q.push({id:c.getAttribute("data-id"),index:m+a+1})})):(d.insertAfter(l),d.prevAll().each(function(a,c){q.push({id:c.getAttribute("data-id"),index:m-1-a})})));a.each(q,function(a,c){setTimeout(function(){ImacScreen.adjustAppPosByIndex(c.id,c.index)},20*a)});n&&Util.ajax({url:g.ImacDataActionUrl.updateAppPosUrl,data:{appId:e,screenId:ImacScreen._screenCache[ImacScreen.getActivePage()].id,sort:JSON.stringify(ImacScreen.getAppsSort(ImacScreen.getActivePage()))}})}};g.AppDragMgr={enableAllScreenApps:function(){e.find(".app-item").draggable(b)},enableScreenApp:function(a){ImacScreen.getApp(a).draggable(b)},destroy:function(a){a.draggable("destroy")}}})(this,jQuery);(function(g,a){var e=a("#imac-screen-pages"),b=e.width(),d=function(){var d=(a("body").width()-b)/2;e.css("left",d)};a(g).on("resize",d);d()})(this,jQuery);(function(g,a){var e=a("#imac-taskbar"),b=a(".tasks-wrap",e),d=a(".task-list",e),f=a("#task-drop"),k=a(".drop-list",f),t=Mustache,p=a.trim(TASK_ITEM_TPL),n=new EpContextMenu({items:[{text:"\u663e\u793a\u684c\u9762",click:function(){TabsNav.minAllTabs()}},"sep",{text:"\u5173\u95ed\u6b64\u4efb\u52a1",click:function(a){TabsNav.removeTab(a.id)}},{text:"\u53ea\u663e\u793a\u6b64\u4efb\u52a1\u7a97\u53e3",click:function(a){TabsNav.minAllTabs(a.id)}},"sep",{text:"\u5173\u95ed\u5176\u4ed6\u4efb\u52a1",click:function(a){TabsNav.removeAll(a.id)}},{text:"\u5173\u95ed\u6240\u6709\u4efb\u52a1",click:function(){TabsNav.removeAll()}},"sep",{text:"\u53d6\u6d88",role:"cancel"}]}),h={},l=0,m=function(){l=e.width()-0;var a=114*d.children().length;0<a&&d.css("width",a);a>l?(b.css("width",l),a-=l,d.stop(!0).animate({marginLeft:-a},500)):(d.stop(!0).animate({marginLeft:0},500),b.css("width","auto"))};g.TabsNav={_data:h,addTab:function(c){-1!="stringnumber".indexOf(typeof c)?this.openTask(c):(c.id=c.id||+new Date,c.icon=c.icon||"./images/app/8.png",h[c.id]||(a(t.render(p,{id:c.id,name:c.name,icon:c.icon})).appendTo(d),a(t.render(DROP_ITEM_TPL,{id:c.id,name:c.name})).appendTo(k),m()),TabsNav.openTask(c),TabsNav.activeTask(c.id))},openTask:function(a){var c,b=null,b=Util.getBdSize();"object"==typeof a?(c=a,a=c.id||+new Date):c=AppMgr.getAppData(a);f.removeClass("hidden");h[a]?(b=h[a],b.show(0,!1)):(c.widthRatio=1<c.widthRatio?1:c.widthRatio,c.heightRatio=1<c.heightRatio?1:c.heightRatio,b=(new EpDialog({id:a+"-epdialog",title:c.name,url:Util.getRightUrl(c.url),draggable:!0,dragContainer:".imac-screen",resizable:!0,resizeContainer:".imac-screen",width:(c.widthRatio||DIALOG_SIZE_RATIO[0])*b.width,height:(c.heightRatio||DIALOG_SIZE_RATIO[1])*b.height,btns:[{role:"min",title:"\u6700\u5c0f\u5316",click:function(){this.hide()}},{role:"maxwin",title:"\u6700\u5927\u5316"},{role:"refresh",title:"\u5237\u65b0"},{role:"close",title:"\u5173\u95ed",click:function(a){TabsNav.removeTab(a.id);return!1}}]})).setOptions("id",a),c.isFullView=c.isFullView||1==c.widthRatio&&1==c.heightRatio,c.isFullView?b.show(0,!1).maxWin():b.show(0,!0),h[a]=b)},minAllTabs:function(a){var c,b;for(c in h)h.hasOwnProperty(c)&&(b=h[c],c!=a?b.hide():(b.show(0,0),TabsNav.activeTask(c)))},addOrActiveTab:function(c){var b=h[c],f=AppMgr.getAppData(c);b||(a(t.render(p,{id:f.id,name:f.name,icon:f.icon})).appendTo(d),a(t.render(DROP_ITEM_TPL,{id:f.id,name:f.name})).appendTo(k),m());TabsNav.openTask(c);TabsNav.activeTask(c)},makeTabVisiable:function(a){a=114*TabsNav.getTab(a).prevAll().length;var c=Math.abs(Util.toInt(d.css("margin-left"))),f=b.width(),e=0;a<c?e=a:a+114-f>c&&(e=a+114-f);e&&d.stop(!0).animate({marginLeft:-e},300)},getTab:function(a){return d.find("#"+a+"-task")},removeTab:function(a){var c=TabsNav.getTab(a);c.length&&(c.remove(),k.find("#"+a+"-drop").remove(),k.children().length||f.addClass("hidden"),h[a].hide().destroy(),h[a]=null,delete h[a],m())},_removeOthers:function(c){var b=d.find(".task-item");b.length&&b.each(function(b,d){var f=a(d).data("id");c!=f&&TabsNav.removeTab(f)})},removeAll:function(a){a?this._removeOthers(a):this._removeAll()},_removeAll:function(){var c=d.find(".task-item");c.length&&(c.each(function(c,b){var d=a(b),f=d.data("id");d.remove();h[f].hide().destroy();h[f]=null;delete h[f]}),f.addClass("hidden"),k.children().each(function(c,b){a(b).remove()}),m())},activeTask:function(a){var c=TabsNav.getTab(a);c.hasClass("active")||c.addClass("active").siblings().removeClass("active");this.adjustTabPosOnActive(a);ImacBoard.hide()},adjustTabPosOnActive:function(a){$prevs=d.find("#"+a+"-task").prevAll();prev_w=114*$prevs.length;aimMarginLeft=scroll_w=Math.ceil(Math.abs(parseFloat(d.css("margin-left"),10)));prev_w<scroll_w?aimMarginLeft=prev_w:prev_w>=l+scroll_w?aimMarginLeft=prev_w+114-l:prev_w>scroll_w&&prev_w<l+scroll_w&&prev_w+114>l+scroll_w&&(aimMarginLeft=prev_w+114-l);d.stop(!0).animate({marginLeft:-aimMarginLeft},500)},refreshTabContent:function(a){(a=h[a])&&a.refresh&&a.refresh()}};a("body").on("click",".epdialog-hd",function(c){c.preventDefault();c.stopPropagation();/^epdialog-hd(?!-btn)/.test(c.target.className)&&(c=a(this).parent(".epdialog")[0].id.replace(/(.+)-epdialog$/,"$1"))&&TabsNav.addOrActiveTab(c)});var q;a(g).on("resize",function(){clearTimeout(q);q=setTimeout(function(){m();var a,b;for(a in h)h.hasOwnProperty(a)&&(b=h[a],!b.isHidden()&&b.isMax()&&b.maxWin())},100)});e.on("click",".task-item",function(){var c=a(this),b=c.data("id"),d=h[b];c.hasClass("active")?d.toggle():(c.addClass("active").siblings().removeClass("active"),d.show(0,0));TabsNav.activeTask(b)}).on("contextmenu",".task-item",function(c){var b=a(this).data("id");n.setOptions("id",b).show({x:c.pageX,y:c.pageY});return!1});var r=function(a){a?f.addClass("show"):e.addClass("drop-zindex");a=f.hasClass("show")?-280:44;k.stop(!0).animate({bottom:a},function(){e.removeClass("drop-zindex")});f.toggleClass("show")};Util.doNiceScroll(k,{cursorwidth:"2px",cursorcolor:"#3b4252",cursorborder:"1px solid #aaa"});f.on("click",".drop-btn",function(a){a.stopPropagation();k.children().length&&r()}).on("click",".drop-item",function(a){a.stopPropagation();a=this.getAttribute("data-id");TabsNav.addTab(a);TabsNav.activeTask(a);r()});a("body").on("click",function(c){a(c.target).closest(".drop-panel").length||f.hasClass("show")&&r(!0)});m()})(this,jQuery);(function(g,a){var e=function(c,b,d){if(!1===Util.getFrameSysParam("messageSound"))return Util.noop;b=Util.getRightUrl(b);if(Util.browsers.isIE){var f=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden"\x3e\x3c/iframe\x3e').appendTo(c);return function(){f[0].src=b+"?_\x3d"+ +new Date}}var e=document.createElement("audio");e.src=Util.getRightUrl(d);e.className="hidden-accessible";c.append(e);var g=null;return function y(a){void 0===a&&(a=100);e.play()["catch"](function(){clearTimeout(g);0<a&&(g=setTimeout(function(){y(--a)},50))})}}(a("#msg-sound"),"../../msgsound/sound.html","../../msgsound/newsms.wav"),b=a("#imac-right-bar"),d=a(".message",b),f=a(".msg-num",d),b=a(".emsg",b),k=a(".msg-num",b),t,p="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",n=0,h={roll:function(){document.title=p;clearTimeout(n);n=setTimeout(function w(){document.title=p.substring(1,p.length)+p.substring(0,1);p=document.title;n=setTimeout(w,300)},300)},stop:function(){t=g.systemTitle||document.title;clearTimeout(n);document.title=t;p="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}},l=function(a){a=parseInt(a,10);return 99<a?"99+":0>=a?"":a+""},m=0,q=0,r,c,b=function(){c=r=!1;Util.ajax({url:g.ImacDataActionUrl.msgCountUrl,data:{haseXun:!0,needNum:!0},success:function(a){a.remind?(m=parseInt(a.remind)||0,q=f.data("num")||0,m>q?r=!0:m&&(c=!0),f.text(l(m)).data("num",m).removeClass("hidden")):f.text("").data("num",0).addClass("hidden");a.eXun?(m=parseInt(a.eXun)||0,q=parseInt(k.data("num"),10)||0,m>q&&(r=!0),k.removeClass("hidden").text(l(m)).data("num",m)):k.text("").addClass("hidden");r?(e(100),h.roll()):c||h.stop()}})};b();g.updateMsgRemindNum=b;setInterval(b,6E4)})(this,jQuery);(function(g,a){a.each(g.quickApps,function(a,b){b=Util.fixPath(b);b.hasTaskbarIcon=!0;AppMgr.cacheAppData(b.id,b)});a("body").on("click",".default-app-btn",function(e){e.preventDefault();(e=a(this).data("id"))&&AppMgr.openApp(e)})})(this,jQuery);(function(g,a){var e=a("#top-user"),b=function(a,b){if(a){a=Util.getRightUrl(a);var d=new Image;d.onload=function(){d.onload=null;b.src=a};d.onerror=function(){d.onerror=null;console.error(a+"\u5bf9\u5e94\u7684\u56fe\u7247\u8d44\u6e90\u65e0\u6cd5\u52a0\u8f7d\uff01")};d.src=a}};(function(){return Util.ajax({url:g.ImacDataActionUrl.userInfoUrl}).done(function(a){e.find(".user-name").text(a.name+"\uff0c\u60a8\u597d\uff01");e.find(".user-ou").text(a.ouName);if(a.portrait){var d=a.portrait,d=/^data:image/.test(d)?d:Util.getRightUrl("rest/"+d);b(d,e.find(".user-img")[0])}g._userName_=a.name;g._userGuid_=a.ouName;ImacEvent.fire("afterUserInfo",a)})})();(function(){return Util.ajax({url:ImacDataActionUrl.pageInfoUrl}).done(function(d){b(Util.getRightUrl(d.logo||g.DEFAULT_LOGO_URL),a(".sys-logo")[0]);d.title&&(document.title=d.title,g.systemTitle=d.title);g._fullSearchUrl_=d.fullSearchUrl;ImacEvent.fire("afterPageInfo",d)})})()})(this,jQuery);var eMsgSocket;window.OpenEMsg=function(g,a,e){window.eMsg?"undefined"===typeof a?eMsg.open(g):eMsg.openSession(g,a,e):creatWebSocket(_userGuid_,_userName_,function(){eWebSocket.openEmsg(g,a,e)})};(function(g,a){function e(){l=new EMsgList({content:p,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:function(){b()},onDecEmsgCount:function(a){(a=f.text())&&(a=parseInt(a,10)-1);0==a&&(a="",f.data("num",0).addClass("hidden"));f.text(a)}});g.RefreshEMsg=a.proxy(l.getData,l)}function b(){k.stop(!0).animate({right:-350},function(){k.addClass("hidden")});d.removeClass("active")}var d=a(".q-btn.emsg"),f=a(".msg-num",d),k=a("#msgEMsg"),t=a(".msg-panel-content",k),p=a(".emsg-recent-list",t),n=a(".online-user-num",k),h=document.getElementById("online-user"),l;g.EMsgList?e():Util.loadJs("frame/fui/js/widgets/emsglist/emsglist.js",function(){e()});g.OnlineUserSettings&&g.OnlineUserSettings.show&&(k.find(".msg-panel-head").addClass("tab").find(".panel-hd-tab.hidden").removeClass("hidden"),h.src=OnlineUserSettings.url,k.on("click",".panel-hd-tab",function(){var b=a(this),d=b.data("ref"),f=b.data("hasShow"),c=p;b.hasClass("active")||(b.addClass("active").siblings().removeClass("active"),d&&(c=a("#"+d,t),f||setTimeout(function(){OnlineUserSettings.onRefreshData(function(a){n.html(a)});b.data("hasShow",!0)},500)),c.removeClass("hidden").siblings().addClass("hidden"))}));d.on("click",function(){if(d.hasClass("active"))b();else{l.getData();if(g.OnlineUserSettings&&g.OnlineUserSettings.show)OnlineUserSettings.onRefreshData(function(a){n.html(a)});k.removeClass("hidden");k.stop(!0).animate({right:60});d.addClass("active")}});a("body").on("click",function(d){a(d.target).closest(".q-btn.emsg, #msgEMsg").length||b()})})(this,jQuery);(function(g,a){var e=a("#theme-switch"),b,d=function(){d=Util.noop;return Util.loadJs("frame/fui/js/widgets/themeselection/themeselection.js",function(){ThemeSelection._styleLoaded=!0;b=new ThemeSelection({getPagesUrl:ImacDataActionUrl.getPagesUrl,savePageUrl:ImacDataActionUrl.savePageUrl,hideCallback:function(){e.removeClass("active")}});g.themeSelection=b;b.show();e.addClass("active");a("body").on("click",function(d){a(d.target).closest(".theme-selection-container, #theme-switch").length||(e.removeClass("active"),b.hide())})})};(function(){e.on("click",function(){if(!b)return d();e.hasClass("active")?(e.removeClass("active"),b.hide()):(b.show(),e.addClass("active"))})})()})(this,jQuery);(function(g,a){var e=a("#imac-right-bar"),b=a("#search-board"),d=a(".a-search-input",b),f=a("#all-apps",b),k=a(".no-result",f),t=a("#search-key",k),p=a(".tab-item",b).eq(0),n=a("#search-history",b),h=function(){var c=Util.localMemory.SearchHistory.get(),b=[];a.each(c,function(a,c){b.push(l(c))});a(b.join("")).appendTo(n)},l=function(a){return(a=AppMgr.getAppData(a))?Mustache.render(SEARCH_APPS_TPL,a):""};g.SearchPanel={isInit:!1,init:function(){h();var c=AppMgr._data,e,g=[];for(e in c)c.hasOwnProperty(e)&&g.push(l(e));a(g.join("")).appendTo(f);new TabView({dom:"#panel-tab-view",activeCls:"active"});Util.doNiceScroll(b.find(".tabview-bd"),{cursorwidth:"4px",cursorcolor:"#bebdbd",cursorborder:"1px solid #bebdbd"});Util.doPlaceHolder(d);this.isInit=!0},_show:function(){b.removeClass("hidden");d[0].value="";q();TabsNav.minAllTabs();ImacBoard.hide()},show:function(){this.isInit||this.init();this._show();this.show=this._show},hide:function(){b.addClass("hidden")},addAimedApp:function(c){Util.localMemory.SearchHistory.add(c)?a(l(c)).prependTo(n):n.find('[data-id\x3d"'+c+'"]').prependTo(n)},removeApp:function(a){f.add(n).find("#"+a+"-search").remove()}};b.on("click",".close-btn",function(){SearchPanel.hide()});e.on("click",".right-search-btn",function(){SearchPanel.show()});b.on("click",".app-item",function(){var c=a(this).data("id");AppMgr.openApp(c);SearchPanel.hide();SearchPanel.addAimedApp(c)});var m=function(){f.find(".app-name").each(function(a,b){b.innerHTML=b.innerText});k.addClass("hidden")},q=function(){p.hasClass("active")||p.trigger("click");var c=a.trim(d[0].value),b,e;b=!1;m();if(c){f.find(".app-item").addClass("hidden");var g,h=AppMgr._data;for(g in h)h.hasOwnProperty(g)&&-1!==h[g].name.indexOf(c)&&(b=f.find("#"+g+"-search"),e=b.find(".app-name"),e.html(e.html().replace(c,"\x3cb\x3e"+c+"\x3c/b\x3e")),b.removeClass("hidden"),b=!0);b||(t.text(c),k.removeClass("hidden"))}else f.find(".app-item").removeClass("hidden")},r;if(Util.browsers.isIE8||Util.browsers.isIE9)d.on("onkeypress",function(){clearTimeout(r);r=setTimeout(q,200)});else d.on("input",function(){clearTimeout(r);r=setTimeout(q,200)});d.on("onkeypress",function(a){13===a.which&&q()})})(this,jQuery);(function(g,a){var e={activeIndex:0,dom:null,triggerEvent:"click",activeCls:"",overDelay:300};g.TabView=function(b){this.cfg=a.extend({},e,b);this._initView();this._initEvent()};a.extend(TabView.prototype,{_initView:function(){var b=this.cfg,d=a(b.dom),f=d.find('\x3e [data-role\x3d"head"]'),e=d.find('\x3e [data-role\x3d"body"]'),d=f.find('[data-role\x3d"tab"]'),e=e.find('\x3e [data-role\x3d"tab-content"]');a.extend(this,{$widgetHd:f,$tabs:d,$tabCons:e});this.activeTabByIndex(b.activeIndex)},_initEvent:function(){var b=this.cfg,d=b.triggerEvent,f=this.$widgetHd,e=this,g=0;if("click"==d)f.on("click",'[data-role\x3d"tab"]',function(b){b.preventDefault();a.proxy(e._activeTab,e,a(this))()});else if("mouseover"==d)f.on("mouseover",'[data-role\x3d"tab"]',function(){g&&clearTimeout(g);g=setTimeout(a.proxy(e._activeTab,e,a(this)),b.overDelay)}).on("mouseout",'[data-role\x3d"tab"]',function(){g&&clearTimeout(g)})},_activeTab:function(a){var b=this.cfg.activeCls,f=this.$tabs,e=a.data("target");f.removeClass(b);a.addClass(b);this._activeTabContent(e)},activeTabByIndex:function(a){var b=this.cfg.activeCls,f=this.$tabs;0<=a&&a<f.length&&(a=f.removeClass(b).eq(a).addClass(b),a=a.data("target"),this._activeTabContent(a))},_activeTabContent:function(a){this.$tabCons.addClass("hidden").filter('[data-id\x3d"'+a+'"]').removeClass("hidden")}})})(this,jQuery);(function(g,a){Util.doPlaceHolder(a("[placeholder]"))})(this,jQuery);(function(g,a){function e(){k().always(function(){setTimeout(e,3E4)})}var b=a("body"),d={},f=function(){var b=a.Deferred();b.resolve();return b.promise()}(),k=function(){var e=a.unique(AppMgr.msgRemindApps);return e?Util.ajax({url:ImacDataActionUrl.updateAppMsgCountUrl,data:{appIds:e}}).done(function(f){f&&a.each(f,function(a,f){f=parseInt(f,10)||0;f=99<f?"99+":f;var e=d[a]?d[a]:d[a]=b.find('[data-id\x3d"'+a+'"]').find(".unread");f?e.text(f).removeClass("hidden"):e.addClass("hidden")})}):f};ImacEvent.on("afterAllAppsLoad",e)})(this,jQuery);(function(g,a){a("body").on("click",".q-btn.logout",function(){g.logout&&logout()})})(this,jQuery);(function(g,a){function e(){return Util.ajax({url:g._searchCfg.fullSearchCateUrl}).done(function(a){b(a.categories)})}function b(b){b=b||[];"string"==typeof b&&(b=JSON.parse(b));var e=[];a.each(b,function(a,b){e.push({id:b.guid,name:b.name,iconCls:b.icon||"view"})});e.length||e.push({id:"all",name:"\u5168\u6587\u68c0\u7d22",iconCls:"modicon-25"});ClassifySearch._styleLoaded=!0;ClassifySearch.CLASSIFICATION_TPL='\x3cdiv class\x3d"classify-search-classify-item {{#isActive}}active{{/isActive}}" data-id\x3d"{{id}}" data-title-tpl\x3d"\u4e0e${keyword}\u76f8\u5173\u7684{{name}}"\x3e\x3cspan class\x3d"classify-search-classify-icon {{iconCls}}"\x3e\x3c/span\x3e\u4e0e\x3cspan class\x3d"classify-search-classify-kw"\x3e\x3c/span\x3e\u76f8\u5173\u7684{{name}}\x3cspan class\x3d"classify-search-classify-target hidden"\x3e{{target}}\x3c/span\x3e\x3c/div\x3e';b=new ClassifySearch({id:"header-search-container",searchTarget:"\u5185\u5bb9",category:e,placeholder:"\u8bf7\u8f93\u5165",maxShowCharacter:3,enter:function(a,b){var d;d=a||"all";g.open(g._fullSearchUrl_+"?wd\x3d"+g.encodeURI(b)+"\x26type\x3d"+d,"fullsearch")}});d(b);b.$input.on("focus",function(){TabsNav.minAllTabs()})}function d(b){function d(){var d=a.trim(b.$input.val());q&&q.abort();d&&(q=Util.ajax({url:epoint.dealRestfulUrl(_searchCfg.userModuleSearchUrl),data:{cnum:"user,app",key:d,rn:3,location:"search"}}),q.done(function(b){b=mini.decode(b.frameinfo);var e=[],f=[],m=new RegExp(d,"ig");b.users&&a.each(b.users,function(a,b){b.portrait=Util.getRightUrl(b.portrait);b.hlname=b.name.replace(m,'\x3cspan class\x3d"fulltext-search-kw"\x3e'+d+"\x3c/span\x3e");e.push(Mustache.render(r,b))});b.apps&&a.each(b.apps,function(a,b){b.icon=Util.getRightUrl(b.icon);b.hlname=b.name.replace(m,'\x3cspan class\x3d"fulltext-search-kw" \x3e'+d+"\x3c/span\x3e");f.push(Mustache.render(c,b))});a(e.join("")).appendTo(g.empty());a(f.join("")).appendTo(h.empty())}))}var e=b.$classifyList.find('[data-id\x3d"user"]'),f=b.$classifyList.find('[data-id\x3d"app"]');if(e.length&&f.length){var g=a('\x3cul class\x3d"fulltext-search-user-list"\x3e\x3c/ul\x3e'),h=a('\x3cul class\x3d"fulltext-search-app-list"\x3e\x3c/ul\x3e');e.length&&(g.insertAfter(e),g.on("click",".fulltext-search-user-item",function(){_searchCfg.userClick&&_searchCfg.userClick(this.getAttribute("data-id"),this.title);b.$input.blur().val("");b.hidePopup()}));f.length&&(h.insertAfter(f),h.on("click",".fulltext-search-app-item",function(){var c=a(this);c.data("url")&&dealLinkOpen({id:c.data("id"),name:this.title,url:c.data("url"),openType:c.data("opentype")});b.$input.blur().val("");b.hidePopup()}));var l,m=[13,16,17,18,27,37,38,39,40];if("oninput"in document.createElement("input"))b.$input.on("input",function(){clearTimeout(l);l=setTimeout(d,50)});else b.$input.on("keyup",function(b){-1==a.inArray(b.which,m)&&(clearTimeout(l),l=setTimeout(d,50))});b.$input.on("setHistoryValue",d);var q,r='\x3cli class\x3d"fulltext-search-user-item" data-id\x3d"{{guid}}" title\x3d"{{name}}" \x3e\x3cimg class\x3d"fulltext-search-user-item-img" src\x3d"{{portrait}}" \x3e{{{hlname}}}\x3c/li\x3e',c='\x3cli class\x3d"fulltext-search-app-item" data-id\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}" data-url\x3d"{{url}}"\x3e\x3cimg class\x3d"fulltext-search-app-item-icon" src\x3d"{{icon}}"/\x3e{{{hlname}}}\x3c/li\x3e'}}a("#header-search-container");ImacEvent.on("afterPageInfo",function(){g._fullSearchUrl_&&e()})})(this,jQuery);(function(g,a){function e(e,g){if(e){for(var h={closeIcon:!1,refresh:!0},k=[],r=0;r<e.length;r++){var c=e[r],l=!1;void 0!=c.items?!l&&a.each(c.items,function(a,b){if(g){if(b.code==g)return h.id=b.code||"home",h.url=b.url,h.name=b.name,l=!0,!1}else if("tabsnav"==b.openType)return h.id=b.code||"home",h.url=b.url,h.name=b.name,l=!0,!1}):(l||(g?c.code==g&&(h.id=c.code||"home",h.url=c.url,h.name=c.name,l=!0):"tabsnav"==c.openType&&(h.id=c.code||"home",h.url=c.url,h.name=c.name,l=!0)),k=k.concat(e.splice(r,1)),r--)}d(k,e);b(h)}else console.error("\u672a\u83b7\u53d6\u5230\u95e8\u6237\u6570\u636e"),f.addClass("hidden")}function b(b){function d(a){a?(p.addClass("active"),e.removeClass("hidden"),TabsNav.minAllTabs(),ImacBoard.hide()):(p.removeClass("active"),e.addClass("hidden"))}var e=a("");f.on("click",function(){d(!p.hasClass("active"))});k.on("click",".portal-header",function(){TabsNav.addTab(b)}).on("click",".portal-item",function(){var b=a(this),e=b.data("opentype"),b=Util.getRightUrl(b.data("url"));"blank"==e?g.open(b):ImacBoard.show(a(this).data("id"));d(!1)}).on("click",".portal-cate",function(){a(this).parent().toggleClass("collapse")});n.on("click",".board-close",function(){ImacBoard.hide()});a("body").on("click",function(b){a(b.target).closest(p).length||d(!1)});var h,r=p.find(".portal");a(g).on("resize",function(){clearTimeout(h);h=setTimeout(function(){var b=a(g).height()-140;0<b&&r.css("max-height",b)},17)}).trigger("resize")}function d(b,d){var e=[];b&&(e.push('\x3cul class\x3d"portal-list"\x3e'),a.each(b,function(a,b){b.icon=b.icon||"default-modicon";e.push(Mustache.render('\x3cli class\x3d"portal-item" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"portal-icon {{icon}}"\x3e\x3c/span\x3e\x3cspan class\x3d"portal-name"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',b));ImacBoard.data[b.code]=b}),e.push("\x3c/ul\x3e"));a.each(d,function(b,d){e.push('\x3cdiv class\x3d"portal-block"\x3e\x3ch3 class\x3d"portal-cate"\x3e'+d.name+'\x3cspan class\x3d"portal-cate-trigger"\x3e\x3c/span\x3e\x3c/h3\x3e\x3cul class\x3d"portal-list" style\x3d"max-height:'+30*d.items.length+'px"\x3e');a.each(d.items,function(a,b){b.icon=b.icon||"default-modicon";e.push(Mustache.render('\x3cli class\x3d"portal-item" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"portal-icon {{icon}}"\x3e\x3c/span\x3e\x3cspan class\x3d"portal-name"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',b));ImacBoard.data[b.code]=b});e.push("\x3c/ul\x3e\x3c/div\x3e")});a(e.join("")).appendTo(t)}var f=a("#portal-btn"),k=a("#portal-wrap"),t=a("#portal-content"),p=f.add(k),n=a("#board-panel");g.ImacBoard={data:{},cache:{},show:function(b){b=this.cache[b]?this.cache[b]:this.cache[b]=a(Mustache.render(BOARD_CONTENT_TPL,ImacBoard.data[b])).appendTo(n);TabsNav.minAllTabs();n.removeClass("hidden");b.removeClass("hidden").siblings(".board-content").addClass("hidden")},hide:function(){n.addClass("hidden")}};ImacEvent.on("afterPageInfo",function(a){e(a.data.homes,a.data.defaultHome)})})(this,jQuery);(function(g,a){function e(b){var d=a.extend({},MsgCenterConfig,{isMsgCenterMaxSize:b.isMsgCenterMaxSize||!1,msgCenterOrder:b.msgCenterOrder||"asc",hideCallback:function(){}}),e=null,g=function(){g=Util.noop;return Util.loadJs("frame/fui/js/widgets/msgcenter/msgcenter.js",function(){e=new MsgCenter(d);e.show()})};a(".q-btn.message").on("click",function(){if(!e)return g();e.isShow?e.hide():e.show()})}ImacEvent.on("afterUserInfo",function(a){e(a.data)})})(this,jQuery);(function(g,a){var e=a("#imac-right-bar .quick-apps"),b=a(".list-wrap",e),d=a(".quick-cfg-btn",e),f=a.trim(DOCK_APP_TPL),k=0,t=0,p=0;Util.doNiceScroll(b,{cursorwidth:"2px",cursorcolor:"#3b4252",cursorborder:"1px solid #aaa",horizrailenabled:!1});var n=function(){k=e.position().top;t=e.next().outerHeight();p=a("body").height()-(50+k+t);e.css("height",p);b.css("max-height",p-50)};a(g).on("resize",Util.debounce(n,50));g.QuickApps={isInit:!1,init:function(){QuickApps.isInit||(n(),QuickApps._init())},_init:function(){return this.getData().done(function(a){QuickApps._initView(a)._initEvent()})},update:function(){return this._init()},removeApp:function(a){a=b.find('[data-id\x3d"'+a+'"]');a.length&&a.remove()},getData:function(){return Util.ajax({url:ImacDataActionUrl.getQuickAppsUrl})},_initView:function(e){if(!e||!e.length)return this;var c=[];a.each(e,function(a,b){b=Util.fixPath(b);b.sname=Util.getAppShortName(b.name);b.id||(b.id=b.code);AppMgr.getAppData(b.id)||AppMgr.cacheAppData(b.id,b);c.push(Mustache.render(f,b))});a(c.join("")).appendTo(b.empty());d.removeClass("hidden");return this},_initEvent:function(){!this.isInit&&e.on("click",".dock-app",function(){var b=a(this).data("id");AppMgr.openApp(b)});return this}};ImacEvent.on("afterAllAppsLoad",QuickApps.init);var h=ImacDataActionUrl.commonAppCfgUrl,l=function(){var a=location.href.match(/^https?:\/\/.*\/fui\/pages\/themes\/(\w+)\/\1/i);return a&&a[1]}(),m=Util.getUrlParams("pageId")||l,h=Util.addUrlParams(h,{themeId:l,pageId:m}),q=!1;d.on("click",function(){if(!q){q=!0;var a={width:920,height:500},b=Util.getWinSize();a.height=b.height<a.height?b.height:.6*b.height>>0;b.width<a.width&&(a.width=b.width);epoint.openDialog("\u5e38\u7528\u5e94\u7528\u914d\u7f6e",h,function(a){!0===a&&QuickApps.update();q=!1},a)}})})(this,jQuery);(function(g,a){var e=null,b=function(){b=Util.noop;return Util.loadJs("frame/fui/js/widgets/appcenter/appcenter.js",function(){e=new AppCenterDialog({getDataUrl:ImacDataActionUrl.appCenterDataUrl,on:{show:function(){d.addClass("active")},hide:function(){d.removeClass("active")},installApp:function(a){var b=a.data;AppMgr.installApp(b.id,function(){e._afterInstallApp(b.id)})},uninstallApp:function(a){var b=a.data;AppMgr.uninstallApp(b.id,function(){this._afterUninstallApp(b.id)})}}});e.show()})},d=a("#imac-right-bar .q-btn.appstore");d.on("click",function(){e?e.show():b()})})(this,jQuery);