/*
 * @Author: chends
 * @Date: 2018-08-19 09:15:52
 * @LastEditors: jjj
 * @LastEditTime: 2018-09-12 19:05:20
 * @Description: 
 */

// 全局变量处理
(function(a,b){a._aideEvent_=new Util.UserEvent;var h=b("#cover-wrap");a.createMainContentCover=Util.browsers.isIE&&window.hasObjectTag?function(){var g=document.createElement("iframe");g.width="100%";g.height="100%";g.scrolling="no";g.frameBorder=0;g.style.background="transparent";g.src="../../activexcover/activexcover.html";return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').append(g).appendTo(h)}:function(){return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').appendTo(h)};a._getData_=function(b,d){return Util.ajax({url:epoint.dealRestfulUrl(getDataUrl+"/"+b),data:d})};var k=b("#main");a.dealLinkOpen=function(b,d){switch(b.openType){case "tabsnav":!d&&k.addClass("left-none");TabsNav.addTab(b);break;case "dialog":epoint.openTopDialog(b.name,Util.getRightUrl(b.url));break;case "blank":var c=b.id?(b.id+"").replace(/-/g,""):"";a.open(Util.getRightUrl(b.url),c)}};a._ANIMATION_TIME_={slide:200};a.useWebsocket=!0===Util.getFrameSysParam("useWebsocket");a.eWebSocket=void 0;a.creatWebSocket=function(b,d,c){if(eWebSocket)c&&c();else{var m=a.EWebSocketConfig?a.EWebSocketConfig:{url:EmsgConfig.websocketUrl};m.uid=b;m.uname=d;a.EWebSocket?(eWebSocket=new EWebSocket(m),c&&c(),_aideEvent_.fire("websocketCreated")):Util.loadJs("frame/fui/js/widgets/ewebsocket/ewebsocket.js",function(){eWebSocket=new EWebSocket(m);c&&c();_aideEvent_.fire("websocketCreated")})}};a.randomColor=function(b){return"#3391e5 #58cece #f16caa #7d9459 #298aae #58cece #ffce3d #fe5d58 #3391e5 #f16caa".split(" ")[b%10]};a.$activeLeftMenu=null;var e={};a.tab2leftManage=function(){function b(d,c){if(!(0>c)){var a=d.eq(c-1),g=a.find(".left-menu-sub-list:eq(0)");a.find("\x3e.left-menu-link").data("hassub")&&a.addClass("opened");g.stop(!0).slideDown(_ANIMATION_TIME_.slide,function(){slideDownCb.call(this);b(d,--c)});a.siblings(".opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").stop(!0).slideUp(_ANIMATION_TIME_.slide,slideUpCb)}}return{cache:function(b,c,a){e[b]={$target:c,$wrap:a}},deCache:function(b){b?e[b]=null:e={}},click:function(d){d=e[d];if(!d||!d.$wrap)return k.addClass("left-none");$activeLeftMenu=d.$wrap;k.removeClass("left-none");d.$wrap.removeClass("hidden").siblings().addClass("hidden");d.$wrap.find(".left-menu-link.active").removeClass("active");d.$target&&(d.$target.addClass("active"),d=d.$target.parents(".left-menu-item"),b(d,d.length))}}}();a.slideDownCb=function(){b(this).attr("style","display: block;")};a.slideUpCb=function(){b(this).attr("style","display: none;")};a.showEXun=!0;a._msgcenterConfig_=a.MsgCenterConfig||{}})(this,jQuery);(function(a,b){var h=function(){var a=b('\x3cli class\x3d"tabsnav-tabs-item"\x3e\x3c/li\x3e'),e=a.clone(!1),a=b('\x3cul class\x3d"hidden-accessible"\x3e\x3c/ul\x3e').append(a,e).appendTo("body"),e=e.outerWidth(!0);a.empty().remove();return e||115}();"[object Function]"===Object.prototype.toString.call(a.EpTabsNav)?(window.TabsNav=new EpTabsNav({ifrContainer:"#main-ifr-wrap",tabContainer:"#footer",needScrollBtn:!0,scrollBtnSite:"sides",smoothItems:3,needQuickNav:!0,position:"bottom",tabWidth:h}),TabsNav._$pageCover=createMainContentCover(),TabsNav.onTabActive=function(a){a&&(a=a.substr(4),b("#tab-"+a).length&&tab2leftManage.click(a))}):console.error('The TabsNav is required! , please add the "frame/fui/js/widgets/tabsnav/tabsnav.js" before theme\'s javascript file')})(this,jQuery);(function(a,b){function h(){e.removeClass("active");d.addClass("hidden")}var k=b("#sys-logo-img"),e=b("#user-info"),g=b(".user-portrait",e),d=createMainContentCover();e.on("click",".user-info-summary",function(){e.hasClass("active")?h():(e.addClass("active"),d.removeClass("hidden"))}).on("click",".user-action-item",function(){var c=b(this);if(c.hasClass("person-info"))dealLinkOpen({id:this.getAttribute("data-id"),name:this.getAttribute("data-name"),url:this.getAttribute("data-url"),openType:"tabsnav"});else if(c.hasClass("logout"))mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(b){"ok"==b&&(eWebSocket&&eWebSocket.close(),UserSettings.logout())});else if(c.hasClass("role-change"))UserSettings.changeRole(_userGuid_);else{var a=c.data("opentype"),g=c.data("id"),f=c.attr("url"),p=c.text(),n=c.attr("script");g||(g=Util.uuid(),c.data("id",g).attr("data-id",g));if(f)dealLinkOpen({id:g,openType:a,name:p,url:f});else if(n)try{eval(n)}catch(r){console.error(r)}}e.removeClass("active");d.addClass("hidden")});b("body").on("click",function(c){b(c.target).closest("#user-info").length||h()});_getData_("getUserInfo").done(function(c){a._userName_=c.name;a._userGuid_=c.guid;b.extend(a._msgcenterConfig_,{isMsgCenterMaxSize:c.isMsgCenterMaxSize||!1,msgCenterOrder:c.msgCenterOrder||"asc",hideCallback:function(){d.addClass("hidden")}});useWebsocket&&creatWebSocket(_userGuid_,_userName_);if(c.portrait){var m=Util.getRightUrl(epoint.dealRestfulUrl(c.portrait));g.attr("src",m)}c.hasParttime&&e.find(".user-action-item.role-change").removeClass("hidden");m=b("#user-info-detail");m.find(".user-name").text(c.name).attr("title",c.name);m.find(".user-dept").text(c.ouName).attr("title",c.ouName)});_getData_("getPageInfo").done(function(b){b.logo&&k.attr("src",Util.getRightUrl(b.logo));b.title&&(document.title=b.title,a.systemTitle=b.title);b.fullSearchUrl&&(a._fullSearchUrl_=b.fullSearchUrl);!1===b.showEXun&&(a.showEXun=!1);initPortal(b.homes,b.defaultHome);_aideEvent_.fire("afterPageInfo")});b(a).on("message",function(b){try{var c=JSON.parse(b.originalEvent.data);"userPortraitChange"===c.type&&g.attr("src",c.imgData)}catch(l){}});_getData_("getExtTabsInfo").done(function(c){if(c&&c.length){var a="";b.each(c,function(b,c){c.icon=c.icon||"modicon-8";/^icon-/.test(c.icon)&&(c.icon="action-icon "+c.icon);a+=Mustache.render('\x3cli class\x3d"user-action-item" title\x3d"{{name}}" url\x3d"{{url}}" data-opentype\x3d"{{openType}}" script\x3d"{{script}}"\x3e\x3cspan class\x3d"{{icon}}"\x3e\x3c/span\x3e{{name}}\x3c/li\x3e',c)});b(a).insertAfter("#person-info-setting")}})})(this,jQuery);(function(a,b){function h(g){function d(b){b?(c.addClass("active"),m.removeClass("hidden")):(c.removeClass("active"),m.addClass("hidden"))}var c=b("#top-portal-container"),m=createMainContentCover();c.on("click",".top-portal-header",function(){TabsNav.addTab(g)}).on("click",".top-portal-btn",function(){d(!c.hasClass("active"))}).on("click",".top-portal-item",function(){dealLinkOpen({url:this.getAttribute("data-url"),name:this.title,openType:this.getAttribute("data-opentype"),id:this.getAttribute("data-id")});d(!1)}).on("click",".top-portal-cate",function(){b(this).parent().toggleClass("collapse")});b("body").on("click",function(a){b(a.target).closest(c).length||d(!1)});var l,f=c.find(".top-portal");b(a).on("resize",function(){clearTimeout(l);l=setTimeout(function(){var b=e.height()-50;0<b&&f.css("max-height",b)},17)}).trigger("resize")}function k(a,d){var c=[];a&&(c.push('\x3cul class\x3d"top-portal-list"\x3e'),b.each(a,function(b,a){a.icon=a.icon||"default-modicon";c.push(Mustache.render('\x3cli class\x3d"top-portal-item" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"top-portal-icon {{icon}}"\x3e\x3c/span\x3e\x3cspan class\x3d"top-portal-name"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',a))}),c.push("\x3c/ul\x3e"));b.each(d,function(a,d){c.push('\x3cdiv class\x3d"top-portal-block"\x3e\x3ch3 class\x3d"top-portal-cate"\x3e'+d.name+'\x3cspan class\x3d"top-portal-cate-trigger"\x3e\x3c/span\x3e\x3c/h3\x3e\x3cul class\x3d"top-portal-list" style\x3d"max-height:'+30*d.items.length+'px"\x3e');b.each(d.items,function(b,a){a.icon=a.icon||"default-modicon";c.push(Mustache.render('\x3cli class\x3d"top-portal-item" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"top-portal-icon {{icon}}"\x3e\x3c/span\x3e\x3cspan class\x3d"top-portal-name"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',a))});c.push("\x3c/ul\x3e\x3c/div\x3e")});b(c.join("")).appendTo("#top-portal-content")}var e=b("#main");a.initPortal=function(a,d){for(var c={closeIcon:!1,refresh:!0},g=[],e=0;e<a.length;e++){var f=a[e],p=!1;void 0!=f.items?!p&&b.each(f.items,function(b,a){if(d){if(a.code==d)return c.id=a.code||"home",c.url=a.url,c.name=a.name,p=!0,!1}else if("tabsnav"==a.openType)return c.id=a.code||"home",c.url=a.url,c.name=a.name,p=!0,!1}):(p||(d?f.code==d&&(c.id=f.code||"home",c.url=f.url,c.name=f.name,p=!0):"tabsnav"==f.openType&&(c.id=f.code||"home",c.url=f.url,c.name=f.name,p=!0)),g=g.concat(a.splice(e,1)),e--)}k(g,a);h(c);TabsNav.addTab(c)}})(this,jQuery);(function(a,b){function h(b){b?(d.removeClass("hidden"),l.addClass("active"),m.addClass("active")):(l.removeClass("active"),m.removeClass("active"),d.addClass("hidden"),f.hasClass("in-sort")&&epoint.showTips("\u60a8\u7684\u5e94\u7528\u6392\u5e8f\u5c1a\u672a\u4fdd\u5b58\uff0c\u8bf7\u53ca\u65f6\u91cd\u65b0\u6253\u5f00\u8fdb\u884c\u4fdd\u5b58\uff01",{state:"warning"}))}function k(a,c){var d=[];b.each(a,function(b,a){a.icon=a.icon||"modicon-1";a.bg=a.iconBackColor||randomColor(b);d.push(Mustache.render(c,a))});return d.join("")}function e(){return _getData_("getQuickMenu",{showNum:10}).done(function(a){a&&a.length&&(Util.browsers.isIE8&&h(!0),b(k(a,'\x3cli class\x3d"quick-menu-item l" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"top-menu-icon {{icon}}" style\x3d"background:{{bg}};"\x3e\x3c/span\x3e\x3cspan class\x3d"topmenu-text"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e')).appendTo(p.empty()),Util.browsers.isIE8&&h(!1))})}var g=b("#main"),d=createMainContentCover(),c=b("#header"),m=b("#top-menu-panel"),l=b(".header-menu-btn",c);c.on("click",".header-menu-btn",function(){h(!b(this).hasClass("active"))});b("body").on("click",function(a){a=b(a.target);m.hasClass("active")&&(a.closest(l).length||a.closest(m).length||a.closest(".mini-panel-header").length||h(!1))});var f=b("#top-menu-list");f.on("click",".top-menu-item",function(){if(!f.hasClass("in-sort")){var a=b(this),c=a.data("url"),d=this.getAttribute("title")||this.innerText,e=a.data("opentype"),n=a.data("hassub");a.addClass("active").siblings().removeClass("active");n?(g.removeClass("left-none"),getLeftMenu({code:this.getAttribute("data-id"),name:this.getAttribute("title")||this.innerText,url:c,openType:e},!0)):g.addClass("left-none");c&&dealLinkOpen({openType:e,name:d,id:a.data("id"),url:c},!0);h(!1)}});(function(){_getData_("getMenu",{query:"top"}).done(function(a){if(a&&a.items){var c=a.code;c?b.each(a.items,function(b,a){if(a.code==c)return a.isActived=!0,!1}):a.items[0].isActived=!0;Util.browsers.isIE8&&h(!0);b(k(a.items,'\x3cli class\x3d"top-menu-item l {{#isActived}}active{{/isActived}}" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" data-hassub\x3d"{{hasSub}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"top-menu-icon {{icon}}" style\x3d"background:{{bg}};"\x3e\x3c/span\x3e\x3cspan class\x3d"topmenu-text"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e')).appendTo(f);Util.browsers.isIE8&&h(!1);_aideEvent_.fire("topMenuLoad");g.addClass("left-none")}})})();var p=b("#quick-menu-list");p.on("click",".quick-menu-item",function(){var a=b(this),c=a.data("url"),d=this.getAttribute("title")||this.innerText,f=a.data("opentype");c&&dealLinkOpen({openType:f,name:d,id:a.data("id"),url:c});h(!1)});e();var n="frame/fui/pages/quickmenusetting/quickmenusetting"+(/proto\.html/.test(location.pathname)?".proto.html":"");m.on("click",".quick-menu-btn",function(){var b={width:820,height:500},a=Util.getWinSize();a.height<b.height&&(b.height=a.height);a.width<b.width&&(b.width=a.width);epoint.openTopDialog("\u5e38\u7528\u83dc\u5355\u914d\u7f6e",n,function(b){!0===b&&e()},b)})})(this,jQuery);(function(a,b){function h(b){b?(d.addClass("in-sort"),d.sortable("enable"),c.find(".start").addClass("hidden").siblings().removeClass("hidden")):(d.sortable("disable"),d.removeClass("in-sort"),c.find(".start").removeClass("hidden").siblings().addClass("hidden"))}function k(){return d.sortable("toArray",{attribute:"data-id"})}function e(b){return Util.ajax({url:topMenuSaveUrl,data:{sort:JSON.stringify(b)}}).done(function(){mini.showTips({content:"\u4fdd\u5b58\u6210\u529f",state:"success",x:"center",y:"center",timeout:3E3});g=k()})}if(Util.getFrameSysParam("enableCustomSort")){var g,d=b("#top-menu-list"),c=b("#top-menu-btns");c.find(".start").removeClass("hidden");d.sortable({revert:200,delay:300,distance:30,forcePlaceholderSize:!0,containment:"parent",disabled:!0,tolerance:"pointer",update:function(){},stop:function(){},sort:function(){},start:function(){}});c.on("click",".start",function(){h(!0);mini.showTips({content:"\u62d6\u52a8\u83dc\u5355\u8fdb\u884c\u6392\u5e8f\u8c03\u6574\uff0c\u5b8c\u6210\u540e\u70b9\u51fb\u4fdd\u5b58",state:"info",x:"center",y:"center"})}).on("click",".save",function(){k().join("")!==g.join("")?e(k()).always(function(){h(!1)}):h(!1)}).on("click",".cancel",function(){h(!1);var a=d.children().remove();b.each(g,function(b,c){a.filter('[data-id\x3d"'+c+'"]').appendTo(d)})});_aideEvent_.on("topMenuLoad",function(){g=k()})}})(this,jQuery);(function(a,b){function h(a,c){var d="";b.each(a,function(a,f){f.hasSub=!(!f.items||!f.items.length);f.rowkey=void 0===c?a+"":c+"-"+a;var g=f.rowkey.split("-").length;f.isTop=1===g;f.level="level-"+g;var e;e=g||f.rowkey.split("-").length;e=2>e?0:22+14*(e-2);f.indent=e;f.isTop&&(f.bg=f.iconBackColor||randomColor(a));1===g&&(f.icon=f.icon||"modicon-1");d=f.hasSub?d+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-rowkey\x3d"{{rowkey}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} " style\x3d"background:{{bg}};"\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',b.extend(f,{subMenu:h(f.items,f.rowkey)})):d+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-rowkey\x3d"{{rowkey}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} " style\x3d"background:{{bg}};"\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',f)});return d}function k(a){if(l[a])return TabsNav.addTab(l[a]);var d=c.find("#left-menu-"+a),f="",g="";d.find(".left-menu-link").each(function(c,e){g=e.getAttribute("data-url");f=e.getAttribute("data-opentype");if(g&&"tabsnav"==f)return l[a]={id:e.getAttribute("data-id"),name:e.title,url:g},tab2leftManage.cache(a,b(e),d),b(e).trigger("click"),!1})}var e={},g=b("#main"),d=b("#left-menu"),c=d;(function(){d.on("click",".left-menu-link",function(){var a=b(this),c=a.parent(),d=c.hasClass("level-1"),g=a.data("hassub"),e={url:a.data("url"),openType:a.data("opentype"),name:this.title,id:a.data("id")};g&&(d=d?a.next().find(".left-menu-sub-list:eq(0)"):a.next(),c.hasClass("opened")?(c.removeClass("opened"),d.stop(!0).slideUp(_ANIMATION_TIME_.slide,slideUpCb)):(c.addClass("opened"),d.stop(!0).slideDown(_ANIMATION_TIME_.slide,slideDownCb),c.siblings(".opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").stop(!0).slideUp(_ANIMATION_TIME_.slide,slideUpCb)));e.url&&($activeLeftMenu.find(".left-menu-link.active").removeClass("active"),a.addClass("active"),"tabsnav"==e.openType&&tab2leftManage.cache(e.id,a,$activeLeftMenu),dealLinkOpen(e,!0))});b("body").on("click",".tabsnav-tabs-item, .tabsnav-quicknav-item",function(a){var c=this.getAttribute("data-id").substr(4);if(b(a.target).hasClass("tabsnav-tabs-close"))return tab2leftManage.deCache(c)})})();var m=!0;a.getLeftMenu=function(a,d){var f=a.code;if(!e[f]||"reject"===e[f])return _getData_("getMenu",{query:"sub",code:f}).done(function(l){l&&l.length?(l=h(l),$activeLeftMenu=b(Mustache.render('\x3cdiv class\x3d"left-menu-wrap" id\x3d"left-menu-{{code}}"\x3e\x3cdiv class\x3d"left-menu-header"\x3e{{name}}\x3c/div\x3e\x3cul class\x3d"left-menu-list"\x3e{{{leftMenuItems}}}\x3c/ul\x3e\x3c/div\x3e',{code:a.code,name:a.name,leftMenuItems:l})),$activeLeftMenu.appendTo(c).siblings(".left-menu-wrap").addClass("hidden"),l=$activeLeftMenu):l=void 0;e[f]="resolve";a.url&&"tabsnav"===a.openType?tab2leftManage.cache(f,null,l):d&&k(f+"");m&&(m=!1,g.removeClass("no-trans left-none"))}).fail(function(){e[f]="reject"});"resolve"===e[f]&&($activeLeftMenu=b("#left-menu-"+f),$activeLeftMenu.removeClass("hidden").siblings(".left-menu-wrap").addClass("hidden"),a.url&&"tabsnav"===a.openType||d&&k(f))};var l={}})(this,jQuery);(function(a,b){function h(){ThemeSelection._styleLoaded=!0;g=new ThemeSelection({getPagesUrl:getPagesUrl,savePageUrl:savePageUrl,showCallback:function(){e.removeClass("hidden")},hideCallback:function(){k.removeClass("active");e.addClass("hidden")}});window.themeSelection=g;k.on("click",function(){k.hasClass("active")?(k.removeClass("active"),g.hide()):(g.show(),k.addClass("active"))});b("body").on("click",function(a){b(a.target).closest(".theme-selection-container, #theme-skin-switch").length||(k.removeClass("active"),g.hide())})}var k=b("#theme-skin-switch"),e=createMainContentCover(),g;window.ThemeSelection?h():Util.loadJs("frame/fui/js/widgets/themeselection/themeselection.js",h)})(this,jQuery);(function(a,b){function h(){z=new EMsgList({content:D,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:function(){k()},onDecEmsgCount:G});a.RefreshEMsg=b.proxy(z.getData,z)}function k(){B.addClass("hidden");q.stop(!0).animate({right:-350},function(){q.addClass("hidden")});f.find("[data-ref].active").removeClass("active")}var e="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",g=0,d="",c={roll:function(){d=a.systemTitle||document.title;document.title=e;clearTimeout(g);g=setTimeout(function H(){document.title=e.substring(1,e.length)+e.substring(0,1);e=document.title;g=setTimeout(H,300)},300)},stop:function(){clearTimeout(g);document.title=d||document.title;e="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}},m=b("#msg-sound"),l=function(a){a=parseInt(a,10);return 99<a?"99+":0>=a?"":a+""},f=b("#header-action-btns"),p=b(".header-action-btn.chart",f),n=b(".remind-num",f),r=b(".emsg-num",f),q=b("#msg-panel"),u=b("#msgEMsg",q),y=b(".msg-panel-content",u),D=b(".emsg-recent-list",y),A=b(".online-user-num",u),v=document.getElementById("online-user"),w=b("#new-remind-wrap"),x={show:function(){RemindTipsCfg.show&&(w.removeClass("hidden"),this.autoHide())},autoHide:function(){return 0!=RemindTipsCfg.timeout?function(){clearTimeout(x.timer);x.timer=setTimeout(function(){w.addClass("hidden")},RemindTipsCfg.timeout)}:function(){}}(),initEvent:function(){if(RemindTipsCfg.show)w.on("click",".icon, .text",function(){w.addClass("hidden")}).on("click",".close",function(a){a.stopPropagation();w.addClass("hidden")})}};x.initEvent();var C=function(b){var c={haseXun:a.showEXun,needNum:!0};b&&(c.inCache=!0);return _getData_("getMsgCount",c).done(function(a){E(a)})},E=function(a){var b,d=!1;a.remind?(b=parseInt(n.data("num"),10)||0,a.remind>b&&(d=!0,x.show()),n.removeClass("hidden").text(l(a.remind)),n.data("num",a.remind)):n.text("").addClass("hidden");a.eXun?(b=parseInt(r.data("num"),10)||0,a.eXun>b&&(d=!0),r.removeClass("hidden").text(l(a.eXun)),r.data("num",a.eXun)):r.text("").addClass("hidden");var f=Util.getWinSize();b=f.height/2+75;f=f.width/2-150;a.systemUpdate&&(b=window.open("","","width\x3d300,height\x3d150,top\x3d"+b+",left\x3d"+f),b.document.write("\x3cp\x3e"+a.systemUpdate+"\x3c/p\x3e"),b.focus());d?(F(100),c.roll()):c.stop()};a.updateMsgTipCount=function(a){var b,d=!1;a.remind?(b=parseInt(n.data("num"),10)||0,a.remind>b&&(d=!0,x.show()),n.removeClass("hidden").text(l(a.remind)),n.data("num",a.remind)):n.text("").addClass("hidden");d?(F(100),c.roll()):c.stop()};var F=function(a,c,d){if(!1===Util.getFrameSysParam("messageSound"))return Util.noop;c=Util.getRightUrl(c);if(Util.browsers.isIE){var f=b('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden"\x3e\x3c/iframe\x3e').appendTo(a);return function(){f[0].src=c+"?_\x3d"+ +new Date}}var e=document.createElement("audio");e.src=Util.getRightUrl(d);e.className="hidden-accessible";a.append(e);var g=null;return function I(a){void 0===a&&(a=100);e.play()["catch"](function(){clearTimeout(g);0<a&&(g=setTimeout(function(){I(--a)},50))})}}(m,"../../msgsound/sound.html","../../msgsound/newsms.wav");_aideEvent_.on("afterPageInfo",function(){C(!0);useWebsocket||setInterval(function(){C(!0)},6E4);a.showEXun?J():p.addClass("hidden")});if(useWebsocket)_aideEvent_.on("websocketCreated",function(){eWebSocket.socketEvent.on("messagecount",function(a){E(a.data)})});a.getMessageCount=C;var G=function(){var a=r.text();a&&(a=parseInt(a,10)-1);0==a&&(a="",r.data("num",0).addClass("hidden"));r.text(a)},z,J=function(){a.EMsgList?h():Util.loadJs("frame/fui/js/widgets/emsglist/emsglist.js",function(){h()});a.OnlineUserSettings&&a.OnlineUserSettings.show&&(u.find(".msg-panel-head").addClass("tab").find(".panel-hd-tab.hidden").removeClass("hidden"),u.on("click",".panel-hd-tab",function(){var a=b(this),c=a.data("ref"),d=a.data("hasShow"),f=D;a.hasClass("active")||(a.addClass("active").siblings().removeClass("active"),c&&(f=b("#"+c,y),d||setTimeout(function(){OnlineUserSettings.onRefreshData(function(a){A.html(a)});a.data("hasShow",!0)},10)),f.removeClass("hidden").siblings().addClass("hidden"))}))};a.hideMessagePanel=k;var B=createMainContentCover(),t;a.messageCenter={refresh:function(){t&&t.refresh()},hide:function(){t&&t.hide()}};f.on("click","[data-ref]",function(){var c=b(this),d=c.data("ref"),f=b("#"+d,q);if(c.hasClass("active"))k(),B.addClass("hidden");else if(c.addClass("active").siblings(".active").removeClass("active"),"msgRemind"==d)t||(t=new MsgCenter(a._msgcenterConfig_)),t.show(),hideMessagePanel();else{if("msgEMsg"==d){if(z.getData(),a.OnlineUserSettings&&a.OnlineUserSettings.show)if(v.src)OnlineUserSettings.onRefreshData(function(a){A.html(a)});else v.src=OnlineUserSettings.url,v.attachEvent?v.attachEvent("onload",function(){OnlineUserSettings.onRefreshData(function(a){A.html(a)})}):v.onload=function(){OnlineUserSettings.onRefreshData(function(a){A.html(a)})}}else"msgSkin"==d&&a.initSkinView&&a.initSkinView();f.removeClass("hidden").siblings(".msg-panel-detail").addClass("hidden");f.find(".msg-panel-content").removeClass("hidden");q.removeClass("hidden");q.stop(!0).animate({right:0});B.removeClass("hidden")}});q.on("click",".msg-panel-hide",function(){k()});b("body").on("click",function(a){b(a.target).closest("#msg-panel , .header-action-btn[data-ref]").length||hideMessagePanel()})})(this,jQuery);(function(a,b){function h(){return Util.ajax({url:a._searchCfg.fullSearchCateUrl}).done(function(a){k(a.categories)})}function k(d){function c(a){if(Util.browsers.isIE||Util.browsers.isEdge)g[a?"addClass":"removeClass"]("show-overflow")}d=d||[];"string"==typeof d&&(d=JSON.parse(d));var h=[];b.each(d,function(a,b){h.push({id:b.guid,name:b.name,iconCls:b.icon||"view"})});h.length||h.push({id:"all",name:"\u5168\u6587\u68c0\u7d22",iconCls:"modicon-25"});ClassifySearch._styleLoaded=!0;ClassifySearch.CLASSIFICATION_TPL='\x3cdiv class\x3d"classify-search-classify-item {{#isActive}}active{{/isActive}}" data-id\x3d"{{id}}" data-title-tpl\x3d"\u4e0e${keyword}\u76f8\u5173\u7684{{name}}"\x3e\x3cspan class\x3d"classify-search-classify-icon {{iconCls}}"\x3e\x3c/span\x3e\u4e0e\x3cspan class\x3d"classify-search-classify-kw"\x3e\x3c/span\x3e\u76f8\u5173\u7684{{name}}\x3cspan class\x3d"classify-search-classify-target hidden"\x3e{{target}}\x3c/span\x3e\x3c/div\x3e';ClassifySearch._$pageCover=createMainContentCover();var l=new ClassifySearch({id:"header-search",searchTarget:"\u5185\u5bb9",category:h,placeholder:"\u8bf7\u8f93\u5165",maxShowCharacter:3,enter:function(c,d){var f;f=c||"all";try{TabsNav.removeTab("fullsearch")}catch(r){}dealLinkOpen({id:"fullsearch",name:"\u5168\u6587\u68c0\u7d22",url:a._fullSearchUrl_+"?wd\x3d"+a.encodeURI(d)+"\x26type\x3d"+f,openType:"tabsnav"});b("#header-search-container").removeClass("active")}});e(l);g.on("click",".header-search-btn",function(){c(!1);g.toggleClass("active").trigger("autoFocus")}).on("autoFocus",function(){Util.browsers.isSupportTransition||g.hasClass("active")&&l.$input.trigger("focus")});if(Util.browsers.isSupportTransition)g.on(Util.browsers.transitionend,function(a){a.target===this&&g.hasClass("active")&&(c(!0),l.$input.trigger("focus"))});if(Util.browsers.isSupportAnimation)l.$popup.on(Util.browsers.animationend,function(a){a.target!==this||l.$container.hasClass("popup")||(c(!1),g.removeClass("active"))});else l.$input.on("blur",function(){Util.browsers.isIE&&g.removeClass("show-overflow");g.removeClass("active")})}function e(a){function c(){var c=b.trim(a.$input.val());q&&q.abort();c&&(q=Util.ajax({url:epoint.dealRestfulUrl(_searchCfg.userModuleSearchUrl),data:{cnum:"user,module",key:c,rn:3,location:"search"}}),q.done(function(a){a=mini.decode(a.frameinfo);var d=[],e=[],h=new RegExp(c,"ig");a.users&&b.each(a.users,function(a,b){b.portrait=Util.getRightUrl(b.portrait);b.hlname=b.name.replace(h,'\x3cspan class\x3d"top-search-kw"\x3e'+c+"\x3c/span\x3e");d.push(Mustache.render(u,b))});a.modules&&b.each(a.modules,function(a,b){b.icon=b.icon||"modicon-1";b.hlname=b.name.replace(h,'\x3cspan class\x3d"top-search-kw" \x3e'+c+"\x3c/span\x3e");e.push(Mustache.render(y,b))});b(d.join("")).appendTo(f.empty());b(e.join("")).appendTo(g.empty())}))}var d=a.$classifyList.find('[data-id\x3d"user"]'),e=a.$classifyList.find('[data-id\x3d"module"]');if(d.length&&e.length){var f=b('\x3cul class\x3d"top-search-user-list"\x3e\x3c/ul\x3e'),g=b('\x3cul class\x3d"top-search-module-list"\x3e\x3c/ul\x3e');d.length&&(f.insertAfter(d),f.on("click",".top-search-user-item",function(){_searchCfg.userClick&&_searchCfg.userClick(this.getAttribute("data-id"),this.title);a.$input.blur().val("");a.hidePopup()}));e.length&&(g.insertAfter(e),g.on("click",".top-search-module-item",function(){var c=b(this);c.data("url")&&dealLinkOpen({id:c.data("id"),name:this.title,url:c.data("url"),openType:c.data("opentype")});a.$input.blur().val("");a.hidePopup()}));var h,k=[13,16,17,18,27,37,38,39,40];if("oninput"in document.createElement("input"))a.$input.on("input",function(){clearTimeout(h);h=setTimeout(c,50)});else a.$input.on("keyup",function(a){-1==b.inArray(a.which,k)&&(clearTimeout(h),h=setTimeout(c,50))});a.$input.on("setHistoryValue",c);var q,u='\x3cli class\x3d"top-search-user-item" data-id\x3d"{{guid}}" title\x3d"{{name}}" \x3e\x3cimg class\x3d"top-search-user-item-img" src\x3d"{{portrait}}" \x3e{{{hlname}}}\x3c/li\x3e',y='\x3cli class\x3d"top-search-module-item" data-id\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}" data-url\x3d"{{url}}"\x3e\x3cspan class\x3d"top-search-module-item-icon {{icon}}"\x3e\x3c/span\x3e{{{hlname}}}\x3c/li\x3e'}}var g=b("#header-search-container");_aideEvent_.on("afterPageInfo",function(){a._fullSearchUrl_&&h()})})(this,jQuery);window.OpenEMsg=function(a,b,h){window.eMsg?"undefined"===typeof b?eMsg.open(a):eMsg.openSession(a,b,h):creatWebSocket(_userGuid_,_userName_,function(){eWebSocket.openEmsg(a,b,h)})};(function(a,b){var h=b("#help-icon"),k=b("\x3cstyle\x3e.notice-remind-cover{position:absolute;top:0;right:0;bottom:0;left:0;background:#000;opacity:.4;filter:alpha(opacity\x3d40);z-index:9999}.notice-remind{position:absolute;top:50%;left:50%;width:630px;height:380px;margin-left:-315px;margin-top:-190px;border-radius:8px;background:#fff;z-index:10000}.notice-remind-hd{height:70px;line-height:70px;text-align:center;font-size:18px;font-weight:700;color:#4080f5}.notice-remind-history{position:absolute;width:60px;top:25px;right:40px;color:#9fb1d3;font-size:14px;line-height:22px;cursor:pointer}.notice-remind-bd{height:240px;margin:0 40px;overflow:auto}.notice-remind-btn{position:absolute;bottom:26px;left:50%;margin-left:-55px;width:110px;height:34px;border:0;background:#4080f5;color:#fff;border-radius:2px;cursor:pointer}.notice-remind-bd h1,.notice-remind-bd h2,.notice-remind-bd h3,.notice-remind-bd h4,.notice-remind-bd h5,.notice-remind-bd h6{position:relative;margin-top:1em;margin-bottom:16px;font-weight:bold;line-height:1.4}.notice-remind-bd h1 .octicon-link,.notice-remind-bd h2 .octicon-link,.notice-remind-bd h3 .octicon-link,.notice-remind-bd h4 .octicon-link,.notice-remind-bd h5 .octicon-link,.notice-remind-bd h6 .octicon-link{display:none;color:#000;vertical-align:middle}.notice-remind-bd h1:hover .anchor,.notice-remind-bd h2:hover .anchor,.notice-remind-bd h3:hover .anchor,.notice-remind-bd h4:hover .anchor,.notice-remind-bd h5:hover .anchor,.notice-remind-bd h6:hover .anchor{padding-left:8px;margin-left:-30px;text-decoration:none}.notice-remind-bd h1:hover .anchor .octicon-link,.notice-remind-bd h2:hover .anchor .octicon-link,.notice-remind-bd h3:hover .anchor .octicon-link,.notice-remind-bd h4:hover .anchor .octicon-link,.notice-remind-bd h5:hover .anchor .octicon-link,.notice-remind-bd h6:hover .anchor .octicon-link{display:inline-block}.notice-remind-bd h1{padding-bottom:.3em;font-size:2.25em;line-height:1.2;border-bottom:1px solid #eee}.notice-remind-bd h1 .anchor{line-height:1}.notice-remind-bd h2{padding-bottom:.3em;font-size:1.75em;line-height:1.225;border-bottom:1px solid #eee}.notice-remind-bd h2 .anchor{line-height:1}.notice-remind-bd h3{font-size:1.5em;line-height:1.43}.notice-remind-bd h3 .anchor{line-height:1.2}.notice-remind-bd h4{font-size:1.25em}.notice-remind-bd h4 .anchor{line-height:1.2}.notice-remind-bd h5{font-size:1em}.notice-remind-bd h5 .anchor{line-height:1.1}.notice-remind-bd h6{font-size:1em;color:#777}.notice-remind-bd h6 .anchor{line-height:1.1}.notice-remind-bd p,.notice-remind-bd blockquote,.notice-remind-bd ul,.notice-remind-bd ol,.notice-remind-bd dl,.notice-remind-bd table,.notice-remind-bd pre{margin-top:0;margin-bottom:16px}.notice-remind-bd ul,.notice-remind-bd ol{padding-left:2em}.notice-remind-bd ul ul,.notice-remind-bd ul ol,.notice-remind-bd ol ol,.notice-remind-bd ol ul{margin-top:0;margin-bottom:0}.notice-remind-bd li\x3ep{margin-top:16px}\x3c/style\x3e");$el=b('\x3cdiv class\x3d"notice-remind-cover"\x3e\x3c/div\x3e\x3cdiv class\x3d"notice-remind"\x3e\x3ch2 class\x3d"notice-remind-hd"\x3e\u66f4\u65b0\u516c\u544a\x3c/h2\x3e\x3cspan class\x3d"notice-remind-history"\x3e\u5386\u53f2\u516c\u544a\x3c/span\x3e\x3cdiv class\x3d"notice-remind-bd"\x3e\x3c/div\x3e\x3cbutton class\x3d"notice-remind-btn"\x3e\u6211\u77e5\u9053\u4e86\x3c/button\x3e\x3c/div\x3e');$content=b(".notice-remind-bd",$el);var e=function(){$el.on("click",".notice-remind-history",function(){NoticeRemindConfig.onHistoryClick&&NoticeRemindConfig.onHistoryClick();g()}).on("click",".notice-remind-btn",function(){g()})},g=function(){Util.ajax({url:NoticeRemindConfig.markToReadUrl,data:{cInfoGuid:d}});$el.off("click");$el.remove();k.remove();h.removeClass("new-info")},d="",c=function(){Util.ajax({url:NoticeRemindConfig.getUrl}).done(function(a){if(a.content){var c=a.content;k.appendTo("head");e();$content.html(c);b("body").append($el);d=a.cInfoGuid}})};a.NoticeRemindConfig&&function(){Util.ajax({url:NoticeRemindConfig.getCountUrl}).done(function(a){!1===a.isRead&&h.addClass("new-info")})}();h.on("click",function(){b(this).hasClass("new-info")?(c(),h.removeClass("new-info")):window.open(NoticeRemindConfig.pageUrl)})})(this,jQuery);