(function(A,c){function u(){var a=c(".wizard-item");c.each(a,function(){var a=c(this);a.hasClass("active")&&a.next().hasClass("done")&&!a.hasClass("has-active")&&a.addClass("has-active");a.hasClass("error")&&a.next().hasClass("done")&&!a.hasClass("has-error")&&a.addClass("has-error");a.hasClass("done")&&a.next().hasClass("default")?a.addClass("not-done"):a.removeClass("not-done");a.hasClass("active")&&v.animate({scrollLeft:a[0].offsetLeft-250})})}var B=c("#wizard-bar"),l=c("#wizard-nav");mini.parse(l[0]);var d,k=mini.getAndCreate(c(".next",l)[0]),m=mini.getAndCreate(c(".prev",l)[0]),n=mini.getAndCreate(c(".finish",l)[0]),w=c("#wizard-iframe"),C=Mustache,D=c.trim(c("#flow-item-templ").html()),r=c(".wizard-list",B),v=c(".wizard-list"),h=function(a){for(var b in a)"status"==b?"disabled"==a.status&&(this._disabled=1):this["_"+b]=a[b]};h._readyOnlyProps=["code","name","title"];var p;c.extend(h.prototype,{next:function(){return this.isLast()?null:f[this._index+1]},prev:function(){return this.isFirst()?null:f[this._index-1]},getIndex:function(){return this._index},isFirst:function(){return 0==this._index},isLast:function(){return this._index==h._length-1},disable:function(){this._disabled=1;p=d.eq(this._index);p.removeClass("default done active error").addClass("disabled")},enable:function(){this._disabled=0;p=d.eq(this._index);p.removeClass("disabled active default error").addClass("done")},isDisabled:function(){return!!this._disabled},getData:function(){return c.extend({},t[this._index])},setUrl:function(a){this._setData("url",a)},_setData:function(a,b){-1==c.inArray(a,h._readyOnlyProps)&&(this["_"+a]=b,t[this._index][a]=b)},_active:function(){var a=this._index;d.eq(a).removeClass("default done disabled error").addClass("active").siblings(".wizard-item").removeClass("active");w[0].src=Util.getRightUrl(this._url);e=a},_error:function(){var a=d.eq(this._index);a.removeClass("default active disabled done").addClass("error");Util.redrawPseudoEl(a[0])},_done:function(){d.eq(this._index).removeClass("default active disabled error").addClass("done")}});var f=[],t=[],e=null,E=function(a){var b=[];h._length=a.length;c.each(a,function(q,g){var d=c.extend({},g);d.index=q;d.title||(d.title=g.name);q==a.length-1&&(d.isLast=!0);null==e&&"active"==g.status&&(e=q);b.push(C.render(D,d));g.index=q;f.push(new h(g))});r.html(Util.clearHtml(b.join("")))},F=function(a){t=a;E(a);d=r.find(".wizard-item");WizardNav.onInit&&c.proxy(WizardNav.onInit,A,f[e])();w[0].src=Util.getRightUrl(a[e].url);x(e)},y=function(){m.enable();k.enable();k.show();n.hide()},x=function(a){a=f[a];y();(a.isFirst()||a.prev()._disabled)&&m.disable();a.isLast()&&(k.hide(),n.show())};n.on("click",function(){var a=WizardNav.onStepChange,b=f[e];a&&c.proxy(a,this,"over",b)()});k.on("click",function(){z(!0)});m.on("click",function(){z()});var z=function(a){var b=1,d=f[e],g=WizardNav.onStepChange;g&&(b=c.proxy(g,this,a?"next":"prev",d)());!1===b?d._error():(b=f[a?e+1:e-1],y(),(b.isFirst()||d._disabled&&a||b.prev()._disabled&&!a)&&m.disable(),b.isLast()&&(k.hide(),n.show()),d._disabled||d._done(),b._active(),u())};r.on("click",".done",function(a){a.preventDefault();var b=c(this);a=Util.toInt(b.data("index"));b.hasClass("disabled")||(b=f[a],f[e]._done(),b._active(),x(a),WizardNav.onFlowClick&&c.proxy(WizardNav.onFlowClick,this,b)(),u())});(function(){var a=c.extend({query:"init-wizard"},WizardNav.params);Util.ajax({type:"POST",dataType:"json",url:Util.getRightUrl(WizardNav.loadUrl),data:a,success:function(a){a&&a.length&&F(a);Util.loadJs("frame/frame/fui/js/widgets/jquery.nicescroll.min.js",function(){v.niceScroll({cursorcolor:"rgba(0,0,0,0)"})});WizardNav.onLoad&&WizardNav.onLoad()},error:Util._ajaxErr})})()})(this,jQuery);