(function(z,c){function t(){c.each(d,function(){var a=c(this);a.hasClass("active")&&a.next().hasClass("done")&&!a.hasClass("has-active")&&a.addClass("has-active");a.hasClass("error")&&a.next().hasClass("done")&&!a.hasClass("has-error")&&a.addClass("has-error");a.hasClass("done")&&a.next().hasClass("default")?a.addClass("not-done"):a.removeClass("not-done");a.hasClass("active")&&u.animate({scrollTop:a[0].offsetTop-80})})}var A=c("#wizard-bar"),l=c("#wizard-nav");mini.parse(l[0]);var d,k=mini.getAndCreate(c(".next",l)[0]),m=mini.getAndCreate(c(".prev",l)[0]),n=mini.getAndCreate(c(".finish",l)[0]),u=c(".wizard-list"),v=c("#wizard-iframe"),B=Mustache,C=c.trim(c("#flow-item-templ").html()),q=c(".wizard-list",A),h=function(a){for(var b in a)"status"==b?"disabled"==a.status&&(this._disabled=1):this["_"+b]=a[b]};h._readyOnlyProps=["code","name","title"];c.extend(h.prototype,{next:function(){return this.isLast()?null:f[this._index+1]},prev:function(){return this.isFirst()?null:f[this._index-1]},getIndex:function(){return this._index},isFirst:function(){return 0==this._index},isLast:function(){return this._index==h._length-1},disable:function(){this._disabled=1;$flow=d.eq(this._index);$flow.removeClass("default done active error").addClass("disabled")},enable:function(){this._disabled=0;$flow=d.eq(this._index);$flow.removeClass("disabled active default error").addClass("done")},isDisabled:function(){return!!this._disabled},getData:function(){return c.extend({},r[this._index])},setUrl:function(a){this._setData("url",a)},_setData:function(a,b){-1==c.inArray(a,h._readyOnlyProps)&&(this["_"+a]=b,r[this._index][a]=b)},_active:function(){var a=this._index;d.eq(a).removeClass("default done disabled error").addClass("active").siblings(".wizard-item").removeClass("active");v[0].src=Util.getRightUrl(this._url);e=a},_error:function(){d.eq(this._index).removeClass("default active disabled done").addClass("error")},_done:function(){d.eq(this._index).removeClass("default active disabled error").addClass("done")}});var f=[],r=[],e=null,D=function(a){var b=[];h._length=a.length;c.each(a,function(p,g){var d=c.extend({},g);d.index=p;d.title||(d.title=g.name);p==a.length-1&&(d.isLast=!0);null==e&&"active"==g.status&&(e=p);b.push(B.render(C,d));g.index=p;f.push(new h(g))});q.html(Util.clearHtml(b.join("")))},E=function(a){r=a;D(a);d=q.find(".wizard-item");WizardNav.onInit&&c.proxy(WizardNav.onInit,z,f[e])();v[0].src=Util.getRightUrl(a[e].url);w(e)},x=function(){m.enable();k.enable();k.show();n.hide()},w=function(a){a=f[a];x();(a.isFirst()||a.prev()._disabled)&&m.disable();a.isLast()&&(k.hide(),n.show())};n.on("click",function(){var a=WizardNav.onStepChange,b=f[e];a&&c.proxy(a,this,"over",b)()});k.on("click",function(){y(!0)});m.on("click",function(){y()});var y=function(a){var b=1,d=f[e],g=WizardNav.onStepChange;g&&(b=c.proxy(g,this,a?"next":"prev",d)());!1===b?d._error():(b=f[a?e+1:e-1],x(),(b.isFirst()||d._disabled&&a||b.prev()._disabled&&!a)&&m.disable(),b.isLast()&&(k.hide(),n.show()),d._disabled||d._done(),b._active(),t())};q.on("click",".done",function(a){a.preventDefault();var b=c(this);a=Util.toInt(b.data("index"));b.hasClass("disabled")||(b=f[a],f[e]._done(),b._active(),w(a),WizardNav.onFlowClick&&c.proxy(WizardNav.onFlowClick,this,b)(),t())});(function(){var a=c.extend({query:"init-wizard"},WizardNav.params);Util.ajax({type:"POST",dataType:"json",url:Util.getRightUrl(WizardNav.loadUrl),data:a,success:function(a){a&&a.length&&E(a);Util.loadJs("frame/frame/fui/js/widgets/jquery.nicescroll.min.js",function(){u.niceScroll({cursorcolor:"rgba(0,0,0,0)"})})},error:Util._ajaxErr})})()})(this,jQuery);