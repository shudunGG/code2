(function(g,e){function h(a){this.$container=e(a.container);this.getUrl=a.getUrl;this.ignoreUrl=a.ignoreUrl;this.afterOpenMsg=a.afterOpenMsg;this.afterIgnore=a.afterIgnore;this._bindEvent()}var l=Mustache,m=e.trim('\x3cdiv class\x3d"msg-category"data-code\x3d"{{remindType}}"\x3e\x3ch3 class\x3d"msg-category-head"data-url\x3d"{{url}}"data-title\x3d"{{name}}"data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"msg-category-title"title\x3d"{{name}}"\x3e{{{name}}} (\x3cspan class\x3d"msg-category-num"\x3e{{num}}\x3c/span\x3e)\x3c/span\x3e\x3ci class\x3d"msg-category-remove"title\x3d"\u5ffd\u7565\u5168\u90e8"\x3e\x3c/i\x3e\x3c/h3\x3e\x3cul class\x3d"msg-list"\x3e{{#items}}\x3cli class\x3d"msg-list-item {{#hasNew}}newmsg{{/hasNew}}"data-url\x3d"{{url}}"data-guid\x3d"{{guid}}"data-title\x3d"{{name}}"data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"msg-item-text"title\x3d"{{name}}"\x3e{{{name}}}\x3c/span\x3e\x3cspan class\x3d"msg-item-date"\x3e{{date}}\x3c/span\x3e\x3ci class\x3d"msg-item-ignore"title\x3d"\u5ffd\u7565"\x3e\x3c/i\x3e\x3c/li\x3e{{/items}}\x3c/ul\x3e\x3c/div\x3e'),n=function(a){a=parseInt(a);return 99<a?"99+":0>=a?"":a+""},k=function(a){"dialog"==a.openType?top.epoint.openDialog(a.name,a.url,function(){top.getMessageCount()}):"blank"==a.openType?g.open(Util.getRightUrl(a.url)):top.TabsNav.addTab({id:a.id,name:a.name,url:a.url})};h.prototype={_bindEvent:function(){var a=this;this.$container.on("click",".msg-category-title",function(){var b=e(this).parent(),c=b.data("title"),d=b.data("url"),f=b.parent().data("code"),b=b.data("opentype");k({id:f,name:c,url:d,openType:b});a.afterOpenMsg&&a.afterOpenMsg()}).on("click",".msg-category-remove",function(){var b=e(this).closest(".msg-category"),c=b.data("code"),b=b.children(".msg-category-head").data("title");a._ignoreAllDialogNotTip?a._ignoreRemind(c):a.showIgnoreAllDialog(b,c)}).on("click",".msg-list-item",function(){var b=e(this),c=b.data("title"),d=b.data("url"),f=b.data("guid"),b=b.data("opentype");d&&k({id:f,name:c,url:d,openType:b});a.afterOpenMsg&&a.afterOpenMsg()}).on("click",".msg-item-ignore",function(b){b.stopPropagation();var c=e(this).parent();b=c.data("guid");c=c.closest(".msg-category").data("code");a._ignoreRemind(c,b)})},_initMsgRemind:function(a){var b=[];a.length?(e.each(a,function(a,d){d.num=n(d.num);e.each(d.items,function(a,b){b.title=b.name.replace(/<[^>]+>/g,"")});b.push(l.render(m,d))}),e(Util.clearHtml(b.join(""))).appendTo(this.$container.empty().removeClass("empty"))):this.$container.empty().addClass("empty")},getData:function(){Util.ajax({url:this.getUrl}).done(e.proxy(this._initMsgRemind,this))},_ignoreRemind:function(a,b){b=b||"";var c=this,d={remindType:a};b&&(d.id=b);Util.ajax({url:this.ignoreUrl,data:d}).done(function(a){c.afterIgnore&&c.afterIgnore(a);c.getData()})},_ignoreAllDialogNotTip:!1,showIgnoreAllDialog:function(a,b){var c=this;mini.showMessageBox({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u5ffd\u7565 "+a+" \u4e0b\u7684\u6240\u6709\u672a\u8bfb\u6d88\u606f\uff1f",buttons:["ok","cancel"],iconCls:"mini-messagebox-question",showNoTipCheck:!0,clickNoTipCheck:function(a){c._ignoreAllDialogNotTip=a},callback:function(a){"ok"==a&&c._ignoreRemind(b)}})}};g.MessageList=h})(this,jQuery);