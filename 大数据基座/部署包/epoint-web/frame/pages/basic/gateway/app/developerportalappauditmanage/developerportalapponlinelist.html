<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>上架应用列表</title>
<script src="../../../../../fui/js/cssboot.js"></script>
<style type="text/css">
.btn-in-column {
	margin-right: 5px;
}

.btn-in-column-text {
	margin-left: 5px;
	margin-right: 5px;
}
</style>
</head>
<body>
	<div class="page-loading"></div>

	<!-- 条件区域 -->
	<div class="fui-condition">
		<div class="fui-form" id="fui-form">
			<div id="cform" role="form">
				<div role="row">
					<div role="control" label="应用名">
						<input id="search_appName" class="mini-textbox" bind="appName"
							onkeyenter="searchData();" />
					</div>
					<div role="control" label="申请人">
						<input id="search_linkManName" class="mini-textbox"
							bind="linkManName" onkeyenter="searchData();" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="上架时间">
						<div>
							<input id="search_onlineDateStart" bind="onlineDateStart"
								class="mini-datepicker" onvaluechanged='onDateStartValueChanged' />
							至 <input id="search_onlineDateFinsh" bind="onlineDateFinsh"
								class="mini-datepicker" onvaluechanged='onDateFinshValueChanged' />
						</div>
					</div>
				</div>
			</div>
		</div>
		<a role="searcher" callback="searchData"></a>
	</div>

	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="rowguid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			showPager="true" action="getDataGridData">
			<div property="columns">
				<div type="indexcolumn" width="40">序</div>
				<div field="appName" width="150">应用名称</div>
				<div field="companyName" width="100%">企业名称</div>
				<div field="linkManName" width="150">申请人</div>
				<div field="submitTime" renderer="onTimeRender" width="150">创建时间</div>
				<div field="releaseTime" renderer="onTimeRender" width="150">上架时间</div>
				<div name="operation" renderer="onOperationRender" width="200">操作</div>
			</div>
		</div>
	</div>

	<script src="../../../../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[

		//初始化页面
		epoint.initPage('developerportalapponlinelistaction');

		// 表格对象
		var grid = mini.get("datagrid");

		// 格式化提交时间列
		function onTimeRender(e) {

			var time = e.value;

			time = new Date(time);

			// 格式化时间
			var year = time.getFullYear();
			var month = time.getMonth() + 1;
			month = fixZero(month);
			var date = time.getDate();
			date = fixZero(date);
			var hours = time.getHours();
			hours = fixZero(hours);
			var minutes = time.getMinutes();
			minutes = fixZero(minutes);
			var seconds = time.getSeconds();
			seconds = fixZero(seconds);

			return year + '-' + month + '-' + date + ' ' + hours + ':'
					+ minutes + ':' + seconds;
		}

		function fixZero(data, range) {
			if (data < 10) {
				data = '0' + data;
			}
			return data;
		}

		// 绘制操作按钮
		function onOperationRender(e) {
			var appGuid = e.row['rowguid'];

			// 下架
			var removeHtml = '<a class="mini-button btn-in-column" state="danger" id="btnNotPass" onclick="removeApp(\''
					+ appGuid
					+ '\');"><div class="btn-in-column-text">下架</div></a>';
			// 查看详情
			var forDetailHtml = '<a class="mini-button btn-in-column" id="btnDetail" onclick="toDetail(\''
					+ appGuid
					+ '\');"><div class="btn-in-column-text">查看详情</div></a>';

			var renderHtml = '<div>' + removeHtml + forDetailHtml + '</div>';
			return renderHtml;
		}

		// 下架
		function removeApp(appGuid) {

			epoint
					.openDialog(
							"输入下架理由",
							'frame/pages/basic/gateway/app/developerportalappauditmanage/developerportalinputreason',
							function(rtnValue) {
								if (rtnValue != 'close') {
									epoint.execute('removeApp', '', [ appGuid,
											rtnValue ], removeAppCallBack);
								}
							}, {
								'width' : 350,
								'height' : 260
							});

		}

		// 下架回调
		function removeAppCallBack(data) {
			var msg = data.msg;
			if (msg) {

				if (data.success) {
					epoint.showTips(msg, {
						timeout : 1000
					});
					epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
				} else {
					epoint.alert(msg, '', '', 'warning');
				}
			} else {
				epoint.alert('操作失败', '', '', 'warning');
			}
		}

		// 查看详情
		function toDetail(appGuid) {
			epoint
					.openDialog(
							"应用详情",
							'frame/pages/basic/gateway/app/developerportalappauditmanage/developerportalappedit?rowguid='
									+ appGuid + '&showMode=detail',
							detailCallBack, {
								'width' : 1000,
								'height' : 580
							});
		}

		// 查看详情回调
		function detailCallBack(param) {
			if (param) {
				epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
			}
		}

		// 起始日期选择器值改变
		function onDateStartValueChanged(e) {
			// 设置截止日期选择器的日期最小值
			mini.get('search_onlineDateFinsh').minDate = this.getFormValue();
			// 设置截止日期选择器的下拉默认显示值
			mini.get('search_onlineDateFinsh').viewDate = this.getFormValue();
		}

		// 截止日期选择器值改变
		function onDateFinshValueChanged(e) {
			// 设置开始日期选择器的日期最大值
			mini.get('search_onlineDateStart').maxDate = this.getFormValue();
		}

		// 搜索条件状态清除
		function onCloseClick(e) {
			var obj = e.sender;
			obj.setText("");
			obj.setValue("");
		}

		// 搜索
		function searchData() {
			// 设置截止时间为所选时间的23点59分59秒
			if (mini.get('search_onlineDateFinsh').getValue() != "") {
				mini.get('search_onlineDateFinsh').getValue().setHours(23);
				mini.get('search_onlineDateFinsh').getValue().setMinutes(59);
				mini.get('search_onlineDateFinsh').getValue().setSeconds(59);
				mini.get('search_onlineDateFinsh').getValue().setMilliseconds(
						999);
			}
			epoint.refresh([ 'datagrid', 'fui-form' ]);
		}
		//]]>
	</script>


</body>
</html>