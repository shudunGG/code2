<!DOCTYPE html>
<html>

<head>
<title>订阅系统参数配置</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<!-- 请修改相对路径 -->
<script src="../../../../../fui/js/cssboot.js"></script>
<style type="text/css">
p {
	margin-left: 16px;
	margin-right: 16px;
}
</style>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar" id="toolbar1">
		<a class="mini-button" onclick="openSelect" state="primary">选择参数</a><a
			class="mini-button" id="add" onclick="showAtPos">直接添加</a> <a
			class="mini-button" onclick="epoint.closeDialog">关闭</a>
		<!--帮助按钮 -->
		<a role="helper" class="mr10" showtype="tooltip">查看帮助</a>
	</div>
	<!-- 帮助信息区域 默认隐藏-->
	<div class="fui-notice hidden">
		<p>可直接通过输入系统参数名字添加订阅关系</p>
	</div>
	<div class="fui-content">
		<!-- 表单布局 -->
		<div class="fui-form" id="fui-form">
			<div id="datagrid" class="mini-datagrid" idField="rowguid"
				action="getDataGridData" sortOrder="desc" showPager="true"
				style="height: 428px;" allowResize="true" multiSelect="true">
				<div property="columns">
					<div type="indexcolumn" width="20" headerAlign="left" align="left">序</div>
					<div field="configname" headerAlign="left" align="left">系统参数名称</div>
					<div width="50" align="left" headerAlign="left"
						renderer="onDelRenderer">删除</div>
				</div>
			</div>
		</div>
	</div>

	<div id="win1" class="mini-window" title="直接订阅"
		style="width: 600px; height: 150px;" showShadow="true"
		showModal="false" allowDrag="true">
		<div class="fui-form" id="fui-form2">
			<div role="row">
				<div role="control" label="系统参数名">
					<input class="mini-textbox mr10" id="frameConfigName" width="300" />
					<a class="mini-button" onclick="subscribeConfig" width="80"
						state="primary">直接订阅</a>
				</div>
			</div>
		</div>
	</div>

	<!-- 请修改相对路径 -->
	<script src="../../../../../../rest/resource/jsboot"></script>
	<script>
		// 初始化页面
		epoint.initPage('subscribeframeconfigaction', null, null);

		function subscribeConfig() {
			var frameConfigName = mini.get("frameConfigName").getValue();
			if (frameConfigName == '') {
				epoint.showTips("请填写系统参数名称", {
					state : 'warning'
				});
				return;
			} else if (frameConfigName.length > 50) {
				epoint.showTips("输入字数不能超过50", {
					state : 'warning'
				});
				return;
			} else {
				epoint.execute('subscribeConfig', '', frameConfigName,
						function(data) {
							var msg = data.msg;
							if (msg) {
								if (data.success) {
									mini.get("win1").hide();
									mini.get("frameConfigName").setValue("");
									epoint.showTips(data.msg, {
										state : 'success'
									});
									epoint.refresh([ 'datagrid', 'fui-form' ],
											'', true);
								} else {
									epoint.showTips(msg, {
										state : 'warning'
									});
								}
							}
						});
			}
		}

		function showAtPos() {
			var win = mini.get("win1");
			win.showAtPos('center', 'middle');
		}

		// 关闭操作的回调
		function callback(data) {
			var msg = data.msg;
			if (msg) {
				if (data.success) {
					epoint.showTips(data.msg, {
						state : 'success'
					});
					epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
				} else {
					epoint.showTips(data.msg, {
						state : 'warning'
					});
				}
			}
		}

		// 绘制行删除按钮
		var onDelRenderer = function(e) {
			return epoint.renderCell(e, "action-icon icon-remove",
					"deleteRelation", "rowguid");
		};

		// 删除一行数据
		function deleteRelation(rowguid) {
			// 弹出确认框
			epoint.confirm("确定删除订阅吗?", '', function() {
				epoint.execute("delete", '', [ rowguid ], callback);
			});
		}

		function openSelect() {
			epoint.openDialog('系统参数订阅',
					'frame/pages/basic/gateway/app/appinfomanage/selectframeconfig?appguid='
							+ Util.getUrlParams('appguid'), function(param) {
						if (param && param != "close") {
							epoint.showTips(param, {
								state : 'success'
							});
						}
						epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
					}, {
						'width' : 1000,
						'height' : 550
					});
		}
	</script>
</body>
</html>