!function(exports,controlMap){"use strict";function extend(t,e,i){var n=function(){};if(n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t["super"]=e.prototype,i)for(var o in i)t.prototype[o]=i[o]}function register(t,e){controlMap[e]=t}var getControlClazz=function(t){var e,i=t.className,n=i.match(/ep-mui-\w*/g);return n.length>0&&(e=controlMap[n[0]]),e||console.warn("没有对应的控件类型",t),e},MControl=function(t){this.el=t;var e=t.id;e||(e=epm.generateId(),t.id=e),this.id=e,this._init()};MControl.prototype={constructor:MControl,_init:function(){},value:"",getValue:function(){return this.value?this.value:this.el.value},setValue:function(t){this.value=t,void 0!==this.el.value?this.el.value=t:this.el.innerText=t},getModule:function(){return{id:this.id}},getAttribute:function(t){return this.el.getAttribute(t)},render:function(t){"string"==typeof t&&(t="#body"==t?document.body:document.getElementById(t)),t&&(t.appendChild(this.el),this.el.id=this.id)}};var TextBox=function(t){TextBox["super"].constructor.call(this,t)};extend(TextBox,MControl,{type:"textbox",_init:function(){this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action");var t=this;this.el.addEventListener("input",function(e){t.value=t.el.value})},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,action:this.action,value:this.value}}}),register(TextBox,"ep-mui-textbox");var TextArea=function(t){TextArea["super"].constructor.call(this,t)};extend(TextArea,MControl,{type:"textarea",_init:function(){this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action");var t=this;this.el.addEventListener("input",function(){t.value=t.el.value})},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,action:this.action,value:this.value}}}),register(TextArea,"ep-mui-textarea");var SearchBar=function(t){SearchBar["super"].constructor.call(this,t)};extend(SearchBar,MControl,{type:"searchbar",_init:function(){this.bind=this.getAttribute("bind");var t=this.getAttribute("onSearch"),e=this;this.el.addEventListener("change",function(i){e.value=e.el.value,window[t]&&"function"==typeof window[t]&&window[t](e.value)})},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,value:this.value}}}),register(SearchBar,"ep-mui-searchbar");var WebUploader=function(t){WebUploader["super"].constructor.call(this,t)};extend(WebUploader,MControl,{type:"webuploader",_init:function(){this.action=this.getAttribute("action"),this.isMulti=this.getAttribute("isMulti")||!1,this.mapClass=this.getAttribute("mapClass")||"com.epoint.basic.faces.fileupload.WebUploader",this.tplId=this.getAttribute("tplId"),this.isMulti=epm.parseJSON(this.isMulti),this.content=this.el.querySelector(".webuploader-content-items"),this.imgUrl=this.getAttribute("imgUrl")||"./images/icon_file/",this.mimeType=this.getAttribute("mimeType");var t=this.getAttribute("limitType");t&&t.length>0&&(t=t.split(",")),this.tplId?this.tpl=document.getElementById(this.tplId).innerHTML:this.tpl='<div class="uploader-item l" data-attachfilename="{{attachFileName}}" data-preview-src data-attachguid="{{attachGuid}}" data-attachlength="{{attachLength}}" data-downloadurl=“{{downloadUrl}}” data-readonly="{{readonly}}"><img src="{{icon}}" class="thumbnail" onerror="this.src=\'"{{imgUrl}}"img_default.png\'" alt=""><em class="upload-delete">一</em><p>{{attachFileName}}</p></div>',this.input=this._createInput();var e=this;this.el.querySelector(".icon-upload").addEventListener("tap",function(){e.input.click()}),this.input.addEventListener("change",function(){for(var i=this.files,n=e.onGetRequestData(),o=0,r=i.length;o<r;o++){var a=i[o],s=new FormData,l=e.id,u=a.name,c=e.getFileSuffix(u);Array.isArray(t)&&t.length>0&&t.indexOf(c)!==-1?Util.ejs.ui.toast("文件："+u+" 禁止上传"):(e.filetype=a.type,s.append("id",l),s.append("name",u),s.append("type",a.type),s.append("size",a.size),s.append("lastModifiedDate",a.lastModifiedDate),s.append("file",a),n&&s.append("commonDto",n.commonDto),s.append("".concat(l,"_action"),"upload"),s.append("".concat(l,"_fileCount"),i.length),s.append("".concat(l,"_fileLoadedCount"),"0"),e._upload(s))}}),mui(this.el).on("tap",".upload-delete",function(){var t=this.parentElement,i=t.dataset;e._delete({attachFileName:i.attachfilename,attachGuid:i.attachguid,attachLength:i.attachlength,downloadUrl:i.downloadurl,readonly:i.readonly})}).on("tap",".thumbnail",function(){})},_upload:function(t){var e=this;Util.ajax({url:e.url,data:t,type:"post",processData:!1,contentType:!1,beforeSend:function(t){console.log("准备上传","before"),Util.ejs.ui.showWaiting();var e=epm.getCookie("_CSRFCOOKIE");e&&t.setRequestHeader("CSRFCOOKIE",e)},success:function(t){var i=t.controls,n=i[0],o=epm.getSecondRequestData(t).data,r=e.el.querySelector(".webuploader-filelist");i&&(o?(o.filetype=e.filetype,r.innerHTML+=Mustache.render(tpl,o)):n.uploadFailed&&Util.ejs.ui.toast(n.failedMsg))},error:function(t,e){Util.ejs.ui.toast("上传失败"),console.error(t,e)},complete:function(){Util.ejs.ui.closeWaiting()}})},_delete:function(t){var e=this.onGetRequestData(),i=this;Util.ajax({url:i.url,data:{commonDto:e.commonDto,"cs-inner_action":"delete","cs-inner_attachGuid":t.attachGuid},type:"post",beforeSend:function(t){console.log("准备删除文件","before"),Util.ejs.ui.showWaiting();var e=epm.getCookie("_CSRFCOOKIE");e&&t.setRequestHeader("CSRFCOOKIE",e)},success:function(e){document.querySelector('.uploader-item[data-attachguid="'+t.attachGuid+'"]').remove()},error:function(t,e){Util.ejs.ui.toast("删除文件失败"),console.error(t,e)},complete:function(){Util.ejs.ui.closeWaiting()}})},setUrl:function(t){this.url=t},_createInput:function(){var t=document.createElement("input"),e=this.mimeType;return t.type="file",e&&(t.accept=e),this.isMulti&&(t.multiple="multiple"),t},setData:function(t){var e=t.files,i=this;Array.isArray(e)&&e.length>0&&(e=e.reverse(),i.insertNode(e))},insertNode:function(t){var e=this.tpl,i="",n=this,o=n.getFileIcon,r=this.content,a=this.imgUrl;Array.isArray(t)&&t.length>0?$.each(t,function(t,n){n.icon=a+o(n.attachFileName),n.imgUrl=a,i+=Mustache.render(e,n)}):(t.icon=a+o(t.attachFileName),t.imgUrl=a,i=Mustache.render(e,t)),r.insertAdjacentHTML("afterbegin",i),r.style.width=104*r.children.length+"px"},getFileIcon:function(t){var e=t.split(".");return e=e[e.length-1],"img_"+e+".png"},getFileSuffix:function(t){return t.substring(t.lastIndexOf(".")+1)},getModule:function(){return{id:this.id,type:this.type,mapClass:this.mapClass,action:this.action}}}),register(WebUploader,"ep-mui-webuploader");var SelectContact=function(t){SelectContact["super"].constructor.call(this,t)};extend(SelectContact,MControl,{type:"treeselect-non-nested",_init:function(){var t=this;this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action"),this.isouonly=epm.parseJSON(this.getAttribute("isouonly"))||!1,this.action&&(this.url=epm.getRightUrl(epm.dealUrl(this.action,!0))),this.value="",this.text="",this.el.addEventListener("tap",function(){var e=null,i=null,n=[];t.value&&t.text&&(e=t.value.split(","),i=t.value.split(",")),$.each(e,function(t,e){n.push({userguid:e,username:i[t]})}),ejs.util.invokePluginApi({path:"workplatform.provider.openNewPage",dataMap:{method:"goSelectPerson",selectedusers:n,issingle:0,isouonly:t.isouonly?1:0},f9action:t.action,f9userdata:t.data,f9controlid:t.id,success:function(e){var i="",n="";t.value="",t.text="",t.el.innerHTML="",t.isouonly?e.ouData.forEach(function(t,e){i+=t.ouguid+",",n+=t.ouname+","}):e.resultData.forEach(function(t,e){i+=t.userguid+",",n+=t.username+","}),t.value=epm.delsemiforstring(i,","),t.setText(epm.delsemiforstring(n,","))}})})},setData:function(t){this.data=t},setValue:function(t){this.value=t},setText:function(t){var e=t.split(","),i="",n=this;e.length>=1&&e[0]?(e.forEach(function(t){i+=Mustache.render(n._templ,{username:t})}),n.el.innerHTML=i):n.el.innerHTML="请选择人员",this.text=t},_templ:'<span class="mui-badge mui-badge-primary mr10">{{username}}</span>',getModule:function(){return{id:this.id,url:this.url,type:this.type,action:this.action,idField:"id",textField:"text",imgField:"img",iconField:"iconCls",parentField:"pid",valueField:"id",pinyinField:"tag",value:this.value,text:this.text}}}),register(SelectContact,"ep-mui-selectcontact");var TreeSelect=function(t){TreeSelect["super"].constructor.call(this,t)};extend(TreeSelect,MControl,{type:"treeselect-non-nested",_init:function(){this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action"),this.treeTpl=this.getAttribute("treetpl")||"./tree.tpl",this.multiselect=eval(this.getAttribute("multiselect")),this.confirmCallback=this.getAttribute("confirmcallback"),this.insertText=this.getAttribute("inserttext"),this.url=this.getAttribute("url"),"string"==typeof this.insertText?this.insertText=eval(this.insertText):this.insertText=!0,this.url?this.url=epm.getRightUrl(epm.dealUrl(this.url)):this.url=epm.getRightUrl(epm.dealUrl(this.action)),this.rootName=this.getAttribute("rootname")||"根";var self=this;this.multiselect?(this._dirTempl=['<div class="mui-input-row mui-checkbox mui-left tree-con-item dir" data-id="{{id}}" data-text="{{text}}" data-issubnode="{{isSubNode}}">',"  <span>{{text}}</span>",'  <input name="checkbox" {{#cls}}class="hidden"{{/cls}} type="checkbox" {{#checked}}checked{{/checked}} />',"</div>"].join(""),this._templ=['<div class="mui-input-row mui-checkbox mui-left tree-con-item tree-item-node" data-id="{{id}}" data-text="{{text}}" data-issubnode="{{isSubNode}}">',"  <label>{{text}}</label>",'  <input name="checkbox" type="checkbox" {{#checked}}checked{{/checked}} />',"</div>"].join("")):(this._dirTempl=['<div class="mui-input-row mui-radio mui-left tree-con-item dir" data-id="{{id}}" data-text="{{text}}" data-issubnode="{{isSubNode}}">',"  <span>{{text}}</span>",'  <input {{#cls}}class="hidden"{{/cls}} name="radio" type="radio" {{#checked}}checked{{/checked}} />',"</div>"].join(""),this._templ=['<div class="mui-input-row mui-radio mui-left tree-con-item tree-item-node" data-id="{{id}}" data-text="{{text}}" data-issubnode="{{isSubNode}}">',"  <label>{{text}}</label>",'  <input name="radio" type="radio" {{#checked}}checked{{/checked}} />',"</div>"].join("")),this._breadcrumbsTempl='<a class="tree-breadcrumbs-item" data-id="{{nodeId}}">{{breadcrumbsName}}</a>',this.el.addEventListener("tap",function(){$(self.container).find(".tree-breadcrumbs-items").html(Mustache.render(self._breadcrumbsTempl,{breadcrumbsName:self.rootName,nodeId:""})),self.showTree(),self._render(self.initData),window.history.pushState({},"","#treeselect")}),window.onpopstate=function(t){self.hideTree()}},showTree:function(){$(this.container).removeClass("hidden")},hideTree:function(){$.each($(".epm-tree-container"),function(t,e){e.classList.add("hidden")})},_createTreeContainer:function(){var t=document.createElement("div");t.id="epm-tree-"+epm.generateId(),t.className="hidden epm-tree-container",document.body.appendChild(t),this.container=t,this.loadTemplate()},loadTemplate:function(){var t=this.container,e=this;$(t).load(this.treeTpl,function(){mui(".mui-scroll-wrapper").scroll({scrollY:!1,scrollX:!0}),e._bindTreeListener()})},_bindTreeListener:function(){var t=$(this.container).find(".tree-breadcrumbs-items"),e=this;$(this.container).on("tap",".tree-con-item",function(){var i=$(this),n=i.data("issubnode"),o=i.data("id"),r=i.data("text"),a=e.multiselect;if(n=Boolean(n),i.hasClass("dir")){var s=i.find("input").prop("checked");setTimeout(function(){var n=i.find("input").prop("checked"),l=!1;s==n?(t.html(t.html()+Mustache.render(e._breadcrumbsTempl,{breadcrumbsName:r,nodeId:o})),e.getTreeData(o,n,l)):a?(l=!0,e.getTreeData(o,n,l)):(e.value=o,e.text=r)},50)}else if(e.value.length>=1&&a)if(e.value.indexOf(o)!==-1){var l=e.value.split(","),u=e.text.split(","),c=l.indexOf(o);l.splice(c,1),u.splice(c,1),e.value=l.join(","),e.text=u.join(",")}else e.value+=","+o,e.text+=","+r;else e.value=o,e.text=r}).on("tap",".tree-confirm",function(){e.setText(e.text),e.setValue(e.value),e.hideTree();var t=e.confirmCallback,i=window[t];i&&"function"==typeof i&&i()}),t.on("tap",".tree-breadcrumbs-item",function(){var t=$(this),i=t.data("id");t.next().get(0)&&(i?e.getTreeData(i,!1):e._render(e.initData),e._removeNextSiblings(this))})},getTreeData:function(t,e,i){for(var n=this.data,o=this,r=0,a=n.length;r<a;r++){var s=n[r];if(s.id===t){s.checked=e,this.node=s;break}}Util.ajax({url:epm.isMock?this.action:this.url,type:"post",dataType:"json",contentType:"application/x-www-form-urlencoded;charset=UTF-8",data:this.onGetRequestData(i),beforeSend:function(){ejs.ui.showWaiting()},success:function(t){var e=t.controls[0],i=e.data;i&&Array.isArray(i)&&i.length>=1&&(o._render(i),o.data=o.data.concat(i))},error:function(t){console.error(t),console.error("获取下拉树失败")},complete:function(){ejs.ui.closeWaiting()}})},_render:function(t){var e="",i="",n=this,o=n.value;$.each(t,function(t,r){r.cls=r.ckr?"":"hidden",r.checked=o.indexOf(r.id)!==-1,r.isLeaf?i+=Mustache.render(n._templ,r):e+=Mustache.render(n._dirTempl,r)}),$(this.container).find(".tree-con-items").html(e+i)},_renderBreadcrumbs:function(t){var e=$(this.container).find(".tree-breadcrumbs-item"),i=this;if(e&&e.length>=1)for(var n=0,o=e.length;n<o;n++){var r=e[n];if(r.textContent==t){i._removeNextSiblings(r);break}}},_removeNextSiblings:function(t){var e=$(t),i=e.next();i.get(0)&&(i.remove(),this._removeNextSiblings(t))},setValue:function(t){this.value=t},setText:function(t){this.text=t;var e=this.el;if(this.insertText){var i=e.tagName;"INPUT"===i||"TEXTAREA"===i?e.value=t:e.innerHTML=t}},setData:function(t){this.data=JSON.parse(JSON.stringify(t)),this.initData=JSON.parse(JSON.stringify(t)),this._createTreeContainer()},getModule:function(){return{id:this.id,bind:this.bind,url:this.url,type:this.type,action:this.action,idField:"id",textField:"text",imgField:"img",iconField:"iconCls",parentField:"pid",valueField:"id",pinyinField:"tag",value:this.value,text:this.text,node:this.node}}}),register(TreeSelect,"ep-mui-treeselect");var DatePicker=function(t){DatePicker["super"].constructor.call(this,t)};extend(DatePicker,MControl,{_init:function(){var t=this.getAttribute("data-options")||"{}",e=epm.parseJSON(t);e.beginDate&&(e.beginDate=new Date(e.beginDate)),e.endDate&&(e.endDate=new Date(e.endDate)),this.format=e.format||this.getAttribute("format")||"yyyy-MM-dd",this.bind=this.getAttribute("bind");var i=this;this.el.addEventListener("tap",function(){var t=new mui.DtPicker(e);t.show(function(e){i.setValue(e.text),t.dispose()})},!1)},type:"datepicker",getModule:function(){return{id:this.id,type:this.type,bind:this.bind,format:this.format,value:this.value}}}),register(DatePicker,"ep-mui-datepicker");var ComboBox=function(t){ComboBox["super"].constructor.call(this,t)};extend(ComboBox,MControl,{type:"combobox",_init:function(){var t=this.getAttribute("data"),e=this.getAttribute("onchange");this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action");var i=this;t&&(t=epm.parseJSON(t),this.data=t),this.el.addEventListener("tap",function(t){ejs.ui.popPicker({layer:1,data:i.data,success:function(t){var n=t.items[0],o=n.text,r=n.value;window[e]&&"function"==typeof window[e]?(window[e](o,r,i),i.text=o,i.value=r):(i.setValue(r),i.setText(o))},error:function(t){}})},!1)},getText:function(){return this.text},setValue:function(t){this.value=t},setText:function(t){var e=this.el.tagName;"INPUT"==e||"TEXTAREA"==e?this.el.value=t:this.el.innerHTML=t,this.text=t},setData:function(t){var e=[],i=this.value,n=this;Array.isArray(t)&&t.forEach(function(t,o){var r=t.text,a=t.id;i==a&&n.setText(r),e.push({text:r,value:a})}),this.data=e},getValue:function(){return this.value},getData:function(){return this.data},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,action:this.action,value:this.value,text:this.text,textField:"text",valueField:"id",pinyinField:"tag",columns:[]}}}),register(ComboBox,"ep-mui-combobox");var RadioButtonList=function(t){RadioButtonList["super"].constructor.call(this,t)};extend(RadioButtonList,MControl,{type:"radiobuttonlist",_init:function(){var t=this.getAttribute("data");this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action"),t&&(t=epm.parseJSON(t),this.setData(t))},_templ:'<div class="mui-input-row mui-radio"><label>{{text}}</label><input type="radio" name="{{name}}" value="{{value}}" {{#checked}}checked="checked"{{/checked}}></div>',setData:function(t){for(var e=[],i=this.value,n=0,o=t.length;n<o;n++)i&&i===t[n].value&&(t[n].checked=!0),t[n].name=this.id,e.push(Mustache.render(this._templ,t[n]));this.el.innerHTML=e.join(""),this.radios=mui('input[type="radio"]',this.el);var r=this;this.radios.each(function(t,e){e.addEventListener("change",function(t){r.value=t.target.value})})},setValue:function(t){this.value=t;var e=this;setTimeout(function(){if(e.radios)for(var i=e.radios,n=0,o=i.length;n<o;n++)if(i[n].value==t){i[n].checked=!0;break}},200)},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,action:this.action,value:this.value}}}),register(RadioButtonList,"ep-mui-radiobuttonlist");var CheckboxList=function(t){CheckboxList["super"].constructor.call(this,t)};extend(CheckboxList,RadioButtonList,{type:"checkboxlist",_templ:'<div class="mui-input-row mui-checkbox"><label>{{text}}</label><input name="checkbox" value="{{value}}" {{#checked}}checked="checked"{{/checked}} type="checkbox"></div>',setData:function(t){var e=[],i=this.value;i&&(i=","+i+",");for(var n=0,o=t.length;n<o;n++)i&&i.indexOf(","+t[n].value+",")>-1&&(t[n].checked=!0),e.push(Mustache.render(this._templ,t[n]));this.el.innerHTML=e.join(""),this.checkboxs=mui('input[type="checkbox"]',this.el);var r=this;this.checkboxs.each(function(t,e){e.addEventListener("change",function(t){var e,i=t.target;i.checked?(r.value&&(r.value+=","),r.value+=i.value):(e=","+r.value+",",e=e.replace(","+i.value+",",","),r.value=e.substr(1,e.length-2))})})},setValue:function(t){this.value=t,t=","+t+",";var e=this;setTimeout(function(){if(e.checkboxs)for(var i=e.checkboxs,n=0,o=i.length;n<o;n++)t.indexOf(i[n].value)>-1&&(i[n].checked=!0)},200)}}),register(CheckboxList,"ep-mui-checkboxlist");var Hidden=function(t){Hidden["super"].constructor.call(this,t)};extend(Hidden,MControl,{type:"hidden",_init:function(){this.bind=this.getAttribute("bind")},setValue:function(t){this.value=t},getModule:function(){return{id:this.id,bind:this.bind,type:this.type,value:this.value}}}),register(Hidden,"ep-mui-hidden");var OutputText=function(t){OutputText["super"].constructor.call(this,t)};extend(OutputText,MControl,{type:"outputtext",_init:function(){this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action"),this.options=this.getAttribute("data-options"),this.options&&(this.options=epm.parseJSON(this.options))},setValue:function(t){this.value=t,this.el.innerHTML=t},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,action:this.action,dataOptions:this.options}}}),register(OutputText,"ep-mui-outputtext");var SubTable=function(t){SubTable["super"].constructor.call(this,t)};extend(SubTable,MControl,{type:"subtable",_init:function(){return this.bind=this.getAttribute("bind"),this.tplId=this.getAttribute("tplId"),this.action=this.getAttribute("action"),this.tplId?void(this.template=document.getElementById(this.tplId).innerHTML):void Util.ejs.ui.toast("子表控件id: "+this.id+"未设置 tplId 属性")},setData:function(t){var e=this.template,i="";"string"==typeof e&&t.forEach(function(t){i+=Mustache.render(e,t)}),this.el.innerHTML=i},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,action:this.action,dataOptions:this.options}}}),register(SubTable,"ep-mui-subtable");var List=function(t){List["super"].constructor.call(this,t)};extend(List,MControl,{type:"datagrid",_init:function(){var t=this.getAttribute("fields"),e=this.getAttribute("onitemrender"),i=this.getAttribute("onitemclick");this.action=this.getAttribute("action"),this.url=this.getAttribute("url"),this.pageSize=parseInt(this.getAttribute("pageSize")),this.defaultPage=parseInt(this.getAttribute("defaultPage"))||0,this.extraId=this.getAttribute("extraId"),this.idField=this.getAttribute("idField"),this.tplId=this.getAttribute("tplId")||"",this.requestType=this.getAttribute("requesttype")||"post",this.columns=[];var n=document.getElementById(this.tplId);if(n&&(this.template=n.innerHTML),t){t=t.split(",");for(var o=0,r=t.length;o<r;o++)this.columns.push({fieldName:t[o]})}e&&"function"==typeof window[e]&&(this.onItemRender=window[e]);var a=this;if(i&&"function"==typeof window[i]?this.onItemClick=window[i]:window.addEventListener("DOMContentLoaded",function(){i&&"function"==typeof window[i]&&(a.onItemClick=window[i])}),this.el.innerHTML="",this.pageSize>0){var s=epm.closest(this.el,"mui-scroll-wrapper");s||(s=mui(".mui-content")[0],s&&s.classList.add("mui-scroll-wrapper")),s.id||(s.id=epm.generateId("pullrefresh")),this.scrollId=s.id;var l=document.createElement("div");l.className="mui-scroll",this.el.parentNode.replaceChild(l,this.el),l.appendChild(this.el),this.initPullRefresh()}},setData:function(t,e,i){var n,o=[],r=this.el.parentNode.querySelectorAll("#"+this.id+" > li").length,a=i&&i.controls&&i.controls[0].total||0;if(0===a||r!=a){for(var s=0,l=t.length;s<l;s++)this.onItemRender?(t[s].extras=JSON.stringify(t[s]),n=this.onItemRender.call(this,t[s])):(t[s].extras=JSON.stringify(t[s]),n=Mustache.render(this.template,t[s])),e?o.push(n):this.el.innerHTML+=n;if(e){var u=this;u.el.innerHTML=o.join("")}}},setTotal:function(t){this.total=t},setUrl:function(t){this.url=t,this.pullToRefresh&&(this.pullToRefresh.options.url=t)},initPullRefresh:function(){var t=this,e=function(e){t.pageIndex=e;var i={};return t.onGetRequestData&&(i=t.onGetRequestData()),i},i=function(t){return t=epm.getSecondRequestData(t)},n=function(e,i,n){var o=e.total;e=e.data,t.setTotal(o),t.setData(e,i,n),o<=t.pageSize*(t.pageIndex+1)&&(t.pullToRefresh.isShouldNoMoreData=!1)},o=function(e){t.onItemClick&&t.onItemClick.call(this,e,this.id,JSON.parse(this.getAttribute("extras")))},r=function(){t.pullToRefresh=new PullToRefreshTools.bizlogic({isDebug:!0,type:t.requestType,url:t.url||t.action,initPageIndex:t.defaultPage||0,template:t.template,dataRequest:e,itemClick:o,dataChange:i,success:n,isAutoRender:!1,contentType:"application/x-www-form-urlencoded",container:"#"+t.scrollId,listContainer:"#"+t.id,setting:{up:{auto:!1}}})};window.PullToRefreshTools?r():Util.loadJs([Config.bizRootPath+"js/widgets/pulltorefresh/pulltorefresh.skin.default.js",Config.bizRootPath+"js/widgets/pulltorefresh/pulltorefresh.skin.css"],Config.bizRootPath+"js/widgets/pulltorefresh/pulltorefresh.bizlogic.impl.js",r)},refresh:function(){this.el.innerHTML="",this.pullToRefresh.refresh()},getModule:function(){var t={id:this.id,type:this.type,action:this.action,columns:this.columns,idField:this.idField,isSecondRequest:!1};return this.pageSize>0&&(t.pageSize=this.pageSize,t.pageIndex=this.pageIndex),t}}),register(List,"ep-mui-list"),exports.extend=extend,exports.register=register,exports.control=MControl,exports.init=function(t){for(var e,i,n=document.querySelectorAll('[class*="ep-mui-"]'),o=0,r=n.length;o<r;o++)e=getControlClazz(n[o]),e&&(i=new e(n[o]),epm.set(i.id,i),t&&t(i))}}(window.MControl={},window.controlMap={}),function(win,$){var dio=new function(){var t=[],e=null,i=!!{}.hasOwnProperty,n=function(t,e){var i=r[e];return i?i:(i=e.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))},o=function(r,l){if(null===r)return void(t[t.length]="null");var u=typeof r;if("undefined"==u)return void(t[t.length]="null");if(r.push){t[t.length]="[";var c,d,h,p=r.length;for(d=0;d<p;d+=1)h=r[d],u=typeof h,"undefined"==u||"function"==u||"unknown"==u||(c&&(t[t.length]=","),o(h),c=!0);return void(t[t.length]="]")}{if(!r.getFullYear){if("string"==u)return a.test(r)?(t[t.length]='"',t[t.length]=r.replace(s,n),void(t[t.length]='"')):void(t[t.length]='"'+r+'"');if("number"==u)return void(t[t.length]=r);if("boolean"==u)return void(t[t.length]=String(r));t[t.length]="{";var c,d,h;for(d in r)i&&!Object.prototype.hasOwnProperty.call(r,d)||(h=r[d],u=typeof h,"undefined"==u||"function"==u||"unknown"==u||(c&&(t[t.length]=","),o(d),t[t.length]=":",o(h,d),c=!0));return void(t[t.length]="}")}if(e)t[t.length]='"',"function"==typeof e?t[t.length]=e(r,l):t[t.length]=mini.formatDate(r,e),t[t.length]='"';else{var f;t[t.length]='"',t[t.length]=r.getFullYear(),t[t.length]="-",f=r.getMonth()+1,t[t.length]=f<10?"0"+f:f,t[t.length]="-",f=r.getDate(),t[t.length]=f<10?"0"+f:f,t[t.length]="T",f=r.getHours(),t[t.length]=f<10?"0"+f:f,t[t.length]=":",f=r.getMinutes(),t[t.length]=f<10?"0"+f:f,t[t.length]=":",f=r.getSeconds(),t[t.length]=f<10?"0"+f:f,t[t.length]='"'}}},r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},a=/["\\\x00-\x1f]/,s=/([\x00-\x1f\\"])/g;this.encode=function(){return function(i,n){return t=[],e=n,o(i),e=null,t.join("")}}(),this.decode=function(){var t=/^(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2}(?:\.*\d*)?)Z*$/,e=new RegExp("^/+Date\\((-?[0-9]+).*\\)/+$","g"),i=/[\"\'](\d{4})-(\d{1,2})-(\d{1,2})[T ](\d{1,2}):(\d{1,2}):(\d{1,2})(\.*\d*)[\"\']/g;return function(n,o){function r(t){return o!==!1&&(t=t.replace(__js_dateRegEx,"$1new Date($2)"),t=t.replace(i,"new Date($1,$2-1,$3,$4,$5,$6)"),t=t.replace(__js_dateRegEx2,"new Date($1)")),window.eval("("+t+")")}if(""===n||null===n||void 0===n)return n;"object"==typeof n&&(n=this.encode(n));var a=null;if(window.JSON&&window.JSON.parse){var s=function(i,n){if("string"==typeof n&&o!==!1){t.lastIndex=0;var r=t.exec(n);if(r)return n=new Date(r[1],r[2]-1,r[3],r[4],r[5],r[6]);e.lastIndex=0;var r=e.exec(n);if(r)return n=new Date(parseInt(r[1]))}return n};try{var l=n.replace(__js_dateRegEx,'$1"/Date($2)/"');a=window.JSON.parse(l,s)}catch(u){a=r(n)}}else a=r(n);return a}}()},epm={components:{},idIndex:0,generateId:function(t){return(t||"epm-")+this.idIndex++},get:function(t){return epm.components[t]||null},set:function(t,e){epm.components[t]=e},encodeJson:function(t){return JSON.stringify(t)},decodeJson:function(t){return JSON.parse(t)},encodeUtf8:function(t){var e=escape(t),i=e.split("%"),n="",o=epm.Hex2Utf8,r=epm.Str2Hex;""!==i[0]&&(n=i[0]);for(var a=1;a<i.length;a++)"u"==i[a].substring(0,1)?(n+=o(r(i[a].substring(1,5))),i[a].length>5&&(n+=i[a].substring(5))):n+="%"+i[a];return n},Hex2Utf8:function(s){var retS="",tempS="",ss="",Dig2Dec=epm.Dig2Dec;if(16==s.length){tempS="1110"+s.substring(0,4),tempS+="10"+s.substring(4,10),tempS+="10"+s.substring(10,16);for(var sss="0123456789ABCDEF",i=0;i<3;i++)retS+="%",ss=tempS.substring(8*i,8*(eval(i)+1)),retS+=sss.charAt(Dig2Dec(ss.substring(0,4))),retS+=sss.charAt(Dig2Dec(ss.substring(4,8)));return retS}return""},Str2Hex:function(s){for(var c="",n,ss="0123456789ABCDEF",digS="",Dec2Dig=epm.Dec2Dig,i=0;i<s.length;i++)c=s.charAt(i),n=ss.indexOf(c),digS+=Dec2Dig(eval(n));return digS},Dig2Dec:function(s){var retV=0;if(4==s.length){for(var i=0;i<4;i++)retV+=eval(s.charAt(i))*Math.pow(2,3-i);return retV}return-1},Dec2Dig:function(t){for(var e="",i=0,n=0;n<4;n++)i=Math.pow(2,3-n),t>=i?(e+="1",t-=i):e+="0";return e},dealUrl:function(t,e){t.indexOf(".")!=-1&&t.indexOf(".jspx")==-1&&(epm.isRestFul?t=t.replace(".","/"):t.indexOf("cmd=")<0&&(t=t.replace(".",".action?cmd=")));var i=window.location.href,n=i.indexOf("?"),o=t.indexOf("?")>-1;return n!=-1?(t+=o?"&"+i.substring(n+1):"?"+i.substring(n+1),e&&(t+="&isCommondto=true")):e&&(t+=o?"&isCommondto=true":"?isCommondto=true"),t=epm.getRightUrl("rest/"+t)},encode:dio.encode,decode:dio.decode,mask:$.createMask(),showMask:function(){this.mask.show()},hideMask:function(){this.mask.close()},getSecondRequestData:function(t){var e=t.status;if(e){var i=parseInt(e.code),n=e.text,o=e.url;if(i>=300)return void(o?win.location.href=this.getRightUrl(o):$.alert(n,"提示","我知道了"))}if(t.controls){var r=t.controls.length,a=t.controls[r-1];console.log("viewData"),console.log(a),"_common_hidden_viewdata"==a.id&&(epm.get("_common_hidden_viewdata")||this.createHiddenView(a),epm.get("_common_hidden_viewdata").setValue(a.value)),t=t.controls[0]}return t},createHiddenView:function(t){var e=epm.get("_common_hidden_viewdata");if(e)return void e.setValue(t.value);var i=document.createElement("input");i.id="_common_hidden_viewdata",i.type="hidden",i.className="ep-mui-hidden",e=new controlMap["ep-mui-hidden"](i),e.setValue(t.value),e.render("#body"),epm.set(e.id,e)},getRootPath:function(){var t=window.location,e=t.hostname,i=t.protocol,n=t.port?":"+t.port:"",o=(void 0!==window._rootPath?_rootPath:"/"+t.pathname.split("/")[1])+"/",r=i+"//"+e+n+o;return r},getRightUrl:function(t){if(!t)return"";var e=t.indexOf("./")!=-1||t.indexOf("../")!=-1;return t=/^(http|https|ftp)/g.test(t)||e?t:this.getRootPath()+t},_pageLoagding:$("body>.page-loading"),hidePageLoading:function(){this._pageLoagding&&this._pageLoagding.length&&(document.body.removeChild(this._pageLoagding[0]),this._pageLoagding=void 0)},delsemiforstring:function(t,e){e=e||";";var i=new RegExp(e+"$");return t.replace(i,"")},parseJSON:function(str){return eval("("+str+")")},closest:function(t,e){if(t&&e){var i=t.parentNode,n=i.className;return(" "+n+" ").indexOf(" "+e+" ")>=0?i:"BODY"===i.tagName?void 0:this.closest(i,e)}},getCookie:function(t){var e,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(i))?unescape(e[2]):null},extend:function(){var t,e,i,n,o,r,a=arguments[0]||{},s=1,l=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[s]||{},s++),"object"==typeof a||exports.isFunction(a)||(a={}),s===l&&(a=this,s--);s<l;s++)if(null!=(t=arguments[s]))for(e in t)i=a[e],n=t[e],a!==n&&(u&&n&&(exports.isPlainObject(n)||(o=exports.isArray(n)))?(o?(o=!1,r=i&&exports.isArray(i)?i:[]):r=i&&exports.isPlainObject(i)?i:{},a[e]=epm.extend(u,r,n)):void 0!==n&&(a[e]=n));return a},appendHtmlChildCustom:function(t,e){if("string"==typeof t&&(t=document.querySelector(t)),null!=t&&null!=e&&t instanceof HTMLElement)if(e instanceof HTMLElement)t.appendChild(e);else{var i=exports.pareseStringToHtml(e);null!=i&&t.appendChild(i)}},getChildElemLength:function(t){return t instanceof HTMLElement?t.children.length:0},isUseConfig:window.Config&&window.Config.comdto&&window.Config.comdto.isUseConfig,isRestFul:window.Config&&window.Config.comdto&&window.Config.comdto.isRestFul,isMock:window.Config&&window.Config.comdto&&window.Config.comdto.isMock,requestMethod:window.Config&&window.Config.comdto&&window.Config.comdto.requestMethod||"post"};epm.isUseConfig&&(epm.getRootPath=function(){return window.Config.comdto.rootUrl}),win.epm=epm}(window,window.mui),function(){"use strict";Util.loadJs(Config.bizRootPath+"js/utils/util.string.js"),function(){MControl.init(function(t){var e=t.type;"datagrid"!=e&&"webuploader"!=e&&"treeselect-non-nested"!=e||(t.onGetRequestData=function(t){var i=null;if(i=new CommonDto(this.id).getData(!0),("datagrid"==e||"treeselect-non-nested"==e&&!t)&&(i[0].isSecondRequest=!0),t&&(i[0].eventType="checkedchanged"),this.extraId)for(var n=this.extraId.split(","),o=0;o<n.length;o++)i=i.concat(new CommonDto(n[o]).getData(!0));return{commonDto:JSON.stringify(i)}})});var extendAttr=function(t,e){for(var i in e)e[i]&&(t[i]=e[i])},CommonDto=function(t,e,i,n){function o(t){var e=mui("#"+t);return e[0]&&/ep-mui-\w*/g.test(e[0].className)?e:mui('[class*="ep-mui-"]',e)}this.controls={},this.action=e,this.initHook=i;var r,a,s=this,l=[];if("@none"!=t)if(t&&"@all"!==t)if(Array.isArray(t))for(r=0,a=t.length;r<a;r++)l=l.concat(o(t[r]));else l=l.concat(o(t));else l=mui('[class*="ep-mui-"]');for(r=0,a=l.length;r<a;r++){var u=l[r],c=epm.get(u.id);c&&(s.controls[c.id]=c,n&&c.action&&c.setUrl&&c.setUrl(epm.dealUrl(this.action+"."+c.action)))}};CommonDto.prototype={constructor:CommonDto,getData:function(t){var e,i,n,o,r=[];for(var a in this.controls)e=this.controls[a],i=e.getModule(),n=e.getAttribute("data-options"),n&&(i.dataOptions=epm.parseJSON(n)),r.push(i),"_common_hidden_viewdata"==a&&(o=e);return o||(o=epm.get("_common_hidden_viewdata"),
o?r.push(o.getModule()):r.push({id:"_common_hidden_viewdata",type:"hidden",value:""})),t?r:{commonDto:JSON.stringify(r)}},setData:function(t,e){for(var i,n,o,r=0,a=t.length;r<a;r++)o=t[r],i=o.id,n=this.controls[i],"_common_hidden_viewdata"===i&&this.createHiddenView(o),n&&(void 0!==o.value&&n.setValue&&n.setValue(o.value),void 0!==o.text&&n.setText&&n.setText(o.text),o.data&&n.setData&&(n.setData(o.data),o.total&&n.setTotal&&n.setTotal(o.total)),this.initHook&&this.initHook.call(this,n,o,e))},createHiddenView:function(t){var e=epm.get("_common_hidden_viewdata");if(e)return void e.setValue(t.value);var i=document.createElement("input");i.id="_common_hidden_viewdata",i.type="hidden",i.className="ep-mui-hidden",e=new controlMap["ep-mui-hidden"](i),e.setValue(t.value),e.render("#body"),epm.set(e.id,e)},init:function(t){var e=this,i=this.getData();t.params&&(i.cmdParams=t.params),t.notShowLoading||epm.showMask(),i=Util.encryptAjaxParams(t.url,i),Util.ajax({url:t.url,type:epm.requestMethod,dataType:"json",contentType:"application/x-www-form-urlencoded;charset=UTF-8",data:i,beforeSend:function(t){var e=epm.getCookie("_CSRFCOOKIE");e&&t.setRequestHeader("CSRFCOOKIE",e)},success:function(i){i[Util.BODY_ENCRYPT_PARAM_NAME]&&(i=Util.decrypt(i[Util.BODY_ENCRYPT_PARAM_NAME]),i=epm.decode(i));var n=i.status,o=i.controls,r=i.custom||"",a=parseInt(n.code),s=n.text,l=n.url;if(0==a){if(l)return l=epm.getRightUrl(l),void Util.ejs.ui.alert("错误:"+JSON.stringify(n));t.fail?t.fail.call(e,s,n):Util.ejs.alert(s,"提示","我知道了")}else 1==a&&(o.length&&e.setData(o,r),t.done&&t.done.call(e,r))},complete:function(){t.notShowLoading||epm.hideMask()}})}};var epointm={initPage:function(t,e,i,n,o){var r;"object"==typeof n&&void 0===o&&(o=n,n=void 0),o=o||{},"function"==typeof o?(r=o,o={}):r=o.initHook;var a=t.split("?"),s=a[0],l=a[1],u=s.indexOf("."),c=u>0?s.substr(0,u):s;this.getCache("action")||(this.setCache("action",c),this.setCache("urlParam",l),this.setCache("callback",i)),epm.isMock||(u<0&&(s+=".page_Load"),t=s+(l?"?"+l:""));var d={};e&&e.constructor===Object&&(d=e,e=void 0),d.pageUrl=window.location.href,d=JSON.stringify(d);var h=o.initControl;void 0===h&&(h=!0);var p=new CommonDto(e,c,r,h);p.init({url:epm.isMock?t:epm.dealUrl(t,!0),method:o.method,params:d,done:function(t){i&&i.call(this,t),window.epoint_afterInit&&window.epoint_afterInit(t),epm.hidePageLoading()},fail:n})},refresh:function(t,e){var i=this.getCache("action")+".page_Refresh",n=this.getCache("urlParam");n&&(i+="?"+n),"function"==typeof t&&(e=t,t="@all"),e=e||this.getCache("callback"),this.initPage(i,t,e,{initControl:!1})},execute:function(t,e,i,n,o){var r,a=t.indexOf(".");epm.isMock||(a<0?(r=this.getCache("action"),t=r+"."+t):r=t.substr(0,a));var s=new CommonDto(e,r);"function"==typeof i&&(n=i,i=null),this.validate(s.controls)&&s.init({url:epm.isMock?t:epm.dealUrl(t,!0),params:i?"string"==typeof i?i:epm.encode(i):null,done:n,notShowLoading:o})},validate:function(controls){var vtypes=["email","url","int","float","phone","mobile","tel","postCode","orgCode","idCard"],vtypesErrMsg={email:function(t){return(t||"")+"请输入一个有效的电子邮件地址"},url:function(t){return(t||"")+"请输入一个有效的URL"},"int":function(t){return(t||"")+"请输入一个整数"},"float":function(t){return(t||"")+"请输入一个有效号码"},phone:function(){return"输入的电话号码格式不正确"},mobile:function(){return"输入的手机号码格式不正确"},tel:function(){return"输入的固定电话号码格式不正确"},postCode:function(){return"输入的邮政编码格式不正确"},orgCode:function(){return"输入的组织机构代码格式不正确"},idCard:function(){return"输入的身份证号码格式不正确"}};for(var key in controls){var el=controls[key].el,vtype=el.getAttribute("vtype"),regExp=el.getAttribute("regExp"),maxthenId=el.getAttribute("maxthen"),minthenId=el.getAttribute("minthen"),value=el.value;if(el.required&&""===value){var text=($(el).parent().attr("label")||$(el).parent().text()||$(el).parent().prev().text()).replace(/[:: ]$/,"");return Util.ejs.ui.toast(el.getAttribute("requiredErrorText")||text+"不能为空"),!1}if(vtype&&vtypes.indexOf(vtype)!==-1){var type="is"+vtype.charAt(0).toUpperCase()+vtype.slice(1);if(!Util.string[type](value))return"email"==vtype||"url"==vtype||"int"==vtype||"float"==vtype?Util.ejs.ui.toast(vtypesErrMsg[vtype](el.previousElementSibling.innerHTML)):Util.ejs.ui.toast(vtypesErrMsg[vtype]()),!1}if(regExp&&""!==regExp){try{regExp=eval(regExp)}catch(error){throw new Error(el.id+"自定义正则解析出错")}if(value.length>=1&&!regExp.test(value))return Util.ejs.ui.toast(el.getAttribute("regExpErrText")),!1}if(maxthenId){var res=this.compare(maxthenId,el,">",function(t,e){return e+"不能大于"+t});if(!res)return!1}if(minthenId){var res=this.compare(minthenId,el,"<",function(t,e){return e+"不能小于"+t});if(!res)return!1}}return!0},compare:function(t,e,i,n){var o=epm.get(t),r=o&&o.value||t,a=e.value;if(r&&a){if(">"===i&&+new Date(r)>+new Date(a))return Util.ejs.ui.toast(n(e.previousElementSibling.innerHTML,o&&o.el.previousElementSibling.innerHTML||t)),!1;if("<"===i&&+new Date(r)<+new Date(a))return Util.ejs.ui.toast(n(e.previousElementSibling.innerHTML,o&&o.el.previousElementSibling.innerHTML||t)),!1}return!0},alert:function(t,e,i){Util.ejs.alert(t,e,"我知道了",i)},confirm:function(t,e,i,n){Util.ejs.confirm(t,e,["确定","取消"],function(t){0===t&&i?i():n&&n()})},_cache:{},setCache:function(t,e){this._cache[t]=e},getCache:function(t){return this._cache[t]},delCache:function(t){this._cache[t]=null,delete this._cache[t]}};window.epointm=epointm}()}();