/*
 * @Author: chends
 * @Date: 2018-07-04 08:24:11
 * @LastEditors: jjj
 * @LastEditTime: 2018-09-15 16:21:19
 * @Description:
 */

// 全局变量处理
(function(a,b){a._graceEvent_=new Util.UserEvent;var k=b("#cover-wrap");a.createMainContentCover=Util.browsers.isIE&&window.hasObjectTag?function(){var a=document.createElement("iframe");a.width="100%";a.height="100%";a.scrolling="no";a.frameBorder=0;a.style.background="transparent";a.src="../../activexcover/activexcover.html";return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').append(a).appendTo(k)}:function(){return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').appendTo(k)};a._getData_=function(b,a){return Util.ajax({url:epoint.dealRestfulUrl(getDataUrl+"/"+b),data:a})};a.dealLinkOpen=function(b){b.url=Util.addHtmlToUrl(b.url);switch(b.openType){case "tabsnav":TabsNav.addTab(b);break;case "dialog":epoint.openTopDialog(b.name,Util.getRightUrl(b.url));break;case "blank":a.open(Util.getRightUrl(b.url),(b.id+"").replace(/-/g,"_"))}};a._ANIMATION_TIME_={slide:300};Util.browsers.isIE&&(a._ANIMATION_TIME_.slide=0);a.slideDownCb=function(){b(this).css("height","")};a.slideUpCb=function(){b(this).css({height:0,display:"none"})};a.useWebsocket=!0===Util.getFrameSysParam("useWebsocket");a.eWebSocket=void 0;a.creatWebSocket=function(b,l,e,g){"function"!==typeof e||g||(g=e,e="");if(eWebSocket)g&&g();else{var d=a.EWebSocketConfig?a.EWebSocketConfig:{url:EmsgConfig.websocketUrl};d.uid=b;d.uname=l;d.tenantname=e;a.EWebSocket?(eWebSocket=new EWebSocket(d),g&&g(),_graceEvent_.fire("websocketCreated")):Util.loadJs("frame/fui/js/widgets/ewebsocket/ewebsocket.js",function(){eWebSocket=new EWebSocket(d);g&&g();_graceEvent_.fire("websocketCreated")})}};a.getLeftMenuState=function(){return localStorage.getItem("_grace_leftmenu_state_")||"normal"};a.showEXun=!0;a.hasQuickMenu=!0;a._msgcenterConfig_=a.MsgCenterConfig||{}})(this,jQuery);(function(a,b){(function(b){_getData_("getData",b).done(function(b){_graceEvent_.fire("themeDataLoad",b)})})({actions:JSON.stringify([{action:"getMenu",params:{query:"top"}},{action:"getPageInfo"},{action:"getUserInfo"}])})})(this,jQuery);(function(a,b){var k="singlelabel"===Util.getFrameSysParam("taskbar_mode")?!1:!0,h=b("#main"),l=b("#top-menu"),e=b(".main-content",h),g,d=function(b){b.siblings(".opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").stop(!0).slideUp(_ANIMATION_TIME_.slide)},m=function(b){b=b.parent().closest(".left-menu-item");var c=b.hasClass("level-1");if(b.length){var f=b.children(".left-menu-link"),f=c?f.next().find(".left-menu-sub-list:eq(0)"):f.next(),a="narrow"===getLeftMenuState();b.hasClass("opened")||(c&&a||(f.stop(!0).slideDown(_ANIMATION_TIME_.slide),d(b.addClass("opened"))),console.log(b));c||m(b)}};if(k)"[object Function]"===Object.prototype.toString.call(a.EpTabsNav)?(k=Util.getFrameSysParam("taskbar_position"),"top"===k?e.addClass("tabs-top"):k="bottom",window.TabsNav=new EpTabsNav({ifrContainer:"#main-ifr-wrap",tabContainer:"#main-tab-wrap",needScrollBtn:!1,scrollBtnSite:"sides",smoothItems:3,refreshOnActiveTab:Util.getFrameSysParam("ui_tab_refresh_onactive")||!1,needQuickNav:!0,position:k,tabWidth:0}),TabsNav._$pageCover=createMainContentCover(),TabsNav.onTabActive=function(c){c=c.replace(/^tab-/,"");var f=c.substr(0,4),a=l.find('.top-menu-item[data-id\x3d"'+f+'"]'),e=b("#left-menu-"+f);c=e.find('.left-menu-link[data-id\x3d"'+c+'"]');g&&g.removeClass("active");a.length?a.addClass("active").siblings().removeClass("active"):l.find(".top-menu-item.active").removeClass("active");e.length?(c.length&&(g=c.addClass("active"),a=c.parent(),d(a),m(a)),getLeftMenu({code:f}),h.removeClass("left-none")):h.addClass("left-none")}):console.error('The TabsNav is required! , please add the "frame/fui/js/widgets/tabsnav/tabsnav.js" before theme\'s javascript file');else{var f;window.TabsNav={addTab:function(c){f||(f=b('\x3ciframe class\x3d"tab-content"  src\x3d"" height\x3d"100%" width\x3d"100%" frameborder\x3d"0" scrolling\x3d"no"\x3e\x3c/iframe\x3e').appendTo(b("#main-ifr-wrap"))[0]);f.src=Util.getRightUrl(c.url);if(c.id){c=c.id+"";var a=c.substr(0,4);c=b("#left-menu-"+a).find('.left-menu-link[data-id\x3d"'+c+'"]');c.length&&(g&&g.removeClass("active"),g=c.addClass("active"),c=c.parent(),d(c),m(c))}},removeTab:function(){},adjustSize:function(){}};e.addClass("notabs")}})(this,jQuery);(function(a,b){var k=b("#theme-bg-img"),h=function(b){b=b||mini.Cookie.get("_grace_skin_")||"default";var a="./skins/"+b+"/images/bg.png";b=new Image;b.src=a;b.onload=function(){k[0].src=a}};b(window).on("message",function(b){b=b.originalEvent;if(b.data)try{var a=JSON.parse(b.data);"skinChange"==a.type&&a.skin&&h(a.skin)}catch(g){console.error(g)}})})(this,jQuery);(function(a,b){function k(){if(!p&&(p=g.children().length,0===p))return;c||(c=g.children().eq(0).outerHeight(!0));f||(f=g.children().eq(0).outerWidth(!0)+1);m||(m=b("#quick-menu").outerWidth(!0)||38);var a=h.width();if(0>=a)return setTimeout(k,17);a=(a-d-m-40-30)/f>>0;p>a?e.addClass("is-over").css("width",a*f):e.removeClass("is-over").css("width",p*f);t&&(a=c*Math.ceil(p/a),n.text(".top-menu-wrap.active{max-height:"+a+"px;max-height:"+a/100+"rem}"))}var h=b("#header-main-nav"),l=b("#main"),e=b("#top-menu"),g=b(".top-menu-list",e),d=b("#top-portal-container").outerWidth(!0)||30,m,f,c,q=document.createElement("div"),t="transition"in q.style,q=null,n=b("\x3cstyle\x3e\x3c/style\x3e").appendTo("head"),p=0,r;b(window).on("resize.topmenuadjust",function(){clearTimeout(r);r=setTimeout(k,17)});_graceEvent_.on("headerSearchLoad",k);var u=createMainContentCover();e.on("click",".top-menu-trigger",function(){e.hasClass("is-over")&&(e.hasClass("active")?(t&&e.addClass("hold-color"),e.removeClass("active"),u.addClass("hidden")):(e.addClass("active"),u.removeClass("hidden")))}).on("transitionend",function(b){b.target===this&&e.removeClass("hold-color")}).on("click",".top-menu-item",function(){var c=b(this),a=c.data("url"),f=this.getAttribute("title")||this.innerText,d=c.data("opentype"),g=c.data("hassub");c.addClass("active").siblings().removeClass("active");g?(l.removeClass("left-none"),getLeftMenu({code:this.getAttribute("data-id"),name:this.getAttribute("title")||this.innerText},!0)):l.addClass("left-none");a&&dealLinkOpen({openType:d,name:f,id:c.data("id"),url:a});e.removeClass("active");u.addClass("hidden")});b("body").on("click",function(c){b(c.target).closest("#top-menu").length||(e.removeClass("active"),u.addClass("hidden"))});_graceEvent_.on("themeDataLoad",function(c){c=c.data.getMenu;"string"===typeof c&&(c=JSON.parse(c));c&&c.items&&(b(Mustache.render('{{#items}}\x3cli class\x3d"top-menu-item l {{#isActived}}active{{/isActived}}" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" data-hassub\x3d"{{hasSub}}" title\x3d"{{name}}"\x3e{{name}}\x3c/li\x3e{{/items}}',c)).appendTo(g),_graceEvent_.fire("topMenuLoad"),k(),l.addClass("left-none"))})})(this,jQuery);(function(a,b){var k=b("#sys-logo-img"),h=b("#user-info"),l=b(".user-portrait",h),e=createMainContentCover();h.on("click",".user-info-summary",function(){h.hasClass("active")?(h.removeClass("active"),e.addClass("hidden")):(!d&&m(),h.addClass("active"),e.removeClass("hidden"))}).on("click",".user-action-item",function(){var a=b(this);if(a.hasClass("person-info"))TabsNav.addTab({id:this.getAttribute("data-id"),name:this.getAttribute("data-name"),url:this.getAttribute("data-url")});else if(a.hasClass("logout"))mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(b){"ok"==b&&(eWebSocket&&eWebSocket.close(),UserSettings.logout())});else if(a.hasClass("role-change"))UserSettings.changeRole(_userGuid_);else{var c=a.data("opentype"),d=a.data("id"),g=a.attr("url"),n=a.text(),k=a.attr("script");d||(d=Util.uuid(),a.data("id",d).attr("data-id",d));if(g)dealLinkOpen({id:d,openType:c,name:n,url:g});else if(k)try{eval(k)}catch(r){console.error(r)}}h.removeClass("active");e.addClass("hidden")});b("body").on("click",function(a){b(a.target).closest("#user-info").length||(h.removeClass("active"),e.addClass("hidden"))});var g=function(f){a._userName_=f.name;a._userGuid_=f.guid;a._tenantName_=f.tenantsysname;b.extend(a._msgcenterConfig_,{isMsgCenterMaxSize:f.isMsgCenterMaxSize||!1,msgCenterOrder:f.msgCenterOrder||"asc",hideCallback:function(){e.addClass("hidden")}});useWebsocket&&creatWebSocket(_userGuid_,_userName_,_tenantName_);if(f.portrait){var c=Util.getRightUrl(epoint.dealRestfulUrl(f.portrait));l.attr("src",c)}f.hasParttime&&(h.find(".user-action-item.role-change").removeClass("hidden"),f.isOpenDefaultOU&&UserSettings.changeRole(_userGuid_));c=b("#user-info-detail");c.find(".user-name").text(f.name).attr("title",f.name);c.find(".user-dept").text(f.ouName).attr("title",f.ouName)};_graceEvent_.on("themeDataLoad",function(b){var c=b.data.getUserInfo;b=b.data.getPageInfo;"string"===typeof c&&(c=JSON.parse(c));"string"===typeof b&&(b=JSON.parse(b));g(c);c=b;c.logo&&k.attr("src",/^data:/i.test(c.logo)?c.logo:Util.getRightUrl(c.logo));c.title&&(document.title=c.title,a.systemTitle=c.title);c.fullSearchUrl&&(a._fullSearchUrl_=c.fullSearchUrl);!1===c.hasQuickMenu&&(a.hasQuickMenu=!1);!1===c.showEXun&&(a.showEXun=!1);initPortal(c.homes,c.defaultHome);_graceEvent_.fire("afterPageInfo")});b(a).on("message",function(b){try{var c=JSON.parse(b.originalEvent.data);"userPortraitChange"===c.type&&l.attr("src",c.imgData)}catch(q){}});var d=!1,m=function(){_getData_("getExtTabsInfo").done(function(a){if(a&&a.length){var c="";b.each(a,function(b,a){a.icon=a.icon||"modicon-8";/^icon-/.test(a.icon)&&(a.icon="action-icon "+a.icon);c+=Mustache.render('\x3cli class\x3d"user-action-item" title\x3d"{{name}}" url\x3d"{{url}}" data-opentype\x3d"{{openType}}" script\x3d"{{script}}"\x3e\x3cspan class\x3d"{{icon}}"\x3e\x3c/span\x3e{{name}}\x3c/li\x3e',a)});b(c).insertAfter("#person-info-setting")}d=!0})}})(this,jQuery);(function(a,b){function k(e){function g(b){b?(d.addClass("active"),h.removeClass("hidden")):(d.removeClass("active"),h.addClass("hidden"))}var d=b("#top-portal-container"),h=createMainContentCover(),f=1===d.find(".top-portal-item").length;d.on("click",".top-portal-header",function(){TabsNav.addTab(e)}).on("click",".top-portal-btn",function(){g(!d.hasClass("active"));f&&TabsNav.addTab(e)}).on("click",".top-portal-item",function(){dealLinkOpen({url:this.getAttribute("data-url"),name:this.title,openType:this.getAttribute("data-opentype"),id:this.getAttribute("data-id")});g(!1)}).on("click",".top-portal-cate",function(){b(this).parent().toggleClass("collapse")});b("body").on("click",function(a){b(a.target).closest(d).length||g(!1)});var c,q=d.find(".top-portal");b(a).on("resize",function(){clearTimeout(c);c=setTimeout(function(){var b=l.height()-50;0<b&&q.css("max-height",b)},17)}).trigger("resize")}function h(a,g){var d=[];a&&(d.push('\x3cul class\x3d"top-portal-list"\x3e'),b.each(a,function(b,a){a.icon=a.icon||"default-modicon";d.push(Mustache.render('\x3cli class\x3d"top-portal-item" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"top-portal-icon {{icon}}"\x3e\x3c/span\x3e\x3cspan class\x3d"top-portal-name"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',a))}),d.push("\x3c/ul\x3e"));b.each(g,function(a,f){d.push('\x3cdiv class\x3d"top-portal-block"\x3e\x3ch3 class\x3d"top-portal-cate"\x3e'+f.name+'\x3cspan class\x3d"top-portal-cate-trigger"\x3e\x3c/span\x3e\x3c/h3\x3e\x3cul class\x3d"top-portal-list" style\x3d"max-height:'+30*f.items.length+'px"\x3e');b.each(f.items,function(b,a){a.icon=a.icon||"default-modicon";d.push(Mustache.render('\x3cli class\x3d"top-portal-item" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"top-portal-icon {{icon}}"\x3e\x3c/span\x3e\x3cspan class\x3d"top-portal-name"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',a))});d.push("\x3c/ul\x3e\x3c/div\x3e")});b(d.join("")).appendTo("#top-portal-content")}var l=b("#main");a.initPortal=function(a,g){for(var d={closeIcon:!1,refresh:!0},e=[],f=0;f<a.length;f++){var c=a[f],q=!1;void 0!=c.items?!q&&b.each(c.items,function(b,a){if(g){if(a.code==g)return d.id=a.code||"home",d.url=a.url,d.name=a.name,q=!0,!1}else if("tabsnav"==a.openType)return d.id=a.code||"home",d.url=a.url,d.name=a.name,q=!0,!1}):(q||(g?c.code==g&&(d.id=c.code||"home",d.url=c.url,d.name=c.name,q=!0):"tabsnav"==c.openType&&(d.id=c.code||"home",d.url=c.url,d.name=c.name,q=!0)),e=e.concat(a.splice(f,1)),f--)}h(e,a);k(d);TabsNav.addTab(d)}})(this,jQuery);(function(a,b){function k(){h.on("click",".quick-menu-header",function(){h.hasClass("active")?(h.removeClass("active"),e.addClass("hidden")):(m||f(),h.addClass("active"),e.removeClass("hidden"))}).on("click",".quick-menu-item",function(){var c=b(this),f=c.data("opentype"),g=c.data("id"),k=this.title,l=c.data("url");c.hasClass("menu-setting")?d():"tabsnav"==f?TabsNav.addTab({id:g,name:k,url:l}):a.open(Util.getRightUrl(l),g);h.removeClass("active");e.addClass("hidden")});b("body").on("click",function(a){b(a.target).closest("#quick-menu").length||(e.addClass("hidden"),h.removeClass("active"))})}var h=b("#quick-menu"),l=b(".quick-menu-list",h),e=createMainContentCover(),g="frame/fui/pages/quickmenusetting/quickmenusetting"+(/proto\.html/.test(location.pathname)?".proto.html":""),d=function(){var b={width:820,height:500},a=Util.getWinSize();a.height<b.height&&(b.height=a.height);a.width<b.width&&(b.width=a.width);epoint.openTopDialog("\u5e38\u7528\u83dc\u5355\u914d\u7f6e",g,function(b){!0===b&&f()},b)},m=!1,f=function(){_getData_("getQuickMenu").done(function(a){if(a&&a.length){var c=[];b.each(a,function(b,a){c.push(Mustache.render('\x3cli class\x3d"quick-menu-item" data-id\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}" data-url\x3d"{{url}}"\x3e{{name}}\x3c/li\x3e',a))});c.push('\x3cli class\x3d"quick-menu-item menu-setting"\x3e\x3ci class\x3d"action-icon icon-gear"\x3e\x3c/i\x3e\u914d\u7f6e\x3c/li\x3e');b(c.join("")).appendTo(l.empty())}else h.addClass("hidden");m=!0})};_graceEvent_.on("afterPageInfo",function(){a.hasQuickMenu?k():h.addClass("hidden")})})(this,jQuery);(function(a,b){function k(a,c){var f="";b.each(a,function(a,d){d.hasSub=!(!d.items||!d.items.length);d.rowkey=void 0===c?a+"":c+"-"+a;var g=d.rowkey.split("-").length;d.isTop=1===g;d.level="level-"+g;var e;e=g||d.rowkey.split("-").length;e=2>e?36:36+14*(e-2);d.indent=e;d.indentRem=d.indent&&d.indent/100;1===g&&(d.icon=d.icon||"modicon-1");f=d.hasSub?f+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;padding-left: {{indentRem}}rem;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger action-icon icon-right"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',b.extend(d,{subMenu:k(d.items,d.rowkey)})):f+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;padding-left: {{indentRem}}rem;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger action-icon icon-right"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',d)});return f}function h(b){if(c[b])return TabsNav.addTab(c[b]);var a="",d="";m.find("#left-menu-"+b).find(".left-menu-link").each(function(f,g){d=g.getAttribute("data-url");a=g.getAttribute("data-opentype");if(d&&"tabsnav"==a)return c[b]={id:g.getAttribute("data-id"),name:g.title,url:d},TabsNav.addTab(c[b]),!1})}var l={},e=b("#main"),g=b("#left-menu"),d=b(".left-nav-trigger",g),m=b(".left-nav-container",g),f;(function(){function a(b){localStorage.setItem("_grace_leftmenu_state_",b)}var c=getLeftMenuState(),d=createMainContentCover();e["normal"==c?"removeClass":"addClass"]("left-narrow");var h=Util.browsers.isIE8||Util.browsers.isIE9;b(".left-nav-trigger").on("click",function(){e.hasClass("left-narrow")?(a(c="normal"),e.removeClass("left-narrow"),d.addClass("hidden")):(a(c="narrow"),e.addClass("left-narrow"),f&&(f.find(".left-menu-item.level-1.opened").length?(d.removeClass("hidden"),g.addClass("has-opened")):g.trigger("hide-trans"),f.siblings().find(".left-menu-item.level-1.opened").removeClass("opened")))});g.on("hide-trans",function(){!h&&g.addClass("hide-trans")}).on("transitionend",function(b){b.target===this&&g.removeClass("hide-trans")}).on("click",".left-menu-link",function(){var a=b(this),e=a.parent(),h=e.hasClass("level-1"),k=a.data("hassub"),l={url:a.data("url"),openType:a.data("opentype"),name:this.title,id:a.data("id")},m="narrow"===c;k?(a=h?a.next().find(".left-menu-sub-list:eq(0)"):a.next(),e.hasClass("opened")?(e.removeClass("opened"),a.stop(!0).slideUp(_ANIMATION_TIME_.slide),h&&m&&d.addClass("hidden")):(e.addClass("opened"),h&&m&&d.removeClass("hidden"),h&&m?a.show():a.stop(!0).slideDown(_ANIMATION_TIME_.slide),e.siblings(".opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").stop(!0).slideUp(_ANIMATION_TIME_.slide))):l.url&&(dealLinkOpen(l),m&&(f.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp(_ANIMATION_TIME_.slide),d.addClass("hidden"),g.removeClass("has-opened")));if(h&&m)g[f.find(".left-menu-item.level-1.opened").length?"addClass":"removeClass"]("has-opened")});b("body").on("click",function(a){b(a.target).closest("#left-menu").length||(d.addClass("hidden"),"narrow"===c&&f&&f.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp(),g.removeClass("has-opened"))});b(".main-content",e).on("transitionend",function(a){a.target===this&&TabsNav.adjustSize()})})();a.getLeftMenu=function(a,c){var n=a.code;if(!l[n]||"reject"===l[n])return _getData_("getMenu",{query:"sub",code:n}).done(function(p){p&&p.length?(p=k(p),f=b(Mustache.render('\x3cdiv class\x3d"left-menu-wrap" id\x3d"left-menu-{{code}}"\x3e\x3cdiv class\x3d"left-menu-header"\x3e{{name}}\x3c/div\x3e\x3cul class\x3d"left-menu-list"\x3e{{{leftMenuItems}}}\x3c/ul\x3e\x3c/div\x3e',{code:a.code,name:a.name,leftMenuItems:p})),f.appendTo(m).siblings(".left-menu-wrap").addClass("hidden"),e.removeClass("left-none"),Util.browsers.isIE8&&f.find(".left-menu-list").height(g.height()-d.height()||36)):e.addClass("left-none");l[n]="resolve";c&&h(n+"")}).fail(function(){l[n]="reject"});"resolve"===l[n]&&(f=b("#left-menu-"+n),f.removeClass("hidden").siblings(".left-menu-wrap").addClass("hidden"),c&&h(n))};var c={}})(this,jQuery);window.OpenEMsg=function(a,b,k){window.eMsg?"undefined"===typeof b?eMsg.open(a):eMsg.openSession(a,b,k):creatWebSocket(_userGuid_,_userName_,_tenantName_,function(){eWebSocket.openEmsg(a,b,k)})};(function(a,b){function k(){ThemeSelection._styleLoaded=!0;e=new ThemeSelection({getPagesUrl:getPagesUrl,savePageUrl:savePageUrl,showCallback:function(){l.removeClass("hidden")},hideCallback:function(){h.removeClass("active");l.addClass("hidden")}});window.themeSelection=e;h.on("click",function(){h.hasClass("active")?(h.removeClass("active"),e.hide()):(e.show(),h.addClass("active"))});b("body").on("click",function(a){b(a.target).closest(".theme-selection-container, #theme-skin-switch").length||(h.removeClass("active"),e.hide())})}var h=b("#theme-skin-switch"),l=createMainContentCover(),e;window.ThemeSelection?k():Util.loadJs("frame/fui/js/widgets/themeselection/themeselection.js",k)})(this,jQuery);(function(a,b){function k(){A=new EMsgList({content:D,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:function(){h()},onDecEmsgCount:function(a){F(a)}});a.RefreshEMsg=b.proxy(A.getData,A)}function h(){B.addClass("hidden");p.stop(!0).animate({right:-350},function(){p.addClass("hidden")});c.find("[data-ref].active").removeClass("active")}var l="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",e=0,g="",d={roll:function(){g=a.systemTitle||document.title;document.title=l;clearTimeout(e);e=setTimeout(function G(){document.title=l.substring(1,l.length)+l.substring(0,1);l=document.title;e=setTimeout(G,300)},300)},stop:function(){clearTimeout(e);document.title=g||document.title;l="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}},m=b("#msg-sound"),f=function(a){a=parseInt(a,10);return 99<a?"99+":0>=a?"":a+""},c=b("#header-action-btns"),q=b(".header-action-btn.chart",c),t=b(".remind-num",c),n=b(".emsg-num",c),p=b("#msg-panel"),r=b("#msgEMsg",p),u=b(".msg-panel-content",r),D=b(".emsg-recent-list",u),y=b(".online-user-num",r),w=document.getElementById("online-user"),x=b("#new-remind-wrap"),z={show:function(){RemindTipsCfg.show&&(x.removeClass("hidden"),this.autoHide())},autoHide:function(){return 0!=RemindTipsCfg.timeout?function(){clearTimeout(z.timer);z.timer=setTimeout(function(){x.addClass("hidden")},RemindTipsCfg.timeout)}:function(){}}(),initEvent:function(){if(RemindTipsCfg.show)x.on("click",".icon, .text",function(){x.addClass("hidden")}).on("click",".close",function(a){a.stopPropagation();x.addClass("hidden")})}};z.initEvent();var C=function(b){var c={haseXun:a.showEXun,needNum:!0};b&&(c.inCache=!0);return _getData_("getMsgCount",c).done(function(a){E(a)})},E=function(a){var b,c=!1;a.remind?(b=parseInt(t.data("num"),10)||0,a.remind>b&&(c=!0,z.show()),t.removeClass("hidden").text(f(a.remind)),t.data("num",a.remind)):t.text("").addClass("hidden");a.eXun?(b=parseInt(n.data("num"),10)||0,a.eXun>b&&(c=!0),n.removeClass("hidden").text(f(a.eXun)),n.data("num",a.eXun)):n.text("").addClass("hidden");a.systemUpdate&&mini.showMessageBox({title:"\u7cfb\u7edf\u5347\u7ea7\u63d0\u9192",iconCls:"",buttons:[],message:Util.htmlEscape(a.systemUpdate)});c?(H(100),d.roll()):d.stop()},H=function(a,c,d){if(!1===Util.getFrameSysParam("messageSound"))return Util.noop;c=Util.getRightUrl(c);if(Util.browsers.isIE){var f=b('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden"\x3e\x3c/iframe\x3e').appendTo(a);return function(){f[0].src=c+"?_\x3d"+ +new Date}}var e=document.createElement("audio");e.src=Util.getRightUrl(d);e.className="hidden-accessible";a.append(e);var g=null;return function I(a){void 0===a&&(a=100);e.play()["catch"](function(){clearTimeout(g);0<a&&(g=setTimeout(function(){I(--a)},50))})}}(m,"../../msgsound/sound.html","../../msgsound/newsms.wav");_graceEvent_.on("afterPageInfo",function(){C();a.useWebsocket||setInterval(function(){C(!0)},6E4);a.showEXun?J():q.addClass("hidden")});if(a.useWebsocket)_graceEvent_.on("websocketCreated",function(){eWebSocket.socketEvent.on("messagecount",function(a){E(a.data)})});a.getMessageCount=C;var F=function(a){var b=n.text();Util.ajax({url:EmsgConfig.countUrl,data:{sessionid:a}}).done(function(a){b&&a&&(b=parseInt(b,10)-parseInt(a,10));0>b&&(b=0);0==b&&(b="",n.data("num",0).addClass("hidden"));n.text(b)})},A,J=function(){a.EMsgList?k():Util.loadJs("frame/fui/js/widgets/emsglist/emsglist.js",function(){k()});a.OnlineUserSettings&&a.OnlineUserSettings.show&&(r.find(".msg-panel-head").addClass("tab").find(".panel-hd-tab.hidden").removeClass("hidden"),r.on("click",".panel-hd-tab",function(){var a=b(this),c=a.data("ref"),d=D;a.hasClass("active")||(a.addClass("active").siblings().removeClass("active"),c&&(d=b("#"+c,u),setTimeout(function(){OnlineUserSettings.onRefreshData(function(a){y.html(a)})},500)),d.removeClass("hidden").siblings().addClass("hidden"))}))};a.hideMessagePanel=h;var B=createMainContentCover(),v;a.messageCenter={refresh:function(){v&&v.refresh()},hide:function(){v&&v.hide()}};c.on("click","[data-ref]",function(){var c=b(this),d=c.data("ref"),f=b("#"+d,p);if(c.hasClass("active"))h(),B.addClass("hidden");else if(c.addClass("active").siblings(".active").removeClass("active"),"msgRemind"==d)v||(v=new MsgCenter(a._msgcenterConfig_)),v.show(),hideMessagePanel();else{if("msgEMsg"==d){if(A.getData(),a.OnlineUserSettings&&a.OnlineUserSettings.show)if(w.src)OnlineUserSettings.onRefreshData(function(a){y.html(a)});else w.src=OnlineUserSettings.url,w.attachEvent?w.attachEvent("onload",function(){OnlineUserSettings.onRefreshData(function(a){y.html(a)})}):w.onload=function(){OnlineUserSettings.onRefreshData(function(a){y.html(a)})}}else"msgSkin"==d&&a.initSkinView&&a.initSkinView();f.removeClass("hidden").siblings(".msg-panel-detail").addClass("hidden");f.find(".msg-panel-content").removeClass("hidden");p.removeClass("hidden");p.stop(!0).animate({right:0});B.removeClass("hidden")}});p.on("click",".msg-panel-hide",function(){h()});b("body").on("click",function(a){b(a.target).closest("#msg-panel , .header-action-btn[data-ref]").length||hideMessagePanel()})})(this,jQuery);(function(a,b){function k(){return Util.ajax({url:a.fullSearchCateUrl}).done(function(a){a=a.categories||[];"string"==typeof a&&(a=JSON.parse(a));var c=[];b.each(a,function(a,b){c.push({id:b.guid,name:b.name,iconCls:b.icon||"view"})});c.length&&(d=c,m&&m.setOpt("category",d));g=!0})}function h(){ClassifySearch._styleLoaded=!0;ClassifySearch._$pageCover=createMainContentCover();m=new ClassifySearch({id:"header-search",searchTarget:"\u5185\u5bb9",category:d,placeholder:"\u8bf7\u8f93\u5165",maxShowCharacter:5,enter:function(b,c){var d;d=b||"all";try{TabsNav.removeTab("fullsearch")}catch(t){}TabsNav.addTab({id:"fullsearch",name:"\u5168\u6587\u68c0\u7d22",url:a._fullSearchUrl_+"?wd\x3d"+a.encodeURI(c)+"\x26type\x3d"+d})},focus:function(){g||k()}});setTimeout(function(){e.removeClass("invisible")},200)}var l=b(".header-container"),e=b("#top-search").addClass("invisible"),g=!1,d=[{id:"all",name:"\u5168\u6587\u68c0\u7d22",iconCls:"modicon-25"}],m;_graceEvent_.on("afterPageInfo",function(){a._fullSearchUrl_?(h(),l.addClass("has-search")):l.removeClass("has-search");_graceEvent_.fire("headerSearchLoad")})})(this,jQuery);(function(a,b){function k(){if(m)try{m.abort()}catch(q){}var a=h();a.join("")!==f?m=Util.ajax({url:topMenuSaveUrl,data:{sort:JSON.stringify(a)}}).done(function(){mini.showTips({content:"\u4fdd\u5b58\u6210\u529f",state:"success",x:"center",y:"center",timeout:3E3});f=h().join("")}):mini.showTips({content:"\u6392\u5e8f\u672a\u66f4\u6539",state:"info",x:"center",y:"center",timeout:3E3});e.removeClass("active in-sort");l.addClass("hidden")}function h(){return g.sortable("toArray",{attribute:"data-id"})}if(1==Util.getFrameSysParam("enableCustomSort")){var l=createMainContentCover(),e=b("#top-menu"),g=e.find(".top-menu-list");g.sortable({revert:200,delay:300,distance:30,forcePlaceholderSize:!0,containment:"parent",update:function(){clearTimeout(d);d=setTimeout(k,1E3)},stop:function(){clearTimeout(d);d=setTimeout(k,1E3)},sort:function(){clearTimeout(d)},start:function(){clearTimeout(d);l.removeClass("hidden");e.addClass("active in-sort")}});var d,m,f;_graceEvent_.on("topMenuLoad",function(){f=h().join("")})}})(this,jQuery);