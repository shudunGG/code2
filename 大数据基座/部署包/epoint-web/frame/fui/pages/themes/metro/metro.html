<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>METRO主题-主界面</title>
<link href="
    ../../../js/widgets/classifysearch/classifysearch.css"
	rel="stylesheet">
<script src="../../../js/cssboot.js"></script>
<script>
	SrcBoot.output([ 'frame/fui/js/widgets/epdialog/epdialog.css',
			'frame/fui/js/widgets/epcontextmenu/epcontextmenu.css' ]);
</script>
</head>

<body>
	<!-- <div class="page-loading"></div> -->
	<!-- 背景图片 -->
	<img class="metro-skin-bg" id="metro-skin-bg"
		src="images/skinbg/new.jpg" alt>
	<!-- 顶部工具栏 -->
	<div class="metro-top-bar clearfix" id="metro-top-bar">
		<img class="sys-logo l" id="sys-logo"
			src="images/Images_epoint_title.png" alt>
		<div class="r clearfix mr10">
			<div class="l top-btns clearfix" id="top-btns">
				<span class="appstore top-btn l mr10 " title="应用仓库"></span> <span
					class="chat  top-btn  l mr10" title="E讯"><span
					class="unread hidden"></span></span> <span
					class="msg-remind top-btn l mr10" title="消息提醒"><span
					class="unread hidden"></span></span> <span
					class="bgimg top-btn l mr10 default-app-btn" data-id="sys-bg"
					title="背景设置"></span> <span class="theme top-btn l mr10"
					id="theme-switch" title="主题切换"></span> <span
					class="setting top-btn l mr10 default-app-btn   "
					data-id="sys-user-setting" title="个人设置"></span> <span
					class="logout  top-btn l tool-btn " title="退出系统"></span>
			</div>
			<!-- 用户信息 -->
			<div class="top-user r" id="top-user">
				<img class="user-img l" src="./images/top/user-img.png" alt> <span
					class="user-name"> </span> <span class="user-ou"> </span>
			</div>
		</div>
		<!-- 全文搜索 -->
		<div class="r clearfix" id="header-search-container"></div>
	</div>
	<!-- 左侧 -->
	<div class="left-bar" id="left-bar">
		<div class="portal-btn" id="portal-btn"></div>
		<!-- 常用应用 -->
		<div class="common-apps" id="common-apps">
			<div class="list-wrap"></div>
			<span class="common-cfg-btn"></span>
		</div>
	</div>
	<!-- metro分屏 -->
	<div class="metro-screens" id="metro-screens">
		<!-- 分屏 -->
		<div class="screen-list clearfix"></div>
		<!-- 分屏页码 -->
		<ul class="screen-nav clearfix" id="screen-nav"></ul>
		<!-- 按钮 -->
		<button class="screen-btn prev"></button>
		<button class="screen-btn next"></button>
	</div>
	<!-- 底部任务栏 -->
	<div class="metro-task-bar" id="metro-task-bar">
		<div class="scroll-wrap l hidden">
			<a class="scroll-l" href="javascript:void(0);"></a>
		</div>
		<div class="tasks-wrap l">
			<div class="task-list clearfix"></div>
		</div>
		<div class="scroll-wrap l hidden">
			<a class="scroll-r" href="javascript:void(0);"></a>
		</div>
	</div>
	<!-- 门户 -->
	<div class="portal-container" id="portal-wrap">
		<div class="portal">
			<h2 class="portal-header">门户</h2>
			<div class="portal-content" id="portal-content"></div>
		</div>
	</div>
	<div class="board-panel hidden" id="board-panel">
		<i class="board-close"></i>
	</div>
	<!-- E讯 -->
	<div id="msgEMsg" class="msg-panel hidden">
		<h2 class="msg-panel-head">
			<span class="panel-hd-tab active">E讯提醒</span> <span
				class="panel-hd-tab hidden" data-ref="online-user"> 在线人员( <span
				class="online-user-num">0</span>)
			</span> <i class="msg-panel-hide"></i>
		</h2>
		<div class="msg-panel-content">
			<ul class="emsg-recent-list empty"></ul>
			<iframe id="online-user" class="emsg-online-user hidden" width="100%"
				height="100%" frameborder="0"></iframe>
		</div>
	</div>
	<!-- 声音提示 js动态添加IE加载iframe 非IE使用audio -->
	<div id="msg-sound"></div>
	<script src="../../../../../rest/resource/jsboot"></script>	
	<script>
		// 前端原型使用远程数据模拟时 ie8/9不支持响应头中直接 Access-Control-Allow-Origin 来启用跨域支持
		if (Util.browsers.isIE8 || Util.browsers.isIE9) {
			jQuery.support.cors = true;
		}
	</script>
	<!-- 配置变量 -->
	<script>
		var dataBaseUrl = 'themedataaction';

		var MetroDataActionUrl = {
			// 获取背景图片的url
			getBgUrl : epoint.dealRestfulUrl(dataBaseUrl + '/getBgUrl'),
			// 获取用户信息
			userInfoUrl : epoint.dealRestfulUrl(dataBaseUrl + '/getUserInfo'),
			// 界面信息
			pageInfoUrl : epoint.dealRestfulUrl(dataBaseUrl + '/getPageInfo'),
			// 获取消息提醒数
			msgCountUrl : epoint.dealRestfulUrl(dataBaseUrl + '/getMsgCount'),
			// 获取分屏信息、应用信息
			// screenInfoUrl: './test/screen.json',
			screenInfoUrl : epoint.dealRestfulUrl(dataBaseUrl + '/getMetroApp'),
			// 更新应用上的消息数目
			updateAppMsgCountUrl : epoint.dealRestfulUrl(dataBaseUrl
					+ '/updateAppMsgCount'),
			// 更新应用信息请求：移动、卸载、安装
			updateAppUrl : epoint.dealRestfulUrl(dataBaseUrl
					+ '/updateMetroApp'),

			// 常用应用的请求地址
			commonAppsUrl : epoint.dealRestfulUrl(dataBaseUrl + '/getQuickApp'),
			// 常用应用配置地址
			commonAppCfgUrl : 'frame/fui/pages/quickappsetting/quickappsetting.html',

			// 应用中心请求地址
			appCenterDataUrl : epoint.dealRestfulUrl(dataBaseUrl
					+ '/getAppCenterApps'),

			// 主题切换 获取所有界面
			getPagesUrl : epoint.dealRestfulUrl(dataBaseUrl + '/getAllPage'),
			// 主题切换 保存切换到的界面
			savePageUrl : epoint.dealRestfulUrl(dataBaseUrl + '/setAsDefault')
		};

		// 默认应用配置，如主题设置、应用商店等
		var defaultApps = [
				{
					name : '背景设置',
					id : 'sys-bg',
					url : '../imac/bgsetting/bgsetting?pageId='
							+ Util.getUrlParams("pageId")
				},
				{
					id : 'sys-user-setting',
					name : '个人设置',
					url : 'frame/pages/basic/personalset/personalinfo/personalinfo'
				} ],
		// 注销账户的回调方法
		onLogout = function() {
			epoint.confirm('确认注销登录吗？', '系统提醒', function() {
				window.location.href = Util.getRootPath()
						+ "rest/logout?isCommondto=true";
			});
		};

		var METRO_SETTINGS = {
			// 列数目
			columns : 4,
			// 行数目
			rows : 4,
			// 默认显示的分屏页，从1开始
			activePage : 1,
			// [x, y] dialog打开时 宽高相对于视窗大小的比列
			dialogSizeRadio : [ 0.9, 0.9 ],
			// 屏幕滚动方向 0 水平 1 垂直
			scrollDirection : 0
		};

		// [x, y] dialog打开时 宽高相对于视窗大小的比列
		var DIALOG_SIZE_RATIO = [ 0.6, 0.6 ];

		var onlineUserIframe = document.getElementById('online-user');
		// 在线人员选项卡配置
		var OnlineUserSettings = {
			// 是否显示
			show : true,
			// 对应页面地址
			url : '../../../../../framemanager/orga/orga/user/onlineuser',
			// 每次显示E讯面板时都会触发该方法
			onRefreshData : function(callback) {
				// 调用在线人员页面中的刷新数据方法
				// 同时tab上的在线人数需要更新，但考虑到获取数据是异步操作，所以需要在refreshData方法中获取到在线人数后调用callback方法
				try {
					onlineUserIframe.contentWindow.refreshData(callback);
				} catch (e) {
					console.error(e);
				}

			}
		};
		var EmsgConfig = {
			baseUrl : epoint.dealRestfulUrl('exundataaction/eXun'),
			treeUrl : epoint.dealRestfulUrl("exundataaction/getTree"),
			websocketUrl : "../../../../../websocket/eXun",
			historyUrl : "frame/pages/basic/communication/exun/exunmsg",
			groupImg : "../emsg/images/emsg-group-bg.png",
			userImg : "../emsg/images/emsg-user-error.jpg",
			// 发送邮件的地址，如果配置了将显示E讯窗口上方显示发送邮件 将在URL后自动拼接收件人guid，多个以“;”分隔
			// 约定 如果有多人，参数名为ToUserGuidList 一个人则参数名为ToUserGuid
			sendEmailUrl : 'oa/epointdbmail/InnerEmailLeftMenuTree.jspx?moduleCode=00690002',
		};

		// 新增配置 是否启用桌面应用上的右键菜单
		var appContextmenu = true;

		// 消息中心配置
		var MsgCenterConfig = {
			"typeListUrl" : epoint.dealRestfulUrl(dataBaseUrl
					+ '/getTypeListUrl'), // 类型接口
			"msglistUrl" : epoint
					.dealRestfulUrl(dataBaseUrl + '/getMsglistUrl'), // 右侧列表接口
			"markToReadUrl" : epoint.dealRestfulUrl(dataBaseUrl
					+ '/markToReadUrl'), // 标记为已读接口，多个用逗号隔开
			"deleteUrl" : epoint.dealRestfulUrl(dataBaseUrl + '/deleteUrl'), // 删除接口, 类型为all表示删除所有，不然直接传id，多个逗号隔开
			"msgTipsUrl" : epoint
					.dealRestfulUrl(dataBaseUrl + '/getMsgTipsUrl')
		// 消息提醒接口，返回各个类别的数据和总数
		};

		//消息中心高级设置
		var MsgCenterSetting = {
			getMessageSettingUrl : epoint.dealRestfulUrl(dataBaseUrl
					+ '/getMessageSetting'), // 获取参数数据
			saveMessageSettingUrl : epoint.dealRestfulUrl(dataBaseUrl
					+ '/saveMessageSettingUrl')
		//保存 
		};
		// 搜索相关的配置
		var _searchCfg = {
			// 用户模块搜索
			userModuleSearchUrl : epoint.dealRestfulUrl(dataBaseUrl
					+ 'themedataaction/userModuleSearch'),
			// 实时搜索到的用户的点击处理函数 参数为人员guid name
			userClick : function(userGuid, userName) {
				epoint.openDialog('人员详情', Util
						.getRightUrl('https://www.baidu.com/s?wd=' + '姓名:'
								+ userName + ' guid:' + userGuid), function() {
				}, {
					width : 800, 
					height : 380
				});
			},
			// 全文检索分类
			fullSearchCateUrl : epoint
					.dealRestfulUrl('fullsearchaction/getftsSystem'),
		};
	</script>
	<script>
		SrcBoot.output([
				'frame/fui/js/widgets/epdialog/epdialog.js',
				'frame/fui/js/widgets/epcontextmenu/epcontextmenu.js',
				'frame/fui/js/widgets/classifysearch/classifysearch.js',
				'frame/fui/pages/themes/metro/metro'
						+ (SrcBoot.debug ? '' : '.min') + '.js' ]);
	</script>
</body>

</html>