/* buildTime: 2021-08-03T03:37:56.889Z */
/**
* jQuery MiniUI v3.0
* 
* Web Site : http://www.miniui.com
*
* Commercial License : http://www.miniui.com/license
*
* Copyright(c) 2012 All Rights Reserved. Shanghai PusSoft Co., Ltd (上海普加软件有限公司) [ services@plusoft.com.cn ]. 
* 
*/
mini={components:{},uids:{},ux:{},doc:document,window:window,isReady:!1,createTime:new Date,byClass:function(t,e){return"string"==typeof e&&(e=mini.byId(e)),jQuery("."+t,e)[0]},getComponents:function(){var t,e=[];for(t in mini.components){var i=mini.components[t];i.isControl&&e.push(i)}return e},get:function(t){if(!t)return null;if(mini.isControl(t))return t;if("string"==typeof(t="string"==typeof t&&"#"==t.charAt(0)?t.substr(1):t))return mini.components[t];var e=mini.uids[t.uid];return e&&e.el==t?e:null},getbyUID:function(t){return mini.uids[t]},findControls:function(t,e){if(!t)return[];e=e||mini;var i,n=[],s=mini.uids;for(i in s){var o=s[i],l=t.call(e,o);if((!0===l||1===l)&&(n.push(o),1===l))break}return n},getChildControls:function(e){var i=e.el||e;return mini.findControls(function(t){return!(!t.el||e==t)&&!(!mini.isAncestor(i,t.el)||!t.within)})},emptyFn:function(){},createNameControls:function(t,e){if(t&&t.el){e=e||"_";for(var i=t.el,n=mini.findControls(function(t){return!(!t.el||!t.name)&&!!mini.isAncestor(i,t.el)}),s=0,o=n.length;s<o;s++){var l=n[s],r=e+l.name;t[r=!0===e?l.name[0].toUpperCase()+l.name.substring(1,l.name.length):r]=l}}},getsByName:function(t,e){return mini.getsbyName(t,e)},getsbyName:function(e,i){var t=mini.isControl(i),n=i;i&&t&&(i=i.el),i=(i=mini.byId(i))||document.body;var s=mini.findControls(function(t){return!!t.el&&!(t.name!=e||!mini.isAncestor(i,t.el))},this);return t&&0==s.length&&n&&n.getbyName&&((n=n.getbyName(e))&&s.push(n)),s},getbyName:function(t,e){return mini.getsbyName(t,e)[0]},getByName:function(t,e){return mini.getbyName(t,e)},getParams:function(t){var e={};if(t=(t=t||location.href).split("?")[1])for(var i=t.split("&"),n=0,s=i.length;n<s;n++){var o=i[n].split("=");try{e[o[0]]=decodeURIComponent(unescape(o[1]))}catch(l){}}return e},reg:function(t){this.components[t.id]=t,this.uids[t.uid]=t},unreg:function(t){delete mini.components[t.id],delete mini.uids[t.uid]},classes:{},uiClasses:{},getClass:function(t){return t?this.classes[t.toLowerCase()]:null},getClassByUICls:function(t){return this.uiClasses[t.toLowerCase()]},idPre:"mini-",idIndex:1,newId:function(t){return(t||this.idPre)+this.idIndex++},copyTo:function(t,e){if(t&&e)for(var i in e)t[i]=e[i];return t},copyIf:function(t,e){if(t&&e)for(var i in e)mini.isNull(t[i])&&(t[i]=e[i]);return t},createDelegate:function(t,e){return t?function(){return t.apply(e,arguments)}:function(){}},isControl:function(t){return!(!t||!t.isControl)},isElement:function(t){return t&&t.appendChild},isDate:function(t){return!(!t||!t.getFullYear)},isArray:function(t){return!(!t||!t.unshift)},isNull:function(t){return null===t||t===undefined},isNumber:function(t){return!isNaN(t)&&"number"==typeof t},isEquals:function(t,e){return!(0===t||0===e||!mini.isNull(t)&&""!=t||!mini.isNull(e)&&""!=e)||(t&&e&&t.getFullYear&&e.getFullYear?t.getTime()===e.getTime():"object"==typeof t&&"object"==typeof e?t===e:String(t)===String(e))},forEach:function(t,e,i){for(var n=t.clone(),s=0,o=n.length;s<o;s++){var l=n[s];if(!1===e.call(i,l,s,t))break}},sort:function(t,e,i){!function(t,e){for(var i,n=0,s=t.length;n<s;n++)for(i=n;i<s;i++){var o=t[n],l=t[i];0<e(o,l)&&(t.removeAt(i),t.insert(n,l))}}(t,e)},elWarp:document.createElement("div")},"undefined"==typeof mini_debugger&&(mini_debugger=!0),"undefined"==typeof mini_useShims&&(mini_useShims=!1),"undefined"==typeof mini_ajaxAsyncInvoke&&(mini_ajaxAsyncInvoke=!0),mini_regClass=function(t,e){e=e.toLowerCase(),mini.classes[e]||((mini.classes[e]=t).prototype.type=e);e=t.prototype.uiCls;mini.isNull(e)||mini.uiClasses[e]||(mini.uiClasses[e]=t)},mini_extend=function(t,e,i){if("function"!=typeof e)return this;var t=t,n=t.prototype,s=e.prototype;if(t.superclass!=s){for(var o in t.superclass=s,t.superclass.constructor=e,s)n[o]=s[o];if(i)for(var o in i)n[o]=i[o];return t}},mini.copyTo(mini,{extend:mini_extend,regClass:mini_regClass,debug:!1}),mini.namespace=function(t){if("string"==typeof t){t=t.split(".");for(var e=window,i=0,n=t.length;i<n;i++)var s=t[i],e=e[s]||(e[s]={})}},mini._BindCallbacks=[],mini._BindEvents=function(t,e){mini._BindCallbacks.push([t,e]),mini._EventTimer||(mini._EventTimer=setTimeout(function(){mini._FireBindEvents()},50))},mini._FireBindEvents=function(){for(var t=0,e=mini._BindCallbacks.length;t<e;t++){var i=mini._BindCallbacks[t];i[0].call(i[1])}mini._BindCallbacks=[],mini._EventTimer=null},mini._getFunctoin=function(t){if("string"!=typeof t)return null;for(var e=t.split("."),i=null,n=0,s=e.length;n<s;n++){var o=e[n];if(!(i=(i||window)[o]))break}return i};var cacheParts={};function createPathParts(t){if(!(e=cacheParts[t])){for(var e,i=0,n=(e=t.split(".")).length;i<n;i++){var s=e[i],o=s.indexOf("[");-1<o&&(e[i]=s.substr(0,o),e.splice(++i,0,parseInt(s.substr(o+1))))}cacheParts[t]=e}return e}function getValueByPath(t,e){if(t&&e){if(e in t)return t[e];for(var i=createPathParts(e),n=0,s=i.length;n<s&&t;n++)t=t[i[n]];return t}}function listColumnRenderer(t){var e=t.column,i=mini.isNull(t.value)?"":String(t.value),n=i.split(","),s="text",o={},l=e.editor,r=e.__editor;if(l){r||"combobox"!=l.type&&"treeselect"!=l.type||(r=mini.isControl(l)?l:(l=mini.clone(l),mini.create(l)),t.column.__editor=r);var a=r.getValueField(),s=r.getTextField(),t=r.getData();if(!(o=e._valueMaps)||t!==e._data){for(var h=r.getList?r.getList():t,o={},d=0,u=h.length;d<u;d++)o[(c=h[d])[a]]=c;e._valueMaps=o,e._data=t}}for(var c,m,f=[],d=0,u=n.length;d<u;d++)(c=o[n[d]])&&(null!==(m=c[s])&&m!==undefined||(m=""),f.push(m));return 0==f.length&&!1===e.valueFromSelect?i:f.join(",")}mini._getMap=function(t,e){if(!t||!e)return undefined;if((n=e[t])!==undefined)return n;var i=t.indexOf(".");if(-1==i&&-1==t.indexOf("["))return e[t];if(i==t.length-1)return e[t];try{var n=getValueByPath(e,t)}catch(s){return undefined}return n},mini._setMap=function(t,e,i){if(i&&"string"==typeof t){for(var n=t.split("."),s=null,o=0,l=n.length;o<=l-1;o++){var r,a,h,t=n[o];if(o==l-1){-1==t.indexOf("]")?i[t]=e:(d(i,a=(r=t.split("["))[0],h=parseInt(r[1]),""),i[a][h]=e);break}i=-1==t.indexOf("]")?(s=i[t],o<=l-2&&null==s&&(i[t]=s={}),s):d(i,a=(r=t.split("["))[0],h=parseInt(r[1]))}return e}function d(t,e,i,n){for(var s=(s=t[e])||(t[e]=[]),o=0;o<=i;o++)s[o]||(null===n||n===undefined?s[o]={}:s[o]=n);return t[e][i]}},mini.getAndCreate=function(t){return t?"string"==typeof t?mini.components[t]:"object"==typeof t?mini.isControl(t)?t:mini.isElement(t)?mini.uids[t.uid]:mini.create(t):null:null},mini.create=function(t){if(!t)return null;if(mini.get(t.id)===t)return t;var e=this.getClass(t.type);if(!e)return null;e=new e;return e.set(t),e},mini.Component=function(){this._events={},this.uid=mini.newId(this._idPre),this._id=this.uid,this.id||(this.id=this.uid),mini.reg(this)},mini.Component.prototype={isControl:!0,id:null,_idPre:"mini-",_idSet:!1,_canFire:!0,set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i,n,s=t.renderTo||t.render;for(n in delete t.renderTo,delete t.render,t)0==n.toLowerCase().indexOf("on")&&(this["_$"+n]||(i=t[n],this.on(n.substring(2,n.length).toLowerCase(),i),delete t[n]));for(n in t){var o=t[n],l=this["set"+n.charAt(0).toUpperCase()+n.substring(1,n.length)];l?l.call(this,o):this[n]=o}return s&&this.render&&this.render(s),this._allowLayout=e,this.doLayout&&this.doLayout(),this},fire:function(t,e){if(0!=this._canFire){t=t.toLowerCase();var i=this._events[t];if(i){(e=e||{})&&e!=this&&(e.source=e.sender=this,e.type||(e.type=t));for(var n=0,s=i.length;n<s;n++){var o=i[n];o&&o[0].apply(o[1],[e])}}}},on:function(t,e,i){if("function"!=typeof(e="string"==typeof e?mini._getFunctoin(e)||(n=mini.newId("__str_"),window[n]=e,new Function("e","var s = "+n+";var fn = mini._getFunctoin(s); if(fn) {fn.call(this, e)}else{eval(s);}")):e)||!t)return!1;t=t.toLowerCase();var n=(n=this._events[t])||(this._events[t]=[]);return this.findListener(t,e,i=i||this)||n.push([e,i]),this},un:function(t,e,i){t=t.toLowerCase();var n=this._events[t];return n&&(e?(i=this.findListener(t,e,i=i||this))&&n.remove(i):delete this._events[t]),this},findListener:function(t,e,i){t=t.toLowerCase(),i=i||this;var n=this._events[t];if(n)for(var s=0,o=n.length;s<o;s++){var l=n[s];if(l[0]===e&&l[1]===i)return l}},setId:function(t){if(!t)throw new Error("id not null");if(this._idSet)throw new Error("id just set only one");mini.unreg(this),this.id=t,this.el&&(this.el.id=t),this._valueEl&&(this._valueEl.id=t+"$value"),this._textEl&&(this._textEl.id=t+"$text"),this._idSet=!0,mini.reg(this)},getId:function(){return this.id},destroy:function(){mini.unreg(this),this.fire("destroy"),this._events={}}},mini.Control=function(t){mini.Control.superclass.constructor.apply(this,arguments),this._create(),this.el.uid=this.uid,this._initEvents(),this._clearBorder&&(this.el.style.borderWidth="0"),this.addCls(this.uiCls),this.setWidth(this.width),this.setHeight(this.height),this.el.style.display=this.visible?this._displayStyle:"none",t&&mini.applyTo.call(this,t)},mini.extend(mini.Control,mini.Component,{jsName:null,width:"",height:"",visible:!0,readOnly:!1,enabled:!0,tooltip:"",_readOnlyCls:"mini-readonly",_disabledCls:"mini-disabled",_create:function(){this.el=document.createElement("div")},_initEvents:function(){},within:function(t){return!!mini.isAncestor(this.el,t.target)},name:"",setName:function(t){this.name=t},getName:function(){return this.name},isAutoHeight:function(){var t=this.el.style.height;return"auto"==t||""==t},isAutoWidth:function(){var t=this.el.style.width;return"auto"==t||""==t},isFixedSize:function(){var t=this.width,e=this.height;return parseInt(t)+"px"==t&&parseInt(e)+"px"==e},isRender:function(t){return!!(this.el&&this.el.parentNode&&this.el.parentNode.tagName)},render:function(t,e){(t="string"==typeof t?"#body"==t?document.body:mini.byId(t):t)&&("before"==(e=(e=e||"append").toLowerCase())?jQuery(t).before(this.el):"prepend"==e?jQuery(t).prepend(this.el):"after"==e?jQuery(t).after(this.el):t.appendChild(this.el),this.el.id=this.id,this.doLayout(),this.fire("render"))},getEl:function(){return this.el},setJsName:function(t){this.jsName=t,window[t]=this},getJsName:function(){return this.jsName},setTooltip:function(t){this.tooltip=t,this.el.title=t,this.tooltipPlacement&&jQuery(this.el).attr("data-placement",this.tooltipPlacement)},getTooltip:function(){return this.tooltip},_sizeChanged:function(){this.doLayout()},setWidth:function(t){parseInt(t)==t&&(t+="px"),this.width=t,this.el.style.width=t,this._sizeChanged()},getWidth:function(t){var e=this.el,e=t?jQuery(e).width():jQuery(e).outerWidth();return e=t&&this._borderEl?e-(t=mini.getBorders(this._borderEl)).left-t.right:e},setHeight:function(t){parseInt(t)==t&&(t+="px"),this.height=t,this.el.style.height=t,this._sizeChanged()},getHeight:function(t){var e=t?jQuery(this.el).height():jQuery(this.el).outerHeight();return e=t&&this._borderEl?e-(t=mini.getBorders(this._borderEl)).top-t.bottom:e},getBox:function(){return mini.getBox(this.el)},setBorderStyle:function(t){var e=this._borderEl||this.el;mini.setStyle(e,t),this.doLayout()},getBorderStyle:function(){return this.borderStyle},_clearBorder:!0,setStyle:function(t){this.style=t,mini.setStyle(this.el,t),this._clearBorder&&(this.el.style.borderWidth="0",this.el.style.padding="0px"),this.width=this.el.style.width,this.height=this.el.style.height,this._sizeChanged()},getStyle:function(){return this.style},setCls:function(t){this.addCls(t)},getCls:function(){return this.cls},addCls:function(t){mini.addClass(this.el,t)},removeCls:function(t){mini.removeClass(this.el,t)},_doReadOnly:function(){this.readOnly?this.addCls(this._readOnlyCls):this.removeCls(this._readOnlyCls)},setReadOnly:function(t){this.readOnly=t,this._doReadOnly()},getReadOnly:function(){return this.readOnly},getParent:function(t){for(var e=document,i=this.el.parentNode;i!=e&&null!=i;){var n=mini.get(i);if(n){if(!mini.isControl(n))return null;if(!t||n.uiCls==t)return n}i=i.parentNode}return null},isReadOnly:function(){if(this.readOnly||!this.enabled)return!0;var t=this.getParent();return!!t&&t.isReadOnly()},setEnabled:function(t){this.enabled=t,this.enabled?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),this._doReadOnly()},getEnabled:function(){return this.enabled},enable:function(){this.setEnabled(!0)},disable:function(){this.setEnabled(!1)},_displayStyle:"",setVisible:function(t){this.visible=t,this.el&&(this.el.style.display=t?this._displayStyle:"none",this.doLayout())},getVisible:function(){return this.visible},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},isDisplay:function(t){if(0==mini.WindowVisible||!this.el)return!1;for(var e=document.body,i=this.el;;){if(null==i||!i.style)return!1;if(i&&i.style&&"none"==i.style.display){if(!t)return!1;if(!0!==t(i))return!1}if(i==e)return!0;i=i.parentNode}return!0},_allowUpdate:!0,beginUpdate:function(){this._allowUpdate=!1},endUpdate:function(){this._allowUpdate=!0,this.doUpdate()},doUpdate:function(){},canLayout:function(){return!!mini.enableLayout&&(0!=this._allowLayout&&this.isDisplay())},doLayout:function(){},layoutChanged:function(){0!=this.canLayout()&&this.doLayout()},_destroyChildren:function(t){if(this.el)for(var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++){var s=e[i];!0!==s.destroyed&&s.destroy(t)}},destroy:function(t){var e;!0!==this.destroyed&&(mini._destroying||this._destroyChildren(t)),this.el&&((e=this.el).onclick=e.ondblclick=e.onmousedown=e.onmouseup=e.onmousemove=e.onmouseover=e.onmouseout=e.onkeydown=e.onkeyup=e.oncontextmenu=null,mini.clearEvent(e),!1!==t&&mini.removeNode(e)),this._borderEl=this._contentEl=this._valueEl=this._textEl=this._errorIconEl=null,this.el=null,mini.unreg(this),this.destroyed=!0,this.fire("destroy")},focus:function(){try{this.el.focus()}catch(t){}},blur:function(){try{this.el.blur()}catch(t){}},allowAnim:!0,setAllowAnim:function(t){this.allowAnim=t},getAllowAnim:function(){return this.allowAnim},_getMaskWrapEl:function(){return this.el},mask:function(t){(t=(t="string"==typeof t?{html:t}:t)||{}).el=this._getMaskWrapEl(),t.cls||(t.cls=this._maskCls),mini.mask(t)},unmask:function(){mini.unmask(this._getMaskWrapEl()),this.isLoading=!1},_maskCls:"mini-mask-loading",loadingMsg:"Loading...",loading:function(t){this.mask(t||this.loadingMsg)},setLoadingMsg:function(t){this.loadingMsg=t},getLoadingMsg:function(){return this.loadingMsg},_getContextMenu:function(t){var e=t;return"string"==typeof t?(e=mini.get(t))||(mini.parse(t),e=mini.get(t)):mini.isArray(t)?e={type:"menu",items:t}:mini.isControl(t)||(e=mini.create(t)),e},__OnHtmlContextMenu:function(t){var e={popupEl:this.el,htmlEvent:t,cancel:!1};if(this.contextMenu.fire("BeforeOpen",e),1!=e.cancel&&(this.contextMenu.fire("opening",e),1!=e.cancel))return this.contextMenu.showAtPos(t.pageX,t.pageY),this.contextMenu.fire("Open",e),!1},contextMenu:null,setContextMenu:function(t){t=this._getContextMenu(t);t&&this.contextMenu!==t&&(this.contextMenu=t,mini.addClass(t.el,"mini-menu-open"),this.contextMenu.owner=this,mini.on(this.el,"contextmenu",this.__OnHtmlContextMenu,this))},getContextMenu:function(){return this.contextMenu},setDefaultValue:function(t){this.defaultValue=t},getDefaultValue:function(){return this.defaultValue},setValue:function(t){this.value=t},getValue:function(){return this.value},ajaxData:null,ajaxType:"",ajaxOptions:null,setAjaxOptions:function(t){this.ajaxOptions=t},getAjaxOptions:function(){return this.ajaxOptions},setAjaxData:function(t){this.ajaxData=t},getAjaxData:function(){return this.ajaxData},setAjaxType:function(t){this.ajaxType=t},getAjaxType:function(){return this.ajaxType},_afterApply:function(t){},dataField:"",setDataField:function(t){this.dataField=t},getDataField:function(){return this.dataField},tabIndex:0,setTabIndex:function(t){(this._textEl||this.el).tabIndex=t,this.tabIndex=t},getTabIndex:function(){return this.tabIndex},getAttrs:function(t){var e={},i=t.className;i&&(e.cls=i),t.value&&(e.value=t.value),mini._ParseString(t,e,["id","name","width","height","borderStyle","value","defaultValue","tabIndex","contextMenu","tooltip","ondestroy","data-options","ajaxData","ajaxType","dataField","ajaxOptions","data-placement"]),e["data-placement"]&&(this.tooltipPlacement=e["data-placement"]),mini._ParseBool(t,e,["visible","enabled","readOnly"]),t.readOnly&&"false"!=t.readOnly&&(e.readOnly=!0);i=t.style.cssText;i&&(e.style=i),!isIE9||(a=t.style.background)&&(e.style||(e.style=""),e.style+=";background:"+a),this.style&&(e.style?e.style=this.style+";"+e.style:e.style=this.style),this.borderStyle&&(e.borderStyle?e.borderStyle=this.borderStyle+";"+e.borderStyle:e.borderStyle=this.borderStyle),"string"==typeof e.ajaxOptions&&(e.ajaxOptions=window.eval("("+e.ajaxOptions+")"));var n=mini._attrs;if(n)for(var s=0,o=n.length;s<o;s++){var l=n[s],r=l[0],l=l[1];"string"==(l=l||"string")?mini._ParseString(t,e,[r]):"bool"==l?mini._ParseBool(t,e,[r]):"int"==l&&mini._ParseInt(t,e,[r])}var a=e["data-options"];return(a=a&&window.eval("("+a+")"))&&mini.copyTo(e,a),e}}),mini._attrs=null,mini.regHtmlAttr=function(t,e){t&&(e=e||"string",mini._attrs||(mini._attrs=[]),mini._attrs.push([t,e]))},__mini_setControls=function(t,e,i){e=e||this._contentEl,i=i||this,t=t||[];for(var n=0,s=(t=!mini.isArray(t)?[t]:t).length;n<s;n++){var o=t[n];"string"==typeof o?0==o.indexOf("#")&&(o=mini.byId(o)):mini.isElement(o)||(o=(o=mini.getAndCreate(o)).el),o&&mini.append(e,o)}return mini.parse(e),i.doLayout(),i},mini.Container=function(){mini.Container.superclass.constructor.apply(this,arguments),this._contentEl||(this._contentEl=this.el)},mini.extend(mini.Container,mini.Control,{setControls:__mini_setControls,getContentEl:function(){return this._contentEl},getBodyEl:function(){return this._contentEl},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++)if(e[i].within(t))return!0;return!1}}),mini.ValidatorBase=function(){mini.ValidatorBase.superclass.constructor.apply(this,arguments)},mini.extend(mini.ValidatorBase,mini.Control,{required:!1,requiredErrorText:"This field is required.",_requiredCls:"mini-required",errorText:"",_errorCls:"mini-error",_invalidCls:"mini-invalid",errorMode:"icon",validateOnChanged:!0,validateOnLeave:!0,_IsValid:!0,forceValidate:!1,setForceValidate:function(t){this.forceValidate=t},getForceValidate:function(){return this.forceValidate},keyNavEnabled:!0,setKeyNavEnabled:function(t){this.keyNavEnabled=t},getKeyNavEnabled:function(){return this.keyNavEnabled},indentSpace:!1,_indentCls:"mini-indent",setIndentSpace:function(t){t?this.addCls(this._indentCls):this.removeCls(this._indentCls),this.indentSpace=t},getIndentSpace:function(){return this.indentSpace},isEditable:function(){return!(this.readOnly||!this.allowInput||!this.enabled)},_tryValidate:function(){this._tryValidateTimer&&clearTimeout(this._tryValidateTimer);var t=this;this._tryValidateTimer=setTimeout(function(){t.validate()},30)},validate:function(){var t={value:this.getValue(),errorText:"",isValid:!0};return this.required&&(!mini.isNull(t.value)&&""!==String(t.value).trim()||(t.isValid=!1,t.errorText=this.requiredErrorText)),this.fire("validation",t),this.errorText=t.errorText,this.setIsValid(t.isValid),this.isValid()},isValid:function(){return this._IsValid},setIsValid:function(t){this._IsValid=t,this.doUpdateValid()},getIsValid:function(){return this._IsValid},setValidateOnChanged:function(t){this.validateOnChanged=t},getValidateOnChanged:function(t){return this.validateOnChanged},setValidateOnLeave:function(t){this.validateOnLeave=t},getValidateOnLeave:function(t){return this.validateOnLeave},setErrorMode:function(t){this.errorMode=(t=t||"none").toLowerCase(),0==this._IsValid&&this.doUpdateValid()},getErrorMode:function(){return this.errorMode},setErrorText:function(t){this.errorText=t,0==this._IsValid&&this.doUpdateValid()},getErrorText:function(){return this.errorText},setRequired:function(t){this.required=t,this.required?this.addCls(this._requiredCls):this.removeCls(this._requiredCls)},getRequired:function(){return this.required},setRequiredErrorText:function(t){this.requiredErrorText=t},getRequiredErrorText:function(){return this.requiredErrorText},errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl},_RemoveErrorIcon:function(){},doUpdateValid:function(){this.__doUpdateValid()},errorTooltipPlacement:"right",__doUpdateValid:function(){if(this.el){if(this.removeCls(this._errorCls),this.removeCls(this._invalidCls),"border"==this.errorMode&&(this.el.title=""),0==this._IsValid)switch(this.errorMode){case"icon":this.addCls(this._errorCls);var t=this.getErrorIconEl();t&&(t.title=this.errorText,jQuery(t).attr("data-placement",this.errorTooltipPlacement));break;case"border":this.addCls(this._invalidCls),this.el.title=this.errorText;default:this._RemoveErrorIcon()}else this._RemoveErrorIcon();this.doLayout()}},doValueChanged:function(){this._OnValueChanged()},_OnValueChanged:function(){this.validateOnChanged&&this._tryValidate(),this.fire("valuechanged",{value:this.getValue(),oldValue:this._oldValue}),this._oldValue=this.getValue()},onValueChanged:function(t,e){this.on("valuechanged",t,e)},onValidation:function(t,e){this.on("validation",t,e)},getAttrs:function(t){var e=mini.ValidatorBase.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["onvaluechanged","onvalidation","label","labelStyle","requiredErrorText","errorMode","errorTooltipPlacement"]),mini._ParseBool(t,e,["validateOnChanged","validateOnLeave","labelField","indentSpace","keyNavEnabled","forceValidate"]);var i=t.getAttribute("required");return(i=i||t.required)||(t=t.attributes.required)&&(i="null"==t.value?null:"true"),i&&(e.required="false"!=i),e},_labelLayout:function(){var t,e=this._borderEl;e&&(this._labelLayouted=!0,this.labelField?(t=this._labelEl.offsetWidth,e.style.marginLeft=t+"px",this._doLabelLayout=0===t):e.style.marginLeft=0)},_labelFieldCls:"mini-labelfield",labelField:!1,label:"",labelStyle:"",setLabelField:function(t){this.labelField!=t&&(this.labelField=t,this._borderEl&&(this._labelEl||(this._labelEl=mini.append(this.el,'<label class="mini-labelfield-label"></label>'),this._labelEl.innerHTML=this.label,mini.setStyle(this._labelEl,this.labelStyle)),this._labelEl.style.display=t?"block":"none",t?mini.addClass(this.el,this._labelFieldCls):mini.removeClass(this.el,this._labelFieldCls),this._labelLayout()))},getLabelField:function(){this.labelField},setLabel:function(t){this.label!=t&&(this.label=t,this._labelEl&&(this._labelEl.innerHTML=t),this._labelLayout())},getLabel:function(){this.label},setLabelStyle:function(t){this.labelStyle!=t&&(this.labelStyle=t,this._labelEl&&mini.setStyle(this._labelEl,t),this._labelLayout())},getLabelStyle:function(){this.labelStyle}}),mini.ListControl=function(t){this.data=[],this._selecteds=[],mini.ListControl.superclass.constructor.call(this,null),this.doUpdate(),t&&mini.applyTo.call(this,t)},mini.ListControl.ajaxType="get",mini.extend(mini.ListControl,mini.ValidatorBase,{defaultValue:"",value:"",valueField:"id",textField:"text",dataField:"",delimiter:",",setDelimiter:function(t){this.delimiter=t},getDelimiter:function(){return this.delimiter},data:null,url:"",valueInCheckOrder:!0,setValueInCheckOrder:function(t){this.valueInCheckOrder=t},getValueInCheckOrder:function(){return this.valueInCheckOrder},_itemCls:"mini-list-item",_itemHoverCls:"mini-list-item-hover",_itemSelectedCls:"mini-list-item-selected",doLayout:function(){this._doLabelLayout&&this._labelLayout()},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.url;delete t.url;var n=t.data;return delete t.data,mini.ListControl.superclass.set.call(this,t),mini.isNull(n)||this.setData(n),mini.isNull(i)||this.setUrl(i),mini.isNull(e)||this.setValue(e),this},uiCls:"mini-list",_create:function(){},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"click",this.__OnClick,this),mini_onOne(this.el,"dblclick",this.__OnDblClick,this),mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"mouseup",this.__OnMouseUp,this),mini_onOne(this.el,"mousemove",this.__OnMouseMove,this),mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this),mini_onOne(this.el,"keydown",this.__OnKeyDown,this),mini_onOne(this.el,"keyup",this.__OnKeyUp,this),mini_onOne(this.el,"contextmenu",this.__OnContextMenu,this)},this)},destroy:function(t){mini.ListControl.superclass.destroy.call(this,t)},name:"",setName:function(t){this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name)},getItemByEvent:function(t){t=mini.findParent(t.target,this._itemCls);if(t){t=parseInt(mini.getAttr(t,"index"));return this.data[t]}},addItemCls:function(t,e){t=this.getItemEl(t);t&&mini.addClass(t,e)},removeItemCls:function(t,e){t=this.getItemEl(t);t&&mini.removeClass(t,e)},getItemEl:function(t){t=this.getItem(t);t=this.data.indexOf(t),t=this._createItemId(t);return document.getElementById(t)},_focusItem:function(t,e){var i;(t=this.getItem(t))&&(i=this.getItemEl(t),e&&i&&this.scrollIntoView(t),this._focusedItem!=t&&(this._blurItem(),this._focusedItem=t),i&&mini.addClass(i,this._itemHoverCls))},_blurItem:function(){var t;this._focusedItem&&((t=this.getItemEl(this._focusedItem))&&mini.removeClass(t,this._itemHoverCls),this._focusedItem=null)},getFocusedItem:function(){var t=this._focusedItem;return-1==this.indexOf(t)?null:t},getFocusedIndex:function(){return this.data.indexOf(this._focusedItem)},_scrollViewEl:null,scrollIntoView:function(t){try{var e=this.getItemEl(t),i=this._scrollViewEl||this.el;mini.scrollIntoView(e,i,!1)}catch(n){}},getItem:function(t){return"object"==typeof t?t:"number"==typeof t?this.data[t]:this.findItems(t)[0]},getCount:function(){return this.data.length},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},updateItem:function(t,e){(t=this.getItem(t))&&(mini.copyTo(t,e),this.doUpdate())},load:function(t){"string"==typeof t?this.setUrl(t):this.setData(t)},loadData:function(t){this.setData(t)},setData:function(t){"string"==typeof t&&(t=window.eval(t)),mini.isArray(t)||(t=[]),this.data=t,this.doUpdate(),""!=this.value&&(this.deselectAll(),t=this.findItems(this.value),this.selects(t))},getData:function(){return this.data.clone()},setUrl:function(t){this.url=t,this._doLoad({})},getUrl:function(){return this.url},ajaxData:null,_doLoad:function(t){try{(o=window.eval(this.url))!=undefined&&(this.url=o)}catch(r){}var o=this.url,e=mini.ListControl.ajaxType;o&&(-1==o.indexOf(".txt")&&-1==o.indexOf(".json")||(e="get"));var i=mini._evalAjaxData(this.ajaxData,this);mini.copyTo(t,i);var l,r={url:this.url,"async":!1,type:this.ajaxType||e,data:t,params:t,cache:!1,cancel:!1};jQuery.extend(!0,r,this.ajaxOptions),this.fire("beforeload",r),r.data!=r.params&&r.params!=t&&(r.data=r.params),1!=r.cancel&&(l=me=this,o=r.url,mini.copyTo(r,{success:function(t,e,i){delete r.params;var n={text:t,result:null,sender:me,options:r,xhr:i},i=null;try{mini_doload(n),i=(i=n.result)||mini.decode(t)}catch(s){1==mini_debugger&&alert(o+"\njson is error.")}mini.isArray(i)&&(i={data:i}),l.dataField&&(i.data=mini._getMap(l.dataField,i)),i.data||(i.data=[]);var s={data:i.data,cancel:!1,result:i};l.fire("preload",s),1!=s.cancel&&(l.setData(s.data),delete s.cancel,l.fire("load",s),setTimeout(function(){l.doLayout()},100))},error:function(t,e,i){t={xhr:t,text:t.responseText,textStatus:e,errorMsg:t.responseText,errorCode:t.status};1==mini_debugger&&alert(o+"\n"+t.errorCode+"\n"+t.errorMsg),l.fire("loaderror",t)}}),this._ajaxer=mini.ajax(r))},setValue:function(t){mini.isNull(t)&&(t=""),this.deselectAll(),this.value=t,this._valueEl&&(this._valueEl.value=t);t=this.findItems(this.value);this.selects(t),this.setSelected(t[0])},getValue:function(){return this.value},getFormValue:function(){return this.value},setValueField:function(t){this.valueField=t},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},getItemValue:function(t){return String(mini._getMap(this.valueField,t))},getItemText:function(t){t=mini._getMap(this.textField,t);return mini.isNull(t)?"":String(t)},getValueAndText:function(t){var i;mini.isNull(t)&&(t=[]),mini.isArray(t)||(t=this.findItems(t)),this.valueInCheckOrder&&(i=this.getData(),mini.sort(t,function(t,e){t=i.indexOf(t),e=i.indexOf(e);return e<t?1:t<e?-1:0}));for(var e=[],n=[],s=0,o=t.length;s<o;s++){var l=t[s];l&&(e.push(this.getItemValue(l)),n.push(this.getItemText(l)))}return[e.join(this.delimiter),n.join(this.delimiter)]},findItems:function(t){if(mini.isNull(t)||""===t)return[];if("function"==typeof t){for(var e=t,i=[],n=0,s=(o=this.data).length;n<s;n++)!0===e(a=o[n],n)&&i.push(a);return i}for(var o,l=String(t).split(this.delimiter),r={},n=0,s=(o=this.data).length;n<s;n++){var a=o[n];r[mini._getMap(this.valueField,a)]=a}for(var h=[],d=0,u=l.length;d<u;d++)(a=r[l[d]])&&h.push(a);return h},removeAll:function(){var t=this.getData();this.removeItems(t)},addItems:function(t,e){mini.isArray(t)&&(mini.isNull(e)&&(e=this.data.length),this.data.insertRange(e,t),this.doUpdate())},addItem:function(t,e){t&&-1==this.data.indexOf(t)&&(mini.isNull(e)&&(e=this.data.length),this.data.insert(e,t),this.doUpdate())},removeItems:function(t){mini.isArray(t)&&(this.data.removeRange(t),this._checkSelecteds(),this.doUpdate())},removeItem:function(t){t=this.data.indexOf(t);-1!=t&&(this.data.removeAt(t),this._checkSelecteds(),this.doUpdate())},moveItem:function(t,e){t&&mini.isNumber(e)&&((e=e<0?0:e)>this.data.length&&(e=this.data.length),this.data.remove(t),this.data.insert(e,t),this.doUpdate())},_isSelectedAll:function(){for(var t=this.getData(),e=0,i=t.length;e<i;e++){var n=t[e];if(!1!==n.enabled&&!this.isSelected(n))return!1}return!0},_selected:null,_selecteds:[],multiSelect:!1,_checkSelecteds:function(){for(var t=this._selecteds.length-1;0<=t;t--){var e=this._selecteds[t];-1==this.data.indexOf(e)&&this._selecteds.removeAt(t)}this._selected&&-1==this.data.indexOf(this._selected)&&(this._selected=null);var i=this.getValueAndText(this._selecteds);this.value=i[0],this._valueEl&&(this._valueEl.value=this.value)},setMultiSelect:function(t){this.multiSelect=t},getMultiSelect:function(){return this.multiSelect},isSelected:function(t){return!!t&&-1!=this._selecteds.indexOf(t)},getSelecteds:function(){var t=this._selecteds.clone(),i=this;return this.valueInCheckOrder&&mini.sort(t,function(t,e){t=i.indexOf(t),e=i.indexOf(e);return e<t?1:t<e?-1:0}),t},setSelected:function(t){t&&(this._selected=t,this.select(t))},getSelected:function(){return this._selected},select:function(t){(t=this.getItem(t))&&(this.isSelected(t)||(this._selected=t,this.selects([t])))},deselect:function(t){(t=this.getItem(t))&&this.isSelected(t)&&this.deselects([t])},selectAll:function(){var t=this.data.clone();this.selects(t)},deselectAll:function(){this.deselects(this._selecteds)},clearSelect:function(){this.deselectAll()},selects:function(t){if(t&&0!=t.length){t=t.clone(),0==this.multiSelect&&1<t.length&&(t.length=1);for(var e=0,i=t.length;e<i;e++){var n=t[e];this.isSelected(n)||this._selecteds.push(n)}this._doSelects()}},deselects:function(t){if(t&&0!=t.length){for(var e=(t=t.clone()).length-1;0<=e;e--){var i=t[e];this.isSelected(i)&&this._selecteds.remove(i)}this._doSelects()}},_doSelects:function(){var t=this.getValueAndText(this._selecteds);this.value=t[0],this._valueEl&&(this._valueEl.value=this.value);for(var e=0,i=this.data.length;e<i;e++){var n=this.data[e],s=this.isSelected(n);s?this.addItemCls(n,this._itemSelectedCls):this.removeItemCls(n,this._itemSelectedCls);n=this.data.indexOf(n),n=this._createCheckId(n),n=mini.byId(n,this.el);n&&(n.checked=!!s)}},_OnSelectionChanged:function(t,e){var i=this.getValueAndText(this._selecteds);this.value=i[0],this._valueEl&&(this._valueEl.value=this.value);i={selecteds:this.getSelecteds(),selected:this.getSelected(),value:this.getValue()};this.fire("SelectionChanged",i)},_createCheckId:function(t){return this.uid+"$ck$"+t},_createItemId:function(t){return this.uid+"$"+t},__OnClick:function(t){this._clickTime&&new Date-this._clickTime<100||(this._clickTime=new Date,this._fireEvent(t,"Click"))},__OnDblClick:function(t){this._fireEvent(t,"Dblclick")},__OnMouseDown:function(t){this._fireEvent(t,"MouseDown")},__OnMouseUp:function(t){this._fireEvent(t,"MouseUp")},__OnMouseMove:function(t){this._fireEvent(t,"MouseMove")},__OnMouseOver:function(t){this._fireEvent(t,"MouseOver")},__OnMouseOut:function(t){this._fireEvent(t,"MouseOut")},__OnKeyDown:function(t){this._fireEvent(t,"KeyDown")},__OnKeyUp:function(t){this._fireEvent(t,"KeyUp")},__OnContextMenu:function(t){this._fireEvent(t,"ContextMenu")},_fireEvent:function(t,e){var i,n;!this.enabled||(i=this.getItemByEvent(t))&&((n=this["_OnItem"+e])?n.call(this,i,t):this.fire("item"+e,{item:i,htmlEvent:t}))},allowDeselect:!1,setAllowDeselect:function(t){this.allowDeselect=t},getAllowDeselect:function(){return this.allowDeselect},_OnItemClick:function(t,e){var i,n;this.isReadOnly()||0==this.enabled||!1===t.enabled?e.preventDefault():(i=this.getValue(),this.fire("beforeselect",n={item:t,htmlEvent:e,cancel:!1}),this.fire("beforeitemclick",e={item:t,htmlEvent:e,cancel:!1}),e.cancel||(0==n.cancel&&(this._oldValue=i,this.multiSelect?(this.isSelected(t)?(this.deselect(t),this._selected==t&&(this._selected=null)):(this.select(t),this._selected=t),t.__NullItem&&(this.deselectAll(),this._selected=null),this._OnSelectionChanged()):this.isSelected(t)?this.allowDeselect&&0==this.multiSelect&&(this.deselectAll(),this._OnSelectionChanged()):(this.deselectAll(),this.select(t),this._selected=t,this._OnSelectionChanged()),i!=this.getValue()&&this._OnValueChanged()),this.fire("itemclick",e={item:t,htmlEvent:e})))},_blurOnOut:!0,_OnItemMouseOut:function(t,e){this.enabled&&(this._blurOnOut&&this._blurItem(),this.fire("itemmouseout",e={item:t,htmlEvent:e}))},_OnItemMouseMove:function(t,e){this.enabled&&!1!==t.enabled&&(this._focusItem(t),this.fire("itemmousemove",e={item:t,htmlEvent:e}))},onItemClick:function(t,e){this.on("itemclick",t,e)},onItemMouseDown:function(t,e){this.on("itemmousedown",t,e)},onBeforeLoad:function(t,e){this.on("beforeload",t,e)},onLoad:function(t,e){this.on("load",t,e)},onLoadError:function(t,e){this.on("loaderror",t,e)},onPreLoad:function(t,e){this.on("preload",t,e)},getText:function(){var t=this.getSelecteds();if(0==t.length)return"";for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i],o=this.getTextField();e.push(s[o])}return e.join(",")},getAttrs:function(t){var e=mini.ListControl.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["url","data","value","textField","valueField","onitemclick","onitemmousemove","onselectionchanged","onitemdblclick","onbeforeload","onload","onloaderror","ondataload","onbeforeselect","delimiter"]),mini._ParseBool(t,e,["multiSelect","valueInCheckOrder","allowDeselect"]);var i=e.valueField||this.valueField,n=e.textField||this.textField;if("select"==t.nodeName.toLowerCase()){for(var s=[],o=0,l=t.length;o<l;o++){var r=t.options[o],a={};a[n]=r.text,a[i]=r.value,s.push(a)}0<s.length&&(e.data=s)}return e}}),mini._Layouts={},mini.layout=function(t,r){mini.enableLayout&&document.body&&(function a(t){if(t){var e=mini.get(t);if(e)e.doLayout&&(mini._Layouts[e.uid]||(mini._Layouts[e.uid]=e,!1===r&&0!=e.isFixedSize()||e.doLayout(!1),delete mini._Layouts[e.uid]));else{var i=t.childNodes;if(i)for(var n=0,s=i.length;n<s;n++){var o=i[n];try{o.toString()}catch(l){continue}a(o)}}}}(t=t||document.body),t==document.body&&mini.layoutIFrames())},mini.applyTo=function(t){if(!(t=mini.byId(t)))return this;if(mini.get(t))throw new Error("not applyTo a mini control");var e=this.getAttrs(t);delete e._applyTo,mini.isNull(e.defaultValue)&&!mini.isNull(e.value)&&(e.defaultValue=e.value),mini.isNull(e.defaultText)&&!mini.isNull(e.text)&&(e.defaultText=e.text);var i=t.parentNode;return i&&this.el!=t&&i.replaceChild(this.el,t),window._mini_set&&_mini_set(e,this),this.set(e),this._afterApply(t),this},mini._doParse=function(t){if(t){var e=t.nodeName.toLowerCase();if(e&&null==jQuery(t).attr("noparser")){var i=String(t.className);if(i)if(!mini.get(t))for(var n=i.split(" "),s=0,o=n.length;s<o;s++){var l=n[s],r=mini.getClassByUICls(l);if(r){mini.removeClass(t,l);r=new r;mini.applyTo.call(r,t),t=r.el;break}}if(!("select"==e||mini.hasClass(t,"mini-menu")||mini.hasClass(t,"mini-datagrid")||mini.hasClass(t,"mini-treegrid")||mini.hasClass(t,"mini-tree")||mini.hasClass(t,"mini-button")||mini.hasClass(t,"mini-textbox")||mini.hasClass(t,"mini-buttonedit")))for(var a=mini.getChildNodes(t,!0),s=0,o=a.length;s<o;s++){var h=a[s];1==h.nodeType&&h.parentNode==t&&mini._doParse(h)}}}},mini._Removes=[],mini._firstParse=!0,mini.parse=function(t,e){if(mini.parsed=!0,mini._firstParse){mini._firstParse=!1;for(var i=document.getElementsByTagName("iframe"),s=[],n=0,o=i.length;n<o;n++){var l=i[n];s.push(l)}for(n=0,o=s.length;n<o;n++){var l=s[n],r=jQuery(l).attr("src");r&&(l.loaded=!1,l._onload=l.onload,l._src=r,l.onload=function(){},l.src="")}setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t];i._src&&""==jQuery(i).attr("src")&&(i.loaded=!0,i.onload=i._onload,i.src=i._src,i._src=i._onload=null)}},20),setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t],n=jQuery(i).attr("data-src");n&&(i.src=n)}},30)}"string"==typeof t&&(a=t,t=(t=mini.byId(a))||document.body),t=(t=t&&!mini.isElement(t)?t.el:t)||document.body;var a=mini.WindowVisible;isIE&&(mini.WindowVisible=!1),mini._doParse(t),mini.WindowVisible=a,!1!==e&&mini.layout(t)},mini._ParseString=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],l=mini.getAttr(t,o);l&&(e[o]=l)}},mini._ParseBool=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],l=mini.getAttr(t,o);l&&(e[o]="true"==l)}},mini._ParseInt=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],l=parseInt(mini.getAttr(t,o));isNaN(l)||(e[o]=l)}},mini._ParseColumns=function(t){for(var e=[],i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],l={},r=null,a=null,h=mini.getChildNodes(o);if(h)for(var d=0,u=h.length;d<u;d++){var c=h[d],m=mini.getAttr(c,"property");if(m&&("columns"==(m=m.toLowerCase())&&(l.columns=mini._ParseColumns(c),c.parentNode&&c.parentNode.removeChild(c)),"editor"==m||"filter"==m)){for(var f=c.className.split(" "),p=0,g=f.length;p<g;p++){var _=f[p],_=mini.getClassByUICls(_);if(_){_=new _;"filter"==m?(a=_.getAttrs(c)).type=_.type:(r=_.getAttrs(c)).type=_.type;break}}c.parentNode&&c.parentNode.removeChild(c)}}if(l.header=o.innerHTML,mini._ParseString(o,l,["name","header","field","editor","filter","renderer","width","type","renderer","headerAlign","align","headerCls","cellCls","headerStyle","cellStyle","displayField","dateFormat","listFormat","mapFormat","numberFormat","trueValue","falseValue","dataType","vtype","currencyUnit","summaryType","summaryRenderer","groupSummaryType","groupSummaryRenderer","defaultValue","defaultText","decimalPlaces","data-options","sortField","sortType"]),mini._ParseBool(o,l,["allowCellWrap","visible","readOnly","allowSort","allowResize","allowMove","allowDrag","autoShowPopup","unique","autoEscape","enabled","hideable","showCellTip","valueFromSelect","navUpdown"]),mini._ParseInt(o,l,["minWidth"]),r&&(l.editor=r),a&&(l.filter=a),"string"==typeof l.editor)try{l.editor=window.eval("("+l.editor+")")}catch(v){}l.dataType&&(l.dataType=l.dataType.toLowerCase()),"true"===l.defaultValue&&(l.defaultValue=!0),"false"===l.defaultValue&&(l.defaultValue=!1),e.push(l);o=l["data-options"];(o=o&&window.eval("("+o+")"))&&mini.copyTo(l,o)}return e},mini._Columns={},mini._getColumn=function(t){t=mini._Columns[t.toLowerCase()];return t?t():{}},mini.IndexColumn=function(t){return mini.copyTo({ignoreCollapseIndex:!1,width:30,cellCls:"",align:"center",draggable:!1,allowDrag:!0,hideable:!0,init:function(t){t.on("addrow",this.__OnIndexChanged,this),t.on("removerow",this.__OnIndexChanged,this),t.on("moverow",this.__OnIndexChanged,this),t.isTree&&(t.on("addnode",this.__OnIndexChanged,this),t.on("removenode",this.__OnIndexChanged,this),t.on("movenode",this.__OnIndexChanged,this),t.on("loadnode",this.__OnIndexChanged,this),this._gridUID=t.uid,this._rowIdField="_id")},getNumberId:function(t){return this._gridUID+"$number$"+t[this._rowIdField]},createNumber:function(t,e){return mini.isNull(t.pageIndex)?e+1:t.pageIndex*t.pageSize+e+1},renderer:function(t){var e=t.sender;this.draggable&&(t.cellStyle||(t.cellStyle=""),t.cellStyle+=";cursor:move;");var i='<div id="'+this.getNumberId(t.record)+'">',t=t.rowIndex;return this.ignoreCollapseIndex,mini.isNull(e.getPageIndex)?i+=t+1:i+=e.getPageIndex()*e.getPageSize()+t+1,i+="</div>"},__updateRowNumbers:function(t){for(var e=t.getDataView(),i=0,n=e.length;i<n;i++){var s=e[i],s=this.getNumberId(s),s=document.getElementById(s);s&&(s.innerHTML=this.createNumber(t,i))}},__OnIndexChanged:function(t){var e=t.sender,i=this;i._toIndex||(i._toIndex=setTimeout(function(){i._toIndex=null,i.__updateRowNumbers(e)},10))}},t)},mini._Columns.indexcolumn=mini.IndexColumn,mini.CheckColumn=function(t){return mini.copyTo({width:30,cellCls:"mini-checkcolumn",headerCls:"mini-checkcolumn",hideable:!0,_multiRowSelect:!0,header:function(t){var e=this.uid+"checkall",e='<span class="mini-grid-checkbox mini-icon '+(t._checkedAll?"mini-grid-checkbox-checked":"")+'" id="'+e+'"></span>';return e=0==this.multiSelect?"":e},getCheckId:function(t,e){return this._gridUID+"$checkcolumn$"+t[this._rowIdField]+"$"+e._id},init:function(t){t.on("_selectchange",this.__OnSelectionChanged,this),t.on("HeaderCellClick",this.__OnHeaderCellClick,this);var e=this;t.on("removerow",function(){t.data&&0==t.data.length&&e._doCheckState(t)});e=this;t.on("load",function(){t.uid;e._doCheckState(t)},this)},renderer:function(t){var e=this.getCheckId(t.record,t.column);t.sender.isSelected&&t.sender.isSelected(t.record);return'<span class="mini-grid-'+(t.sender.getMultiSelect()?"checkbox":"radio")+' mini-icon" id="'+e+'"></span>'},__OnHeaderCellClick:function(t){var e,i,n,s=t.sender;t.column==this&&(t=s.uid+"checkall",(e=document.getElementById(t))&&(i="mini-grid-checkbox-checked",t=!mini.hasClass(e,i),this._checkedAll=t,s.getMultiSelect()?t?(n=s.getDataView(),s.selects(n),mini.addClass(e,i),setTimeout(function(){mini.addClass(e,i)},30)):(n=s.getDataView(),s.deselects(n),mini.removeClass(e,i)):(s.deselectAll(),t&&(s.select(0),mini.addClass(e,i))),s.fire("checkall")))},__OnSelectionChanged:function(t){var e=t.sender,i=e.toArray(),n=this,s=e.isVirtualScroll(),t=e._viewRegion,o=s&&t?t.start:-1,t=t?t.end:-1,l={};if(-1!=o)for(var r=e.getVisibleRows(),a=o,h=t;a<h;a++){var d=r[a];d&&(l[d._id]=!0)}for(a=0,h=i.length;a<h;a++){var u=i[a];-1!=o&&l[u._id]}this._timer||(this._timer=setTimeout(function(){n._doCheckState(e),n._timer=null},10))},_doCheckState:function(t){var e=t.uid+"checkall",i=document.getElementById(e);i&&(e=t.getSelecteds(),t=(t.isTree?t.getList():t.getData()).length,e.length==t&&0!=t?jQuery(i).addClass("mini-grid-checkbox-checked"):jQuery(i).removeClass("mini-grid-checkbox-checked"))}},t)},mini._Columns.checkcolumn=mini.CheckColumn,mini.ExpandColumn=function(t){return mini.copyTo({width:30,headerAlign:"center",align:"center",draggable:!1,cellStyle:"padding:0",cellCls:"mini-grid-expandCell",hideable:!0,renderer:function(t){return'<a class="mini-grid-ecIcon mini-icon" href="javascript:#" onclick="return false"></a>'},init:function(t){t.on("cellclick",this.__OnCellClick,this)},__OnCellClick:function(t){var e=t.sender;if(t.column==this&&e.isShowRowDetail&&mini.findParent(t.htmlEvent.target,"mini-grid-ecIcon")){var i=e.isShowRowDetail(t.record);if(i){if(t.cancel=!1,e.fire("beforehiderowdetail",t),!0===t.cancel)return}else if(t.cancel=!1,e.fire("beforeshowrowdetail",t),!0===t.cancel)return;e.autoHideRowDetail&&e.hideAllRowDetail(),i?e.hideRowDetail(t.record):e.showRowDetail(t.record)}}},t)},mini._Columns.expandcolumn=mini.ExpandColumn,mini.CheckBoxColumn=function(t){return mini.copyTo({_type:"checkboxcolumn",editMode:"inline",header:"",headerAlign:"center",trueValue:!0,falseValue:!1,readOnly:!1,getCheckId:function(t,e){return this._gridUID+"$checkbox$"+t[this._rowIdField]+"$"+e._id},getCheckBoxEl:function(t,e){return document.getElementById(this.getCheckId(t,e))},isChecked:function(t,e){e=this.getCheckBoxEl(t,e);return jQuery(e).hasClass("mini-grid-checkbox-checked")},renderer:function(t){return'<span  id="'+this.getCheckId(t.record,t.column)+'" class="mini-grid-checkbox mini-icon '+(mini._getMap(t.field,t.record)==this.trueValue?"mini-grid-checkbox-checked":"")+'"></span>'},init:function(n){function s(t){var e;n.isReadOnly()||this.readOnly||(t.value=mini._getMap(t.field,t.record),n.fire("cellbeginedit",t),!0!==t.cancel&&(e=mini._getMap(t.column.field,t.record)==this.trueValue?this.falseValue:this.trueValue,n._OnCellCommitEdit&&(n._OnCellCommitEdit(t.record,t.column,e),n._OnCellEndEdit(t.record,t.column))))}(this.grid=n).on("cellclick",function(t){var e,i;t.column==this&&(e=this.getCheckId(t.record,t.column),(i=t.htmlEvent.target).id==e&&(n.allowCellEdit?(t.cancel=!1,s.call(this,t)):this.readOnly||(t.value=mini._getMap(t.column.field,t.record),n.fire("cellbeginedit",t),1!=t.cancel&&n.isEditingRow&&n.isEditingRow(t.record)&&setTimeout(function(){jQuery(i).toggleClass("mini-grid-checkbox-checked")},1))))},this),mini.on(this.grid.el,"keydown",function(t){var e;32!=t.keyCode||!n.allowCellEdit||(e=n.getCurrentCell())&&e[1]==this&&((e={record:e[0],column:e[1]}).field=e.column.field,s.call(this,e),t.preventDefault())},this);var t=parseInt(this.trueValue),e=parseInt(this.falseValue);isNaN(t)||(this.trueValue=t),isNaN(e)||(this.falseValue=e),"true"==this.trueValue&&(this.trueValue=!0),"false"==this.falseValue&&(this.falseValue=!1)}},t)},mini._Columns.checkboxcolumn=mini.CheckBoxColumn,mini.RadioButtonColumn=function(t){return mini.copyTo({_type:"radiobuttoncolumn",editMode:"inline",header:"",headerAlign:"center",trueValue:!0,falseValue:!1,readOnly:!1,getCheckId:function(t,e){return this._gridUID+"$radio$"+t[this._rowIdField]+"$"+e._id},getCheckBoxEl:function(t,e){return document.getElementById(this.getCheckId(t,e))},renderer:function(t){var e=t.sender,i=this.getCheckId(t.record,t.column),n=mini._getMap(t.field,t.record)==this.trueValue;e._id,t.column.field;return'<span id="'+i+'" class="mini-grid-radio '+(n?"mini-grid-radio-checked":"")+'"></span>'},init:function(h){function i(t){if(!h.isReadOnly()&&!this.readOnly&&(t.value=mini._getMap(t.field,t.record),h.fire("cellbeginedit",t),!0!==t.cancel&&(o=mini._getMap(t.column.field,t.record))!=this.trueValue)){for(var e=o==this.trueValue?this.falseValue:this.trueValue,i=h.getData(),n=0,s=i.length;n<s;n++){var o,l=i[n];l!=t.record&&(o=mini._getMap(t.column.field,l))!=this.falseValue&&h.updateRow(l,t.column.field,this.falseValue)}h._OnCellCommitEdit&&(h._OnCellCommitEdit(t.record,t.column,e),h._OnCellEndEdit(t.record,t.column))}}(this.grid=h).on("cellclick",function(l){var t,r,a;l.column==this&&(t=this.getCheckId(l.record,l.column),(r=l.htmlEvent.target).id==t&&(h.allowCellEdit?(l.cancel=!1,i.call(this,l)):h.isEditingRow&&h.isEditingRow(l.record)&&(a=this,setTimeout(function(){r.checked=!0;for(var t=h.getData(),e=0,i=t.length;e<i;e++){var n,s,o=t[e];o!=l.record&&(n=l.column.field,(s=mini._getMap(n,o))!=a.falseValue&&o!=l.record&&(h._dataSource?(mini._setMap(l.column.field,a.falseValue,o),h._dataSource._setModified(o,n,s)):(s={},mini._setMap(n,a.falseValue,s),h._doUpdateRow(o,s))))}},1))))},this),mini.on(this.grid.el,"keydown",function(t){var e;32!=t.keyCode||!h.allowCellEdit||(e=h.getCurrentCell())&&e[1]==this&&((e={record:e[0],column:e[1]}).field=e.column.field,i.call(this,e),t.preventDefault())},this);var t=parseInt(this.trueValue),e=parseInt(this.falseValue);isNaN(t)||(this.trueValue=t),isNaN(e)||(this.falseValue=e)}},t)},mini._Columns.radiobuttoncolumn=mini.RadioButtonColumn,mini.ComboBoxColumn=function(t){return mini.copyTo({renderer:listColumnRenderer},t)},mini._Columns.comboboxcolumn=mini.ComboBoxColumn,mini.TreeSelectColumn=function(t){return mini.copyTo({renderer:listColumnRenderer},t)},mini._Columns.treeselectcolumn=mini.TreeSelectColumn,mini._Resizer=function(t){this.owner=t,mini.on(this.owner.el,"mousedown",this.__OnMouseDown,this)},mini._Resizer.prototype={__OnMouseDown:function(t){mini.hasClass(t.target,"mini-resizer-trigger")&&this.owner.allowResize&&this._getResizeDrag().start(t)},_getResizeDrag:function(){return this._resizeDragger||(this._resizeDragger=new mini.Drag({capture:!0,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this._resizeDragger},_OnDragStart:function(t){this.mask=mini.append(document.body,'<div class="mini-resizer-mask mini-fixed"></div>'),this.proxy=mini.append(document.body,'<div class="mini-resizer-proxy"></div>'),this.proxy.style.cursor="se-resize";var e=this.owner.el;e.offsetWidth,this.elBox=mini.getBox(e),mini.setBox(this.proxy,this.elBox)},_OnDragMove:function(t){var e=this.owner,i=t.now[0]-t.init[0],t=t.now[1]-t.init[1],i=this.elBox.width+i,t=this.elBox.height+t;i<e.minWidth&&(i=e.minWidth),t<e.minHeight&&(t=e.minHeight),i>e.maxWidth&&(i=e.maxWidth),t>e.maxHeight&&(t=e.maxHeight),mini.setSize(this.proxy,i,t)},_OnDragStop:function(t,e){var i;this.proxy&&(i=mini.getBox(this.proxy),jQuery(this.mask).remove(),jQuery(this.proxy).remove(),this.proxy=null,this.elBox=null,e&&(this.owner.setWidth(i.width),this.owner.setHeight(i.height),this.owner.fire("resize")))}},mini._topWindow=null,mini._getTopWindow=function(t){if(mini._topWindow)return mini._topWindow;var i=[];return function n(t){try{(t.___try=1)==t.___try&&i.push(t)}catch(e){}t.parent&&t.parent!=t&&n(t.parent)}(window),mini._topWindow=i[i.length-1],mini._topWindow};var __ps=mini.getParams();if(__ps._winid)try{window.Owner=mini._getTopWindow()[__ps._winid]}catch(ex){}function fixIEFocus(){var t=mini.getViewportBox(),e=document.createElement("input");e.style.cssText="position:absolute;left:"+t.left+"px;top:"+t.top+"px;",document.body.appendChild(e),e.focus(),e.parentNode.removeChild(e)}mini._WindowID="w"+Math.floor(1e4*Math.random()),mini._getTopWindow()[mini._WindowID]=window,mini.iframeParams={},mini.createIFrame=function(t,e,i,n,s){var o=(t=t||"").split("#");t=o[0];var l="";if(!0!==i&&(l="_t="+Math.floor(1e6*Math.random()),-1==t.indexOf("?")?t+="?"+l:t+="&"+l),t&&-1==t.indexOf("_winid")&&(l="_winid="+mini._WindowID,-1==t.indexOf("?")?t+="?"+l:t+="&"+l),mini.iframeParams)for(var r in mini.iframeParams)t+="&"+r+"="+mini.iframeParams[r];var i=-1!=(t=o[1]?t+"#"+o[1]:t).indexOf(".mht"),l=i?t:"",o='<iframe name="'+mini.newId("mini-iframe-")+'" src="'+("post"==n?"":l)+'" style="width:100%;height:100%;"  frameborder="0"></iframe>',l=document.createElement("div"),a=mini.append(l,o),h=!1;i?h=!0:setTimeout(function(){a&&("post"!=n&&(a.src=t),h=!0)},5),a.attachEvent?a.attachEvent("onload",m):a.onload=m;var d,u=!1,c=!0;function m(){0==h||u||setTimeout(function(){e&&e(a,c),c=!1},1)}return a._ondestroy=function(){if(u=!0,a.src="",mini.isIE)try{a.contentWindow.document.write(""),a.contentWindow.document.close()}catch(ex){}a._ondestroy=null,a=null},"post"==n&&(d=jQuery("<form />").attr({method:"post",action:t,enctype:"multipart/form-data",target:a.name}).hide().appendTo("body"),setTimeout(function(){d.submit()},10)),a},mini._doOpen=function(t){"string"==typeof t&&(t={url:t}),(t=mini.copyTo({width:700,height:400,allowResize:!0,allowModal:!0,closeAction:"destroy",title:"",titleIcon:"",iconCls:"",iconStyle:"",bodyStyle:"padding: 0",url:"",showCloseButton:!0,showFooter:!1},t)).closeAction="destroy";var e=t.onload;delete t.onload;var i=t.ondestroy;delete t.ondestroy;var n=t.url;delete t.url;var s,o=mini.getViewportBox();t.width&&-1!=String(t.width).indexOf("%")&&(s=parseInt(t.width),t.width=parseInt(o.width*(s/100))),t.height&&-1!=String(t.height).indexOf("%")&&(l=parseInt(t.height),t.height=parseInt(o.height*(l/100)));var l=new mini.Window;return l.set(t),l.load(n,e,i),l.show(),mini.isIE&&setTimeout(function(){fixIEFocus()},100),l},mini.getTopWindow=function(){var e=[];return function i(t){try{t.mini&&e.push(t),t.parent&&t.parent!=t&&i(t.parent)}catch(ex){}}(window),e[e.length-1]},mini.open=function(t){if(t){var e,i=t.url,n=(i=i||"").split("#");(i=n[0])&&-1==i.indexOf("_winid")&&(e="_winid="+mini._WindowID,-1==i.indexOf("?")?i+="?"+e:i+="&"+e,n[1]&&(i=i+"#"+n[1])),t.url=i,t.Owner=window;var s=[];!function o(t){try{t.mini&&s.push(t),t.parent&&t.parent!=t&&o(t.parent)}catch(ex){}}(window);i=s[s.length-1];return(i=t.targetWindow?t.targetWindow:i).mini._doOpen(t)}},mini.openTop=mini.open,mini._getResult=function(t,e,i,n,s,o){var l=null,n=mini.getText(t,e,function(t,e){l=e,i&&i&&i(t,e)},n,s),e={text:n,result:null,sender:{type:""},options:{url:t,data:e,type:s},xhr:l},s=null;try{mini_doload(e),s=(s=e.result)||mini.decode(n)}catch(ex){1==mini_debugger&&alert(t+"\njson is error")}return!mini.isArray(s)&&o&&(s=mini._getMap(o,s)),(s=mini.isArray(s)?{data:s}:s)?s.data:null},mini.getData=function(t,e,i,n,s){s=mini.getText(t,e,i,n,s);return mini.decode(s)},mini.getText=function(t,e,n,i,s){var o=null;return mini.ajax({url:t,data:e,"async":!1,type:s||"get",cache:!1,dataType:"text",success:function(t,e,i){o=t,n&&n(t,i)},error:i}),o},window.mini_RootPath||(mini_RootPath="/"),mini_CreateJSPath=function(t){for(var e=document.getElementsByTagName("script"),i="",n=0,s=e.length;n<s;n++){var o=e[n].src;if(-1!=o.indexOf(t)){i=(l=o.split(t))[0];break}}var l,r=location.href;return(l=(r=(r=r.split("#")[0]).split("?")[0]).split("/")).length=l.length-1,r=l.join("/"),i=-1==i.indexOf("http:")&&-1==i.indexOf("file:")?r+"/"+i:i},window.mini_JSPath||(mini_JSPath=mini_CreateJSPath("miniui.js")),mini.update=function(t,e){"string"==typeof t&&(t={url:t}),e&&(t.el=e);e=mini.loadText(t.url);mini.innerHTML(t.el,e),mini.parse(t.el)},mini.createSingle=function(t){if("function"==typeof(t="string"==typeof t?mini.getClass(t):t))return t.single||(t.single=new t)},mini.createTopSingle=function(t){if("function"==typeof t){var e=t.prototype.type;return top&&top!=window&&top.mini&&top.mini.getClass(e)?top.mini.createSingle(e):mini.createSingle(t)}},mini.sortTypes={string:function(t){return String(t).toUpperCase()},date:function(t){return t?mini.isDate(t)?t.getTime():mini.parseDate(String(t)):0},"float":function(t){t=parseFloat(String(t).replace(/,/g,""));return isNaN(t)?0:t},"int":function(t){t=parseInt(String(t).replace(/,/g,""),10);return isNaN(t)?0:t},currency:function(t){t=parseFloat(String(t).replace(/,/g,""));return isNaN(t)?0:t}},mini._ValidateVType=function(t,e,i,n){for(var s=t.split(";"),o=0,l=s.length;o<l;o++){var r=(t=s[o].trim()).split(":"),a=r[0],h=(h=t.substr(a.length+1,1e3))?h.split(","):[],a=mini.VTypes[a];if(a)if(!0!==a(e,h)){i.isValid=!1;r=r[0]+"ErrorText";i.errorText=n[r]||mini.VTypes[r]||"",i.errorText=String.format(i.errorText,h[0],h[1],h[2],h[3],h[4]);break}}},mini._getErrorText=function(t,e){return(t&&t[e]?t:mini.VTypes)[e]},mini.VTypes={minDateErrorText:"Date can not be less than {0}",maxDateErrorText:"Date can not be greater than {0}",uniqueErrorText:"This field is unique.",requiredErrorText:"This field is required.",emailErrorText:"Please enter a valid email address.",urlErrorText:"Please enter a valid URL.",floatErrorText:"Please enter a valid number.",intErrorText:"Please enter only digits",dateErrorText:"Please enter a valid date. Date format is {0}",maxLengthErrorText:"Please enter no more than {0} characters.",minLengthErrorText:"Please enter at least {0} characters.",maxErrorText:"Please enter a value less than or equal to {0}.",minErrorText:"Please enter a value greater than or equal to {0}.",rangeLengthErrorText:"Please enter a value between {0} and {1} characters long.",rangeCharErrorText:"Please enter a value between {0} and {1} characters long.",rangeErrorText:"Please enter a value between {0} and {1}.",required:function(t,e){return!mini.isNull(t)&&""!==t},email:function(t,e){return!(!mini.isNull(t)&&""!==t)||-1!=t.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)},url:function(t,e){return!(!mini.isNull(t)&&""!==t)||(i=t,i=t.toLowerCase().split("?")[0],!!new RegExp("^((https|http|ftp|rtsp|mms)?://)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,5})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$").test(i));var i},"int":function(t,e){return!(!mini.isNull(t)&&""!==t)||((i=t)<0&&(i=-i),0<(i=String(i)).length&&!/[^0-9]/.test(i));var i},"float":function(t,e){return!(!mini.isNull(t)&&""!==t)||(i=t,(-1==(i=String(i)).indexOf("-")||0==i.indexOf("-"))&&(!(2<(i=i.replace("-","")).split(".").length)&&(0<i.length&&!/[^0-9.]/.test(i)&&!("."==i.charAt(i.length-1)))));var i},date:function(t,e){if(mini.isNull(t)||""===t)return!0;if(!t)return!1;var i=null,e=e[0];if(e){if((i=mini.parseDate(t,e))&&i.getFullYear&&mini.formatDate(i,e)==t)return!0}else if((i=(i=(i=mini.parseDate(t,"yyyy-MM-dd"))||mini.parseDate(t,"yyyy/MM/dd"))||mini.parseDate(t,"MM/dd/yyyy"))&&i.getFullYear)return!0;return!1},maxLength:function(t,e){if(mini.isNull(t)||""===t)return!0;e=parseInt(e);return!(t&&!isNaN(e))||t.length<=e},minLength:function(t,e){if(mini.isNull(t)||""===t)return!0;e=parseInt(e);return!!isNaN(e)||t.length>=e},rangeLength:function(t,e){if(mini.isNull(t)||""===t)return!0;if(!t)return!1;var i=parseFloat(e[0]),e=parseFloat(e[1]);return!(!isNaN(i)&&!isNaN(e))||i<=t.length&&t.length<=e},rangeChar:function(t,e){if(mini.isNull(t)||""===t)return!0;var i=parseFloat(e[0]),e=parseFloat(e[1]);if(isNaN(i)||isNaN(e))return!0;for(var n,s=0,o=String(t).split(""),l=0,r=o.length;l<r;l++)n=o[l],new RegExp("^[一-龥]+$").test(n)?s+=2:s+=1;return i<=s&&s<=e},range:function(t,e){if(0==mini.VTypes["float"](t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;var i=parseFloat(e[0]),e=parseFloat(e[1]);return!(!isNaN(i)&&!isNaN(e))||i<=t&&t<=e},min:function(t,e){if(0==mini.VTypes["float"](t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;e=parseFloat(e[0]);return!!isNaN(e)||e<=t},max:function(t,e){if(0==mini.VTypes["float"](t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;e=parseFloat(e[0]);return!!isNaN(e)||t<=e}},mini.summaryTypes={count:function(t){return(t=t||[]).length},max:function(t,e){for(var i=null,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],o=parseFloat(mini._getMap(e,o));null===o||o===undefined||isNaN(o)||(null==i||i<o)&&(i=o)}return i},min:function(t,e){for(var i=null,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],o=parseFloat(mini._getMap(e,o));null===o||o===undefined||isNaN(o)||(null==i||o<i)&&(i=o)}return i},avg:function(t,e){if(0==(t=t||[]).length)return 0;for(var i=0,n=0,s=t.length;n<s;n++){var o=t[n],o=parseFloat(mini._getMap(e,o));null===o||o===undefined||isNaN(o)||(i+=o)}return i/t.length},sum:function(t,e){for(var i=0,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],o=parseFloat(mini._getMap(e,o));null===o||o===undefined||isNaN(o)||(i+=o)}return i}},mini.formatCurrency=function(t,e){null===t||undefined,t=String(t).replace(/\$|\,/g,""),isNaN(t)&&(t="0"),sign=t==(t=Math.abs(t)),t=Math.floor(100*t+.50000000001),cents=t%100,t=Math.floor(t/100).toString(),cents<10&&(cents="0"+cents);for(var i=0;i<Math.floor((t.length-(1+i))/3);i++)t=t.substring(0,t.length-(4*i+3))+","+t.substring(t.length-(4*i+3));return(e=e||"")+((sign?"":"-")+t+"."+cents)},mini.getByUid=mini.getbyUID,mini.emptyFn=function(){},mini.Drag=function(t){mini.copyTo(this,t)},mini.Drag.prototype={onStart:mini.emptyFn,onMove:mini.emptyFn,onStop:mini.emptyFn,capture:!1,fps:20,event:null,delay:80,start:function(t){t.preventDefault(),t&&(this.event=t),this.now=this.init=[this.event.pageX,this.event.pageY];var e=document;mini.on(e,"mousemove",this.move,this),mini.on(e,"mouseup",this.stop,this),mini.on(e,"contextmenu",this.contextmenu,this),this.context&&mini.on(this.context,"contextmenu",this.contextmenu,this),this.trigger=t.target,mini.selectable(this.trigger,!1),mini.selectable(e.body,!1),this.capture&&(isIE?this.trigger.setCapture(!0):document.captureEvents&&document.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP|Event.MOUSEDOWN)),this.started=!1,this.startTime=new Date},contextmenu:function(t){this.context&&mini.un(this.context,"contextmenu",this.contextmenu,this),mini.un(document,"contextmenu",this.contextmenu,this),t.preventDefault(),t.stopPropagation()},move:function(t){var e;this.delay&&new Date-this.startTime<this.delay||((e=this).timer||(this.timer=setTimeout(function(){e.started||(e.started=!0,e.onStart(e)),e.now=[t.pageX,t.pageY],e.event=t,e.onMove(e),e.timer=null},5)))},stop:function(t){this.now=[t.pageX,t.pageY],this.event=t,this.timer&&(clearTimeout(this.timer),this.timer=null);var e=document;mini.selectable(this.trigger,!0),mini.selectable(e.body,!0),isIE&&(this.trigger.setCapture(!1),this.trigger.releaseCapture());var i=mini.MouseButton.Right!=t.button;0==i&&t.preventDefault(),mini.un(e,"mousemove",this.move,this),mini.un(e,"mouseup",this.stop,this);var n=this;setTimeout(function(){mini.un(document,"contextmenu",n.contextmenu,n),n.context&&mini.un(n.context,"contextmenu",n.contextmenu,n)},1),this.started&&this.onStop(this,i)}},mini.JSON=new function(){var o,l,r,a=[],h=null,d=!!{}.hasOwnProperty,u=function(t,e){var i=n[e];return i||(i=e.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))},c=function(t,e){if(null!==t){var i=typeof t;if("undefined"==i)a[a.length]="null";else if(t.push){a[a.length]="[";var n,s,o,l=t.length;for(s=0;s<l;s+=1)"undefined"==(i=typeof(o=t[s]))||"function"==i||"unknown"==i||(n&&(a[a.length]=","),c(o),n=!0);a[a.length]="]"}else if(t.getFullYear)h?(a[a.length]='"',a[a.length]="function"==typeof h?h(t,e):mini.formatDate(t,h)):(a[a.length]='"',a[a.length]=t.getFullYear(),a[a.length]="-",e=t.getMonth()+1,a[a.length]=e<10?"0"+e:e,a[a.length]="-",e=t.getDate(),a[a.length]=e<10?"0"+e:e,a[a.length]="T",e=t.getHours(),a[a.length]=e<10?"0"+e:e,a[a.length]=":",e=t.getMinutes(),a[a.length]=e<10?"0"+e:e,a[a.length]=":",e=t.getSeconds(),a[a.length]=e<10?"0"+e:e),a[a.length]='"';else if("string"==i){if(m.test(t))return a[a.length]='"',a[a.length]=t.replace(f,u),void(a[a.length]='"');a[a.length]='"'+t+'"'}else if("number"==i)a[a.length]=t;else if("boolean"==i)a[a.length]=String(t);else{for(s in a[a.length]="{",t)d&&!Object.prototype.hasOwnProperty.call(t,s)||"undefined"==(i=typeof(o=t[s]))||"function"==i||"unknown"==i||(n&&(a[a.length]=","),c(s),a[a.length]=":",c(o,s),n=!0);a[a.length]="}"}}else a[a.length]="null"},n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m=/["\\\x00-\x1f]/,f=/([\x00-\x1f\\"])/g;this.encode=function(t,e){return a=[],h=e,c(t),h=null,a.join("")},this.decode=(o=/^(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2}(?:\.*\d*)?)Z*$/,l=new RegExp("^/+Date\\((-?[0-9]+).*\\)/+$","g"),r=/[\"\'](\d{4})-(\d{1,2})-(\d{1,2})[T ](\d{1,2}):(\d{1,2}):(\d{1,2})(\.*\d*)[\"\']/g,function(t,n){if(""===t||null===t||t===undefined)return t;function e(t){return!1!==n&&(t=(t=(t=t.replace(__js_dateRegEx,"$1new Date($2)")).replace(r,"new Date($1,$2-1,$3,$4,$5,$6)")).replace(__js_dateRegEx2,"new Date($1)")),window.eval("("+t+")")}"object"==typeof t&&(t=this.encode(t));var i=null;if(window.JSON&&window.JSON.parse)try{var s=t.replace(__js_dateRegEx,'$1"/Date($2)/"'),i=window.JSON.parse(s,function(t,e){if("string"==typeof e&&!1!==n){o.lastIndex=0;var i=o.exec(e);if(i)return e=new Date(i[1],i[2]-1,i[3],i[4],i[5],i[6]);if(l.lastIndex=0,i=l.exec(e))return e=new Date(parseInt(i[1]))}return e})}catch(ex){i=e(t)}else i=e(t);return i})},__js_dateRegEx=new RegExp('(^|[^\\\\])\\"\\\\/Date\\((-?[0-9]+)(?:[a-zA-Z]|(?:\\+|-)[0-9]{4})?\\)\\\\/\\"',"g"),__js_dateRegEx2=new RegExp("[\"']/Date\\(([0-9]+)\\)/[\"']","g"),mini.encode=mini.JSON.encode,mini.decode=mini.JSON.decode,mini.clone=function(t,e){if(null===t||t===undefined)return t;t=mini.encode(t),t=mini.decode(t);return!1!==e&&function l(t){for(var e=0,i=t.length;e<i;e++){var n,s=t[e];for(n in delete s._state,delete s._id,delete s._pid,delete s._uid,s){var o=s[n];o instanceof Array&&l(o)}}}(t instanceof Array?t:[t]),t};var DAY_MS=864e5,HOUR_MS=36e5,MINUTE_MS=6e4;mini.copyTo(mini,{clearTime:function(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate()):null},maxTime:function(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59):null},cloneDate:function(t){return t?new Date(t.getTime()):null},addDate:function(t,e,i){switch(i=i||"D",t=new Date(t.getTime()),i.toUpperCase()){case"Y":t.setFullYear(t.getFullYear()+e);break;case"MO":t.setMonth(t.getMonth()+e);break;case"D":t.setDate(t.getDate()+e);break;case"H":t.setHours(t.getHours()+e);break;case"M":t.setMinutes(t.getMinutes()+e);break;case"S":t.setSeconds(t.getSeconds()+e);break;case"MS":t.setMilliseconds(t.getMilliseconds()+e)}return t},getWeek:function(t,e,i){var n=Math.floor((14-e)/12),t=t+4800-n,n=i+Math.floor((153*(e+12*n-3)+2)/5)+365*t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400)-32045,t=(31741+n-n%7)%146097%36524%1461,n=Math.floor(t/1460);return NumberOfWeek=Math.floor(((t-n)%365+n)/7)+1,NumberOfWeek},getWeekStartDate:function(t,e){if(6<(e=e||0)||e<0)throw new Error("out of weekday");var i=t.getDay(),n=e-i;return i<e&&(n-=7),new Date(t.getFullYear(),t.getMonth(),t.getDate()+n)},getShortWeek:function(t){return this.dateInfo.daysShort[t]},getLongWeek:function(t){return this.dateInfo.daysLong[t]},getShortMonth:function(t){return this.dateInfo.monthsShort[t]},getLongMonth:function(t){return this.dateInfo.monthsLong[t]},dateInfo:{monthsLong:["January","Febraury","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],daysLong:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Su","Mo","Tu","We","Th","Fr","Sa"],quarterLong:["Q1","Q2","Q3","Q4"],quarterShort:["Q1","Q2","Q3","Q4"],halfYearLong:["first half","second half"],patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",f:"dddd, MMMM dd, yyyy H:mm tt",F:"dddd, MMMM dd, yyyy H:mm:ss tt",g:"M/d/yyyy H:mm tt",G:"M/d/yyyy H:mm:ss tt",m:"MMMM dd",o:"yyyy-MM-ddTHH:mm:ss.fff",s:"yyyy-MM-ddTHH:mm:ss",t:"H:mm tt",T:"H:mm:ss tt",U:"dddd, MMMM dd, yyyy HH:mm:ss tt",y:"MMM, yyyy"},tt:{AM:"AM",PM:"PM"},ten:{Early:"Early",Mid:"Mid",Late:"Late"},today:"Today",clockType:24}}),Date.prototype.getHalfYear=function(){return this.getMonth?this.getMonth()<6?0:1:null},Date.prototype.getQuarter=function(){if(!this.getMonth)return null;var t=this.getMonth();return t<3?0:t<6?1:t<9?2:3},mini.formatDate=function(t,e,i){if(!t||!t.getFullYear||isNaN(t))return"";var n=t.toString(),s=mini.dateInfo;if(void 0!==(s=s||mini.dateInfo)){var o="undefined"!=typeof s.patterns[e]?s.patterns[e]:e,l=t.getFullYear(),r=t.getMonth(),a=t.getDate();if("yyyy-MM-dd"==e)return l+"-"+(r=r+1<10?"0"+(r+1):r+1)+"-"+(a=a<10?"0"+a:a);if("MM/dd/yyyy"==e)return(r=r+1<10?"0"+(r+1):r+1)+"/"+(a=a<10?"0"+a:a)+"/"+l;n=(n=o.replace(/yyyy/g,l)).replace(/yy/g,(l+"").substring(2)),l=t.getHalfYear();n=n.replace(/hy/g,s.halfYearLong[l]);l=t.getQuarter();n=(n=(n=(n=(n=(n=n.replace(/Q/g,s.quarterLong[l])).replace(/q/g,s.quarterShort[l])).replace(/MMMM/g,s.monthsLong[r].escapeDateTimeTokens())).replace(/MMM/g,s.monthsShort[r].escapeDateTimeTokens())).replace(/MM/g,r+1<10?"0"+(r+1):r+1)).replace(/(\\)?M/g,function(t,e){return e?t:r+1});l=t.getDay();n=(n=(n=(n=n.replace(/dddd/g,s.daysLong[l].escapeDateTimeTokens())).replace(/ddd/g,s.daysShort[l].escapeDateTimeTokens())).replace(/dd/g,a<10?"0"+a:a)).replace(/(\\)?d/g,function(t,e){return e?t:a});var h=t.getHours(),d=12<h?h-12:h;12==s.clockType&&12<h&&(h-=12),n=(n=(n=(n=n.replace(/HH/g,h<10?"0"+h:h)).replace(/(\\)?H/g,function(t,e){return e?t:h})).replace(/hh/g,d<10?"0"+d:d)).replace(/(\\)?h/g,function(t,e){return e?t:d});var u=t.getMinutes();n=(n=n.replace(/mm/g,u<10?"0"+u:u)).replace(/(\\)?m/g,function(t,e){return e?t:u});var c=t.getSeconds();n=(n=(n=(n=n.replace(/ss/g,c<10?"0"+c:c)).replace(/(\\)?s/g,function(t,e){return e?t:c})).replace(/fff/g,t.getMilliseconds())).replace(/tt/g,12<t.getHours()||0==t.getHours()?s.tt.PM:s.tt.AM);l="",l=(t=t.getDate())<=10?s.ten.Early:t<=20?s.ten.Mid:s.ten.Late;n=n.replace(/ten/g,l)}return n.replace(/\\/g,"")},String.prototype.escapeDateTimeTokens=function(){return this.replace(/([dMyHmsft])/g,"\\$1")},mini.fixDate=function(t,e){if(+t)for(;t.getDate()!=e.getDate();)t.setTime(+t+(t<e?1:-1)*HOUR_MS)},mini.parseDate=function(t,e){try{if((n=window.eval(t))&&n.getFullYear)return n}catch(ex){}if("object"==typeof t)return isNaN(t)?null:t;if("number"==typeof t)return(n=new Date(1e3*t)).getTime()!=t||isNaN(n)?null:n;if("string"!=typeof t)return null;if(m=t.match(/^([0-9]{4})([0-9]{2})([0-9]{0,2})$/),m){var i=new Date(parseInt(m[1],10),parseInt(m[2],10)-1);return m[3]&&i.setDate(m[3]),i}if(m=t.match(/^([0-9]{4}).([0-9]*)$/),m)return i=new Date(m[1],m[2]-1);if(t.match(/^\d+(\.\d+)?$/))return(n=new Date(1e3*parseFloat(t))).getTime()!=t?null:n;e===undefined&&(e=!0);var n=mini.parseISO8601(t,e)||(t?new Date(t):null);return isNaN(n)?null:n},mini.parseISO8601=function(t,e){var i=t.match(/^([0-9]{4})([-\/]([0-9]{1,2})([-\/]([0-9]{1,2})([T ]([0-9]{1,2}):([0-9]{1,2})(:([0-9]{1,2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!i)return(i=t.match(/^([0-9]{4})[-\/]([0-9]{2})[-\/]([0-9]{2})[T ]([0-9]{1,2})/))?new Date(i[1],i[2]-1,i[3],i[4]):(i=t.match(/^([0-9]{4}).([0-9]*)$/))?new Date(i[1],i[2]-1):(i=t.match(/^([0-9]{4}).([0-9]*).([0-9]*)/))?new Date(i[1],i[2]-1,i[3]):(i=t.match(/^([0-9]{2})-([0-9]{2})-([0-9]{4})$/))?new Date(i[3],i[1]-1,i[2]):null;var n,s=new Date(i[1],0,1);return e||!i[14]?(n=new Date(i[1],0,1,9,0),i[3]&&(s.setMonth(i[3]-1),n.setMonth(i[3]-1)),i[5]&&(s.setDate(i[5]),n.setDate(i[5])),mini.fixDate(s,n),i[7]&&s.setHours(i[7]),i[8]&&s.setMinutes(i[8]),i[10]&&s.setSeconds(i[10]),i[12]&&s.setMilliseconds(1e3*Number("0."+i[12])),mini.fixDate(s,n)):(s.setUTCFullYear(i[1],i[3]?i[3]-1:0,i[5]||1),s.setUTCHours(i[7]||0,i[8]||0,i[10]||0,i[12]?1e3*Number("0."+i[12]):0),n=60*Number(i[16])+(i[18]?Number(i[18]):0),n*="-"==i[15]?1:-1,s=new Date(+s+60*n*1e3)),s},mini.parseTime=function(t,e){if(!t)return null;var i=parseInt(t);if(i==t&&e){var n=new Date(0),s=e.charAt(0);return"H"==s?n.setHours(i):"m"==s?n.setMinutes(i):"s"==s&&n.setSeconds(i),n=isNaN(n)?null:n}return(n=mini.parseDate(t))||(s=t.split(":"),i=parseInt(parseFloat(s[0])),t=parseInt(parseFloat(s[1])),s=parseInt(parseFloat(s[2])),isNaN(i)||isNaN(t)||isNaN(s)||((n=new Date(0)).setHours(i),n.setMinutes(t),n.setSeconds(s)),isNaN(i)||"H"!=e&&"HH"!=e?isNaN(i)||isNaN(t)||"H:mm"!=e&&"HH:mm"!=e?isNaN(i)||isNaN(t)||"mm:ss"!=e||((n=new Date(0)).setMinutes(i),n.setSeconds(t)):((n=new Date(0)).setHours(i),n.setMinutes(t)):(n=new Date(0)).setHours(i)),n},mini.dateInfo={monthsLong:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],daysLong:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["日","一","二","三","四","五","六"],quarterLong:["一季度","二季度","三季度","四季度"],quarterShort:["Q1","Q2","Q2","Q4"],halfYearLong:["上半年","下半年"],patterns:{d:"yyyy-M-d",D:"yyyy年M月d日",f:"yyyy年M月d日 H:mm",F:"yyyy年M月d日 H:mm:ss",g:"yyyy-M-d H:mm",G:"yyyy-M-d H:mm:ss",m:"MMMd日",o:"yyyy-MM-ddTHH:mm:ss.fff",s:"yyyy-MM-ddTHH:mm:ss",t:"H:mm",T:"H:mm:ss",U:"yyyy年M月d日 HH:mm:ss",y:"yyyy年MM月"},tt:{AM:"上午",PM:"下午"},ten:{Early:"上旬",Mid:"中旬",Late:"下旬"},today:"今天",clockType:24},function(window){var mini=window.mini,mini=mini||(window.mini={}),cultures=mini.cultures={},cultureName="en";function findCulture(t){return mini.cultures[t]}function getCulture(t){return t&&t.name?t:findCulture(t)||mini.cultures.current}mini.cultures[cultureName]={name:cultureName,numberFormat:{number:{pattern:["n","-n"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3]},percent:{pattern:["n %","-n %"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3],symbol:"%"},currency:{pattern:["$n","($n)"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3],symbol:"$"}}},mini.getCulture=getCulture,mini.culture=function(t){if(t===undefined)return cultures.current;mini.cultures.current=findCulture(t)},mini.culture(cultureName);var STRING="string",NUMBER="number",isArray=function(t){return t&&!!t.unshift},numberRegExp={2:/^\d{1,2}/,4:/^\d{4}/};function pad(t,e,i){e=(e=typeof e==NUMBER?e:2)-(t+="").length;if(0<e){e=repeat(e,"0");return i?t+e:e+t}return t}function repeat(t,e){for(var i="";t;)--t,i+=e;return i}var numberFormatRegExp=/^(n|c|p)(\d*)$/i,eRegExp=/^(e)(\d*)$/i,clearRegExp=/[^0#]/g,exponentRegExp=/[eE][\-+]?[0-9]+/;function doFormatNumber(number,format,options){number=Math.abs(number);var isGroup=-1!=format.indexOf(","),formats=format.split("."),format0=(formats[0]||"").replace(clearRegExp,""),format1=(formats[1]||"").replace(clearRegExp,""),value="",groupSize=options.groupSize[0],decimalsSeparator=options.decimalsSeparator,groupSeparator=options.groupSeparator,index=format0.indexOf("0"),format0=-1!=index&&format0.substr(index)||"0",decimals=format1.length,decimalPlaces=format1.substr(0,format1.lastIndexOf("0")+1).length;function round2(number,fractionDigits){with(Math)return round(number*pow(10,fractionDigits))/pow(10,fractionDigits)}number=round2(number,decimals);var values=String(number).split(".");if(value0=values[0],value1=values[1]||"",value0){if(value0=pad(value0,format0.length),isGroup)for(var i=0;i<Math.floor((value0.length-(1+i))/3);i++)value0=value0.substring(0,value0.length-(4*i+3))+groupSeparator+value0.substring(value0.length-(4*i+3));value+=value0}return 0<decimals&&(value+=decimalsSeparator,value+=pad(value1.substr(0,decimals),decimalPlaces,!0)),value}function transformFormat(t,e,i,n){var s,o,l=i.numberFormat.number,r=numberFormatRegExp.exec(t);return null!=r?(s=r[1],o=r[2],"p"==s?l=i.numberFormat.percent:"c"==s&&(l=i.numberFormat.currency),r=o?parseInt(o):l.decimals,l=(l=l.pattern[e<0?1:0]).replace("n","#,#"+(0<r?"."+repeat(r,"0"):"")),t=t.replace(s+o,l).replace("$",i.numberFormat.currency.symbol).replace("%",i.numberFormat.percent.symbol)):isNumberFormat(t)&&e<0&&!n[1]&&(t="-"+t),t}function isNumberFormat(t){return-1!=t.indexOf("0")||-1!=t.indexOf("#")}function getNumberFormat(t){if(!t)return null;var e,i,n,s=(i=(e=t).indexOf("0"),n=e.indexOf("#"),(-1==i||-1!=n&&n<i)&&(i=n),n=e.lastIndexOf("0"),e=e.lastIndexOf("#"),[i,n=-1==n||-1!=e&&n<e?e:n]),o=s[0],s=s[1];return-1<o?{begin:o,end:s,format:t.substring(o,s+1)}:null}function formatNumber(t,e,i){if(typeof t!=NUMBER)return"";if(!e)return String(t);var n=e.split(";");e=n[0],t<0&&2<=n.length&&(e=n[1]),0==t&&3<=n.length&&(e=n[2]);var s=(i=getCulture(i)).numberFormat.number,o=i.numberFormat.percent,l=i.numberFormat.currency,i=-1!=(e=transformFormat(e,t,i,n)).indexOf(l.symbol),n=-1!=e.indexOf(o.symbol),o=(e.indexOf("."),isNumberFormat(e)),s=i||n?l:s,t=n?100*t:t,n=eRegExp.exec(e);if(n){var r=parseInt(n[2]);return isNaN(r)?t.toExponential():t.toExponential(r)}if(!o)return e;r="",o=getNumberFormat(e);return r=null!=o?(r=doFormatNumber(t,o.format,s),e.substr(0,o.begin)+r+e.substr(o.end+1)):e}mini.parseInt=function(t,e,i){i=mini.parseFloat(t,e,i);return i&&(i|=0),i},mini.parseFloat=function(t,e,i){if(!t&&0!==t)return null;if(typeof t===NUMBER)return t;if(i&&i.split(";")[2]==t)return 0;if(exponentRegExp.test(t))return t=parseFloat(t),t=isNaN(t)?null:t;t=t.toString();var n=(e=mini.getCulture(e)).numberFormat,s=n.number,o=n.percent,l=n.currency,r=-1!=t.indexOf(o.symbol),a=(s=-1!=t.indexOf(l.symbol)?l:r?o:s).pattern[1],h=s.decimals,d=s.decimalsSeparator,e=s.groupSeparator,u=-1<t.indexOf("-");function c(t,e,i){var n,s=getNumberFormat(e);return s&&(n=e.substr(0,s.begin),s=e.substr(s.end+1),0==t.indexOf(n)&&-1<t.indexOf(s)&&(t=t.replace(n,"").replace(s,""),u=i)),t}i?(n=i.split(";"))[1]?t=c(t,i=n[1],!0):(s=t)==(t=c(s,i=n[0],!1))&&(t=c(s,"-"+i,!0)):0==u&&(t=c(t,i=a.replace("n","#,#"+(0<h?"."+repeat(h,"0"):"")).replace("$",l.symbol).replace("%",o.symbol),!0));d=(t=t.split(e).join("").replace(d,".")).match(/([0-9,.]+)/g);return null==d?null:(t=d[0],t=parseFloat(t),isNaN(t)?t=null:u&&(t*=-1),t&&r&&(t/=100),t)},mini.formatNumber=formatNumber}(this);var inBrowser="undefined"!=typeof window,UA=inBrowser&&window.navigator.userAgent.toLowerCase(),isIE=UA&&/msie|trident/.test(UA),isIE9=UA&&0<UA.indexOf("msie 9.0"),isEdge=UA&&0<UA.indexOf("edge/"),isAndroid=UA&&0<UA.indexOf("android"),isIOS=UA&&/iphone|ipad|ipod|ios/.test(UA),isMobile=isAndroid||isIOS;mini.isAndroid=isAndroid,mini.isIOS=isIOS,mini.isMobile=isMobile,mini.Keyboard={Left:37,Top:38,Right:39,Bottom:40,PageUp:33,PageDown:34,End:35,Home:36,Enter:13,ESC:27,Space:32,Tab:9,Del:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};var ua=navigator.userAgent.toLowerCase(),check=function(t){return t.test(ua)},DOC=document,isStrict="CSS1Compat"==document.compatMode,version=function(t,e){var i;return t&&(i=e.exec(ua))?parseFloat(i[1]):0},docMode=document.documentMode,isOpera=check(/opera/),isOpera10_5=isOpera&&check(/version\/10\.5/),isChrome=check(/\bchrome\b/),isWebKit=check(/webkit/),isSafari=!isChrome&&check(/safari/),isSafari2=isSafari&&check(/applewebkit\/4/),isSafari3=isSafari&&check(/version\/3/),isSafari4=isSafari&&check(/version\/4/),isSafari5_0=isSafari&&check(/version\/5\.0/),isSafari5=isSafari&&check(/version\/5/),isIE=!isOpera&&check(/msie/),isIE7=isIE&&(check(/msie 7/)&&8!=docMode&&9!=docMode&&10!=docMode||7==docMode),isIE8=isIE&&(check(/msie 8/)&&7!=docMode&&9!=docMode&&10!=docMode||8==docMode),isIE9=isIE&&(check(/msie 9/)&&7!=docMode&&8!=docMode&&10!=docMode||9==docMode),isIE10=isIE&&(check(/msie 10/)&&7!=docMode&&8!=docMode&&9!=docMode||10==docMode),isIE6=isIE&&!isIE7&&!isIE8&&!isIE9&&!isIE10,isIE11=-1<ua.indexOf("trident")&&-1<ua.indexOf("rv"),isIE=isIE||isIE11,isFirefox=0<navigator.userAgent.indexOf("Firefox"),isGecko=!isWebKit&&check(/gecko/),isGecko3=isGecko&&check(/rv:1\.9/),isGecko4=isGecko&&check(/rv:2\.0/),isGecko5=isGecko&&check(/rv:5\./),isGecko10=isGecko&&check(/rv:10\./),isFF3_0=isGecko3&&check(/rv:1\.9\.0/),isFF3_5=isGecko3&&check(/rv:1\.9\.1/),isFF3_6=isGecko3&&check(/rv:1\.9\.2/),isWindows=check(/windows|win32/),isMac=check(/macintosh|mac os x/),isAir=check(/adobeair/),isLinux=check(/linux/),scrollbarSize=null,chromeVersion=version(!0,/\bchrome\/(\d+\.\d+)/),firefoxVersion=version(!0,/\bfirefox\/(\d+\.\d+)/),ieVersion=version(isIE,/msie (\d+\.\d+)/),IE_V=isIE?parseInt(ieVersion):-1,operaVersion=version(isOpera,/version\/(\d+\.\d+)/),safariVersion=version(isSafari,/version\/(\d+\.\d+)/),webKitVersion=version(isWebKit,/webkit\/(\d+\.\d+)/),isSecure=/^https/i.test(window.location.protocol),isBorderBox=isIE&&!isStrict;if(isIE6)try{DOC.execCommand("BackgroundImageCache",!1,!0)}catch(e){}mini.boxModel=!isBorderBox,mini.isIE=isIE,mini.isIE6=isIE6,mini.isIE7=isIE7,mini.isIE8=isIE8,mini.isIE9=isIE9,mini.isIE10=isIE10,mini.isIE11=isIE11,mini.IE_V=isIE11?11:IE_V,mini.isFirefox=isFirefox,mini.isOpera=isOpera,mini.isSafari=isSafari,mini.isChrome=isChrome,isIE&&jQuery(document.documentElement).addClass("ie ie"+mini.IE_V),jQuery&&(jQuery.boxModel=mini.boxModel),mini.noBorderBox=!1,0==jQuery.boxModel&&isIE&&0==isIE9&&(mini.noBorderBox=!0),mini.MouseButton={Left:0,Middle:1,Right:2},!isIE||isIE9||isIE10||(mini.MouseButton={Left:1,Middle:4,Right:2}),mini.append=function(t,e){if(t=mini.byId(t),e&&t){if("string"!=typeof e)return t.appendChild(e),e;if("#"==e.charAt(0))return(e=mini.byId(e))?(t.appendChild(e),e):void 0;if(0==e.indexOf("<tr"))return jQuery(t).append(e)[0].lastChild;var i=document.createElement("div");for(i.innerHTML=e,e=i.firstChild;i.firstChild;)t.appendChild(i.firstChild);return e}},mini.prepend=function(t,e){var i;return"string"==typeof e&&(e="#"==e.charAt(0)?mini.byId(e):((i=document.createElement("div")).innerHTML=e,i.firstChild)),jQuery(t).prepend(e)[0].firstChild},mini.after=function(t,e){var i;if((e="string"==typeof e?"#"==e.charAt(0)?mini.byId(e):((i=document.createElement("div")).innerHTML=e,i.firstChild):e)&&t)return t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e),e},mini.before=function(t,e){var i;if((e="string"==typeof e?"#"==e.charAt(0)?mini.byId(e):((i=document.createElement("div")).innerHTML=e,i.firstChild):e)&&t)return t.parentNode.insertBefore(e,t),e},mini.__wrap=document.createElement("div"),mini.createElements=function(t){mini.removeChilds(mini.__wrap);var e=0==t.indexOf("<tr");return e&&(t="<table>"+t+"</table>"),mini.__wrap.innerHTML=t,e?mini.__wrap.firstChild.rows:mini.__wrap.childNodes},mini_byId=function(t,e){if("string"!=typeof t)return t;if("#"==t.charAt(0)&&(t=t.substr(1)),i=document.getElementById(t))return i;if(e&&!mini.isAncestor(document.body,e)){for(var i,n=e.getElementsByTagName("*"),s=0,o=n.length;s<o;s++)if((i=n[s]).id==t)return i;i=null}return i},mini_hasClass=function(t,e){if(t=mini.byId(t))return!!t.className&&-1!=String(t.className).split(" ").indexOf(e)},mini_addClass=function(t,e){e&&0==mini.hasClass(t,e)&&jQuery(t).addClass(e)},mini_removeClass=function(t,e){e&&jQuery(t).removeClass(e)};var _ceil=function(t){return Math.ceil(parseFloat(t))};function UUID(){for(var t=[],e="0123456789ABCDEF".split(""),i=0;i<36;i++)t[i]=Math.floor(16*Math.random());t[14]=4,t[19]=3&t[19]|8;for(i=0;i<36;i++)t[i]=e[t[i]];return t[8]=t[13]=t[18]=t[23]="-",t.join("")}function __BindIFrames(){}function js_isTouchDevice(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}function js_touchScroll(t){var e;js_isTouchDevice()&&(t="string"==typeof t?document.getElementById(t):t,e=0,t.addEventListener("touchstart",function(t){e=this.scrollTop+t.touches[0].pageY,t.preventDefault()},!1),t.addEventListener("touchmove",function(t){this.scrollTop=e-t.touches[0].pageY,t.preventDefault()},!1))}mini_getMargins=function(t){t=mini.byId(t);t=jQuery(t);return{top:_ceil(t.css("margin-top"),10)||0,left:_ceil(t.css("margin-left"),10)||0,bottom:_ceil(t.css("margin-bottom"),10)||0,right:_ceil(t.css("margin-right"),10)||0}},mini_getBorders=function(t){t=mini.byId(t);t=jQuery(t);return{top:_ceil(t.css("border-top-width"),10)||0,left:_ceil(t.css("border-left-width"),10)||0,bottom:_ceil(t.css("border-bottom-width"),10)||0,right:_ceil(t.css("border-right-width"),10)||0}},mini_getPaddings=function(t){t=mini.byId(t);t=jQuery(t);return{top:_ceil(t.css("padding-top"),10)||0,left:_ceil(t.css("padding-left"),10)||0,bottom:_ceil(t.css("padding-bottom"),10)||0,right:_ceil(t.css("padding-right"),10)||0}},mini_setWidth=function(t,e){var i,n;t=mini.byId(t),e=parseInt(e),!isNaN(e)&&t&&(jQuery.boxModel&&(i=mini.getPaddings(t),n=mini.getBorders(t),e=e-i.left-i.right-n.left-n.right),t.style.width=(e=e<0?0:e)+"px")},mini_setHeight=function(t,e){var i,n;t=mini.byId(t),e=parseInt(e),!isNaN(e)&&t&&(jQuery.boxModel&&(i=mini.getPaddings(t),n=mini.getBorders(t),e=e-i.top-i.bottom-n.top-n.bottom),t.style.height=(e=e<0?0:e)+"px")},mini_getWidth=function(t,e){return"none"==(t=mini.byId(t)).style.display||"text/javascript"==t.type?0:e?jQuery(t).width():jQuery(t).outerWidth()},mini_getHeight=function(t,e){return"none"==(t=mini.byId(t)).style.display||"text/javascript"==t.type?0:e?jQuery(t).height():jQuery(t).outerHeight()},mini_setBox=function(t,e,i,n,s){i===undefined&&(i=e.y,n=e.width,s=e.height,e=e.x),mini.setXY(t,e,i),mini.setWidth(t,n),mini.setHeight(t,s)},mini_getBox=function(t){var e=mini.getXY(t),t={x:e[0],y:e[1],width:mini.getWidth(t),height:mini.getHeight(t)};return t.left=t.x,t.top=t.y,t.right=t.x+t.width,t.bottom=t.y+t.height,t},mini_setStyle=function(t,e){if((t=mini.byId(t))&&"string"==typeof e)for(var i=jQuery(t),n=e.toLowerCase().split(";"),s=0,o=n.length;s<o;s++){var l,r,a=n[s].split(":");1<a.length&&(2<a.length?(l=a[0].trim(),a.removeAt(0),r=a.join(":").trim(),i.css(l,r)):i.css(a[0].trim(),a[1].trim()))}},mini_getStyle=function(){var t=document.defaultView;return new Function("el","style",["style.indexOf('-')>-1 && (style=style.replace(/-(\\w)/g,function(m,a){return a.toUpperCase()}));","style=='float' && (style='",t?"cssFloat":"styleFloat","');return el.style[style] || ",t?"window.getComputedStyle(el, null)[style]":"el.currentStyle[style]"," || null;"].join(""))}(),mini_isAncestor=function(t,i){var n=!1;if((t=mini.byId(t))===(i=mini.byId(i)))return!0;if(t&&i)if(t.contains)try{return t.contains(i)}catch(e){return!1}else{if(t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(i));for(;i=i.parentNode;)n=i==t||n}return n},mini_findParent=function(t,e,i){t=mini.byId(t);var n,s=document.body,o=0;for("number"!=typeof(i=i||50)&&(n=mini.byId(i),i=10);t&&1==t.nodeType&&o<i&&t!=s&&t!=n;){if(mini.hasClass(t,e))return t;o++,t=t.parentNode}return null},mini.copyTo(mini,{byId:mini_byId,hasClass:mini_hasClass,addClass:mini_addClass,removeClass:mini_removeClass,getMargins:mini_getMargins,getBorders:mini_getBorders,getPaddings:mini_getPaddings,setWidth:mini_setWidth,setHeight:mini_setHeight,getWidth:mini_getWidth,getHeight:mini_getHeight,setBox:mini_setBox,getBox:mini_getBox,setStyle:mini_setStyle,getStyle:mini_getStyle,repaint:function(t){t=t||document.body,mini.addClass(t,"mini-repaint"),setTimeout(function(){mini.removeClass(t,"mini-repaint")},1)},getSize:function(t,e){return{width:mini.getWidth(t,e),height:mini.getHeight(t,e)}},setSize:function(t,e,i){mini.setWidth(t,e),mini.setHeight(t,i)},setX:function(t,e){e=parseInt(e);var i=jQuery(t).offset(),n=parseInt(i.top);n===undefined&&(n=i[1]),mini.setXY(t,e,n)},setY:function(t,e){e=parseInt(e);var i=jQuery(t).offset(),n=parseInt(i.left);n===undefined&&(n=i[0]),mini.setXY(t,n,e)},setXY:function(t,e,i){i={left:parseInt(e),top:parseInt(i)};jQuery(t).offset(i),jQuery.fn.jquery&&-1!=jQuery.fn.jquery.indexOf("1.4")&&jQuery(t).offset(i)},getXY:function(t){t=jQuery(t).offset();return[parseInt(t.left),parseInt(t.top)]},getViewportBox:function(){var t=jQuery(window).width(),e=jQuery(window).height(),i=jQuery(document).scrollLeft(),n=jQuery(document.body).scrollTop();return{x:i,y:n=0==n&&document.documentElement?document.documentElement.scrollTop:n,top:n,left:i,width:t,height:e,right:i+t,bottom:n+e}},showAt:function(t){jQuery;t=jQuery.extend({el:null,x:"center",y:"center",offset:[0,0],fixed:!1,zindex:mini.getMaxZIndex(),timeout:0,timeoutHandler:null,constrain:!1,animation:!1},t);var e=jQuery(t.el)[0],i=t.x,n=t.y,s=t.offset[0],o=t.offset[1],l=t.zindex,r=t.fixed;t.animation;if(e){t.timeout&&setTimeout(function(){t.timeoutHandler&&t.timeoutHandler()},t.timeout);var a=";position:absolute;display:block;left:auto;top:auto;right:auto;bottom:auto;margin:0;z-index:"+l+";";mini.setStyle(e,a);var h,d,a="";if(t&&mini.isNumber(i)&&mini.isNumber(n))return t.fixed&&!mini.isIE6&&(a+=";position:fixed;"),mini.setStyle(e,a),t.constrain&&(h=jQuery(window).width(),l=jQuery(window).height(),(i=i+(d=mini.getSize(e)).width>h?h-d.width:i)<0&&(i=0),(n=n+d.height>l?l-d.height:n)<0&&(n=0)),void mini.setXY(e,i,n);a+="left"==i?"left:"+s+"px;":"right"==i?"right:"+s+"px;":"left:50%;margin-left:"+.5*-(d=mini.getSize(e)).width+"px;",a+="top"==n?"top:"+o+"px;":"bottom"==n?"bottom:"+o+"px;":"top:50%;margin-top:"+.5*-(d=mini.getSize(e)).height+"px;",r&&!mini.isIE6&&(a+="position:fixed"),mini.setStyle(e,a)}},getChildNodes:function(t,e){if(t=mini.byId(t)){for(var i=t.childNodes,n=[],s=0,o=i.length;s<o;s++){var l=i[s];1!=l.nodeType&&!0!==e||n.push(l)}return n}},removeNode:isIE?function(){var e;return function(t){t&&"BODY"!=t.tagName&&((e=e||document.createElement("div")).appendChild(t),e.innerHTML="")}}():function(t){t&&t.parentNode&&"BODY"!=t.tagName&&t.parentNode.removeChild(t)},removeChilds:function(t,e){if(t=mini.byId(t))for(var i=mini.getChildNodes(t,!0),n=0,s=i.length;n<s;n++){var o=i[n];e&&o==e||t.removeChild(i[n])}},isAncestor:mini_isAncestor,findParent:mini_findParent,findChild:function(t,e){for(var i=(t=mini.byId(t)).getElementsByTagName("*"),n=0,s=i.length;n<s;n++){t=i[n];if(mini.hasClass(t,e))return t}},isAncestor:function(t,i){var n=!1;if((t=mini.byId(t))===(i=mini.byId(i)))return!0;if(t&&i)if(t.contains)try{return t.contains(i)}catch(e){return!1}else{if(t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(i));for(;i=i.parentNode;)n=i==t||n}return n},getOffsetsTo:function(t,e){t=this.getXY(t),e=this.getXY(e);return[t[0]-e[0],t[1]-e[1]]},scrollIntoView:function(t,e,i,n){var s=mini.byId(e)||document.body,o=this.getOffsetsTo(t,s),l=o[0]+s.scrollLeft,r=o[1]+s.scrollTop,a=r+t.offsetHeight,h=l+t.offsetWidth,d=s.clientHeight,u=parseInt(s.scrollTop,10),c=parseInt(s.scrollLeft,10),e=u+d,o=c+s.clientWidth;return!1!==n&&(t.offsetHeight>d||r<u?s.scrollTop=r:e<a&&(s.scrollTop=a-d),s.scrollTop=s.scrollTop),!1!==i&&(t.offsetWidth>s.clientWidth||l<c?s.scrollLeft=l:o<h&&(s.scrollLeft=h-s.clientWidth),s.scrollLeft=s.scrollLeft),this},getScrollOffset:function(){var t;return mini._scrollOffset||((t=document.createElement("div")).style.cssText="width:100px;background:#eee;height:50px;overflow:scroll;padding:1px;position:absolute;left:-1000px;top:0;box-sizing:content-box;-moz-box-sizing: content-box;",document.body.appendChild(t),mini._scrollOffset=t.offsetWidth-t.clientWidth,t.parentNode.removeChild(t)),mini._scrollOffset},setOpacity:function(t,e){jQuery(t).css({opacity:e})},selectable:function(t,e){t=mini.byId(t),e?(jQuery(t).removeClass("mini-unselectable"),isIE?t.unselectable="off":(t.style.MozUserSelect="",t.style.KhtmlUserSelect="",t.style.UserSelect="")):(jQuery(t).addClass("mini-unselectable"),isIE?t.unselectable="on":(t.style.MozUserSelect="none",t.style.UserSelect="none",t.style.KhtmlUserSelect="none"))},selectRange:function(t,i,n){var s;t.createTextRange?((s=t.createTextRange()).moveStart("character",i),s.moveEnd("character",n-t.value.length),s.select()):t.setSelectionRange&&t.setSelectionRange(i,n);try{t.focus()}catch(e){}},getSelectRange:function(t){if(t=mini.byId(t)){try{t.focus()}catch(e){}var i,n=0,s=0,s=t.createTextRange&&document.selection?((i=document.selection.createRange().duplicate()).moveEnd("character",t.value.length),n=""===i.text?t.value.length:t.value.lastIndexOf(i.text),(i=document.selection.createRange().duplicate()).moveStart("character",-t.value.length),i.text.length):(n=t.selectionStart,t.selectionEnd);return[n,s]}}}),function(){var s={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},t=document.createElement("div");t.setAttribute("class","t");var o="t"===t.className;mini.setAttr=function(t,e,i){t.setAttribute(!o&&s[e]||e,i)},mini.getAttr=function(t,e){if("height"==e)return jQuery(t).attr("height");if("value"==e&&(isIE6||isIE7)){var i=t.attributes[e];return i?i.value:null}if(!t.getAttribute)return null;var n=t.getAttribute(!o&&s[e]||e);return"function"!=typeof n&&"maxLength"!=e||(i=t.attributes[e])&&(n=i.value),n||"onload"!=e||(e=t.getAttributeNode?t.getAttributeNode(e):null)&&(n=e.nodeValue),n}}(),mini_preventDefault=function(){window.event&&(window.event.returnValue=!1)},mini_stopPropogation=function(){window.event&&(window.event.cancelBubble=!0)},mini_onOne=function(t,e,i,n){t&&(t["on"+e.toLowerCase()]=function(t){if((t=t||window.event).target||(t.target=t.srcElement),t.preventDefault||(t.preventDefault=mini_preventDefault),t.stopPropogation||(t.stopPropogation=mini_stopPropogation),!1===i.call(n,t))return!1})},mini_on=function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;if(mini.findListener(t,e,i,n))return!1;var s=mini.createDelegate(i,n);mini.listeners.push([t,e,i,n,s]),mini.isFirefox&&"mousewheel"==e&&(e="DOMMouseScroll"),jQuery(t).bind(e,s)},mini_un=function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;n=mini.findListener(t,e,i,n);if(!n)return!1;mini._destroying||mini.listeners.remove(n),mini.isFirefox&&"mousewheel"==e&&(e="DOMMouseScroll"),jQuery(t).unbind(e,n[4])},mini.copyTo(mini,{listeners:[],on:mini_on,un:mini_un,_getListeners:function(){return mini.listeners},findListener:function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;for(var s=mini._getListeners(),o=s.length-1;0<=o;o--){var l=s[o];try{if(l[0]==t&&l[1]==e&&l[2]==i&&l[3]==n)return l}catch(ex){}}},clearEvent:function(t,e){if(!(t=mini.byId(t)))return!1;if(mini._destroying)jQuery(t).unbind();else{for(var i=mini._getListeners(),n=i.length-1;0<=n;n--){var s=i[n];s[0]==t&&(e&&e!=s[1]||mini.un(t,s[1],s[2],s[3]))}t.onmouseover=t.onmousedown=null}}}),mini.__windowResizes=[],mini.onWindowResize=function(t,e){mini.__windowResizes.push([t,e])},mini.on(window,"resize",function(t){for(var e=mini.__windowResizes,i=0,n=e.length;i<n;i++){var s=e[i];s[0].call(s[1],t)}}),mini.htmlEncode=function(t){if("string"!=typeof t)return t;return 0==t.length?"":t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")},mini.htmlDecode=function(t){if("string"!=typeof t)return t;return 0==t.length?"":t.replace(/&gt;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"')},mini.copyTo(Array.prototype,{add:Array.prototype.enqueue=function(t){return this[this.length]=t,this},getRange:function(t,e){for(var i=[],n=t;n<=e;n++){var s=this[n];s&&(i[i.length]=s)}return i},addRange:function(t){for(var e=0,i=t.length;e<i;e++)this[this.length]=t[e];return this},clear:function(){return this.length=0,this},clone:function(){return 1===this.length?[this[0]]:Array.apply(null,this)},contains:function(t){return 0<=this.indexOf(t)},indexOf:function(t,e){for(var i=this.length,n=e<0?Math.max(0,i+e):e||0;n<i;n++)if(this[n]===t)return n;return-1},dequeue:function(){return this.shift()},insert:function(t,e){return this.splice(t,0,e),this},insertRange:function(t,e){for(var i=e.length-1;0<=i;i--){var n=e[i];this.splice(t,0,n)}return this},remove:function(t){t=this.indexOf(t);return 0<=t&&this.splice(t,1),0<=t},removeAt:function(t){var e=this[t];return this.splice(t,1),e},removeRange:function(t){for(var e=0,i=(t=t.clone()).length;e<i;e++)this.remove(t[e])}}),mini.isShowBackdrop=!(mini.isIE&&mini.IE_V<=8),mini._MaskID=1,mini._MaskObjects={},mini.mask=function(t){var e=mini.byId(t);mini.isElement(e)?t={el:e}:"string"==typeof t&&(t={html:t}),(t=mini.copyTo({html:"",cls:"",style:"",backStyle:""},t)).el=mini.byId(t.el),t.el||(t.el=document.body);e=t.el;mini.unmask(t.el),e._maskid=mini._MaskID++,mini._MaskObjects[e._maskid]=t;var i=mini.append(e,'<div class="mini-mask"><div class="mini-mask-background" style="'+t.backStyle+'"></div><div class="mini-mask-msg '+t.cls+'" style="'+t.style+'">'+t.html+"</div></div>");e==document.body&&mini.addClass(i,"mini-fixed"),t.maskEl=i,mini.isNull(t.opacity)||mini.setOpacity(i.firstChild,t.opacity);var n=i.lastChild;n.style.display="none",setTimeout(function(){!function(){n.style.display="block";var t=mini.getSize(n);n.style.marginLeft=-t.width/2+"px",n.style.marginTop=-t.height/2+"px",n.style.zIndex=mini.getMaxZIndex()}()},0)},mini.unmask=function(t){t=(t=mini.byId(t))||document.body;var e=mini._MaskObjects[t._maskid];e&&(delete mini._MaskObjects[t._maskid],t=e.maskEl,e.maskEl=null,t&&t.parentNode&&t.parentNode.removeChild(t))},mini.showMaskLoading=function(t){return t=$.extend({el:document.body,cls:"mini-mask-loading",html:mini.Control.prototype.loadingMsg||"Loading..."},t),mini.mask(t)},mini.Cookie={get:function(t){for(var e=document.cookie.split("; "),i=null,n=0;n<e.length;n++){var s=e[n].split("=");t==s[0]&&(i=s)}if(i){var o=i[1];return o===undefined?o:unescape(o)}return null},set:function(t,e,i,n){var s=new Date;null!=i&&(s=new Date(s.getTime()+1e3*i*3600*24)),document.cookie=t+"="+escape(e)+(null==i?"":"; expires="+s.toGMTString())+";path=/"+(n?"; domain="+n:"")},del:function(t,e){this.set(t,null,-100,e)}},mini.copyTo(mini,{treeToArray:function(t,e,i,n,s){e=e||"children";for(var o=[],l=0,r=t.length;l<r;l++){var a=t[l];o[o.length]=a,n&&(a[n]=s);var h=a[e];h&&0<h.length&&(a=a[i],a=this.treeToArray(h,e,i,n,a),o.addRange(a))}return o},arrayToTree:function(t,e,i,n){e=e||"children",i=i||"_id",n=n||"_pid";for(var s,o=[],l={},r=0,a=t.length;r<a;r++)(h=t[r])&&(null!==(s=mini._getMap(i,h))&&s!==undefined&&(l[s]=h),delete h[e]);for(r=0,a=t.length;r<a;r++){var h=t[r],d=l[mini._getMap(n,h)];d?(d[e]||(d[e]=[]),d[e].push(h)):o.push(h)}return o}}),mini.treeToList=mini.treeToArray,mini.listToTree=mini.arrayToTree,String.format=function(t){var i=Array.prototype.slice.call(arguments,1);return(t=t||"").replace(/\{(\d+)\}/g,function(t,e){return i[e]})},String.prototype.trim=function(){var t=/^\s+|\s+$/g;return function(){return this.replace(t,"")}}(),mini.copyTo(mini,{measureText:function(t,e,i){if(this.measureEl||(this.measureEl=mini.append(document.body,"<div></div>")),this.measureEl.style.cssText="position:absolute;left:-1000px;top:-1000px;visibility:hidden;","string"==typeof t)this.measureEl.className=t;else{this.measureEl.className="";for(var n=jQuery(t),s=jQuery(this.measureEl),o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],l=0,r=o.length;l<r;l++){var a=o[l];s.css(a,n.css(a))}}return i&&mini.setStyle(this.measureEl,i),this.measureEl.innerHTML=e,mini.getSize(this.measureEl)}}),"undefined"==typeof mini_layoutOnParse&&(mini_layoutOnParse=!0),mini.enableLayout=!0,mini.autoParse=!0,jQuery(function(){mini.updateDevice(),mini.autoParse&&setTimeout(function(){var t=document.documentElement;(isIE6||isIE7)&&("hidden"==mini.getStyle(document.body,"overflow")||t&&"hidden"==mini.getStyle(t,"overflow"))&&(jQuery(document.body).css("overflow","visible"),t&&jQuery(t).css("overflow","visible")),mini.__LastWindowWidth=document.documentElement.clientWidth,mini.__LastWindowHeight=document.documentElement.clientHeight;new Date;mini.isReady=!0,mini.parse(null,mini_layoutOnParse),mini._FireBindEvents()},1)}),mini_onload=function(t){mini.on(window,"resize",mini_onresize)},mini.on(window,"load",mini_onload),mini.__LastWindowWidth=document.documentElement.clientWidth,mini.__LastWindowHeight=document.documentElement.clientHeight,mini.doWindowResizeTimer=null,mini.allowLayout=!0,mini_onresize=function(t){if(mini.updateDevice(),mini.doWindowResizeTimer&&clearTimeout(mini.doWindowResizeTimer),mini.WindowVisible=mini.isWindowDisplay(),0!=mini.WindowVisible&&0!=mini.allowLayout)if("undefined"!=typeof Ext)mini.doWindowResizeTimer=setTimeout(function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;mini.__LastWindowWidth==t&&mini.__LastWindowHeight==e||(mini.__LastWindowWidth=t,mini.__LastWindowHeight=e,mini.layout(null,!1)),mini.doWindowResizeTimer=null},300);else{var e=100;try{parent&&parent!=window&&parent.mini&&(e=0)}catch(ex){}mini.doWindowResizeTimer=setTimeout(function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;mini.__LastWindowWidth==t&&mini.__LastWindowHeight==e||(mini.__LastWindowWidth=t,mini.__LastWindowHeight=e,mini.layout(null,!1)),mini.doWindowResizeTimer=null},e)}},mini.isDisplay=function(t,e){for(var i=e||document.body;;){if(null==t||!t.style)return!1;if(t&&t.style&&"none"==t.style.display)return!1;if(t==i)return!0;t=t.parentNode}return!0},mini.isWindowDisplay=function(){try{var t=window.parent;if(t==window)return!0;for(var i=t.document.getElementsByTagName("iframe"),n=t.document.getElementsByTagName("frame"),s=[],o=0,l=i.length;o<l;o++)s.push(i[o]);for(o=0,l=n.length;o<l;o++)s.push(n[o]);for(var r=null,o=0,l=s.length;o<l;o++){var a=s[o];if(a.contentWindow==window){r=a;break}}return r?mini.isDisplay(r,t.document.body):!1}catch(e){return!0}},mini.WindowVisible=mini.isWindowDisplay(),mini.layoutIFrames=function(n){var s;document.body&&(s=(n=n||document.body).getElementsByTagName("iframe"),setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t];try{mini.isDisplay(i)&&mini.isAncestor(n,i)&&(i.contentWindow.mini&&(0==i.contentWindow.mini.WindowVisible?(i.contentWindow.mini.WindowVisible=i.contentWindow.mini.isWindowDisplay(),i.contentWindow.mini.layout()):i.contentWindow.mini.layout(null,!1)),i.contentWindow.mini.layoutIFrames())}catch(ex){}}},30))},jQuery.ajaxSetup({cache:!1}),isIE&&setInterval(function(){},2e4),mini_unload=function(t){try{var e=mini._getTopWindow();e[mini._WindowID]="",delete e[mini._WindowID]}catch(ex){}var i=document.body.getElementsByTagName("iframe");if(0<i.length){for(var n=[],s=0,o=i.length;s<o;s++)n.push(i[s]);for(s=0,o=n.length;s<o;s++)try{var l=n[s];if(l._ondestroy=null,l.onload=function(){},jQuery(l).unbind("load"),l.src="",mini.isIE)try{l.contentWindow.document.write(""),l.contentWindow.document.close()}catch(ex){}l.parentNode&&l.parentNode.removeChild(l)}catch(t){}}mini._destroying=!0;for(var r=mini.getComponents().clone(),s=0,o=r.length;s<o;s++){var a=r[s];!0!==a.destroyed&&a.destroy(!1)}r.length=0,r=null,mini.clearEvent(window),mini.clearEvent(document),mini.un(window,"unload",mini_unload),mini.un(window,"load",mini_onload),mini.un(window,"resize",mini_onresize),mini.components={},mini.classes={},mini.uiClasses={},mini.uids={},mini.listeners.length=0,mini._topWindow=null,window.mini=null,window.Owner=null,window.CloseOwnerWindow=null},mini.on(window,"unload",mini_unload),mini.zIndex=1e3,mini.zindex=mini.getMaxZIndex=function(){return mini.zIndex++},mini._placeholder=function(i){var n;function s(){var t,e=i._placeholder_label;e&&(t=(t=i.getAttribute("placeholder"))||i.placeholder,i.value?e.style.display="none":(e.innerHTML=t,e.style.display=""))}(i=mini.byId(i))&&isIE&&!isIE10&&!isIE11&&(i._placeholder?s():(i._placeholder=!0,(n=document.createElement("label")).className="mini-placeholder-label",i.parentNode.appendChild(n),(i._placeholder_label=n).onmousedown=function(){try{i.focus()}catch(e){}},i.onpropertychange=function(t){"value"==(t=t||window.event).propertyName&&s()},s(),mini.on(i,"focus",function(t){i.readOnly||(n.style.display="none")}),mini.on(i,"blur",function(t){s()})))},mini.ajax=function(t){return t.dataType||(t.dataType="text"),window.jQuery.ajax(t)},mini._evalAjaxData=function(t,e){var i=t;return i="string"==typeof t&&"function"==typeof(i=window.eval("("+t+")"))?i.call(e):i};var hasOn=!!jQuery.fn.on;jQuery.fn.on||(jQuery.fn.on=function(t,e,i,n){return this.delegate(e,t,i,n)}),mini._lastDevice,mini.updateDevice=function(){var t="mini-xs",e=jQuery(window).width(),i="xs";768<e&&(t+=" mini-sm",i="sm"),992<e&&(t+=" mini-md",i="md"),1200<e&&(t+=" mini-lg",i="lg"),t+=" mini-"+i+"-active",mini._lastDevice!=i&&(jQuery(document.documentElement).removeClass("mini-xs mini-sm mini-md mini-lg mini-xs-active mini-sm-active mini-md-active mini-lg-active ").addClass(t),mini._lastDevice!=i&&jQuery(window).triggerHandler("devicechange",i),mini._lastDevice=i)},mini.getClipboard=function(t){var e="";return window.clipboardData?e=window.clipboardData.getData("Text"):t&&(e=t.clipboardData.getData("text/plain")),e},mini.setClipboard=function(t){window.clipboardData?window.clipboardData.setData("Text",t):((t=jQuery('<textarea style="position:absolute;left:0;top:-1000px;width:100px;z-index:1000;"></textarea>').appendTo("body").val(t)[0]).select(),t.focus(),document.execCommand("copy"))},mini.getActiveElement=function(){try{return document.activeElement}catch(ex){}},mini.getScrollOffset=function(){var t;return mini._scrollOffset||((t=document.createElement("div")).style.cssText="z-index:1000;width:100px;background:#eee;height:50px;overflow:auto;position:absolute;left:100px;top:100px;",t.innerHTML='<div style="width:50px;height:200px;"></div>',document.body.appendChild(t),mini._scrollOffset=t.offsetWidth-t.clientWidth,t.parentNode.removeChild(t)),mini._scrollOffset}
/***************************************************
* loadJS v1.0
* 
* How to use : http://www.loadjs.org
*
* License : MIT
*
* Date : 2012/04/01
*
***************************************************/,"undefined"==typeof window.rootpath&&(rootpath="/"),mini.loadJS=function(t,e){if(t)return"function"==typeof e?mini.loadJS._async(t,e):mini.loadJS._sync(t)},mini.loadJS._js={},mini.loadJS._async=function(t,e){var i=mini.loadJS._js[t];if((i=i||(mini.loadJS._js[t]={create:!1,loaded:!1,callbacks:[]})).loaded)setTimeout(function(){e()},1);else if(i.callbacks.push(e),!i.create){i.create=!0;var n=document.getElementsByTagName("head")[0],s=document.createElement("script");return s.src=t,s.type="text/javascript",setTimeout(function(){document.all?s.onreadystatechange=function(){"loaded"!=s.readyState&&"complete"!=s.readyState||(o(),i.loaded=!0)}:s.onload=function(){o(),i.loaded=!0},n.appendChild(s)},1),s}function o(){for(var t=0;t<i.callbacks.length;t++){var e=i.callbacks[t];e&&e()}i.callbacks.length=0}},mini.loadJS._sync=function(t){if(!loadJS._js[t]){loadJS._js[t]={create:!0,loaded:!0,callbacks:[]};var e=document.getElementsByTagName("head")[0],i=document.createElement("script");return i.type="text/javascript",i.text=loadText(t),e.appendChild(i),i}},mini.loadText=function(t){var e="",i=document.all&&"file:"==location.protocol,n=null;i?n=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n.onreadystatechange=function(){{var t;4==n.readyState&&(t=i?0:200,n.status==t&&(e=n.responseText))}};var s="_t="+(new Date).getTime();return s=-1==t.indexOf("?")?"?"+s:"&"+s,n.open("GET",t+=s,!1),n.send(null),e},mini.loadJSON=function(t){t=loadText(t);return window.eval("("+t+")")},mini.loadCSS=function(t,e){if(t&&!loadCSS._css[t]){var i=document.getElementsByTagName("head")[0],n=document.createElement("link");return e&&(n.id=e),n.href=t,n.rel="stylesheet",n.type="text/css",i.appendChild(n),n}},mini.loadCSS._css={},mini.innerHTML=function(t,e){(t="string"==typeof t?document.getElementById(t):t)&&(t.innerHTML=e='<div style="display:none">&nbsp;</div>'+e,mini.__executeScripts(t),t.firstChild)},mini.__executeScripts=function(t){for(var e=t.getElementsByTagName("script"),i=0,n=e.length;i<n;i++){var s=(o=e[i]).src;s?mini.loadJS(s):((s=document.createElement("script")).type="text/javascript",s.text=o.text,t.appendChild(s))}for(var o,i=e.length-1;0<=i;i--)(o=e[i]).parentNode.removeChild(o)},mini.getF9FrameSysParams=function(t){return window.EpFrameSysParams&&window.EpFrameSysParams[t]},mini.getCtrDefaultBySysParams=function(t,e){t=mini.getF9FrameSysParams(t);return t!==undefined?t:e},mini.htmlUnescape=function(t){return t+""!==t?t:mini.htmlDecode(t)},mini.htmlEscape=function(t){if(t+""!==t)return t;(e=document.createElement("div")).appendChild(document.createTextNode(t));var t=e.innerHTML,e=null;return t},mini.supportRem=function(){var t=!1,e=document.createElement("span");try{e.style.fontSize="13rem",/rem/.test(e.style.fontSize)&&(t=!0)}catch(i){}return t}(),mini.getFontSizeRatio=function(){return this._fontSizeRatio||(this._fontSizeRatio=mini.Cookie.get("_font_size_ratio_")||parseInt($("html").css("fontSize"))/window.HtmlBaseFontSize),this._fontSizeRatio},mini.setFontSizeRatio=function(t){this._fontSizeRatio=t},mini.copyTo(mini,{overwrite:function(t,e){var i;if("function"==typeof t)i=t.prototype;else{if("object"!=typeof t)return this;i=t}for(var n=1,s=arguments.length;n<s;++n){var o,l=arguments[n];for(o in l)i[o]=l[o]}return t}}),window._rootPath===undefined&&(window._rootPath=function(){var t=location.pathname;return"/"+(t=0===t.indexOf("/")?t.substring(1):t).split("/")[0]}()),mini.loadJS._sync=function(t){if(!mini.loadJS._js[t]){mini.loadJS._js[t]={create:!0,loaded:!0,callbacks:[]};var e=document.getElementsByTagName("head")[0],i=document.createElement("script");return i.type="text/javascript",i.text=mini.loadText(t),e.appendChild(i),i}},mini.loadCSS=function(t,e){if(t&&!mini.loadCSS._css[t]){var i=document.getElementsByTagName("head")[0],n=document.createElement("link");return e&&(n.id=e),n.href=t,n.rel="stylesheet",n.type="text/css",i.appendChild(n),mini.loadCSS._css[t]=n}},mini.isDisplay=function(t,e,i){"function"==typeof e&&(i=e,e=undefined);for(var n=e||document.body;;){if(null==t||!t.style)return!1;if(t&&("none"==jQuery(t).css("display")||mini.isFirefox&&"IFRAME"==t.nodeName&&0===t.getBoundingClientRect().width&&0===t.getBoundingClientRect().height&&0===t.getBoundingClientRect().x&&0===t.getBoundingClientRect().y)){if(!i)return!1;if(!0!==i(t))return!1}if(t==n)return!0;t=t.parentNode}return!0},mini.loadCSS._css={},mini.externalSrc=_rootPath+"/lib/",mini_useShims=!0,mini_debugger=!1,mini.showPageWarning=function(t){var e=$("#mini-pageWarning");e.length||(e=$("<div></div>",{id:"mini-pageWarning",style:"position:fixed;top:30%;left:50%;margin-left:-280px;width:560px;height:40px;color:#dd2727;background:#f2dede;text-align:center;border-radius:3px;line-height:40px;font-size:13px;"}).html(t.html).append($('<span title= "关闭" style= "position: absolute;top:0;right:10px;font-size:18px;line-height:40px;cursor:pointer" onclick= \'$("#mini-pageWarning").remove();\'>×</span>')).css("z-index",t.zIndex||9999).appendTo("body"),setTimeout(function(){e.remove(),e=null},t.timeout||15e3))};var _oGetAttrs=mini.Control.prototype.getAttrs;mini.overwrite(mini.Control,{getAttrs:function(t){var e=_oGetAttrs.call(this,t);return this.getExtraAttrs&&(t=this.getExtraAttrs.call(this,t),mini.copyTo(e,t)),e}}),mini.overwrite(mini.Container,{getAttrs:function(t){return mini.Container.superclass.getAttrs.call(this,t)}}),mini.getValidErrorToolTip=function(){return mini._errorToolTip||(mini._errorToolTip=new mini.ToolTip,mini._errorToolTip.set({selector:".mini-error[data-tooltip]",placement:"topright",trigger:"focus",theme:"error",defaultTheme:"error"}),$(document).on("mousewheel",function(){mini._errorToolTip.close()})),mini._errorToolTip},function(e){var t={errorMode:mini.getCtrDefaultBySysParams("ui_form_errormode","icon"),errorTextEl:null,getErrorTextEl:function(){return this._errorTextEl},_RemoveErrorText:function(){},__doUpdateValid:function(){if(this.el){if(this.removeCls(this._errorCls),this.removeCls(this._invalidCls),jQuery(this.el).removeClass("mini-errorMode-text mini-errorMode-icon"),"border"==this.errorMode&&(this.el.title=""),0==this._IsValid)switch(mini.getValidErrorToolTip(),this.errorMode){case"icon":jQuery(this.el).attr("data-tooltip",this.errorText),this.addCls(this._errorCls),jQuery(this.el).addClass("mini-errorMode-icon");var t=this.getErrorIconEl();t&&(t.title=this.errorText,jQuery(t).attr("data-placement",this.errorTooltipPlacement));break;case"border":jQuery(this.el).attr("data-tooltip",this.errorText),this.addCls(this._invalidCls),this.el.title=this.errorText,this._RemoveErrorIcon(),this._RemoveErrorText();break;case"text":this.addCls(this._errorCls);t=this.getErrorTextEl();jQuery(this.el).addClass("mini-errorMode-text"),t&&e(t).text(this.errorText).attr("title",this.errorText),this._RemoveErrorIcon();break;default:this._RemoveErrorText(),this._RemoveErrorIcon()}else this._RemoveErrorIcon(),this._RemoveErrorText(),jQuery(this.el).attr("data-tooltip",""),mini._errorToolTip&&mini._errorToolTip.close();this.doLayout()}}};mini.overwrite(mini.ValidatorBase,t),mini.overwrite(mini.ListControl,t)}(this.jQuery),mini.IndexColumn=function(t){return mini.copyTo({ignoreCollapseIndex:!1,width:56,cellCls:"",align:"left",draggable:!1,allowDrag:!0,hideable:!0,init:function(t){t.on("addrow",this.__OnIndexChanged,this),t.on("removerow",this.__OnIndexChanged,this),t.on("moverow",this.__OnIndexChanged,this),t.isTree&&(t.on("addnode",this.__OnIndexChanged,this),t.on("removenode",this.__OnIndexChanged,this),t.on("movenode",this.__OnIndexChanged,this),t.on("loadnode",this.__OnIndexChanged,this),this._gridUID=t.uid,this._rowIdField="_id")},getNumberId:function(t){return this._gridUID+"$number$"+t[this._rowIdField]},createNumber:function(t,e){return mini.isNull(t.pageIndex)?e+1:t.pageIndex*t.pageSize+e+1},renderer:function(t){var e=t.sender;this.draggable&&(t.cellStyle||(t.cellStyle=""),t.cellStyle+=";cursor:move;");var i='<div id="'+this.getNumberId(t.record)+'">',t=t.rowIndex;return this.ignoreCollapseIndex,mini.isNull(e.getPageIndex)?i+=t+1:i+=e.getPageIndex()*e.getPageSize()+t+1,i+="</div>"},__updateRowNumbers:function(t){for(var e=t.getDataView(),i=0,n=e.length;i<n;i++){var s=e[i],s=this.getNumberId(s),s=document.getElementById(s);s&&(s.innerHTML=this.createNumber(t,i))}},__OnIndexChanged:function(t){var e=t.sender,i=this;i._toIndex||(i._toIndex=setTimeout(function(){i._toIndex=null,i.__updateRowNumbers(e)},10))}},t)},mini._Columns.indexcolumn=mini.IndexColumn,mini.CheckColumn=function(t){return mini.copyTo({width:40,cellCls:"mini-checkcolumn",headerCls:"mini-checkcolumn",hideable:!0,_multiRowSelect:!0,header:function(t){var e=this.uid+"checkall",e='<span class="mini-grid-checkbox mini-icon '+(t._checkedAll?"mini-grid-checkbox-checked":"")+'" id="'+e+'"></span>';return e=0==this.multiSelect?"":e},getCheckId:function(t,e){return this._gridUID+"$checkcolumn$"+t[this._rowIdField]+"$"+e._id},init:function(t){t.on("_selectchange",this.__OnSelectionChanged,this),t.on("HeaderCellClick",this.__OnHeaderCellClick,this);var e=this;t.on("removerow",function(){t.data&&0==t.data.length&&e._doCheckState(t)});e=this;t.on("load",function(){t.uid;e._doCheckState(t)},this)},renderer:function(t){var e=this.getCheckId(t.record,t.column);t.sender.isSelected&&t.sender.isSelected(t.record);return'<span class="mini-grid-'+(t.sender.getMultiSelect()?"checkbox":"radio")+' mini-icon" id="'+e+'"></span>'},__OnHeaderCellClick:function(t){var e,i,n,s=t.sender;t.column==this&&(t=s.uid+"checkall",(e=document.getElementById(t))&&(i="mini-grid-checkbox-checked",t=!mini.hasClass(e,i),this._checkedAll=t,s.getMultiSelect()?t?(n=s.getDataView(),s.selects(n),mini.addClass(e,i),setTimeout(function(){mini.addClass(e,i)},30)):(n=s.getDataView(),s.deselects(n),mini.removeClass(e,i)):(s.deselectAll(),t&&(s.select(0),mini.addClass(e,i))),s.fire("checkall")))},__OnSelectionChanged:function(t){var e=t.sender,i=e.toArray(),n=this,s=e.isVirtualScroll(),t=e._viewRegion,o=s&&t?t.start:-1,t=t?t.end:-1,l={};if(-1!=o)for(var r=e.getVisibleRows(),a=o,h=t;a<h;a++){var d=r[a];d&&(l[d._id]=!0)}for(a=0,h=i.length;a<h;a++){var u=i[a];-1!=o&&l[u._id]}this._timer||(this._timer=setTimeout(function(){n._doCheckState(e),n._timer=null},10))},_doCheckState:function(t){var e=t.uid+"checkall",i=document.getElementById(e);i&&(e=t.getSelecteds(),t=(t.isTree?t.getList():t.getData()).length,e.length==t&&0!=t?(jQuery(i).addClass("mini-grid-checkbox-checked"),this._checkedAll=!0):(jQuery(i).removeClass("mini-grid-checkbox-checked"),this._checkedAll=!1))}},t)},mini._Columns.checkcolumn=mini.CheckColumn,mini.ExpandColumn=function(t){return mini.copyTo({width:30,headerAlign:"center",align:"center",draggable:!1,cellStyle:"padding:0",cellCls:"mini-grid-expandCell",hideable:!0,renderer:function(t){return'<i class="mini-grid-ecIcon mini-icon" ></i>'},init:function(t){t.on("cellclick",this.__OnCellClick,this)},__OnCellClick:function(t){var e=t.sender;if(t.column==this&&e.isShowRowDetail&&mini.findParent(t.htmlEvent.target,"mini-grid-ecIcon")){var i=e.isShowRowDetail(t.record);if(i){if(t.cancel=!1,e.fire("beforehiderowdetail",t),!0===t.cancel)return}else if(t.cancel=!1,e.fire("beforeshowrowdetail",t),!0===t.cancel)return;e.autoHideRowDetail&&e.hideAllRowDetail(),i?e.hideRowDetail(t.record):e.showRowDetail(t.record)}}},t)},mini._Columns.expandcolumn=mini.ExpandColumn,mini.htmlDecode=function(t){if("string"!=typeof t)return t;return 0==t.length?"":t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"')},mini.createIFrame=function(t,e,i,n,s){var o=(t=t||"").split("#");t=o[0];var l="";if(!0!==i&&(l="_t="+Math.floor(1e6*Math.random()),-1==t.indexOf("_t=")?-1==t.indexOf("?")?t+="?"+l:t+="&"+l:t=t.replace(/_t=(\d+)/,l)),t&&-1==t.indexOf("_winid")&&(l="_winid="+mini._WindowID,-1==t.indexOf("?")?t+="?"+l:t+="&"+l),mini.iframeParams)for(var r in mini.iframeParams)t+="&"+r+"="+mini.iframeParams[r];var i=-1!=(t=o[1]?t+"#"+o[1]:t).indexOf(".mht"),l=i?t:"",o='<iframe name="'+mini.newId("mini-iframe-")+'" src="'+("post"==n?"":l)+'" style="width:100%;height:100%;" allowfullscreen="true" frameborder="0"></iframe>',l=document.createElement("div"),a=mini.append(l,o),h=!1;i?h=!0:setTimeout(function(){a&&("post"!=n&&(a.src=t),h=!0)},5),a.attachEvent?a.attachEvent("onload",m):a.onload=m;var d,u=!1,c=!0;function m(){0==h||u||setTimeout(function(){e&&e(a,c),c=!1},1)}return a._ondestroy=function(){if(u=!0,a.src="",mini.isIE)try{a.contentWindow.document.write(""),a.contentWindow.document.close()}catch(ex){}a._ondestroy=null,a=null},"post"==n&&(d=jQuery("<form />").attr({method:"post",action:t,enctype:"multipart/form-data",target:a.name}).hide().appendTo("body"),setTimeout(function(){d.submit()},10)),a},mini.getScrollBarWidth=function getScrollBarWidth(){var t=document.createElement("div"),e=document.createElement("p");t.style.display=e.style.display="block",e.style.height="100px",t.style.padding=0,t.style.border="none",t.style.overflow="auto",t.style.height="10px",t.appendChild(e),document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return t.parentNode.removeChild(t),t=e=null,i},function(){var t;Object.defineProperty&&!mini.isIE8?Object.defineProperty(mini,"_scrollBarWidth",{get:function(){return t=t||mini.getScrollBarWidth()}}):jQuery(window).on("load",function(){mini._scrollBarWidth=mini.getScrollBarWidth()})}(),function(){mini.reservedAttrsReg=[/title/,/data-*/];var s=mini.applyTo;mini.applyTo=function(t){var i,e=function(t){if(t&&t.hasAttributes&&t.hasAttributes()){for(var e,i=t.attributes,n={},s=!1,o=0,l=i.length;o<l;o++)e=i[o].name,r(e)&&(s=!0,n[e]=i[o].value);return s?n:null}}(t=mini.byId(t)),n=s.apply(this,arguments);return i=this.el,e=e,i&&e&&jQuery.map(e,function(t,e){"title"===e&&/mini-panel/.test(i.className)||i.setAttribute(e,t)}),n};var r=Array.prototype.some?function(e){return mini.reservedAttrsReg&&mini.reservedAttrsReg.some(function(t){return t.test(e)})}:function(t){if(!mini.reservedAttrsReg||!mini.reservedAttrsReg.length)return!1;for(var e=0,i=mini.reservedAttrsReg.length;e<i;e++)if(mini.reservedAttrsReg[e].test(t))return!0;return!1}}(),mini._ValidateVType=function(t,e,i,n){(-1<t.indexOf("int")||-1<t.indexOf("float"))&&-1==t.indexOf("range")&&(t+=";range:0,"+mini._maximumNumber),-1<t.indexOf("float")&&-1==t.indexOf("rangeLength")&&(t+=";rangeLength:0,16"),-1<t.indexOf("decimalLength")&&-1==t.indexOf("range")&&(t+=";range:0,"+Math.floor(mini._maximumNumber/100));for(var s=t.split(";"),o=0,l=s.length;o<l;o++){var r=(t=s[o].trim()).split(":"),a=r[0],h=(h=t.substr(a.length+1,1e3))?h.split(","):[],a=mini.VTypes[a];if(a)if(!0!==a(e,h)){i.isValid=!1;r=r[0]+"ErrorText";i.errorText=n.validateErrorText||n[r]||mini.VTypes[r]||"",i.errorText=String.format(i.errorText,h[0],h[1],h[2],h[3],h[4]);break}}i.isValid&&/[\x00-\x08\x0b-\x0c\x0e-\x1f\x7f]/.test(e)&&(i.isValid=!1,i.errorText="输入的内容中包含非法的特殊字符")},mini._maximumNumber=2147483647,jQuery.extend(mini.VTypes,{mobileErrorText:"输入的手机号码格式不正确",telErrorText:"输入的固定电话号码格式不正确",phoneErrorText:"输入的电话号码格式不正确",phoneWithShortNumErrorText:"输入的电话号码格式不正确",postCodeErrorText:"输入的邮政编码格式不正确",orgCodeErrorText:"输入的统一社会信用代码格式不正确",idCardErrorText:"输入的身份证号码格式不正确",decimalLengthErrorText:"请输入小数，且最多只能输入{0}位小数",projectCodeErrorText:"输入的投资项目统一代码格式不正确",decimalLength:function(t,e){if(0==mini.VTypes["float"](t,e))return!1;if(mini.isNull(t)||""===t)return!0;e=parseInt(e);if(!t||isNaN(e))return!0;t=(t=String(t)).split(".");return 1==t.length||t[1].length<=e},mobile:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^1[3456789]\d{9}$/.test(t)},tel:function(t,e){return!(!mini.isNull(t)&&""!==t)||(/^0\d{2}-\d{8}$/.test(t)||/^0\d{3}-\d{7,8}$/.test(t)||/^\d{7,8}$/.test(t))},phone:function(t,e){return!(!mini.isNull(t)&&""!==t)||(/^1[3456789]\d{9}$/.test(t)||/^0\d{2}-\d{8}$/.test(t)||/^0\d{3}-\d{7,8}$/.test(t)||/^\d{7,8}$/.test(t))},phoneWithShortNum:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^\d[\d-]{2,10}(?!-)$/.test(t)},postCode:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^\d{6}$/.test(t)},orgCode:function(t,e){if(mini.isNull(t)||""===t)return!0;if(/^[A-Z0-9]{8}-[A-Z0-9]$/.test(t))return!0;return!!/^(?![IOSV])([0-9A-Y])([1239])([0-9]{6})(((?![IOSV])[0-9A-Y]){10})$/.test(t)},idCard:function(t,e){return!(!mini.isNull(t)&&""!==t)||function(t){if(!/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/.test(t))return!1;if(18==t.length){for(var e=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),i=new Array(1,0,10,9,8,7,6,5,4,3,2),n=0,s=0;s<17;s++)n+=t.substring(s,s+1)*e[s];var o=n%11,l=t.substring(17);return 2==o?"X"==l||"x"==l:l==i[o]}}(t)},projectCode:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^(19|20)\d{2}-\d{6}-\d{2}-\d{2}-\d{6}$/.test(t)},url:function(t){return!(!mini.isNull(t)&&""!==t)||function(t){var e=t.split("?")[0],i=/^(http|https|ws|wss|ftp|rtsp|mailto|ed2k|thunder):\/\//i.exec(e);i&&(e=e.substr(i[0].length));var n;(t=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.exec(e))?e=e.substr(t[0].length):(n=/^(\w+\.(?!\.))+[a-z]{2,}/i.exec(e))&&(e=e.substr(n[0].length));if(!t&&!n)return!1;if(i=/^:\d{1,5}/.exec(e))if(e=e.substr(i[0].length),65535<parseInt(i[0].substr(1),10))return!1;return 0===e.length||"/"===e||/^\/[\s\S]+/i.test(e)}(t)}}),mini.__mouseWheelHandles={_unDocumentMousewheel:function(){mini.un(document,"mousewheel",this.__OnDocumentMousewheel,this),this._mousewheelXY=null},_onDocumentMousewheel:function(){this._unDocumentMousewheel(),this.popupEl&&(this._mousewheelXY=mini.getXY(this.popupEl),mini.on(document,"mousewheel",this.__OnDocumentMousewheel,this))},__OnDocumentMousewheel:function(t){var i=this;setTimeout(function n(){var t,e;i.isPopup&&(t=i._mousewheelXY,e=mini.getXY(i.popupEl),t[0]!=e[0]||t[1]!=e[1]?i.hide():setTimeout(n,300))},300)}},mini._ParseColumns=function(t){for(var i=[],n=mini.getChildNodes(t),s=0,o=n.length;s<o;s++){var l=n[s],r={},a=null,h=null,d=mini.getChildNodes(l);if(d)for(var u=0,c=d.length;u<c;u++){var m=d[u],f=mini.getAttr(m,"property");if(f&&("columns"==(f=f.toLowerCase())&&(r.columns=mini._ParseColumns(m),m.parentNode&&m.parentNode.removeChild(m)),"editor"==f||"filter"==f)){for(var p=m.className.split(" "),g=0,_=p.length;g<_;g++){var v=p[g],v=mini.getClassByUICls(v);if(v){v=new v;"filter"==f?(h=v.getAttrs(m)).type=v.type:(a=v.getAttrs(m)).type=v.type;break}}m.parentNode&&m.parentNode.removeChild(m)}}if(r.header=l.innerHTML,mini._ParseString(l,r,["name","header","field","editor","filter","renderer","width","type","renderer","headerAlign","align","headerCls","cellCls","headerStyle","cellStyle","displayField","dateFormat","listFormat","mapFormat","numberFormat","trueValue","falseValue","dataType","vtype","currencyUnit","summaryType","summaryRenderer","groupSummaryType","groupSummaryRenderer","defaultValue","defaultText","decimalPlaces","data-options","sortField","sortType","emptyText"]),mini._ParseBool(l,r,["allowCellWrap","visible","readOnly","allowSort","allowResize","allowMove","allowDrag","autoShowPopup","unique","autoEscape","enabled","hideable","showCellTip","valueFromSelect","navUpdown"]),mini._ParseInt(l,r,["minWidth"]),a&&(r.editor=a),h&&(r.filter=h),"string"==typeof r.editor)try{r.editor=window.eval("("+r.editor+")")}catch(e){}r.dataType&&(r.dataType=r.dataType.toLowerCase()),mini.getF9FrameSysParams("gridColumnEmptyText")!==undefined&&(r.emptyText=mini.getF9FrameSysParams("gridColumnEmptyText")),r.emptyText||!1===mini.getF9FrameSysParams("gridEnableColumnEmptyText")||(r.dataType&&-1!==jQuery.inArray(r.dataType,["int","float","date","boolean","currency"])?"int"!=r.dataType&&"float"!=r.dataType||(r.emptyText=0):r.emptyText="--"),"true"===r.defaultValue&&(r.defaultValue=!0),"false"===r.defaultValue&&(r.defaultValue=!1),i.push(r);l=r["data-options"];(l=l&&window.eval("("+l+")"))&&mini.copyTo(r,l)}return i};var _oParseFloat=mini.parseFloat;mini.parseFloat=function(t,e,i){return t||0===t?"number"==typeof t?t:(t=t.toString(),0!==i.indexOf("n")||(n=parseInt(i.substr(1),10))&&(t=t.substr(0,t.indexOf(".")+n)),_oParseFloat(t,e,i)):null;var n},mini.ListControl.prototype.setData=function(t){"string"==typeof t&&(t=window.eval(t)),mini.isArray(t)||(t=[]),this.data=t,this.doUpdate(),""!=this.value&&(t=this.findItems(this.value),this.deselectAll(),this.selects(t))},function(s){var o=window.mini.regClass||window.mini_regClass;mini._EpointExt={},window.mini.addEpointExt=function(t,e){t=t.toLowerCase(),(mini._EpointExt[t]||(mini._EpointExt[t]=[])).push(e)},window.mini.getEpointExt=function(t){t=t.toLowerCase();var e=mini._EpointExt[t];if(delete mini._EpointExt[t],s.isArray(e)&&e.length){var i=[];return s.each(e,function(t,e){e&&"function"==typeof e&&(e=e(),s.isArray(e)?i.push.apply(i,e):i.push(e))}),i}return[]},window.mini_regClass=window.mini.regClass=function(t,e){var i=[t],n=mini.getEpointExt(e);return s.isArray(n)&&n.length&&(s.each(n,function(t,e){i.push(e)}),mini.overwrite.apply(mini,i)),o.apply(this,arguments)}}(jQuery),mini.addEpointExt("AutoComplete",function(){return{isLocalData:!1,setIsLocalData:function(t){this.isLocalData=t,this.isLocalData&&(this.setRemote(!1),this.setData(this._getLocalListData()))},_localKey:undefined,_getLocalKey:function(){return this._localKey||(this._localKey=this.id+"_local_data"),this._localKey},_localData:undefined,_getLocalData:function(){return this._localData||(this._localData=window.localStorage.getItem(this._getLocalKey())||""),this._localData},_localListData:undefined,_getLocalListData:function(){var t=[];if(!this._localListData){for(var e,i=0,n=(e=this._getLocalData().split(";")).length;i<n;i++)t.push({id:e[i],text:e[i]});this._localListData=t}return this._localListData},_updateLocalData:function(t){this._localData=t,window.localStorage.setItem(this._getLocalKey(),t)},_updateLocalListData:function(t){this._localListData=t,this.setData(t)},_addLocalData:function(t){var e=this._getLocalData(),i=this._getLocalListData(),n={};!t||-1<(";"+e+";").indexOf(";"+t+";")||(n[this.textField]=t,n[this.valueField]=t,i.unshift(n),e=t+(e?";"+e:""),10<i.length&&(i.length=10,e=e.substr(0,e.lastIndexOf(";"))),this._updateLocalData(e),this._updateLocalListData(i))},_OnValueChanged:function(){mini.AutoComplete.superclass._OnValueChanged.call(this);var t=this.getValue();t&&this.isLocalData&&this._addLocalData(t)},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["isLocalData"]),e}}}),mini.addEpointExt("button",function(){return{disableMultiClick:mini.getCtrDefaultBySysParams("buttonDisableMultiClick",!0),iconPosition:"left",_iconOnlyCls:"mini-button-iconOnly",_iconPosCls:{left:"mini-button-iconLeft",right:"mini-button-iconRight",top:"mini-button-iconTop",bottom:"mini-button-iconBottom"},ghostCls:"mini-button-ghost",state:"default",_statePrefix:"mini-button-state-",_stateList:["default","primary","info","success","warning","danger"],_semantic2state:{"mini-btn-primary":"primary","mini-btn-info":"info","mini-btn-success":"success","mini-btn-warning":"warning","mini-btn-danger":"danger"},_loadingSvg:mini.isIE8||mini.isIE9?"":'<svg class="mini-button-loading-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="128" height="128" fill="currentColor" ><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg>',set:function(t){return"string"==typeof t||(this._allowUpdate=!(t.text||t.iconStyle||t.iconCls||t.iconPosition),this._applyState(t),this._applyGhost(t),t.state=t.state||this.state,mini.Button.superclass.set.call(this,t),!1===this._allowUpdate&&(this._allowUpdate=!0,this.doUpdate())),this},_create:function(){this.el=document.createElement("a"),this.el.className="mini-button mini-corner-all",this.el.hideFocus=!0,this.el.href="javascript:void(0)",this.doUpdate()},setIconPosition:function(t){this.iconPosition=t,this.doUpdate()},setGhost:function(t){this.ghost=!!t,this.ghost?this.addCls(this.ghostCls):this.removeCls(this.ghostCls)},getGhost:function(){return this.ghost},_applyGhost:function(t){var e=t.state||this.state;t.ghost===undefined&&(t.ghost="primary"!==e)},_applyState:function(t){var e=t.cls;if(e)for(var i,n=(e=e.split(" ")).length-1;0<=n;n--)if(i=e[n],/mini-btn-(?:primary|info|success|warning|danger)/.test(i)){t.state=this._semantic2state[i]||"default";break}},setState:function(t){return-1!==jQuery.inArray(t,this._stateList)?(this.removeCls(this._statePrefix+this.state),this.state=t,this.addCls(this._statePrefix+this.state)):window.console&&console.error&&console.error(t+"不是有效的state值"),this.state},getState:function(){return this.state},doUpdate:function(){var t,e,i,n,s,o,l;!1!==this._allowUpdate&&(t=this.text,e=this.iconCls,i=this.iconStyle||"",n=this.iconPosition,s=this.plain,l=e||i||this.img,o=[],""===t?this.addCls(this._iconOnlyCls):(this.removeCls(this._iconOnlyCls),o.push('<span class="mini-button-text">'+t+"</span>")),s?this.addCls(this._plainCls):this.removeCls(this._plainCls),l?(mini.hasClass(this.el,this._iconOnlyCls)||(this.__prevIconPos&&this.removeCls(this._iconPosCls[this.__prevIconPos]),this.addCls(this._iconPosCls[n]),this.__prevIconPos=n),l="",this.img&&(l+="background: url("+this.img+") center no-repeat;"),i&&(l+=i),l='<i class="mini-button-icon '+e+'" '+l+"></i>","top"==n||"left"==n?(o.unshift(l),o.unshift(this._loadingSvg)):(o.push(l),o.push(this._loadingSvg)),this.removeCls("mini-button-textOnly")):(this.addCls("mini-button-textOnly"),o.unshift(this._loadingSvg)),this.allowCls&&o.push('<span class="mini-button-allow mini-icon '+this.allowCls+'"></span>'),this.el.innerHTML=o.join(""))},setIsLoading:mini.isIE8||mini.isIE9?function(t){this.isLoading=!!t,this.setEnabled(!this.isLoading)}:function(t){this.enabled&&(this.isLoading=!!t,this.isLoading?this.addCls("mini-btn-loading"):this.removeCls("mini-btn-loading"))},getIsLoading:function(){return this.isLoading},_enableTimer:undefined,_initEvents:function(){var e=this;mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"click",function(t){e.isLoading||(mini._lastClickedBtn={id:e.id,text:e.text},e.__OnClick(t),mini._lastClickedBtn=undefined,e.disableMultiClick&&e.enabled&&(e.setEnabled(!1),e._enableTimer=setTimeout(function(){e.setEnabled(!0)},1e3)))},this)},this)},setEnabled:function(t){this._enableTimer&&clearTimeout(this._enableTimer),mini.Button.superclass.setEnabled.call(this,t)},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["disableMultiClick","isloading","ghost"]),mini._ParseString(t,e,["state"]),e}}}),mini.addEpointExt("MenuButton",function(){var e=mini.MenuButton.prototype.setMenu;return{yOffset:2,setMenu:function(t){t=e.call(this,t);return this.menu&&this.menu.setyOffset&&this.menu.setyOffset(this.yOffset),t},disableMultiClick:!1}}),mini.addEpointExt("ButtonEdit",function(){return{autoClear:!0,errorTextEl:null,getErrorTextEl:function(){return this.errorTextEl||(this.errorTextEl=mini.append(this.el,'<span class="mini-errorText"></span>')),this.errorTextEl},_RemoveErrorText:function(){var t;this.errorTextEl&&(t=this.errorTextEl,jQuery(t).remove()),this.errorTextEl=null}}}),mini.addEpointExt("Calendar",function(){var t={__OnClick:function(t){var e,i,n,s=this.viewDate;0!=this.enabled&&(e=t.target,i=mini.findParent(t.target,"mini-calendar-title"),mini.hasClass(e,"mini-button-disabled")||(mini.findParent(e,"mini-calendar-monthNext")?(s.setDate(1),s.setMonth(s.getMonth()+1),this.setViewDate(s)):mini.findParent(e,"mini-calendar-yearNext")?(s.setDate(1),s.setFullYear(s.getFullYear()+1),this.setViewDate(s)):mini.findParent(e,"mini-calendar-monthPrev")?(s.setDate(1),s.setMonth(s.getMonth()-1),this.setViewDate(s)):mini.findParent(e,"mini-calendar-yearPrev")?(s.setDate(1),s.setFullYear(s.getFullYear()-1),this.setViewDate(s)):mini.findParent(e,"mini-calendar-tadayButton")?(n=!!mini.findParent(e,"yesterday"),s=new Date,n&&s.setDate(s.getDate()-1),this.setViewDate(s),this.setSelectedDate(s),this.currentTime&&(n=new Date,this.setTime(n)),this._OnDateClick(s,"today")):mini.findParent(e,"mini-calendar-clearButton")?(this.setSelectedDate(null),this.setTime(null),this._OnDateClick(null,"clear")):mini.findParent(e,"mini-calendar-okButton")?this._OnDateClick(null,"ok"):i&&this.showMenu(),(t=mini.findParent(t.target,"mini-calendar-date"))&&!mini.hasClass(t,"mini-calendar-disabled")&&(t=t.id.split("$"),-1!=(t=parseInt(t[t.length-1]))&&(t=new Date(t),this._OnDateClick(t)))))},enbaleOkButton:function(t){this.showOkButton&&mini[t?"removeClass":"addClass"](this.okButtonEl,"mini-button-disabled")},_OnValueChanged:function(){this.showOkButton&&mini[this.getValue()?"removeClass":"addClass"](this.okButtonEl,"mini-button-disabled"),this.fire("valuechanged")},getShortWeek:function(t){return this.daysShort[t=6<t?7-t:t]},getFirstDayOfWeek:function(){return this.firstDayOfWeek},setFirstDayOfWeek:function(t){6<(t="number"!=typeof t?window.parseInt(t,10):t)||t<0||(this.firstDayOfWeek=t,this.doUpdate())},getExtraAttrs:function(t){var e={};return mini._ParseInt(t,e,["firstDayOfWeek"]),e}};return mini.supportRem&&(t.width="2.20rem",t.height="1.6rem"),t}),mini.addEpointExt("CheckBoxList",function(){return{repeatLayout:"flow",errorTooltipPlacement:"topright",_initEvents:function(){mini.CheckBoxList.superclass._initEvents.call(this);var i=this._errorIconEl;mini.on(i,"click",function(t){var e=mini.getValidErrorToolTip();e.open(i),jQuery("body").on("click.mini_error_tooltip",function(t){t.target!=i&&(e.hide(),jQuery("body").off("click.mini_error_tooltip"))})})},getErrorTextEl:function(){return this.errorTextEl||(this.errorTextEl=mini.append(this.cellEl,'<span class="mini-errorText"></span>')),this.errorTextEl},_RemoveErrorText:function(){var t;this.errorTextEl&&(t=this.errorTextEl,jQuery(t).remove()),this.errorTextEl=null}}}),mini.addEpointExt("ComboBox",function(){return{autoLoad:!0,__input:function(t){document.activeElement==this._textEl&&t.which&&this._tryQuery()},setUrl:function(t,e){this.getPopup(),this.autoLoad||e?(this._listbox.setUrl(t),this.url=this._listbox.url,this.data=this._listbox.data,this.doDataChange()):(this.url=t,this.isLoaded=!1)},load:function(t){"string"==typeof(t=t||this.url)?this.setUrl(t,!0):this.setData(t)},setAutoLoad:function(t){this.autoLoad=!!t},getAutoLoad:function(){return this.autoLoad},showPopup:function(){0==this.isLoaded&&this.load();var t,e={cancel:!1};this.fire("beforeshowpopup",e),this._firebeforeshowpopup=!1,1!=e.cancel&&(this._listbox.setHeight("auto"),mini.ComboBox.superclass.showPopup.call(this),""==(t=this.popup.el.style.height)||"auto"==t?this._listbox.setHeight("auto"):this._listbox.setHeight("100%"),this.multiSelect||(t=(e=jQuery("table .mini-listbox-checkbox",this._listbox.el)).css("display"),e.css("display","table-cell"),e.css("display",t)),this._listbox.setValueInCheckOrder(this.valueInCheckOrder),this._listbox.setValue(this.value),this.autoFocusItem&&(""==this.value||mini.isNull(this.value))&&this._listbox._focusItem(0))},setValue:function(t){mini.isNull(t)&&(t="");var e=this._listbox.getValueAndText(t),i=e[0],e=e[1];""!==e&&!mini.isNull(e)||(e=t),this.valueFromSelect&&(""===i||mini.isNull(i))?(this.isLoaded||(this._temporaryValue=t),t=e=""):this._temporaryValue="",this.value=t,this._valueEl.value=this.value,this.setText(e)},setText:function(t){null!==t&&t!==undefined||(t=""),t=mini.htmlDecode(t);this.text;this.text=t,this._textEl.value=t,this._doEmpty()},doDataChange:function(){var t=this._listbox.getValueAndText(this.value||this._temporaryValue),e=t[0],t=t[1];""!==e||this.clearOnLoad||(e=this.value,t=this.text,this.value=null),this.text=this._textEl.value=t,this.setValue(e),this.isLoaded=!0},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["autoLoad"]),e}}}),function($){mini.ActionColumn=function(config){return mini.copyTo({width:152,cellCls:"mini-actioncolumn mini-actioncolumn-cell",headerCls:"mini-actioncolumn",hideable:!0,allowDrag:!0,minWidth:88,iconWidth:16,textWidth:54,itemGap:16,asText:!1,plain:!1,defaultShowItems:4,calcWidth:function(t){var e=Math.min(t,this.defaultShowItems),t=this.asText?this.textWidth:this.iconWidth;return Math.max(this.minWidth,t*e+this.itemGap*(e-1)+24)+"px"},renderer:function(s){var o=this,l=s.sender,r=s.record,a=s.column,t=a.__actions;if(!t||!t.length)return"";var e,i,n,h="",d=a._id,u={};return a.__hasIconRender?($.each(t,function(t,e){var i,n;e.renderer+""===e.renderer&&(e.renderer=o.__getFun(e.renderer,!0)),e&&"function"===$.type(e.renderer)?(i={sender:l,record:r,row:s.row,column:a,icon:{icon:e.icon}},n=e.renderer.call(l,i),"string"===$.type(n)&&n.length&&window.console&&console.warn&&console.warn("图标渲染内容不可自定义，仅可通过e.icon.disabled 和 e.icon.visible 控制图标按钮的禁用和显示状态"),u[e._id]={disabled:!0===i.icon.disabled,visible:!1!==i.icon.visible}):u[e._id]={disabled:!1,visible:!0}}),(e=$.grep(t,function(t){return u[t._id].visible})).length>o.defaultShowItems?(h=$.map(e.slice(0,o.defaultShowItems-1),function(t){return c(t,u[t._id].disabled)}).join(""),i=[],n=[],$.map(e.slice(o.defaultShowItems-1),function(t){i.push(t._id),u[t._id].disabled&&n.push(t._id)}).join(","),h+=c(a.__actionsMap.showMore,!1,i.join(","),n.join(","))):h=$.map(e,function(t){return c(t,u[t._id].disabled)}).join("")):h=$.map(t.slice(0,o.defaultShowItems),function(t){return c(t)}).join(""),'<div class="mini-actioncolumn-wrap" data-column-id="'+d+'" data-record-id="'+r._uid+'">'+h+"</div>";function c(t,e,i,n){i='<i class="action-icon '+(o.asText?"":t.icon)+(e?" mini-disabled":"")+'" title="'+t.title+'" data-column-id="'+d+'" data-icon-id="'+t._id+'" data-record-id="'+r._uid+'" '+(i?'data-over-ids="'+i+'"':"")+(n?' data-disabled-ids="'+n+'"':"")+"></i>";if(o.asText){n=$(i);return n.removeClass("action-icon").addClass("action-text").text(n.attr("title")).css("width",o.textWidth),o.plain||n.addClass("asBtn"),n[0].outerHTML}return i}},__onCellClick:function(t){var e,i;t.column._id===this._id&&(i=(e=t.htmlEvent.target).getAttribute("data-icon-id"),(i=t.column.__actionsMap[i])&&i.handle&&!$(e).hasClass("mini-disabled")&&this.__callHandle(i.handle,t.record,t.sender,e))},__callHandle:function(fn,record,grid,el){var type=$.type(fn),isCall;if("function"===type)return fn.call(grid,record,el);"string"===type&&(isCall=/\(.*\)/.test(fn),isCall?eval(fn):eval(fn)(record,el))},__getFun:function(t,e){return window[t]&&"function"===$.type(window[t])?window[t]:!e&&t},init:function(n){var s=this,t=$("<div></div>").html(s.header),i=[];s.__hasIconRender=!1;var o={},e=$.map(t.find('[type="action"]').remove(),function(t,e){t={id:t.getAttribute("id")||e+1,_id:e+1,icon:t.getAttribute("icon"),title:t.textContent||t.innerText||t.getAttribute("title"),handle:t.getAttribute("onclick"),renderer:t.getAttribute("renderer")};return t.handle||i.push(t),(o[t._id]=t).renderer&&(s.__hasIconRender=!0),t});t.find(">*").remove(),s.header=$.trim(t.text())||"操作",s.__actions=e,s.__actionsMap=o,s.width=s.calcWidth(e.length),e.length>this.defaultShowItems&&(o[(t={_id:"showMore",icon:"icon-omit",title:"更多",handle:function(t,e){s.__extMenu||s.__createExtMenu(n);{var i;s.__extMenu.__currentRecordId=t._uid,s.__hasIconRender&&(t=(e.getAttribute("data-over-ids")||"").split(","),i=(e.getAttribute("data-disabled-ids")||"").split(","),s.__extMenu.setItems($.map(t,function(t){var e=s.__actionsMap[t];return{id:t,text:e.title,iconCls:e.icon,enabled:-1===i.indexOf(t)}})))}s.__extMenu.popupEl=e,s.__extMenu.showAtEl(e),$(e).addClass("active")}})._id]=t,s.__hasIconRender||(e.splice(s.defaultShowItems-1,0,t),this.__createExtMenu(n),this.__extMenu.setItems($.map(this.__actions.slice(s.defaultShowItems),function(t){return{id:t._id,text:t.title,iconCls:t.icon}})))),i.length&&$.each(i,function(t,e){console&&console.warn&&console.warn(s.header+"列的【"+e.icon+"】未配置点击事件！！！")}),i=null,n.on("cellClick",this.__onCellClick,this),s.__inited=!0},__createExtMenu:function(i){var n,t,s=this;function e(){n.hide()}return this.__extMenuInited||((n=new mini.Menu).set({minWidth:50,yOffset:4}),n.on("itemclick",function(t){var e=t.item.id,t=s.__actionsMap[e],e=n.__currentRecordId,e=i.getRowByUID(e);t&&t.handle&&s.__callHandle(t.handle,e,i)}),t=n.hide,n.hide=function(){t.apply(this,arguments),$('[data-icon-id="showMore"]').removeClass("active"),i._rowsEl.removeEventListener&&i._rowsEl.removeEventListener("scroll",e,!0)},this.__extMenu=n,this.__extMenuInited=!0,i._rowsEl.addEventListener&&n.on("open",function(){i._rowsEl.addEventListener("scroll",e,!0)})),this.__extMenu}},config)},mini._Columns.actioncolumn=mini.ActionColumn}(window.jQuery),mini.addEpointExt("DataGrid",function(){function i(t){if(!t)throw new Error("options is required");var e=t.grid;if(!(e=e+""===e?mini.get(e):e)||!mini.isControl(e))throw new Error("必须配置表格");this.grid=e,this._events={},this.options=u.extend({},i.defaultOptions,t),~["server","client"].indexOf(this.options.filterMode)||(window.console&&console.error(this._logPrefix,'[filterMode] must be one of "server" or "client"'),this.options.filterMode="client"),this.onFilter=this.options.onFilter,delete this.options.onFilter,this.init()}var u,t;!function(n){var t=mini.GridView.prototype._createPagers;mini.overwrite(mini.DataGrid,{pagerType:"pagination",_createPagers:function(){t.apply(this,arguments),"pager"!==this.pagerType&&this.setPagerType(this.pagerType)}});var s=mini.FrozenGridView.prototype._createRowsHTML;mini.FrozenGridView.prototype._createRowsHTML=function(){var t=s.apply(this,arguments);if((e=parseInt(n(this.el).find(".mini-grid-rows-view").height(),10))&&200<e){var e=.3*e>>0,i=n(t);return i.find(".mini-grid-emptyText").css({paddingTop:e+56,backgroundPosition:"center "+e+"px"}),i[0].outerHTML}return t};var i=mini.DataGrid.prototype.setShowVGridLines,o=mini.DataGrid.prototype.setShowHGridLines;function e(){!0===this.showCellTip&&("treegrid"!==this.type&&"pagertree"!=this.type||n(this._contentEl).find(".mini-tree-nodetext").each(function(t,e){e.title=n.trim(e.textContent||e.innerText)}),n(this._contentEl).find(".mini-grid-cell-inner").add(n(this._columnsEl).find(".mini-grid-headerCell-inner")).each(function(t,e){n(e).parent().hasClass("mini-tree-treecell")||(e.title=n.trim(e.textContent||e.innerText))}),n(this._columnsEl).find(".mini-grid-sortIcon:not([title]),.mini-grid-allowsort:not([title])").each(function(t,e){e.title="点击排序"}))}mini.DataGrid.prototype.setShowVGridLines=function(t){var e=i.apply(this,arguments);return t?n(this.el).addClass("mini-grid-showVGridLines"):n(this.el).removeClass("mini-grid-showVGridLines"),e},mini.DataGrid.prototype.setShowHGridLines=function(t){var e=o.apply(this,arguments);return t?n(this.el).addClass("mini-grid-showHGridLines"):n(this.el).removeClass("mini-grid-showHGridLines"),e},mini._Grid_CellToolTip.prototype.destroy=function(){mini.un(this.owner.el,"mousemove",this.__OnGridMouseMove,this)},mini.DataGrid.prototype._afterApply=function(){!function(){this.showHGridLines?n(this.el).addClass("mini-grid-showHGridLines"):n(this.el).removeClass("mini-grid-showHGridLines"),this.showVGridLines?n(this.el).addClass("mini-grid-showVGridLines"):n(this.el).removeClass("mini-grid-showVGridLines")}.apply(this,arguments),this._CellToolTip&&this._CellToolTip.destroy&&(this._CellToolTip.destroy(),this.on("update",e,this))},n(function(){mini.grid_error_toolTip=new mini.ToolTip,mini.grid_error_toolTip.set({selector:".mini-grid-cell-error",placement:"top",trigger:"hover",theme:"error",autoHide:!0,defaultTheme:"error",onbeforeopen:function(t){var e=t.element.getAttribute("id"),i=mini.getAndCreate(n(t.element).closest(".mini-grid")[0]);e&&i&&(e=e.replace("$cell$","$"),(e=i._cellMapErrors&&i._cellMapErrors[e])&&(t.content=e.errorText,t.cancel=!1))}})})}(window.jQuery),window,u=window.jQuery,i.defaultOptions={keepFilter:!0,columns:[],filterMode:"client",onFilter:function(){}},u.extend(i.prototype,{on:mini.Control.prototype.on,fire:mini.Control.prototype.fire,un:mini.Control.prototype.un,findListener:mini.Control.prototype.findListener,_logPrefix:"[HeaderFilter]",__genderId:(t=0,function(){return"HeaderFilter-"+t++}),init:function(){this._id=this.__genderId(),this._columnControls=[],this.setColumns(this.options.columns),this.grid.on("headercellclick",this.__handleFilterClick,this),this.grid.on("columnschanged",this.__handleGridColumnChanged,this),this.grid.on("update",this.__handleGridUpdate,this),this.grid._dataSource.on("loaddata",this.__handleNewData,this),this.fire("init")},destroy:function(){this.clearFilter(),this.__clearOldColumns(),u(this.grid.el).find(".mini-datagrid-headerfilter-trigger").remove(),this.grid.un("headercellclick",this.__handleFilterClick,this),this.grid.un("columnschanged",this.__handleGridColumnChanged,this),this.grid.un("update",this.__restoreFilterStatus,this),this.grid._dataSource.un("loaddata",this.__handleNewData,this)},__handleNewData:function(){if(!this.options.keepFilter)return this.clearFilter(),this;var i=!1,n=this;return u.each(this.filterColumns,function(t,e){e=n.filterColumnCfgMap[e.name];if(e.__filterChecked&&e.__filterChecked.length)return!(i=!0)}),i&&this.__doFilter(),this},__handleGridColumnChanged:function(){this.__gridColumnChanged=!0},__doGridColumnChanged:function(){this.clearFilter(),this.__clearOldColumns(),u.map(this._columnControls,function(t){t.destroy&&t.destroy(!0)}),this._columnControls=[],this.setColumns(this.options.columns)},__handleGridUpdate:function(t){this.__gridColumnChanged!==undefined&&this.__gridColumnChanged&&(this.__doGridColumnChanged(t),this.__gridColumnChanged=undefined),this.__restoreFilterStatus(t)},__handleFilterClick:function(t){var e=t.htmlEvent,i=u(e.target);i.hasClass("mini-datagrid-headerfilter-trigger")&&(e.stopPropagation(),t=t.column,i.hasClass("show")?(i.removeClass("show"),this.hideColumnFilter(t)):(i.addClass("show"),this.showColumnFilter(t,e.target)))},__getHeaderElByTrigger:function(t){return u(t).closest(".mini-grid-headerCell")[0]},setColumns:function(t){var t=u.isArray(t)?t:[],o=[],l={},r={},a=this.grid,h=this,d=this.options.filterMode;return u.each(t,function(t,e){var i,n,s;e&&e.name&&("client"!=d||"function"==typeof e.filterMethod)?(i=a.getColumn(e.name))?(/mini-datagrid-headerfilter-trigger/.test(i.header)||(i.header+='<span class="mini-datagrid-headerfilter-trigger action-icon icon-filter" title="点击过滤">️</span>'),i.inited&&(s=a.getHeaderCellEl(i),n=u(s).find(".mini-grid-headerCell-inner"),s=u('<span class="mini-datagrid-headerfilter-trigger action-icon icon-filter" title="点击过滤">️</span>'),n.find("> .mini-datagrid-headerfilter-trigger").length||(n.children().length?s.insertBefore(n.children().eq(0)):s.appendTo(n))),e.__filterChecked=[],o.push(i),l[i.name]=i,r[i.name]=e):window.console&&console.error(h._logPrefix,"can't find column that named "+e.name):window.console&&console.error(h._logPrefix,e," is not a valid filter column")}),this.filterColumns=o,this.filterColumnMap=l,this.filterColumnCfgMap=r,this},__clearOldColumns:function(){u.map(this.filterColumnCfgMap,function(t){t.__filterChecked=[],t.popup&&(t.popup.destroy&&t.popup.destroy(),t.popup=null)}),this.filterColumns=[],this.filterColumnMap={},this.filterColumnCfgMap={}},showColumnFilter:function(t,e){var i=this.__renderColumnFilter(t),t=e||this.grid.getHeaderCellEl(t);i.popupEl=t,[].some&&mini.getChildControls(i).some(function(t){if("panel"==t.type)return t.setMaxHeight(window.innerHeight-120),!0}),i.showAtEl(t)},hideColumnFilter:function(t){t=this.filterColumnCfgMap[t.name];t.popup&&t.popup.hide()},__restoreFilterStatus:function(){var i=this;return u.map(this.filterColumns,function(t){var e=i.filterColumnCfgMap[t.name],t=u(i.grid.getHeaderCellEl(t)).find(".mini-datagrid-headerfilter-trigger");e.__filterChecked&&e.__filterChecked.length?t.addClass("active"):t.removeClass("active")}),this},__renderColumnFilter:function(t){var e=this.filterColumnCfgMap[t.name];return this.__createPopupPanel(e,t)},__createPopupPanel:function(e,i){var n=this,t=e.filterMultiple?e.filters:[{id:"__reset",text:"全部"}].concat(e.filters);if(e.popup)return e.popup;var s=Math.min(12,Math.max.apply(Math,u.map(t,function(t){return(t.text||t.id).length}))),o=e.listBox=new mini.ListBox;this._columnControls.push(o),o.set({showCheckBox:e.filterMultiple,multiSelect:e.filterMultiple,data:t}),u(o._borderEl).css({borderWidth:0});var l=e.popup=new mini.Popup;this._columnControls.push(l),l.addCls("mini-datagrid-headerfilter-popup"),e.filterMultiple&&l.set({minWidth:160});var r=new mini.Panel;this._columnControls.push(r);t=Math.max(20*s,i.pxWidth);return e.filterMultiple&&t<160&&(t=160),r.set({maxWidth:400,width:t,showToolbar:!1,showFooter:e.filterMultiple,showHeader:!1,maxHeight:window.innerHeight-120}),l.on("Open",function(){var t=e.__filterChecked.join(",");o.setValue(t)}),l.on("close",function(){n.clearFilterState(i,"show")}),e.popup.render(document.body),r.render(e.popup.el),o.render(r._bodyEl),e.filterMultiple?(s=new mini.Button,t=new mini.Button,this._columnControls.push(s,t),s.set({text:"搜索",disableMultiClick:!1,onclick:function(){n.doFilter(o.getValue(),i),l.hide()}}),s.addCls("mini-btn-primary"),t.set({text:"重置",disableMultiClick:!1,onclick:function(){o.setValue(""),n.clearFilter(i),l.hide()}}),s.render(r._footerEl),t.render(r._footerEl),u(r._footerEl).css("text-align","center")):o.on("itemclick",function(t){"__reset"===t.item.id?n.clearFilter(i):n.doFilter(o.getValue(),i),l.hide()}),e.popup},__buildFilterParams:function(){var t,e,i={},n={sender:this,grid:this.grid,condition:i};for(t in this.filterColumnCfgMap)!Object.prototype.hasOwnProperty.call(this.filterColumnCfgMap,t)||(e=this.filterColumnCfgMap[t]).__filterChecked&&e.__filterChecked.length&&(i[t]=e.__filterChecked.join(","));return n},doFilter:function(t,e){var i=this.filterColumnCfgMap[e.name];i.__filterChecked=u.isArray(t)?t:t.split(",");e=this.grid.getHeaderCellEl(e),e=u(e).find(".mini-datagrid-headerfilter-trigger");i.__filterChecked.length?e.addClass("active"):e.removeClass("active"),this.__doFilter();e=this.__buildFilterParams();return this.onFilter(e),this.fire("filter",e),this},__doFilter:function(){if("client"!==this.options.filterMode)return this;var t=this.filterColumns,a=this;this.grid.filter(function(r){return t.every(function(t){if(!t.visible)return!0;var e=a.filterColumnCfgMap[t.name],i=e.filterMethod,n=e.__filterChecked;if(!n||!n.length)return!0;for(var s=!1,o=0,l=n.length;o<l&&!(s=i.apply(a,[n[o],r,t,a.grid,a]));o++);return s})})},clearFilter:function(t){this.clearFilterState(t);var i=this;if(t)return this.doFilter([],t),this;u.each(this.filterColumns,function(t,e){i.filterColumnCfgMap[e.name].__filterChecked=[]}),this.grid.clearFilter();t=this.__buildFilterParams();return this.onFilter(t),this.fire("filter",t),this},clearFilterState:function(t,e){var t=t?u.isArray(t)?t:[t]:this.filterColumns,i=this;return u.map(t,function(t){i.__clearFilterState(t,e)}),this},__clearFilterState:function(t,e){var i=this.filterColumnCfgMap[t.name];i.popup&&i.popup.isPopup&&i.popup.hide();t=this.grid.getHeaderCellEl(t);return u(t).find(".mini-datagrid-headerfilter-trigger").removeClass(e||"show active"),this}}),mini.DataGrid.HeaderFilter=i,function(t,r){function i(t){var e=r.extend({},i.defaultOptions,t),t=(this.options=e).grid;if(!(t=t+""===t?mini.get(t):t))throw new Error("必须配置表格！");this.grid=t;e=e.autoCreate?this.__autoCreateBtn():r(e.trigger)[0];if(!e)throw new Error("无法获取触发按钮");this.triggerEl=e,this._saveKey="GRID_COLUMN_VISIBLE-"+this.grid._id+"-"+location.pathname,this._id=this.__genderId(),this.__createControls=[],this._originColumns=[],this._allColumns=[],this.checkedIndexArr=[],this.data=[],this.init()}var e;i.defaultOptions={trigger:"",grid:"",autoCreate:!0,showButton:!0,disabledColumns:[{type:"indexcolumn"},{type:"checkcolumn"},{type:"checkcolumn"}]},r.extend(i.prototype,{__genderId:(e=0,function(){return"GridColumnsHide-"+e++}),popupCls:"mini-button-popup",__autoCreateBtn:function(){var t=r(".fui-toolbar").eq(0);if(!t.length)return!1;var e=new mini.Button;e.set({iconCls:"icon-gear",disableMultiClick:!1}),e.addCls("r"),e.render(t[0]);var i=r(e.el),n=t.find("> .r");return n.length?i.insertBefore(n):i.appendTo(t),e.el},init:function(){this._allColumns=this.grid.getColumns(),this.__rememberOrigin(),this.restoreLocal(undefined,!0),this.__syncCheckColumns();var t=this,e=r(this.triggerEl);e.on("click."+this._id,function(){e.hasClass(t.popupCls)?t.hidePanel():(e.addClass(t.popupCls),t.showPanel())})},destroy:function(){r(this.triggerEl).off("click."+this._id),r.each(this.__createControls,function(t,e){e.destroy&&e.destroy(!0)})},__rememberOrigin:function(){var i=[];r.each(this.grid.getColumns(),function(t,e){i.push({visible:e.visible})}),this._originColumns=i},__restoreOrigin:function(){var i=this.grid,t=this._originColumns;r.each(t,function(t,e){i.updateColumn(t,e)}),this.setData([]),this.__syncCheckColumns()},__syncCheckColumns:function(){var i=[];r.each(this._allColumns,function(t,e){e.visible&&i.push(t)}),this.checkedIndexArr=i},getLocalData:function(){var t=localStorage.getItem(this._saveKey);if(!t)return[];t=JSON.parse(t);return r.isArray(t)?t:[]},getData:function(){if(!this._listBox)return[];var i=this.checkedIndexArr,n=[];return r.each(this._allColumns,function(t,e){t={visible:-1!==r.inArray(t,i)};e.field&&(t.field=e.field),e.type&&(t.type=e.type),n.push(t)}),n},setData:function(t,e){var i;this.data=r.isArray(t)?t:[],e&&(i=[],r.each(this.data,function(t,e){e.visible&&i.push(t)}),this.checkedIndexArr=i),localStorage.setItem(this._saveKey,JSON.stringify(t)),this.restoreLocal(t)},__checkColumnsChanged:function(t,e){if(!r.isArray(t)||!r.isArray(e)||t.length!==e.length)return!0;for(var i,n,s=!1,o=0,l=t.length;o<l;o++)if(i=t[o],n=e[o],i.field!=n.field||i.type!=n.type){s=!0;break}return s},restoreLocal:function(t,e){var i=this.grid,n=this.data=t||this.getLocalData(),t=this._allColumns;n&&n.length&&(e&&this.__checkColumnsChanged(n,t)?this.setData([]):r.map(n,function(t,e){i.updateColumn(e,{visible:t.visible})}))},__handleSave:function(){var t=r.map(this._listBox.getValue().split(","),function(t){return parseInt(t,10)});this.checkedIndexArr=t;t=this.getData();this.setData(t,!0)},getColumnListFromGrid:function(){var i=this;return r.map(this._allColumns,function(t,e){return{text:function(t){var e=t.header;if(e&&"string"==typeof e)return r.trim(e);if(t.type)return n[t.type]||"";return""}(t),id:e,enabled:i.__getColumnEnable(t,e)}})},__getColumnEnable:function(i,n){return!(i&&this.options.disabledColumns&&this.options.disabledColumns.length)||!this.options.disabledColumns.some(function(t){return function(t){var e,i=Object.prototype.hasOwnProperty,n=[];for(e in t)i.call(t,e)&&n.push([e,t[e]]);return n}(t).every(function(t){var e=t[0],t=t[1];return"index"==e?t==n:i[e]==t})})},__createPopup:function(){if(this.popup)return this.popup;var t=this,e=this.getColumnListFromGrid(),i=new mini.ListBox;(this._listBox=i).set({showCheckBox:!0,multiSelect:!0,data:e,value:this.checkedIndexArr.join(",")}),r(i._borderEl).css({borderWidth:0}),this.__createControls.push(i);var n=new mini.Popup;this.__createControls.push(n),n.set({xAlign:"right"}),n.on("close",function(){r(t.triggerEl).removeClass(t.popupCls)});var s=Math.min(6,Math.max.apply(Math,r.map(e,function(t){return t.text.length}))),o=Math.max(this.options.showButton?180:120,14*s),e=new mini.Panel;this.__createControls.push(e),e.set({showToolbar:!1,showFooter:this.options.showButton,showHeader:!1,minWidth:200,maxWidth:300,width:o}),i.render(e._bodyEl),e.render(n.el),this.options.showButton?(s=new mini.Button,o=new mini.Button,this.__createControls.push(s,o),s.set({text:"保存",disableMultiClick:!1,onclick:function(){t.__handleSave(),n.hide()}}),s.addCls("mini-btn-primary"),o.set({text:"重置",disableMultiClick:!1,onclick:function(){t.__restoreOrigin(),n.hide()}}),s.render(e._footerEl),o.render(e._footerEl)):i.on("itemclick",function(){t.__handleSave()},this),this.popup=n},showPanel:function(){this.popup||(this.__createPopup(),this.popup.popupEl=this.triggerEl),this._listBox.setValue(this.checkedIndexArr.join(",")),this.popup.showAtEl(this.triggerEl)},hidePanel:function(){this.popup&&this.popup.hide()}}),t.mini.DataGrid.ColumnsHide=i;var n={indexcolumn:"序",checkcolumn:"选择",actioncolumn:"操作"}}(window,window.jQuery),mini._Grid_Sorter.prototype.__OnGridHeaderCellClick=function(t){var e=this.owner,i=t.htmlEvent.type;"dblclick"==i&&!e.sortDblClick||"click"==i&&e.sortDblClick||/mini-grid-headerCell-inner|mini-grid-sortIcon|mini-grid-allowsort/.test(t.htmlEvent.target.className)&&e.allowSortColumn&&0==e.isEditing()&&((i=t.column).columns&&0!=i.columns.length||(t=i.sortField||i.field)&&!1!==i.allowSort&&(e.allowCancelSort&&"desc"==e.getSortOrder()?e.clearSort():(i="asc",e.getSortField()==t&&(i="asc"==e.getSortOrder()?"desc":"asc"),e.sortBy(t,i))))};var n=mini.DataGrid.prototype.beginEditRow,e=mini.DataGrid.prototype.cancelEditRow;return{allowAlternating:mini.getCtrDefaultBySysParams("gridAllowAlternating",!1),showHGridLines:mini.getCtrDefaultBySysParams("gridShowHGridLines",!0),showVGridLines:mini.getCtrDefaultBySysParams("gridShowVGridLines",!1),showSortIcon:mini.getCtrDefaultBySysParams("gridShowSortIcon",!0),allowResize:mini.getCtrDefaultBySysParams("gridAllowResize",!1),showEmptyText:mini.getCtrDefaultBySysParams("gridShowEmptyText",!0),emptyText:mini.getCtrDefaultBySysParams("gridEmptyText","暂无数据"),beginEditRow:function(t){var e=n.apply(this,arguments);return this._editingCell=[t,this.getColumn(0)],e},cancelEditRow:function(){var t=e.apply(this,arguments);return this._editingCell=null,t},getColumnData:function(t){for(var e=[],i=this.getData(),n=0,s=i.length;n<s;n++)e.push(i[n][t]);return e},_OnCellBeginEdit:function(t,e,i,n){var s=mini._getMap(e.field,t),o={sender:this,rowIndex:this.indexOf(t),row:t,record:t,column:e,field:e.field,editor:i,value:s,cancel:!1};this.fire("cellbeginedit",o),mini.isNull(e.defaultValue)||!mini.isNull(o.value)&&""!==o.value||(l=e.defaultValue,l=mini.clone({d:l}),o.value=l.d);var l,i=o.editor,s=o.value;return!o.cancel&&(!(!i&&"inline"!=e.editMode)&&(!0!==e.readOnly&&(!1===n||"inline"!=e.editMode&&(mini.isNull(s)&&(s=""),i.setValue&&i.setValue(mini.htmlUnescape(s)),i.ownerRowID=t._uid,e.displayField&&i.setText&&(t=mini._getMap(e.displayField,t),mini.isNull(e.defaultText)||!mini.isNull(t)&&""!==t||(t=(l=mini.clone({d:e.defaultText})).d),i.setText(mini.htmlUnescape(t))),this.allowCellEdit&&(this._editingControl=o.editor)),!0)))},_OnCellCommitEdit:function(t,e,i,n){var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:n||this.getCellEditor(e),value:mini.isNull(i)?"":i,text:"",cancel:!1};if(s.editor&&s.editor.getValue){try{s.editor.blur()}catch(ex){}s.value=s.editor.getValue()}s.editor&&s.editor.getText&&(s.text=s.editor.getText());n=mini._getMap(e.field,t),i=s.value;return s.oldValue=n,mini.isEquals(n,i)||(this.fire("cellcommitedit",s),0==s.cancel&&(s.value=mini.htmlEscape(s.value),s.text=mini.htmlEscape(s.text),this.allowCellEdit&&((i={})[e.field]=s.value,e.displayField&&(i[e.displayField]=s.text),this.updateRow(t,i)))),s},_initData:function(){this.data=this._dataSource.getSource(),this.pageIndex=this.getPageIndex(),this.pageSize=this.getPageSize(),this.totalCount=this.getTotalCount(),this.totalPage=this.getTotalPage(),this.sortField=this.getSortField(),this.sortOrder=this.getSortOrder(),this.url=this.getUrl(),0<this.totalPage&&this.pageIndex>this.totalPage-1&&this.setPageIndex(this.totalPage-1),this._mergedCellMaps={},this._mergedCells={},this._cellErrors=[],this._cellMapErrors={},this.isGrouping()&&(this.groupBy(this._groupField,this._groupDir),this.collapseGroupOnLoad&&this.collapseGroups())},_setEditorBox:function(t,e){var i;t.setHeight&&"textarea"==t.type&&(i=e.height-2,t.minHeight&&i<t.minHeight&&(i=t.minHeight),t.setHeight(i)),t.setWidth&&(n=e.width-12,t.minWidth&&n<t.minWidth&&(n=t.minWidth),t.setWidth(n<20?20:n));var n=e,e=n.y;mini.setXY(this._editWrap,n.x,e+1),mini.setWidth(this._editWrap,n.width-2),mini.setHeight(this._editWrap,n.height-2);e=document.body.scrollWidth;n.x>e&&mini.setX(this._editWrap,-1e3)},_OnDrawCell:function(t,e,i,n){var s=mini.DataGrid.superclass._OnDrawCell.apply(this,arguments);return!e.emptyText||null!==s.cellHtml&&s.cellHtml!==undefined&&""!==s.cellHtml&&"&nbsp;"!=s.cellHtml||(s.cellHtml=e.emptyText),s},_OnCellShowingEdit:function(t,e){if(!this._editingControl)return!1;var i,n=this.getCellBox(t,e);n&&(i=document.body.scrollWidth,n.right>i&&(n.width=i-n.left,n.width<10&&(n.width=10),n.right=n.left+n.width));t={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,cellBox:n,editor:this._editingControl};this.fire("cellshowingedit",t);t=t.editor;t&&t.setIsValid&&t.setIsValid(!0),n&&(this._getEditWrap(t),this._editWrap.style.zIndex=mini.getMaxZIndex(),this._setEditorBox(t,n),mini.on(document,"mousedown",this.__OnBodyMouseDown,this),e.autoShowPopup&&t.showPopup&&t.showPopup()),t&&(this.navEditMode&&(t.keyNavEnabled=!(!1!==e.navUpdown)),t._doInputLayout&&t._doInputLayout())},_tryUpdateScroll:function(){var t;(this._canVirtualUpdate()||this.isFrozen())&&(this._scrollPaging?this.reload(null,null,function(t){}):(new Date,t=this._rowsViewEl.scrollLeft,this._doRemoveRowContent(),this.doUpdateRows(),this.deferLayout(50),this._syncScrollOffset(t)))}}}),mini.addEpointExt("FrozenGridView",function(){return{doUpdateRows:function(){var t=this.getVisibleRows(),e=this.getFrozenColumns(),i=this.getUnFrozenColumns(),t=this.isGrouping()?(n=this._createGroupingHTML(e,1),this._createGroupingHTML(i,2)):(n=this._createRowsHTML(e,1,this.isFrozen()?t:[]),this._createRowsHTML(i,2,t));this._rowsLockContentEl.innerHTML=n,this._rowsViewContentEl.innerHTML=t,this._rowsLockContentEl.firstChild.style.width="0px";var n=this.getScrollTop(),t=this._columnsViewEl.scrollLeft;this._rowsViewEl.scrollTop===n&&this._rowsViewEl.scrollLeft===t||this._syncScrollOffset(t,n)}}}),mini.addEpointExt("ListBox",function(){function n(t){var e=t.find(".mini-listbox-checkbox");!t.hasClass(i)&&e.find('input[type="checkbox"]').length&&(s.map(e,function(t){var e=s(t).find('input[type="checkbox"]')[0];!e||(e=e.id)&&s('<label class="mini-listbox-checkbox-icon" for="'+e+'"></label>').appendTo(t)}),t.addClass(i))}var s,i,o;return s=window.jQuery,mini.isIE8||(i="check-beauty",o=mini.ListBox.prototype.doUpdate,mini.ListBox.prototype.doUpdate=function(){var t=o.apply(this,arguments),e=s(this._viewEl).find(".mini-listbox-items");if(e.find("td").each(function(t,e){e=s(e);e.hasClass(".mini-listbox-checkbox")||e.attr("title",e.text())}),!this.showCheckBox)return t;var i=s(this._headerEl).find(".mini-listbox-headerInner");return n(e),n(i),t}),{getItemText:function(t){t=mini._getMap(this.textField,t);return mini.isNull(t)?"":mini.htmlDecode(String(t))},_OnDrawCell:function(t,e,i){var n=i?mini._getMap(i.field,t):this.getItemText(t),t={sender:this,index:e,rowIndex:e,record:t,item:t,column:i,field:i?i.field:null,value:n,cellHtml:n,rowCls:null,cellCls:i&&i.cellCls||"",rowStyle:null,cellStyle:i&&i.cellStyle||""};return this.columns&&0<this.columns.length||0==e&&this.showNullItem&&(t.cellHtml=this.nullItemText),t.cellHtml=mini.htmlEncode(t.cellHtml),i&&(i.dateFormat&&(mini.isDate(t.value)?t.cellHtml=mini.formatDate(n,i.dateFormat):t.cellHtml=n),!(n=i.renderer)||(n="function"==typeof n?n:window[n])&&(t.cellHtml=n.call(i,t))),this.fire("drawcell",t),null!==t.cellHtml&&t.cellHtml!==undefined&&""!==t.cellHtml||(t.cellHtml="&nbsp;"),t}}}),mini.addEpointExt("Menu",function(){var e=mini.Menu.prototype._create;return[{_create:function(){var t=e.apply(this,arguments);return this.on("open",this._onDocumentMousewheel,this),this.on("close",this._unDocumentMousewheel,this),t}},mini.__mouseWheelHandles]}),mini.addEpointExt("Pager",function(){return{update:function(t,e,i){mini.isNumber(t)&&(this.pageIndex=parseInt(t)),mini.isNumber(e)&&(this.pageSize=parseInt(e)),mini.isNumber(i)&&(this.totalCount=parseInt(i)),this.showTotalCount&&(this.totalPage=parseInt(this.totalCount/this.pageSize)+1,(this.totalPage-1)*this.pageSize==this.totalCount&&--this.totalPage,0==this.totalCount&&(this.totalPage=0),0<=this.totalCount&&this.pageIndex>this.totalPage-1&&(this.pageIndex=this.totalPage-1),this.pageIndex<=0&&(this.pageIndex=0),this.totalPage<=0&&(this.totalPage=0)),this.firstButton.enable(),this.prevButton.enable(),this.nextButton.enable(),this.lastButton.enable(),0==this.pageIndex&&(this.firstButton.disable(),this.prevButton.disable()),this.showTotalCount&&this.pageIndex>=this.totalPage-1&&(this.nextButton.disable(),this.lastButton.disable());var n=-1<this.pageIndex?this.pageIndex+1:0;this.showTotalCount&&0==this.totalCount&&(n=0),this.numInput.value=n,this.pagesLabel.innerHTML="/ "+this.totalPage;var s=this.sizeList.clone();-1==s.indexOf(this.pageSize)&&(s.push(this.pageSize),s=s.sort(function(t,e){return t-e}),this.sizeList=s);for(var o=[],l=0,r=s.length;l<r;l++){var a=s[l],h={};h.text=a,h.id=a,o.push(h)}this.sizeCombo.setData(o),this.sizeCombo.setValue(this.pageSize),this.sizeTextEl.innerHTML=this.sizeText,this.sizeTextEl.style.display=this.sizeText?"":"none";var d=this.firstText,t=this.prevText,e=this.nextText,i=this.lastText,n=this.reloadText;0==this.showButtonText&&(d=t=e=i=n=""),this.firstButton.setText(d),this.prevButton.setText(t),this.nextButton.setText(e),this.lastButton.setText(i),this.reloadButton.setText(n),this.firstButton.setIconCls(this.showButtonIcon?"mini-pager-first":""),this.prevButton.setIconCls(this.showButtonIcon?"mini-pager-prev":""),this.nextButton.setIconCls(this.showButtonIcon?"mini-pager-next":""),this.lastButton.setIconCls(this.showButtonIcon?"mini-pager-last":""),this.reloadButton.setIconCls(this.showButtonIcon?"mini-pager-reload":""),this.reloadButton.setVisible(this.showReloadButton);n=this.reloadButton.el.previousSibling;n&&(n.style.display=this.showReloadButton?"":"none"),this._rightEl.innerHTML=String.format(this.pageInfoText,this.pageSize,this.totalCount),this.indexEl.style.display=this.showPageIndex?"":"none",this.sizeEl.style.display=this.showPageSize?"":"none",this._rightEl.style.display=this.showPageInfo&&this.showTotalCount?"":"none",this.pagesLabel.style.display=this.showTotalCount?"":"none",this.showTotalCount?(this.firstButton.setVisible(0<=this.totalCount),this.lastButton.setVisible(0<=this.totalCount),this.totalCount<0&&(this.firstButton.enable(),this.nextButton.enable(),0==this.pageIndex&&this.firstButton.disable())):(this.firstButton.setVisible(!1),this.lastButton.setVisible(!1))},_OnPageChanged:function(t,e){e={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};this.showTotalCount&&0<=this.totalCount&&e.pageIndex>this.totalPage-1&&(e.pageIndex=this.totalPage-1),e.pageIndex<0&&(e.pageIndex=0),this.fire("beforepagechanged",e),1!=e.cancel&&(this.fire("pagechanged",e),this.update(e.pageIndex,e.pageSize))},_initEvents:function(){function e(){var t;i||(i=!0,t=parseInt(this.numInput.value),isNaN(t)?(this.update(),n=1):n!=t&&(this._OnPageChanged(t-1),n=t),setTimeout(function(){i=!1},100))}mini.Pager.superclass._initEvents.call(this),this.firstButton.set({disableMultiClick:!1}).on("click",function(t){this._OnPageChanged(0)},this),this.prevButton.set({disableMultiClick:!1}).on("click",function(t){this._OnPageChanged(this.pageIndex-1)},this),this.nextButton.set({disableMultiClick:!1}).on("click",function(t){this._OnPageChanged(this.pageIndex+1)},this),this.lastButton.set({disableMultiClick:!1}).on("click",function(t){this._OnPageChanged(this.totalPage)},this),this.reloadButton.on("click",function(t){this._OnPageChanged()},this);var i=!1,n=parseInt(this.numInput.value);mini.on(this.numInput,"change",function(t){e.call(this)},this),mini.on(this.numInput,"keydown",function(t){13==t.keyCode&&(e.call(this),t.stopPropagation())},this),this.sizeCombo.on("valuechanged",this.__OnPageSelectChanged,this)}}}),mini.addEpointExt("Panel",function(){return{_doTitle:function(){var t=""==this.title?"&nbsp":this.title;this._titleEl.innerHTML=t,this._titleEl.title=mini.htmlUnescape(t),this._iconEl.style.display=this.iconCls||this.iconStyle?"inline":"none",this._iconEl.className="mini-panel-icon mini-icon mini-iconfont "+this.iconCls,mini.setStyle(this._iconEl,this.iconStyle)},hide:function(){var t=mini.Panel.superclass.hide.apply(this,arguments);return this.fire("close"),t},setMaxHeight:function(t){(t=parseInt(t,10))&&(this.maxHeight=t,jQuery(this.el).css("max-height",t))}}}),mini.addEpointExt("Popup",function(){return[{yOffset:2,_getWindowOffset:function(){return[0,2]},_create:function(){this.el=document.createElement("div");this.el.className="mini-popup",this._contentEl=this.el,this.on("open",this._onDocumentMousewheel,this),this.on("close",this._unDocumentMousewheel,this)}},mini.__mouseWheelHandles]}),mini.addEpointExt("PopupEdit",function(){return{alwaysView:!0,setText:function(t){null!==t&&t!==undefined||(t=""),t=mini.htmlDecode(t);this.text;this.text=t,this._textEl.value=t,this._doEmpty()}}}),mini.addEpointExt("ProgressBar",function(){return{_create:function(){this.el=document.createElement("div"),this.el.className="mini-progressbar";this.el.innerHTML='<div class="mini-progressbar-border"><div class="mini-progressbar-bar"><div class="mini-progressbar-bar-current"></div></div><div class="mini-progressbar-text"></div></div>',this._borderEl=this.el.firstChild,this._barEl=this._borderEl.firstChild.firstChild,this._textEl=this._borderEl.lastChild}}}),mini.addEpointExt("Spinner",function(){return{_StartSpin:function(e,i,n){this._StopSpin();var s=this;function o(t){0<e?t>s.maxValue&&s.setValue(s.minValue):t<s.minValue&&s.setValue(s.maxValue)}var t=(1e6*this.value+1e6*e)/1e6;this.setValue(t),s.allowLoopValue&&o(t);var l=n,r=new Date;this._SpinTimer=setInterval(function(){var t=(1e6*s.value+1e6*e)/1e6;s.setValue(t),s.allowLoopValue&&o(t),s._OnValueChanged(),0==--n&&50<i&&s._StartSpin(e,i-100,l+3);t=new Date;500<t-r&&s._StopSpin(),r=t},i),mini.on(document,"mouseup",this._OnDocumentMouseUp,this)},__OnMousewheel:function(t){if(!this.isReadOnly()&&0!=this.changeOnMousewheel){this.text!=this._textEl.value&&this.__OnInputTextChanged();var e=this,i=t.wheelDelta||t.originalEvent.wheelDelta;mini.isNull(i)&&(i=24*-t.originalEvent.detail);var n=this.increment;i<0&&(n=-n);var s,i=(1e6*this.value+1e6*n)/1e6;return this.setValue(i),this.allowLoopValue&&(s=i,0<n?s>e.maxValue&&e.setValue(e.minValue):s<e.minValue&&e.setValue(e.maxValue)),this._OnValueChanged(),!1}}}}),mini.addEpointExt("Tabs",function(){var i=mini.Tabs.prototype._createHeaderMenu;return{_createHeaderMenu:function(){var t=i.apply(this,arguments),e=this._headerMenuEl;return this._headerMenu&&this._headerMenu.setyOffset&&this._headerMenu.setyOffset(2),this._headerMenu&&e&&(this._headerMenu.on("open",function(){$(e).addClass("popup")}),this._headerMenu.on("close",function(){$(e).removeClass("popup")})),t}}}),mini.addEpointExt("TextBox",function(){return{setVtype:function(t){(-1<t.indexOf("int")||-1<t.indexOf("float")||-1<t.indexOf("decimalLength"))&&(this.inputStyle||this.setInputStyle("text-align: right;")),this.vtype=t},showClose:!1,_closeCls:"mini-textbox-close",setShowClose:function(t){this.showClose=t,this._closeEl||(this._closeEl=mini.after(this._valueEl,'<span class="mini-textbox-close mini-icon"></span>')),this._closeEl.style.display=this.showClose?"inline-block":"none",this._doInputLayout()},getShowClose:function(){return this.showClose},_doInputLayout:function(){var t=0;this.showClose&&(t+=mini.getWidth(this._closeEl)),0<t&&mini.setStyle(this._textEl,"width:calc(100% - "+t/100+"rem);")},__OnMouseDown:function(t){var e=this;mini.findParent(t.target,this._closeCls)&&""!==this.value&&(this._oldValue=this.value,this.setValue(""),this.setText(""),this._OnValueChanged()),e._textEl.focus(),mini.isAncestor(this._textEl,t.target)||setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e4,1e4)},1)},__OnBlur:function(t){this._focused=!1;var e=this;setTimeout(function(){0==e._focused&&e.removeCls(e._focusCls)},2),mini.isIE&&this.__OnInputTextChanged(),this.fire("blur",{htmlEvent:t}),this.validateOnLeave&&this.isEditable()&&this._tryValidate()},errorTextEl:null,getErrorTextEl:function(){return this.errorTextEl||(this.errorTextEl=mini.append(this.el,'<span class="mini-errorText"></span>')),this.errorTextEl},_RemoveErrorText:function(){var t;this.errorTextEl&&(t=this.errorTextEl,jQuery(t).remove()),this.errorTextEl=null},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["mobileErrorText","telErrorText","phoneErrorText","postCodeErrorText","orgCodeErrorText","idCardErrorText","validateErrorText","decimalLengthErroeText"]),mini._ParseBool(t,e,["showClose"]),e}}}),mini.addEpointExt("TextArea",function(){return{minHeight:62,setHeight:function(t){parseInt(t)==t&&(t+="px"),this.height=t,"textarea"==this._InputType&&this.doLayout()},doLayout:function(){var t;this.canLayout()&&(mini.TextArea.superclass.doLayout.call(this),(t=this.height)+""===t&&(-1<t.indexOf("%")&&(this.el.style.height=t,t=mini.getHeight(this.el),this.el.style.height=t+"px"),t=parseInt(t,10)||0),this.minHeight&&t<this.minHeight&&(t=this.minHeight),this.maxHeight&&t>this.maxHeight&&(t=this.maxHeight),this._textEl.style.height=(t=(t-=2)<0?0:t)+"px")}}}),mini.addEpointExt("TextBoxList",function(){return{popupYOffset:2,showPopup:function(t){var e,i,n;0!=this.isDisplay()&&(this.isShowPopup=!0,(e=this._createPopup()).el.style.zIndex=mini.getMaxZIndex(),(i=this._listbox).emptyText=this.popupEmptyText,"loading"!=t&&"error"!=t||(i.emptyText=this.popupLoadingText,this._listbox.setData([])),this._listbox.doUpdate(),t=(n=this.getBox()).x,i=n.y+n.height,this.popup.el.style.display="block",mini.setXY(e.el,-1e3,-1e3),this.popup.setWidth(n.width),this.popup.setHeight(this.popupHeight),(n=this.popup.getHeight())>this.popupMaxHeight&&this.popup.setHeight(this.popupMaxHeight),n<this.popupMinHeight&&this.popup.setHeight(this.popupMinHeight),mini.setXY(e.el,t,i+this.popupYOffset))},errorTextEl:null,getErrorTextEl:function(){return this.errorTextEl||(this.errorTextEl=mini.append(this.el,'<span class="mini-errorText"></span>')),this.errorTextEl},_RemoveErrorText:function(){var t;this.errorTextEl&&(t=this.errorTextEl,jQuery(t).remove()),this.errorTextEl=null}}}),mini.addEpointExt("ToolTip",function(){return{autoHide:!0,theme:"dark",defaultTheme:"dark",setTheme:function(t){var e,i;t&&(this.theme=t,e="mini-tooltip-theme-",i=jQuery.grep(this.el.className.split(" "),function(t){return-1!=t.indexOf(e)}).join(" "),jQuery(this.el).removeClass(i).addClass(e+t))},getTheme:function(){return this.theme},applyTheme:function(){var t;this._target&&(t=jQuery(this._target).attr("data-theme"),this.setTheme(t||this.defaultTheme))},setContent:function(t){this.$element.children(".mini-tooltip-inner").html(t||"&nbsp;"),this.applyPlacement(),this.applyTheme()},_bindTooltip:function(){var t=jQuery(this.scope||document),e=this.selector,i="tooltip-"+this.uid;this.setTheme(this.theme),t.unbind("."+i);for(var n=this.trigger.split(" "),s=n.length;s--;){var o,l=n[s];"click"==l?t.on("click."+i,e,jQuery.proxy(this._toggle,this)):"manual"!=l&&(o="hover"==l?"mouseleave":"blur",t.on(("hover"==l?"mouseenter":"focus")+"."+i,e,jQuery.proxy(this._enter,this)),this.autoHide&&t.on(o+"."+i,e,jQuery.proxy(this._leave,this)))}},_toggle:function(t){"none"==this.$element.css("display")?this._enter(t):this._leave(t)},applyPlacement:function(){var t,e,i,n,s,o,l,r,a,h,d,u;function c(t){e.removeClass("mini-tooltip-left mini-tooltip-top mini-tooltip-right mini-tooltip-bottom mini-tooltip-bottomleft mini-tooltip-topleft mini-tooltip-bottomright mini-tooltip-topright").addClass("mini-tooltip-"+t)}function m(){var t=i.top+i.height/2-d.height()/2-h.top;d.css("top",t)}this._target&&"none"!=this.$element.css("display")&&(a=this._target,t=jQuery(a).attr("data-placement")||this.placement,e=this.$element,a&&e[0]&&(e.show().css({left:"-2000px",top:"-2000px"}),i=mini.getBox(a),n=mini.getViewportBox(),s=i.top-n.top,o=n.bottom-i.bottom,l=i.left-n.left,r=n.right-i.right,c(t),a=mini.getBox(e[0]),h=mini.getCalculatedOffset(t,i,a.width,a.height),0===t.indexOf("bottom")?o<s&&h.top+a.height>n.bottom&&(t=t.replace("bottom","top")):0===t.indexOf("top")&&s<o&&h.top<n.top&&(t=t.replace("top","bottom")),-1!==t.indexOf("left")?r<l&&a.width+h.left>n.width&&(t=t.replace("left","right")):-1!==t.indexOf("right")&&l<r&&(h.left<0||i.left+i.width<a.wihth)&&(t=t.replace("right","left")),"bottom"!==t&&"top"!==t||(r<l&&a.width+h.left>n.width?t+="right":l<r&&(h.left<0||i.left+i.width<a.wihth)&&(t+="left")),c(t),h=mini.getCalculatedOffset(t,i,a.width,a.height),"right"!=t&&"left"!=t||((d=$(e).children(".mini-tooltip-arrow")).css("top",""),n=mini.getViewportBox(),h.top<n.y?(h.top=n.y,m()):h.top+a.height>n.bottom&&(h.top=n.bottom-a.height,m())),u=h,e.offset(u)))},setAutoHide:function(t){this.autoHide!=t&&(this.autoHide=t,this._bindTooltip())},getAutoHide:function(){return this.autoHide},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["theme"]),mini._ParseBool(t,e,["autoHide"]),e}}}),mini.addEpointExt("TreeGrid",function(){var i,t;return i=jQuery,t=mini.TreeGrid.prototype._initEvents,{showHGridLines:!0,showVGridLines:!(mini.TreeGrid.prototype._initEvents=function(){t.call(this);var e=this;this.on("layout",function(){var t;e.allowAlternating?((t=i(e._contentEl).find(".mini-grid-rows-content > .mini-grid-table > tbody")).find("> .mini-grid-row").each(function(t,e){t%2==1&&i(e).addClass("mini-grid-row-alt")}),t.find("> .mini-tree-nodes-tr").each(function(t,e){i(e).prev().addClass("mini-treegrid-expandRow")})):i(e.el).find(".mini-grid-row-alt").removeClass("mini-grid-row-alt")})}),showSortIcon:!0,_setEditorBox:function(t,e){mini.DataGrid.prototype._setEditorBox.call(this,t,e)}}}),mini.addEpointExt("DataTree",function(){return{loadNode:function(o,l){var e,r,t={node:this._loadingNode=o,cancel:!1};this.fire("beforeloadnode",t),!0!==t.cancel&&(e=new Date,(r=this)._doLoadAjax(r.loadParams,null,null,null,function(s){var t=new Date-e;setTimeout(function(){s.node=o,r._OnPreLoad(s),r._loadingNode=null,r.loadParams&&delete r.loadParams[r.idField];var t=o[r.nodesField];r.removeNodes(t);t=s.data;if(t&&0<t.length){r.collapse(o),r.addNodes(t,o);for(var e=r.getAllChildNodes(o),i=0,n=e.length;i<n;i++)delete e[i]._state;!1!==l?r.expand(o,!0):r.collapse(o,!0)}else delete o[r.leafField],r.expand(o,!0);r.fire("loadnode",s),r.fire("load",s)},10)},!0))}}}),mini.addEpointExt("Tree",function(){var s,o;return window,s=window.jQuery,mini.isIE8||mini.isIE9||(o=mini.TreeGrid.prototype._createTreeColumn,mini.Tree.prototype._createTreeColumn=mini.TreeGrid.prototype._createTreeColumn=function(t){var e,i=o.apply(this,arguments),n=s(t.cellHtml);return n.hasClass("mini-tree-parentNode")&&(n.find(">.mini-tree-node-ecicon").append('<svg class="mini-tree-loading-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="128" height="128" fill="currentColor" ><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg>'),t.cellHtml=n[0].outerHTML),!0===this.showCellTip&&((e=n.find(".mini-tree-nodetext")).attr("title",jQuery.trim(e.text())),t.cellHtml=n[0].outerHTML),i},mini.Tree.prototype.__OnBeforeLoadNode=mini.TreeGrid.prototype.__OnBeforeLoadNode=function(t){this.__showLoading=this.showLoading,this.showLoading=!1,clearTimeout(this.__loadingTimer);var e=this;this.__loadingTimer=setTimeout(function(){e.addNodeCls(t.node,"mini-tree-loading")},100),this.fire("beforeloadnode",t)},mini.Tree.prototype.__OnLoadNode=mini.TreeGrid.prototype.__OnLoadNode=function(t){clearTimeout(this.__loadingTimer),this.showLoading=this.__showLoading,this.removeNodeCls(t.node,"mini-tree-loading"),this.fire("loadnode",t)}),{showTreeLines:!1,showFullPath:!1,includeRootNode:!1,allowAlternating:!1,replaceNodes:function(t,e){var i=e[this.nodesField];this.removeNodes(i),this.addNodes(t,e)},_OnDrawCell:function(t,e,i,n){n=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);return this._treeColumn&&this._treeColumn==e.name&&(!1===(e=n.node).ckr&&(n.showCheckBox=!1,n.showRadioButton=!1),this.fire("drawnode",n),n.nodeStyle&&(n.cellStyle=n.nodeStyle),n.nodeCls&&(n.cellCls=n.nodeCls),n.nodeHtml?n.cellHtml=n.nodeHtml:e.textCls&&(n.cellHtml='<span class="'+e.textCls+'">'+n.cellHtml+"</span>"),this._createTreeColumn(n)),n},getValueAndText:function(t,e){mini.isNull(t)&&(t=[]),e=e||this.delimiter,"string"==typeof t||"number"==typeof t?t=this._dataSource.getsByIds(t):mini.isArray(t)||(t=[t]);for(var i=[],n=[],s=0,o=t.length;s<o;s++){var l=t[s];l&&(i.push(this.getItemValue(l)),n.push(this.getItemText(l)))}return[i.join(e),n.join(e)]},getItemValue:function(t){if(!t)return"";t=mini._getMap(this.idField,t);return mini.isNull(t)?"":String(t)},getItemText:function(t){if(!t)return"";var e="",e=this.showFullPath?this.getFullPath(t):mini._getMap(this.textField,t);return mini.isNull(e)?"":String(e).replace(/<\/?.+?>/g,"")},getFullPath:function(t){if(t.fullPath)return t.fullPath;for(var e=this.getAncestors(t),i="",n=0,s=e.length;n<s;n++)0==n&&!this.includeRootNode||(i+=mini._getMap(this.textField,e[n])+"-");return t.fullPath=i+=mini._getMap(this.textField,t),i},getText:function(){var t=[];this.showCheckBox?t=this.getCheckedNodes():(o=this.getSelectedNode())&&t.push(o);for(var e=[],i=this.getTextField(),n=0,s=t.length;n<s;n++){var o=t[n];e.push(o[i].replace(/<\/?.+?>/g,""))}return e.join(",")}}}),mini.addEpointExt("Window",function(){var t={showRefreshButton:!1,maskOnLoad:!1,lockScroll:!0,_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);t=this.createButton({name:"min",cls:"mini-tools-min",visible:this.showMinButton});this.buttons.push(t);t=this.createButton({name:"max",cls:"mini-tools-max",visible:this.showMaxButton});this.buttons.push(t);t=this.createButton({name:"refresh",cls:"mini-tools-refresh",visible:this.showRefreshButton});this.buttons.push(t);t=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(t)},_OnButtonClick:function(t,e){e=mini.Window.superclass._OnButtonClick.call(this,t,e);return 1==e.cancel||("max"==e.name?"max"==this.state?this.restore():this.max():"refresh"==e.name&&this.refresh()),e},hide:function(){this.fire("close"),this.setVisible(!1),this._doModal()},refresh:function(){return this.reload(),this},restore:function(){this.state="restore",this.show(this.x,this.y);var t=this.getButton("max");t&&(t.cls="mini-tools-max",this._doTools()),this.fire("restore")},setShowRefreshButton:function(t){this.showRefreshButton=t;var e=this.getButton("refresh");e&&(e.visible=t,this._doTools())},getShowRefreshButton:function(){return this.showRefreshButton},doLayout:function(){var t;this.canLayout()&&("max"==this.state&&(t=this.getParentBox(),this.el.style.left="10px",this.el.style.top="10px",mini.setSize(this.el,t.width-20,t.height-20)),mini.Window.superclass.doLayout.call(this),this.allowDrag&&mini.addClass(this.el,this._dragCls),"max"==this.state&&(this._resizeGridEl.style.display="none",mini.removeClass(this.el,this._dragCls)),this._doModal())},_doShow:function(t,e){var i,n=this.getParentBox();"max"==this.state?(this._width||(i=this.getBox(),this._width=i.width,this.expanded&&(this._height=i.height),this.x=i.x,this.y=i.y),this.el.style.left="-10000px",this.el.style.top="-10000px"):(mini.isNull(t)&&(t="center"),mini.isNull(e)&&(e="middle"),this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this._width&&(this.setWidth(this._width),this.setHeight(this._height),delete this._width,delete this._height),this._measureSize(),i=this.getBox(),"right"==(t="center"==(t="left"==t?0:t)?n.width/2-i.width/2:t)&&(t=n.width-i.width),"bottom"==(e="middle"==(e="top"==e?0:e)?n.height/2-i.height/2:e)&&(e=n.height-i.height),(t=t+i.width>n.right?n.right-i.width:t)<0&&(t=0),(e=e+i.height>n.bottom?n.bottom-i.height:e)<0&&(e=0),this.el.style.display="",this.el.style.left=t+"px",this.el.style.top=e+"px"),this.doLayout()},getExtraAttrs:function(t){var e={};mini._ParseString(t,e,["onrestore","onclose"]),mini._ParseBool(t,e,["showRefreshButton","lockScroll"])}},e=mini.Window.prototype.setVisible;t.setVisible=function(t){this.lockScroll&&(t?$("html,body").addClass("mini-window-lock-scroll"):$("html,body").removeClass("mini-window-lock-scroll")),e.apply(this,arguments)};var i=mini.Window.prototype.destroy;return t.destroy=function(){$("html,body").removeClass("mini-window-lock-scroll"),i.apply(this,arguments)},t}),mini.Hidden=function(){mini.Hidden.superclass.constructor.apply(this,arguments)},mini.extend(mini.Hidden,mini.Control,{_clearBorder:!1,formField:!0,value:"",uiCls:"mini-hidden",_create:function(){this.el=document.createElement("input"),this.el.type="hidden",this.el.className="mini-hidden"},setName:function(t){this.name=t,this.el.name=t},setValue:function(t){var e,i,n;null!==t&&t!==undefined||(t=""),this.value=t,mini.isDate(t)?(e=t.getFullYear(),i=(i=t.getMonth()+1)<10?"0"+i:i,n=(n=t.getDate())<10?"0"+n:n,this.el.value=e+"-"+i+"-"+n):this.el.value=t},getValue:function(){return this.value},getFormValue:function(){return this.el.value}}),mini.regClass(mini.Hidden,"hidden"),mini.Popup=function(){mini.Popup.superclass.constructor.apply(this,arguments),this.setVisible(!1),this.setAllowDrag(this.allowDrag),this.setAllowResize(this.allowResize)},mini.extend(mini.Popup,mini.Container,{alwaysView:!0,_clearBorder:!1,uiCls:"mini-popup",_create:function(){this.el=document.createElement("div");this.el.className="mini-popup",this._contentEl=this.el},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this)},this)},doLayout:function(){if(this.canLayout()){mini.Popup.superclass.doLayout.call(this),this._doShadow();var t=this.el.childNodes;if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];mini.layout(n)}}},destroy:function(t){this.el&&(this.el.onmouseover=null),mini._destroying||(mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this)),!1!==t&&(this._modalEl&&jQuery(this._modalEl).remove(),this.shadowEl&&jQuery(this.shadowEl).remove(),this._shimEl&&jQuery(this._shimEl).remove()),this._modalEl=null,this.shadowEl=null,this._shimEl=null,mini.Popup.superclass.destroy.call(this,t)},setWidth:function(t){parseInt(t)==t&&(t+="px"),-1!=(this.width=t).indexOf("px")?mini.setWidth(this.el,t):this.el.style.width=t,this._sizeChanged()},setHeight:function(t){parseInt(t)==t&&(t+="px"),-1!=(this.height=t).indexOf("px")?mini.setHeight(this.el,t):this.el.style.height=t,this._sizeChanged()},setBody:function(t){if(t)for(var e=0,i=(t=!mini.isArray(t)?[t]:t).length;e<i;e++)mini.append(this._contentEl,t[e])},getAttrs:function(t){var e=mini.Popup.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["popupEl","popupCls","showAction","hideAction","xAlign","yAlign","modalStyle","onbeforeopen","open","onbeforeclose","onclose"]),mini._ParseBool(t,e,["showModal","showShadow","allowDrag","allowResize"]),mini._ParseInt(t,e,["showDelay","hideDelay","xOffset","yOffset","minWidth","minHeight","maxWidth","maxHeight"]);t=mini.getChildNodes(t,!0);return e.body=t,e}}),mini.regClass(mini.Popup,"popup"),mini.Popup_prototype={isPopup:!1,popupEl:null,popupCls:"",showAction:"mouseover",hideAction:"outerclick",showDelay:300,hideDelay:500,xAlign:"left",yAlign:"below",xOffset:0,yOffset:0,minWidth:50,minHeight:25,maxWidth:2e3,maxHeight:2e3,showModal:!1,showShadow:!0,modalStyle:"opacity:0.2",_dragCls:"mini-popup-drag",_resizeCls:"mini-popup-resize",allowDrag:!1,allowResize:!1,_unbindPopupEl:function(){this.popupEl&&(mini.un(this.popupEl,"click",this.__OnLeftClick,this),mini.un(this.popupEl,"contextmenu",this.__OnRightClick,this),mini.un(this.popupEl,"mouseover",this.__OnMouseOver,this))},_bindPopupEl:function(){this.popupEl&&(mini.on(this.popupEl,"click",this.__OnLeftClick,this),mini.on(this.popupEl,"contextmenu",this.__OnRightClick,this),mini.on(this.popupEl,"mouseover",this.__OnMouseOver,this))},doShow:function(t){var e={popupEl:this.popupEl,htmlEvent:t,cancel:!1};this.fire("BeforeOpen",e),1!=e.cancel&&(this.fire("opening",e),1!=e.cancel&&(this.popupEl?(e={},t&&(e.xy=[t.pageX,t.pageY]),this.showAtEl(this.popupEl,e)):this.show()))},doHide:function(t){t={popupEl:this.popupEl,htmlEvent:t,cancel:!1};this.fire("BeforeClose",t),1!=t.cancel&&this.close()},show:function(t,e){this.showAtPos(t,e)},showAtPos:function(t,e){this.render(document.body),t||0===t||(t="center"),e||0===e||(e="middle"),this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this._measureSize();var i=mini.getViewportBox(),n=mini.getBox(this.el);"right"==(t="center"==(t="left"==t?0:t)?i.width/2-n.width/2:t)&&(t=i.width-n.width),"bottom"==(e="middle"==(e="top"==e?0:e)?i.y+i.height/2-n.height/2:e)&&(e=i.height-n.height),t+n.width>i.right&&(t=i.right-n.width),e+n.height>i.bottom&&(e=i.bottom-n.height-2),this._Show(t,e)},_doModal:function(){var t,e,i,n;jQuery(this._modalEl).remove(),this.showModal&&0!=this.visible&&(i=document.documentElement,t=parseInt(Math.max(document.body.scrollWidth,i?i.scrollWidth:0)),e=parseInt(Math.max(document.body.scrollHeight,i?i.scrollHeight:0)),(i=(n=mini.getViewportBox()).height)<e&&(i=e),(n=n.width)<t&&(n=t),this._modalEl=mini.append(document.body,'<div class="mini-modal"></div>'),this._modalEl.style.height=i+"px",this._modalEl.style.width=n+"px",this._modalEl.style.zIndex=mini.getStyle(this.el,"zIndex")-1,mini.setStyle(this._modalEl,this.modalStyle))},_doShim:function(){var t;mini_useShims&&(this._shimEl||(this._shimEl=mini.append(document.body,"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 0; height: 0; top: 0;left:0;scrolling:no;'></iframe>")),this._shimEl.style.display="none",this._doShimTimer&&(clearTimeout(this._doShimTimer),this._doShimTimer=null),(t=this)._doShimTimer=setTimeout(function(){t._doShimTimer=null,function(){this._shimEl.style.display="";var t=mini.getBox(this.el),e=this._shimEl.style;e.width=t.width+"px",e.height=t.height+"px",e.left=t.x+"px",e.top=t.y+"px",t=mini.getStyle(this.el,"zIndex"),isNaN(t)||(this._shimEl.style.zIndex=t-3)}.call(t)},20))},_doShadow:function(){this.shadowEl||(this.shadowEl=mini.append(document.body,'<div class="mini-shadow"></div>')),this.shadowEl.style.display=this.showShadow?"":"none",this.shadowEl.style.display="none"},_measureSize:function(){this.el.style.display="";var t=mini.getBox(this.el);t.width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),t=mini.getBox(this.el)),t.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),t=mini.getBox(this.el)),t.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),t=mini.getBox(this.el)),t.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),t=mini.getBox(this.el))},_getWindowOffset:function(t){return[0,0]},showAtEl:function(t,e){if(t=mini.byId(t)){this.isRender()&&this.el.parentNode==document.body||this.render(document.body);var i={atEl:t,popupEl:this.el,xAlign:this.xAlign,yAlign:this.yAlign,xOffset:this.xOffset,yOffset:this.yOffset,popupCls:this.popupCls,alwaysView:this.alwaysView};mini.copyTo(i,e),mini.addClass(t,i.popupCls),t.popupCls=i.popupCls,this._popupEl=t,this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this.doLayout(),this._measureSize();var n=mini.getViewportBox(),s=mini.getBox(this.el),o=mini.getBox(t),t=i.xy,l=n.width/2-s.width/2,r=0;switch(t&&(l=t[0],r=t[1]),i.xAlign){case"outleft":l=o.x-s.width;break;case"left":l=o.x;break;case"center":l=o.x+o.width/2-s.width/2;break;case"right":l=o.right-s.width;break;case"outright":l=o.right}switch(i.yAlign){case"above":r=o.y-s.height;break;case"top":r=o.y;break;case"middle":r=o.y+o.height/2-s.height/2;break;case"bottom":r=o.bottom-s.height;break;case"below":r=o.bottom}var a,l=parseInt(l),r=parseInt(r),e=this._getWindowOffset(e);i.outYAlign||i.outXAlign?("above"==i.outYAlign&&r+s.height>n.bottom&&(a=o.y-n.y,n.bottom-o.bottom<a&&(r=o.y-s.height)),"below"==i.outYAlign&&r+s.height>n.bottom&&(a=o.y-n.y,n.bottom-o.bottom<a&&(r=o.y-s.height)),"outleft"==i.outXAlign&&l+s.width>n.right&&(a=o.x-n.x,n.right-o.right<a&&(l=o.x-s.width)),"right"==i.outXAlign&&l+s.width>n.right&&(l=o.right-s.width),i.alwaysView&&((r=r<0?0:r)+s.height>n.bottom&&(r=n.bottom-s.height),(l=l<0?0:l)+s.width>n.right&&(l=n.right-s.width)),this._Show(l+e[0],r+e[1])):this.showAtPos(l+i.xOffset+e[0],r+i.yOffset+e[1])}},_Show:function(t,e){this.el.style.display="",this.el.style.zIndex=mini.getMaxZIndex(),mini.setX(this.el,t),mini.setY(this.el,e),this.setVisible(!0),"mouseout"==this.hideAction&&mini.on(document,"mousemove",this.__OnBodyMouseMove,this);this._doShadow(),this._doModal(),this._doShim(),mini.layoutIFrames(this.el),this.isPopup=!0,mini.on(document,"mousedown",this.__OnBodyMouseDown,this),mini.on(window,"resize",this.__OnWindowResize,this),this.fire("Open")},open:function(){this.show()},close:function(){this.hide()},hide:function(){this.el&&(this.popupEl&&mini.removeClass(this.popupEl,this.popupEl.popupCls),this._popupEl&&mini.removeClass(this._popupEl,this._popupEl.popupCls),this._popupEl=null,jQuery(this._modalEl).remove(),this.shadowEl&&(this.shadowEl.style.display="none"),this._shimEl&&(this._shimEl.style.display="none"),mini.un(document,"mousemove",this.__OnBodyMouseMove,this),mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this),this.setVisible(!1),this.isPopup=!1,this.fire("Close"))},setPopupEl:function(t){(t=mini.byId(t))&&(this._unbindPopupEl(),this.popupEl=t,this._bindPopupEl())},setPopupCls:function(t){this.popupCls=t},setShowAction:function(t){this.showAction=t},setHideAction:function(t){this.hideAction=t},setShowDelay:function(t){this.showDelay=t},setHideDelay:function(t){this.hideDelay=t},setXAlign:function(t){this.xAlign=t},setYAlign:function(t){this.yAlign=t},setxOffset:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.xOffset=t},setyOffset:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.yOffset=t},setShowModal:function(t){this.showModal=t},setShowShadow:function(t){this.showShadow=t},setMinWidth:function(t){isNaN(t)||(this.minWidth=t)},setMinHeight:function(t){isNaN(t)||(this.minHeight=t)},setMaxWidth:function(t){isNaN(t)||(this.maxWidth=t)},setMaxHeight:function(t){isNaN(t)||(this.maxHeight=t)},setAllowDrag:function(t){this.allowDrag=t,mini.removeClass(this.el,this._dragCls),t&&mini.addClass(this.el,this._dragCls)},setAllowResize:function(t){this.allowResize=t,mini.removeClass(this.el,this._resizeCls),t&&mini.addClass(this.el,this._resizeCls)},__OnLeftClick:function(t){var e;this._inAniming||"leftclick"==this.showAction&&(e=jQuery(this.popupEl).attr("allowPopup"),"false"!=String(e)&&this.doShow(t))},__OnRightClick:function(t){var e;this._inAniming||"rightclick"==this.showAction&&(e=jQuery(this.popupEl).attr("allowPopup"),"false"!=String(e)&&(t.preventDefault(),this.doShow(t)))},__OnMouseOver:function(t){var e,i;this._inAniming||"mouseover"==this.showAction&&(e=jQuery(this.popupEl).attr("allowPopup"),"false"!=String(e)&&(clearTimeout(this._hideTimer),this._hideTimer=null,this.isPopup||((i=this)._showTimer=setTimeout(function(){i.doShow(t)},this.showDelay))))},__OnBodyMouseMove:function(t){"mouseout"==this.hideAction&&this._tryHide(t)},__OnBodyMouseDown:function(t){"outerclick"==this.hideAction&&this.isPopup&&(jQuery(t.target).closest(".mini-popup")[0]||this.within(t)||this.popupEl&&mini.isAncestor(this.popupEl,t.target)||this.doHide(t))},_tryHide:function(t){var e;mini.isAncestor(this.el,t.target)||this.popupEl&&mini.isAncestor(this.popupEl,t.target)||(clearTimeout(this._showTimer),this._showTimer=null,this._hideTimer||((e=this)._hideTimer=setTimeout(function(){e.doHide(t)},this.hideDelay)))},__OnWindowResize:function(t){this.isDisplay()&&!mini.isIE6&&this._doModal()},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++)if(e[i].within(t))return!0;return!1}},mini.copyTo(mini.Popup.prototype,mini.Popup_prototype),function(){function t(t,e){e==document||jQuery(document).trigger("mousedown")}function e(t){var e=i.jQuery;e&&e(i.document).trigger("topmousedown",[document])}var i;!hasOn||(i=mini.getTopWindow())&&(jQuery(i.document).on("topmousedown",t),jQuery(document).on("mousedown",e),jQuery(window).on("unload",function(){jQuery(i.document).off("topmousedown",t),jQuery(document).off("mousedown",e)}))}(),mini.Button=function(){mini.Button.superclass.constructor.apply(this,arguments)},mini.extend(mini.Button,mini.Control,{text:"",iconCls:"",iconStyle:"",plain:!1,checkOnClick:!1,checked:!1,groupName:"",img:"",_plainCls:"mini-button-plain",_hoverCls:"mini-button-hover",_pressedCls:"mini-button-pressed",_checkedCls:"mini-button-checked",_disabledCls:"mini-button-disabled",allowCls:"",_clearBorder:!1,set:function(t){return"string"==typeof t||(this._allowUpdate=t.text||t.iconStyle||t.iconCls||t.iconPosition,mini.Button.superclass.set.call(this,t),!1===this._allowUpdate&&(this._allowUpdate=!0,this.doUpdate())),this},uiCls:"mini-button",_create:function(){this.el=document.createElement("a"),this.el.className="mini-button mini-state-default mini-corner-all",this.el.hideFocus=!0,this.el.href="javascript:void(0)",this.doUpdate()},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"click",this.__OnClick,this)},this)},destroy:function(t){this.el&&(this.el.onclick=null,this.el.onmousedown=null),this.menu&&(this.menu.owner=null),this.menu=null,mini.Button.superclass.destroy.call(this,t)},doUpdate:function(){var t,e,i,n,s;!1!==this._allowUpdate&&(t="",s=this.text,(e=this.iconStyle||this.iconCls||this.img)&&s?t=" mini-button-icon-text ":e&&""===s?(t=" mini-button-icon-only ",s="&nbsp;"):""==s&&(s="&nbsp;"),!(i=this.iconStyle||"")&&this.img&&(i="background-image:url("+this.img+")"),n="",s='<span class="mini-button-inner '+t+'">'+(n=e?'<span class="mini-button-icon mini-icon mini-iconfont '+this.iconCls+'" style="'+i+'"></span>':n)+(s='<span class="mini-button-text">'+s+"</span>")+"</span>",this.allowCls&&(s=s+'<span class="mini-button-allow mini-icon '+this.allowCls+'"></span>'),this.el.innerHTML=s)},href:"",setHref:function(t){this.href=t,this.el.href=t;var e=this.el;setTimeout(function(){e.onclick=null},100)},getHref:function(){return this.href},target:"",setTarget:function(t){this.target=t,this.el.target=t},getTarget:function(){return this.target},setText:function(t){this.text!=t&&(this.text=t,this.doUpdate())},getText:function(){return this.text},setIconCls:function(t){this.iconCls=t,this.doUpdate()},getIconCls:function(){return this.iconCls},setIconStyle:function(t){this.iconStyle=t,this.doUpdate()},getIconStyle:function(){return this.iconStyle},setImg:function(t){this.img=t,this.doUpdate()},getImg:function(){return this.img},setIconPosition:function(t){this.iconPosition="left",this.doUpdate()},getIconPosition:function(){return this.iconPosition},setPlain:function(t){(this.plain=t)?this.addCls(this._plainCls):this.removeCls(this._plainCls)},getPlain:function(){return this.plain},setGroupName:function(t){this.groupName=t},getGroupName:function(){return this.groupName},setCheckOnClick:function(t){this.checkOnClick=t},getCheckOnClick:function(){return this.checkOnClick},setChecked:function(t){var e=this.checked!=t;(this.checked=t)?this.addCls(this._checkedCls):this.removeCls(this._checkedCls),e&&this.fire("CheckedChanged")},getChecked:function(){return this.checked},doClick:function(){this.__OnClick(null)},__OnClick:function(t){if(!this.href&&t&&t.preventDefault(),!this.readOnly&&0!=this.enabled){if(this.focus(),this.checkOnClick)if(this.groupName){var e=this.groupName,i=mini.findControls(function(t){if("button"==t.type&&t.groupName==e)return!0});if(0<i.length){for(var n=0,s=i.length;n<s;n++){var o=i[n];o!=this&&o.setChecked(!1)}this.setChecked(!0)}else this.setChecked(!this.checked)}else this.setChecked(!this.checked);this.fire("click",{htmlEvent:t})}},__OnMouseDown:function(t){this.isReadOnly()||(this.addCls(this._pressedCls),mini.on(document,"mouseup",this.__OnDocMouseUp,this))},__OnDocMouseUp:function(t){this.removeCls(this._pressedCls),mini.un(document,"mouseup",this.__OnDocMouseUp,this)},onClick:function(t,e){this.on("click",t,e)},getAttrs:function(t){var e=mini.Button.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["text","href","iconCls","iconStyle","iconPosition","groupName","menu","onclick","oncheckedchanged","target","img"]),mini._ParseBool(t,e,["plain","checkOnClick","checked"]),e}}),mini.regClass(mini.Button,"button"),mini.MenuButton=function(){mini.MenuButton.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuButton,mini.Button,{uiCls:"mini-menubutton",allowCls:"mini-button-menu",setMenu:function(t){if("string"==typeof(t=mini.isArray(t)?{type:"menu",items:t}:t)){if(!mini.byId(t))return;mini.parse(t),t=mini.get(t)}var e;this.menu!==t&&(this.menu=mini.getAndCreate(t),this.menu.setPopupEl(this.el),this.menu.setPopupCls("mini-button-popup"),this.menu.setShowAction("leftclick"),this.menu.setHideAction("outerclick"),this.menu.setXAlign("left"),this.menu.setYAlign("below"),this.menu.hide(),(this.menu.owner=this).menu.addCls("mini-menu-open"),(e=this).menu.on("BeforeOpen",function(t){e.split&&!jQuery(t.htmlEvent.target).closest(".mini-button-split")[0]&&(t.cancel=!0)}))},setEnabled:function(t){(this.enabled=t)?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),jQuery(this.el).attr("allowPopup",!!t)}}),mini.regClass(mini.MenuButton,"menubutton"),mini.SplitButton=function(){mini.SplitButton.superclass.constructor.apply(this,arguments)},mini.extend(mini.SplitButton,mini.MenuButton,{split:!0,uiCls:"mini-splitbutton",allowCls:"mini-button-split",__OnClick:function(t){this.split&&jQuery(t.target).closest(".mini-button-split")[0]||mini.SplitButton.superclass.__OnClick.call(this,t)}}),mini.regClass(mini.SplitButton,"splitbutton"),mini.CheckBox=function(){mini.CheckBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.CheckBox,mini.Control,{formField:!0,_clearText:!1,text:"",checked:!1,defaultValue:!1,trueValue:!0,falseValue:!1,checkedCls:"mini-checkbox-checked",set:function(t){if("string"==typeof t)return this;return mini.isNull(t.trueValue)||(this.setTrueValue(t.trueValue),delete t.trueValue),mini.isNull(t.falseValue)||(this.setFalseValue(t.falseValue),delete t.falseValue),mini.CheckBox.superclass.set.call(this,t),this},uiCls:"mini-checkbox",_create:function(){var t=this.uid+"$check";this.el=document.createElement("span"),this.el.className="mini-checkbox",this.el.innerHTML='<input id="'+t+'" name="'+this.id+'" type="checkbox" class="mini-checkbox-check"><span class="mini-checkbox-icon mini-icon" tabIndex="0"></span><label for="'+t+'" onclick="return false;">'+this.text+"</label>",this._checkEl=this.el.firstChild,this._labelEl=this.el.lastChild},destroy:function(t){this._checkEl&&(this._checkEl.onmouseup=null,this._checkEl.onclick=null,this._checkEl=null),mini.CheckBox.superclass.destroy.call(this,t)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"click",this.__onClick,this);mini.on(this.el,"keyup",function(t){32==t.keyCode&&jQuery(t.target).click()}),this._checkEl.onmouseup=function(){return!1};var t=this;this._checkEl.onclick=function(){if(t.isReadOnly())return!1},this._checkEl.checked=this.checked},this)},setName:function(t){this.name=t,mini.setAttr(this._checkEl,"name",this.name)},setText:function(t){this.text!==t&&(this.text=t,this._labelEl.innerHTML=t)},getText:function(){return this.text},setChecked:function(t){t=!0===t||(String(t)==String(this.trueValue)||("true"==t||("True"==t||("1"===String(t)||"Y"==t)))),this.checked!==t&&(this.checked=!!t,this._checkEl.checked=this.checked,this.value=this.getValue());t=jQuery(this.el);this.checked?t.addClass(this.checkedCls):t.removeClass(this.checkedCls)},getChecked:function(){return this.checked},setValue:function(t){this.checked!==t&&(this.setChecked(t),this.value=this.getValue())},getValue:function(){return String(1==this.checked?this.trueValue:this.falseValue)},getFormValue:function(){return this.getValue()},setTrueValue:function(t){this._checkEl.value=t,this.trueValue=t},getTrueValue:function(){return this.trueValue},setFalseValue:function(t){this.falseValue=t},getFalseValue:function(){return this.falseValue},__onClick:function(t){this.isReadOnly()||(this.setChecked(!this.checked),this.fire("checkedchanged",{checked:this.checked}),this.fire("valuechanged",{value:this.getValue()}),this.fire("click",t,this))},getAttrs:function(t){var e=mini.CheckBox.superclass.getAttrs.call(this,t),i=jQuery(t);e.text=t.innerHTML,mini._ParseString(t,e,["text","oncheckedchanged","onclick","onvaluechanged"]),mini._ParseBool(t,e,["enabled"]);t=mini.getAttr(t,"checked");t&&(e.checked="true"==t||"checked"==t);t=i.attr("trueValue");t&&(e.trueValue=t,t=parseInt(t),isNaN(t)||(e.trueValue=t));i=i.attr("falseValue");return i&&(e.falseValue=i,i=parseInt(i),isNaN(i)||(e.falseValue=i)),e}}),mini.regClass(mini.CheckBox,"checkbox"),jQuery(function(){setTimeout(function(){for(var t=mini.getComponents(),e=0,i=t.length;e<i;e++){var n,s=t[e];s instanceof mini.TextBox&&(n=s.getTextEl().value,s.value!==n&&(s.value=n))}},300)}),mini.TextBox=function(){mini.TextBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.TextBox,mini.ValidatorBase,{name:"",formField:!0,selectOnFocus:!1,allowInput:!0,minWidth:10,minHeight:15,maxLength:5e3,emptyText:"",text:"",value:"",defaultValue:"",height:21,_emptyCls:"mini-textbox-empty",_focusCls:"mini-textbox-focus",_disabledCls:"mini-textbox-disabled",uiCls:"mini-textbox",_InputType:"text",_create:function(){var t='<input  type="'+this._InputType+'" class="mini-textbox-input" autocomplete="off"/>',t='<span class="mini-textbox-border mini-corner-all">'+(t="textarea"==this._InputType?'<textarea  class="mini-textbox-input" autocomplete="off"/></textarea>':t)+"</span>";t+='<input type="hidden"/>',this.el=document.createElement("span"),this.el.className="mini-textbox",this.el.innerHTML=t,this._borderEl=this.el.firstChild,this._textEl=this._borderEl.firstChild,this._valueEl=this._borderEl.lastChild,this._doEmpty()},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this._textEl,"drop",this.__OnDropText,this),mini_onOne(this._textEl,"change",this.__OnInputTextChanged,this),mini_onOne(this._textEl,"focus",this.__OnFocus,this),mini_onOne(this.el,"mousedown",this.__OnMouseDown,this);var t=this.value;this.value=null,this.el&&this.setValue(t)},this),this.on("validation",this.__OnValidation,this)},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini.on(this._textEl,"blur",this.__OnBlur,this),mini.on(this._textEl,"keydown",this.__OnInputKeyDown,this),mini.on(this._textEl,"keyup",this.__OnInputKeyUp,this),mini.on(this._textEl,"keypress",this.__OnInputKeyPress,this),mini_onOne(this.el,"click",this.__OnClick,this))},destroy:function(t){var e;this.el&&(this.el.onmousedown=null),this._textEl&&((e=this._textEl)._placeholder_label&&(e._placeholder_label.onmousedown=null,e._placeholder_label=null),e.onpropertychange=e.ondrop=e.onchange=e.onfocus=null,mini.clearEvent(e),this._textEl=null),this._valueEl&&(mini.clearEvent(this._valueEl),this._valueEl=null),mini.TextBox.superclass.destroy.call(this,t)},doLayout:function(){this._doLabelLayout&&this._labelLayout()},setHeight:function(t){parseInt(t)==t&&(t+="px"),this.height=t,"textarea"==this._InputType&&(this.el.style.height=t,this.doLayout())},setName:function(t){this.name!=t&&(this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name))},setValue:function(t){null!==t&&t!==undefined||(t=""),(t=String(t)).length>this.maxLength&&(t=t.substring(0,this.maxLength)),this.value=t,this._valueEl.value=this._textEl.value=t,this._doEmpty()},getValue:function(){return this.value},setText:function(t){mini.isNull(t)&&(t=""),this._textEl.value=t},getText:function(){return this._textEl.value},getFormValue:function(){var t=this.value;return null!==t&&t!==undefined||(t=""),String(t)},setAllowInput:function(t){this.allowInput!=t&&(this.allowInput=t,this.doUpdate())},getAllowInput:function(){return this.allowInput},_placeholdered:!1,_doEmpty:function(){this._textEl.placeholder=this.emptyText,this.emptyText&&mini._placeholder(this._textEl)},setEmptyText:function(t){this.emptyText!=t&&(this.emptyText=t,this._doEmpty())},getEmptyText:function(){return this.emptyText},setMaxLength:function(t){this.maxLength=t,mini.setAttr(this._textEl,"maxLength",t),"textarea"==this._InputType&&mini.isIE&&(mini.on(this._textEl,"keyup",this.__OnMaxLengthKeyUp,this),mini.on(this._textEl,"keypress",this.__OnMaxLengthKeyUp,this),mini.on(this._textEl,"paste",this.__OnPaste,this))},__OnPaste:function(t){var e=this;setTimeout(function(){var t=e._textEl.value;t.length>e.maxLength&&(e._textEl.value=t.substring(0,e.maxLength)),e.__OnInputTextChanged()},0)},__OnMaxLengthKeyUp:function(t){this._textEl.value.length>=this.maxLength&&(this.__OnPaste(t),t.preventDefault())},getMaxLength:function(){return this.maxLength},setReadOnly:function(t){this.readOnly!=t&&(this.readOnly=t,this.doUpdate())},setEnabled:function(t){this.enabled!=t&&(this.enabled=t,this.doUpdate())},doUpdate:function(){this.enabled?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),this.isReadOnly()||0==this.allowInput?(this._textEl.readOnly=!0,mini.addClass(this.el,"mini-textbox-readOnly")):(this._textEl.readOnly=!1,mini.removeClass(this.el,"mini-textbox-readOnly")),this.required?this.addCls(this._requiredCls):this.removeCls(this._requiredCls),this.enabled?this._textEl.disabled=!1:this._textEl.disabled=!0},focus:function(){var i=this;setTimeout(function(){try{var t;i._textEl.focus(),mini.isIE&&((t=i._textEl.createTextRange()).collapse(!1),t.select())}catch(e){}},10)},blur:function(){try{this._textEl.blur()}catch(e){}},selectText:function(){var t=this;!function(){try{t._textEl.select()}catch(ex){}}()},getTextEl:function(){return this._textEl},getInputText:function(){return this._textEl.value},setSelectOnFocus:function(t){this.selectOnFocus=t},getSelectOnFocus:function(t){return this.selectOnFocus},_errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl||(this._errorIconEl=mini.append(this.el,'<span class="mini-errorIcon"></span>')),this._errorIconEl},_RemoveErrorIcon:function(){var t;this._errorIconEl&&(t=this._errorIconEl,jQuery(t).remove()),this._errorIconEl=null},__OnClick:function(t){this.enabled&&this.fire("click",{htmlEvent:t})},__OnMouseDown:function(t){var e=this;"textarea"!=this._InputType&&(mini.isAncestor(this._textEl,t.target)?setTimeout(function(){try{e._textEl.focus()}catch(ex){}},1):setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e4,1e4)},1))},__OnInputTextChanged:function(t,e){var i=this.value;this._oldValue=i,this.setValue(this._textEl.value),i===this.getValue()&&!0!==e||this._OnValueChanged()},__OnDropText:function(t){var e=this;setTimeout(function(){e.__OnInputTextChanged(t)},0)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;27!=t.keyCode&&13!=t.keyCode&&9!=t.keyCode||"textarea"==this._InputType&&13==t.keyCode||(this.__OnInputTextChanged(null),this._textEl.blur(),this._textEl.focus(),13==t.keyCode&&this.fire("enter",e)),27==t.keyCode&&t.preventDefault()},__OnInputKeyUp:function(t){this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},__OnFocus:function(t){var e;this.doUpdate(),this.isReadOnly()||(this._focused=!0,this.addCls(this._focusCls),this._initInputEvents(),this.selectOnFocus&&(e=this,setTimeout(function(){e.selectText()},1)),this.fire("focus",{htmlEvent:t}))},__OnBlur:function(t){this._focused=!1;var e=this;setTimeout(function(){0==e._focused&&e.removeCls(e._focusCls)},2),this.fire("blur",{htmlEvent:t}),this.validateOnLeave&&this.isEditable()&&this._tryValidate()},inputStyle:"",setInputStyle:function(t){this.inputStyle=t,mini.setStyle(this._textEl,t)},getAttrs:function(t){var e=mini.TextBox.superclass.getAttrs.call(this,t);jQuery(t);return mini._ParseString(t,e,["value","text","emptyText","inputStyle","onenter","onkeydown","onkeyup","onkeypress","onclick","maxLengthErrorText","minLengthErrorText","onfocus","onblur","vtype","emailErrorText","urlErrorText","floatErrorText","intErrorText","dateErrorText","minErrorText","maxErrorText","rangeLengthErrorText","rangeErrorText","rangeCharErrorText"]),mini._ParseBool(t,e,["allowInput","selectOnFocus"]),mini._ParseInt(t,e,["maxLength","minLength","minHeight","minWidth"]),e},vtype:"",setVtype:function(t){this.vtype=t},getVtype:function(){return this.vtype},__OnValidation:function(t){0!=t.isValid&&mini._ValidateVType(this.vtype,t.value,t,this)},setEmailErrorText:function(t){this.emailErrorText=t},getEmailErrorText:function(){return this.emailErrorText},setUrlErrorText:function(t){this.urlErrorText=t},getUrlErrorText:function(){return this.urlErrorText},setFloatErrorText:function(t){this.floatErrorText=t},getFloatErrorText:function(){return this.floatErrorText},setIntErrorText:function(t){this.intErrorText=t},getIntErrorText:function(){return this.intErrorText},setDateErrorText:function(t){this.dateErrorText=t},getDateErrorText:function(){return this.dateErrorText},setMaxLengthErrorText:function(t){this.maxLengthErrorText=t},getMaxLengthErrorText:function(){return this.maxLengthErrorText},setMinLengthErrorText:function(t){this.minLengthErrorText=t},getMinLengthErrorText:function(){return this.minLengthErrorText},setMaxErrorText:function(t){this.maxErrorText=t},getMaxErrorText:function(){return this.maxErrorText},setMinErrorText:function(t){this.minErrorText=t},getMinErrorText:function(){return this.minErrorText},setRangeLengthErrorText:function(t){this.rangeLengthErrorText=t},getRangeLengthErrorText:function(){return this.rangeLengthErrorText},setRangeCharErrorText:function(t){this.rangeCharErrorText=t},getRangeCharErrorText:function(){return this.rangeCharErrorText},setRangeErrorText:function(t){this.rangeErrorText=t},getRangeErrorText:function(){return this.rangeErrorText}}),mini.regClass(mini.TextBox,"textbox"),mini.Password=function(){mini.Password.superclass.constructor.apply(this,arguments)},mini.extend(mini.Password,mini.TextBox,{uiCls:"mini-password",_InputType:"password",getValue:function(){return this._textEl.value}}),mini.regClass(mini.Password,"password"),mini.TextArea=function(){mini.TextArea.superclass.constructor.apply(this,arguments)},mini.extend(mini.TextArea,mini.TextBox,{maxLength:1e7,height:"",minHeight:50,_InputType:"textarea",uiCls:"mini-textarea",doLayout:function(){var t;this.canLayout()&&(mini.TextArea.superclass.doLayout.call(this),t=mini.getHeight(this.el),mini.isIE6&&mini.setHeight(this._borderEl,t),this._textEl.style.height=(t=(t-=2)<0?0:t)+"px")}}),mini.regClass(mini.TextArea,"textarea"),mini.ButtonEdit=function(){mini.ButtonEdit.superclass.constructor.apply(this,arguments);var t=this.isReadOnly();!t&&0!=this.allowInput||(this._textEl.readOnly=!0),0==this.enabled&&this.addCls(this._disabledCls),t&&this.addCls(this._readOnlyCls),this.required&&this.addCls(this._requiredCls)},mini.extend(mini.ButtonEdit,mini.ValidatorBase,{name:"",formField:!0,selectOnFocus:!1,showButton:!0,buttonToolTip:"",closeToolTip:"",showClose:!1,emptyText:"",defaultValue:"",defaultText:"",value:"",text:"",maxLength:1e3,minLength:0,height:21,inputAsValue:!0,allowInput:!0,_noInputCls:"mini-buttonedit-noInput",_readOnlyCls:"mini-buttonedit-readOnly",_disabledCls:"mini-buttonedit-disabled",_emptyCls:"mini-buttonedit-empty",_focusCls:"mini-buttonedit-focus",_buttonCls:"mini-buttonedit-button",_buttonHoverCls:"mini-buttonedit-button-hover",_buttonPressedCls:"mini-buttonedit-button-pressed",_closeCls:"mini-buttonedit-close",set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;return delete t.text,this._allowUpdate=!(0==t.enabled||0==t.allowInput||t.readOnly),mini.ButtonEdit.superclass.set.call(this,t),!1===this._allowUpdate&&(this._allowUpdate=!0,this.doUpdate()),mini.isNull(i)||this.setText(i),mini.isNull(e)||this.setValue(e),this},uiCls:"mini-buttonedit",setButtons:function(t){var e=this;jQuery(".mini-buttonedit-button:not(.mini-buttonedit-trigger)",this.el).remove(),e.buttons=t||[];var i="";for(var n=0,s=e.buttons.length;n<s;n++){var o=e.buttons[n];o.name||(o.name="button"+n),i+=e._createButtonHtml(o.name,o.iconCls,o.tooltip)}mini.append(e._buttonsEl,i),e._doInputLayout(!1)},getButtons:function(){return this.buttons||[]},getButtonByName:function(t){for(var e=this.getButtons(),i=0,n=e.length;i<n;i++){var s=e[i];if(s.name&&s.name==t)return s}return null},_createButtonHtml:function(t,e,i){return'<span title="'+(i=i||"")+'" name="'+(t=t||"")+'" class="mini-buttonedit-button mini-buttonedit-'+t+'" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-icon mini-icon mini-iconfont '+(e=e||"")+'"></span></span>'},_getButtonsHTML:function(){return'<span class="mini-buttonedit-buttons">'+('<span class="mini-buttonedit-close mini-icon" name="close"></span>'+this._getButtonHtml("trigger","",this.buttonToolTip))+"</span>"},_getButtonHtml:function(t,e,i){return this._createButtonHtml(t,e,i)},_create:function(){this.el=document.createElement("span"),this.el.className="mini-buttonedit";var t=this._getButtonsHTML();this.el.innerHTML='<span class="mini-buttonedit-border mini-corner-all"><input type="text" class="mini-buttonedit-input" autocomplete="off"/>'+t+'</span><input name="'+this.name+'" type="hidden"/>',this._borderEl=this.el.firstChild,this._textEl=this._borderEl.firstChild,this._valueEl=this.el.lastChild,this._buttonsEl=this._borderEl.lastChild,this._buttonEl=this._buttonsEl.lastChild,this._closeEl=this._buttonEl.previousSibling,this._doEmpty()},destroy:function(t){this._textEl&&(this._textEl.onchange=this._textEl.onfocus=null,mini.clearEvent(this._textEl),this._textEl=null),this._borderEl=this._buttonsEl=this._buttonEl=this._closeEl=this._valueEl=null,mini.ButtonEdit.superclass.destroy.call(this,t)},_deferSetText:!0,_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this._textEl,"focus",this.__OnFocus,this),mini_onOne(this._textEl,"change",this.__OnInputTextChanged,this);var t=this.text;this.text=null,this.el&&this._deferSetText&&this.setText(t),mini.isIE&&mini.on(this._textEl,"input",this.__input,this)},this)},__input:function(){},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini.on(this.el,"click",this.__OnClick,this),mini.on(this._textEl,"blur",this.__OnBlur,this),mini.on(this._textEl,"keydown",this.__OnInputKeyDown,this),mini.on(this._textEl,"keyup",this.__OnInputKeyUp,this),mini.on(this._textEl,"keypress",this.__OnInputKeyPress,this))},_buttonWidth:20,_closeWidth:20,_doInputLayout:function(t){this._buttonEl.style.display=this.showButton?"inline-block":"none",this._buttonEl.title=this.buttonToolTip,this._closeEl&&(this._closeEl.style.display=this.showClose?"inline-block":"none",this._closeEl.title=this.closeToolTip),mini.isNull(mini.ButtonEdit._paddingOffset)&&(e=mini.getPaddings(this._borderEl),mini.ButtonEdit._paddingOffset=e.left);var e=this._buttonsEl.offsetWidth,e=e+(0<e?0:mini.ButtonEdit._paddingOffset);this._noLayout=2==e,this._borderEl.style.paddingRight=e+"px",!1!==t&&this.doLayout()},doLayout:function(){this._noLayout&&this._doInputLayout(!1),this._doLabelLayout&&this._labelLayout()},setHeight:function(t){parseInt(t)==t&&(t+="px"),this.height=t},focus:function(){try{this._textEl.focus();var t=this;setTimeout(function(){t._focused&&t._textEl.focus()},10)}catch(e){}},blur:function(){try{this._textEl.blur()}catch(e){}},selectText:function(){this._textEl.select()},getTextEl:function(){return this._textEl},setName:function(t){this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name)},setText:function(t){null!==t&&t!==undefined||(t="");this.text;this.text=t,this._textEl.value=t,this._doEmpty()},getText:function(){return this._textEl.value},setValue:function(t){null!==t&&t!==undefined||(t="");this.value;this.value=t,this._valueEl.value=this.getFormValue()},getValue:function(){return this.value},getFormValue:function(){var t=this.value;return null!==t&&t!==undefined||(t=""),String(t)},_doEmpty:function(){this._textEl.placeholder=this.emptyText,this.emptyText&&mini._placeholder(this._textEl)},setEmptyText:function(t){this.emptyText!=t&&(this.emptyText=t,this._doEmpty())},getEmptyText:function(){return this.emptyText},setMaxLength:function(t){t=parseInt(t),isNaN(t)||(this.maxLength=t,this._textEl.maxLength=t)},getMaxLength:function(){return this.maxLength},setMinLength:function(t){t=parseInt(t),isNaN(t)||(this.minLength=t)},getMinLength:function(){return this.minLength},setEnabled:function(t){mini.ButtonEdit.superclass.setEnabled.call(this,t)},_doReadOnly:function(){var t=this.isReadOnly();t||0==this.allowInput?this._textEl.readOnly=!0:this._textEl.readOnly=!1,t?this.addCls(this._readOnlyCls):this.removeCls(this._readOnlyCls),this.allowInput?this.removeCls(this._noInputCls):this.addCls(this._noInputCls),this.enabled?this._textEl.disabled=!1:this._textEl.disabled=!0},setAllowInput:function(t){this.allowInput=t,this._doReadOnly()},getAllowInput:function(){return this.allowInput},setInputAsValue:function(t){this.inputAsValue=t},getInputAsValue:function(){return this.inputAsValue},autoClear:!1,setAutoClear:function(t){this.autoClear=t},getAutoClear:function(){return this.autoClear},setButtonToolTip:function(t){this.buttonToolTip=t},getButtonToolTip:function(){return this.buttonToolTip},_errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl||(this._errorIconEl=mini.append(this.el,'<span class="mini-errorIcon"></span>')),this._errorIconEl},_RemoveErrorIcon:function(){var t;this._errorIconEl&&(t=this._errorIconEl,jQuery(t).remove()),this._errorIconEl=null},__OnClick:function(t){0!=this.enabled&&(this.fire("click",{htmlEvent:t}),this.isReadOnly()||mini.isAncestor(this._borderEl,t.target)&&(new Date,mini.isAncestor(this._buttonEl,t.target)&&this._OnButtonClick(t),mini.findParent(t.target,this._closeCls)&&(this.autoClear&&(this.value&&0!==this.value||""!==this.text)&&(this._oldValue=this.value,this.setValue(""),this.setText(""),this._OnValueChanged()),this.fire("closeclick",{htmlEvent:t})),this._handlerButtonElClick(t)))},_handlerButtonElClick:function(t){var e=mini.findParent(t.target,"mini-buttonedit-button");e&&e!=this._buttonEl&&e!=this._closeEl&&(e=jQuery(e).attr("name"),(e=this.getButtonByName(e)).handler&&e.handler({sender:this,button:e,htmlEvent:t}))},__OnMouseDown:function(t){var e,i,n;this.isReadOnly()||0==this.enabled||mini.isAncestor(this._borderEl,t.target)&&(mini.isAncestor(this._textEl,t.target)||(this._clickTarget=t.target,e=this,setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e3,1e3)},1),mini.isAncestor(this._buttonEl,t.target)&&(i=mini.findParent(t.target,"mini-buttonedit-up"),n=mini.findParent(t.target,"mini-buttonedit-down"),i?(mini.addClass(i,this._buttonPressedCls),this._OnButtonMouseDown(t,"up")):n?(mini.addClass(n,this._buttonPressedCls),this._OnButtonMouseDown(t,"down")):(mini.addClass(this._buttonEl,this._buttonPressedCls),this._OnButtonMouseDown(t))),mini.on(document,"mouseup",this.__OnDocMouseUp,this),(t=mini.findParent(t.target,"mini-buttonedit-button"))&&mini.addClass(t,this._buttonPressedCls)))},__OnDocMouseUp:function(t){this._clickTarget=null;var n=this;setTimeout(function(){for(var t=n._buttonEl.getElementsByTagName("*"),e=0,i=t.length;e<i;e++)mini.removeClass(t[e],n._buttonPressedCls);mini.removeClass(n._buttonEl,n._buttonPressedCls),mini.removeClass(n.el,n._pressedCls),jQuery(".mini-buttonedit-button",n._buttonsEl).removeClass(n._buttonPressedCls)},80),mini.un(document,"mouseup",this.__OnDocMouseUp,this)},__OnFocus:function(t){this.doUpdate(),this._initInputEvents(),this.isReadOnly()||(this._focused=!0,this.addCls(this._focusCls),this.selectOnFocus&&this.selectText(),this.fire("focus",{htmlEvent:t}))},__doFocusCls:function(){0==this._focused&&this.removeCls(this._focusCls)},__fireBlur:function(t){var e=this;setTimeout(function(){!function(){0==e._focused&&(e.removeCls(e._focusCls),e.validateOnLeave&&e.isEditable()&&e._tryValidate(),this.fire("blur",{htmlEvent:t}))}.call(e)},2)},__OnBlur:function(t){var e=this;e._focused=!1,setTimeout(function(){e.__fireBlur(t)},10)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;27!=t.keyCode&&13!=t.keyCode&&9!=t.keyCode||(this.__OnInputTextChanged(null),13==t.keyCode&&this.fire("enter",e)),27==t.keyCode&&t.preventDefault()},__OnInputTextChanged:function(){var t,e=this._textEl.value;e!=this.text&&(t=this.getValue(),this._oldValue=t,this.setText(e),this.inputAsValue&&(this.setValue(e),t!==this.getFormValue()&&this._OnValueChanged()))},__OnInputKeyUp:function(t){this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},_OnButtonClick:function(t){t={htmlEvent:t,cancel:!1};this.fire("beforebuttonclick",t),1!=t.cancel&&this.fire("buttonclick",t)},_OnButtonMouseDown:function(t,e){this.focus(),this.addCls(this._focusCls),this.fire("buttonmousedown",{htmlEvent:t,spinType:e})},onButtonClick:function(t,e){this.on("buttonclick",t,e)},onButtonMouseDown:function(t,e){this.on("buttonmousedown",t,e)},onTextChanged:function(t,e){this.on("textchanged",t,e)},textName:"",setTextName:function(t){this.textName=t,this._textEl&&mini.setAttr(this._textEl,"name",this.textName)},getTextName:function(){return this.textName},setSelectOnFocus:function(t){this.selectOnFocus=t},getSelectOnFocus:function(t){return this.selectOnFocus},setShowClose:function(t){this.showClose=t,this._doInputLayout()},getShowClose:function(t){return this.showClose},setShowButton:function(t){this.showButton=t,this._doInputLayout()},getShowButton:function(){return this.showButton},inputStyle:"",setInputStyle:function(t){this.inputStyle=t,mini.setStyle(this._textEl,t)},getAttrs:function(t){var e=mini.ButtonEdit.superclass.getAttrs.call(this,t);jQuery(t);mini._ParseString(t,e,["value","text","textName","emptyText","inputStyle","defaultText","onenter","onkeydown","onkeyup","onkeypress","onbuttonclick","onbuttonmousedown","ontextchanged","onfocus","onblur","oncloseclick","onclick","buttons","buttonToolTip"]),mini._ParseBool(t,e,["allowInput","inputAsValue","selectOnFocus","showClose","showButton","autoClear"]),mini._ParseInt(t,e,["maxLength","minLength"]);t=e.buttons;return t&&(t=window.eval("("+t+")"),e.buttons=t||null),e}}),mini.regClass(mini.ButtonEdit,"buttonedit"),mini.PopupEdit=function(){mini.PopupEdit.superclass.constructor.apply(this,arguments),this._createPopup(),this.el.className+=" mini-popupedit"},mini.extend(mini.PopupEdit,mini.ButtonEdit,{uiCls:"mini-popupedit",popup:null,popupCls:"mini-buttonedit-popup",_hoverCls:"mini-buttonedit-hover",_pressedCls:"mini-buttonedit-pressed",_destroyPopup:!0,destroy:function(t){this.isShowPopup()&&this.hidePopup(),this.popup&&(this._destroyPopup&&this.popup.destroy(),this.popup=null),this._popupInner&&(this._popupInner.owner=null,this._popupInner=null),this.el&&(this.el.onmouseover=this.el.onmouseout=null),this._listbox=this.tree=null,mini.PopupEdit.superclass.destroy.call(this,t)},_initEvents:function(){mini.PopupEdit.superclass._initEvents.call(this),mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this)},this)},__OnBlur:function(t){this._focused=!1,this._clickTarget&&mini.isAncestor(this.el,this._clickTarget)||this.isShowPopup()||mini.PopupEdit.superclass.__OnBlur.call(this,t)},__OnMouseOver:function(t){this.isReadOnly()||this.allowInput||mini.findParent(t.target,"mini-buttonedit-border")&&((t=mini.findParent(t.target,"mini-buttonedit-button"))&&t!=this._buttonEl||this.addCls(this._hoverCls))},__OnMouseOut:function(t){this.isReadOnly()||this.allowInput||this.removeCls(this._hoverCls)},__OnMouseDown:function(t){this.isReadOnly()||(mini.PopupEdit.superclass.__OnMouseDown.call(this,t),0==this.allowInput&&mini.findParent(t.target,"mini-buttonedit-border")&&(mini.addClass(this.el,this._pressedCls),mini.on(document,"mouseup",this.__OnDocMouseUp,this)))},__OnInputKeyDown:function(t){if(this.fire("keydown",{htmlEvent:t}),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;9!=t.keyCode&&27!=t.keyCode?(13==t.keyCode&&this.fire("enter"),this.isShowPopup()&&(13!=t.keyCode&&27!=t.keyCode||t.stopPropagation())):this.hidePopup()},__OnInputTextChanged:function(t){this.isShowPopup()?this._textChanged=!0:(this._textChanged=!1,mini.PopupEdit.superclass.__OnInputTextChanged.call(this,t))},within:function(t){return!!mini.isAncestor(this.el,t.target)||!!this.popup.within(t)},popupWidth:"100%",popupMinWidth:50,popupMaxWidth:2e3,popupHeight:"",popupMinHeight:30,popupMaxHeight:2e3,showPopupOnClick:!1,setPopup:function(t){"string"==typeof t&&(mini.parse(t),t=mini.get(t));t=mini.getAndCreate(t);t&&(t.setVisible(!1),(this._popupInner=t).owner=this,t.on("beforebuttonclick",this.__OnPopupButtonClick,this))},getPopup:function(){return this.popup||this._createPopup(),this.popup},_createPopup:function(){this.popup=new mini.Popup,this.popup.setShowAction("none"),this.popup.setHideAction("outerclick"),this.popup.setPopupEl(this.el),this.popup.on("BeforeClose",this.__OnPopupBeforeClose,this),this.popup.on("close",this.__OnPopupClose,this),mini.on(this.popup.el,"keydown",this.__OnPopupKeyDown,this)},__OnPopupClose:function(t){},__OnPopupBeforeClose:function(t){this.within(t.htmlEvent)?t.cancel=!0:this._unDocumentMousewheel()},__OnPopupKeyDown:function(t){},showPopup:function(){var t={cancel:!1};if(!1!==this._firebeforeshowpopup&&(this.fire("beforeshowpopup",t),1==t.cancel))return!1;t=this.getPopup();this._syncShowPopup(),t.on("Close",this.__OnPopupHide,this),this._onDocumentMousewheel(),this.fire("showpopup")},_unDocumentMousewheel:function(){mini.un(document,"mousewheel",this.__OnDocumentMousewheel,this),this._mousewheelXY=null},_onDocumentMousewheel:function(){this._unDocumentMousewheel(),this._mousewheelXY=mini.getXY(this.el),mini.on(document,"mousewheel",this.__OnDocumentMousewheel,this)},__OnDocumentMousewheel:function(t){var i=this;setTimeout(function n(){var t,e;i.isShowPopup()&&(t=i._mousewheelXY,e=mini.getXY(i.el),t[0]!=e[0]||t[1]!=e[1]?i.hidePopup():setTimeout(n,300))},300)},_syncShowPopup:function(){var t=this.getPopup();this._popupInner&&this._popupInner.el.parentNode!=this.popup._contentEl&&(this.popup._contentEl.appendChild(this._popupInner.el),this._popupInner.setVisible(!0));var e=mini.getBox(this._borderEl),i=this.popupWidth;"100%"==this.popupWidth&&(i=e.width),t.show(-1e3,-1e3),t.setWidth(i);i=parseInt(this.popupHeight);isNaN(i)?t.setHeight("auto"):t.setHeight(i),t.setMinWidth(this.popupMinWidth),t.setMinHeight(this.popupMinHeight),t.setMaxWidth(this.popupMaxWidth),t.setMaxHeight(this.popupMaxHeight);t={xAlign:"left",yAlign:"below",outYAlign:"above",outXAlign:"right",popupCls:this.popupCls,alwaysView:this.alwaysView};this._doShowAtEl(this._borderEl,t)},_doShowAtEl:function(t,e){this.getPopup().showAtEl(t,e)},__OnPopupHide:function(t){this._textChanged&&(this._textChanged=!1,this.__OnInputTextChanged()),this.__doFocusCls(),this.fire("hidepopup")},hidePopup:function(){this.isShowPopup()&&(this.getPopup().close(),!1!==this._autoBlur&&this.blur())},isShowPopup:function(){return!(!this.popup||!this.popup.isDisplay())},alwaysView:!1,setAlwaysView:function(t){this.alwaysView=t},getAlwaysView:function(){return this.alwaysView},setPopupWidth:function(t){this.popupWidth=t},setPopupMaxWidth:function(t){this.popupMaxWidth=t},setPopupMinWidth:function(t){this.popupMinWidth=t},getPopupWidth:function(t){return this.popupWidth},getPopupMaxWidth:function(t){return this.popupMaxWidth},getPopupMinWidth:function(t){return this.popupMinWidth},setPopupHeight:function(t){this.popupHeight=t},setPopupMaxHeight:function(t){this.popupMaxHeight=t},setPopupMinHeight:function(t){this.popupMinHeight=t},getPopupHeight:function(t){return this.popupHeight},getPopupMaxHeight:function(t){return this.popupMaxHeight},getPopupMinHeight:function(t){return this.popupMinHeight},setShowPopupOnClick:function(t){this.showPopupOnClick=t},getShowPopupOnClick:function(t){return this.showPopupOnClick},__OnClick:function(t){if(0!=this.enabled&&(this.fire("click",{htmlEvent:t}),!this.isReadOnly())){if(mini.isAncestor(this._buttonEl,t.target)&&this._OnButtonClick(t),mini.findParent(t.target,this._closeCls))return this.isShowPopup()&&this.hidePopup(),this.autoClear&&(this.value&&0!==this.value||""!==this.text)&&(this.setValue(""),this.setText(""),this._OnValueChanged()),void this.fire("closeclick",{htmlEvent:t});var e,i;(0==this.allowInput||mini.isAncestor(this._buttonEl,t.target)||this.showPopupOnClick)&&((e=mini.findParent(t.target,"mini-buttonedit-button"))&&e!=this._buttonEl||(this.isShowPopup()?(this.hidePopup(),this.focus()):(i=this,setTimeout(function(){i.showPopup()},1)))),this._handlerButtonElClick(t)}},__OnPopupButtonClick:function(t){"close"==t.name&&this.hidePopup(),t.cancel=!0},getAttrs:function(t){var e=mini.PopupEdit.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["popupWidth","popupHeight","popup","onshowpopup","onhidepopup","onbeforeshowpopup"]),mini._ParseInt(t,e,["popupMinWidth","popupMaxWidth","popupMinHeight","popupMaxHeight"]),mini._ParseBool(t,e,["showPopupOnClick","alwaysView"]),e}}),mini.regClass(mini.PopupEdit,"popupedit"),mini.ComboBox=function(){this.data=[],this.columns=[],mini.ComboBox.superclass.constructor.apply(this,arguments),this._initInput()},mini.extend(mini.ComboBox,mini.PopupEdit,{_initInput:function(){var t=this;isFirefox&&(this._textEl.oninput=function(){t._tryQuery()})},__input:function(){document.activeElement==this._textEl&&this._tryQuery()},text:"",value:"",valueField:"id",textField:"text",dataField:"",delimiter:",",multiSelect:!1,data:[],url:"",valueInCheckOrder:!0,columns:[],allowInput:!1,valueFromSelect:!1,popupMaxHeight:200,setDelimiter:function(t){this.delimiter=t,this._listbox&&(this._listbox.delimiter=t)},getDelimiter:function(){return this.delimiter},autoFocusItem:!1,setAutoFocusItem:function(t){this.autoFocusItem=t},getAutoFocusItem:function(){return this.autoFocusItem},set:function(t){if("string"==typeof t)return this;var e=t.text;delete t.text;var i=t.value;delete t.value;var n=t.url;delete t.url;var s=t.data;return delete t.data,mini.ComboBox.superclass.set.call(this,t),mini.isNull(s)||(this.setData(s),t.data=s),mini.isNull(n)||(this.setUrl(n),t.url=n),mini.isNull(i)||(this.setValue(i),t.value=i),mini.isNull(e)||this.setText(e),this},uiCls:"mini-combobox",_createPopup:function(){mini.ComboBox.superclass._createPopup.call(this),this._listbox=new mini.ListBox,this.listbox=this._listbox,this._listbox.delimiter=this.delimiter,this._listbox.setBorderStyle("border:0;"),this._listbox.setStyle("width:100%;height:auto;"),this._listbox.render(this.popup._contentEl),this._listbox.on("beforeitemclick",this.__OnBeforeItemClick,this),this._listbox.on("itemclick",this.__OnItemClick,this),this._listbox.on("drawcell",this.__OnItemDrawCell,this);var e=this;this._listbox.on("beforeload",function(t){e.fire("beforeload",t)},this),this._listbox.on("preload",function(t){e.fire("preload",t)},this),this._listbox.on("load",function(t){e.data=t.data,e.fire("load",t)},this),this._listbox.on("loaderror",function(t){e.fire("loaderror",t)},this)},showPopup:function(){var t,e={cancel:!1};this.fire("beforeshowpopup",e),this._firebeforeshowpopup=!1,1!=e.cancel&&(this._listbox.setHeight("auto"),mini.ComboBox.superclass.showPopup.call(this),""==(t=this.popup.el.style.height)||"auto"==t?this._listbox.setHeight("auto"):this._listbox.setHeight("100%"),this.multiSelect||(t=(e=jQuery("table .mini-listbox-checkbox",this._listbox.el)).css("display"),e.css("display","table-cell"),e.css("display",t)),this._listbox.setValueInCheckOrder(this.valueInCheckOrder),this._listbox.setValue(this.value),this.autoFocusItem&&(""==this.value||mini.isNull(this.value))&&this._listbox._focusItem(0))},changeOnSelectMethod:!1,isSelected:function(t){return this._listbox.isSelected(t)},_syncValueText:function(){var t=this._listbox.getSelecteds(),t=this._listbox.getValueAndText(t);this.setValue(t[0]),this.setText(t[1])},selectAll:function(){this._listbox.selectAll(),this._syncValueText()},deselectAll:function(){this._listbox.deselectAll(),this._syncValueText()},deselect:function(t){this._listbox.deselect(t),this._syncValueText()},select:function(t){this._listbox.deselectAll(),(t=this.getItem(t))&&(this._oldValue=this.getValue(),this._listbox.select(t),this.__OnItemClick({item:t},!1),this.changeOnSelectMethod&&this._OnValueChanged())},selects:function(t){t&&(t=this._listbox.getValueAndText(t),this.setValue(t[0]),this._listbox.setValue(this.value))},getItem:function(t){return"object"==typeof t?t:this.data[t]},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},load:function(t){"string"==typeof t?this.setUrl(t):this.setData(t)},_eval:function(t){return window.eval("("+t+")")},setData:function(t){"string"==typeof t&&(t=this._eval(t)),mini.isArray(t)||(t=[]),this._listbox.setData(t),this.data=this._listbox.data,this.doDataChange()},getData:function(){return this.data},clearOnLoad:!0,setClearOnLoad:function(t){this.clearOnLoad=t},getClearOnLoad:function(){return this.clearOnLoad},doDataChange:function(){var t=this._listbox.getValueAndText(this.value),e=t[0],t=t[1];""!==e||this.clearOnLoad||(e=this.value,t=this.text,this.value=null),this.text=this._textEl.value=t,this.setValue(e)},setUrl:function(t){this.getPopup(),this._listbox.setUrl(t),this.url=this._listbox.url,this.data=this._listbox.data,this.doDataChange()},getUrl:function(){return this.url},setValueField:function(t){this.valueField=t,this._listbox&&this._listbox.setValueField(t)},getValueField:function(){return this.valueField},setTextField:function(t){this._listbox&&this._listbox.setTextField(t),this.textField=t},getTextField:function(){return this.textField},pinyinField:"tag",setPinyinField:function(t){this.pinyinField=t},getPinyinField:function(){return this.pinyinField},setDisplayField:function(t){this.setTextField(t)},setDataField:function(t){this._listbox&&this._listbox.setDataField(t),this.dataField=t},getDataField:function(){return this.dataField},setValueInCheckOrder:function(t){this.valueInCheckOrder=t,this._listbox.valueInCheckOrder=t},getValueInCheckOrder:function(){return this.valueInCheckOrder},setValue:function(t){mini.isNull(t)&&(t="");var e=this._listbox.getValueAndText(t),i=e[0],e=e[1];""!==e&&!mini.isNull(e)||(e=t),this.valueFromSelect&&(""===i||mini.isNull(i))&&(t=e=""),this.value=t,this._valueEl.value=this.value,this.text=this._textEl.value=e,this._doEmpty()},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t,this._listbox&&(this._listbox.setMultiSelect(t),this._listbox.setShowCheckBox(t)))},getMultiSelect:function(){return this.multiSelect},setColumns:function(t){mini.isArray(t)||(t=[]),this.columns=t,this._listbox.setColumns(t)},getColumns:function(){return this.columns},showNullItem:!1,setShowNullItem:function(t){this.showNullItem!=t&&(this.showNullItem=t,this._listbox.setShowNullItem(t))},getShowNullItem:function(){return this.showNullItem},setNullItemText:function(t){this.nullItemText!=t&&(this.nullItemText=t,this._listbox.setNullItemText(t))},getNullItemText:function(){return this.nullItemText},setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},_OnValueChanged:function(){this.validateOnChanged&&this._tryValidate();var n=this;setTimeout(function(){var t,e,i;t=n.getValue(),e=n.getSelecteds(),i=e[0],n.fire("valuechanged",{value:t,selecteds:e,selected:i,oldValue:n._oldValue})},50)},getSelecteds:function(){return this._listbox.findItems(this.value)},getSelected:function(){return this.getSelecteds()[0]},__OnItemDrawCell:function(t){this.fire("drawcell",t)},__OnBeforeItemClick:function(t){var e={item:t.item,cancel:!1};this.fire("beforeitemclick",e),e.cancel&&(t.cancel=!0)},__OnItemClick:function(t,e){var i,n,s={item:t.item,cancel:!1};!1!==e&&(this.fire("beforeitemclick",s),s.cancel)||(i=this._listbox.getSelecteds(),s=this._listbox.getValueAndText(i),i=this.getValue(),this.setValue(s[0]),this.setText(s[1]),this._oldValue=i,t&&!1!==e&&(i!=this.getValue()&&(n=this,setTimeout(function(){n._OnValueChanged()},1)),this.multiSelect||this.hidePopup(),isMobile||this.focus(),this.fire("itemclick",{item:t.item})))},__OnInputKeyDown:function(t,e){var i,n,s,o={htmlEvent:t};if(this.fire("keydown",o),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(!this.isReadOnly())switch(t.keyCode){case 27:t.preventDefault(),this.isShowPopup()&&t.stopPropagation(),this.hidePopup(),this.focus();break;case 13:this.isShowPopup()?(t.preventDefault(),t.stopPropagation(),n=this._listbox.getFocusedIndex(),(s=this._listbox.getAt(n))&&!1!==s.enabled&&-1!=n&&(this.fire("beforeitemclick",i={item:s,cancel:!1}),0==i.cancel&&(this._oldValue=this.getValue(),this.multiSelect||(this._listbox.deselectAll(),this._listbox.select(s)),i=this._listbox.getSelecteds(),i=this._listbox.getValueAndText(i),this.setValue(i[0]),this.setText(i[1]),this._OnValueChanged())),this.hidePopup(),this.focus()):this.fire("enter",o);break;case 37:break;case 38:t.preventDefault(),-1==(n=this._listbox.getFocusedIndex())&&(n=0,this.multiSelect||(s=this._listbox.findItems(this.value)[0])&&(n=this._listbox.indexOf(s))),this.isShowPopup()&&(this.multiSelect||this._listbox._focusItem(n=--n<0?0:n,!0));break;case 39:break;case 40:t.preventDefault(),-1==(n=this._listbox.getFocusedIndex())&&(n=-1,this.multiSelect||(s=this._listbox.findItems(this.value)[0])&&(n=this._listbox.indexOf(s))),this.isShowPopup()?this.multiSelect||((n+=1)>this._listbox.getCount()-1&&(n=this._listbox.getCount()-1),this._listbox._focusItem(n,!0)):this.keyNavEnabled&&(this.showPopup(),this.multiSelect||this._listbox._focusItem(n,!0));break;default:0==this.allowInput||this._tryQuery(this._textEl.value)}}else this.isShowPopup()&&(this._autoBlur=!1,this.hidePopup(),delete this._autoBlur)},__OnInputKeyUp:function(t){this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},_tryQuery:function(e){var i=this;setTimeout(function(){var t=i._textEl.value;t!=e&&i._doQuery(t)},10)},_doQuery:function(t){if(this.autoFilter&&1!=this.multiSelect){var e=[];t=t.toUpperCase();for(var i,n=0,s=this.data.length;n<s;n++){var o=this.data[n],l=mini._getMap(this.textField,o),r=mini._getMap(this.pinyinField,o),l=l?String(l).toUpperCase():"",r=r?String(r).toUpperCase():"";-1==l.indexOf(t)&&-1==r.indexOf(t)||e.push(o)}this._listbox.setData(e),this._filtered=!0,""===t&&!this.isShowPopup()||(this.showPopup(),i=0,this._listbox.getShowNullItem()&&(i=1),this._listbox._focusItem(i,!0))}},__OnPopupHide:function(t){(this.valueFromSelect||this._textChanged)&&(this._textChanged=!1,this.__OnInputTextChanged()),""==this._textEl.value&&this._listbox._blurItem(),this._filtered&&(this._filtered=!1,this._listbox.el&&this._listbox.setData(this.data)),this.__doFocusCls(),this.fire("hidepopup")},findItems:function(t){return this._listbox.findItems(t)},__OnInputTextChanged:function(t){if(this.isShowPopup())this._textChanged=!0;else if(this._textChanged=!1,this._oldValue=this.getValue(),0==this.multiSelect){for(var e,i,n,s=this._textEl.value,o=this.getData(),l=null,r=0,a=o.length;r<a;r++){var h=o[r],d=h[this.textField],u=h[this.valueField];if(d==s&&(mini.isNull(this.value)||""===this.value||this.value==u)){l=h;break}}l?(this._listbox.setValue(l?l[this.valueField]:""),e=this._listbox.getValue(),i=this._listbox.getValueAndText(e),n=this.getValue(),this.setValue(e),this.setText(i[1])):this.valueFromSelect?(this.setValue(""),this.setText("")):(this.setValue(s),this.setText(s)),n!=this.getValue()&&this._OnValueChanged()}},setAjaxData:function(t){this.ajaxData=t,this._listbox.setAjaxData(t)},setAjaxType:function(t){this.ajaxType=t,this._listbox.setAjaxType(t)},setAjaxOptions:function(t){this.ajaxOptions=t,this._listbox.setAjaxOptions(t)},autoFilter:!0,setAutoFilter:function(t){this.autoFilter=t},getAutoFilter:function(){return this.autoFilter},getAttrs:function(t){var e=mini.ComboBox.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["url","data","textField","valueField","displayField","nullItemText","pinyinField","delimiter","ondrawcell","onbeforeload","onpreload","onload","onloaderror","onitemclick","onbeforeitemclick"]),mini._ParseBool(t,e,["multiSelect","showNullItem","valueFromSelect","valueInCheckOrder","clearOnLoad","autoFilter","autoFocusItem"]),e.displayField&&(e.textField=e.displayField);var i=e.valueField||this.valueField,n=e.textField||this.textField;if("select"==t.nodeName.toLowerCase()){for(var s=[],o=0,l=t.length;o<l;o++){var r=t.options[o],a={};a[n]=r.text,a[i]=r.value,s.push(a)}0<s.length&&(e.data=s)}else for(var h=mini.getChildNodes(t),o=0,l=h.length;o<l;o++){var d=h[o],u=jQuery(d).attr("property");u&&("columns"==(u=u.toLowerCase())?e.columns=mini._ParseColumns(d):"data"==u&&(e.data=d.innerHTML))}return e}}),mini.regClass(mini.ComboBox,"combobox"),mini.Calendar=function(){this.viewDate=new Date,this._selectedDates=[],mini.Calendar.superclass.constructor.apply(this,arguments)},mini.extend(mini.Calendar,mini.Control,{width:220,height:160,monthPicker:!1,_clearBorder:!1,viewDate:null,_selectedDate:"",_selectedDates:[],multiSelect:!1,firstDayOfWeek:0,yesterdayText:"Yesterday",todayText:"Today",clearText:"Clear",okText:"OK",cancelText:"Cancel",daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],format:"MMM, yyyy",timeFormat:"H:mm",showTime:!1,currentTime:!0,rows:1,columns:1,headerCls:"",bodyCls:"",footerCls:"",_todayCls:"mini-calendar-today",_weekendCls:"mini-calendar-weekend",_otherMonthCls:"mini-calendar-othermonth",_selectedDateCls:"mini-calendar-selected",showHeader:!0,showFooter:!0,showWeekNumber:!1,showDaysHeader:!0,showMonthButtons:!0,showYearButtons:!0,showTodayButton:!0,showClearButton:!0,showOkButton:!1,showYesterdayButton:!1,isWeekend:function(t){t=t.getDay();return 0==t||6==t},getFirstDateOfMonth:function(t){t=new Date(t.getFullYear(),t.getMonth(),1);return mini.getWeekStartDate(t,this.firstDayOfWeek)},getShortWeek:function(t){return this.daysShort[t]},uiCls:"mini-calendar",_create:function(){var t='<tr style="width:100%;"><td style="width:100%;"></td></tr>',e='<table class="mini-calendar" cellpadding="0" cellspacing="0">'+(t+='<tr ><td><div class="mini-calendar-footer"><span style="display:inline-block;"><input name="time" class="mini-timespinner mini-calendar-timespinner" format="'+this.timeFormat+'"/><span class="mini-calendar-footerSpace"></span></span><span class="mini-calendar-tadayButton mini-calendar-button mini-corner-all">'+this.todayText+'</span><span class="mini-calendar-footerSpace"></span><span class="mini-calendar-clearButton mini-calendar-button mini-corner-all">'+this.clearText+'</span><span class="mini-calendar-okButton mini-calendar-button mini-corner-all">'+this.okText+'</span><a href="#" class="mini-calendar-focus" style="position:absolute;left:-10px;top:-10px;width:0px;height:0px;outline:none" hideFocus></a></div></td></tr>')+"</table>",t=document.createElement("div");t.innerHTML=e,this.el=t.firstChild;this.el.getElementsByTagName("tr");t=this.el.getElementsByTagName("td");this._innerEl=t[0],this._footerEl=mini.byClass("mini-calendar-footer",this.el),this.timeWrapEl=this._footerEl.childNodes[0],this.todayButtonEl=this._footerEl.childNodes[1],this.footerSpaceEl=this._footerEl.childNodes[2],this.closeButtonEl=this._footerEl.childNodes[3],this.okButtonEl=this._footerEl.childNodes[4],this._focusEl=this._footerEl.lastChild,this.yesterdayButtonEl=mini.after(this.todayButtonEl,'<span class="mini-calendar-tadayButton yesterday mini-calendar-button mini-corner-all">'+this.yesterdayText+"</span>"),mini.parse(this._footerEl),this.timeSpinner=mini.getbyName("time",this.el),this.doUpdate()},focus:function(){try{this._focusEl.focus()}catch(e){}},destroy:function(t){this.timeSpinner&&(this.timeSpinner.destroy(),this.timeSpinner=null),this._innerEl=this._footerEl=this.timeWrapEl=this.todayButtonEl=this.footerSpaceEl=this.closeButtonEl=null,this._focusEl=this.okButtonEl=this.yesterdayButtonEl=null,this.timeSpinner=null,mini.Calendar.superclass.destroy.call(this,t)},_initEvents:function(){this.timeSpinner&&this.timeSpinner.on("valuechanged",this.__OnTimeChanged,this),mini._BindEvents(function(){mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"keydown",this.__OnKeyDown,this)},this)},getDateEl:function(t){if(!t)return null;t=this.uid+"$"+mini.clearTime(t).getTime();return document.getElementById(t)},within:function(t){return!!mini.isAncestor(this.el,t.target)||!(!this.menuEl||!mini.isAncestor(this.menuEl,t.target))},setShowHeader:function(t){this.showHeader=t,this.doUpdate()},getShowHeader:function(){return this.showHeader},setShowFooter:function(t){this.showFooter=t,this.doUpdate()},getShowFooter:function(){return this.showFooter},setShowWeekNumber:function(t){this.showWeekNumber=t,this.doUpdate()},getShowWeekNumber:function(){return this.showWeekNumber},setShowDaysHeader:function(t){this.showDaysHeader=t,this.doUpdate()},getShowDaysHeader:function(){return this.showDaysHeader},setShowMonthButtons:function(t){this.showMonthButtons=t,this.doUpdate()},getShowMonthButtons:function(){return this.showMonthButtons},setShowYearButtons:function(t){this.showYearButtons=t,this.doUpdate()},getShowYearButtons:function(){return this.showYearButtons},setShowTodayButton:function(t){this.showTodayButton=t,this.todayButtonEl.style.display=this.showTodayButton?"":"none",this.doUpdate()},getShowTodayButton:function(){return this.showTodayButton},setShowYesterdayButton:function(t){this.showYesterdayButton=t,this.yesterdayButtonEl.style.display=this.showYesterdayButton?"":"none",this.doUpdate()},getShowYesterdayButton:function(){return this.showYesterdayButton},setShowClearButton:function(t){this.showClearButton=t,this.closeButtonEl.style.display=this.showClearButton?"":"none",this.doUpdate()},getShowClearButton:function(){return this.showClearButton},setShowOkButton:function(t){this.showOkButton=t,this.okButtonEl.style.display=this.showOkButton?"":"none",this.doUpdate()},getShowOkButton:function(){return this.showOkButton},setViewDate:function(t){t=(t=mini.parseDate(t))||new Date,mini.isDate(t)&&(t=new Date(t.getTime())),this.viewDate=t,this.doUpdate()},getViewDate:function(){return this.viewDate},setSelectedDate:function(t){t=mini.parseDate(t),t=mini.isDate(t)?new Date(t.getTime()):"";var e=this.getDateEl(this._selectedDate);e&&mini.removeClass(e,this._selectedDateCls),this._selectedDate=t,this._selectedDate&&(this._selectedDate=mini.cloneDate(this._selectedDate)),(e=this.getDateEl(this._selectedDate))&&mini.addClass(e,this._selectedDateCls),this.fire("datechanged")},setSelectedDates:function(t){mini.isArray(t)||(t=[]),this._selectedDates=t,this.doUpdate()},getSelectedDate:function(){return this._selectedDate||""},setTime:function(t){this.timeSpinner.setValue(t)},getTime:function(){return this.timeSpinner.getFormValue()},setValue:function(t){this.setSelectedDate(t),t=t||new Date,this.setTime(t)},getValue:function(){var t,e=this._selectedDate;return e&&(e=mini.clearTime(e),!this.showTime||(t=this.timeSpinner.getValue())&&(e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()))),e||""},getFormValue:function(){var t=this.getValue();return t?mini.formatDate(t,"yyyy-MM-dd HH:mm:ss"):""},isSelectedDate:function(t){return!(!t||!this._selectedDate)&&mini.clearTime(t).getTime()==mini.clearTime(this._selectedDate).getTime()},setMultiSelect:function(t){this.multiSelect=t,this.doUpdate()},getMultiSelect:function(){return this.multiSelect},setRows:function(t){isNaN(t)||(this.rows=t=t<1?1:t,this.doUpdate())},getRows:function(){return this.rows},setColumns:function(t){isNaN(t)||(this.columns=t=t<1?1:t,this.doUpdate())},getColumns:function(){return this.columns},setShowTime:function(t){this.showTime!=t&&(this.showTime=t,this.timeWrapEl.style.display=this.showTime?"":"none",jQuery(this._footerEl).toggleClass("mini-calendar-hastime",this.showTime),this.doLayout())},getShowTime:function(){return this.showTime},setTimeFormat:function(t){this.timeFormat!=t&&(this.timeSpinner.setFormat(t),this.timeFormat=this.timeSpinner.format)},getTimeFormat:function(){return this.timeFormat},doLayout:function(){var t;this.canLayout()&&(this.timeWrapEl.style.display=this.showTime?"":"none",this.todayButtonEl.style.display=this.showTodayButton?"":"none",this.closeButtonEl.style.display=this.showClearButton?"":"none",this.yesterdayButtonEl.style.display=this.showYesterdayButton?"":"none",this.okButtonEl.style.display=this.showOkButton?"":"none",this.footerSpaceEl.style.display=this.showClearButton&&this.showTodayButton?"":"none",this._footerEl.style.display=this.showFooter?"":"none",t=this._innerEl.firstChild,this.isAutoHeight()?t.parentNode.style.height="":(t.parentNode.style.height="100px",h=jQuery(this.el).height(),h-=jQuery(this._footerEl).outerHeight(),t.parentNode.style.height=h+"px"),mini.layout(this._footerEl),this.monthPicker&&this._tryShowMenu())},doUpdate:function(){if(this._allowUpdate){for(var t=new Date(this.viewDate.getTime()),e=(1==this.rows&&this.columns,100/this.rows),i='<table class="mini-calendar-views" border="0" cellpadding="0" cellspacing="0">',n=0,s=this.rows;n<s;n++){i+="<tr >";for(var o=0,l=this.columns;o<l;o++)i+='<td style="height:'+e+'%">',i+=this._CreateView(t,n,o),i+="</td>",t=new Date(t.getFullYear(),t.getMonth()+1,1);i+="</tr>"}this._innerEl.innerHTML=i+="</table>";var r=this.el;setTimeout(function(){mini.repaint(r)},100),this.doLayout()}},_CreateView:function(t,e,i){var n=t.getMonth(),s=this.getFirstDateOfMonth(t),o=new Date(s.getTime()),l=mini.clearTime(new Date).getTime(),r=(this.value&&mini.clearTime(this.value).getTime(),1<this.rows||1<this.columns),a="";if(a+='<table class="mini-calendar-view" border="0" cellpadding="0" cellspacing="0">',this.showHeader&&(a+='<tr ><td colSpan="10" class="mini-calendar-header"><div class="mini-calendar-headerInner">',0==e&&0==i&&(a+='<div class="mini-calendar-prev mini-icon">',this.showYearButtons&&(a+='<span class="mini-calendar-yearPrev mini-icon"></span>'),this.showMonthButtons&&(a+='<span class="mini-calendar-monthPrev mini-icon"></span>'),a+="</div>"),0==e&&i==this.columns-1&&(a+='<div class="mini-calendar-next mini-icon">',this.showMonthButtons&&(a+='<span class="mini-calendar-monthNext mini-icon"></span>'),this.showYearButtons&&(a+='<span class="mini-calendar-yearNext mini-icon"></span>'),a+="</div>"),a+='<span class="mini-calendar-title">'+mini.formatDate(t,this.format),a+="</div></td></tr>"),this.showDaysHeader){a+='<tr class="mini-calendar-daysheader"><td class="mini-calendar-space"></td>',this.showWeekNumber&&(a+='<td sclass="mini-calendar-weeknumber"></td>');for(var h=(c=this.firstDayOfWeek)+7;c<h;c++)a+='<td yAlign="middle">',a+=this.getShortWeek(c),a+="</td>",s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1);a+='<td class="mini-calendar-space"></td></tr>'}for(var d,s=o,u=0;u<=5;u++){a+='<tr class="mini-calendar-days"><td class="mini-calendar-space"></td>',this.showWeekNumber&&(d=mini.getWeek(s.getFullYear(),s.getMonth()+1,s.getDate()),a+='<td class="mini-calendar-weeknumber" yAlign="middle">'+(d=1==String(d).length?"0"+d:d)+"</td>");for(var c,h=(c=this.firstDayOfWeek)+7;c<h;c++){var m=this.isWeekend(s),f=mini.clearTime(s).getTime(),p=f==l,g=this.isSelectedDate(s);n!=s.getMonth()&&r&&(f=-1);var _=this._OnDrawDate(s);a+='<td yAlign="middle" id="',a+=this.uid+"$"+f,a+='" class="mini-calendar-date ',m&&(a+=" mini-calendar-weekend "),0==_.allowSelect&&(a+=" mini-calendar-disabled "),n!=s.getMonth()&&r||(g&&(a+=" "+this._selectedDateCls+" "),p&&(a+=" mini-calendar-today ")),n!=s.getMonth()&&(a+=" mini-calendar-othermonth "),_.dateCls&&(a+=" "+_.dateCls),a+='" style="',_.dateStyle&&(a+=_.dateStyle),a+='">',n!=s.getMonth()&&r||(a+=_.dateHtml),a+="</td>",s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1)}a+='<td class="mini-calendar-space"></td></tr>'}return a+='<tr class="mini-calendar-bottom" colSpan="10"><td ></td></tr>',a+="</table>"},_OnDrawDate:function(t){t={date:t,dateCls:"",dateStyle:"",dateHtml:t.getDate(),allowSelect:!0};return this.fire("drawdate",t),t},_OnDateClick:function(t,e){this.fire("dateclick",{date:t,action:e}),this._OnValueChanged(),this.hideMenu()},menuEl:null,menuYear:null,menuSelectMonth:null,menuSelectYear:null,_tryShowMenu:function(){var t;this.menuEl||(t=this,setTimeout(function(){t.showMenu()},1))},showMenu:function(){this.hideMenu(),this.menuYear=10*parseInt(this.viewDate.getFullYear()/10),this._menuselectMonth=this.viewDate.getMonth(),this._menuselectYear=this.viewDate.getFullYear();this.menuEl=mini.append(document.body,'<div class="mini-calendar-menu"></div>'),this.updateMenu(this.viewDate);var t=this.getBox();"0px"==this.el.style.borderWidth&&(this.menuEl.style.border="0"),mini.setBox(this.menuEl,t),mini.on(this.menuEl,"click",this.__OnMenuClick,this),mini.on(this.menuEl,"dblclick",this.__OnMenuDblClick,this),mini.on(document,"mousedown",this.__OnBodyMenuMouseDown,this)},hideMenu:function(){this.menuEl&&(mini.un(this.menuEl,"click",this.__OnMenuClick,this),mini.un(document,"mousedown",this.__OnBodyMenuMouseDown,this),jQuery(this.menuEl).remove(),this.menuEl=null)},updateMenu:function(){if(this.menuEl){for(var t='<div class="mini-calendar-menu-months">',e=0,i=12;e<i;e++){var n=mini.getShortMonth(e),s="";t+='<a id="'+e+'" class="mini-calendar-menu-month '+(s=this._menuselectMonth==e?"mini-calendar-menu-selected":s)+'" href="javascript:void(0);" hideFocus onclick="return false">'+n+"</a>"}t+='<div style="clear:both;"></div></div>',t+='<div class="mini-calendar-menu-years">';for(e=this.menuYear,i=this.menuYear+10;e<i;e++){n=e,s="";t+='<a id="'+e+'" class="mini-calendar-menu-year '+(s=this._menuselectYear==e?"mini-calendar-menu-selected":s)+'" href="javascript:void(0);" hideFocus onclick="return false">'+n+"</a>"}t+='<div class="mini-calendar-menu-prevYear mini-icon"></div><div class="mini-calendar-menu-nextYear mini-icon"></div><div style="clear:both;"></div></div>',t+='<div class="mini-calendar-footer"><span class="mini-calendar-okButton mini-calendar-button mini-corner-all">'+this.okText+'</span><span class="mini-calendar-footerSpace"></span><span class="mini-calendar-cancelButton mini-calendar-button mini-corner-all">'+this.cancelText+'</span></div><div style="clear:both;"></div>',this.menuEl.innerHTML=t}},__OnMenuClick:function(t){var e=this,i=t.target,n="mini-calendar-menu-month",s="mini-calendar-menu-year",o="mini-calendar-menu-selected";function l(){setTimeout(function(){e.updateMenu()},30)}var r=mini.findParent(i,n),t=mini.findParent(i,s);r?(this._menuselectMonth=parseInt(r.id),jQuery("."+n,e.menuEl).removeClass(o),jQuery(i).parent().find("#"+this._menuselectMonth).addClass(o)):t?(this._menuselectYear=parseInt(t.id),jQuery("."+s,e.menuEl).removeClass(o),jQuery(i).parent().find("#"+this._menuselectYear).addClass(o)):mini.findParent(i,"mini-calendar-menu-prevYear")?(this.menuYear=this.menuYear-1,this.menuYear=10*parseInt(this.menuYear/10),l()):mini.findParent(i,"mini-calendar-menu-nextYear")?(this.menuYear=this.menuYear+11,this.menuYear=10*parseInt(this.menuYear/10),l()):mini.findParent(i,"mini-calendar-okButton")?this.__getMonthYear():mini.findParent(i,"mini-calendar-cancelButton")&&(this.monthPicker?this._OnDateClick(null,"cancel"):this.hideMenu())},__OnMenuDblClick:function(t){var e=mini.findParent(t.target,"mini-calendar-menu-year"),i=mini.findParent(t.target,"mini-calendar-menu-month"),t=mini.findParent(t.target,"mini-calendar-date ");(e||i||t)&&(this.monthPicker&&!i&&!e||this.__getMonthYear())},__getMonthYear:function(){var t=new Date(this._menuselectYear,this._menuselectMonth,1);this.monthPicker?(this.setViewDate(t),this.setSelectedDate(t),this._OnDateClick(t)):(this.setViewDate(t),this.hideMenu())},__OnBodyMenuMouseDown:function(t){mini.findParent(t.target,"mini-calendar-menu")||mini.findParent(t.target,"mini-monthpicker")||this.hideMenu()},__OnClick:function(t){var e,i,n,s=this.viewDate;0!=this.enabled&&(e=t.target,i=mini.findParent(t.target,"mini-calendar-title"),mini.findParent(e,"mini-calendar-monthNext")?(s.setDate(1),s.setMonth(s.getMonth()+1),this.setViewDate(s)):mini.findParent(e,"mini-calendar-yearNext")?(s.setDate(1),s.setFullYear(s.getFullYear()+1),this.setViewDate(s)):mini.findParent(e,"mini-calendar-monthPrev")?(s.setMonth(s.getMonth()-1),this.setViewDate(s)):mini.findParent(e,"mini-calendar-yearPrev")?(s.setFullYear(s.getFullYear()-1),this.setViewDate(s)):mini.findParent(e,"mini-calendar-tadayButton")?(n=!!mini.findParent(e,"yesterday"),s=new Date,n&&s.setDate(s.getDate()-1),this.setViewDate(s),this.setSelectedDate(s),this.currentTime&&(n=new Date,this.setTime(n)),this._OnDateClick(s,"today")):mini.findParent(e,"mini-calendar-clearButton")?(this.setSelectedDate(null),this.setTime(null),this._OnDateClick(null,"clear")):mini.findParent(e,"mini-calendar-okButton")?this._OnDateClick(null,"ok"):i&&this.showMenu(),(t=mini.findParent(t.target,"mini-calendar-date"))&&!mini.hasClass(t,"mini-calendar-disabled")&&(t=t.id.split("$"),-1!=(t=parseInt(t[t.length-1]))&&(t=new Date(t),this._OnDateClick(t))))},__OnMouseDown:function(t){0==this.enabled||(t=mini.findParent(t.target,"mini-calendar-date"))&&!mini.hasClass(t,"mini-calendar-disabled")&&(t=t.id.split("$"),-1!=(t=parseInt(t[t.length-1]))&&(t=new Date(t),this.setSelectedDate(t)))},__OnTimeChanged:function(t){this.fire("timechanged"),this._OnValueChanged()},__OnKeyDown:function(t){if(0!=this.enabled){var e=(e=this.getSelectedDate())||new Date(this.viewDate.getTime());switch(t.keyCode){case 27:break;case 13:return void(e&&this._OnDateClick(e));case 37:e=mini.addDate(e,-1,"D");break;case 38:e=mini.addDate(e,-7,"D");break;case 39:e=mini.addDate(e,1,"D");break;case 40:e=mini.addDate(e,7,"D")}e.getMonth()!=this.viewDate.getMonth()&&(this.setViewDate(mini.cloneDate(e)),this.focus());var i=this.getDateEl(e);i&&mini.hasClass(i,"mini-calendar-disabled")||(this.setSelectedDate(e),37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode||t.preventDefault())}},_OnValueChanged:function(){this.fire("valuechanged")},getAttrs:function(t){var e=mini.Calendar.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["viewDate","rows","columns","ondateclick","ondrawdate","ondatechanged","timeFormat","ontimechanged","onvaluechanged"]),mini._ParseBool(t,e,["multiSelect","showHeader","showFooter","showWeekNumber","showDaysHeader","showMonthButtons","showYearButtons","showTodayButton","showClearButton","showYesterdayButton","showTime","showOkButton"]),e}}),mini.regClass(mini.Calendar,"calendar"),mini.ListBox=function(){mini.ListBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.ListBox,mini.ListControl,{formField:!0,columns:null,columnWidth:80,showNullItem:!1,nullItemText:"",showEmpty:!1,emptyText:"",showCheckBox:!1,showAllCheckBox:!0,multiSelect:!1,_itemCls:"mini-listbox-item",_itemHoverCls:"mini-listbox-item-hover",_itemSelectedCls:"mini-listbox-item-selected",uiCls:"mini-listbox",_create:function(){this.el=document.createElement("div");this.el.className="mini-listbox",this.el.innerHTML='<div class="mini-listbox-border"><div class="mini-listbox-header"></div><div class="mini-listbox-view"></div><input type="hidden"/></div><div class="mini-errorIcon"></div>',this._borderEl=this.el.firstChild,this._headerEl=this._borderEl.firstChild,this._viewEl=this._borderEl.childNodes[1],this._valueEl=this._borderEl.childNodes[2],this._errorIconEl=this.el.lastChild,this._scrollViewEl=this._viewEl,this._viewEl.innerHTML='<div class="mini-grid-rows-content"></div>',this._contentEl=this._viewEl.firstChild},_initEvents:function(){mini.ListBox.superclass._initEvents.call(this),mini._BindEvents(function(){mini_onOne(this._viewEl,"scroll",this.__OnScroll,this)},this)},destroy:function(t){this._viewEl&&(this._viewEl.onscroll=null,mini.clearEvent(this._viewEl),this._viewEl=null),this._borderEl=this._headerEl=this._viewEl=this._valueEl=this._errorIconEl=this._scrollViewEl=this._contentEl=null,mini.ListBox.superclass.destroy.call(this,t)},setColumns:function(t){mini.isArray(t)||(t=[]),this.columns=t;for(var e=0,i=this.columns.length;e<i;e++){var n,s=this.columns[e];s.type&&(mini.isNull(s.header)||"function"==typeof s.header||""==s.header.trim()&&delete s.header,(n=mini._getColumn(s.type))&&(o=mini.copyTo({},s),mini.copyTo(s,n),mini.copyTo(s,o)));var o=parseInt(s.width);mini.isNumber(o)&&String(o)==s.width&&(s.width=o+"px"),mini.isNull(s.width)&&(s.width=this.columnWidth+"px")}this.doUpdate()},isVisibleColumn:function(t){return 0!=(t=this.getColumn(t)).visible},getColumn:function(t){var e=typeof t;if("number"==e)return this.columns[t];if("object"==e)return t;for(var i=0,n=this.columns.length;i<n;i++){var s=this.columns[i];if(s.name==t)return s}return null},hideColumn:function(t){(t=this.getColumn(t))&&(t.visible=!1,this.doUpdate())},showColumn:function(t){(t=this.getColumn(t))&&(t.visible=!0,this.doUpdate())},getColumns:function(){return this.columns},doUpdate:function(){if(!1!==this._allowUpdate){var t=this.columns&&0<this.columns.length;t?mini.addClass(this.el,"mini-listbox-showColumns"):mini.removeClass(this.el,"mini-listbox-showColumns"),this._headerEl.style.display=t?"":"none";var e=[];if(t){e[e.length]='<table class="mini-listbox-headerInner" cellspacing="0" cellpadding="0"><tr>';var i=this.uid+"$ck$all";this.showCheckBox&&(e[e.length]='<td class="mini-listbox-checkbox"><input type="checkbox" id="'+i+'"></td>');for(var n,s=0,o=this.columns.length;s<o;s++)!1!==(g=this.columns[s]).visible&&(n=g.header,mini.isNull(n)&&(n="&nbsp;"),_=g.width,mini.isNumber(_)&&(_+="px"),e[e.length]='<td class="',g.headerCls&&(e[e.length]=g.headerCls),e[e.length]='" style="',g.headerStyle&&(e[e.length]=g.headerStyle+";"),_&&(e[e.length]="width:"+_+";"),g.headerAlign&&(e[e.length]="text-align:"+g.headerAlign+";"),e[e.length]='">',e[e.length]=n,e[e.length]="</td>");e[e.length]="</tr></table>"}this._headerEl.innerHTML=e.join("");var e=[],l=this.data;if(e[e.length]='<table class="mini-listbox-items" cellspacing="0" cellpadding="0">',this.showEmpty&&0==l.length)e[e.length]='<tr><td colspan="20">'+this.emptyText+"</td></tr>";else{this._doNullItem();for(var r=0,a=l.length;r<a;r++){var h,d,u=l[r],c=" ",m=" ";e[e.length]='<tr id="',e[e.length]=this._createItemId(r),e[e.length]='" index="',e[e.length]=r,!(e[e.length]='" class="mini-listbox-item ')===u.enabled&&(e[e.length]=" mini-disabled "),h=e.length,e[e.length]=c,e[e.length]='" style="',d=e.length,e[e.length]=m,e[e.length]='">';var f=this._createCheckId(r),p=(this.name,this.getItemValue(u),"");if(!1===u.enabled&&(p="disabled"),this.showCheckBox&&(!0===u.__NullItem?e[e.length]='<td class="mini-listbox-checkbox"></td>':e[e.length]='<td class="mini-listbox-checkbox"><input '+p+' id="'+f+'" type="checkbox" ></td>'),t)for(var g,_,s=0,o=this.columns.length;s<o;s++)!1!==(g=this.columns[s]).visible&&(v=this._OnDrawCell(u,r,g),"number"==typeof(_=g.width)&&(_+="px"),e[e.length]='<td class="',v.cellCls&&(e[e.length]=v.cellCls),e[e.length]='" style="',v.cellStyle&&(e[e.length]=v.cellStyle+";"),_&&(e[e.length]="width:"+_+";"),g.align&&(e[e.length]="text-align:"+g.align+";"),e[e.length]='">',e[e.length]=v.cellHtml,e[e.length]="</td>",v.rowCls&&(c=v.rowCls),v.rowStyle&&(m=v.rowStyle));else{var v=this._OnDrawCell(u,r,null);e[e.length]='<td class="',v.cellCls&&(e[e.length]=v.cellCls),e[e.length]='" style="',v.cellStyle&&(e[e.length]=v.cellStyle),e[e.length]='">',e[e.length]=v.cellHtml,e[e.length]="</td>",v.rowCls&&(c=v.rowCls),v.rowStyle&&(m=v.rowStyle)}e[h]=c,e[d]=m,e[e.length]="</tr>"}}e[e.length]="</table>";i=e.join("");this._viewEl.firstChild.innerHTML=i,this._doSelects(),this.doLayout()}},doLayout:function(t){this.columns&&0<this.columns.length?mini.addClass(this.el,"mini-listbox-showcolumns"):mini.removeClass(this.el,"mini-listbox-showcolumns"),this.showCheckBox?mini.removeClass(this.el,"mini-listbox-hideCheckBox"):mini.addClass(this.el,"mini-listbox-hideCheckBox");var e=this.uid+"$ck$all",i=document.getElementById(e);i&&(i.style.display=this.showAllCheckBox?"":"none");var n=this._viewEl;this.isAutoHeight()&&(n.style.height="auto");var s=this.getHeight(!0),o=mini.getWidth(this._borderEl,!0),e=o;mini.isIE6||(n.style.width=o+"px");i=mini.getHeight(this._headerEl);n.style.height=(s=(s-=i)<0?0:s)+"px",isIE&&(i=this._headerEl.firstChild,s=this._viewEl.firstChild.firstChild,this._viewEl.offsetHeight>=this._viewEl.scrollHeight?(s&&(s.style.width="100%"),i&&(i.style.width="100%")):(o=parseInt(s.parentNode.offsetWidth)+"px",i&&(i.style.width=o))),this._viewEl.offsetHeight<this._viewEl.scrollHeight?(o=e-(jQuery(this._viewEl).width()-jQuery(this._contentEl).width()),this._headerEl.style.width=(o=o<0?0:o)+"px"):this._headerEl.style.width="100%"},setShowCheckBox:function(t){this.showCheckBox=t,this.doUpdate()},getShowCheckBox:function(){return this.showCheckBox},setShowAllCheckBox:function(t){this.showAllCheckBox=t,this.doLayout()},getShowAllCheckBox:function(){return this.showAllCheckBox},setShowNullItem:function(t){this.showNullItem!=t&&(this.showNullItem=t,this._doNullItem(),this.doUpdate())},getShowNullItem:function(){return this.showNullItem},setNullItemText:function(t){this.nullItemText!=t&&(this.nullItemText=t,this._doNullItem(),this.doUpdate())},getNullItemText:function(){return this.nullItemText},_doNullItem:function(){for(var t,e=0,i=this.data.length;e<i;e++)if((t=this.data[e]).__NullItem){this.data.removeAt(e);break}this.showNullItem&&((t={__NullItem:!0})[this.textField]="",t[this.valueField]="",this.data.insert(0,t))},_OnDrawCell:function(t,e,i){var n=i?mini._getMap(i.field,t):this.getItemText(t),t={sender:this,index:e,rowIndex:e,record:t,item:t,column:i,field:i?i.field:null,value:n,cellHtml:n,rowCls:null,cellCls:i&&i.cellCls||"",rowStyle:null,cellStyle:i&&i.cellStyle||""};return this.columns&&0<this.columns.length||0==e&&this.showNullItem&&(t.cellHtml=this.nullItemText),1==t.autoEscape&&(t.cellHtml=mini.htmlEncode(t.cellHtml)),i&&(i.dateFormat&&(mini.isDate(t.value)?t.cellHtml=mini.formatDate(n,i.dateFormat):t.cellHtml=n),(n=i.renderer)&&(fn="function"==typeof n?n:window[n],fn&&(t.cellHtml=fn.call(i,t)))),this.fire("drawcell",t),null!==t.cellHtml&&t.cellHtml!==undefined&&""!==t.cellHtml||(t.cellHtml="&nbsp;"),t},__OnScroll:function(t){this._headerEl.scrollLeft=this._viewEl.scrollLeft},__OnClick:function(t){var e,i=this.uid+"$ck$all";t.target.id!=i?this._fireEvent(t,"Click"):(e=document.getElementById(i))&&(i=e.checked,e=this.getValue(),this._oldValue=e,i?this.selectAll():this.deselectAll(),this._OnSelectionChanged(),e!=this.getValue()&&(this._OnValueChanged(),this.fire("itemclick",{htmlEvent:t})))},setValue:function(t){mini.ListBox.superclass.setValue.call(this,t),this._doCheckState()},_doCheckState:function(){var t=this.uid+"$ck$all",t=jQuery(document.getElementById(t));this._isSelectedAll()&&0!=this.getSelecteds().length?t.prop?t.prop("checked",!0):t.attr("checked",!0):t.prop?t.prop("checked",!1):t.attr("checked",!1)},_OnValueChanged:function(t){mini.ListBox.superclass._OnValueChanged.call(this),this._doCheckState()},getAttrs:function(t){var e=mini.ListBox.superclass.getAttrs.call(this,t);if(mini._ParseString(t,e,["nullItemText","ondrawcell"]),mini._ParseBool(t,e,["showCheckBox","showAllCheckBox","showNullItem"]),"select"!=t.nodeName.toLowerCase())for(var i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],l=jQuery(o).attr("property");l&&("columns"==(l=l.toLowerCase())?e.columns=mini._ParseColumns(o):"data"==l&&(e.data=o.innerHTML))}return e}}),mini.regClass(mini.ListBox,"listbox"),mini.CheckBoxList=function(){mini.CheckBoxList.superclass.constructor.apply(this,arguments)},mini.extend(mini.CheckBoxList,mini.ListControl,{formField:!0,_labelFieldCls:"mini-labelfield-checkboxlist",multiSelect:!0,repeatItems:0,repeatLayout:"none",repeatDirection:"horizontal",_itemCls:"mini-checkboxlist-item",_itemHoverCls:"mini-checkboxlist-item-hover",_itemSelectedCls:"mini-checkboxlist-item-selected",_tableCls:"mini-checkboxlist-table",_tdCls:"mini-checkboxlist-td",_checkType:"checkbox",uiCls:"mini-checkboxlist",_create:function(){var t=this.el=document.createElement("div");this.el.className=this.uiCls,this.el.innerHTML='<table cellpadding="0" border="0" cellspacing="0" style="display:table;"><tr><td><div class="mini-list-inner"></div><div class="mini-errorIcon"></div><input type="hidden" /></td></tr></table>',this.cellEl=t.getElementsByTagName("td")[0],this._innerEl=this.cellEl.firstChild,this._valueEl=this.cellEl.lastChild,this._errorIconEl=this.cellEl.childNodes[1],this._borderEl=this.el.firstChild;mini.on(this.el,"keyup",function(t){32==t.keyCode&&$(t.target).click()})},_getRepeatTable:function(){var t=[];if(0<this.repeatItems)if("horizontal"==this.repeatDirection){for(var e=[],i=0,n=this.data.length;i<n;i++){var s=this.data[i];e.length==this.repeatItems&&(t.push(e),e=[]),e.push(s)}t.push(e)}else{for(i=0,n=this.repeatItems>this.data.length?this.data.length:this.repeatItems;i<n;i++)t.push([]);for(i=0,n=this.data.length;i<n;i++){s=this.data[i];t[i%this.repeatItems].push(s)}}else t=[this.data.clone()];return t},doUpdate:function(){for(var t=this.data,e="",i=0,n=t.length;i<n;i++)(l=t[i])._i=i;if("flow"==this.repeatLayout)for(i=0,n=(r=this._getRepeatTable()).length;i<n;i++){for(var s=0,o=(a=r[i]).length;s<o;s++){var l=a[s];e+=this._createItemHtml(l,l._i)}i!=n-1&&(e+="<br/>")}else if("table"==this.repeatLayout){var r=this._getRepeatTable();e+='<table class="'+this._tableCls+'" cellpadding="0" cellspacing="1">';for(var a,i=0,n=r.length;i<n;i++){e+="<tr>";for(s=0,o=(a=r[i]).length;s<o;s++){l=a[s];e+='<td class="'+this._tdCls+'">',e+=this._createItemHtml(l,l._i),e+="</td>"}e+="</tr>"}e+="</table>"}else for(i=0,n=t.length;i<n;i++){l=t[i];e+=this._createItemHtml(l,i)}this._innerEl.innerHTML=e;for(i=0,n=t.length;i<n;i++)delete(l=t[i])._i},_createItemHtml:function(t,e){var i=this._OnDrawItem(t,e),n=this._createItemId(e),s=this._createCheckId(e),o=this.getItemValue(t),l="",e='<div id="'+n+'" index="'+e+'" class="'+this._itemCls+" ";!1===t.enabled&&(e+=" mini-disabled ",l="disabled");return e+=i.itemCls+'" style="'+i.itemStyle+'"><span tabIndex="0" class="mini-list-icon mini-icon"></span><input style="display:none;" onmousedown="this._checked = this.checked;" onclick="this.checked = this._checked" '+l+' value="'+o+'" id="'+s+'" type="'+this._checkType+'" /><label for="'+s+'" onclick="return false;">',e+=i.itemHtml+"</label></div>"},_OnDrawItem:function(t,e){t={index:e,item:t,itemHtml:this.getItemText(t),itemCls:"",itemStyle:""};return this.fire("drawitem",t),null!==t.itemHtml&&t.itemHtml!==undefined||(t.itemHtml=""),t},setRepeatItems:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.repeatItems!=t&&(this.repeatItems=t,this.doUpdate())},getRepeatItems:function(){return this.repeatItems},setRepeatLayout:function(t){this.repeatLayout!=(t="flow"!=t&&"table"!=t?"none":t)&&(this.repeatLayout=t,this.doUpdate())},getRepeatLayout:function(){return this.repeatLayout},setRepeatDirection:function(t){this.repeatDirection!=(t="vertical"!=t?"horizontal":t)&&(this.repeatDirection=t,this.doUpdate())},getRepeatDirection:function(){return this.repeatDirection},getAttrs:function(t){var e=mini.CheckBoxList.superclass.getAttrs.call(this,t),i=jQuery(t);mini._ParseString(t,e,["ondrawitem"]);t=parseInt(i.attr("repeatItems"));isNaN(t)||(e.repeatItems=t);t=i.attr("repeatLayout");t&&(e.repeatLayout=t);i=i.attr("repeatDirection");return i&&(e.repeatDirection=i),e}}),mini.regClass(mini.CheckBoxList,"checkboxlist"),mini.RadioButtonList=function(){mini.RadioButtonList.superclass.constructor.apply(this,arguments)},mini.extend(mini.RadioButtonList,mini.CheckBoxList,{multiSelect:!1,_itemCls:"mini-radiobuttonlist-item",_itemHoverCls:"mini-radiobuttonlist-item-hover",_itemSelectedCls:"mini-radiobuttonlist-item-selected",_tableCls:"mini-radiobuttonlist-table",_tdCls:"mini-radiobuttonlist-td",_checkType:"radio",uiCls:"mini-radiobuttonlist"}),mini.regClass(mini.RadioButtonList,"radiobuttonlist"),mini.Spinner=function(){mini.Spinner.superclass.constructor.apply(this,arguments),this.setValue(this.minValue)},mini.extend(mini.Spinner,mini.ButtonEdit,{value:0,minValue:0,maxValue:100,increment:1,decimalPlaces:-1,changeOnMousewheel:!0,allowLimitValue:!0,allowLoopValue:!1,allowNull:!1,set:function(t){if("string"==typeof t)return this;var e=t.value;return delete t.value,mini.Spinner.superclass.set.call(this,t),mini.isNull(e)||this.setValue(e),this},uiCls:"mini-spinner",_getButtonHtml:function(){return'<span name="trigger" class="mini-buttonedit-button mini-buttonedit-trigger" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-up"><span class="mini-icon"></span></span><span class="mini-buttonedit-down"><span class="mini-icon"></span></span></span>'},_initEvents:function(){mini.Spinner.superclass._initEvents.call(this),mini._BindEvents(function(){this.on("buttonmousedown",this.__OnButtonMouseDown,this),mini.on(this.el,"mousewheel",this.__OnMousewheel,this)},this)},_ValueLimit:function(){0!=this.allowLimitValue&&(mini.isNull(this.value)&&this.allowNull||(this.minValue>this.maxValue&&(this.maxValue=this.minValue+100),this.value<this.minValue&&this.setValue(this.minValue),this.value>this.maxValue&&this.setValue(this.maxValue)))},getFormValue:function(){var t=this.value,t=parseFloat(t);if(this.allowNull&&isNaN(t))return"";isNaN(t)&&(t=0);var e=String(t).split("."),t=e[0],i=(i=e[1])||"";if(0<this.decimalPlaces){for(var n=i.length,s=this.decimalPlaces;n<s;n++)i+="0";i="."+i}else i=i&&"."+i;return t+i},setValue:function(t){t=mini.parseFloat(t,this.culture,this.format),t=parseFloat(t),isNaN(t)&&!this.allowNull&&(t=this.minValue),(t=isNaN(t)&&this.allowNull?null:t)&&0<=this.decimalPlaces&&(t=parseFloat(t.toFixed(this.decimalPlaces))),this.value!=t&&(this.value=t,this._ValueLimit(),this._valueEl.value=this.value),this.text=this._textEl.value=this.getFormatValue()},setMaxValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.maxValue!=t&&(this.maxValue=t,this._ValueLimit()))},getMaxValue:function(t){return this.maxValue},setMinValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.minValue!=t&&(this.minValue=t,this._ValueLimit()))},getMinValue:function(t){return this.minValue},setIncrement:function(t){t=parseFloat(t),isNaN(t)||this.increment!=t&&(this.increment=t)},getIncrement:function(t){return this.increment},setDecimalPlaces:function(t){t=parseInt(t),isNaN(t)||t<0||(this.decimalPlaces=t)},getDecimalPlaces:function(t){return this.decimalPlaces},setChangeOnMousewheel:function(t){this.changeOnMousewheel=t},getChangeOnMousewheel:function(t){return this.changeOnMousewheel},setAllowLimitValue:function(t){this.allowLimitValue=t},getAllowLimitValue:function(t){return this.allowLimitValue},setAllowNull:function(t){this.allowNull=t},getAllowNull:function(t){return this.allowNull},format:"",setFormat:function(t){"string"==typeof t&&this.format!=t&&(this.format=t,this.setText(this.getFormatValue()))},getFormat:function(){return this.format},getFormatValue:function(){return mini.isNull(this.value)?"":this.format&&mini.isNumber(this.value)?mini.formatNumber(this.value,this.format,this.culture):this.value},setAllowLoopValue:function(t){this.allowLoopValue=t},getAllowLoopValue:function(){return this.allowLoopValue},_SpinTimer:null,_StartSpin:function(e,i,n){this._StopSpin();var s=this;function o(t){0<e?t>s.maxValue&&s.setValue(s.minValue):t<s.minValue&&s.setValue(s.maxValue)}var t=(1e6*this.value+1e6*e)/1e6;this.setValue(t),s.allowLoopValue&&o(t);var l=n,r=new Date;this._SpinTimer=setInterval(function(){var t=s.value+e;s.setValue(t),s.allowLoopValue&&o(t),s._OnValueChanged(),0==--n&&50<i&&s._StartSpin(e,i-100,l+3);t=new Date;500<t-r&&s._StopSpin(),r=t},i),mini.on(document,"mouseup",this._OnDocumentMouseUp,this)},_StopSpin:function(){clearInterval(this._SpinTimer),this._SpinTimer=null},__OnButtonMouseDown:function(t){this._DownValue=this.getValue(),this.__OnInputTextChanged(),"up"==t.spinType?this._StartSpin(this.increment,230,2):this._StartSpin(-this.increment,230,2)},__OnInputKeyDown:function(t){mini.Spinner.superclass.__OnInputKeyDown.call(this,t);var e=mini.Keyboard;if(!this.isReadOnly())switch(t.keyCode){case e.Top:this.keyNavEnabled&&(this.setValue(this.value+this.increment),this._OnValueChanged());break;case e.Bottom:this.keyNavEnabled&&(this.setValue(this.value-this.increment),this._OnValueChanged())}},__OnMousewheel:function(t){if(!this.isReadOnly()&&0!=this.changeOnMousewheel){this.text!=this._textEl.value&&this.__OnInputTextChanged();var e=t.wheelDelta||t.originalEvent.wheelDelta;mini.isNull(e)&&(e=24*-t.originalEvent.detail);var i=this.increment,t=1e6*this.value;return this.setValue((t+1e6*(i=e<0?-i:i))/1e6),this._OnValueChanged(),!1}},_OnDocumentMouseUp:function(t){this._StopSpin(),mini.un(document,"mouseup",this._OnDocumentMouseUp,this),this._DownValue!=this.getValue()&&this._OnValueChanged()},__OnInputTextChanged:function(t){var e=this.getValue(),i=mini.parseFloat(this._textEl.value,this.culture,this.format);this.setValue(i),e!=this.getValue()&&this._OnValueChanged()},getAttrs:function(t){var e=mini.Spinner.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["minValue","maxValue","increment","decimalPlaces","format"]),mini._ParseBool(t,e,["allowLimitValue","allowNull","changeOnMousewheel","allowLoopValue"]),e}}),mini.regClass(mini.Spinner,"spinner"),mini.TimeSpinner=function(){mini.TimeSpinner.superclass.constructor.apply(this,arguments),this.setValue("00:00:00")},mini.extend(mini.TimeSpinner,mini.ButtonEdit,{value:null,format:"H:mm:ss",uiCls:"mini-timespinner",_getButtonHtml:function(){return'<span class="mini-buttonedit-button" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-up"><span class="mini-icon"></span></span><span class="mini-buttonedit-down"><span class="mini-icon"></span></span></span>'},_initEvents:function(){mini.TimeSpinner.superclass._initEvents.call(this),mini._BindEvents(function(){this.on("buttonmousedown",this.__OnButtonMouseDown,this),mini.on(this.el,"mousewheel",this.__OnMousewheel,this),mini.on(this._textEl,"keydown",this.__OnKeyDown,this)},this)},setFormat:function(t){"string"!=typeof t||this.format!=t&&(this.format=t,this.text=this._textEl.value=this.getFormattedValue())},getFormat:function(){return this.format},setValue:function(t){t=(t=mini.parseTime(t,this.format))||null,mini.isDate(t)&&(t=new Date(t.getTime())),this.value=t,this.text=this._textEl.value=this.getFormattedValue(),this._valueEl.value=this.getFormValue()},getValue:function(){return null==this.value?null:new Date(this.value.getTime())},getFormValue:function(){return this.value?mini.formatDate(this.value,this.format):""},getFormattedValue:function(){return this.value?mini.formatDate(this.value,this.format):""},_ChangeValue:function(t,e){var i=this.getValue();if(i)switch(e){case"hours":var n=i.getHours()+t;i.setHours(n=(n=23<n?23:n)<0?0:n);break;case"minutes":var s=i.getMinutes()+t;i.setMinutes(s=(s=59<s?59:s)<0?0:s);break;case"seconds":s=i.getSeconds()+t;i.setSeconds(s=(s=59<s?59:s)<0?0:s)}else i="00:00:00";this.setValue(i)},_SpinTimer:null,_StartSpin:function(e,i,n){this._StopSpin(),this._ChangeValue(e,this._timeType);var s=this,o=n,l=new Date;this._SpinTimer=setInterval(function(){s._ChangeValue(e,s._timeType),0==--n&&50<i&&s._StartSpin(e,i-100,o+3);var t=new Date;500<t-l&&s._StopSpin(),l=t},i),mini.on(document,"mouseup",this._OnDocumentMouseUp,this)},_StopSpin:function(){clearInterval(this._SpinTimer),this._SpinTimer=null},__OnButtonMouseDown:function(t){this._DownValue=this.getFormValue(),this._timeType="hours","up"==t.spinType?this._StartSpin(1,230,2):this._StartSpin(-1,230,2)},_OnDocumentMouseUp:function(t){this._StopSpin(),mini.un(document,"mouseup",this._OnDocumentMouseUp,this),this._DownValue!=this.getFormValue()&&this._OnValueChanged()},__OnInputTextChanged:function(t){var e=this.getFormValue();this.setValue(this._textEl.value),e!=this.getFormValue()&&this._OnValueChanged()},getAttrs:function(t){var e=mini.TimeSpinner.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["format"]),e}}),mini.regClass(mini.TimeSpinner,"timespinner"),mini.Lookup=function(){this.data=[],mini.Lookup.superclass.constructor.apply(this,arguments),mini.on(this._textEl,"mouseup",this.__OnMouseUp,this),this.on("showpopup",this.__OnShowPopup,this)},mini.extend(mini.Lookup,mini.PopupEdit,{allowInput:!0,valueField:"id",textField:"text",delimiter:",",setDelimiter:function(t){this.delimiter=t},getDelimiter:function(){return this.delimiter},multiSelect:!1,data:[],grid:null,_destroyPopup:!1,uiCls:"mini-lookup",destroy:function(t){this.grid&&(this.grid.un("rowclick",this.__OnGridRowClickChanged,this),this.grid.un("load",this.__OnGridLoad,this),this.grid.un("checkall",this.__OnGridRowClickChanged,this),this.grid=null),mini.Lookup.superclass.destroy.call(this,t)},setMultiSelect:function(t){this.multiSelect=t,this.grid&&this.grid.setMultiSelect(t)},setGrid:function(t){"string"==typeof t&&(mini.parse(t),t=mini.get(t)),this.grid=mini.getAndCreate(t),this.grid&&(this.grid.setMultiSelect(this.multiSelect),this.grid.setCheckSelectOnLoad(!1),this.grid.on("rowclick",this.__OnGridRowClickChanged,this),this.grid.on("load",this.__OnGridLoad,this),this.grid.on("checkall",this.__OnGridRowClickChanged,this))},getGrid:function(){return this.grid},setValueField:function(t){this.valueField=t},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},deselectAll:function(){this.data=[],this.setValue(""),this.setText(""),this.grid&&this.grid.deselectAll()},getItemValue:function(t){return String(t[this.valueField])},getItemText:function(t){t=t[this.textField];return mini.isNull(t)?"":String(t)},getValueAndText:function(t){for(var e=[],i=[],n=0,s=(t=mini.isNull(t)?[]:t).length;n<s;n++){var o=t[n];o&&(e.push(this.getItemValue(o)),i.push(this.getItemText(o)))}return[e.join(this.delimiter),i.join(this.delimiter)]},_createData:function(){this.value=mini.isNull(this.value)?"":String(this.value),this.text=mini.isNull(this.text)?"":String(this.text);var t=[],e=this.value.split(this.delimiter),i=this.text.split(this.delimiter),n=e.length;if(this.value)for(var s=0,o=n;s<o;s++){var l={},r=e[s],a=i[s];l[this.valueField]=r||"",l[this.textField]=a||"",t.push(l)}this.data=t},_getValueMaps:function(t){for(var e={},i=0,n=t.length;i<n;i++){var s=t[i];e[s[this.valueField]]=s}return e},setValue:function(t){mini.Lookup.superclass.setValue.call(this,t),this._createData()},setText:function(t){mini.Lookup.superclass.setText.call(this,t),this._createData()},__OnGridRowClickChanged:function(t){var i=this.grid,e=this._getValueMaps(i.getList()),n=this._getValueMaps(i.getSelecteds()),s=this._getValueMaps(this.data);0==this.multiSelect&&(s={},this.data=[]);var o={};for(a in s){var l=s[a];e[a]&&(n[a]||(o[a]=l))}for(var r=this.data.length-1;0<=r;r--)o[a=(l=this.data[r])[this.valueField]]&&this.data.removeAt(r);var a,h=[];for(a in n){l=n[a];s[a]||h.push(l)}h.sort(function(t,e){t=i.indexOf(t),e=i.indexOf(e);return t<e?-1:t==e?0:1}),this.data.addRange(h);var d=this.getValueAndText(this.data);this.setValue(d[0]),this.setText(d[1]),this._OnValueChanged()},__OnGridLoad:function(t){this.__OnShowPopup(t)},__OnShowPopup:function(t){for(var e=String(this.value).split(this.delimiter),i={},n=0,s=e.length;n<s;n++)i[e[n]]=1;for(var o=this.grid.getData(),l=[],n=0,s=o.length;n<s;n++){var r=o[n];i[r[this.valueField]]&&l.push(r)}this.grid.selects(l)},doUpdate:function(){mini.Lookup.superclass.doUpdate.call(this),this._textEl.readOnly=!0,this.el.style.cursor="default"},__OnInputKeyDown:function(t){mini.Lookup.superclass.__OnInputKeyDown.call(this,t),t.keyCode},__OnMouseUp:function(t){var e,i;this.isReadOnly()||(i=(e=mini.getSelectRange(this._textEl))[0],e[1],this._findTextIndex(i))},_findTextIndex:function(t){var e=-1;if(""==this.text)return e;for(var i=String(this.text).split(this.delimiter),n=0,s=0,o=i.length;s<o;s++){var l=i[s];if(n<t&&t<=n+l.length){e=s;break}n=n+l.length+1}return e},getAttrs:function(t){var e=mini.Lookup.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["grid","valueField","textField","delimiter"]),mini._ParseBool(t,e,["multiSelect"]),e}}),mini.regClass(mini.Lookup,"lookup"),mini.TextBoxList=function(t){mini.TextBoxList.superclass.constructor.call(this,null),this.data=[],this.selecteds=[],this.doUpdate(),t&&mini.applyTo.call(this,t)},mini.extend(mini.TextBoxList,mini.ValidatorBase,{formField:!0,remote:!0,value:"",text:"",valueField:"id",textField:"text",selecteds:null,data:null,url:"",delay:150,allowInput:!0,editIndex:0,_focusCls:"mini-textboxlist-focus",_itemHoverClass:"mini-textboxlist-item-hover",_itemSelectedClass:"mini-textboxlist-item-selected",_closeHoverClass:"mini-textboxlist-close-hover",textName:"",setTextName:function(t){this.textName=t},getTextName:function(){return this.textName},getData:function(){return this.data},setData:function(t){this.data=t},getRemote:function(){return this.remote},setRemote:function(t){this.remote=t},uiCls:"mini-textboxlist",_create:function(){var t=document.createElement("div");t.innerHTML='<table class="mini-textboxlist mini-corner-all" cellpadding="0" cellspacing="0"><tr ><td class="mini-textboxlist-border mini-corner-all"><ul></ul><a href="#"></a><input type="hidden"/></td></tr></table>',this.el=t.firstChild;t=this.el.getElementsByTagName("td")[0];this.ulEl=t.firstChild,this._valueEl=t.lastChild,this.focusEl=t.childNodes[1]},destroy:function(t){this.isShowPopup&&this.hidePopup(),this._inputEl&&(mini.clearEvent(this._inputEl),this._inputEl.onkeyup=null,this._inputEl.onfocus=null,this._inputEl.onblur=null),mini.un(document,"mousedown",this.__OnDocMouseDown,this),mini.TextBoxList.superclass.destroy.call(this,t)},_initEvents:function(){mini.TextBoxList.superclass._initEvents.call(this),mini.on(this.el,"mousemove",this.__OnMouseMove,this),mini.on(this.el,"mouseout",this.__OnMouseOut,this),mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"keydown",this.__OnKeyDown,this),mini.on(document,"mousedown",this.__OnDocMouseDown,this)},__OnDocMouseDown:function(t){var e;this.isReadOnly()||(this.isShowPopup&&(mini.isAncestor(this.popup.el,t.target)||this.hidePopup()),(e=this)._focused&&0==this.within(t)&&(clearInterval(this._ValueChangeTimer),this.select(null,!1),setTimeout(function(){e.showInput(!1)},100),this.removeCls(this._focusCls),this._focused=!1))},errorIconEl:null,getErrorIconEl:function(){var t;return this._errorIconEl||((t=this.el.rows[0].insertCell(1)).style.cssText="width:18px;vertical-align:top;",t.innerHTML='<div class="mini-errorIcon"></div>',this._errorIconEl=t.firstChild),this._errorIconEl},_RemoveErrorIcon:function(){this._errorIconEl&&jQuery(this._errorIconEl.parentNode).remove(),this._errorIconEl=null},doLayout:function(){0!=this.canLayout()&&(mini.TextBoxList.superclass.doLayout.call(this),this.doReadOnly())},doReadOnly:function(){this.isReadOnly()||0==this.allowInput?this._inputEl.readOnly=!0:this._inputEl.readOnly=!1},doUpdate:function(){this._ValueChangeTimer&&clearInterval(this._ValueChangeTimer),this._inputEl&&mini.un(this._inputEl,"keydown",this.__OnInputKeyDown,this);for(var t=[],e=this.uid,i=0,n=this.selecteds.length;i<n;i++){var s=this.selecteds[i],o=e+"$text$"+i,s=mini._getMap(this.textField,s);mini.isNull(s)&&(s=""),t[t.length]='<li id="'+o+'" class="mini-textboxlist-item">',t[t.length]=s,t[t.length]='<span class="mini-textboxlist-close"></span></li>'}t[t.length]='<li id="'+(e+"$input")+'" class="mini-textboxlist-inputLi"><input class="mini-textboxlist-input" type="text" autocomplete="off"></li>',this.ulEl.innerHTML=t.join(""),this.editIndex=this.selecteds.length,this.editIndex<0&&(this.editIndex=0),this.inputLi=this.ulEl.lastChild,this._inputEl=this.inputLi.firstChild,this._inputEl.placeholder=this.placeholder,mini.on(this._inputEl,"keydown",this.__OnInputKeyDown,this);var l=this;this._inputEl.onkeyup=function(){l._syncInputSize()},l._ValueChangeTimer=null,l._LastInputText=l._inputEl.value,this._inputEl.onfocus=function(){l._LastInputText=l._inputEl.value,l._ValueChangeTimer=setInterval(function(){return l._focused?void(l._LastInputText!=l._inputEl.value&&(l._startQuery(),l._LastInputText=l._inputEl.value)):(clearInterval(l._ValueChangeTimer),void(l._ValueChangeTimer=null))},10),l.addCls(l._focusCls),l._focused=!0,l.fire("focus")},this._inputEl.onblur=function(){clearInterval(l._ValueChangeTimer),l._ValueChangeTimer=null,l.fire("blur"),l.validateOnLeave&&l.isEditable()&&l._tryValidate()},this.doReadOnly()},getItemByEvent:function(t){t=mini.findParent(t.target,"mini-textboxlist-item");if(t){t=t.id.split("$"),t=t[t.length-1];return this.selecteds[t]}},getItem:function(t){return"number"==typeof t?this.selecteds[t]:"object"==typeof t?t:void 0},getItemEl:function(t){t=this.selecteds.indexOf(t),t=this.uid+"$text$"+t;return document.getElementById(t)},hoverItem:function(t,e){this.isReadOnly()||0==this.enabled||(this.blurItem(),t=this.getItemEl(t),mini.addClass(t,this._itemHoverClass),e&&mini.hasClass(e.target,"mini-textboxlist-close")&&mini.addClass(e.target,this._closeHoverClass))},blurItem:function(){for(var t=0,e=this.selecteds.length;t<e;t++){var i=this.selecteds[t],i=this.getItemEl(i);i&&(mini.removeClass(i,this._itemHoverClass),mini.removeClass(i.lastChild,this._closeHoverClass))}},showInput:function(t){this.select(null),mini.isNumber(t)?this.editIndex=t:this.editIndex=this.selecteds.length,this.editIndex<0&&(this.editIndex=0),this.editIndex>this.selecteds.length&&(this.editIndex=this.selecteds.length);var i,n=this.inputLi;return n.style.display="block",mini.isNumber(t)&&t<this.selecteds.length?(i=this.selecteds[t],i=this.getItemEl(i),jQuery(i).before(n)):this.ulEl.appendChild(n),!1!==t?setTimeout(function(){try{n.firstChild.focus(),mini.selectRange(n.firstChild,100)}catch(e){}},10):(this.lastInputText="",this._inputEl.value=""),n},select:function(t){var e;t=this.getItem(t),this._selected&&(e=this.getItemEl(this._selected),mini.removeClass(e,this._itemSelectedClass)),this._selected=t,this._selected&&(e=this.getItemEl(this._selected),mini.addClass(e,this._itemSelectedClass));var i;this._selected&&(this.focusEl.focus(),i=this,setTimeout(function(){try{i.focusEl.focus()}catch(ex){}},50)),this._selected&&(this.addCls(this._focusCls),this._focused=!0)},_doInsertInputValue:function(){var t=this.getInputText(),e={};e[this.textField]=t,e[this.valueField]=t;t=this.editIndex;this.insertItem(t,e)},_doInsertSelectValue:function(){var t,e;0!=this._listbox.getData().length&&(t=this._listbox.getSelected(),e=this.editIndex,t&&(t=mini.clone(t),this.insertItem(e,t)))},insertItem:function(t,e){this.selecteds.insert(t,e);var i=this.getText(),e=this.getValue();this.setValue(e,!1),this.setText(i,!1),this._createSelecteds(),this.doUpdate(),this.showInput(t+1),this._OnValueChanged()},removeItem:function(t){var e;t&&(e=this.getItemEl(t),mini.removeNode(e),this.selecteds.remove(t),e=this.getText(),t=this.getValue(),this.setValue(t,!1),this.setText(e,!1),this._OnValueChanged())},_createSelecteds:function(){for(var t=(this.text||"").split(","),e=(this.value||"").split(","),i=(e=""==e[0]?[]:e).length,n=0,s=this.selecteds.length=i;n<s;n++){var o=this.selecteds[n];o||(this.selecteds[n]=o={});var l=mini.isNull(t[n])?"":t[n],r=mini.isNull(e[n])?"":e[n];mini._setMap(this.textField,l,o),mini._setMap(this.valueField,r,o)}this.value=this.getValue(),this.text=this.getText()},getInputText:function(){return this._inputEl?this._inputEl.value:""},getText:function(){for(var t=[],e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e],n=mini._getMap(this.textField,n),n=(n=mini.isNull(n)?"":n).replace(",","，");t.push(n)}return t.join(",")},getValue:function(){for(var t=[],e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e],n=mini._getMap(this.valueField,n);t.push(n)}return t.join(",")},getFormValue:function(){var t=this.value;return null!==t&&t!==undefined||(t=""),String(t)},setName:function(t){this.name!=t&&(this.name=t,this._valueEl.name=t)},setValue:function(t){mini.isNull(t)&&(t=""),this.value!=t&&(this.value=t,this._valueEl.value=t,this._createSelecteds(),this.doUpdate())},setText:function(t){mini.isNull(t)&&(t=""),this.text!==t&&(this.text=t,this._createSelecteds(),this.doUpdate())},setValueField:function(t){this.valueField=t,this._createSelecteds()},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t,this._createSelecteds()},getTextField:function(){return this.textField},setAllowInput:function(t){this.allowInput=t,this.doLayout()},getAllowInput:function(){return this.allowInput},setUrl:function(t){this.url=t},getUrl:function(){return this.url},setPopupHeight:function(t){this.popupHeight=t},getPopupHeight:function(){return this.popupHeight},setPopupMinHeight:function(t){this.popupMinHeight=t},getPopupMinHeight:function(){return this.popupMinHeight},setPopupMaxHeight:function(t){this.popupMaxHeight=t},getPopupMaxHeight:function(){return this.popupMaxHeight},valueFromSelect:!0,setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},doQuery:function(){this._startQuery(!0)},_syncInputSize:function(){var t,e;0!=this.isDisplay()&&(t=this.getInputText(),t=20<(e=mini.measureText(this._inputEl,t)).width?e.width+4:20,e=mini.getWidth(this.el,!0),this._inputEl.style.width=(t=e-15<t?e-15:t)+"px")},inputMode:!1,setIputMode:function(t){this.inputMode=t},getIputMode:function(){return this.inputMode},_startQuery:function(t){var e=this;this.inputMode||(setTimeout(function(){e._syncInputSize()},1),this.showPopup("loading"),this._stopQuery(),this._loading=!0,this.delayTimer=setTimeout(function(){e._inputEl.value;e._doQuery()},this.delay))},ajaxDataType:"text",ajaxContentType:"application/x-www-form-urlencoded; charset=UTF-8",_getSelectedMap:function(){for(var t={},e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e];t[n[this.valueField]]=n[this.textField]}return t},_getFilterLocalData:function(t){var e=[],i=this._getSelectedMap();t=(t||"").toLowerCase();for(var n=0,s=this.data.length;n<s;n++){var o,l=this.data[n];i[l[this.valueField]]||(o=l[this.textField],t&&-1==String(o).toLowerCase().indexOf(t)||e.push(l))}return e},_doQuery:function(){if(0!=this.isDisplay()){var t=this.getInputText(),s=this;if(!s.remote){var e=this._getFilterLocalData(t);return s._listbox.setData(e),s.showPopup(),s._listbox._focusItem(0,!0),void(s._loading=!1)}this._listbox.getData();var i={value:this.getValue(),text:this.getText()};i[this.searchField]=t;var o,l,e=this.url,t="function"==typeof e?e:window[e];(e="function"==typeof t?t(this):e)&&(t="post",e&&(-1==e.indexOf(".txt")&&-1==e.indexOf(".json")||(t="get")),o={url:e,"async":!0,params:i,data:i,type:this.ajaxType||t,cache:!1,cancel:!1},jQuery.extend(!0,o,this.ajaxOptions),this.fire("beforeload",o),o.cancel||(l=this,mini.copyTo(o,{success:function(t,e,i){delete o.params;var n={text:t,result:null,sender:l,options:o,xhr:i},i=null;try{mini_doload(n),i=(i=n.result)||mini.decode(t)}catch(ex){if(1==mini_debugger)throw new Error("textboxlist json is error")}mini.isArray(i)&&(i={data:i}),l.dataField&&(i.data=mini._getMap(l.dataField,i)),i.data||(i.data=[]),s._listbox.setData(i.data),s.showPopup(),s._listbox._focusItem(0,!0),s.fire("load",{data:i.data,result:i}),s._loading=!1,s._selectOnLoad&&(s.__doSelectValue(),s._selectOnLoad=null)},error:function(t,e,i){s.showPopup("error")}}),s._ajaxer=mini.ajax(o)))}},_stopQuery:function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this._ajaxer&&this._ajaxer.abort(),this._loading=!1},within:function(t){return!!mini.isAncestor(this.el,t.target)||!!(this.showPopup&&this.popup&&this.popup.within(t))},placeholder:"",setPlaceholder:function(t){this.placeholder=t},getPlaceholder:function(t){return this.placeholder},emptyText:"No Result",setEmptyText:function(t){this.popupEmptyText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.emptyText=t},getEmptyText:function(t){return this.emptyText},loadingText:"Loading...",setLoadingText:function(t){this.popupLoadingText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.loadingText=t},getLoadingText:function(t){return this.loadingText},errorText:"Error",setErrorText:function(t){this.popupEmptyText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.errorText=t},getErrorText:function(t){return this.errorText},popupLoadingText:"<span class='mini-textboxlist-popup-loading'>Loading...</span>",popupErrorText:"<span class='mini-textboxlist-popup-error'>Error</span>",popupEmptyText:"<span class='mini-textboxlist-popup-noresult'>No Result</span>",isShowPopup:!1,popupHeight:"",popupMinHeight:30,popupMaxHeight:150,_createPopup:function(){return this.popup||(this.popup=new mini.ListBox,this.popup.addCls("mini-textboxlist-popup"),this.popup.setStyle("position:absolute;left:0;top:0;"),this.popup.showEmpty=!0,this.popup.setValueField(this.valueField),this.popup.setTextField(this.textField),this.popup.render(document.body),this.popup.on("itemclick",function(t){this.hidePopup(),this._doInsertSelectValue()},this)),this._listbox=this.popup,this.popup},showPopup:function(t){var e,i,n;0!=this.isDisplay()&&(this.isShowPopup=!0,(e=this._createPopup()).el.style.zIndex=mini.getMaxZIndex(),(n=this._listbox).emptyText=this.popupEmptyText,"loading"!=t&&"error"!=t||(n.emptyText=this.popupLoadingText,this._listbox.setData([])),this._listbox.doUpdate(),t=(i=this.getBox()).x,n=i.y+i.height,this.popup.el.style.display="block",mini.setXY(e.el,-1e3,-1e3),this.popup.setWidth(i.width),this.popup.setHeight(this.popupHeight),this.popup.getHeight()<this.popupMinHeight&&this.popup.setHeight(this.popupMinHeight),this.popup.getHeight()>this.popupMaxHeight&&this.popup.setHeight(this.popupMaxHeight),mini.setXY(e.el,t,n))},hidePopup:function(){this.isShowPopup=!1,this.popup&&(this.popup.el.style.display="none")},__OnMouseMove:function(t){var e;0!=this.enabled&&((e=this.getItemByEvent(t))?this.hoverItem(e,t):this.blurItem())},__OnMouseOut:function(t){this.blurItem()},__OnClick:function(t){var e;this.isReadOnly()||0==this.enabled||0!=this.enabled&&((e=this.getItemByEvent(t))?(this.focusEl.focus(),this.select(e),t&&mini.hasClass(t.target,"mini-textboxlist-close")&&(this.removeItem(e),this.fire("removeitem",{item:e}))):mini.findParent(t.target,"mini-textboxlist-input")||this.showInput())},__OnKeyDown:function(t){if(this.isReadOnly()||0==this.allowInput)return!1;var e=this.selecteds.indexOf(this._selected),i=this;function n(){var t=i.selecteds[e];i.removeItem(t),t=(t=i.selecteds[e])||i.selecteds[e-1],i.select(t),t||i.showInput()}switch(t.keyCode){case 8:t.preventDefault(),n();break;case 37:case 38:this.select(null),this.showInput(e);break;case 39:case 40:e+=1,this.select(null),this.showInput(e);break;case 46:n()}},__doSelectValue:function(){var t=this._listbox.getFocusedItem();t?(this._listbox.setSelected(t),this.lastInputText=this.text,this.hidePopup(),this._doInsertSelectValue()):this.valueFromSelect||this.getInputText().trim()&&this._doInsertInputValue()},__OnInputKeyDown:function(t){if(this._selectOnLoad=null,this.isReadOnly()||0==this.allowInput)return!1;if((13!=t.keyCode||this.isShowPopup)&&(t.stopPropagation(),!this.isReadOnly()&&0!=this.allowInput)){var e,i,n=mini.getSelectRange(this._inputEl),s=n[0],o=n[1],n=this._inputEl.value.length,l=s==o&&0==s,r=s==o&&o==n;if(!this.isReadOnly()&&0!=this.allowInput||t.preventDefault(),9!=t.keyCode){if(16!=t.keyCode&&17!=t.keyCode&&18!=t.keyCode)switch(t.keyCode){case 13:if(this.inputMode)return void(this.getInputText().trim()&&this._doInsertInputValue());if(this.isShowPopup){if(t.preventDefault(),this._loading)return void(this._selectOnLoad=!0);if((i=this._listbox.getFocusedItem())&&!1===i.enabled)return;this.__doSelectValue()}break;case 27:t.preventDefault(),this.hidePopup();break;case 8:l&&t.preventDefault();case 37:l&&(this.isShowPopup?this.hidePopup():0<this.editIndex&&((e=(e=this.editIndex-1)<0?0:e)>=this.selecteds.length&&(e=this.selecteds.length-1),this.showInput(!1),this.select(e)));break;case 39:r&&(this.isShowPopup?this.hidePopup():this.editIndex<=this.selecteds.length-1&&(e=this.editIndex,this.showInput(!1),this.select(e)));break;case 38:t.preventDefault(),this.isShowPopup&&(e=-1,(i=this._listbox.getFocusedItem())&&(e=this._listbox.indexOf(i)),this._listbox._focusItem(e=--e<0?0:e,!0));break;case 40:t.preventDefault(),this.isShowPopup?(e=-1,(i=this._listbox.getFocusedItem())&&(e=this._listbox.indexOf(i)),(e=++e<0?0:e)>=this._listbox.getCount()&&(e=this._listbox.getCount()-1),this._listbox._focusItem(e,!0)):this._startQuery(!0)}}else this.hidePopup()}},focus:function(){try{this._inputEl.focus()}catch(e){}},blur:function(){try{this._inputEl.blur()}catch(e){}},searchField:"key",setSearchField:function(t){this.searchField=t},getSearchField:function(){return this.searchField},getAttrs:function(t){var e=mini.TextBox.superclass.getAttrs.call(this,t);jQuery(t);return mini._ParseString(t,e,["value","text","valueField","textField","url","popupHeight","textName","onfocus","onbeforeload","onload","searchField","emptyText","loadingText","errorText","onblur","onremoveitem","placeholder"]),mini._ParseBool(t,e,["allowInput","valueFromSelect","remote","inputMode"]),mini._ParseInt(t,e,["popupMinHeight","popupMaxHeight"]),e}}),mini.regClass(mini.TextBoxList,"textboxlist"),mini.AutoComplete=function(){mini.AutoComplete.superclass.constructor.apply(this,arguments);var t=this;t._ValueChangeTimer=null,this._textEl.onfocus=function(){t._LastInputText=t._textEl.value,t._ValueChangeTimer=setInterval(function(){t._LastInputText!=t._textEl.value&&(t._tryQuery(),t._LastInputText=t._textEl.value,""==t._textEl.value&&""!=t.value&&(t.setValue(""),t._OnValueChanged()))},10)},this._textEl.onblur=function(){clearInterval(t._ValueChangeTimer),t.isShowPopup()||t._LastInputText!=t._textEl.value&&""==t._textEl.value&&""!=t.value&&(t.setValue(""),t._OnValueChanged())},this._buttonEl.style.display="none",this._doInputLayout()},mini.extend(mini.AutoComplete,mini.ComboBox,{remote:!0,url:"",allowInput:!0,delay:200,showButton:!1,searchField:"key",minChars:0,_buttonWidth:0,uiCls:"mini-autocomplete",_initInput:function(){var t=this;isFirefox&&(this._textEl.oninput=function(){t.enterQuery||t._tryQuery()})},getRemote:function(){return this.remote},setRemote:function(t){this.remote=t},setUrl:function(t){this.url=t,this.remote||mini.AutoComplete.superclass.setUrl.call(this,t)},setValue:function(t){mini.isNull(t)&&(t=""),this.value!=t&&(this.value=t,this._valueEl.value=this.value),this.__oldText=""},setText:function(t){mini.isNull(t)&&(t=""),this.text!=t&&(this.text=t,this._LastInputText=t),this._textEl.value=this.text},setMinChars:function(t){this.minChars=t},getMinChars:function(){return this.minChars},setSearchField:function(t){this.searchField=t},getSearchField:function(){return this.searchField},popupEmptyText:"No Result",setPopupEmptyText:function(t){this.popupEmptyText=t},getPopupEmptyText:function(t){return this.popupEmptyText},loadingText:"Loading...",setLoadingText:function(t){this.loadingText=t},getLoadingText:function(t){return this.loadingText},errorText:"Error",setErrorText:function(t){this.errorText=t},getErrorText:function(t){return this.errorText},getPopupEmptyHtml:function(){return"<span class='mini-textboxlist-popup-noresult'>"+this.popupEmptyText+"</span>"},getPopupLoadingHtml:function(){return"<span class='mini-textboxlist-popup-loading'>"+this.loadingText+"</span>"},getPopupErrorHtml:function(){return"<span class='mini-textboxlist-popup-error'>"+this.errorText+"</span>"},showPopup:function(t){this.getPopup();var e=this._listbox;e.showEmpty=!0,e.emptyText=this.getPopupEmptyHtml(),"loading"==t?(e.emptyText=this.getPopupLoadingHtml(),this._listbox.setData([])):"error"==t&&(e.emptyText=this.getPopupErrorHtml(),this._listbox.setData([])),this._listbox.doUpdate(),mini.AutoComplete.superclass.showPopup.call(this)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(16!=t.keyCode&&17!=t.keyCode&&18!=t.keyCode&&!this.isReadOnly())switch(t.keyCode){case 27:this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 13:var i,n,s,o=!0;this.isShowPopup()&&0!=this._listbox.getData().length||this.enterQuery&&(o=!1,s=this._textEl.value,this._enterSearchText==s&&this.loading||(this._enterSearchText=s,this._tryQuery(s))),this.isShowPopup()?(t.preventDefault(),t.stopPropagation(),!0!==this._requestSearch&&-1!=(l=this._listbox.getFocusedIndex())&&(i=this._listbox.getAt(l),s=(n=this._listbox.getValueAndText([i]))[0],this.setText(n[1]),this.setValue(s),this._OnValueChanged())):this.fire("enter",e),o&&(this.hidePopup(),this.focus());break;case 37:break;case 38:-1==(l=this._listbox.getFocusedIndex())&&(l=0,this.multiSelect||(i=this._listbox.findItems(this.value)[0])&&(l=this._listbox.indexOf(i))),this.isShowPopup()&&(this.multiSelect||this._listbox._focusItem(l=--l<0?0:l,!0));break;case 39:break;case 40:var l=this._listbox.getFocusedIndex();this.isShowPopup()?this.multiSelect||((l+=1)>this._listbox.getCount()-1&&(l=this._listbox.getCount()-1),this._listbox._focusItem(l,!0)):this._tryQuery(this._textEl.value);break;default:1==this.enterQuery?(this.hidePopup(),this.focus()):this._keydownQuery()}}else this.hidePopup()},_keydownQuery:function(){var e=this;e._requestSearch=!0,e.remote||(e._requestSearch=!1),e._keydownTimer&&(clearTimeout(e._keydownTimer),e._keydownTimer=null),e._keydownTimer=setTimeout(function(){var t=e._textEl.value;t!=e.__oldText&&(e._tryQuery(t),e.__oldText=t)},e.delay)},enterQuery:!1,doQuery:function(){this._tryQuery()},_tryQuery:function(t){var e=this;this._queryTimer&&(clearTimeout(this._queryTimer),this._queryTimer=null),this._queryTimer=setTimeout(function(){var t=e._textEl.value;e._doQuery(t)},this.delay),!1!==e._tryHide()&&this.showPopup("loading")},_tryHide:function(){if(mini.getActiveElement()!=this._textEl&&mini.hasClass(this.el,"mini-buttonedit-focus"))return this.hidePopup(),!1},blur:function(){var t=this;mini.AutoComplete.superclass.blur.apply(this),t._ajaxer&&(t._ajaxer.abort(),t._ajaxer=null),t._doloadTimer&&(clearTimeout(t._doloadTimer),t._doloadTimer=null),t._queryTimer&&(clearTimeout(t._queryTimer),t._queryTimer=null),t._keydownTimer&&(clearTimeout(t._keydownTimer),t._keydownTimer=null),t.isShowPopup()&&t.hidePopup()},_doQuery:function(t){var e,i,s,n,o=this;function l(t,e){o._focused&&!1!==o._tryHide()&&(o._doloadTimer&&(clearTimeout(o._doloadTimer),o._doloadTimer=null),o._doloadTimer=setTimeout(function(){o._doloadTimer=null,o._tryHide()},100),o._listbox.setData(t),o.showPopup(),o._listbox._focusItem(0,!0),o.data=t,o.fire("load",{data:t,result:e}))}mini.getActiveElement()==o._textEl?this.remote?(this._ajaxer&&this._ajaxer.abort(),n="post",(e=this.url)&&(-1==e.indexOf(".txt")&&-1==e.indexOf(".json")||(n="get")),(i={})[this.searchField]=t,s={url:e,"async":!0,params:i,data:i,type:this.ajaxType||n,cache:!1,cancel:!1},jQuery.extend(!0,s,this.ajaxOptions),this.fire("beforeload",s),o=this,s.cancel?l(n=s.result||[],n):(o.loading=!0,mini.copyTo(s,{success:function(t,e,i){delete s.params;var n={text:t,result:null,sender:o,options:s,xhr:i},i=null;try{mini_doload(n),i=(i=n.result)||mini.decode(t)}catch(ex){if(1==mini_debugger)throw new Error("autocomplete json is error")}mini.isArray(i)&&(i={data:i}),o.dataField&&(i.data=mini._getMap(o.dataField,i)),i.data||(i.data=[]),l(i.data,i)},error:function(t,e,i){},complete:function(){o.loading=!1,o._requestSearch=!1,o._ajaxer=null}}),this._ajaxer=mini.ajax(s))):mini.AutoComplete.superclass._doQuery.apply(this,arguments):o.hidePopup()},setEnterQuery:function(t){this.enterQuery=t},getEnterQuery:function(){return this.enterQuery},getAttrs:function(t){var e=mini.AutoComplete.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["searchField","popupEmptyText","loadingText","errorText"]),mini._ParseBool(t,e,["enterQuery","remote"]),e}}),mini.regClass(mini.AutoComplete,"autocomplete"),mini.ToolTip=function(){mini.ToolTip.superclass.constructor.apply(this,arguments)},mini.extend(mini.ToolTip,mini.Control,{selector:"[title]",placement:"bottom",trigger:"hover focus",delay:200,uiCls:"mini-tooltip",_create:function(){this.el=jQuery('<div class="mini-tooltip"><div class="mini-tooltip-arrow"></div><div class="mini-tooltip-inner mini-corner-all"></div></div>')[0],this.$element=jQuery(this.el),this.$element.appendTo(document.body)},_initEvents:function(){},_bindTooltip:function(){var t=jQuery(document),e=this.selector,i="tooltip";t.unbind("."+i,this);for(var n=this.trigger.split(" "),s=n.length;s--;){var o,l=n[s];"click"==l?t.on("click."+i,e,jQuery.proxy(this._toggle,this)):"manual"!=l&&(o="hover"==l?"mouseleave":"blur",t.on(("hover"==l?"mouseenter":"focus")+"."+i,e,jQuery.proxy(this._enter,this)),t.on(o+"."+i,e,jQuery.proxy(this._leave,this)))}},setSelector:function(t){this.selector=t,this._bindTooltip()},getSelector:function(){return this.selector},setPlacement:function(t){this.placement=t},getPlacement:function(){return this.placement},setTrigger:function(t){this.trigger=t,this._bindTooltip()},getTrigger:function(){return this.trigger},openTimer:null,_enter:function(t){var e=this,i=t.currentTarget;this.getContent(i),clearTimeout(this.openTimer),this.openTimer=setTimeout(function(){e.openTimer=null,e.open(i)},e.delay)},_leave:function(t){clearTimeout(this.openTimer),this.close()},_toggle:function(t){"none"==this._getTip().css("display")?this.enter(t):this.leave(t)},open:function(t){var t=jQuery(t)[0]||this.target,e=(jQuery(t),this.getContent(t)),e={element:t,content:e,cancel:!e};if(this.fire("beforeopen",e),!e.cancel){this.$element.show(),this._target=t;try{this.setContent(e.content)}catch(ex){}this.fire("open",{element:t})}},close:function(){this._target=null,this.$element.hide()},showLoading:function(){this.setContent('<div class="mini-tooltip-loading"></div>')},setContent:function(t){this.$element.children(".mini-tooltip-inner").html(t||"&nbsp;"),this.applyPlacement()},getContent:function(t){var e=t.title;return e&&jQuery(t).attr("data-tooltip",e).attr("title",""),e=e||jQuery(t).attr("data-tooltip")},applyPlacement:function(){var t,e,i,n,s,o,l,r,a,h;function d(t){e.removeClass("mini-tooltip-left mini-tooltip-top mini-tooltip-right mini-tooltip-bottom mini-tooltip-bottomleft mini-tooltip-topleft mini-tooltip-bottomright mini-tooltip-topright").addClass("mini-tooltip-"+t)}function u(){var t=i.top+i.height/2-r.height()/2-l.top;r.css("top",t)}this._target&&"none"!=this.$element.css("display")&&(o=this._target,t=jQuery(o).attr("data-placement")||this.placement,e=this.$element,o&&e[0]&&(e.show().css({left:"-2000px",top:"-2000px"}),i=mini.getBox(o),a=mini.getViewportBox(),n=i.top-a.top,s=a.bottom-i.bottom,d(t),o=mini.getBox(e[0]),l=mini.getCalculatedOffset(t,i,o.width,o.height),"left"==t||"right"==t||"top"==t||"bottom"==t||"bottomleft"==t&&s<n&&l.top+o.height>a.bottom&&(t="topleft"),d(t),l=mini.getCalculatedOffset(t,i,o.width,o.height),"right"!=t&&"left"!=t||((r=jQuery(e).children(".mini-tooltip-arrow")).css("top",""),a=mini.getViewportBox(),l.top<a.y?(l.top=a.y,u()):l.top+o.height>a.bottom&&(l.top=a.bottom-o.height,u())),h=l,e.offset(h)))},getAttrs:function(t){var e=mini.ToolTip.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["selector","placement","onbeforeopen","onopen","onclose"]),e}}),mini.regClass(mini.ToolTip,"tooltip"),mini.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:"bottomleft"==t?{top:e.top+e.height,left:e.left}:"bottomright"==t?{top:e.top+e.height,left:e.left+e.width-i}:"topleft"==t?{top:e.top-n,left:e.left}:"topright"==t?{top:e.top-n,left:e.left+e.width-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},mini.ProgressBar=function(){mini.ProgressBar.superclass.constructor.apply(this,arguments)},mini.extend(mini.ProgressBar,mini.Control,{formField:!0,uiCls:"mini-progressbar",showText:!1,textAlign:"center",text:"",format:"{0}%",value:0,set:function(t){if("string"==typeof t)return this;var e=t.value;return delete t.value,mini.ProgressBar.superclass.set.call(this,t),mini.isNull(e)||this.setValue(e),this},_create:function(){this.el=document.createElement("div"),this.el.className="mini-progressbar";this.el.innerHTML='<div class="mini-progressbar-border"><div class="mini-progressbar-bar"></div><div class="mini-progressbar-text"></div></div>',this._borderEl=this.el.firstChild,this._barEl=this._borderEl.firstChild,this._textEl=this._borderEl.lastChild},setText:function(t){this.text=t,this._textEl.innerHTML=t},setShowText:function(t){this.showText=t,this._textEl.style.display=t?"":"none"},getShowText:function(){return this.showText},setTextAlign:function(t){this.textAlign=t,this._textEl.style.textAlign=t},getTextAlign:function(){return this.textAlign},setValue:function(t){t=parseFloat(t),isNaN(t)&&(t=0),this.value=t=100<(t=t<0?0:t)?100:t,this._barEl.style.width=t+"%";t=String.format(this.format,t);this.setText(t)},getValue:function(){return this.value},getAttrs:function(t){var e=mini.ProgressBar.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["text","format","textAlign"]),mini._ParseBool(t,e,["showText"]),e}}),mini.regClass(mini.ProgressBar,"progressbar"),mini.Form=function(t){if(this.el=mini.byId(t),!this.el)throw new Error("form element not null");mini.Form.superclass.constructor.apply(this,arguments)},mini.extend(mini.Form,mini.Component,{el:null,getFields:function(){return this.el?mini.findControls(function(t){return!(!t.el||1!=t.formField)&&!!mini.isAncestor(this.el,t.el)},this):[]},getFieldsMap:function(){for(var t=this.getFields(),e={},i=0,n=t.length;i<n;i++){var s=t[i];s.name&&(e[s.name]=s)}return e},getField:function(t){return this.el?mini.getbyName(t,this.el):null},getData:function(t,e){mini.isNull(e)&&(e=!0);for(var i=t?"getFormValue":"getValue",n=this.getFields(),s={},o=0,l=n.length;o<l;o++){var r=n[o],a=r[i];a&&(r.name&&(1==e?mini._setMap(r.name,a.call(r),s):s[r.name]=a.call(r)),r.textName&&r.getText&&(1==e?mini._setMap(r.textName,r.getText(),s):s[r.textName]=r.getText()))}return s},setData:function(t,e,i){mini.isNull(i)&&(i=!0),"object"!=typeof t&&(t={});var n,s=this.getFieldsMap();for(n in s){var o=s[n];if(o){if(o.setValue){var l=t[n];if((l=1==i?mini._getMap(n,t):l)===undefined&&!1===e)continue;null===l&&(l=""),o.setValue(l)}o.setText&&o.textName&&(l=t[o.textName],1==i&&(l=mini._getMap(o.textName,t)),mini.isNull(l)&&(l=""),o.setText(l))}}},reset:function(){for(var t=this.getFields(),e=0,i=t.length;e<i;e++){var n,s=t[e];s.setValue&&(s.setText&&!1!==s._clearText&&(n=s.defaultText,mini.isNull(n)&&(n=""),s.setText(n)),s.setValue(s.defaultValue),s.clear&&s.clear())}this.setIsValid(!0)},clear:function(){for(var t=this.getFields(),e=0,i=t.length;e<i;e++){var n=t[e];n.setValue&&(n.setText&&!1!==n._clearText&&n.setText(""),n.setValue(""),n.clear&&n.clear())}this.setIsValid(!0)},getValidateFields:function(t){for(var e=[],i=this.getFields(),n=0,s=i.length;n<s;n++){var o=i[n];o.validate&&o.isDisplay&&(!o.isDisplay(function(t){if(mini.hasClass(t,"mini-tabs-body"))return!0})&&!o.forceValidate||(o.enabled||t||o.forceValidate)&&e.push(o))}return e},validate:function(t,e){for(var i=this.getValidateFields(e),n=0,s=i.length;n<s;n++)if(0==i[n].validate()&&!1===t)break;return this.isValid()},isValid:function(){for(var t=this.getValidateFields(),e=0,i=t.length;e<i;e++)if(0==t[e].isValid())return!1;return!0},setIsValid:function(t){for(var e=this.getFields(),i=0,n=e.length;i<n;i++){var s=e[i];s.setIsValid&&s.setIsValid(t)}},getErrorTexts:function(){for(var t=[],e=this.getErrors(),i=0,n=e.length;i<n;i++){var s=e[i];t.push(s.errorText)}return t},getErrors:function(){for(var t=[],e=this.getFields(),i=0,n=e.length;i<n;i++){var s=e[i];s.isValid&&0==s.isValid()&&t.push(s)}return t},mask:function(t){(t=(t="string"==typeof t?{html:t}:t)||{}).el=this.el,t.cls||(t.cls=this._maskCls),mini.mask(t)},unmask:function(){mini.unmask(this.el)},_maskCls:"mini-mask-loading",loadingMsg:"数据加载中，请稍后...",loading:function(t){this.mask(t||this.loadingMsg)},__OnValueChanged:function(t){this._changed=!0},_changed:!1,setChanged:function(t){this._changed=t;for(var e=this.getFields(),i=0,n=e.length;i<n;i++)e[i].on("valuechanged",this.__OnValueChanged,this)},isChanged:function(){return this._changed},setEnabled:function(t){for(var e=this.getFields(),i=0,n=e.length;i<n;i++)e[i].setEnabled(t)}}),mini.Fit=function(){mini.Fit.superclass.constructor.apply(this,arguments)},mini.extend(mini.Fit,mini.Container,{style:"",_clearBorder:!1,uiCls:"mini-fit",_create:function(){this.el=document.createElement("div"),this.el.className="mini-fit",this._bodyEl=this.el},_initEvents:function(){},isFixedSize:function(){return!1},doLayout:function(){if(this.canLayout()){var t=this.el.parentNode,i=mini.getChildNodes(t);t==document.body&&(this.el.style.height="0px");for(var n=mini.getHeight(t,!0),s=0,o=i.length;s<o;s++){var l=(h=i[s]).tagName?h.tagName.toLowerCase():"";h!=this.el&&"style"!=l&&"script"!=l&&"hidden"!=h.type&&("absolute"!=(l=mini.getStyle(h,"position"))&&"fixed"!=l&&(n=n-mini.getHeight(h)-(r=mini.getMargins(h)).top-r.bottom))}var r,a=mini.getBorders(this.el),t=mini.getPaddings(this.el);n=n-(r=mini.getMargins(this.el)).top-r.bottom,jQuery.boxModel&&(n=n-t.top-t.bottom-a.top-a.bottom),this.el.style.height=(n=n<0?0:n)+"px";try{for(i=mini.getChildNodes(this.el),s=0,o=i.length;s<o;s++){var h=i[s];mini.layout(h)}}catch(e){}}},set_bodyParent:function(t){if(t){for(var i=this._bodyEl,n=t;n.firstChild;)try{i.appendChild(n.firstChild)}catch(e){}this.doLayout()}},getAttrs:function(t){var e=mini.Fit.superclass.getAttrs.call(this,t);return e._bodyParent=t,e}}),mini.regClass(mini.Fit,"fit"),mini.Panel=function(){this._initButtons(),mini.Panel.superclass.constructor.apply(this,arguments),this.url&&this.setUrl(this.url),this._contentEl=this._bodyEl,this._doVisibleEls(),this._Resizer=new mini._Resizer(this),this._doTools()},mini.extend(mini.Panel,mini.Container,{width:250,title:"",iconCls:"",iconStyle:"",allowResize:!1,url:"",refreshOnExpand:!1,maskOnLoad:!0,collapseOnTitleClick:!1,showCollapseButton:!1,showCloseButton:!1,closeAction:"display",showHeader:!0,showToolbar:!1,showFooter:!1,headerCls:"",headerStyle:"",bodyCls:"",bodyStyle:"",footerCls:"",footerStyle:"",toolbarCls:"",toolbarStyle:"",minWidth:180,minHeight:100,maxWidth:5e3,maxHeight:3e3,set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i=t.toolbar;delete t.toolbar;var n=t.footer;delete t.footer;var s=t.url;delete t.url;var o=t.buttons;return delete t.buttons,mini.Panel.superclass.set.call(this,t),o&&this.setButtons(o),i&&this.setToolbar(i),n&&this.setFooter(n),s&&this.setUrl(s),this._allowLayout=e,this.doLayout(),this},uiCls:"mini-panel",_create:function(){this.el=document.createElement("div"),this.el.className="mini-panel",this.el.tabIndex=0;this.el.innerHTML='<div class="mini-panel-border"><div class="mini-panel-header" ><div class="mini-panel-header-inner" ><span class="mini-panel-icon mini-icon mini-iconfont"></span><div class="mini-panel-title" ></div><div class="mini-tools" ></div></div></div><div class="mini-panel-viewport"><div class="mini-panel-toolbar"></div><div class="mini-panel-body" ></div><div class="mini-panel-footer"></div><div class="mini-resizer-trigger"></div></div></div>',this.el.hideFocus=!0,this._borderEl=this.el.firstChild,this._headerEl=this._borderEl.firstChild,this._viewportEl=this._borderEl.lastChild,this._toolbarEl=mini.byClass("mini-panel-toolbar",this.el),this._bodyEl=mini.byClass("mini-panel-body",this.el),this._footerEl=mini.byClass("mini-panel-footer",this.el),this._resizeGridEl=mini.byClass("mini-resizer-trigger",this.el);mini.byClass("mini-panel-header-inner",this.el);this._iconEl=mini.byClass("mini-panel-icon",this.el),this._titleEl=mini.byClass("mini-panel-title",this.el),this._toolsEl=mini.byClass("mini-tools",this.el),mini.setStyle(this._bodyEl,this.bodyStyle),this._doTitle()},destroy:function(t){this._doRemoveIFrame(),this._iframeEl=null,this._viewportEl=this._borderEl=this._bodyEl=this._footerEl=this._toolbarEl=null,this._toolsEl=this._titleEl=this._iconEl=this._resizeGridEl=null,mini.Panel.superclass.destroy.call(this,t)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"click",this.__OnClick,this)},this)},_doVisibleEls:function(){this._headerEl.style.display=this.showHeader?"":"none",this._toolbarEl.style.display=this.showToolbar?"":"none",this._footerEl.style.display=this.showFooter?"":"none"},_setBodyWidth:!0,doLayout:function(){var t,e;this.canLayout()&&(e=this.isAutoHeight(),this.isAutoWidth(),t=parseInt(jQuery(this.el).css("max-height")),e&&t&&(this._viewportEl.style.height="auto",this._bodyEl.style.height="auto",t<this.el.firstChild.offsetHeight&&(e=!1)),this._autoHeight=e,t=this.getWidth(!0),mini.isIE6&&mini.setWidth(this._bodyEl,t),e?(this._viewportEl.style.height="auto",this._bodyEl.style.height="auto"):(e=this.getViewportHeight(),mini.setHeight(this._viewportEl,e),e=this.getBodyHeight(!0),mini.setHeight(this._bodyEl,e)),mini.layout(this._borderEl),this._resizeGridEl&&mini.repaint(this._resizeGridEl),this._resizeGridEl.style.display=this.allowResize?"":"none",this.fire("layout"))},deferLayout:function(t){var e;t=t||10,this._layoutTimer||((e=this)._layoutTimer=setTimeout(function(){e._layoutTimer=null,e.doLayout()},t))},_stopLayout:function(){clearTimeout(this._layoutTimer),this._layoutTimer=null},getViewportWidth:function(t){return this.getWidth(!0)},getViewportHeight:function(t){var e,i,n=this.getHeight(!0)-this.getHeaderHeight();return t&&(e=mini.getPaddings(this._viewportEl),i=mini.getBorders(this._viewportEl),t=mini.getMargins(this._viewportEl),n=(n=jQuery.boxModel?n-e.top-e.bottom-i.top-i.bottom:n)-t.top-t.bottom),n},getBodyHeight:function(t){var e,i,n=this.getViewportHeight(!0);return n=n-this.getToolbarHeight()-this.getFooterHeight(),t&&(e=mini.getPaddings(this._bodyEl),i=mini.getBorders(this._bodyEl),t=mini.getMargins(this._bodyEl),n=(n=jQuery.boxModel?n-e.top-e.bottom-i.top-i.bottom:n)-t.top-t.bottom),n=n<0?0:n},getHeaderHeight:function(){return this.showHeader?jQuery(this._headerEl).outerHeight():0},getToolbarHeight:function(){return this.showToolbar?jQuery(this._toolbarEl).outerHeight():0},getFooterHeight:function(){return this.showFooter?jQuery(this._footerEl).outerHeight():0},setHeaderStyle:function(t){this.headerStyle=t,mini.setStyle(this._headerEl,t),this.doLayout()},getHeaderStyle:function(){return this.headerStyle},setBodyStyle:function(t){this.bodyStyle=t,mini.setStyle(this._bodyEl,t),this.doLayout()},getBodyStyle:function(){return this.bodyStyle},setToolbarStyle:function(t){this.toolbarStyle=t,mini.setStyle(this._toolbarEl,t),this.doLayout()},getToolbarStyle:function(){return this.toolbarStyle},setFooterStyle:function(t){this.footerStyle=t,mini.setStyle(this._footerEl,t),this.doLayout()},getFooterStyle:function(){return this.footerStyle},setHeaderCls:function(t){jQuery(this._headerEl).removeClass(this.headerCls),jQuery(this._headerEl).addClass(t),this.headerCls=t,this.doLayout()},getHeaderCls:function(){return this.headerCls},setBodyCls:function(t){jQuery(this._bodyEl).removeClass(this.bodyCls),jQuery(this._bodyEl).addClass(t),this.bodyCls=t,this.doLayout()},getBodyCls:function(){return this.bodyCls},setToolbarCls:function(t){jQuery(this._toolbarEl).removeClass(this.toolbarCls),jQuery(this._toolbarEl).addClass(t),this.toolbarCls=t,this.doLayout()},getToolbarCls:function(){return this.toolbarCls},setFooterCls:function(t){jQuery(this._footerEl).removeClass(this.footerCls),jQuery(this._footerEl).addClass(t),this.footerCls=t,this.doLayout()},getFooterCls:function(){return this.footerCls},_doTitle:function(){var t=""==this.title?"&nbsp":this.title;this._titleEl.innerHTML=t,this._iconEl.style.display=this.iconCls||this.iconStyle?"inline":"none",this._iconEl.className="mini-panel-icon mini-icon mini-iconfont "+this.iconCls,mini.setStyle(this._iconEl,this.iconStyle)},setTitle:function(t){this.title=t,this._doTitle()},getTitle:function(){return this.title},setIconCls:function(t){this.iconCls=t,this._doTitle()},getIconCls:function(){return this.iconCls},setIconStyle:function(t){this.iconStyle=t,this._doTitle()},getIconStyle:function(){return this.iconStyle},_doTools:function(){for(var t="",e=0,i=this.buttons.length;e<i;e++){var n=this.buttons[e];n.html?t+=n.html:t+='<span id="'+e+'" class="mini-icon mini-iconfont fa '+n.cls+" "+(n.enabled?"":"mini-disabled")+'" style="'+n.style+";"+(n.visible?"":"display:none;")+'"></span>'}this._toolsEl.innerHTML=t},setShowCloseButton:function(t){this.showCloseButton=t;var e=this.getButton("close");e&&(e.visible=t,this._doTools())},getShowCloseButton:function(){return this.showCloseButton},setCloseAction:function(t){this.closeAction=t},getCloseAction:function(){return this.closeAction},setShowCollapseButton:function(t){this.showCollapseButton=t;var e=this.getButton("collapse");e&&(e.visible=t,this._doTools())},getShowCollapseButton:function(){return this.showCollapseButton},setShowHeader:function(t){this.showHeader=t,this._doVisibleEls(),this.deferLayout()},getShowHeader:function(){return this.showHeader},setShowToolbar:function(t){this.showToolbar=t,this._doVisibleEls(),this.deferLayout()},getShowToolbar:function(){return this.showToolbar},setShowFooter:function(t){this.showFooter=t,this._doVisibleEls(),this.deferLayout()},getShowFooter:function(){return this.showFooter},__OnClick:function(t){var e;mini.isAncestor(this._headerEl,t.target)&&(mini.findParent(t.target,"mini-tools")?(e=this.getButton(parseInt(t.target.id)))&&this._OnButtonClick(e,t):this.collapseOnTitleClick&&this.toggle())},_OnButtonClick:function(t,e){t={button:t,index:this.buttons.indexOf(t),name:t.name.toLowerCase(),htmlEvent:e,cancel:!1};this.fire("beforebuttonclick",t);e=!0;try{"close"==t.name&&"destroy"==this.closeAction&&this._iframeEl&&this._iframeEl.contentWindow&&(e=this._iframeEl.contentWindow.CloseWindow?this._iframeEl.contentWindow.CloseWindow("close"):this._iframeEl.contentWindow.CloseOwnerWindow?this._iframeEl.contentWindow.CloseOwnerWindow("close"):this._CloseOwnerWindow("close"))}catch(ex){e=this._CloseOwnerWindow("close")}return!1===e&&(t.cancel=!0),1==t.cancel||(this.fire("buttonclick",t),"close"==t.name&&("destroy"==this.closeAction?(this.__HideAction="close",this.destroy()):this.hide()),"collapse"==t.name&&(this.toggle(),this.refreshOnExpand&&this.expanded&&this.url&&this.reload())),t},onButtonClick:function(t,e){this.on("buttonclick",t,e)},_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);t=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(t)},createButton:function(t){return mini.copyTo({name:"",cls:"",style:"",visible:!0,enabled:!0,html:""},t)},setButtons:function(t){"string"==typeof t&&(t=t.split(" "));for(var e=[],i=0,n=(t=!mini.isArray(t)?[]:t).length;i<n;i++){var s=t[i];if("string"==typeof s){if(!(s=s.trim()))continue;s={name:s,cls:"mini-tools-"+s,html:""}}s=this.createButton(s),e.push(s)}this.buttons=e,this._doTools()},getButtons:function(){return this.buttons},addButton:function(t,e){t=this.createButton(t="string"==typeof t?{iconCls:t}:t),"number"!=typeof e&&(e=this.buttons.length),this.buttons.insert(e,t),this._doTools()},updateButton:function(t,e){t=this.getButton(t);t&&(mini.copyTo(t,e),this._doTools())},removeButton:function(t){t=this.getButton(t);t&&(this.buttons.remove(t),this._doTools())},getButton:function(t){if("number"==typeof t)return this.buttons[t];for(var e=0,i=this.buttons.length;e<i;e++){var n=this.buttons[e];if(n.name==t)return n}},setBody:function(t){__mini_setControls(t,this._bodyEl,this)},set_bodyParent:function(t){},setToolbar:function(t){__mini_setControls(t,this._toolbarEl,this)},setFooter:function(t){__mini_setControls(t,this._footerEl,this)},getHeaderEl:function(){return this._headerEl},getToolbarEl:function(){return this._toolbarEl},getBodyEl:function(){return this._bodyEl},getFooterEl:function(){return this._footerEl},getIFrameEl:function(t){return this._iframeEl},clearTimeStamp:!1,setClearTimeStamp:function(t){this.clearTimeStamp=t},getClearTimeStamp:function(){return this.clearTimeStamp},_getMaskWrapEl:function(){return this._bodyEl},_doRemoveIFrame:function(t){if(this._iframeEl){var e=this._iframeEl;if(e._ondestroy&&e._ondestroy(),e.onload=function(){},jQuery(e).unbind("load"),e.src="",mini.isIE)try{e.contentWindow.document.write(""),e.contentWindow.document.close()}catch(ex){}try{this._iframeEl.parentNode.removeChild(this._iframeEl),this._iframeEl.removeNode(!0)}catch(ex){}}!(this._iframeEl=null)===t&&mini.removeChilds(this._bodyEl)},_deferLoadingTime:80,_doLoad:function(){var s,o,t;function l(t){o.__HideAction=t;var e=!0;try{o.__onDestroy&&(e=o.__onDestroy(t))}catch(ex){console.error(ex)}if(!1===e)return!1;t={iframe:o._iframeEl,action:t};o.fire("unload",t),setTimeout(function(){o.destroy()},10)}this.url&&(this._doRemoveIFrame(!0),s=new Date,(o=this).loadedUrl=this.url,this.maskOnLoad&&this.loading(),jQuery(this._bodyEl).css("overflow","hidden"),o._CloseOwnerWindow=l,t=mini.createIFrame(this.url,function(t,e){if(!o.destroyed){var i,n=s-new Date+o._deferLoadingTime;n<0&&(n=0),setTimeout(function(){o.unmask()},n);try{o._iframeEl.contentWindow.Owner=o.Owner,o._iframeEl.contentWindow.CloseOwnerWindow=l}catch(i){}(e||o.loadOnRefresh)&&(o.__onLoad&&o.__onLoad(),i={iframe:o._iframeEl},o.fire("load",i))}},this.clearTimeStamp),this._bodyEl.appendChild(t),this._iframeEl=t)},load:function(t,e,i){this.setUrl(t,e,i)},reload:function(){this.setUrl(this.url)},setUrl:function(t,e,i){this.url=t,this.__onLoad=e,this.__onDestroy=i,this.expanded&&t&&this._doLoad()},getUrl:function(){return this.url},setRefreshOnExpand:function(t){this.refreshOnExpand=t},getRefreshOnExpand:function(){return this.refreshOnExpand},setMaskOnLoad:function(t){this.maskOnLoad=t},getMaskOnLoad:function(t){return this.maskOnLoad},setAllowResize:function(t){this.allowResize!=t&&(this.allowResize=t,this.doLayout())},getAllowResize:function(){return this.allowResize},setLoadOnRefresh:function(t){this.loadOnRefresh=t},getLoadOnRefresh:function(t){return this.loadOnRefresh},expanded:!0,setExpanded:function(t){this.expanded!=t&&(this.expanded=t,this.expanded?this.expand():this.collapse())},getExpanded:function(){return this.expanded},toggle:function(){this.expanded?this.collapse():this.expand()},collapse:function(){this.expanded=!1,"max"!=this.state&&(this._height=this.el.style.height),this.el.style.height="auto",this._viewportEl.style.display="none",mini.addClass(this.el,"mini-panel-collapse"),this.doLayout()},expand:function(){this.expanded=!0,this._height&&(this.el.style.height=this._height),this._viewportEl.style.display="block","max"!=this.state&&delete this._height,mini.removeClass(this.el,"mini-panel-collapse"),this._expandLoad(),this.doLayout()},_expandLoad:function(){this.url&&this.url!=this.loadedUrl&&this._doLoad()},setCollapseOnTitleClick:function(t){this.collapseOnTitleClick=t,mini.removeClass(this.el,"mini-panel-titleclick"),t&&mini.addClass(this.el,"mini-panel-titleclick")},getCollapseOnTitleClick:function(){return this.collapseOnTitleClick},getAttrs:function(t){var e=mini.Panel.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["title","iconCls","iconStyle","headerCls","headerStyle","bodyCls","bodyStyle","footerCls","footerStyle","toolbarCls","toolbarStyle","footer","toolbar","url","closeAction","loadingMsg","onbeforebuttonclick","onbuttonclick","onload","buttons"]),mini._ParseBool(t,e,["allowResize","showCloseButton","showHeader","showToolbar","showFooter","loadOnRefresh","showCollapseButton","refreshOnExpand","maskOnLoad","expanded","collapseOnTitleClick","clearTimeStamp"]);for(var i=mini.getChildNodes(t,!0),n=i.length-1;0<=n;n--){var s=i[n],o=mini.getAttr(s,"property");o&&("toolbar"==(o=o.toLowerCase())?e.toolbar=s:"footer"==o&&(e.footer=s))}return e.body=i,e}}),mini.regClass(mini.Panel,"panel"),mini.Window=function(){mini.Window.superclass.constructor.apply(this,arguments),this.addCls("mini-window"),this.setVisible(!1),this.setAllowDrag(this.allowDrag),this.setAllowResize(this.allowResize)},mini.extend(mini.Window,mini.Panel,{x:0,y:0,state:"restore",_dragCls:"mini-window-drag",_resizeCls:"mini-window-resize",allowDrag:!0,showCloseButton:!0,showMaxButton:!1,showMinButton:!1,showCollapseButton:!1,showModal:!0,minWidth:150,minHeight:80,maxWidth:2e3,maxHeight:2e3,uiCls:"mini-window",_create:function(){mini.Window.superclass._create.call(this),this.el.className+=" mini-corner-all",this.el.firstChild.className+=" mini-corner-all",mini.isIE&&mini_useShims&&mini.append(this.el,"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 100%; height: 100%; top: 0;left:0;scrolling:no;'></iframe>")},_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);t=this.createButton({name:"min",cls:"mini-tools-min",visible:this.showMinButton});this.buttons.push(t);t=this.createButton({name:"max",cls:"mini-tools-max",visible:this.showMaxButton});this.buttons.push(t);t=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(t)},_initEvents:function(){mini.Window.superclass._initEvents.call(this),mini._BindEvents(function(){mini.on(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this),mini.on(this.el,"mousedown",this.__OnWindowMouseDown,this)},this)},doLayout:function(){var t;this.canLayout()&&("max"==this.state&&(t=this.getParentBox(),this.el.style.left="0px",this.el.style.top="0px",mini.setSize(this.el,t.width,t.height)),mini.Window.superclass.doLayout.call(this),this.allowDrag&&mini.addClass(this.el,this._dragCls),"max"==this.state&&(this._resizeGridEl.style.display="none",mini.removeClass(this.el,this._dragCls)),this._doModal())},_doModal:function(){var t,e,i;this.el?(t=this.showModal&&this.isDisplay()&&this.visible,this._modalEl||0!=this.showModal?(this._modalEl||(e="__modal"+this._id,i=mini_useShims?"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 100%; height: 100%; top: 0;left:0;scrolling:no;'></iframe>":"",this._modalEl=mini.append(document.body,'<div id="'+e+'" class="mini-modal mini-widget-content" style="display:none">'+i+"</div>")),t?(this._modalEl.style.display="block",this._modalEl.style.zIndex=mini.getStyle(this.el,"zIndex")-1):this._modalEl.style.display="none"):this._modalEl&&mini.removeNode(this._modalEl)):this._modalEl&&mini.removeNode(this._modalEl)},getParentBox:function(){var t=mini.getViewportBox(),e=this._containerEl||document.body;return t=e!=document.body?mini.getBox(e):t},setShowModal:function(t){this.showModal=t},getShowModal:function(){return this.showModal},setMinWidth:function(t){isNaN(t)||(this.minWidth=t)},getMinWidth:function(){return this.minWidth},setMinHeight:function(t){isNaN(t)||(this.minHeight=t)},getMinHeight:function(){return this.minHeight},setMaxWidth:function(t){isNaN(t)||(this.maxWidth=t)},getMaxWidth:function(){return this.maxWidth},setMaxHeight:function(t){isNaN(t)||(this.maxHeight=t)},getMaxHeight:function(){return this.maxHeight},setAllowDrag:function(t){this.allowDrag=t,mini.removeClass(this.el,this._dragCls),t&&mini.addClass(this.el,this._dragCls)},getAllowDrag:function(){return this.allowDrag},setShowMaxButton:function(t){this.showMaxButton=t;var e=this.getButton("max");e&&(e.visible=t,this._doTools())},getShowMaxButton:function(){return this.showMaxButton},setShowMinButton:function(t){this.showMinButton=t;var e=this.getButton("min");e&&(e.visible=t,this._doTools())},getShowMinButton:function(){return this.showMinButton},max:function(){this.state="max",this.addCls("mini-window-max"),this.show();var t=this.getButton("max");t&&(t.cls="mini-tools-restore",this._doTools())},restore:function(){this.removeCls("mini-window-max"),this.state="restore",this.show(this.x,this.y);var t=this.getButton("max");t&&(t.cls="mini-tools-max",this._doTools())},showInBody:!0,setShowInBody:function(t){this.showInBody=t},getShowInBody:function(){return this.showInBody},containerEl:null,showAtPos:function(t,e,i){this.show(t,e,i)},show:function(t,i,n){this._allowLayout=!1;var s=this._containerEl||document.body;(!this.isRender()||this.el.parentNode!=s&&this.showInBody)&&this.render(s),this.el.style.zIndex=mini.getMaxZIndex(),this._doShow(t,i),this._allowLayout=!0,this.setVisible(!0),"max"!=this.state&&(i=this.getBox(),this.x=i.x,this.y=i.y);try{document.body.focus()}catch(e){}},hide:function(){this.setVisible(!1),this._doModal()},getWidth:function(t){this._headerEl.style.width="50px";var e=mini.getWidth(this.el);return this._headerEl.style.width="auto",e=t&&this._borderEl?e-(t=mini.getBorders(this._borderEl)).left-t.right:e},getBox:function(){this._headerEl.style.width="50px",this.el.style.display="";var t=mini.getWidth(this.el);this._headerEl.style.width="auto";var e=mini.getBox(this.el);return e.width=t,e.right=e.x+t,e},_measureSize:function(){this.el.style.display="";var t=this.getBox();t.width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),t=this.getBox()),this.expanded&&t.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),t=this.getBox()),t.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),t=this.getBox()),this.expanded&&t.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),t=this.getBox())},_doShow:function(t,e){var i,n=this.getParentBox();"max"==this.state?(this._width||(i=this.getBox(),this._width=i.width,this.expanded&&(this._height=i.height),this.x=i.x,this.y=i.y),this.el.style.left="-10000px",this.el.style.top="-10000px"):(mini.isNull(t)&&(t="center"),mini.isNull(e)&&(e="middle"),this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this._width&&(this.setWidth(this._width),this.setHeight(this._height),delete this._width,delete this._height),this._measureSize(),i=this.getBox(),"right"==(t="center"==(t="left"==t?0:t)?n.width/2-i.width/2:t)&&(t=n.width-i.width),"bottom"==(e="middle"==(e="top"==e?0:e)?n.y+n.height/2-i.height/2:e)&&(e=n.height-i.height),(t=t+i.width>n.right?n.right-i.width:t)<0&&(t=0),(e=e+i.height>n.bottom?n.bottom-i.height:e)<0&&(e=0),this.el.style.display="",mini.setX(this.el,t),mini.setY(this.el,e)),this.doLayout()},_OnButtonClick:function(t,e){e=mini.Window.superclass._OnButtonClick.call(this,t,e);return 1==e.cancel||"max"==e.name&&("max"==this.state?this.restore():this.max()),e},__OnWindowResize:function(t){"max"==this.state&&this.doLayout(),mini.isIE6||this._doModal()},enableDragProxy:!0,setEnableDragProxy:function(t){this.enableDragProxy=t},getEnableDragProxy:function(t){return this.enableDragProxy},allowCrossBottom:!0,setAllowCrossBottom:function(t){this.allowCrossBottom=t},getAllowCrossBottom:function(){return this.allowCrossBottom},xxx:0,__OnWindowMouseDown:function(t){var o,l=this;"max"!=this.state&&this.allowDrag&&mini.isAncestor(this._headerEl,t.target)&&!mini.findParent(t.target,"mini-tools")&&((l=this).el&&(this.el.style.zIndex=mini.getMaxZIndex()),o=this.getBox(),new mini.Drag({capture:!1,onStart:function(){l._maskProxy=mini.append(document.body,'<div class="mini-resizer-mask" style=""></div>'),l.enableDragProxy?(l._dragProxy=mini.append(document.body,'<div class="mini-drag-proxy"></div>'),l.el.style.left="-2000px",l.el.style.top="-2000px"):l._dragProxy=l.el;var t=mini.append(document.body,'<div class="mini-resizer-mask"></div>');setTimeout(function(){mini.removeNode(t)},300)},onMove:function(t){var e=t.now[0]-t.init[0],i=t.now[1]-t.init[1],e=o.x+e,i=o.y+i,n=l.getParentBox(),s=e+o.width,t=i+o.height;s>n.width&&(e=n.width-o.width),l.allowCrossBottom||t>n.height&&(i=n.height-o.height),i<0&&(i=0);i={x:l.x=e=e<0?0:e,y:l.y=i,width:o.width,height:o.height};mini.setBox(l._dragProxy,i),this.moved=!0},onStop:function(){var t;l.el&&(l.el.style.display="block",this.moved&&(t=mini.getBox(l._dragProxy),mini.setBox(l.el,t))),jQuery(l._maskProxy).remove(),l._maskProxy=null,l.enableDragProxy&&jQuery(l._dragProxy).remove(),l._dragProxy=null,l.fire("moveend")}}).start(t))},destroy:function(t){mini.un(window,"resize",this.__OnWindowResize,this),this._modalEl&&(jQuery(this._modalEl).remove(),this._modalEl=null),this.shadowEl&&(jQuery(this.shadowEl).remove(),this.shadowEl=null);var e="__modal"+this._id;jQuery("[id='"+e+"']").remove(),mini.Window.superclass.destroy.call(this,t)},getAttrs:function(t){var e=mini.Window.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["modalStyle","onmoveend"]),mini._ParseBool(t,e,["showModal","showShadow","allowDrag","allowResize","showMaxButton","showMinButton","showInBody","enableDragProxy","allowCrossBottom"]),mini._ParseInt(t,e,["minWidth","minHeight","maxWidth","maxHeight"]),e},showAtEl:function(t,e){if(t=mini.byId(t)){this.isRender()&&this.el.parentNode==document.body||this.render(document.body);var i={xAlign:this.xAlign,yAlign:this.yAlign,xOffset:0,yOffset:0,popupCls:this.popupCls};mini.copyTo(i,e),this._popupEl=t,this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this.doLayout(),this._measureSize();var n,e=mini.getViewportBox(),s=this.getBox(),o=mini.getBox(t),t=i.xy,l=e.width/2-s.width/2,r=0;switch(t&&(l=t[0],r=t[1]),i.xAlign){case"outleft":l=o.x-s.width;break;case"left":l=o.x;break;case"center":l=o.x+o.width/2-s.width/2;break;case"right":l=o.right-s.width;break;case"outright":l=o.right}switch(i.yAlign){case"above":r=o.y-s.height;break;case"top":r=o.y;break;case"middle":r=o.y+o.height/2-s.height/2;break;case"bottom":r=o.bottom-s.height;break;case"below":r=o.bottom}l=parseInt(l),r=parseInt(r),i.outYAlign||i.outXAlign?("above"==i.outYAlign&&r+s.height>e.bottom&&(n=o.y-e.y,e.bottom-o.bottom<n&&(r=o.y-s.height)),"outleft"==i.outXAlign&&l+s.width>e.right&&(n=o.x-e.x,e.right-o.right<n&&(l=o.x-s.width)),"right"==i.outXAlign&&l+s.width>e.right&&(l=o.right-s.width),this._Show(l,r)):this.showAtPos(l+i.xOffset,r+i.yOffset)}}}),mini.regClass(mini.Window,"window"),mini.MessageBox={alertTitle:"提醒",confirmTitle:"确认",prompTitle:"输入",prompMessage:"请输入内容：",buttonText:{ok:"确定",cancel:"取消",yes:"是",no:"否"},autoFocus:!0,show:function(t){(t=mini.copyTo({width:"auto",height:"auto",showModal:!0,timeout:0,minWidth:150,maxWidth:800,minHeight:50,maxHeight:350,showHeader:!0,title:"",titleIcon:"",iconCls:"",iconStyle:"",message:"",html:"",spaceStyle:"margin-right:15px",showCloseButton:!0,buttons:null,buttonWidth:58,callback:null},t)).message=String(t.message);var e=t.callback,i=new mini.Window;i.addCls("mini-messagebox"),i.setBodyStyle("overflow:hidden"),i.setShowModal(t.showModal),i.setTitle(t.title||""),i.setIconCls(t.titleIcon),i.setShowHeader(t.showHeader),i.setShowCloseButton(t.showCloseButton);var n=i.uid+"$table",s=i.uid+"$content",o='<table class="mini-messagebox-table" id="'+n+'" style="" cellspacing="0" cellpadding="0"><tr><td>'+('<div class="'+t.iconCls+'" style="'+t.iconStyle+'"></div>')+'</td><td id="'+s+'" class="mini-messagebox-content-text">'+(t.message||"")+"</td></tr></table>";i._bodyEl.innerHTML='<div class="mini-messagebox-content"></div><div class="mini-messagebox-buttons"></div>';var l=i._bodyEl.firstChild;t.html?"string"==typeof t.html?l.innerHTML=t.html:mini.isElement(t.html)&&l.appendChild(t.html):l.innerHTML=o,i._Buttons=[];var r=i._bodyEl.lastChild;if(t.buttons&&0<t.buttons.length)for(var a=0,h=t.buttons.length;a<h;a++){var d=t.buttons[a],u=(u=mini.MessageBox.buttonText[d])||d,c=new mini.Button;c.setText(u),c.setWidth(t.buttonWidth),c.render(r),c.action=d,c.on("click",function(t){t=t.sender;e&&!1===e(t.action)||mini.MessageBox.hide(i)}),a!=h-1&&c.setStyle(t.spaceStyle),i._Buttons.push(c)}else r.style.display="none";i.setMinWidth(t.minWidth),i.setMinHeight(t.minHeight),i.setMaxWidth(t.maxWidth),i.setMaxHeight(t.maxHeight),i.setWidth(t.width),i.setHeight(t.height),i.show(t.x,t.y,{animType:t.animType});o=i.getWidth();i.setWidth(o);o=i.getHeight();i.setHeight(o);n=document.getElementById(n);n&&(n.style.width="100%");s=document.getElementById(s);return s&&(s.style.width="100%"),mini.MessageBox.autoFocus&&(i._Buttons[0]||i).focus(),i.on("beforebuttonclick",function(t){e&&e("close"),t.cancel=!0,mini.MessageBox.hide(i)}),mini.on(i.el,"keydown",function(t){27==t.keyCode&&(e&&e("close"),mini.MessageBox.hide(i))}),t.timeout&&setTimeout(function(){mini.MessageBox.hide(i.uid)},t.timeout),i.uid},hide:function(t){if(t){var e="object"==typeof t?t:mini.getbyUID(t);if(e){for(var i=0,n=e._Buttons.length;i<n;i++)e._Buttons[i].destroy();e._Buttons=null,e.destroy()}}},alert:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.alertTitle,buttons:["ok"],message:t,iconCls:"mini-messagebox-warning",callback:i})},confirm:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.confirmTitle,buttons:["ok","cancel"],message:t,iconCls:"mini-messagebox-question",callback:i})},prompt:function(t,e,i,n,s){var o="prompt$"+(new Date).getTime(),t=t||mini.MessageBox.promptMessage,t=n?t+'<br/><textarea id="'+o+'" style="width:200px;height:60px;margin-top:3px;"></textarea>':t+'<br/><input id="'+o+'" type="text" style="width:200px;margin-top:3px;"/>',e=mini.MessageBox.show({title:e||mini.MessageBox.promptTitle,buttons:["ok","cancel"],width:250,html:'<div style="padding:5px;padding-left:10px;">'+t+"</div>",callback:function(t){var e=document.getElementById(o);if(i)return i(t,e.value)}}),t=document.getElementById(o);return t.focus(),t.value=s=null==s?"":s,e},loading:function(t,e){return mini.MessageBox.show({minHeight:50,title:e,showCloseButton:!1,message:t,iconCls:"mini-messagebox-waiting"})},showTips:function(t){jQuery;var e='<div class="mini-tips '+("mini-tips-"+(t=jQuery.extend({content:"",state:"",x:"center",y:"top",offset:[10,10],fixed:!0,timeout:2e3},t)).state)+'">'+t.content+"</div>",i=jQuery(e).appendTo(document.body);t.el=i[0],t.timeoutHandler=function(){i.slideUp(),setTimeout(function(){i.remove()},2e3)},mini.showAt(t),i.hide().slideDown()}},mini.alert=mini.MessageBox.alert,mini.confirm=mini.MessageBox.confirm,mini.prompt=mini.MessageBox.prompt,mini.loading=mini.MessageBox.loading,mini.showMessageBox=mini.MessageBox.show,mini.hideMessageBox=mini.MessageBox.hide,mini.showTips=mini.MessageBox.showTips,mini.Tabs=function(){this._initTabs(),mini.Tabs.superclass.constructor.apply(this,arguments)},mini.extend(mini.Tabs,mini.Control,{activeIndex:-1,tabAlign:"left",tabPosition:"top",showBody:!0,showHeader:!0,nameField:"name",titleField:"title",urlField:"url",url:"",maskOnLoad:!0,plain:!0,bodyStyle:"",_tabHoverCls:"mini-tab-hover",_tabActiveCls:"mini-tab-active",set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i=t.activeIndex;delete t.activeIndex;var n=t.url;return delete t.url,mini.Tabs.superclass.set.call(this,t),n&&this.setUrl(n),mini.isNumber(i)&&this.setActiveIndex(i),this._allowLayout=e,this.doLayout(),this},uiCls:"mini-tabs",_create:function(){this.el=document.createElement("div"),this.el.className="mini-tabs";this.el.innerHTML='<table class="mini-tabs-table" cellspacing="0" cellpadding="0"><tr style="width:100%;"><td></td><td style="text-align:left;vertical-align:top;width:100%;"><div class="mini-tabs-bodys"></div></td><td></td></tr></table>',this._tableEl=this.el.firstChild;var t=this.el.getElementsByTagName("td");this._td1El=t[0],this._td2El=t[1],this._td3El=t[2],this._bodyEl=this._td2El.firstChild,this._borderEl=this._bodyEl,this.doUpdate()},destroy:function(t){if(this.tabs)for(var e=0,i=this.tabs.length;e<i;e++)this.tabs[e]._iframeEl=null;this._tableEl=this._td1El=this._td2El=this._td3El=null,this._bodyEl=this._borderEl=this.headerEl=null,this.tabs=null,mini.Tabs.superclass.destroy.call(this,t)},_doClearElement:function(){mini.removeClass(this._td1El,"mini-tabs-header"),mini.removeClass(this._td3El,"mini-tabs-header"),this._td1El.innerHTML="",this._td3El.innerHTML="",mini.removeChilds(this._td2El,this._bodyEl)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"mouseover",this.__OnMouseOver,this),mini.on(this.el,"mouseout",this.__OnMouseOut,this),mini.on(this.el,"dblclick",this.__OnDblClick,this)},this)},_initTabs:function(){this.tabs=[]},_TabID:1,createTab:function(t){var e=mini.copyTo({_id:this._TabID++,name:"",title:"",newLine:!1,tooltip:"",iconCls:"",iconStyle:"",headerCls:"",headerStyle:"",bodyCls:"",bodyStyle:"",visible:!0,enabled:!0,showCloseButton:!1,active:!1,url:"",loaded:!1,refreshOnClick:!1},t);return e=t?t=mini.copyTo(t,e):e},_doLoad:function(){var t=mini._getResult(this.url,null,null,null,null,this.dataField);this.dataField&&!mini.isArray(t)&&(t=mini._getMap(this.dataField,t)),this.setTabs(t=t||[]),this.fire("load")},load:function(t){"string"==typeof t?this.setUrl(t):this.setTabs(t)},setUrl:function(t){this.url=t,this._doLoad()},getUrl:function(){return this.url},setNameField:function(t){this.nameField=t},getNameField:function(){return this.nameField},setTitleField:function(t){this.titleField=t},getTitleField:function(){return this.titleField},setUrlField:function(t){this.urlField=t},getUrlField:function(){return this.urlField},buttonsAlign:"right",setButtonsAlign:function(t){this.buttonsAlign=t},getButtonsAlign:function(){return this.buttonsAlign},setButtons:function(t){this._buttons=mini.byId(t),!this._buttons||(t=mini.byClass("mini-tabs-buttons",this.el))&&(t.appendChild(this._buttons),mini.parse(t),this.doLayout())},setTabControls:function(t,e){(t=this.getTab(t))&&(t=this.getTabBodyEl(t),__mini_setControls(e,t,this))},setTabs:function(t){if(mini.isArray(t)){this.beginUpdate(),this.removeAll();for(var e=0,i=t.length;e<i;e++){var n=t[e];n.title=mini._getMap(this.titleField,n),n.url=mini._getMap(this.urlField,n),n.name=mini._getMap(this.nameField,n)}for(e=0,i=t.length;e<i;e++)this.addTab(t[e]);this.setActiveIndex(0),this.endUpdate()}},getTabs:function(){return this.tabs},removeAll:function(t){var e=this.getActiveTab();mini.isNull(t)&&(t=[]);for(var i=(t=!mini.isArray(t)?[t]:t).length-1;0<=i;i--){var n=this.getTab(t[i]);n?t[i]=n:t.removeAt(i)}for(var s=this.tabs,i=s.length-1;0<=i;i--){var o=s[i];-1==t.indexOf(o)&&this.removeTab(o)}var l=t[0];e!=this.getActiveTab()&&l&&this.activeTab(l)},addTab:function(t,e){(t=this.createTab(t="string"==typeof t?{title:t}:t)).name||(t.name="");var i=this.getActiveTab();"number"!=typeof e&&(e=this.tabs.length),this.tabs.insert(e,t),i&&(this.activeIndex=this.tabs.indexOf(i));i='<div id="'+this._createTabBodyId(t)+'" class="mini-tabs-body '+t.bodyCls+'" style="'+t.bodyStyle+';display:none;"></div>';mini.append(this._bodyEl,i);var n=this.getTabBodyEl(t),s=t.body;if(delete t.body,s)for(var o=0,l=(s=!mini.isArray(s)?[s]:s).length;o<l;o++)mini.append(n,s[o]);if(t.bodyParent)for(var r=t.bodyParent;r.firstChild;)8==r.firstChild.nodeType?r.removeChild(r.firstChild):n.appendChild(r.firstChild);return delete t.bodyParent,t.controls&&(this.setTabControls(t,t.controls),delete t.controls),this.doUpdate(),t},removeTab:function(t){if((t=this.getTab(t))&&-1!=this.tabs.indexOf(t)){var e=this.getActiveTab(),i=t==e,n=this._OnTabDestroy(t);this.tabs.remove(t),this._doRemoveIFrame(t);var s=this.getTabBodyEl(t);if(s&&this._bodyEl.removeChild(s),n&&i){for(var o=this.activeIndex;0<=o;o--)if((t=this.getTab(o))&&t.enabled&&t.visible){this.activeIndex=o;break}this.doUpdate(),this.setActiveIndex(this.activeIndex),this.fire("activechanged")}else this.activeIndex=this.tabs.indexOf(e),this.doUpdate();return t}},moveTab:function(t,e){var i;!(t=this.getTab(t))||(i=this.tabs[e])!=t&&(this.tabs.remove(t),-1==(e=this.tabs.indexOf(i))?this.tabs.add(t):this.tabs.insert(e,t),this.doUpdate())},updateTab:function(t,e){if(t=this.getTab(t)){if(mini.copyTo(t,e),!t.visible&&this.tabs.indexOf(t)==this.activeIndex){for(var i=-1,n=this.activeIndex+1,s=this.tabs.length;n<s;n++)if(this.tabs[n].visible){i=n;break}this.setActiveIndex(i)}this.doUpdate()}},_getMaskWrapEl:function(){return this._bodyEl},_doRemoveIFrame:function(t,e){if(t._iframeEl&&t._iframeEl.parentNode){var i=t._iframeEl;if(i.onload=function(){},jQuery(i).unbind("load"),i.src="",mini.isIE)try{i.contentWindow.document.write(""),i.contentWindow.document.close()}catch(ex){}t._iframeEl._ondestroy&&t._iframeEl._ondestroy();try{i.parentNode.removeChild(i),i.removeNode(!0)}catch(ex){}}if(t._iframeEl=null,!(t.loadedUrl=null)===e){t=this.getTabBodyEl(t);if(t)for(var n=mini.getChildNodes(t,!0),s=0,o=n.length;s<o;s++){var l=n[s];l&&l.parentNode&&l.parentNode.removeChild(l)}}},_deferLoadingTime:180,_cancelLoadTabs:function(t){for(var e=this.tabs,i=0,n=e.length;i<n;i++){var s=e[i];s!=t&&s._loading&&s._iframeEl&&(s._loading=!1,this._doRemoveIFrame(s,!0))}t&&t==this.getActiveTab()&&t._loading||(this._loading=!1,this.unmask())},_doLoadTab:function(s){var t,o,l,e;!s||s!=this.getActiveTab()||(t=this.getTabBodyEl(s))&&(this._cancelLoadTabs(),this._doRemoveIFrame(s,!0),this._loading=!0,s._loading=!0,this.unmask(),this.maskOnLoad&&this.loading(),o=new Date,(l=this).isLoading=!0,e=mini.createIFrame(s.url,function(t,e){try{s._iframeEl.contentWindow.Owner=window,s._iframeEl.contentWindow.CloseOwnerWindow=function(t){s.removeAction=t;var e,i=!0;if(s.ondestroy&&("string"==typeof s.ondestroy&&(s.ondestroy=window[s.ondestroy]),s.ondestroy&&((e=l._getTabEvent(s)).action=t,i=s.ondestroy.call(l,e))),!1===i)return!1;setTimeout(function(){l.removeTab(s)},10)}}catch(n){}var i,n;1==s._loading&&(i=o-new Date+l._deferLoadingTime,s._loading=!1,s.loadedUrl=s.url,i<0&&(i=0),setTimeout(function(){l.unmask(),l.doLayout(),l.isLoading=!1},i),e&&(n={sender:l,tab:s,index:l.tabs.indexOf(s),name:s.name,iframe:s._iframeEl},s.onload&&("string"==typeof s.onload&&(s.onload=window[s.onload]),s.onload&&s.onload.call(l,n))),l.getActiveTab()==s&&l.fire("tabload",n))},this.clearTimeStamp,s.method,s.params),setTimeout(function(){s._iframeEl==e&&t.appendChild(e)},1),s._iframeEl=e)},_getTabEvent:function(t){return{sender:this,tab:t,index:this.tabs.indexOf(t),name:t.name,iframe:t._iframeEl,autoActive:!0}},_OnTabDestroy:function(t){t=this._getTabEvent(t);return this.fire("tabdestroy",t),t.autoActive},loadTab:function(t,e,i,n){var s,o;t&&(e=(e=this.getTab(e))||this.getActiveTab())&&((s=this.getTabBodyEl(e))&&mini.addClass(s,"mini-tabs-hideOverflow"),e.url=t,delete e.loadedUrl,i&&(e.onload=i),n&&(e.ondestroy=n),o=this,clearTimeout(this._loadTabTimer),this._loadTabTimer=null,this._loadTabTimer=setTimeout(function(){o._doLoadTab(e)},1))},reloadTab:function(t){(t=(t=this.getTab(t))||this.getActiveTab())&&this.loadTab(t.url,t)},getTabRows:function(){for(var t=[],e=[],i=0,n=this.tabs.length;i<n;i++){var s=this.tabs[i];0!=i&&s.newLine&&(t.push(e),e=[]),e.push(s)}return t.push(e),t},doUpdate:function(){var t,e;!1!==this._allowUpdate&&(this._buttons&&this._buttons.parentNode&&this._buttons.parentNode.removeChild(this._buttons),mini.removeClass(this.el,"mini-tabs-position-left"),mini.removeClass(this.el,"mini-tabs-position-top"),mini.removeClass(this.el,"mini-tabs-position-right"),mini.removeClass(this.el,"mini-tabs-position-bottom"),"bottom"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-bottom"),this._doUpdateBottom()):"right"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-right"),this._doUpdateRight()):"left"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-left"),this._doUpdateLeft()):(mini.addClass(this.el,"mini-tabs-position-top"),this._doUpdateTop()),e=this._headerEl,t="mini-tabs-header-",mini.removeClass(e,"mini-tabs-header-left"),mini.removeClass(e,"mini-tabs-header-top"),mini.removeClass(e,"mini-tabs-header-right"),mini.removeClass(e,"mini-tabs-header-bottom"),mini.addClass(e,"mini-tabs-header-"+this.tabPosition),e=this._bodyEl,t="mini-tabs-body-",mini.removeClass(e,t+"left"),mini.removeClass(e,t+"top"),mini.removeClass(e,t+"right"),mini.removeClass(e,t+"bottom"),mini.addClass(e,t+this.tabPosition),this._buttons&&(e=mini.byClass("mini-tabs-buttons",this.el))&&(e.appendChild(this._buttons),mini.parse(e)),this.doLayout(),this.setActiveIndex(this.activeIndex,!1))},_handleIFrameOverflow:function(){var t,e=this.getTabBodyEl(this.activeIndex);e&&(mini.removeClass(e,"mini-tabs-hideOverflow"),(t=mini.getChildNodes(e)[0])&&t.tagName&&"IFRAME"==t.tagName.toUpperCase()&&mini.addClass(e,"mini-tabs-hideOverflow"))},doLayout:function(){var t=this._headerEl,e=this._bodyEl,i=this.tabPosition;if(this.canLayout()){t.style.display=this.showHeader?"":"none",this._handleIFrameOverflow();var n=this.isAutoHeight(),s=E=this.getHeight(!0),o=S=this.getWidth();this.showBody?e.style.display="":e.style.display="none";var l=this.el.firstChild;if(this.plain?mini.addClass(l,"mini-tabs-plain"):mini.removeClass(l,"mini-tabs-plain"),!n&&this.showBody){var r=jQuery(t).outerHeight(),l=jQuery(t).outerWidth();if("top"!=i&&"bottom"!=i||(r=jQuery(t.parentNode).outerHeight(),--r),"left"==i||"right"==i?S-=l:E-=r,jQuery.boxModel&&(b=mini.getPaddings(e),T=mini.getBorders(e),E=E-b.top-b.bottom-T.top-T.bottom,S=S-b.left-b.right-T.left-T.right),margin=mini.getMargins(e),(E=E-margin.top-margin.bottom)<0&&(E=0),(S=S-margin.left-margin.right)<0&&(S=0),e.style.width=S+"px",e.style.height=E+"px","left"==i||"right"==i){for(var a=(C=(c=t.getElementsByTagName("tr")[0]).childNodes)[0].getElementsByTagName("tr"),h=last=all=0,d=0,u=a.length;d<u;d++){var c=a[d],m=jQuery(c).outerHeight();all+=m,0==d&&(h=m),d==u-1&&(last=m)}switch(this.tabAlign){case"center":for(var f=parseInt((s-(all-h-last))/2),d=0,u=C.length;d<u;d++){C[d].firstChild.style.height=s+"px";var p=(a=(y=C[d].firstChild).getElementsByTagName("tr"))[0],g=a[a.length-1];p.style.height=f+"px",g.style.height=f+"px"}break;case"right":for(d=0,u=C.length;d<u;d++){c=(a=(y=C[d].firstChild).getElementsByTagName("tr"))[0];0<=(_=s-(all-h))&&(c.style.height=_+"px")}break;case"fit":for(d=0,u=C.length;d<u;d++)C[d].firstChild.style.height=s+"px";break;default:for(d=0,u=C.length;d<u;d++){var _,c=(a=(y=C[d].firstChild).getElementsByTagName("tr"))[a.length-1];0<=(_=s-(all-last))&&(c.style.height=_+"px")}}}}else e.style.width="auto",e.style.height="auto";var v=this.getTabBodyEl(this.activeIndex);switch(v&&(!n&&this.showBody?(E=mini.getHeight(e,!0),jQuery.boxModel&&(b=mini.getPaddings(v),T=mini.getBorders(v),E=E-b.top-b.bottom-T.top-T.bottom),v.style.height=E+"px"):v.style.height="auto"),i){case"bottom":for(d=0,u=(x=t.childNodes).length;d<u;d++){var y=x[d];mini.removeClass(y,"mini-tabs-header2"),1<u&&0!=d&&mini.addClass(y,"mini-tabs-header2")}break;case"left":for(d=0,u=(C=t.firstChild.rows[0].cells).length;d<u;d++){var w=C[d];mini.removeClass(w,"mini-tabs-header2"),1<u&&0==d&&mini.addClass(w,"mini-tabs-header2")}break;case"right":for(var C,d=0,u=(C=t.firstChild.rows[0].cells).length;d<u;d++){w=C[d];mini.removeClass(w,"mini-tabs-header2"),1<u&&0!=d&&mini.addClass(w,"mini-tabs-header2")}break;default:for(var x,d=0,u=(x=t.childNodes).length;d<u;d++){y=x[d];mini.removeClass(y,"mini-tabs-header2"),1<u&&0==d&&mini.addClass(y,"mini-tabs-header2")}}mini.removeClass(this.el,"mini-tabs-scroll");var w=mini.byClass("mini-tabs-lastSpace",this.el),n=mini.byClass("mini-tabs-buttons",this.el),b=t.parentNode;b.style.paddingRight="0px",this._navEl&&(this._navEl.style.display="none"),this._leftNavEl&&(this._leftNavEl.style.display="none"),n&&(n.style.display="none");var E,T="right"==this.buttonsAlign;T||(n.style.right="auto",n.style.left="0"),mini.setWidth(b,o),"top"!=i&&"bottom"!=i||"left"!=this.tabAlign&&"right"!=this.tabAlign||(t.style.width="auto",n.style.display="block",(E=o)<t.firstChild.offsetWidth-w.offsetWidth+(b=n.firstChild?n.offsetWidth:0)?(this._navEl.style.display="block",i=this._navEl.offsetWidth,o=0,this.showNavMenu&&(this._headerMenuEl.style.display="inline-block",o=this._headerMenuEl.offsetWidth,this._headerMenuEl.style.right=b+"px",this._headerMenu||this._createHeaderMenu()),n=0,"side"==this.arrowPosition&&(this._leftNavEl.style.display="block",n=this._leftNavEl.offsetWidth,t.style.left=n+"px"),this._navEl.style.right=(T?b:0)+o+"px",S=E-b-i-n-o,mini.setWidth(t,S)):t.style.left="0px",t.style.marginLeft=(T?0:b)+"px"),this._scrollToTab(this.activeIndex),this._doScrollButton(),mini.layout(e);var S,e=this.getActiveTab();e&&e.repaint&&v&&(S=v.style.width,v.style.width="0px",setTimeout(function(){v.style.width=S},1)),this.fire("layout")}},_getTabBy_Id:function(t){for(var e=0,i=this.tabs.length;e<i;e++){var n=this.tabs[e];if(n._id==t)return n}},_createHeaderMenu:function(){this._headerMenu=new mini.Menu,this._headerMenu.setIdField("_id"),this._headerMenu.setTextField("title"),this._headerMenu.setPopupEl(this._headerMenuEl),this._headerMenu.setShowAction("leftclick"),this._headerMenu.setHideAction("outerclick"),this._headerMenu.setXAlign("left"),this._headerMenu.setYAlign("below"),mini.addClass(this._headerMenu.el,"mini-menu-open"),this._headerMenu.on("itemclick",this._doMenuSelectTab,this),this._headerMenu.hide(),this._headerMenu.owner=this._headerMenuEl},_setHeaderMenuItems:function(){for(var t=this.getTabs(),e=[],i=0,n=t.length;i<n;i++){var s=t[i];e.push({id:s._id,text:s[this.titleField]})}this._headerMenu.setItems(e)},_doMenuSelectTab:function(t){t=t.item,t=this._getTabBy_Id(t.id);this.activeTab(t)},setTabAlign:function(t){this.tabAlign=t,this.doUpdate()},setTabPosition:function(t){this.tabPosition=t,this.doUpdate()},allowClickWrap:!0,setAllowClickWrap:function(t){this.allowClickWrap=t},getAllowClickWrap:function(){return this.allowClickWrap},getTab:function(t){if("object"==typeof t)return t;if("number"==typeof t)return this.tabs[t];for(var e=0,i=this.tabs.length;e<i;e++){var n=this.tabs[e];if(n.name==t)return n}},getHeaderEl:function(){return this._headerEl},getBodyEl:function(){return this._bodyEl},getTabEl:function(t){t=this.getTab(t);if(!t)return null;for(var e=this._createTabId(t),i=this.el.getElementsByTagName("*"),n=0,s=i.length;n<s;n++){var o=i[n];if(o.id==e)return o}return null},getTabBodyEl:function(t){t=this.getTab(t);if(!t)return null;for(var e=this._createTabBodyId(t),i=this._bodyEl.childNodes,n=0,s=i.length;n<s;n++){var o=i[n];if(o.id==e)return o}return null},getTabIFrameEl:function(t){t=this.getTab(t);return t?t._iframeEl:null},_createTabId:function(t){return this.uid+"$"+t._id},_createTabBodyId:function(t){return this.uid+"$body$"+t._id},_doScrollButton:function(){var t,e;"top"!=this.tabPosition&&"bottom"!=this.tabPosition||(mini.removeClass(this._leftButtonEl,"mini-disabled"),mini.removeClass(this._rightButtonEl,"mini-disabled"),0==this._headerEl.scrollLeft&&mini.addClass(this._leftButtonEl,"mini-disabled"),(e=this.getTabEl(this.tabs.length-1))&&(t=mini.getBox(e),e=mini.getBox(this._headerEl),t.right<=e.right&&mini.addClass(this._rightButtonEl,"mini-disabled")))},setActiveIndex:function(t,e){var i,n=this.getTab(t),s=n!=(o=this.getTab(this.activeIndex)),t=this.getTabBodyEl(this.activeIndex);if(t&&(t.style.display="none"),this.activeIndex=n?this.tabs.indexOf(n):-1,(t=this.getTabBodyEl(this.activeIndex))&&(t.style.display=""),(t=this.getTabEl(o))&&mini.removeClass(t,this._tabActiveCls),(t=this.getTabEl(n))&&mini.addClass(t,this._tabActiveCls),t&&s){"bottom"==this.tabPosition?(l=mini.findParent(t,"mini-tabs-header"))&&jQuery(this._headerEl).prepend(l):"left"==this.tabPosition?(i=mini.findParent(t,"mini-tabs-header").parentNode)&&i.parentNode.appendChild(i):"right"==this.tabPosition?(i=mini.findParent(t,"mini-tabs-header").parentNode)&&jQuery(i.parentNode).prepend(i):(l=mini.findParent(t,"mini-tabs-header"))&&this.allowClickWrap&&this._headerEl.appendChild(l);this._headerEl.scrollLeft;var o,l=!!(o=this.getTab(this.activeIndex))&&!o._layouted;(this.isAutoHeight()||l)&&(o&&(o._layouted=!0),this.doLayout(),o&&(o._layouted=!1)),1<this.getTabRows().length||(this._scrollToTab(this.activeIndex),this._doScrollButton());for(var r=0,a=this.tabs.length;r<a;r++){var h=this.getTabEl(this.tabs[r]);h&&mini.removeClass(h,this._tabHoverCls)}}var d,u=this;if(s&&(d={tab:n,index:this.tabs.indexOf(n),name:n?n.name:""},setTimeout(function(){u.fire("ActiveChanged",d)},1)),this._cancelLoadTabs(n),!1!==e&&n&&n.url&&!n.loadedUrl&&(u=this).loadTab(n.url,n),n&&(!mini.isChrome||(n=this.getTabIFrameEl(n))&&(n.style.position="relative",n.style.left="1px",n.offsetWidth,n.style.left="0px")),u.canLayout())try{mini.layoutIFrames(u.el)}catch(d){}},_scrollToTab:function(t){var e=this._headerEl.scrollLeft;"top"!=this.tabPosition&&"bottom"!=this.tabPosition||(this._headerEl.scrollLeft=e,(e=this.getTabEl(t))&&(t=mini.getBox(e),e=mini.getBox(this._headerEl),t.x<e.x?this._headerEl.scrollLeft-=e.x-t.x:t.right>e.right&&(this._headerEl.scrollLeft+=t.right-e.right)))},getActiveIndex:function(){return this.activeIndex},activeTab:function(t){this.setActiveIndex(t)},getActiveTab:function(){return this.getTab(this.activeIndex)},_tryActiveTab:function(t){var e;(t=this.getTab(t))&&(e=this.tabs.indexOf(t),this.activeIndex!=e&&(e={tab:t,index:e,name:t.name,cancel:!1},this.fire("BeforeActiveChanged",e),0==e.cancel&&this.activeTab(t)))},setShowHeader:function(t){this.showHeader!=t&&(this.showHeader=t,this.doLayout())},getShowHeader:function(){return this.showHeader},setShowBody:function(t){this.showBody!=t&&(this.showBody=t,this.doLayout())},getShowBody:function(){return this.showBody},setBodyStyle:function(t){this.bodyStyle=t,mini.setStyle(this._bodyEl,t),this.doLayout()},getBodyStyle:function(){return this.bodyStyle},setMaskOnLoad:function(t){this.maskOnLoad=t},getMaskOnLoad:function(){return this.maskOnLoad},setPlain:function(t){this.plain=t,this.doLayout()},getPlain:function(){return this.plain},arrowPosition:"right",setArrowPosition:function(t){this.arrowPosition=t},getArrowPosition:function(){return this.arrowPosition},showNavMenu:!1,setShowNavMenu:function(t){this.showNavMenu=t},getShowNavMenu:function(){return this.showNavMenu},clearTimeStamp:!1,setClearTimeStamp:function(t){this.clearTimeStamp=t},getClearTimeStamp:function(){return this.clearTimeStamp},getTabByEvent:function(t){return this._getTabByEvent(t)},_getTabByEvent:function(t){t=mini.findParent(t.target,"mini-tab");if(!t)return null;if(t.id.split("$")[0]!=this.uid)return null;t=parseInt(jQuery(t).attr("index"));return this.getTab(t)},__OnDblClick:function(t){var e=this._getTabByEvent(t);e&&this.fire("tabdblclick",t={tab:e})},__OnClick:function(e){var i,n,s=this._getTabByEvent(e);!s||((i=!!mini.findParent(e.target,"mini-tab-close"))||s!=this.getActiveTab()||s.refreshOnClick)&&s.enabled&&(n=this,setTimeout(function(){var t;i?n._OnCloseButtonClick(s,e):(t=s.loadedUrl,n._tryActiveTab(s),s.refreshOnClick&&s.url==t&&n.reloadTab(s))},10))},hoverTab:null,__OnMouseOver:function(t){var e=this._getTabByEvent(t);e&&e.enabled&&(t=this.getTabEl(e),mini.addClass(t,this._tabHoverCls),this.hoverTab=e)},__OnMouseOut:function(t){var e;this.hoverTab&&(e=this.getTabEl(this.hoverTab),mini.removeClass(e,this._tabHoverCls)),this.hoverTab=null},__OnMouseDown:function(t){var e,i,n;clearInterval(this._scrollTimer),"top"!=this.tabPosition&&"bottom"!=this.tabPosition||(i=0,n=10,t.target==(e=this)._leftButtonEl?this._scrollTimer=setInterval(function(){e._headerEl.scrollLeft-=n,5<++i&&(n=18),10<i&&(n=25),e._doScrollButton()},25):t.target==this._rightButtonEl?this._scrollTimer=setInterval(function(){e._headerEl.scrollLeft+=n,5<++i&&(n=18),10<i&&(n=25),e._doScrollButton()},25):t.target==this._headerMenuEl&&this._setHeaderMenuItems(),mini.on(document,"mouseup",this.__OnDocMouseUp,this))},__OnDocMouseUp:function(t){clearInterval(this._scrollTimer),this._scrollTimer=null,mini.un(document,"mouseup",this.__OnDocMouseUp,this)},_doUpdateTop:function(){this.tabPosition;var t="";t+='<div class="mini-tabs-scrollCt">',"side"==this.arrowPosition?(t+='<div class="mini-tabs-leftnav"><a class="mini-tabs-leftButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>',t+='<div class="mini-tabs-nav"><a class="mini-tabs-rightButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>'):t+='<div class="mini-tabs-nav"><a class="mini-tabs-leftButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a><a class="mini-tabs-rightButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>',this.showNavMenu&&(t+='<a class="mini-tabs-tabmenu mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a>'),t+='<div class="mini-tabs-buttons" a=1 style="'+("right"==this.buttonsAlign?"":"right:auto;left:0;")+'"></div>',t+='<div class="mini-tabs-headers">';for(var e=this.getTabRows(),i=0,n=e.length;i<n;i++){var s=e[i],o="";t+='<table class="mini-tabs-header" cellspacing="0" cellpadding="0"><tr><td class="mini-tabs-space mini-tabs-firstSpace"><div></div></td>';for(var l=0,r=s.length;l<r;l++){var a,h=s[l],d=this._createTabId(h);h.visible&&(a=this.tabs.indexOf(h),o=h.headerCls||"",0==h.enabled&&(o+=" mini-disabled"),t+='<td title="'+h.tooltip+'" id="'+d+'" index="'+a+'"  class="mini-tab mini-corner-all '+o+'" style="'+h.headerStyle+'">',(h.iconCls||h.iconStyle)&&(t+='<span class="mini-tab-icon mini-iconfont '+h.iconCls+'" style="'+h.iconStyle+'"></span>'),t+='<span class="mini-tab-text">'+h.title+"</span>",h.showCloseButton&&(a="",t+='<span class="mini-tab-close mini-icon" '+(a=h.enabled?"onmouseover=\"mini.addClass(this, 'mini-tab-close-hover')\" onmouseout=\"mini.removeClass(this, 'mini-tab-close-hover')\"":a)+" ></span>"),t+="</td>",l!=r-1&&(t+='<td class="mini-tabs-space2"><div></div></td>'))}t+='<td class="mini-tabs-space mini-tabs-lastSpace" ><div></div></td></tr></table>'}t+="</div>",t+="</div>",this._doClearElement(),mini.prepend(this._td2El,t);var u=this._td2El;switch(this._headerEl=u.firstChild.lastChild,"side"==this.arrowPosition?(this._leftNavEl=u.firstChild.firstChild,this._navEl=this._headerEl.parentNode.children[1],this._leftButtonEl=this._leftNavEl.firstChild,this._rightButtonEl=this._navEl.firstChild,this.showNavMenu&&(this._headerMenuEl=this._headerEl.parentNode.children[2])):(this._navEl=this._headerEl.parentNode.firstChild,this._leftButtonEl=this._navEl.firstChild,this._rightButtonEl=this._navEl.childNodes[1],this.showNavMenu&&(this._headerMenuEl=this._headerEl.parentNode.children[1])),this.showNavMenu&&this._headerMenu&&this._headerMenu.setPopupEl(this._headerMenuEl),this.tabAlign){case"center":for(l=0,r=(c=this._headerEl.childNodes).length;l<r;l++)(m=c[l].getElementsByTagName("td"))[0].style.width="50%",m[m.length-1].style.width="50%";break;case"right":for(l=0,r=(c=this._headerEl.childNodes).length;l<r;l++)(m=c[l].getElementsByTagName("td"))[0].style.width="100%";break;case"fit":break;default:for(var c,m,l=0,r=(c=this._headerEl.childNodes).length;l<r;l++)(m=c[l].getElementsByTagName("td"))[m.length-1].style.width="100%"}},_doUpdateBottom:function(){this._doUpdateTop();var t=this._td2El;mini.append(t,t.firstChild),this._headerEl=t.lastChild.lastChild},_doUpdateLeft:function(){for(var t='<table cellspacing="0" cellpadding="0"><tr>',e=this.getTabRows(),i=0,n=e.length;i<n;i++){var s=e[i];t+='<td class="'+(r=1<n&&i!=n-1?"mini-tabs-header2":"")+'"><table class="mini-tabs-header" cellspacing="0" cellpadding="0">',t+='<tr ><td class="mini-tabs-space mini-tabs-firstSpace" ><div></div></td></tr>';for(var o=0,l=s.length;o<l;o++){var r,a,h=s[o],d=this._createTabId(h);h.visible&&(a=this.tabs.indexOf(h),r=h.headerCls||"",0==h.enabled&&(r+=" mini-disabled"),t+='<tr><td id="'+d+'" index="'+a+'"  class="mini-tab '+r+'" style="'+h.headerStyle+'">',(h.iconCls||h.iconStyle)&&(t+='<span class="mini-tab-icon mini-iconfont '+h.iconCls+'" style="'+h.iconStyle+'"></span>'),t+='<span class="mini-tab-text">'+h.title+"</span>",h.showCloseButton&&(a="",t+='<span class="mini-tab-close mini-icon" '+(a=h.enabled?"onmouseover=\"mini.addClass(this, 'mini-tab-close-hover')\" onmouseout=\"mini.removeClass(this, 'mini-tab-close-hover')\"":a)+"></span>"),t+="</td></tr>",o!=l-1&&(t+='<tr><td class="mini-tabs-space2"><div></div></td></tr>'))}t+='<tr ><td class="mini-tabs-space mini-tabs-lastSpace" ><div></div></td></tr>',t+="</table></td>"}t+="</tr ></table>",this._doClearElement(),mini.addClass(this._td1El,"mini-tabs-header"),mini.append(this._td1El,t),this._headerEl=this._td1El},_doUpdateRight:function(){this._doUpdateLeft(),mini.removeClass(this._td1El,"mini-tabs-header"),mini.removeClass(this._td3El,"mini-tabs-header"),mini.append(this._td3El,this._td1El.firstChild),this._headerEl=this._td3El},_OnCloseButtonClick:function(t,e){var i,e={tab:t,index:this.tabs.indexOf(t),name:t.name.toLowerCase(),htmlEvent:e,cancel:!1};if(this.fire("beforecloseclick",e),1!=e.cancel){try{t._iframeEl&&t._iframeEl.contentWindow&&(i=!0,t._iframeEl.contentWindow.CloseWindow?i=t._iframeEl.contentWindow.CloseWindow("close"):t._iframeEl.contentWindow.CloseOwnerWindow&&(i=t._iframeEl.contentWindow.CloseOwnerWindow("close")),!1===i&&(e.cancel=!0))}catch(ex){}1!=e.cancel&&(t.removeAction="close",this.removeTab(t),this.fire("closeclick",e))}},onBeforeCloseClick:function(t,e){this.on("beforecloseclick",t,e)},onCloseClick:function(t,e){this.on("closeclick",t,e)},onActiveChanged:function(t,e){this.on("activechanged",t,e)},getAttrs:function(t){var e=mini.Tabs.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["tabAlign","tabPosition","bodyStyle","onactivechanged","onbeforeactivechanged","url","ontabload","ontabdestroy","onbeforecloseclick","oncloseclick","ontabdblclick","titleField","urlField","nameField","loadingMsg","buttons","arrowPosition","buttonsAlign"]),mini._ParseBool(t,e,["allowAnim","showBody","showHeader","maskOnLoad","plain","allowClickWrap","showNavMenu","clearTimeStamp"]),mini._ParseInt(t,e,["activeIndex"]);for(var i=[],n=mini.getChildNodes(t),s=0,o=n.length;s<o;s++){var l=n[s],r={};i.push(r),r.style=l.style.cssText,mini._ParseString(l,r,["name","title","url","cls","iconCls","iconStyle","headerCls","headerStyle","bodyCls","bodyStyle","onload","ondestroy","data-options","tooltip"]),mini._ParseBool(l,r,["newLine","visible","enabled","showCloseButton","refreshOnClick"]),r.bodyParent=l;l=r["data-options"];(l=l&&window.eval("("+l+")"))&&mini.copyTo(r,l)}return e.tabs=i,e}}),mini.regClass(mini.Tabs,"tabs"),mini.Menu=function(){this.items=[],mini.Menu.superclass.constructor.apply(this,arguments)},mini.extend(mini.Menu,mini.Control),mini.copyTo(mini.Menu.prototype,mini.Popup_prototype);var mini_Popup_prototype_hide=mini.Popup_prototype.hide;mini.copyTo(mini.Menu.prototype,{height:"auto",width:"auto",minWidth:140,vertical:!0,allowSelectItem:!1,_selectedItem:null,_itemSelectedCls:"mini-menuitem-selected",textField:"text",resultAsTree:!1,idField:"id",parentField:"pid",itemsField:"children",iconClsField:"iconCls",showNavArrow:!0,imgPath:"",overflow:!1,_clearBorder:!1,showAction:"none",hideAction:"outerclick",menuAlign:"",setMenuAlign:function(t){this.menuAlign=t},getMenuAlign:function(){return this.menuAlign},getbyName:function(t){for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];if(n.name==t)return n;if(n.menu){n=n.menu.getbyName(t);if(n)return n}}return null},set:function(t){if("string"==typeof t)return this;var e=t.url;return delete t.url,t.imgPath&&this.setImgPath(t.imgPath),delete t.imgPath,this.ownerItem=t.ownerItem,delete t.ownerItem,mini.Menu.superclass.set.call(this,t),e&&this.setUrl(e),this},uiCls:"mini-menu",_create:function(){this.el=document.createElement("div"),this.el.className="mini-menu",this.el.innerHTML='<div class="mini-menu-border"><a class="mini-menu-topArrow mini-icon" href="#" onclick="return false"></a><div class="mini-menu-inner"></div><a class="mini-menu-bottomArrow mini-icon" href="#" onclick="return false"></a></div>',this._borderEl=this.el.firstChild,this._topArrowEl=this._borderEl.childNodes[0],this._bottomArrowEl=this._borderEl.childNodes[2],this._innerEl=this._borderEl.childNodes[1],this._innerEl.innerHTML='<div class="mini-menu-float"></div><div class="mini-menu-toolbar"></div><div style="clear:both;max-height: 1px;"></div>',this._contentEl=this._innerEl.firstChild,this._toolbarEl=this._innerEl.childNodes[1],0==this.isVertical()&&mini.addClass(this.el,"mini-menu-horizontal")},destroy:function(t){if(this.items)for(var e=0,i=this.items.length;e<i;e++)this.items[e].destroy();this._topArrowEl&&(this._topArrowEl.onmousedown=this._bottomArrowEl.onmousedown=null),this._popupEl=this.popupEl=this._borderEl=this._innerEl=this._contentEl=this._toolbarEl=null,this._topArrowEl=this._bottomArrowEl=null,this.owner=null,this.window=null,mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this),mini.Menu.superclass.destroy.call(this,t)},_disableContextMenu:!1,_initEvents:function(){mini._BindEvents(function(){mini.on(document,"mousedown",this.__OnBodyMouseDown,this),mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this),this._disableContextMenu&&mini_onOne(this.el,"contextmenu",function(t){t.preventDefault()},this),mini_onOne(this._topArrowEl,"mousedown",this.__OnTopMouseDown,this),mini_onOne(this._bottomArrowEl,"mousedown",this.__OnBottomMouseDown,this)},this)},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=0,i=this.items.length;e<i;e++)if(this.items[e].within(t))return!0;return!1},setVertical:function(t){(this.vertical=t)?mini.removeClass(this.el,"mini-menu-horizontal"):mini.addClass(this.el,"mini-menu-horizontal")},getVertical:function(){return this.vertical},isVertical:function(){return this.vertical},show:function(){this.setVisible(!0)},hide:function(){this.hideItems(),mini_Popup_prototype_hide.call(this)},hideItems:function(){for(var t=0,e=this.items.length;t<e;t++)this.items[t].hideMenu()},showItemMenu:function(t){for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];n==t?n.showMenu():n.hideMenu()}},hasShowItemMenu:function(){for(var t=0,e=this.items.length;t<e;t++){var i=this.items[t];if(i&&i.menu&&i.menu.isPopup)return!0}return!1},setData:function(t){mini.isArray(t)||(t=[]),this.setItems(t)},getData:function(){return this.getItems()},setItems:function(t){mini.isArray(t)||(t=[]),this.removeAll();new Date;for(var e=0,i=t.length;e<i;e++)this.addItem(t[e])},getItems:function(){return this.items},_itemType:"menuitem",addItem:function(t){var e;"-"!=t&&"|"!=t&&"separator"!=t.type?(mini.isControl(t)||mini.getClass(t.type)||(t.type=this._itemType),t.ownerMenu=this,t=mini.getAndCreate(t),this.items.push(t),this._contentEl.appendChild(t.el),(t.ownerMenu=this).fire("itemschanged")):(e=t.id?'id="'+t.id+'"':"",mini.append(this._contentEl,"<span "+e+' name="'+(t.name||"")+'" class="mini-separator"></span>'))},removeItem:function(t){(t=mini.get(t))&&(this.items.remove(t),this._contentEl.removeChild(t.el),this.fire("itemschanged"))},removeItemAt:function(t){t=this.items[t];this.removeItem(t)},removeAll:function(){for(var t=this.items.clone(),e=t.length-1;0<=e;e--)this.removeItem(t[e]);this._contentEl.innerHTML=""},getGroupItems:function(t){if(!t)return[];for(var e=[],i=0,n=this.items.length;i<n;i++){var s=this.items[i];s.groupName==t&&e.push(s)}return e},getItem:function(t){if("number"==typeof t)return this.items[t];if("string"!=typeof t)return t&&-1!=this.items.indexOf(t)?t:null;for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];if(n.id==t)return n}return null},setAllowSelectItem:function(t){this.allowSelectItem=t},getAllowSelectItem:function(){return this.allowSelectItem},setSelectedItem:function(t){t=this.getItem(t),this._OnItemSelect(t)},getSelectedItem:function(t){return this._selectedItem},setShowNavArrow:function(t){this.showNavArrow=t},getShowNavArrow:function(){return this.showNavArrow},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},setResultAsTree:function(t){this.resultAsTree=t},getResultAsTree:function(){return this.resultAsTree},setIdField:function(t){this.idField=t},getIdField:function(){return this.idField},setParentField:function(t){this.parentField=t},getParentField:function(){return this.parentField},setIconClsField:function(t){this.iconClsField=t},getIconClsField:function(){return this.iconClsField},setOverflow:function(t){(this.overflow=t)?mini.addClass(this.el,"mini-menu-overflow"):mini.removeClass(this.el,"mini-menu-overflow")},getOverflow:function(){return this.overflow},doLayout:function(){var t,e,i,n;this.canLayout()&&(t=this._innerEl,e=this._topArrowEl,i=this._bottomArrowEl,this.isAutoHeight()?(this._borderEl.style.height="auto",this._contentEl.style.height="auto"):(n=mini.getHeight(this.el,!0),mini.setHeight(this._borderEl,n),e.style.display=i.style.display="none",this._contentEl.style.height="auto",this.showNavArrow&&this._borderEl.scrollHeight>this._borderEl.clientHeight+2?(e.style.display=i.style.display="block",(n=(n=mini.getHeight(this._borderEl,!0))-mini.getHeight(e)-mini.getHeight(i))<0&&(n=0),mini.setHeight(this._contentEl,n),n=mini.getWidth(this._borderEl,!0),mini.setWidth(e,n),mini.setWidth(i,n)):this._contentEl.style.height="auto"),this.overflow&&(e.style.display=i.style.display="none",t.style.marginLeft=t.style.marginRight="0px",this._getScrollWidth()>this._innerEl.offsetWidth?(e.style.display=i.style.display="block",t.style.marginLeft=t.style.marginRight="15px"):t.scrollLeft=0))},_measureSize:function(){var t,e;"auto"==this.height&&(this.el.style.height="auto",this._borderEl.style.height="auto",this._contentEl.style.height="auto",this._topArrowEl.style.display=this._bottomArrowEl.style.display="none",t=mini.getViewportBox(),e=mini.getBox(this.el),this.maxHeight=t.height-2,this.ownerItem&&(this.maxHeight=t.height-2)),this.el.style.display="",(e=mini.getBox(this.el)).width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),e=mini.getBox(this.el)),e.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),e=mini.getBox(this.el)),e.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),e=mini.getBox(this.el)),e.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),e=mini.getBox(this.el))},url:"",_doLoad:function(){var t=mini._getResult(this.url,null,null,null,null,this.dataField),t=(t=this.dataField&&!mini.isArray(t)?mini._getMap(this.dataField,t):t)||[];0==this.resultAsTree&&(t=mini.arrayToTree(t,this.itemsField,this.idField,this.parentField));for(var e=mini.treeToArray(t,this.itemsField,this.idField,this.parentField),i=0,n=e.length;i<n;i++){var s=e[i];s.text=mini._getMap(this.textField,s),s.iconCls=mini._getMap(this.iconClsField,s),mini.isNull(s.text)&&(s.text="")}new Date;this.setItems(t),this.fire("load")},loadList:function(t,e,i){if(t){e=e||this.idField,i=i||this.parentField;for(var n=0,s=t.length;n<s;n++){var o=t[n];o.text=mini._getMap(this.textField,o),o.iconCls=mini._getMap(this.iconClsField,o),mini.isNull(o.text)&&(o.text="")}i=mini.arrayToTree(t,this.itemsField,e,i);this.load(i)}},load:function(t){"string"==typeof t?this.setUrl(t):this.setItems(t)},setUrl:function(t){this.url=t,this._doLoad()},getUrl:function(){return this.url},hideOnClick:!0,setHideOnClick:function(t){this.hideOnClick=t},getHideOnClick:function(){return this.hideOnClick},setImgPath:function(t){this.imgPath=t},getImgPath:function(){return this.imgPath},_OnItemClick:function(t,e){e={item:t,isLeaf:!t.menu,htmlEvent:e};this.hideOnClick&&(this.isPopup?this.hide():e.isLeaf&&this.hideItems()),this.allowSelectItem&&this._selectedItem!=t&&this.setSelectedItem(t),this.fire("itemclick",e),this.ownerItem},_OnItemSelect:function(t){this._selectedItem&&this._selectedItem.removeCls(this._itemSelectedCls),this._selectedItem=t,this._selectedItem&&this._selectedItem.addCls(this._itemSelectedCls);t={item:this._selectedItem,isLeaf:!!this._selectedItem&&!this._selectedItem.menu};this.fire("itemselect",t)},onItemClick:function(t,e){this.on("itemclick",t,e)},onItemSelect:function(t,e){this.on("itemselect",t,e)},__OnTopMouseDown:function(t){this._startScrollMove(-20)},__OnBottomMouseDown:function(t){this._startScrollMove(20)},_getScrollWidth:function(){var t=0,e=jQuery(".mini-menuitem",this.el).first()[0],i=jQuery(".mini-menuitem",this.el).last()[0];return e&&i&&(e=mini.getBox(e),t=mini.getBox(i).right-e.left),t},_getMaxScrollLeft:function(){return parseInt(this._getScrollWidth()-this._innerEl.offsetWidth+6)},_startScrollMove:function(e){clearInterval(this._scrollTimer);var t=function(){clearInterval(n._scrollTimer),mini.un(document,"mouseup",t)};mini.on(document,"mouseup",t);var i=this._getMaxScrollLeft(),n=this;this._scrollTimer=setInterval(function(){var t;0==n.isVertical()?(t=n._innerEl.scrollLeft,n._innerEl.scrollLeft=t=i<(t+=e)?i:t):n._contentEl.scrollTop+=e},50)},setToolbar:function(t){__mini_setControls(t,this._toolbarEl,this),this._toolbarEl.style.display="block"},parseItems:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s,o,l,r=t[i];"separator"!=r.className?(o=(l=mini.getChildNodes(r))[0],s=l[1],l=new mini.MenuItem,s?(mini.applyTo.call(l,o),l.render(document.body),o=new mini.Menu,mini.applyTo.call(o,s),l.setMenu(o),o.render(document.body)):mini.applyTo.call(l,r),e.add(l)):(l={type:"separator",id:r.id,name:r.name},e.add(l))}return e.clone()},getAttrs:function(t){var e=mini.Menu.superclass.getAttrs.call(this,t),i=jQuery(t);mini._ParseString(t,e,["popupEl","popupCls","showAction","hideAction","xAlign","yAlign","modalStyle","onbeforeopen","open","onbeforeclose","onclose","url","onitemclick","onitemselect","textField","idField","parentField","toolbar","imgPath","iconClsField","menuAlign"]),mini._ParseBool(t,e,["resultAsTree","hideOnClick","showNavArrow","showShadow","overflow"]);for(var n=(l=mini.getChildNodes(t)).length-1;0<=n;n--){var s=l[n],o=jQuery(s).attr("property");o&&"toolbar"==(o=o.toLowerCase())&&(e.toolbar=s).parentNode.removeChild(s)}var l=mini.getChildNodes(t),t=this.parseItems(l);0<t.length&&(e.items=t);t=i.attr("vertical");t&&(e.vertical="true"==t);i=i.attr("allowSelectItem");return i&&(e.allowSelectItem="true"==i),e}}),mini.regClass(mini.Menu,"menu"),mini.MenuBar=function(){mini.MenuBar.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuBar,mini.Menu,{uiCls:"mini-menubar",vertical:!1,setVertical:function(t){this.vertical=!1}}),mini.regClass(mini.MenuBar,"menubar"),mini.ContextMenu=function(){mini.ContextMenu.superclass.constructor.apply(this,arguments)},mini.extend(mini.ContextMenu,mini.Menu,{uiCls:"mini-contextmenu",vertical:!0,visible:!1,_disableContextMenu:!0,setVertical:function(t){this.vertical=!0}}),mini.regClass(mini.ContextMenu,"contextmenu"),mini.MenuItem=function(){mini.MenuItem.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuItem,mini.Control,{text:"",iconCls:"",iconStyle:"",iconPosition:"left",img:"",showIcon:!0,showAllow:!0,checked:!1,checkOnClick:!1,groupName:"",_hoverCls:"mini-menuitem-hover",_pressedCls:"mini-menuitem-pressed",_checkedCls:"mini-menuitem-checked",_clearBorder:!1,menu:null,set:function(t){return"string"==typeof t||(this.ownerMenu=t.ownerMenu,delete t.ownerMenu,mini.MenuItem.superclass.set.call(this,t)),this},uiCls:"mini-menuitem",_create:function(){this.el=document.createElement("div");this.el.className="mini-menuitem",this.el.innerHTML='<div class="mini-menuitem-inner"><div class="mini-menuitem-icon mini-icon mini-iconfont"></div><div class="mini-menuitem-text"></div><div class="mini-menuitem-allow mini-icon"></div></div>',this._innerEl=this.el.firstChild,this._iconEl=this._innerEl.firstChild,this._textEl=this._innerEl.childNodes[1],this.allowEl=this._innerEl.lastChild},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this)},this)},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini_onOne(this.el,"click",this.__OnClick,this),mini_onOne(this.el,"mouseup",this.__OnMouseUp,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this))},destroy:function(t){this.menu&&this.menu.destroy(),this.menu=this._innerEl=this._iconEl=this._textEl=this.allowEl=null,mini.MenuItem.superclass.destroy.call(this,t)},within:function(t){return!!mini.isAncestor(this.el,t.target)||!(!this.menu||!this.menu.within(t))},_getIconImg:function(){return this.img&&this.getTopMenu()?this.getTopMenu().imgPath+this.img:this.img},_doUpdateIcon:function(){var t=this._getIconImg(),e=!!(this.iconStyle||this.iconCls||this.checkOnClick||t);this._iconEl&&(mini.setStyle(this._iconEl,this.iconStyle),mini.addClass(this._iconEl,this.iconCls),t&&!this.checked&&mini.setStyle(this._iconEl,"background-image:url("+t+")"),this.checked&&jQuery(this._iconEl).css({"background-image":""}),this._iconEl.style.display=e?"block":"none"),"top"==this.iconPosition?mini.addClass(this.el,"mini-menuitem-icontop"):mini.removeClass(this.el,"mini-menuitem-icontop")},_hasChildMenu:function(){return this.menu&&0<this.menu.items.length},doUpdate:function(){this._textEl&&(this._textEl.innerHTML=this.text),this._doUpdateIcon(),this.checked?(mini.addClass(this.el,this._checkedCls),jQuery(this._iconEl).css({"background-image":""})):mini.removeClass(this.el,this._checkedCls),this.allowEl&&(this._hasChildMenu()?this.allowEl.style.display="block":this.allowEl.style.display="none")},setText:function(t){this.text=t,this._textEl&&(this._textEl.innerHTML=this.text)},getText:function(){return this.text},setIconCls:function(t){mini.removeClass(this._iconEl,this.iconCls),this.iconCls=t,this._doUpdateIcon()},getIconCls:function(){return this.iconCls},setImg:function(t){this.img=t,this._doUpdateIcon()},getImg:function(){return this.img},setIconStyle:function(t){this.iconStyle=t,this._doUpdateIcon()},getIconStyle:function(){return this.iconStyle},setIconPosition:function(t){this.iconPosition=t,this._doUpdateIcon()},getIconPosition:function(){return this.iconPosition},setCheckOnClick:function(t){(this.checkOnClick=t)?mini.addClass(this.el,"mini-menuitem-showcheck"):mini.removeClass(this.el,"mini-menuitem-showcheck"),this.doUpdate()},getCheckOnClick:function(){return this.checkOnClick},setChecked:function(t){this.checked!=t&&(this.checked=t,this.doUpdate(),this.fire("checkedchanged"))},getChecked:function(){return this.checked},setGroupName:function(t){this.groupName!=t&&(this.groupName=t)},getGroupName:function(){return this.groupName},setChildren:function(t){this.setMenu(t)},setMenu:function(t){mini.isArray(t)&&(t={type:"menu",items:t}),this.menu!==t&&((t.ownerItem=this).menu=mini.getAndCreate(t),this.menu.hide(),(this.menu.ownerItem=this).doUpdate(),this.menu.on("itemschanged",this.__OnItemsChanged,this))},getMenu:function(){return this.menu},showMenu:function(){var t;this.menu&&0==this.menu.isDisplay()&&(this.menu.setHideAction("outerclick"),t={xAlign:"outright",yAlign:"top",popupCls:"mini-menu-popup",alwaysView:!0},this.ownerMenu&&0==this.ownerMenu.vertical&&(t.xAlign=this.ownerMenu.menuAlign||"left",t.yAlign="below",t.outXAlign="right"),this.menu.showAtEl(this.el,t),this.menu.addCls("mini-menu-open"))},hideMenu:function(){this.menu&&this.menu.hide()},hide:function(){this.hideMenu(),this.setVisible(!1)},__OnItemsChanged:function(t){this.doUpdate()},getTopMenu:function(){return this.ownerMenu?this.ownerMenu.ownerItem?this.ownerMenu.ownerItem.getTopMenu():this.ownerMenu:null},__OnClick:function(t){if(!this.isReadOnly()){if(this.checkOnClick)if(this.ownerMenu&&this.groupName){var e=this.ownerMenu.getGroupItems(this.groupName);if(0<e.length){if(0==this.checked){for(var i=0,n=e.length;i<n;i++){var s=e[i];s!=this&&s.setChecked(!1)}this.setChecked(!0)}}else this.setChecked(!this.checked)}else this.setChecked(!this.checked);this.fire("click");var o=this.getTopMenu();o&&o._OnItemClick(this,t)}},__OnMouseUp:function(t){var e;this.isReadOnly()||this.ownerMenu&&(e=this,setTimeout(function(){e.isDisplay()&&e.ownerMenu.showItemMenu(e)},1))},__OnMouseOver:function(t){this.isReadOnly()||(this._initInputEvents(),mini.addClass(this.el,this._hoverCls),this.el.title=this.text,this._textEl.scrollWidth>this._textEl.clientWidth?this.el.title=this.text:this.el.title="",this.ownerMenu&&(1==this.ownerMenu.isVertical()||this.ownerMenu.hasShowItemMenu())&&this.ownerMenu.showItemMenu(this))},__OnMouseOut:function(t){mini.removeClass(this.el,this._hoverCls)},onClick:function(t,e){this.on("click",t,e)},onCheckedChanged:function(t,e){this.on("checkedchanged",t,e)},getAttrs:function(t){var e=mini.MenuItem.superclass.getAttrs.call(this,t);jQuery(t);return e.text=t.innerHTML,mini._ParseString(t,e,["text","iconCls","iconStyle","iconPosition","groupName","onclick","oncheckedchanged"]),mini._ParseBool(t,e,["checkOnClick","checked"]),e}}),mini.regClass(mini.MenuItem,"menuitem"),mini.Separator=function(){mini.Separator.superclass.constructor.apply(this,arguments)},mini.extend(mini.Separator,mini.Control,{_clearBorder:!1,uiCls:"mini-separator",_create:function(){this.el=document.createElement("span"),this.el.className="mini-separator"}}),mini.regClass(mini.Separator,"separator"),mini.Pager=function(){mini.Pager.superclass.constructor.apply(this,arguments)},mini.extend(mini.Pager,mini.Control,{pageIndex:0,pageSize:10,totalCount:0,totalPage:0,showPageIndex:!0,showPageSize:!0,showTotalCount:!0,showPageInfo:!0,showReloadButton:!0,_clearBorder:!1,showButtonText:!1,showButtonIcon:!0,sizeText:"",firstText:"首页",prevText:"上一页",nextText:"下一页",lastText:"尾页",reloadText:"刷新",pageInfoText:"每页 {0} 条, 共 {1} 条",sizeList:[10,20,50,100],set:function(t){if("string"==typeof t)return this;var e=t.pageIndex;return delete t.pageIndex,mini.Pager.superclass.set.call(this,t),mini.isNull(e)||this.setPageIndex(e),this},uiCls:"mini-pager",_create:function(){this.el=document.createElement("div"),this.el.className="mini-pager";var t='<div class="mini-pager-left"><table cellspacing="0" cellpadding="0" border="0"><tr><td></td><td></td></tr></table></div><div class="mini-pager-right"></div>';(isIE6||isIE7)&&(t+='<div class="mini-clearfix"></div>',mini.addClass(this.el,"mini-clearfix")),this.el.innerHTML=t,this._leftEl=this.el.childNodes[0],this._rightEl=this.el.childNodes[1];t=this._leftEl.getElementsByTagName("td");this._barEl=t[0],this._barEl2=t[1],this.sizeEl=mini.append(this._barEl,'<span class="mini-pager-size"></span>'),this.sizeTextEl=mini.before(this.sizeEl,'<span class="mini-pager-sizetext"></span>'),this.sizeCombo=new mini.ComboBox,this.pageSizeWidth&&this.sizeCombo.setWidth(this.pageSizeWidth),this.sizeCombo.render(this.sizeEl),mini.append(this.sizeEl,'<span class="separator"></span>'),this.firstButton=new mini.Button,this.firstButton.addCls("mini-pager-firstbutton"),this.firstButton.render(this._barEl),this.prevButton=new mini.Button,this.prevButton.addCls("mini-pager-prevbutton"),this.prevButton.render(this._barEl),this.indexEl=document.createElement("span"),this.indexEl.className="mini-pager-index",this.indexEl.innerHTML='<input type="text" class="mini-pager-num"/><span class="mini-pager-pages">/ 0</span>',this._barEl.appendChild(this.indexEl),this.numInput=this.indexEl.firstChild,this.pagesLabel=this.indexEl.lastChild,this.nextButton=new mini.Button,this.nextButton.addCls("mini-pager-nextbutton"),this.nextButton.render(this._barEl),this.lastButton=new mini.Button,this.lastButton.addCls("mini-pager-lastbutton"),this.lastButton.render(this._barEl),mini.append(this._barEl,'<span class="separator"></span>'),this.reloadButton=new mini.Button,this.reloadButton.render(this._barEl),this.firstButton.setPlain(!0),this.prevButton.setPlain(!0),this.nextButton.setPlain(!0),this.lastButton.setPlain(!0),this.reloadButton.setPlain(!0),this.buttonsEl=mini.append(this._barEl2,'<div class="mini-page-buttons"></div>'),this.update()},destroy:function(t){this.pageSelect&&(mini.clearEvent(this.pageSelect),this.pageSelect=null),this.numInput&&(mini.clearEvent(this.numInput),this.numInput=null),this.sizeEl=this.sizeTextEl=this._barEl=this._barEl2=this._leftEl=this._rightEl=this.indexEl=this.buttonsEl=null,mini.Pager.superclass.destroy.call(this,t)},setButtons:function(t){__mini_setControls(t,this.buttonsEl,this)},getButtonsEl:function(){return this.buttonsEl},_initEvents:function(){function e(){var t;i||(i=!0,t=parseInt(this.numInput.value),isNaN(t)?this.update():this._OnPageChanged(t-1),setTimeout(function(){i=!1},100))}mini.Pager.superclass._initEvents.call(this),this.firstButton.on("click",function(t){this._OnPageChanged(0)},this),this.prevButton.on("click",function(t){this._OnPageChanged(this.pageIndex-1)},this),this.nextButton.on("click",function(t){this._OnPageChanged(this.pageIndex+1)},this),this.lastButton.on("click",function(t){this._OnPageChanged(this.totalPage)},this),this.reloadButton.on("click",function(t){this._OnPageChanged()},this);var i=!1;mini.on(this.numInput,"change",function(t){e.call(this)},this),mini.on(this.numInput,"keydown",function(t){13==t.keyCode&&(e.call(this),t.stopPropagation())},this),this.sizeCombo.on("valuechanged",this.__OnPageSelectChanged,this)},doLayout:function(){this.canLayout()&&(mini.layout(this._leftEl),mini.layout(this._rightEl))},setPageIndex:function(t){isNaN(t)||(this.pageIndex=t,this.update())},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){isNaN(t)||(this.pageSize=t,this.update())},getPageSize:function(){return this.pageSize},setTotalCount:function(t){t=parseInt(t),isNaN(t)||(this.totalCount=t,this.update())},getTotalCount:function(){return this.totalCount},setSizeList:function(t){mini.isArray(t)&&(this.sizeList=t,this.update())},getSizeList:function(){return this.sizeList},pageSizeWidth:null,setPageSizeWidth:function(t){t=parseInt(t),isNaN(t)||this.pageSizeWidth!=t&&(this.pageSizeWidth=t,this.sizeCombo.setWidth(t))},getPageSizeWidth:function(){return this.pageSizeWidth},setShowPageSize:function(t){this.showPageSize=t,this.update()},getShowPageSize:function(){return this.showPageSize},setShowPageIndex:function(t){this.showPageIndex=t,this.update()},getShowPageIndex:function(){return this.showPageIndex},setShowTotalCount:function(t){this.showTotalCount=t,this.update()},getShowTotalCount:function(){return this.showTotalCount},setShowPageInfo:function(t){this.showPageInfo=t,this.update()},getShowPageInfo:function(){return this.showPageInfo},setShowReloadButton:function(t){this.showReloadButton=t,this.update()},getShowReloadButton:function(){return this.showReloadButton},setShowButtonText:function(t){this.showButtonText=t,this.update()},getShowButtonText:function(){return this.showButtonText},setShowButtonIcon:function(t){this.showButtonIcon=t,this.update()},getShowButtonIcon:function(){return this.showButtonIcon},getTotalPage:function(){return this.totalPage},update:function(t,e,i){mini.isNumber(t)&&(this.pageIndex=parseInt(t)),mini.isNumber(e)&&(this.pageSize=parseInt(e)),mini.isNumber(i)&&(this.totalCount=parseInt(i)),this.totalPage=parseInt(this.totalCount/this.pageSize)+1,(this.totalPage-1)*this.pageSize==this.totalCount&&--this.totalPage,0==this.totalCount&&(this.totalPage=0),0<=this.totalCount&&this.pageIndex>this.totalPage-1&&(this.pageIndex=this.totalPage-1),this.pageIndex<=0&&(this.pageIndex=0),this.totalPage<=0&&(this.totalPage=0),this.firstButton.enable(),this.prevButton.enable(),this.nextButton.enable(),this.lastButton.enable(),0==this.pageIndex&&(this.firstButton.disable(),this.prevButton.disable()),this.pageIndex>=this.totalPage-1&&(this.nextButton.disable(),this.lastButton.disable());var n=-1<this.pageIndex?this.pageIndex+1:0;0==this.totalCount&&(n=0),this.numInput.value=n,this.pagesLabel.innerHTML="/ "+this.totalPage;var s=this.sizeList.clone();-1==s.indexOf(this.pageSize)&&(s.push(this.pageSize),s=s.sort(function(t,e){return e<t}));for(var o=[],l=0,r=s.length;l<r;l++){var a=s[l],h={};h.text=a,h.id=a,o.push(h)}this.sizeCombo.setData(o),this.sizeCombo.setValue(this.pageSize),this.sizeTextEl.innerHTML=this.sizeText,this.sizeTextEl.style.display=this.sizeText?"":"none";var d=this.firstText,t=this.prevText,e=this.nextText,i=this.lastText,n=this.reloadText;0==this.showButtonText&&(d=t=e=i=n=""),this.firstButton.setText(d),this.prevButton.setText(t),this.nextButton.setText(e),this.lastButton.setText(i),this.reloadButton.setText(n);d=this.firstText,t=this.prevText,e=this.nextText,i=this.lastText;this.showButtonText&&(this.firstButton.setTooltip(d),this.prevButton.setTooltip(t),this.nextButton.setTooltip(e),this.lastButton.setTooltip(i),this.reloadButton.setTooltip(n)),this.firstButton.setIconCls(this.showButtonIcon?"mini-pager-first":""),this.prevButton.setIconCls(this.showButtonIcon?"mini-pager-prev":""),this.nextButton.setIconCls(this.showButtonIcon?"mini-pager-next":""),this.lastButton.setIconCls(this.showButtonIcon?"mini-pager-last":""),this.reloadButton.setIconCls(this.showButtonIcon?"mini-pager-reload":""),this.reloadButton.setVisible(this.showReloadButton);n=this.reloadButton.el.previousSibling;n&&(n.style.display=this.showReloadButton?"":"none"),this._rightEl.innerHTML=String.format(this.pageInfoText,this.pageSize,this.totalCount),this.indexEl.style.display=this.showPageIndex?"":"none",this.sizeEl.style.display=this.showPageSize?"":"none",this._rightEl.style.display=this.showPageInfo?"":"none",this.firstButton.setVisible(0<=this.totalCount),this.lastButton.setVisible(0<=this.totalCount),this.totalCount<0&&(this.firstButton.enable(),this.nextButton.enable(),0==this.pageIndex&&this.firstButton.disable())},__OnPageSelectChanged:function(t){var e=parseInt(this.sizeCombo.getValue());this._OnPageChanged(0,e)},_OnPageChanged:function(t,e){e={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};0<=this.totalCount&&e.pageIndex>this.totalPage-1&&(e.pageIndex=this.totalPage-1),e.pageIndex<0&&(e.pageIndex=0),this.fire("beforepagechanged",e),1!=e.cancel&&(this.fire("pagechanged",e),this.update(e.pageIndex,e.pageSize))},onPageChanged:function(t,e){this.on("pagechanged",t,e)},getAttrs:function(t){var e=mini.Pager.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onpagechanged","sizeList","onbeforepagechanged","buttons","sizeText"]),mini._ParseBool(t,e,["showPageIndex","showPageSize","showTotalCount","showPageInfo","showReloadButton","showButtonText","showButtonIcon"]),mini._ParseInt(t,e,["pageIndex","pageSize","totalCount","pageSizeWidth"]),"string"==typeof e.sizeList&&(e.sizeList=window.eval(e.sizeList)),e.buttons&&(e.buttons=mini.byId(e.buttons)),e}}),mini.regClass(mini.Pager,"pager"),mini.DataBinding=function(){this._bindFields=[],this._bindForms=[],mini.DataBinding.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataBinding,mini.Component,{bindField:function(t,e,i,n,s){t=mini.get(t),e=mini.get(e),t&&e&&i&&(this._bindFields.push({control:t,source:e,field:i,convert:s,mode:n}),e.on("currentchanged",this.__OnCurrentChanged,this),t.on("valuechanged",this.__OnValueChanged,this))},bindForm:function(t,e,i,n){if(t=mini.byId(t),e=mini.get(e),t&&e)for(var s=(t=new mini.Form(t)).getFields(),o=0,l=s.length;o<l;o++){var r=s[o];this.bindField(r,e,r.getName(),i,n)}},__OnCurrentChanged:function(t){if(!this._doSetting){this._doSetting=!0,this._currentRecord=t.record;for(var e=t.sender,i=t.record,n=0,s=this._bindFields.length;n<s;n++){var o,l=this._bindFields[n];l.source==e&&(o=l.control,l=l.field,o.setValue&&(i?(l=mini._getMap(l,i),o.setValue(l)):o.setValue("")),o.setText&&o.textName&&(i?o.setText(i[o.textName]):o.setText("")))}var r=this;setTimeout(function(){r._doSetting=!1},10)}},__OnValueChanged:function(t){if(!this._doSetting){this._doSetting=!0;for(var e=t.sender,i=e.getValue(),n=0,s=this._bindFields.length;n<s;n++){var o,l,r,a=this._bindFields[n];a.control==e&&!1!==a.mode&&(o=a.source,(l=this._currentRecord)&&((r={})[a.field]=i,e.getText&&e.textName&&(r[e.textName]=e.getText()),o.updateRow(l,r)))}var h=this;setTimeout(function(){h._doSetting=!1},10)}}}),mini.regClass(mini.DataBinding,"databinding"),mini.DataSet=function(){this._sources={},this._data={},this._links=[],this._originals={},mini.DataSet.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataSet,mini.Component,{add:function(t,e){t&&e&&(this._sources[t]=e,this._data[t]=[],e._set_autoCreateNewID(!0),e._set_originalIdField(e.getIdField()),e._set_clearOriginals(!1),e.on("addrow",this.__OnRowChanged,this),e.on("updaterow",this.__OnRowChanged,this),e.on("deleterow",this.__OnRowChanged,this),e.on("removerow",this.__OnRowChanged,this),e.on("preload",this.__OnDataPreLoad,this),e.on("selectionchanged",this.__OnDataSelectionChanged,this))},addLink:function(t,e,i){t&&e&&i&&this._sources[t]&&this._sources[e]&&this._links.push({parentName:t,childName:e,parentField:i})},clearData:function(){for(var t in this._data={},this._originals={},this._sources)this._data=[]},getData:function(){return this._data},_getNameByListControl:function(t){for(var e in this._sources)if(this._sources[e]==t)return e},_getRecord:function(t,e,i){var n=this._data[t];if(!n)return!1;for(var s=0,o=n.length;s<o;s++){var l=n[s];if(l[i]==e[i])return l}return null},__OnRowChanged:function(t){var e=t.type,i=t.record,n=this._getNameByListControl(t.sender),s=this._getRecord(n,i,t.sender.getIdField()),o=this._data[n];s&&(o=this._data[n]).remove(s),"removerow"==e&&"added"==i._state||"beforeremove"==e&&"added"==i._state||o.push(i),this._originals[n]=t.sender._get_originals(),"added"!=i._state||(n=this._getParentSource(t.sender))&&((t=n.getSelected())?i._parentId=t[n.getIdField()]:o.remove(i))},__OnDataPreLoad:function(t){for(var e=t.sender,i=this._getNameByListControl(e),n=t.sender.getIdField(),s=this._data[i],o={},l=0,r=s.length;l<r;l++)o[(c=s[l])[n]]=c;i=this._originals[i];i&&e._set_originals(i);for(var a=t.data||[],l=0,r=a.length;l<r;l++)(m=o[(c=a[l])[n]])&&(delete m._uid,mini.copyTo(c,m));var h=this._getParentSource(e);if(e.getPageIndex&&0==e.getPageIndex()){for(var d,u=[],l=0,r=s.length;l<r;l++)"added"==(c=s[l])._state&&(!h||(d=h.getSelected())&&d[h.getIdField()]==c._parentId)&&u.push(c);u.reverse(),a.insertRange(0,u)}for(var c,m,f=[],l=a.length-1;0<=l;l--)(m=o[(c=a[l])[n]])&&"removed"==m._state&&(a.removeAt(l),f.push(m))},_getParentSource:function(t){for(var e=this._getNameByListControl(t),i=0,n=this._links.length;i<n;i++){var s=this._links[i];if(s.childName==e)return this._sources[s.parentName]}},_getLinks:function(t){for(var e=this._getNameByListControl(t),i=[],n=0,s=this._links.length;n<s;n++){var o=this._links[n];o.parentName==e&&i.push(o)}return i},__OnDataSelectionChanged:function(t){for(var e=t.sender,i=e.getSelected(),n=this._getLinks(e),s=0,o=n.length;s<o;s++){var l,r=n[s],a=this._sources[r.childName];i?((l={})[r.parentField]=i[e.getIdField()],a.load(l)):a.loadData([])}}}),mini.regClass(mini.DataSet,"dataset"),"undefined"==typeof mini_doload&&(mini_doload=function(t){}),mini.DataSource=function(){mini.DataSource.superclass.constructor.apply(this,arguments),this._init()},mini.extend(mini.DataSource,mini.Component,{idField:"id",textField:"text",loaded:!1,destroy:function(){this.source=[],this.dataview=[],this.visibleRows=null,this.list=null,this._ids={},this._removeds=[],this._clearOriginals&&(this._originals={}),this._errors={},this._selected=null,this._selecteds=[],this._idSelecteds={},this._filterInfo=null,this._sortInfo=null,this.root={_id:-1,_level:-1},this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null,mini.DataSource.superclass.destroy.call(this)},_originalIdField:"_id",_clearOriginals:!0,_autoCreateNewID:!1,_init:function(){this.source=[],this.dataview=[],this.visibleRows=null,this.list=null,this._ids={},this._removeds=[],this._clearOriginals&&(this._originals={}),this._errors={},this._selected=null,this._selecteds=[],this._idSelecteds={},this.__changeCount=0},getSource:function(){return this.source},getList:function(){return this.source.clone()},getDataView:function(){return this.dataview.clone()},getVisibleRows:function(){return this.visibleRows||(this.visibleRows=this.getDataView().clone()),this.visibleRows},setData:function(t){this.loadData(t)},loadData:function(t){return mini.isArray(t)||(t=[]),this._init(),this._doLoadData(t),this._dataChanged("loaddata"),this.fire("loaddata"),!0},_doLoadData:function(t){this.source=t,this.dataview=t;for(var e=this.source,i=this._ids,n=0,s=e.length;n<s;n++){var o=e[n];o._id=mini.DataSource.RecordId++,(i[o._id]=o)._uid=o._id}},clearData:function(){this._init(),this._dataChanged(),this.fire("cleardata")},clear:function(){this.clearData()},updateRecord:function(t,e,i){if(!mini.isNull(t)){var n=mini._getMap,s=mini._setMap;if(this.fire("beforeupdate",{record:t}),"string"==typeof e){var o=n(e,t);if(mini.isEquals(o,i))return!1;this.beginChange(),s(e,i,t),this._setModified(t,e,o),this.endChange()}else{for(var l in this.beginChange(),e){o=n(l,t),i=e[l];mini.isEquals(o,i)||(s(l,i,t),this._setModified(t,l,o))}this.endChange("update")}this.fire("update",{record:t})}},deleteRecord:function(t){this._setDeleted(t),this._dataChanged(),this.fire("delete",{record:t})},getby_id:function(t){return t="object"==typeof t?t._id:t,this._ids[t]},getbyId:function(t){if("number"==typeof t)return this.getAt(t);if("object"==typeof t){if(this.getby_id(t))return t;t=t[this.idField]}if(t=String(t),!(e=this.ids))for(var e=this.ids={},i=this.getList(),n=0,s=i.length;n<s;n++){var o=i[n],l=o[this.idField];mini.isNull(l)||(e[l]=o)}return e[t]},getsByIds:function(t){mini.isNull(t)&&(t=""),t=String(t);for(var e=[],i=String(t).split(","),n=0,s=i.length;n<s;n++){var o=this.getbyId(i[n]);o&&e.push(o)}return e},getRecord:function(t){return"object"==typeof t?t:this.getRow(t)},getRow:function(t){var e=typeof t;return"string"==e?this.getbyId(t):"number"==e?this.getAt(t):"object"==e?t:void 0},delimiter:",",getValueAndText:function(t,e){mini.isNull(t)&&(t=[]),e=e||this.delimiter,"string"==typeof t||"number"==typeof t?t=this.getsByIds(t):mini.isArray(t)||(t=[t]);for(var i=[],n=[],s=0,o=t.length;s<o;s++){var l=t[s];l&&(i.push(this.getItemValue(l)),n.push(this.getItemText(l)))}return[i.join(e),n.join(e)]},getItemValue:function(t){if(!t)return"";t=mini._getMap(this.idField,t);return mini.isNull(t)?"":String(t)},getItemText:function(t){if(!t)return"";t=mini._getMap(this.textField,t);return mini.isNull(t)?"":String(t)},isModified:function(t,e){t=this._originals[t[this._originalIdField]];return!!t&&(!mini.isNull(e)&&t.hasOwnProperty(e))},hasRecord:function(t){return!!this.getby_id(t)},findRecords:function(t,e){for(var i="function"==typeof t,n=t,s=e||this,o=this.source,l=[],r=0,a=o.length;r<a;r++){var h=o[r];if(i){var d=n.call(s,h);if(1==d&&(l[l.length]=h),1===d)break}else h[t]==e&&(l[l.length]=h)}return l},findRecord:function(t,e){return this.findRecords(t,e)[0]},each:function(t,e){var i=this.getDataView().clone();e=e||this,mini.forEach(i,t,e)},getCount:function(){return this.getDataView().length},setIdField:function(t){this.idField=t},setTextField:function(t){this.textField=t},__changeCount:0,beginChange:function(){this.__changeCount++},endChange:function(t,e){this.__changeCount--,this.__changeCount<0&&(this.__changeCount=0),(!1!==e&&0==this.__changeCount||1==e)&&(this.__changeCount=0,this._dataChanged(t))},_dataChanged:function(t){this.ids=null,this.visibleRows=null,this.list=null,0==this.__changeCount&&this.fire("datachanged")},_setAdded:function(t){t._id=mini.DataSource.RecordId++,this._autoCreateNewID&&!t[this.idField]&&(t[this.idField]=UUID()),t._uid=t._id,t._state="added",this._ids[t._id]=t,delete this._originals[t[this._originalIdField]]},_setModified:function(t,e,i){"added"!=t._state&&"deleted"!=t._state&&"removed"!=t._state&&(t._state="modified",(t=this._getOriginal(t)).hasOwnProperty(e)||(t[e]=i))},_setDeleted:function(t){"added"!=t._state&&"deleted"!=t._state&&"removed"!=t._state&&(t._state="deleted")},_setRemoved:function(t){delete this._ids[t._id],"added"!=t._state&&"removed"!=t._state&&(t._state="removed",delete this._originals[t[this._originalIdField]],this._removeds.push(t))},_getOriginal:function(t){t=t[this._originalIdField];return this._originals[t]||(this._originals[t]={})},_selected:null,_selecteds:[],_idSelecteds:null,multiSelect:!1,isSelected:function(t){return!!t&&("string"!=typeof t&&(t=t._id),!!this._idSelecteds[t])},setSelected:function(t){t=this.getby_id(t),this.getSelected()!=t&&((this._selected=t)?this.select(t):this.deselect(this.getSelected()),this._OnCurrentChanged(t))},getSelected:function(){return this.isSelected(this._selected)?this._selected:this._selecteds[0]},setCurrent:function(t){this.setSelected(t)},getCurrent:function(){return this.getSelected()},getSelecteds:function(){return this._selecteds.clone()},select:function(t,e){mini.isNull(t)||this.selects([t],e)},deselect:function(t,e){mini.isNull(t)||this.deselects([t],e)},selectAll:function(t){this.selects(this.getList(),t)},deselectAll:function(t){this.deselects(this.getSelecteds(),t)},_fireSelect:function(t,e){t={record:t,cancel:!1};return this.fire(e,t),!t.cancel},selects:function(t,e){if(mini.isArray(t)){t=t.clone(),0==this.multiSelect&&(this.deselects(this.getSelecteds()),0<t.length&&(t.length=1),this._selecteds=[],this._idSelecteds={});for(var i=[],n=0,s=t.length;n<s;n++){var o=this.getbyId(t[n]);o&&(this.isSelected(o)||!1!==e&&!this._fireSelect(o,"beforeselect")||(this._selecteds.push(o),this._idSelecteds[o._id]=o,i.push(o),!1!==e&&this.fire("select",{record:o})))}this._OnSelectionChanged(t,!0,i,e)}},deselects:function(t,e){if(mini.isArray(t)){for(var i=[],n=(t=t.clone()).length-1;0<=n;n--)(l=this.getbyId(t[n]))&&this.isSelected(l)&&(!1!==e&&!this._fireSelect(l,"beforedeselect")||(delete this._idSelecteds[l._id],i.push(l)));this._selecteds=[];var s=this._idSelecteds;for(n in s){var o=s[n];o._id&&this._selecteds.push(o)}for(var l,n=t.length-1;0<=n;n--)(l=this.getbyId(t[n]))&&!1!==e&&this.fire("deselect",{record:l});this._OnSelectionChanged(t,!1,i,e)}},_OnSelectionChanged:function(t,e,i,n){e={fireEvent:n,records:t,select:e,selected:this.getSelected(),selecteds:this.getSelecteds(),_records:i};this.fire("SelectionChanged",e);i=this._current,e=this.getCurrent();i!=e&&(this._current=e,this._OnCurrentChanged(e))},_OnCurrentChanged:function(t){this._currentTimer&&clearTimeout(this._currentTimer);var e=this;this._currentTimer=setTimeout(function(){e._currentTimer=null,e.fire("CurrentChanged",{record:t})},30)},_checkSelecteds:function(){for(var t=this._selecteds.length-1;0<=t;t--){var e=this._selecteds[t];this.getby_id(e._id)||(this._selecteds.removeAt(t),delete this._idSelecteds[e._id])}this._selected&&null==this.getby_id(this._selected._id)&&(this._selected=null)},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t)},getMultiSelect:function(){return this.multiSelect},selectPrev:function(){var t,e=this.getSelected();(e=e?(t=this.indexOf(e),this.getAt(t-1)):this.getAt(0))&&(this.deselectAll(),this.select(e),this.setCurrent(e))},selectNext:function(){var t,e=this.getSelected();(e=e?(t=this.indexOf(e),this.getAt(t+1)):this.getAt(0))&&(this.deselectAll(),this.select(e),this.setCurrent(e))},selectFirst:function(){var t=this.getAt(0);t&&(this.deselectAll(),this.select(t),this.setCurrent(t))},selectLast:function(){var t=this.getVisibleRows(),t=this.getAt(t.length-1);t&&(this.deselectAll(),this.select(t),this.setCurrent(t))},getSelectedsId:function(t){var e=this.getSelecteds();return this.getValueAndText(e,t)[0]},getSelectedsText:function(t){var e=this.getSelecteds();return this.getValueAndText(e,t)[1]},_filterInfo:null,_sortInfo:null,filter:function(t,e){"function"==typeof t&&(this._filterInfo=[t,e=e||this],this._doFilter(),this._doSort(),this._dataChanged(),this.fire("filter"))},clearFilter:function(){this._filterInfo&&(this._filterInfo=null,this._doFilter(),this._doSort(),this._dataChanged(),this.fire("filter"))},sort:function(t,e,i){"function"==typeof t&&(this._sortInfo=[t,e=e||this,i],this._doSort(),this._dataChanged(),this.fire("sort"))},clearSort:function(){var t;this._sortInfo=null,this.sortField=this.sortOrder="",this._doFilter(),this._dataChanged(),"server"==this.sortMode&&((t=this.getLoadParams()).sortField="",t.sortOrder="",this.load(t)),this.fire("filter")},_sortMulti:function(t){},_doClientSortField:function(t,e,i){i=this._getSortFnByField(t,i);i&&this.sort(i,this,"desc"==e)},_getSortFnByField:function(s,o){if(!s)return null;var l=mini.sortTypes[o];return l=l||mini.sortTypes.string,function(t,e){var i=mini._getMap(s,t),n=mini._getMap(s,e),t=mini.isNull(i)||""===i,e=mini.isNull(n)||""===n;return t?0:e?1:"chinese"==o?i.localeCompare(n,"zh"):(i=l(i),l(n)<i?1:0)}},ajaxOptions:null,autoLoad:!1,url:"",pageSize:10,pageIndex:0,totalCount:0,totalPage:0,sortField:"",sortOrder:"",loadParams:null,getLoadParams:function(){return this.loadParams||{}},sortMode:"server",pageIndexField:"pageIndex",pageSizeField:"pageSize",sortFieldField:"sortField",sortOrderField:"sortOrder",totalField:"total",dataField:"data",startField:"",limitField:"",errorField:"error",errorMsgField:"errorMsg",stackTraceField:"stackTrace",load:function(t,e,i,n){var s;"string"!=typeof t?(this._loadTimer&&clearTimeout(this._loadTimer),this.loadParams=t||{},mini.isNumber(this.loadParams.pageIndex)||(this.loadParams.pageIndex=0),this._xhr&&this._xhr.abort(),this.ajaxAsync&&mini_ajaxAsyncInvoke?(s=this)._loadTimer=setTimeout(function(){s._doLoadAjax(s.loadParams,e,i,n),s._loadTimer=null},1):this._doLoadAjax(this.loadParams,e,i,n)):this.setUrl(t)},reload:function(t,e,i){this.load(this.loadParams,t,e,i)},gotoPage:function(t,e){var i=this.loadParams||{};mini.isNumber(t)&&(i.pageIndex=t),mini.isNumber(e)&&(i.pageSize=e),this.load(i)},sortBy:function(t,e){var i;this.sortField=t,this.sortOrder="asc"==e?"asc":"desc","server"==this.sortMode&&((i=this.getLoadParams()).sortField=t,i.sortOrder=e,i.pageIndex=this.pageIndex,this.load(i))},setSortField:function(t){this.sortField=t,"server"==this.sortMode&&(this.getLoadParams().sortField=t)},setSortOrder:function(t){this.sortOrder=t,"server"==this.sortMode&&(this.getLoadParams().sortOrder=t)},checkSelectOnLoad:!0,selectOnLoad:!1,ajaxData:null,ajaxAsync:!0,ajaxType:"",_doLoadAjax:function(u,c,m,i,f){u=u||{},mini.isNull(u.pageIndex)&&(u.pageIndex=this.pageIndex),mini.isNull(u.pageSize)&&(u.pageSize=this.pageSize),u.sortField&&(this.sortField=u.sortField),u.sortOrder&&(this.sortOrder=u.sortOrder),u.sortField=this.sortField,u.sortOrder=this.sortOrder,this.loadParams=u;var p=this._evalUrl(),t=this._evalType(p),e=mini._evalAjaxData(this.ajaxData,this);jQuery.extend(!0,u,e);var g={url:p,"async":this.ajaxAsync,type:t,data:u,params:u,cache:!1,cancel:!1};if(jQuery.extend(!0,g,this.ajaxOptions),this._OnBeforeLoad(g),1==g.cancel)return u.pageIndex=this.getPageIndex(),void(u.pageSize=this.getPageSize());g.data!=g.params&&g.params!=u&&(g.data=g.params),g.url!=p&&g.type==t&&(g.type=this._evalType(g.url));t={};t[this.pageIndexField]=u.pageIndex,t[this.pageSizeField]=u.pageSize,u.sortField&&(t[this.sortFieldField]=u.sortField),u.sortOrder&&(t[this.sortOrderField]=u.sortOrder),this.startField&&this.limitField&&(t[this.startField]=u.pageIndex*u.pageSize,t[this.limitField]=u.pageSize),jQuery.extend(!0,u,t),jQuery.extend(!0,g.data,t),"client"==this.sortMode&&(u[this.sortFieldField]="",u[this.sortOrderField]="");t=this.getSelected();this._currentSelectValue=t?t[this.idField]:null,mini.isNumber(this._currentSelectValue)&&(this._currentSelectValue=String(this._currentSelectValue));for(var n=this.getSelecteds(),s=[],o=0,l=n.length;o<l;o++){var r=n[o][this.idField];mini.isNull(r)||(r=String(r)),s.push(r)}this._selectedValue=0==s.length?null:s,mini.isNumber(this._selectedValue)&&(this._selectedValue=String(this._selectedValue));var _=this;_._resultObject=null;var v=g["async"];mini.copyTo(g,{success:function(t,e,i){t&&"null"!=t||(t="{ total: 0, data: [] }"),delete g.params;var n={text:t,result:null,sender:_,options:g,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(o){1==mini_debugger&&alert(p+"\n json is error.")}s&&!mini.isArray(s)?(s.total=parseInt(mini._getMap(_.totalField,s)),s.data=mini._getMap(_.dataField,s)):null==s?s={data:[],total:0}:mini.isArray(s)&&((n={}).data=s,n.total=s.length,s=n),s.data||(s.data=[]),s.total||(s.total=0),_._resultObject=s,mini.isArray(s.data)||(s.data=[s.data]);var o={xhr:i,text:t,textStatus:e,result:s,total:s.total,data:s.data.clone(),pageIndex:u[_.pageIndexField],pageSize:u[_.pageSizeField]},t=mini._getMap(_.errorField,s),e=mini._getMap(_.errorMsgField,s),s=mini._getMap(_.stackTraceField,s);if(mini.isNumber(t)&&0!=t||!1===t)o.textStatus="servererror",o.errorCode=t,o.stackTrace=s||"",o.errorMsg=e||"",1==mini_debugger&&alert(p+"\n"+o.textStatus+"\n"+o.errorMsg+"\n"+o.stackTrace),_.fire("loaderror",o),m&&m.call(_,o);else if(0<o.pageIndex&&0==o.data.length)_.gotoPage(o.pageIndex-1);else if(f)f(o);else{_.pageIndex=o.pageIndex,_.pageSize=o.pageSize,_.setTotalCount(o.total),_._OnPreLoad(o),_.loaded=!0;new Date;if(_.setData(o.data),_._selectedValue&&_.checkSelectOnLoad){var l=[],r=_._selectedValue;if(0<r.length){for(var a=0,h=r.length;a<h;a++){var d=_.getbyId(r[a]);d&&l.push(d)}l.length&&_.selects(l),_._selected=_.getbyId(_._currentSelectValue)}}null==_.getSelected()&&_.selectOnLoad&&0<_.getDataView().length&&_.select(0),_.fire("load",o),c&&(v?setTimeout(function(){c.call(_,o)},20):c.call(_,o))}},error:function(t,e,i){"abort"!=e&&((e={xhr:t,text:t.responseText,textStatus:e}).errorMsg=t.responseText,e.errorCode=t.status,1==mini_debugger&&alert(p+"\n"+e.errorCode+"\n"+e.errorMsg),_.fire("loaderror",e),m&&m.call(_,e))},complete:function(t,e){e={xhr:t,text:t.responseText,textStatus:e};_.fire("loadcomplete",e),i&&i.call(_,e),_._xhr=null}}),this._xhr,this._xhr=mini.ajax(g)},_OnBeforeLoad:function(t){this.fire("beforeload",t)},_OnPreLoad:function(t){this.fire("preload",t)},_evalUrl:function(){var t=this.url;if("function"==typeof t)t=t();else{try{t=window.eval(t)}catch(ex){t=this.url}t=t||this.url}return t},_evalType:function(t){var e=this.ajaxType;return e||(e="post",t&&-1==t.indexOf(".txt")&&-1==t.indexOf(".json")||(e="get")),e},setSortMode:function(t){this.sortMode=t},getSortMode:function(){return this.sortMode},setAjaxOptions:function(t){this.ajaxOptions=t},getAjaxOptions:function(){return this.ajaxOptions},setAutoLoad:function(t){this.autoLoad=t},getAutoLoad:function(){return this.autoLoad},setUrl:function(t){this.url=t,this.autoLoad&&this.load()},getUrl:function(){return this.url},setPageIndex:function(t){this.pageIndex=t;var e=this.loadParams||{};mini.isNumber(t)&&(e.pageIndex=t),this.fire("pageinfochanged")},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){this.pageSize=t;var e=this.loadParams||{};mini.isNumber(t)&&(e.pageSize=t),this.fire("pageinfochanged")},getPageSize:function(){return this.pageSize},setTotalCount:function(t){this.totalCount=parseInt(t),this.fire("pageinfochanged")},getTotalCount:function(){return this.totalCount},getTotalPage:function(){return this.totalPage},setCheckSelectOnLoad:function(t){this.checkSelectOnLoad=t},getCheckSelectOnLoad:function(){return this.checkSelectOnLoad},setSelectOnLoad:function(t){this.selectOnLoad=t},getSelectOnLoad:function(){return this.selectOnLoad}}),mini.DataSource.RecordId=1,mini.DataTable=function(){mini.DataTable.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataTable,mini.DataSource,{_init:function(){mini.DataTable.superclass._init.call(this),this._filterInfo=null,this._sortInfo=null},add:function(t){return this.insert(this.source.length,t)},addRange:function(t){this.insertRange(this.source.length,t)},insert:function(t,e){if(!e)return null;var i={index:t=!mini.isNumber(t)?(n=this.getRecord(t))?this.indexOf(n):this.dataview.length:t,record:e};this.fire("beforeadd",i);var n=this.dataview[t];n?this.dataview.insert(t,e):this.dataview.add(e),this.dataview!=this.source&&(n?(n=this.source.indexOf(n),this.source.insert(n,e)):this.source.add(e)),this._setAdded(e),this._dataChanged(),this.fire("add",i)},insertRange:function(t,e){if(mini.isArray(e)){mini.isNumber(t)||(t=this.dataview.length),this.beginChange();for(var i=0,n=(e=e.clone()).length;i<n;i++){var s=e[i];this.insert(t+i,s)}this.endChange()}},remove:function(t,e){t=this.indexOf(t);return this.removeAt(t,e)},removeAt:function(t,e){var i=this.getAt(t);if(!i)return null;var n={record:i};this.fire("beforeremove",n);var s=this.isSelected(i);this.source.remove(i),this.dataview!==this.source&&this.dataview.removeAt(t),this._setRemoved(i),this._checkSelecteds(),this._dataChanged(),this.fire("remove",n),s&&e&&(e=(e=this.getAt(t))||this.getAt(t-1),this.deselectAll(),this.select(e))},removeRange:function(t,e){if(mini.isArray(t)){this.beginChange();for(var i=0,n=(t=t.clone()).length;i<n;i++){var s=t[i];this.remove(s,e)}this._dataChanged(),this.endChange()}},move:function(t,e){if(t&&mini.isNumber(e)&&!(e<0))if(mini.isArray(t)){this.beginChange();var i=t,n=this.getAt(e),s=this;mini.sort(i,function(t,e){return s.indexOf(t)>s.indexOf(e)},this);for(var o=0,l=i.length;o<l;o++){var r=i[o],a=this.indexOf(n);this.move(r,a)}this.endChange()}else{var h={index:e,record:t};this.fire("beforemove",h);var d=this.dataview[e];this.dataview.remove(t);var u=this.dataview.indexOf(d);-1!=u&&(e=u),d?this.dataview.insert(e,t):this.dataview.add(t),this.dataview!=this.source&&(this.source.remove(t),-1!=(u=this.source.indexOf(d))&&(e=u),d?this.source.insert(e,t):this.source.add(t)),this._dataChanged(),this.fire("move",h)}},indexOf:function(t){return this.getVisibleRows().indexOf(t)},getAt:function(t){return this.getVisibleRows()[t]},getRange:function(t,e){var i;e<t&&(i=t,t=e,e=i);for(var n=[],s=t,o=e;s<=o;s++){var l=this.dataview[s];n.push(l)}return n},selectRange:function(t,e){mini.isNumber(t)||(t=this.indexOf(t)),mini.isNumber(e)||(e=this.indexOf(e)),mini.isNull(t)||mini.isNull(e)||(e=this.getRange(t,e),this.selects(e))},toArray:function(){return this.source.clone()},isChanged:function(){return 0<this.getChanges().length},getChanges:function(t,e){var i=[];"removed"!=t&&null!=t||i.addRange(this._removeds.clone());for(var n=0,s=this.source.length;n<s;n++){var o=this.source[n];o._state&&(o._state!=t&&null!=t||(i[i.length]=o))}var l=i;if(e)for(n=0,s=l.length;n<s;n++){var r=l[n];if("modified"==r._state){var a,h={};for(a in h._state=r._state,h[this.idField]=r[this.idField],r)this.isModified(r,a)&&(h[a]=r[a]);l[n]=h}}var d=this;return mini.sort(i,function(t,e){t=d.indexOf(t),e=d.indexOf(e);return e<t?1:t<e?-1:0}),i},accept:function(){this.beginChange();for(var t=0,e=this.source.length;t<e;t++){var i=this.source[t];this.acceptRecord(i)}this._removeds=[],this._originals={},this.endChange()},reject:function(){this.beginChange();for(var t=this.source.clone(),e=0,i=t.length;e<i;e++){var n=t[e];this.rejectRecord(n)}this._removeds=[],this._originals={},this.endChange()},acceptRecord:function(t){t._state&&(delete this._originals[t[this._originalIdField]],"deleted"==t._state?this.remove(t):(delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged()),this.fire("update",{record:t}))},rejectRecord:function(t){if(t._state)if("added"==t._state)this.remove(t);else if("modified"==t._state||"deleted"==t._state){var e,i=this._getOriginal(t);for(e in i){var n=i[e];mini._setMap(e,n,t)}delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})}},_doFilter:function(){if(this._filterInfo){for(var t=this._filterInfo[0],e=this._filterInfo[1],i=[],n=this.source,s=0,o=n.length;s<o;s++){var l=n[s];!1!==t.call(e,l,s,this)&&i.push(l)}this.dataview=i}else this.dataview=this.source},_doSort:function(){var t,e,i,n;this._sortInfo&&(t=this._sortInfo[0],e=this._sortInfo[1],i=this._sortInfo[2],n=this.getDataView().clone(),mini.sort(n,t,e),i&&n.reverse(),this.dataview=n)}}),mini.regClass(mini.DataTable,"datatable"),mini.DataTree=function(){mini.DataTree.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataTree,mini.DataSource,{isTree:!0,expandOnLoad:!1,idField:"id",parentField:"pid",nodesField:"children",checkedField:"checked",resultAsTree:!0,dataField:"",checkModel:"cascade",autoCheckParent:!1,onlyLeafCheckable:!1,setExpandOnLoad:function(t){this.expandOnLoad=t},getExpandOnLoad:function(){return this.expandOnLoad},setParentField:function(t){this.parentField=t},setNodesField:function(t){var e;this.nodesField!=t&&(e=this.root[this.nodesField],this.nodesField=t,this._doLoadData(e))},setResultAsTree:function(t){this.resultAsTree=t},setCheckRecursive:function(t){this.checkModel=t?"cascade":"multiple"},getCheckRecursive:function(){return"cascade"==this.checkModel},setShowFolderCheckBox:function(t){this.onlyLeafCheckable=!t},getShowFolderCheckBox:function(){return!this.onlyLeafCheckable},_doExpandOnLoad:function(t){var o=this.nodesField,l=this.expandOnLoad;!function r(t,e){for(var i=0,n=t.length;i<n;i++){var s=t[i];mini.isNull(s.expanded)&&(!0===l||mini.isNumber(l)&&e<=l?s.expanded=!0:s.expanded=!1),(s=s[o])&&r(s,e+1)}}(t,0)},_OnBeforeLoad:function(t){var e=this._loadingNode||this.root;t.node=e,this._isNodeLoading()&&(t["async"]=!0,t.isRoot=t.node==this.root,t.isRoot||(t.data[this.idField]=this.getItemValue(t.node))),this.fire("beforeload",t)},_OnPreLoad:function(t){0==this.resultAsTree&&(t.data=mini.arrayToTree(t.data,this.nodesField,this.idField,this.parentField)),this.fire("preload",t)},_init:function(){mini.DataTree.superclass._init.call(this),this.root={_id:-1,_level:-1},this.source=this.root[this.nodesField]=[],this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null,this._ids[this.root._id]=this.root},_doLoadData:function(t){this._doExpandOnLoad(t=t||[]),this.source=this.root[this.nodesField]=t,this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null;new Date;var e=mini.treeToArray(t,this.nodesField);(a=this._ids)[this.root._id]=this.root;for(var i=mini.DataSource.RecordId,n=0,s=e.length;n<s;n++)(l=e[n])._id=i++,(a[l._id]=l)._uid=l._id;mini.DataSource.RecordId=i;var o=this.checkedField,e=mini.treeToArray(t,this.nodesField,"_id","_pid",this.root._id);this.list=e;for(var l,r,a=this._ids,n=0,s=e.length;n<s;n++)r=a[(l=e[n])._pid],l._level=r._level+1,l._state&&delete l._state,(r=l[o])&&(l.checked=r,l.checked&&(l.checked="false"!=l.checked));this._doUpdateLoadedCheckedNodes()},_setAdded:function(t){var e=this.getParentNode(t);t._id=mini.DataSource.RecordId++,this._autoCreateNewID&&!t[this.idField]&&(t[this.idField]=UUID()),t._uid=t._id,t._pid=e._id,e[this.idField]&&(t[this.parentField]=e[this.idField]),t._level=e._level+1,t._state="added",this._ids[t._id]=t,delete this._originals[t[this._originalIdField]]},_createNodes:function(t){var e=(e=t[this.nodesField])||(t[this.nodesField]=[]);return this.viewNodes&&!this.viewNodes[t._id]&&(this.viewNodes[t._id]=[]),e},addNode:function(t,e){if(t)return this.insertNode(t,-1,e)},addNodes:function(t,e,i){if(mini.isArray(t)){mini.isNull(i)&&(i="add");for(var n=0,s=t.length;n<s;n++){var o=t[n];this.insertNode(o,i,e)}}},insertNodes:function(t,e,i){if(mini.isNumber(e)&&mini.isArray(t)){i=i||this.root,this.beginChange();var n=this._createNodes(i);(e<0||e>n.length)&&(e=n.length);for(var s=0,o=(t=t.clone()).length;s<o;s++)this.insertNode(t[s],e+s,i);return this.endChange(),t}},removeNode:function(t){var e=this.getParentNode(t);if(e){t=this.indexOfNode(t);return this.removeNodeAt(t,e)}},removeNodes:function(t){if(mini.isArray(t)){this.beginChange();for(var e=0,i=(t=t.clone()).length;e<i;e++)this.removeNode(t[e]);this.endChange()}},moveNodes:function(t,e,i){if(t&&0!=t.length&&e&&i){this.beginChange();var n=this;mini.sort(t,function(t,e){return n.indexOf(t)>n.indexOf(e)},this);for(var s=0,o=t.length;s<o;s++){var l=t[s];this.moveNode(l,e,i),0!=s&&(e=l,i="after")}this.endChange()}},moveNode:function(t,e,i){if(t&&e&&!mini.isNull(i)){if(this.viewNodes){var n=e;if("before"==(r=i))n=this.getParentNode(e),r=this.indexOfNode(e);else if("after"==r)n=this.getParentNode(e),r=this.indexOfNode(e)+1;else if("add"==r||"append"==r)n[this.nodesField]||(n[this.nodesField]=[]),r=n[this.nodesField].length;else if(!mini.isNumber(r))return;if(this.isAncestor(t,n))return!1;s=(s=this.viewNodes[n._id])||(this.viewNodes[n._id]=[]);var s=this.getChildNodes(n);(r<0||r>s.length)&&(r=s.length);var o={};s.insert(r,o);var l=this.getParentNode(t);this.getChildNodes(l).remove(t),r=s.indexOf(o),s[r]=t}var n=e,r=i,s=this._createNodes(n);if("before"==r)n=this.getParentNode(e),r=(s=this._createNodes(n)).indexOf(e);else if("after"==r)n=this.getParentNode(e),r=(s=this._createNodes(n)).indexOf(e)+1;else if("add"==r||"append"==r)r=s.length;else if(!mini.isNumber(r))return;if(this.isAncestor(t,n))return!1;(r<0||r>s.length)&&(r=s.length);o={};s.insert(r,o),(l=this.getParentNode(t))[this.nodesField].remove(t),r=s.indexOf(o),s[r]=t,this._updateParentAndLevel(t,n),this._dataChanged(),this.fire("movenode",{oldParentNode:l,parentNode:n,index:r,node:t})}},insertNode:function(t,e,i){if(t){if(i||(i=this.root,e="add"),!mini.isNumber(e)){switch(e){case"before":e=this.indexOfNode(i),i=this.getParentNode(i),t=this.insertNode(t,e,i);break;case"after":e=this.indexOfNode(i),i=this.getParentNode(i),t=this.insertNode(t,e+1,i);break;case"append":case"add":t=this.addNode(t,i)}return t}var n=this._createNodes(i),s=this.getChildNodes(i);(e<0||e>s.length)&&(e=s.length),s.insert(e,t),this.viewNodes&&((s=s[e-1])?(s=n.indexOf(s),n.insert(s+1,t)):n.insert(0,t)),t._pid=i._id,this._setAdded(t);var o=this,n=t[this.nodesField];return n&&function l(t,e){for(var i=0,n=t.length;i<n;i++){var s=t[i];s._pid=e._id,o._setAdded(s),s[o.nodesField]&&l(s[o.nodesField])}}(n,t),this._dataChanged(),this.fire("addnode",{parentNode:i,index:e,node:t}),t}},removeNodeAt:function(t,e){e=e||this.root;var i=this.getChildNodes(e),n=i[t];return n?(i.removeAt(t),this.viewNodes&&e[this.nodesField].remove(n),this._setRemoved(n),this.cascadeChild(n,function(t,e,i){this._setRemoved(t)},this),this._checkSelecteds(),this._dataChanged(),this.fire("removenode",{parentNode:e,index:t,node:n}),n):null},bubbleParent:function(t,e,i){i=i||this,t&&e.call(this,t);t=this.getParentNode(t);t&&t!=this.root&&this.bubbleParent(t,e,i)},cascadeChild:function(t,e,i){if(e){t=t||this.root;var n=this.getChildNodes(t);if(n)for(var s=0,o=(n=n.clone()).length;s<o;s++){var l=n[s];if(!1===e.call(i||this,l,s,t))return;this.cascadeChild(l,e,i)}}},eachChild:function(t,e,i){if(e&&t){var n=t[this.nodesField];if(n)for(var s=n.clone(),o=0,l=s.length;o<l;o++){var r=s[o];if(!1===e.call(i||this,r,o,t))break}}},collapse:function(t,e){(t=this.getNode(t))&&(this.beginChange(),t.expanded=!1,e&&this.eachChild(t,function(t){null!=t[this.nodesField]&&this.collapse(t,e)},this),this.endChange("collapse"),this.fire("collapse",{node:t}))},expand:function(t,e){(t=this.getNode(t))&&(this.beginChange(),t.expanded=!0,e&&this.eachChild(t,function(t){null!=t[this.nodesField]&&this.expand(t,e)},this),this.endChange("expand"),this.fire("expand",{node:t}))},toggle:function(t){this.isExpandedNode(t)?this.collapse(t):this.expand(t)},expandNode:function(t){this.expand(t)},collapseNode:function(t){this.collapse(t)},collapseAll:function(){this.collapse(this.root,!0)},expandAll:function(){this.expand(this.root,!0)},collapseLevel:function(i,n){this.beginChange(),this.each(function(t){var e=this.getLevel(t);i==e&&this.collapse(t,n)},this),this.endChange()},expandLevel:function(i,n){this.beginChange(),this.each(function(t){var e=this.getLevel(t);i==e&&this.expand(t,n)},this),this.endChange()},expandPath:function(t){if(t=this.getNode(t))for(var e=this.getAncestors(t),i=0,n=e.length;i<n;i++)this.expandNode(e[i])},collapsePath:function(t){if(t=this.getNode(t))for(var e=this.getAncestors(t),i=0,n=e.length;i<n;i++)this.collapseNode(e[i])},isAncestor:function(t,e){if(t==e)return!0;if(!t||!e)return!1;if(t==this.getRootNode())return!0;for(var i=this.getAncestors(e),n=0,s=i.length;n<s;n++)if(i[n]==t)return!0;return!1},getAncestors:function(t){for(var e=[];;){var i=this.getParentNode(t);if(!i||i==this.root)break;t=e[e.length]=i}return e.reverse(),e},getNode:function(t){return"object"==typeof t?t:this.getRecord(t)},getRootNode:function(){return this.root},getParentNode:function(t){return t?this.getby_id(t._pid):null},getAllChildNodes:function(t,e){return this.getChildNodes(t,!0,e)},getChildNodes:function(t,e,i){var n=(t=(t=this.getNode(t))||this.getRootNode())[this.nodesField];if(this.viewNodes&&!1!==i&&(n=this.viewNodes[t._id]),!0===e&&n){for(var s=[],o=0,l=n.length;o<l;o++){var r=n[o];s[s.length]=r;r=this.getChildNodes(r,e,i);r&&0<r.length&&s.addRange(r)}n=s}return n||[]},getChildNodeAt:function(t,e){e=this.getChildNodes(e);return e?e[t]:null},hasChildNodes:function(t){return 0<this.getChildNodes(t).length},getLevel:function(t){return t._level},_is_true:function(t){return"true"==String(t)||1===t||"Y"===t||"y"===t},_is_false:function(t){return"false"==String(t)||0===t||"N"===t||"n"===t},leafField:"isLeaf",isLeafNode:function(t){return this.isLeaf(t)},isLeaf:function(t){if(!t)return!1;var e=t[this.leafField];return!(!t||this._is_false(e))&&!(0<this.getChildNodes(t,!1,!1).length)},hasChildren:function(t){t=this.getChildNodes(t);return!!(t&&0<t.length)},isFirstNode:function(t){if(t==this.root)return!0;var e=this.getParentNode(t);return!!e&&this.getFirstNode(e)==t},isLastNode:function(t){if(t==this.root)return!0;var e=this.getParentNode(t);return!!e&&this.getLastNode(e)==t},isCheckedNode:function(t){return!0===t.checked},isExpandedNode:function(t){return 1==t.expanded||1==t.expanded||mini.isNull(t.expanded)},isEnabledNode:function(t){return!1!==t.enabled},isVisibleNode:function(t){if(0==t.visible)return!1;t=this._ids[t._pid];return!t||t==this.root||!1!==t.expanded&&this.isVisibleNode(t)},getNextNode:function(t){var e=this.getby_id(t._pid);if(!e)return null;t=this.indexOfNode(t);return this.getChildNodes(e)[t+1]},getPrevNode:function(t){var e=this.getby_id(t._pid);if(!e)return null;t=this.indexOfNode(t);return this.getChildNodes(e)[t-1]},getFirstNode:function(t){return this.getChildNodes(t)[0]},getLastNode:function(t){t=this.getChildNodes(t);return t[t.length-1]},indexOfNode:function(t){var e=this.getby_id(t._pid);return e?this.getChildNodes(e).indexOf(t):-1},indexOfList:function(t){return this.getList().indexOf(t)},getAt:function(t){return this.getVisibleRows()[t]},indexOf:function(t){return this.getVisibleRows().indexOf(t)},getRange:function(t,e){var i;e<t&&(i=t,t=e,e=i);for(var n=this.getChildNodes(this.root,!0),s=[],o=t,l=e;o<=l;o++){var r=n[o];r&&s.push(r)}return s},selectRange:function(t,e){var i=this.getChildNodes(this.root,!0);mini.isNumber(t)||(t=i.indexOf(t)),mini.isNumber(e)||(e=i.indexOf(e)),mini.isNull(t)||mini.isNull(e)||(e=this.getRange(t,e),this.selects(e))},findRecords:function(t,e){var i=this.toArray(),n="function"==typeof t,s=t,o=e||this,l=[];mini.isNull(e)||(e=String(e));for(var r=0,a=i.length;r<a;r++){var h=i[r];if(n){var d=s.call(o,h);if(1==d&&(l[l.length]=h),1===d)break}else if(-1!=e.indexOf(","))for(var u=e.split(","),c=0,m=u.length;c<m;c++){var f=u[c];h[t]==f&&(l[l.length]=h)}else h[t]==e&&(l[l.length]=h)}return l},_dataChangedCount:0,_dataChanged:function(t){this._dataChangedCount++,"update"!=t&&(this.ids=null,this.dataview=null,this.visibleRows=null,"collapse"==t||"expand"==t||"loaddata"==t||(this.list=null)),0==this.__changeCount&&this.fire("datachanged")},_createDataView:function(){return this.viewNodes?this.getChildNodes(this.root,!0):this.getList()},_createVisibleRows:function(){var n,s,o=[],e=this.nodesField,i=this.viewNodes,l=!!i;function r(t){return l?i[t._id]:t[e]}return function a(t){for(var e=0,i=t.length;e<i;e++)n=t[e],!1===(o[o.length]=n).expanded||(s=r(n))&&a(s)}(r(this.root)),o},getList:function(){return this.list||(this.list=mini.treeToList(this.source,this.nodesField)),this.list},getDataView:function(){return this.dataview||(this.dataview=this._createDataView()),this.dataview},getVisibleRows:function(){return this.visibleRows||(this.visibleRows=this._createVisibleRows()),this.visibleRows},_doFilter:function(){var r,a,h,d;this._filterInfo?(r=this._filterInfo[0],a=this._filterInfo[1],h=this.viewNodes={},d=this.nodesField,function u(t){var e=t[d];if(!e)return!1;for(var t=t._id,i=h[t]=[],n=0,s=e.length;n<s;n++){var o=e[n],l=u(o);!0!==r.call(a,o,n,this)&&!l||i.push(o)}return 0<i.length}(this.root)):this.viewNodes=null},_doSort:function(){var s,o,l,r,a,h;this._filterInfo||this._sortInfo?this._sortInfo&&(s=this._sortInfo[0],o=this._sortInfo[1],l=this._sortInfo[2],r=this.nodesField,this.viewNodes||((a=this.viewNodes={})[this.root._id]=this.root[r].clone(),this.cascadeChild(this.root,function(t,e,i){var n=t[r];n&&(a[t._id]=n.clone())})),function d(t){var e=h.getChildNodes(t);mini.sort(e,s,o),l&&e.reverse();for(var i=0,n=e.length;i<n;i++)d(e[i])}((h=this).root)):this.viewNodes=null},toArray:function(){return this._array&&this._dataChangedCount==this._dataChangedCount2||(this._dataChangedCount2=this._dataChangedCount,this._array=this.getChildNodes(this.root,!0,!1)),this._array},toTree:function(){return this.root[this.nodesField]},isChanged:function(){return 0<this.getChanges().length},getChanges:function(t,e){var i=[];"removed"!=t&&null!=t||i.addRange(this._removeds.clone());for(var n=this.getAllChildNodes(this.root,!1),s=0,o=n.length;s<o;s++){var l=n[s];null!=l._state&&""!=l._state&&(l._state!=t&&null!=t||(i[i.length]=l))}var r=i;if(e)for(s=0,o=r.length;s<o;s++){var a=r[s];if("modified"==a._state){var h,d={};for(h in d._state=a._state,d[this.idField]=a[this.idField],a)this.isModified(a,h)&&(d[h]=a[h]);r[s]=d}}return i},accept:function(t){t=t||this.root,this.beginChange(),this.cascadeChild(this.root,function(t){this.acceptRecord(t)},this),this._removeds=[],this._originals={},this.endChange()},reject:function(t){this.beginChange(),this.cascadeChild(this.root,function(t){this.rejectRecord(t)},this),this._removeds=[],this._originals={},this.endChange()},acceptRecord:function(t){t._state&&(delete this._originals[t[this._originalIdField]],"deleted"==t._state?this.removeNode(t):(delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})))},rejectRecord:function(t){var e;t._state&&("added"==t._state?this.removeNode(t):"modified"!=t._state&&"deleted"!=t._state||(e=this._getOriginal(t),mini.copyTo(t,e),delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})))},upGrade:function(t){var e=this.getParentNode(t);if(e==this.root||t==this.root)return!1;for(var i=e[this.nodesField],n=i.indexOf(t),s=t[this.nodesField]?t[this.nodesField].length:0,o=i.length-1;n<=o;o--){var l=i[o];i.removeAt(o),l!=t&&(t[this.nodesField]||(t[this.nodesField]=[]),t[this.nodesField].insert(s,l))}var r=this.getParentNode(e),a=r[this.nodesField],n=a.indexOf(e);a.insert(n+1,t),this._updateParentAndLevel(t,r),this._doFilter(),this._dataChanged()},downGrade:function(t){if(this.isFirstNode(t))return!1;var e=this.getParentNode(t)[this.nodesField],i=e.indexOf(t),n=e[i-1];e.removeAt(i),n[this.nodesField]||(n[this.nodesField]=[]),n[this.nodesField].add(t),this._updateParentAndLevel(t,n),this._doFilter(),this._dataChanged()},_updateParentAndLevel:function(t,e){var n=this;t._pid=e._id,t._level=e._level+1,t[n.parentField]=e[n.idField],t[n.parentField]||(t[n.parentField]=e._id),this.cascadeChild(t,function(t,e,i){t._pid=i._id,t._level=i._level+1,t[n.parentField]=i[n.idField]},this),this._setModified(t)},setCheckModel:function(t){this.checkModel=t},getCheckModel:function(){return this.checkModel},setOnlyLeafCheckable:function(t){this.onlyLeafCheckable=t},getOnlyLeafCheckable:function(){return this.onlyLeafCheckable},setAutoCheckParent:function(t){this.autoCheckParent=t},getAutoCheckParent:function(){return this.autoCheckParent},_doUpdateLoadedCheckedNodes:function(){for(var t=this.getList(),e=0,i=t.length;e<i;e++){var n=t[e];1==n.checked&&(0!=this.autoCheckParent&&this.hasChildNodes(n)||this._doUpdateNodeCheckState(n))}},_doUpdateNodeCheckState:function(t){if(t){var e=this.isChecked(t);if(("cascade"==this.checkModel||this.autoCheckParent)&&(this.cascadeChild(t,function(t){this.doCheckNodes(t,e)},this),!this.autoCheckParent)){(d=this.getAncestors(t)).reverse();for(var i=0,n=d.length;i<n;i++){for(var s=d[i],o=this.getChildNodes(s),l=!0,r=0,a=o.length;r<a;r++){var h=o[r];this.isCheckedNode(h)||(l=!1)}l?this.doCheckNodes(s,!0):this.doCheckNodes(s,!1),this.fire("checkchanged",{nodes:[s],_nodes:[s]})}}var d,u=this;if(this.autoCheckParent){(d=this.getAncestors(t)).reverse();for(i=0,n=d.length;i<n;i++)(s=d[i]).checked=function(t){for(var e=u.getChildNodes(t),i=0,n=e.length;i<n;i++){var s=e[i];if(u.isCheckedNode(s))return!0}return!1}(s),this.fire("checkchanged",{nodes:[s],_nodes:[s]})}}},doCheckNodes:function(t,e,i){if(t){"string"==typeof t&&(t=t.split(",")),t=(t=!mini.isArray(t)?[t]:t).clone();var n=[];e=!1!==e,!0===i&&"single"==this.checkModel&&this.uncheckAllNodes();for(var s=t.length-1;0<=s;s--){var o=this.getRecord(t[s]);!o||e&&!0===o.checked||!e&&!0!==o.checked?o&&(!0===i&&this._doUpdateNodeCheckState(o),e||this.isLeaf(o)||n.push(o)):(o.checked=e,n.push(o),!0===i&&this._doUpdateNodeCheckState(o))}var l=this;setTimeout(function(){l.fire("_checkchanged",{nodes:t,_nodes:n,checked:e})},1)}},checkNode:function(t,e){this.doCheckNodes([t],!0,!1!==e)},uncheckNode:function(t,e){this.doCheckNodes([t],!1,!1!==e)},checkNodes:function(t,e){mini.isArray(t)||(t=[]),this.doCheckNodes(t,!0,!1!==e)},uncheckNodes:function(t,e){mini.isArray(t)||(t=[]),this.doCheckNodes(t,!1,!1!==e)},checkAllNodes:function(){var t=this.getList();this.doCheckNodes(t,!0,!1)},uncheckAllNodes:function(){var t=this.getList();this.doCheckNodes(t,!1,!1)},doGetCheckedNodes:function(t,e){!1===e&&(e="leaf");for(var i=[],n={},s=0,o=t.length;s<o;s++){var l=t[s],r=this.isLeafNode(l);if(!0===e){n[l._id]||(n[l._id]=l,i.push(l));for(var a=this.getAncestors(l),h=0,d=a.length;h<d;h++){var u=a[h];n[u._id]||(n[u._id]=u,i.push(u))}}else"parent"===e?r||n[l._id]||(n[l._id]=l,i.push(l)):"leaf"===e&&!r||n[l._id]||(n[l._id]=l,i.push(l))}return i},getCheckedNodes:function(t){var e=[];return this.cascadeChild(this.root,function(t){1==t.checked&&e.push(t)}),e=this.doGetCheckedNodes(e,t)},getCheckedNodesId:function(t,e){t=this.getCheckedNodes(t);return this.getValueAndText(t,e)[0]},getCheckedNodesText:function(t,e){t=this.getCheckedNodes(t);return this.getValueAndText(t,e)[1]},isChecked:function(t){return(t=this.getRecord(t))?!0===t.checked||1===t.checked:null},getCheckState:function(t){if(!(t=this.getRecord(t)))return null;if(!0===t.checked)return"checked";if(!t[this.nodesField])return"unchecked";if(t.indeterminate)return"indeterminate";for(var e=this.getChildNodes(t,!0),i=0,n=e.length;i<n;i++)if(!0===(t=e[i]).checked)return"indeterminate";return"unchecked"},getUnCheckableNodes:function(){var e=[];return this.cascadeChild(this.root,function(t){0==this.getCheckable(t)&&e.push(t)},this),e},setCheckable:function(t,e){if(t){0;for(var i=(t=(t=!mini.isArray(t)?[t]:t).clone()).length-1;0<=i;i--){var n=this.getRecord(t[i]);n&&(n.checkable=checked)}}},getCheckable:function(t){return!!(t=this.getRecord(t))&&(!0===t.checkable||!1!==t.checkable&&(!!this.isLeafNode(t)||!this.onlyLeafCheckable))},showNodeCheckbox:function(t,e){},reload:function(t,e,i){this._loadingNode=null,this.load(this.loadParams,t,e,i)},_isNodeLoading:function(){return!!this._loadingNode},loadNode:function(o,l){this._loadingNode=o,this.fire("beforeloadnode",{node:o});var e=new Date,r=this;r._doLoadAjax(r.loadParams,null,null,null,function(s){var t=new Date-e;t<60&&(t=60-t),setTimeout(function(){s.node=o,r._OnPreLoad(s),r._loadingNode=null,r.loadParams&&delete r.loadParams[r.idField];var t=o[r.nodesField];r.removeNodes(t);t=s.data;if(t&&0<t.length){r.collapse(o),r.addNodes(t,o);for(var e=r.getAllChildNodes(o),i=0,n=e.length;i<n;i++)delete e[i]._state;!1!==l?r.expand(o,!0):r.collapse(o,!0)}else delete o[r.leafField],r.expand(o,!0);r.fire("loadnode",s),r.fire("load",s)},t)},!0)}}),mini.regClass(mini.DataTree,"datatree"),mini._DataTableApplys={idField:"id",textField:"text",setAjaxData:function(t){this._dataSource.ajaxData=t},getby_id:function(t){return this._dataSource.getby_id(t)},getValueAndText:function(t,e){return this._dataSource.getValueAndText(t,e)},setIdField:function(t){this._dataSource.setIdField(t),this.idField=t},getIdField:function(){return this._dataSource.idField},setTextField:function(t){this._dataSource.setTextField(t),this.textField=t},getTextField:function(){return this._dataSource.textField},getLoadParams:function(){return this._dataSource.loadParams},clearData:function(){this._dataSource.clearData()},loadData:function(t){this._dataSource.loadData(t)},setData:function(t){this._dataSource.loadData(t)},getData:function(){return this._dataSource.getSource().clone()},getList:function(){return this._dataSource.getList()},getDataView:function(){return this._dataSource.getDataView()},getVisibleRows:function(){return this._useEmptyView?[]:this._dataSource.getVisibleRows()},toArray:function(){return this._dataSource.toArray()},getRecord:function(t){return"object"==typeof t?t:this._dataSource.getRecord(t)},getRow:function(t){return"object"==typeof t?t:this._dataSource.getRow(t)},getRange:function(t,e){if(!mini.isNull(t)&&!mini.isNull(e))return this._dataSource.getRange(t,e)},getAt:function(t){return this._dataSource.getAt(t)},indexOf:function(t){return this._dataSource.indexOf(t)},getRowByUID:function(t){return this._dataSource.getby_id(t)},getRowByUid:function(t){return this.getRowByUID(t)},getRowById:function(t){return this._dataSource.getbyId(t)},clearRows:function(){this._dataSource.clearData()},updateRow:function(t,e,i){this._dataSource.updateRecord(t,e,i)},addRow:function(t,e){e=this._dataSource.insert(e,t);return this.validateOnAdd&&this.validateRow(t),e},removeRow:function(t,e){return this._dataSource.remove(t,e)},removeRows:function(t,e){return this._dataSource.removeRange(t,e)},removeSelected:function(){var t=this.getSelected();t&&this.removeRow(t,!0)},removeRowAt:function(t,e){return this._dataSource.removeAt(t,e)},moveRow:function(t,e){this._dataSource.move(t,e)},addRows:function(t,e){return this._dataSource.insertRange(e,t)},findRows:function(t,e){return this._dataSource.findRecords(t,e)},findRow:function(t,e){return this._dataSource.findRecord(t,e)},multiSelect:!1,setMultiSelect:function(t){this._dataSource.setMultiSelect(t),this.multiSelect=t},getMultiSelect:function(){return this._dataSource.getMultiSelect()},setCurrent:function(t){this._dataSource.setCurrent(t)},getCurrent:function(){return this._dataSource.getCurrent()},isSelected:function(t){return this._dataSource.isSelected(t)},setSelected:function(t){this._dataSource.setSelected(t)},getSelected:function(){return this._dataSource.getSelected()},getSelecteds:function(){return this._dataSource.getSelecteds()},select:function(t,e){this._dataSource.select(t,e)},selects:function(t,e){this._dataSource.selects(t,e)},deselect:function(t,e){this._dataSource.deselect(t,e)},deselects:function(t,e){this._dataSource.deselects(t,e)},selectAll:function(t){this._dataSource.selectAll(t)},deselectAll:function(t){this._dataSource.deselectAll(t)},clearSelect:function(t){this.deselectAll(t)},selectPrev:function(){this._dataSource.selectPrev()},selectNext:function(){this._dataSource.selectNext()},selectFirst:function(){this._dataSource.selectFirst()},selectLast:function(){this._dataSource.selectLast()},selectRange:function(t,e){this._dataSource.selectRange(t,e)},filter:function(t,e){this._dataSource.filter(t,e)},clearFilter:function(){this._dataSource.clearFilter()},sort:function(t,e,i){this._dataSource.sort(t,e,i)},clearSort:function(){this._dataSource.clearSort()},findItems:function(t,e,i){return this._dataSource.findRecords(i,e,i)},getResultObject:function(){return this._dataSource._resultObject||{}},isChanged:function(){return this._dataSource.isChanged()},getChanges:function(t,e){return this._dataSource.getChanges(t,e)},accept:function(){this._dataSource.accept()},reject:function(){this._dataSource.reject()},acceptRecord:function(t){this._dataSource.acceptRecord(t)},rejectRecord:function(t){this._dataSource.rejectRecord(t)}},mini._DataTreeApplys={addRow:null,removeRow:null,removeRows:null,removeRowAt:null,moveRow:null,setExpandOnLoad:function(t){this._dataSource.setExpandOnLoad(t)},getExpandOnLoad:function(){return this._dataSource.getExpandOnLoad()},isSelectedNode:function(t){return t=this.getNode(t),this.getSelectedNode()===t},selectNode:function(t,e){t?this._dataSource.select(t,e):this._dataSource.deselect(this.getSelectedNode(),e)},getSelectedNode:function(){return this.getSelected()},getSelectedNodes:function(){return this.getSelecteds()},updateNode:function(t,e,i){this._dataSource.updateRecord(t,e,i)},addNode:function(t,e,i){return this._dataSource.insertNode(t,e,i)},removeNodeAt:function(t,e){return this._dataSource.removeNodeAt(t,e)},removeNode:function(t){return this._dataSource.removeNode(t)},moveNode:function(t,e,i){this._dataSource.moveNode(t,e,i)},addNodes:function(t,e,i){return this._dataSource.addNodes(t,e,i)},insertNodes:function(t,e,i){return this._dataSource.insertNodes(e,t,i)},moveNodes:function(t,e,i){this._dataSource.moveNodes(t,e,i)},removeNodes:function(t){return this._dataSource.removeNodes(t)},expandOnLoad:!1,checkRecursive:!0,autoCheckParent:!1,showFolderCheckBox:!0,idField:"id",textField:"text",parentField:"pid",nodesField:"children",checkedField:"checked",leafField:"isLeaf",resultAsTree:!0,setShowFolderCheckBox:function(t){this._dataSource.setShowFolderCheckBox(t),this.doUpdate&&this.doUpdate(),this.showFolderCheckBox=t},getShowFolderCheckBox:function(){return this._dataSource.getShowFolderCheckBox()},setCheckRecursive:function(t){this._dataSource.setCheckRecursive(t),this.checkRecursive=t},getCheckRecursive:function(){return this._dataSource.getCheckRecursive()},setResultAsTree:function(t){this._dataSource.setResultAsTree(t)},getResultAsTree:function(t){return this._dataSource.resultAsTree},setParentField:function(t){this._dataSource.setParentField(t),this.parentField=t},getParentField:function(){return this._dataSource.parentField},setLeafField:function(t){this._dataSource.leafField=t,this.leafField=t},getLeafField:function(){return this._dataSource.leafField},setNodesField:function(t){this._dataSource.setNodesField(t),this.nodesField=t},getNodesField:function(){return this._dataSource.nodesField},setCheckedField:function(t){this._dataSource.checkedField=t,this.checkedField=t},getCheckedField:function(){return this.checkedField},findNodes:function(t,e){return this._dataSource.findRecords(t,e)},getLevel:function(t){return this._dataSource.getLevel(t)},isVisibleNode:function(t){return this._dataSource.isVisibleNode(t)},isEnabledNode:function(t){return this._dataSource.isEnabledNode(t)},isExpandedNode:function(t){return this._dataSource.isExpandedNode(t)},isCheckedNode:function(t){return this._dataSource.isCheckedNode(t)},isLeaf:function(t){return this._dataSource.isLeafNode(t)},hasChildren:function(t){return this._dataSource.hasChildren(t)},isAncestor:function(t,e){return this._dataSource.isAncestor(t,e)},getNode:function(t){return this._dataSource.getRecord(t)},getRootNode:function(){return this._dataSource.getRootNode()},getParentNode:function(t){return this._dataSource.getParentNode.apply(this._dataSource,arguments)},getAncestors:function(t){return this._dataSource.getAncestors(t)},getAllChildNodes:function(t){return this._dataSource.getAllChildNodes.apply(this._dataSource,arguments)},getChildNodes:function(t,e){return this._dataSource.getChildNodes.apply(this._dataSource,arguments)},getChildNodeAt:function(t,e){return this._dataSource.getChildNodeAt.apply(this._dataSource,arguments)},indexOfNode:function(t){return this._dataSource.indexOfNode.apply(this._dataSource,arguments)},hasChildNodes:function(t){return this._dataSource.hasChildNodes.apply(this._dataSource,arguments)},isFirstNode:function(t){return this._dataSource.isFirstNode.apply(this._dataSource,arguments)},isLastNode:function(t){return this._dataSource.isLastNode.apply(this._dataSource,arguments)},getNextNode:function(t){return this._dataSource.getNextNode.apply(this._dataSource,arguments)},getPrevNode:function(t){return this._dataSource.getPrevNode.apply(this._dataSource,arguments)},getFirstNode:function(t){return this._dataSource.getFirstNode.apply(this._dataSource,arguments)},getLastNode:function(t){return this._dataSource.getLastNode.apply(this._dataSource,arguments)},toggleNode:function(t){this._dataSource.toggle(t)},collapseNode:function(t,e){this._dataSource.collapse(t,e)},expandNode:function(t,e){this._dataSource.expand(t,e)},collapseAll:function(){this.useAnimation=!1,this._dataSource.collapseAll(),this.useAnimation=!0},expandAll:function(){this.useAnimation=!1,this._dataSource.expandAll(),this.useAnimation=!0},expandLevel:function(t){this.useAnimation=!1,this._dataSource.expandLevel(t),this.useAnimation=!0},collapseLevel:function(t){this.useAnimation=!1,this._dataSource.collapseLevel(t),this.useAnimation=!0},expandPath:function(t){this.useAnimation=!1,this._dataSource.expandPath(t),this.useAnimation=!0},collapsePath:function(t){this.useAnimation=!1,this._dataSource.collapsePath(t),this.useAnimation=!0},loadNode:function(t,e){this._dataSource.loadNode(t,e)},setCheckModel:function(t){this._dataSource.setCheckModel(t)},getCheckModel:function(){return this._dataSource.getCheckModel()},setOnlyLeafCheckable:function(t){this._dataSource.setOnlyLeafCheckable(t)},getOnlyLeafCheckable:function(){return this._dataSource.getOnlyLeafCheckable()},setAutoCheckParent:function(t){this._dataSource.setAutoCheckParent(t)},getAutoCheckParent:function(){return this._dataSource.getAutoCheckParent()},checkNode:function(t,e){this._dataSource.checkNode(t,e)},uncheckNode:function(t,e){this._dataSource.uncheckNode(t,e)},checkNodes:function(t,e){this._dataSource.checkNodes(t,e)},uncheckNodes:function(t,e){this._dataSource.uncheckNodes(t,e)},checkAllNodes:function(){this._dataSource.checkAllNodes()},uncheckAllNodes:function(){this._dataSource.uncheckAllNodes()},getCheckedNodes:function(){return this._dataSource.getCheckedNodes.apply(this._dataSource,arguments)},getCheckedNodesId:function(){return this._dataSource.getCheckedNodesId.apply(this._dataSource,arguments)},getCheckedNodesText:function(){return this._dataSource.getCheckedNodesText.apply(this._dataSource,arguments)},getNodesByValue:function(t){mini.isNull(t)&&(t=""),t=String(t);for(var e=[],i=String(t).split(","),n=0,s=i.length;n<s;n++){var o=this.getNode(i[n]);o&&e.push(o)}return e},isChecked:function(t){return this._dataSource.isChecked.apply(this._dataSource,arguments)},getCheckState:function(t){return this._dataSource.getCheckState.apply(this._dataSource,arguments)},setCheckable:function(t,e){this._dataSource.setCheckable.apply(this._dataSource,arguments)},getCheckable:function(t){return this._dataSource.getCheckable.apply(this._dataSource,arguments)},bubbleParent:function(t,e,i){this._dataSource.bubbleParent.apply(this._dataSource,arguments)},cascadeChild:function(t,e,i){this._dataSource.cascadeChild.apply(this._dataSource,arguments)},eachChild:function(t,e,i){this._dataSource.eachChild.apply(this._dataSource,arguments)}},mini.ColumnModel=function(t){this.owner=t,mini.ColumnModel.superclass.constructor.apply(this,arguments),this._init()},mini.ColumnModel_ColumnID=1,mini.extend(mini.ColumnModel,mini.Component,{_defaultColumnWidth:100,_init:function(){this.columns=[],this._columnsRow=[],this._visibleColumnsRow=[],this._bottomColumns=[],this._visibleColumns=[],this._idColumns={},this._nameColumns={},this._fieldColumns={}},getColumns:function(){return this.columns},getAllColumns:function(){var t,e=[];for(t in this._idColumns){var i=this._idColumns[t];e.push(i)}return e},getColumnsRow:function(){return this._columnsRow},getVisibleColumnsRow:function(){return this._visibleColumnsRow},getBottomColumns:function(){return this._bottomColumns},getVisibleColumns:function(){return this._visibleColumns},_getBottomColumnsByColumn:function(t){t=this.getColumn(t);for(var e=this._bottomColumns,i=[],n=0,s=e.length;n<s;n++){var o=e[n];this.isAncestorColumn(t,o)&&i.push(o)}return i},_getVisibleColumnsByColumn:function(t){t=this.getColumn(t);for(var e=this._visibleColumns,i=[],n=0,s=e.length;n<s;n++){var o=e[n];this.isAncestorColumn(t,o)&&i.push(o)}return i},setColumns:function(t){mini.isArray(t)||(t=[]),this._init(),this.columns=t,this._columnsChanged()},_columnsChanged:function(){this._updateColumnsView(),this.fire("columnschanged")},columnDefaults:{allowCellWrap:!1},_updateColumnsView:function(){var o=this._maxColumnLevel=0;this.eachColumns(this,function a(t,e,i){var n,s;t.type&&(mini.isNull(t.header)||"function"==typeof t.header||""==t.header.trim()&&delete t.header,(n=mini._getColumn(t.type))&&(s=mini.copyTo({},t),mini.copyTo(t,n),mini.copyTo(t,s))),t._id||(t._id=mini.ColumnModel_ColumnID++),t._pid=i==this?-1:i._id,(this._idColumns[t._id]=t).name&&(this._nameColumns[t.name]=t),t._level=o,o+=1,this.eachColumns(t,a,this),--o,t._level>this._maxColumnLevel&&(this._maxColumnLevel=t._level);i=parseInt(t.width);mini.isNumber(i)&&String(i)==t.width&&(t.width=i+"px"),mini.isNull(t.width)&&(t.width=this._defaultColumnWidth+"px"),String(t.width).indexOf("px")&&(t.pxWidth=parseInt(t.width)),t.visible=!1!==t.visible,t.allowResize=!1!==t.allowResize,t.allowMove=!1!==t.allowMove,t.allowSort=!0===t.allowSort,t.allowDrag=!!t.allowDrag,t.readOnly=!!t.readOnly,t.autoEscape=!!t.autoEscape,t.enabled=!1!==t.enabled,t.showCellTip=!1!==t.showCellTip,t.valueFromSelect=!1!==t.valueFromSelect,t.vtype=t.vtype||"",null==t.allowCellWrap&&(t.allowCellWrap=this.columnDefaults.allowCellWrap),"string"==typeof t.filter&&(t.filter=window.eval("("+t.filter+")")),t.filter&&!t.filter.el&&(t.filter=mini.create(t.filter)),"function"==typeof t.init&&1!=t.inited&&t.init(this.owner),t.inited=!0,t._gridUID=this.owner.uid,t._rowIdField=this.owner._rowIdField},this),this._createColumnsRow();var e=0,i=this._visibleColumns=[],n=this._bottomColumns=[];this.cascadeColumns(this,function(t){t.columns&&0!=t.columns.length||(n.push(t),this.isVisibleColumn(t)&&(i.push(t),t._index=e++))},this),this._fieldColumns={};for(var t=this.getAllColumns(),s=0,l=t.length;s<l;s++){var r=t[s];r.field&&!this._fieldColumns[r.field]&&(this._fieldColumns[r.field]=r)}this._createFrozenColSpan()},_frozenStartColumn:-1,_frozenEndColumn:-1,isFrozen:function(){return 0<=this._frozenStartColumn&&this._frozenEndColumn>=this._frozenStartColumn},isFrozenColumn:function(t){if(!this.isFrozen())return!1;if(!(t=this.getColumn(t)))return!1;t=this.getVisibleColumns().indexOf(t);return this._frozenStartColumn<=t&&t<=this._frozenEndColumn},frozen:function(t,e){t=this.getColumn(t),e=this.getColumn(e);var i=this.getVisibleColumns();this._frozenStartColumn=i.indexOf(t),this._frozenEndColumn=i.indexOf(e),t&&e&&this._columnsChanged()},unFrozen:function(){this._frozenStartColumn=-1,this._frozenEndColumn=-1,this._columnsChanged()},setFrozenStartColumn:function(t){this.frozen(t,this._frozenEndColumn)},setFrozenEndColumn:function(t){this.frozen(this._frozenStartColumn,t)},getFrozenColumns:function(){for(var t=[],e=this.isFrozen(),i=0,n=this._visibleColumns.length;i<n;i++)e&&this._frozenStartColumn<=i&&i<=this._frozenEndColumn&&t.push(this._visibleColumns[i]);return t},getUnFrozenColumns:function(){for(var t=[],e=this.isFrozen(),i=0,n=this._visibleColumns.length;i<n;i++)(e&&i>this._frozenEndColumn||!e)&&t.push(this._visibleColumns[i]);return t},getFrozenColumnsRow:function(){return this.isFrozen()?this._columnsRow1:[]},getUnFrozenColumnsRow:function(){return this.isFrozen()?this._columnsRow2:this.getVisibleColumnsRow()},_createFrozenColSpan:function(){var r=this,l=this.getVisibleColumns(),a=this._frozenStartColumn,h=this._frozenEndColumn;function d(t,e){for(var i=r.isBottomColumn(t)?[t]:r._getVisibleColumnsByColumn(t),n=0,s=i.length;n<s;n++){var o=i[n],o=l.indexOf(o);if(0==e&&o<a)return!0;if(1==e&&a<=o&&o<=h)return!0;if(2==e&&h<o)return!0}return!1}function t(t,e){for(var i=mini.treeToList(t.columns,"columns"),n=0,s=0,o=i.length;s<o;s++){var l=i[s];0!=r.isVisibleColumn(l)&&0!=d(l,e)&&(l.columns&&0!=l.columns.length||(n+=1))}return n}for(var e=mini.treeToList(this.columns,"columns"),i=0,n=e.length;i<n;i++){var s=e[i];delete s.colspan0,delete s.colspan1,delete s.colspan2,delete s.viewIndex0,delete s.viewIndex1,delete s.viewIndex2,this.isFrozen()&&(s.columns&&0<s.columns.length?(s.colspan1=t(s,1),s.colspan2=t(s,2),s.colspan0=t(s,0)):(s.colspan1=1,s.colspan2=1,s.colspan0=1),d(s,0)&&(s.viewIndex0=!0),d(s,1)&&(s.viewIndex1=!0),d(s,2)&&(s.viewIndex2=!0))}this._getMaxColumnLevel();this._columnsRow1=[],this._columnsRow2=[];for(i=0,n=this._visibleColumnsRow.length;i<n;i++){var o=this._visibleColumnsRow[i],u=[],c=[];this._columnsRow1.push(u),this._columnsRow2.push(c);for(var m=0,f=o.length;m<f;m++){var p=o[m];p.viewIndex1&&u.push(p),p.viewIndex2&&c.push(p)}}},_createColumnsRow:function(){for(var t=this._getMaxColumnLevel(),e=[],i=[],n=0,s=t;n<=s;n++)e.push([]),i.push([]);var l=this;for(var o=mini.treeToList(this.columns,"columns"),n=0,s=o.length;n<s;n++){var r=o[n],a=e[r._level],h=i[r._level];delete r.rowspan,delete r.colspan,r.columns&&0<r.columns.length&&(r.colspan=function(t){for(var e=mini.treeToList(t.columns,"columns"),i=0,n=0,s=e.length;n<s;n++){var o=e[n];0!=l.isVisibleColumn(o)&&(o.columns&&0!=o.columns.length||(i+=1))}return i}(r)),(!r.columns||0==r.columns.length)&&r._level<t&&(r.rowspan=t-r._level+1),a.push(r),this.isVisibleColumn(r)&&h.push(r)}this._columnsRow=e,this._visibleColumnsRow=i},_getMaxColumnLevel:function(){return this._maxColumnLevel},cascadeColumns:function(t,e,i){if(e){var n=t.columns;if(n)for(var s=0,o=(n=n.clone()).length;s<o;s++){var l=n[s];if(!1===e.call(i||this,l,s,t))return;this.cascadeColumns(l,e,i)}}},eachColumns:function(t,e,i){var n=t.columns;if(n)for(var s=n.clone(),o=0,l=s.length;o<l;o++){var r=s[o];if(!1===e.call(i,r,o,t))break}},getColumn:function(t){var e=typeof t;return"number"==e?this._bottomColumns[t]:"object"==e?t:this._nameColumns[t]},getColumnByField:function(t){return t?this._fieldColumns[t]:null},_getColumnById:function(t){return this._idColumns[t]},_getDataTypeByField:function(t){for(var e="string",i=this.getBottomColumns(),n=0,s=i.length;n<s;n++){var o=i[n];if(o.field==t){o.sortType?e=o.sortType.toLowerCase():o.dataType&&(e=o.dataType.toLowerCase());break}}return e},getParentColumn:function(t){t=(t=this.getColumn(t))._pid;return-1==t?this:this._idColumns[t]},getAncestorColumns:function(t){for(var e=[t];;){var i=this.getParentColumn(t);if(!i||i==this)break;t=e[e.length]=i}return e.reverse(),e},isAncestorColumn:function(t,e){if(t==e)return!0;if(!t||!e)return!1;for(var i=this.getAncestorColumns(e),n=0,s=i.length;n<s;n++)if(i[n]==t)return!0;return!1},isVisibleColumn:function(t){if(0==(t=this.getColumn(t)).visible)return!1;for(var e=this.getAncestorColumns(t),i=0,n=e.length;i<n;i++)if(0==e[i].visible)return!1;var s=t.columns;if(s){for(var o=!0,i=0,n=s.length;i<n;i++){var l=s[i];if(this.isVisibleColumn(l)){o=!1;break}}if(o)return!1}return!0},isBottomColumn:function(t){return!((t=this.getColumn(t)).columns&&0<t.columns.length)},updateColumn:function(t,e){(t=this.getColumn(t))&&(mini.copyTo(t,e),this._columnsChanged())},moveColumn:function(t,e,i){if(t=this.getColumn(t),e=this.getColumn(e),t&&e&&i&&t!=e&&!this.isAncestorColumn(t,e)){var n=this.getParentColumn(t);n&&n.columns.remove(t);n=e,i=i;if("before"==i)i=(n=this.getParentColumn(e)).columns.indexOf(e);else if("after"==i)i=(n=this.getParentColumn(e)).columns.indexOf(e)+1;else if("add"==i||"append"==i)n.columns||(n.columns=[]),i=n.columns.length;else if(!mini.isNumber(i))return;n.columns.insert(i,t),this._columnsChanged()}},addColumn:function(t){t&&(delete t._id,this._columnsChanged())},removeColumn:function(){this._columnsChanged()}}),mini.GridView=function(){var t;this._createTime=new Date,this._createColumnModel(),this._bindColumnModel(),this.data=[],this._createSource(),this._bindSource(),this._initData(),mini.GridView.superclass.constructor.apply(this,arguments),this._doUpdateFilterRow(),this._doUpdateSummaryRow(),this.doUpdate(),mini.isNull(this._paddingTop)&&(mini.isNull(mini.GridView._paddingTop)&&(t=jQuery('<div class="mini-grid-cell-inner" style="position:absolute;left:-1000px;top:-1000px;"></div>').appendTo("body"),t=mini.getPaddings(t),mini.GridView._paddingTop=t.top,mini.GridView._paddingBottom=t.bottom),this._paddingTop=mini.GridView._paddingTop,this._paddingBottom=mini.GridView._paddingBottom),this._rowClsHash={}},mini.extend(mini.GridView,mini.Panel,{_displayStyle:"block",_rowIdField:"_id",width:"100%",showSortIcon:!1,showColumns:function(t){for(var e=0,i=t.length;e<i;e++){var n=this.getColumn(t[e]);n&&(n.visible=!0)}this._columnModel._columnsChanged()},showFilterRow:!1,showSummaryRow:!1,summaryRows:1,showPager:!1,allowCellWrap:!1,allowHeaderWrap:!1,showModified:!0,showNewRow:!0,showEmptyText:!1,emptyText:"No data returned.",showHGridLines:!0,showVGridLines:!0,_rowCls:"mini-grid-row",_cellCls:"mini-grid-cell",_headerCellCls:"mini-grid-headerCell",_rowSelectedCls:"mini-grid-row-selected",_rowHoverCls:"mini-grid-row-hover",_cellSelectedCls:"mini-grid-cell-selected",defaultRowHeight:25,fixedRowHeight:!1,isFixedRowHeight:function(){return this.fixedRowHeight},fitColumns:!0,isFitColumns:function(){return this.fitColumns},allowAlternating:!1,_alternatingCls:"mini-grid-row-alt",getAllowAlternating:function(){return this.allowAlternating},setAllowAlternating:function(t){this.allowAlternating=t,this.doUpdate()},showGroupSummary:!1,getShowGroupSummary:function(){return this.showGroupSummary},setShowGroupSummary:function(t){this.showGroupSummary=t},summaryPosition:"bottom",getSummaryPosition:function(){return this.summaryPosition},setSummaryPosition:function(t){this.summaryPosition=t,"top"==this.summaryPosition&&(mini.before(this._rowsEl,this._summaryEl),mini.before(this._summaryViewEl,this._summaryLockEl)),jQuery(this.el).toggleClass("mini-grid-summary-top","top"==t)},uiCls:"mini-gridview",_create:function(){mini.GridView.superclass._create.call(this);var t=this.el;mini.addClass(t,"mini-grid"),mini.addClass(this._borderEl,"mini-grid-border"),mini.addClass(this._viewportEl,"mini-grid-viewport");this._columnsEl=mini.after(this._toolbarEl,'<div class="mini-grid-columns"><div class="mini-grid-columns-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._filterEl=mini.after(this._columnsEl,'<div class="mini-grid-filterRow"><div class="mini-grid-filterRow-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._rowsEl=this._bodyEl,mini.addClass(this._rowsEl,"mini-grid-rows"),this._summaryEl=mini.after(this._rowsEl,'<div class="mini-grid-summaryRow"><div class="mini-grid-summaryRow-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._bottomPagerEl=mini.after(this._summaryEl,'<div class="mini-grid-pager"></div>'),this._columnsViewEl=this._columnsEl.childNodes[0],this._rowsViewEl=mini.append(this._rowsEl,'<div class="mini-grid-rows-view"><div class="mini-grid-rows-content"></div></div>'),this._rowsViewContentEl=this._rowsViewEl.firstChild,this._filterViewEl=this._filterEl.childNodes[0],this._summaryViewEl=this._summaryEl.childNodes[0];this._focusEl=mini.append(this._borderEl,'<a href="#" class="mini-grid-focus" style="position:absolute;left:0px;top:0px;width:0px;height:0px;outline:none;" hideFocus onclick="return false" ></a>');var e=this;mini.on(this._filterViewEl,"scroll",function(t){0<e._filterViewEl.scrollLeft&&(e._filterViewEl.scrollLeft=0)})},destroy:function(t){if(this._dataSource&&(this._dataSource.destroy(),this._dataSource=null),this._columnModel&&(this._columnModel.destroy(),this._columnModel=null),this._pagers){for(var e=this._pagers.clone(),i=0,n=e.length;i<n;i++)e[i].destroy(t);this._pagers=null}this._viewportEl&&mini.clearEvent(this._viewportEl),this._rowsViewEl&&mini.clearEvent(this._rowsViewEl),this._rowsEl&&mini.clearEvent(this._rowsEl),this._vscrollEl&&mini.clearEvent(this._vscrollEl),this._headerEl&&mini.clearEvent(this._headerEl),this._columnsEl&&(jQuery(this._columnsEl).unbind("mouseenter"),jQuery(this._columnsEl).unbind("mouseleave")),this._columnsEl=this._rowsEl=this._filterEl=this._summaryEl=this._bottomPagerEl=null,this._columnsViewEl=this._topRightCellEl=this._rowsViewEl=this._rowsViewContentEl=null,this._filterViewEl=this._summaryViewEl=this._focusEl=null,this._viewportEl=this._vscrollEl=this._bottomPager=null,mini.GridView.superclass.destroy.call(this,t)},_initEvents:function(){mini.GridView.superclass._initEvents.call(this),this._bindScrollEvent()},_bindScrollEvent:function(){var t=this;this._unbindScrollEvent(),this._scrollBindTimer=setTimeout(function(){mini.on(t._rowsViewEl,"scroll",t.__OnRowViewScroll,t)},100)},_unbindScrollEvent:function(){this._scrollBindTimer&&(clearTimeout(this._scrollBindTimer),this._scrollBindTimer=null),mini.un(this._rowsViewEl,"scroll",this.__OnRowViewScroll,this)},_syncScrollOffset:function(t,e){this._unbindScrollEvent(),null!=t&&(this._rowsViewEl.scrollLeft=t),null!=e&&(this._rowsViewEl.scrollTop=e,this._vscrollEl),this._bindScrollEvent()},_sizeChanged:function(){mini.GridView.superclass._sizeChanged.call(this);var t=this.isAutoHeight();mini.isIE&&(t?mini.addClass(this._rowsViewEl,"mini-grid-hidden-y"):mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y"))},_setBodyWidth:!1,doLayoutCardView:function(){var t=this._rowsViewEl.scrollHeight>this._rowsViewEl.clientHeight+1,e=this._columnsViewEl.firstChild,t=t?mini.getScrollOffset():0;e.parentNode.style.paddingRight=t+"px",e.style.width="100%"},doLayout:function(){var t,e,i,n,s,o,l,r,a,h,d,u=this;function c(t){this.isFitColumns()?(i.style.width="100%",mini.isSafari||mini.isIE6?t.style.width=h+"px":r?(t.style.width="100%",t.parentNode.style.width="auto",n!=t&&(t.parentNode.style.paddingRight=mini.getScrollOffset()+"px"),mini.isIE8&&mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y")):(t.style.width="100%",t.parentNode.style.width="auto",t.parentNode.style.paddingRight="0px",mini.isIE8&&mini.addClass(this._rowsViewEl,"mini-grid-hidden-y"))):(i.style.width="0px",t.style.width="0px",mini.isSafari||mini.isChrome||mini.isIE6||(t.parentNode.style.width="100%",t.parentNode.style.paddingRight="0px"))}this.canLayout()&&(mini.GridView.superclass.doLayout.call(this),this._stopLayout(),"cardview"!=this.viewType?(t=this._autoHeight,mini.isIE&&(t?mini.addClass(this._rowsViewEl,"mini-grid-hidden-y"):mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y")),e=this._columnsViewEl.firstChild,i=this._rowsViewContentEl.firstChild,n=this._filterViewEl.firstChild,s=this._summaryViewEl.firstChild,o=jQuery(this._columnsViewEl).height(),l=n.offsetHeight,r=this._rowsViewEl.scrollHeight>this._rowsViewEl.clientHeight+1,a=this._rowsViewEl.scrollWidth>this._rowsViewEl.clientWidth+1,h=this._rowsViewContentEl.parentNode.offsetWidth-(r?mini.getScrollOffset():0),c.call(this,e),c.call(this,n),c.call(this,s),this._syncScroll(),d=this,setTimeout(function(){mini.layout(d._filterEl),mini.layout(d._summaryEl)},10),mini.isIE6&&setTimeout(function(){c.call(u,e)},1),mini.isIE10&&(setTimeout(function(){d.isFitColumns()?(e.style.width="auto",e.offsetWidth,e.style.width="100%"):e.style.width="0px"},0),mini.repaint(i)),this._topRightCellEl=this._columnsViewEl.childNodes[1],mini.isIE6&&(this._topRightCellEl.style.height=o),(mini.isIE6||mini.isIE7)&&(this._rowsViewContentEl.style.paddingBottom="0px",t&&a&&(this._rowsViewContentEl.style.paddingBottom="17px")),this._filterViewEl.style.height=l+"px",n.style.width=this.isFitColumns()?h+"px":""):this.doLayoutCardView())},setBody:function(){},_createTopRowHTML:function(t,e,i){var n="";mini.isIE?mini.isIE6||mini.isIE7||!mini.boxModel?n+='<tr style="display:none;height:0px;">':n+='<tr style="height:0px;">':mini.isChrome&&i&&0==i.length?n+='<tr style="height:1px;">':n+='<tr style="height:0px;">',!1!==this._userEmptyTd&&(n+='<td style="height:0px;width:0;"></td>');for(var s=0,o=t.length;s<o;s++){var l=t[s];l.width;n+='<td id="'+l._id+'" style="padding:0;border:0;margin:0;height:0px;',l.width&&(n+="width:"+l.width),l.minWidth&&(n+=";min-width:"+l.minWidth+"px"),n+='" ></td>'}return n+='<td style="width:0px;"></td>',n+="</tr>"},_createColumnsHTML:function(t,e,i){var i=i||this.getVisibleColumns(),n=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];n.push(this._createTopRowHTML(i));for(var s=this.getSortField(),o=this.getSortOrder(),l=0,r=t.length;l<r;l++){var a=t[l];n[n.length]="<tr>",n[n.length]='<td style="width:0;"></td>';for(var h=0,d=a.length;h<d;h++){var u=a[h],c=u.sortField||u.field,m=this._createHeaderText(u,e),f=this._createHeaderCellId(u,e),p="";s&&s==c&&(p="asc"==o?"mini-grid-asc":"mini-grid-desc");c="";0==this.allowHeaderWrap&&(c=" mini-grid-headerCell-nowrap "),n[n.length]='<td id="',n[n.length]=f,n[n.length]='" class="mini-grid-headerCell '+p+" "+(u.headerCls||"")+" ",u.columns&&0<u.columns.length||(n[n.length]=" mini-grid-bottomCell "),h==d-1&&(n[n.length]=" mini-grid-rightCell "),n[n.length]='" style="',u.headerStyle&&(n[n.length]=u.headerStyle+";"),u.headerAlign&&(n[n.length]="text-align:"+u.headerAlign+";"),n[n.length]='" ',u.rowspan&&(n[n.length]='rowspan="'+u.rowspan+'" '),this._createColumnColSpan(u,n,e),n[n.length]='><div class="mini-grid-headerCell-outer"><div class="mini-grid-headerCell-inner '+c+'">',n[n.length]=m,p?n[n.length]='<span class="mini-grid-sortIcon mini-icon"></span>':this.showSortIcon&&u.allowSort&&(n[n.length]='<span class="mini-grid-allowsort mini-icon"></span>'),n[n.length]='</div><div id="'+u._id+'" class="mini-grid-column-splitter"></div>',n[n.length]="</div></td>"}this.isFrozen()&&1==e&&(n[n.length]='<td class="mini-grid-headerCell" style="width:0;"><div class="mini-grid-headerCell-inner" style="',n[n.length]='">0</div></td>'),n[n.length]="</tr>"}return n.push("</table>"),n.join("")},_createHeaderText:function(t,e){var i=t.header;return"function"==typeof i&&(i=i.call(this,t)),i=mini.isNull(i)||""===i?"&nbsp;":i},_createColumnColSpan:function(t,e,i){t.colspan&&(e[e.length]='colspan="'+t.colspan+'" ')},doUpdateColumns:function(){var t=this._columnsViewEl.scrollLeft,e=this.getVisibleColumnsRow(),e=this._createColumnsHTML(e,2);this._columnsViewEl.innerHTML=e+='<div class="mini-grid-topRightCell"></div>',this._columnsViewEl.scrollLeft=t},doUpdate:function(){var t,e,i,n;0!=this.canUpdate()&&(e=(t=this)._isCreating(),new Date,this._doUpdateSummaryRow(),n=(i=this).getScrollLeft(),i.doUpdateColumns(),e&&(this._useEmptyView=!0),this._doRemoveRowContent(),"cardview"==t.viewType?i.updateCardView():i.doUpdateRows(),0<n&&i.isVirtualScroll()&&i._syncScrollOffset(n),e&&(this._useEmptyView=!1),i.doLayout(),e&&!this._doUpdateTimer&&(this._doUpdateTimer=setTimeout(function(){i.el&&(i.doUpdateColumns(),"cardview"==t.viewType?i.updateCardView():i.doUpdateRows(),i.doLayout(),i._doUpdateTimer=null)},15)),this.unmask(),t._fireUpdateTimer&&(clearTimeout(t._fireUpdateTimer),t._fireUpdateTimer=null),t._fireUpdateTimer=setTimeout(function(){t._fireUpdateTimer=null,t.fire("update")},100))},_doRemoveRowContent:function(){this._rowsViewContentEl&&this._rowsViewContentEl.firstChild&&this._rowsViewContentEl.removeChild(this._rowsViewContentEl.firstChild),this._rowsLockContentEl&&this._rowsLockContentEl.firstChild&&this._rowsLockContentEl.removeChild(this._rowsLockContentEl.firstChild)},_isCreating:function(){return new Date-this._createTime<1e3},deferUpdate:function(t){var e;t=t||5,this._updateTimer||this._doUpdateTimer||((e=this)._updateTimer=setTimeout(function(){e._updateTimer=null,e.doUpdate()},t))},_stopDeferUpdate:function(){this._updateTimer&&(clearTimeout(this._updateTimer),this._updateTimer=null)},_pushUpdateCallback:function(t,e,i){var n=0;0==(n=this._doUpdateTimer||this._updateTimer?20:n)?t.apply(e,i):setTimeout(function(){t.apply(e,i)},n)},_updateCount:0,beginUpdate:function(){this._updateCount++},endUpdate:function(t){this._updateCount--,0!=this._updateCount&&!0!==t||(this._updateCount=0,this.doUpdate())},canUpdate:function(){return 0==this._updateCount},setDefaultRowHeight:function(t){this.defaultRowHeight=t},getDefaultRowHeight:function(){return this.defaultRowHeight},_getRowHeight:function(t){var e=this.defaultRowHeight;return t._height&&(e=parseInt(t._height),isNaN(parseInt(t._height))&&(e=rowHeight)),e=e-this._paddingTop-this._paddingBottom,--e},_createGroupingHTML:function(s,o){var t=this.getGroupingView(),e=this.showGroupSummary,i=this.isFrozen(),l=0,r=this;var n=!1!==this.groupTitleCollapsible,a=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];a.push(this._createTopRowHTML(s));for(var h=0,d=t.length;h<d;h++)if(1!=o||this.isFrozen()){var u=t[h],c=this._createRowGroupId(u,o),m=this._createRowGroupRowsId(u,o),f=this._OnDrawGroup(u),p=u.expanded?"":" mini-grid-group-collapse ";a[a.length]='<tr id="',a[a.length]=c,a[a.length]='" class="mini-grid-groupRow',a[a.length]=p,a[a.length]='"><td style="width:0;"></td><td class="mini-grid-groupCell ',a[a.length]=f.cls,a[a.length]='" style="',a[a.length]=f.style,a[a.length]='" colspan="',a[a.length]=s.length,a[a.length]='"><div class="mini-grid-groupHeader ',n&&(a[a.length]="mini-grid-groupHeader-collapsible"),a[a.length]='">',!i||i&&1==o?(a[a.length]='<div class="mini-grid-group-ecicon"></div>',a[a.length]='<div class="mini-grid-groupTitle">'+f.cellHtml+"</div>"):a[a.length]="&nbsp;",a[a.length]="</div></td></tr>";p=u.expanded?"":"display:none";if(a[a.length]='<tr class="mini-grid-groupRows-tr" style="',a[a.length]='"><td style="width:0;"></td><td class="mini-grid-groupRows-td" colspan="',a[a.length]=s.length,a[a.length]='"><div id="',a[a.length]=m,a[a.length]='" class="mini-grid-groupRows" style="',mini.isChrome&&(a[a.length]="margin-left:-1px;"),a[a.length]=p,a[a.length]='">',function(t){if(a.push('<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'),0<s.length){a.push(r._createTopRowHTML(s));for(var e=0,i=t.length;e<i;e++){var n=t[e];r._createRowHTML(n,l++,s,o,a)}}a.push("</table>")}(u.rows),a[a.length]="</div></td></tr>",e&&0<s.length){a[a.length]='<tr class="mini-grid-groupFooter">',a[a.length]='<td style="width:0;"></td>';for(var g=0,_=s.length;g<_;g++){var v=s[g],f=this._OnDrawSummaryCell(u.rows,v,u);a[a.length]='<td id="',a[a.length]="",a[a.length]='" class="mini-grid-cell '+f.cellCls+'" style="'+f.cellStyle+";",a[a.length]='"><div class="mini-grid-cell-inner">',a[a.length]=f.cellHtml,a[a.length]="</div></td>"}a[a.length]="</tr>"}}return a.push("</table>"),a.join("")},_isFastCreating:function(){return 50<this.getVisibleRows().length&&(this._isCreating()||this.getScrollTop()<50*this._defaultRowHeight)},isShowRowDetail:function(t){return!1},isCellValid:function(t,e){return!0},updateCardView:function(){for(var t=this.getVisibleRows(),e=(this.getVisibleColumns(),[]),i=0,n=t.length;i<n;i++){var s=t[i],o={rowCls:"",rowStyle:""},l=this.itemRenderer(s,i,o,this);e[e.length]='<div class="mini-grid-row ',e[e.length]=o.rowCls,e[e.length]='" style="',e[e.length]=o.rowStyle,e[e.length]='" id="',e[e.length]=this._createRowId(s,1),e[e.length]='">',e[e.length]=l,e[e.length]="</div>"}this._rowsViewContentEl.innerHTML=e.join("")},itemRenderer:function(t,e,i,n){return""},_createRowHTML:function(t,e,i,n,s){var o=!s;s=s||[];var l="",r=this.isFixedRowHeight();r&&(l=this._getRowHeight(t));var a,h,d=this.defaultRowHeight-1,u=" ",c=" ";s[s.length]='<tr class="mini-grid-row ',"added"==t._state&&this.showNewRow&&(s[s.length]="mini-grid-newRow "),this.isShowRowDetail(t)&&(s[s.length]="mini-grid-expandRow "),this.allowAlternating&&e%2==1&&(s[s.length]=this._alternatingCls,s[s.length]=" ");var m=this._rowClsHash[t._id];m&&(s[s.length]=m.join(" "),s[s.length]=" "),this._dataSource.isSelected(t)&&(s[s.length]=this._rowSelectedCls,s[s.length]=" "),a=s.length,s[s.length]=u,s[s.length]='" style="',h=s.length,s[s.length]=c,s[s.length]='" id="',s[s.length]=this._createRowId(t,n),!(s[s.length]='">')!==this._userEmptyTd&&(s[s.length]='<td style="width:0;"></td>');for(var f=this._currentCell,p=0,g=i.length;p<g;p++){var _=i[p],v=this._createCellId(t,_),y=this._OnDrawCell(t,_,e,_._index);null!==y.cellHtml&&y.cellHtml!==undefined&&""!==y.cellHtml||(y.cellHtml="&nbsp;"),s[s.length]="<td ",y.rowSpan&&(s[s.length]='rowspan="'+y.rowSpan+'"'),y.colSpan&&(s[s.length]='colspan="'+y.colSpan+'"'),s[s.length]=' id="',s[s.length]=v,s[s.length]='" class="mini-grid-cell ',this.isCellValid(t,_)||(s[s.length]=" mini-grid-cell-error "),p==g-1&&(s[s.length]=" mini-grid-rightCell "),y.cellCls&&(s[s.length]=" "+y.cellCls+" "),f&&f[0]==t&&f[1]==_&&(s[s.length]=" ",s[s.length]=this._cellSelectedCls),s[s.length]='" style="',0==y.showHGridLines&&(s[s.length]="border-bottom:0;"),0==y.showVGridLines&&(s[s.length]="border-right:0;"),y.visible||(s[s.length]="display:none;"),_.align&&(s[s.length]="text-align:",s[s.length]=_.align,s[s.length]=";"),y.cellStyle&&(s[s.length]=y.cellStyle),s[s.length]='">',s[s.length]='<div class="mini-grid-cell-inner ',_.allowCellWrap||y.allowCellWrap||(s[s.length]=" mini-grid-cell-nowrap "),y.cellInnerCls&&(s[s.length]=y.cellInnerCls),!!_.field&&this._dataSource.isModified(t,_.field)&&this.showModified&&(s[s.length]=" mini-grid-cell-dirty"),s[s.length]='" style="',r&&(s[s.length]="height:",_.name&&this._treeColumn===_.name?s[s.length]=d:s[s.length]=l,s[s.length]="px;",s[s.length]="line-height:",_.name&&this._treeColumn===_.name?s[s.length]=d:s[s.length]=l,s[s.length]="px;"),y.cellInnerStyle&&(s[s.length]=y.cellInnerStyle),s[s.length]='">',s[s.length]=y.cellHtml,s[s.length]="</div>",s[s.length]="</td>",y.rowCls&&(u=y.rowCls),y.rowStyle&&(c=y.rowStyle)}if(this.isFrozen()&&1==n&&(s[s.length]='<td class="mini-grid-cell" style="width:0;',0==this.showHGridLines&&(s[s.length]="border-bottom:0;"),s[s.length]='"><div class="mini-grid-cell-inner" style="',r&&(s[s.length]="height:",s[s.length]=l,s[s.length]="px;"),s[s.length]='">0</div></td>'),s[a]=u,s[h]=c,s[s.length]="</tr>",o)return s.join("").replace(/(<script(.*)<\/script(\s*)>)/i,"")},_createRowsHTML:function(t,e,i,n){i=i||this.getVisibleRows();var s=['<table class="mini-grid-table mini-grid-rowstable" cellspacing="0" cellpadding="0" border="0">'];s.push(this._createTopRowHTML(t,!0,i));var o=this.uid+"$emptytext"+e;2==e&&(this._dataSource.loaded||this.alwaysShowEmptyText)&&(l=this.showEmptyText&&0==i.length?"":"display:none;",s.push('<tr id="'+o+'" style="'+l+'"><td style="width:0"></td><td class="mini-grid-emptyText" colspan="'+t.length+'">'+this.emptyText+"</td></tr>"));var l,r=0;0<i.length&&(l=i[0],r=this.getVisibleRows().indexOf(l));for(var a=0,h=i.length;a<h;a++){var d=i[a];this._createRowHTML(d,r+a,t,e,s)}return n&&s.push(n),s.push("</table>"),s.join("")},doUpdateRows:function(){var t=this.getVisibleRows(),e=(new Date,this.getVisibleColumns());t=this.isGrouping()?this._createGroupingHTML(e,2):this._createRowsHTML(e,2,t),this._rowsViewContentEl.innerHTML=t},_createFilterRowHTML:function(t,e){var i=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0" style="position:absolute;top:0;left:0;height:100%;">'];i.push(this._createTopRowHTML(t)),i[i.length]="<tr>",i[i.length]='<td style="width:0;"></td>';for(var n=0,s=t.length;n<s;n++){var o=t[n],o=this._createFilterCellId(o);i[i.length]='<td id="',i[i.length]=o,i[i.length]='" class="mini-grid-filterCell" style="',i[i.length]='">&nbsp;</td>'}return i[i.length]='</tr></table><div class="mini-grid-scrollHeaderCell"></div>',i.join("")},_doRenderFilters:function(){for(var t=this.getVisibleColumns(),e=0,i=t.length;e<i;e++){var n,s=t[e];!s.filter||(n=this.getFilterCellEl(s))&&(n.innerHTML="",s.filter.render(n))}},_doUpdateFilterRow:function(){this._filterViewEl.firstChild&&this._filterViewEl.removeChild(this._filterViewEl.firstChild);this.isFrozen();var t=this.getVisibleColumns(),t=this._createFilterRowHTML(t,2);this._filterViewEl.innerHTML=t,this._doRenderFilters()},_createSummaryRowHTML:function(t,e){var i=this.getDataView(),n=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];n.push(this._createTopRowHTML(t));for(var s=0,o=this.summaryRows;s<o;s++){n[n.length]="<tr>",n[n.length]='<td style="width:0;"></td>';for(var l=0,r=t.length;l<r;l++){var a=t[l],h=this._createSummaryCellId(a,s),a=this._OnDrawSummaryCell(i,a,null,s);n[n.length]='<td id="',n[n.length]=h,n[n.length]='" class="mini-grid-summaryCell '+a.cellCls+'" style="'+a.cellStyle+";",n[n.length]='">',n[n.length]=a.cellHtml,n[n.length]="</td>"}n[n.length]="</tr>"}return n[n.length]='</table><div class="mini-grid-scrollHeaderCell"></div>',n.join("")},_doUpdateSummaryRow:function(){var t;this.showSummaryRow&&(t=this.getVisibleColumns(),t=this._createSummaryRowHTML(t,2),this._summaryViewEl.innerHTML=t)},_doSortByField:function(t,e){if(!t)return null;var i=this._columnModel._getDataTypeByField(t);this._dataSource._doClientSortField(t,e,i)},_expandGroupOnLoad:!0,_GroupID:1,_groupField:"",_groupDir:"",groupBy:function(t,e){t&&(this._groupField=t,"string"==typeof e&&(e=e.toLowerCase()),this._groupDir=e,this._createGroupingView(),this.deferUpdate())},clearGroup:function(){this._groupField="",this._groupDir="",this._groupDataView=null,this.deferUpdate()},setGroupField:function(t){this.groupBy(t)},getGroupField:function(){return this._groupField},getGroupDir:function(){return this._groupDir},setGroupDir:function(t){this._groupDir=field,this.groupBy(this._groupField,t)},isGrouping:function(){return""!=this._groupField},getGroupingView:function(){return this._groupDataView},enableGroupOrder:!0,_createGroupingView:function(){if(0!=this.isGrouping()){this._groupDataView=null;var t=this._dataSource,e=this._groupField,i=this._groupDir;(this.enableGroupOrder||i)&&this._doSortByField(e,i);for(var n=this.getVisibleRows(),s=[],o={},l=0,r=n.length;l<r;l++){var a=n[l],h=a[e],d=mini.isDate(h)?h.getTime():h;(g=o[d])||((g=o[d]={}).field=e,g.dir=i,g.value=h,g.rows=[],s.push(g),g.id="g"+this._GroupID++,g.expanded=this._expandGroupOnLoad),g.rows.push(a)}var u=t.sortField,c=t.sortOrder;if(u){var m=this._columnModel._getDataTypeByField(u),f=t._getSortFnByField(u,m);if(f)for(var p="desc"==c,l=0,r=s.length;l<r;l++){var g=s[l];mini.sort(g.rows,f),p&&g.rows.reverse()}}this._groupDataView=s}},_OnDrawGroup:function(t){t={group:t,rows:t.rows,field:t.field,dir:t.dir,value:t.value,cls:"",style:"",cellHtml:t.field+" ("+t.rows.length+" Items)"};return this.fire("drawgroup",t),t},getRowGroup:function(t){var e=typeof t;return"number"==e?this.getGroupingView()[t]:"string"==e?this._getRowGroupById(t):t},_getRowGroupByEvent:function(t){t=mini.findParent(t.target,"mini-grid-groupRow");if(t){t=t.id.split("$");if(t[0]!=this._id)return null;t=t[t.length-1];return this._getRowGroupById(t)}return null},_getRowGroupById:function(t){for(var e=this.getGroupingView(),i=0,n=e.length;i<n;i++){var s=e[i];if(s.id==t)return s}return null},_createRowGroupId:function(t,e){return this._id+"$group"+e+"$"+t.id},_createRowGroupRowsId:function(t,e){return this._id+"$grouprows"+e+"$"+t.id},_createRowId:function(t,e){return this._id+"$row"+e+"$"+t._id},_createHeaderCellId:function(t,e){return this._id+"$headerCell"+e+"$"+t._id},_createCellId:function(t,e){return t._id+"$cell$"+e._id},_createFilterCellId:function(t){return this._id+"$filter$"+t._id},_createSummaryCellId:function(t,e){return this._id+"$summary$"+t._id+"_"+e},getFilterCellEl:function(t){return(t=this.getColumn(t))?document.getElementById(this._createFilterCellId(t)):null},getSummaryCellEl:function(t,e){return e=e||0,(t=this.getColumn(t))?document.getElementById(this._createSummaryCellId(t,e)):null},_doVisibleEls:function(){mini.GridView.superclass._doVisibleEls.call(this),this._columnsEl.style.display=this.showColumns?"block":"none",this._filterEl.style.display=this.showFilterRow?"block":"none",this._summaryEl.style.display=this.showSummaryRow?"block":"none",this._bottomPagerEl.style.display=this.showPager?"block":"none"},setShowColumns:function(t){this.showColumns=t,this._doVisibleEls(),this.deferLayout()},setShowFilterRow:function(t){this.showFilterRow=t,this._doVisibleEls(),this.deferLayout()},setShowSummaryRow:function(t){this.showSummaryRow=t,this._doVisibleEls(),this.deferLayout()},setShowPager:function(t){this.showPager=t,this._doVisibleEls(),this.deferLayout()},setFitColumns:function(t){this.fitColumns=t,mini.removeClass(this.el,"mini-grid-fixwidth"),0==this.fitColumns&&mini.addClass(this.el,"mini-grid-fixwidth"),this.deferLayout()},getBodyHeight:function(t){return mini.GridView.superclass.getBodyHeight.call(this,t)-this.getColumnsHeight()-this.getFilterHeight()-this.getSummaryHeight()-this.getPagerHeight()},getColumnsHeight:function(){return this.showColumns?mini.getHeight(this._columnsEl):0},getFilterHeight:function(){return this.showFilterRow?mini.getHeight(this._filterViewEl.firstChild):0},getSummaryHeight:function(){return this.showSummaryRow?mini.getHeight(this._summaryEl):0},getPagerHeight:function(){return this.showPager?mini.getHeight(this._bottomPagerEl):0},getGridViewBox:function(t){var e=mini.getBox(this._columnsEl),i=mini.getBox(this._bodyEl);return e.height=i.bottom-e.top,e.bottom=e.top+e.height,e},getSortField:function(t){return this._dataSource.sortField},getSortOrder:function(t){return this._dataSource.sortOrder},_createSource:function(){this._dataSource=new mini.DataTable},_bindSource:function(){var t=this._dataSource;t.on("loaddata",this.__OnSourceLoadData,this),t.on("cleardata",this.__OnSourceClearData,this)},__OnSourceLoadData:function(t){this._initData();var e=this.getSortField(),i=this.getSortOrder();"client"==this.sortMode&&e&&i&&this.sortBy(e,i),this.doUpdate()},__OnSourceClearData:function(t){this._initData(),this.doUpdate()},_initData:function(){},isFrozen:function(){this._columnModel._frozenStartColumn,this._columnModel._frozenEndColumn;return this._columnModel.isFrozen()},_createColumnModel:function(){this._columnModel=new mini.ColumnModel(this)},_bindColumnModel:function(){this._columnModel.on("columnschanged",this.__OnColumnsChanged,this)},__OnColumnsChanged:function(t){this.columns=this._columnModel.columns,this._doUpdateFilterRow(),this._doUpdateSummaryRow(),this.doUpdate(),this.fire("columnschanged")},setColumns:function(t){this._columnModel.setColumns(t),this.columns=this._columnModel.columns},getColumns:function(){return this._columnModel.getColumns()},getBottomColumns:function(){return this._columnModel.getBottomColumns()},getVisibleColumnsRow:function(){return this._columnModel.getVisibleColumnsRow().clone()},getVisibleColumns:function(){return this._columnModel.getVisibleColumns().clone()},getFrozenColumns:function(){return this._columnModel.getFrozenColumns().clone()},getUnFrozenColumns:function(){return this._columnModel.getUnFrozenColumns().clone()},getColumn:function(t){return this._columnModel.getColumn(t)},updateColumn:function(t,e){this._columnModel.updateColumn(t,e)},hideColumns:function(t){for(var e=0,i=t.length;e<i;e++){var n=this.getColumn(t[e]);n&&(n.visible=!1)}this._columnModel._columnsChanged()},showColumn:function(t){this.updateColumn(t,{visible:!0})},hideColumn:function(t){this.updateColumn(t,{visible:!1})},moveColumn:function(t,e,i){this._columnModel.moveColumn(t,e,i)},removeColumn:function(t){if(t=this.getColumn(t)){var e=this.getParentColumn(t);return t&&e&&(e.columns.remove(t),this._columnModel._columnsChanged()),t}},setDefaultColumnWidth:function(t){this._columnModel._defaultColumnWidth=t},getDefaultColumnWidth:function(){return this._columnModel._defaultColumnWidth},setColumnWidth:function(t,e){this.updateColumn(t,{width:e})},getColumnWidth:function(t){return this.getColumnBox(t).width},getParentColumn:function(t){return this._columnModel.getParentColumn(t)},getMaxColumnLevel:function(){return this._columnModel._getMaxColumnLevel()},_isCellVisible:function(t,e){return!0},_createDrawCellEvent:function(t,e,i,n){var s=mini._getMap(e.field,t),e={sender:this,rowIndex:i,columnIndex:n,record:t,row:t,column:e,field:e.field,value:s,cellHtml:s,rowCls:"",rowStyle:null,cellCls:e.cellCls||"",cellStyle:e.cellStyle||"",allowCellWrap:this.allowCellWrap,showHGridLines:this.showHGridLines,showVGridLines:this.showVGridLines,cellInnerCls:"",cellInnnerStyle:"",autoEscape:e.autoEscape};return e.visible=this._isCellVisible(i,n),1!=e.visible||!this._mergedCellMaps||(n=this._mergedCellMaps[i+":"+n])&&(e.rowSpan=n.rowSpan,e.colSpan=n.colSpan),e},defaultColumnDateFormat:"yyyy-MM-dd",_OnDrawCell:function(t,e,i,n){var s=this._createDrawCellEvent(t,e,i,n),i=s.value,n=e.dateFormat||("date"==e.dataType?this.defaultColumnDateFormat:"");n&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(i,n):s.cellHtml=i),"float"==e.dataType&&(i=parseFloat(s.value),isNaN(i)||(decimalPlaces=parseInt(e.decimalPlaces),isNaN(decimalPlaces)&&(decimalPlaces=2),s.cellHtml=i.toFixed(decimalPlaces))),"currency"==e.dataType&&(s.cellHtml=mini.formatCurrency(s.value,e.currencyUnit)),e.displayField&&(s.cellHtml=mini._getMap(e.displayField,t)),e.numberFormat&&(o=parseFloat(s.cellHtml),isNaN(o)||(s.cellHtml=mini.formatNumber(o,e.numberFormat))),1==s.autoEscape&&(s.cellHtml=mini.htmlEncode(s.cellHtml));var o=e.renderer;return!o||(o="function"==typeof o?o:mini._getFunctoin(o))&&(s.cellHtml=o.call(e,s)),s.cellHtml=0===s.cellHtml||!1===s.cellHtml||s.cellHtml?String(s.cellHtml).trim():"",this.fire("drawcell",s),s.cellHtml&&s.cellHtml.unshift&&0==s.cellHtml.length&&(s.cellHtml="&nbsp;"),null!==s.cellHtml&&s.cellHtml!==undefined&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s},_OnDrawSummaryCell:function(t,e,i,n){var s,i={row:n,group:i,result:this.getResultObject(),sender:this,data:t,column:e,field:e.field,value:"",cellHtml:"",cellCls:e.cellCls||"",cellStyle:e.cellStyle||"",allowCellWrap:this.allowCellWrap};!e.summaryType||(s=mini.summaryTypes[e.summaryType])&&(i.value=s(t,e.field));t=i.value;i.cellHtml=i.value,i.value&&parseInt(i.value)!=i.value&&i.value.toFixed&&(decimalPlaces=parseInt(e.decimalPlaces),isNaN(decimalPlaces)&&(decimalPlaces=2),i.cellHtml=parseFloat(i.value.toFixed(decimalPlaces))),e.dateFormat&&(mini.isDate(i.value)?i.cellHtml=mini.formatDate(t,e.dateFormat):i.cellHtml=t),i.cellHtml&&"currency"==e.dataType&&(i.cellHtml=mini.formatCurrency(i.cellHtml,e.currencyUnit));t=e.summaryRenderer;return t&&(s="function"==typeof t?t:window[t])&&(i.cellHtml=s.call(e,i)),e.summaryValue=i.value,this.fire("drawsummarycell",i),null!==i.cellHtml&&i.cellHtml!==undefined&&""!==i.cellHtml||(i.cellHtml="&nbsp;"),i},getScrollTop:function(){return this._rowsViewEl.scrollTop},setScrollTop:function(t){this._rowsViewEl.scrollTop=t},getScrollLeft:function(){return this._rowsViewEl.scrollLeft},setScrollLeft:function(t){this._rowsViewEl.scrollLeft=t},_syncScroll:function(){var t=this._rowsViewEl.scrollLeft;this._filterViewEl.firstChild.style.left=-t+"px",this._summaryViewEl.scrollLeft=t,this._columnsViewEl.scrollLeft=t},__OnRowViewScroll:function(t){this._syncScroll()},pagerType:"pager",getPagerType:function(){return this.pagerType},setPagerType:function(t){this.pagerType=t;t=mini.create({type:this.pagerType});t&&this._setBottomPager(t)},_pagers:[],_createPagers:function(){this._pagers=[];var t=new mini.Pager;this._setBottomPager(t)},_setBottomPager:function(t){(t=mini.create(t))&&(this._bottomPager&&(this.unbindPager(this._bottomPager),this._bottomPagerEl.removeChild(this._bottomPager.el)),(this._bottomPager=t).render(this._bottomPagerEl),this.bindPager(t))},bindPager:function(t){this._pagers.add(t)},unbindPager:function(t){this._pagers.remove(t)},alwaysShowEmptyText:!1,setAlwaysShowEmptyText:function(t){this.alwaysShowEmptyText=t},getAlwaysShowEmptyText:function(){return this.alwaysShowEmptyText},setShowEmptyText:function(t){this.showEmptyText=t,0==this.data.length&&this.deferUpdate()},getShowEmptyText:function(){return this.showEmptyText},setEmptyText:function(t){this.emptyText=t},getEmptyText:function(){return this.emptyText},setShowModified:function(t){this.showModified=t},getShowModified:function(){return this.showModified},setShowNewRow:function(t){this.showNewRow=t},getShowNewRow:function(){return this.showNewRow},setAllowCellWrap:function(t){this.allowCellWrap=t},getAllowCellWrap:function(){return this.allowCellWrap},setAllowHeaderWrap:function(t){this.allowHeaderWrap=t},getAllowHeaderWrap:function(){return this.allowHeaderWrap},setEnableGroupOrder:function(t){this.enableGroupOrder=t},getEnableGroupOrder:function(){return this.enableGroupOrder},setShowHGridLines:function(t){this.showHGridLines!=t&&(this.showHGridLines=t,this.deferUpdate())},getShowHGridLines:function(){return this.showHGridLines},setShowVGridLines:function(t){this.showVGridLines!=t&&(this.showVGridLines=t,this.deferUpdate())},getShowVGridLines:function(){return this.showVGridLines},setShowSortIcon:function(t){this.showSortIcon!=t&&(this.showSortIcon=t,this.deferUpdate())},getShowSortIcon:function(){return this.showSortIcon}}),mini.copyTo(mini.GridView.prototype,mini._DataTableApplys),mini.regClass(mini.GridView,"gridview"),mini.FrozenGridView=function(){mini.FrozenGridView.superclass.constructor.apply(this,arguments)},mini.extend(mini.FrozenGridView,mini.GridView,{isFixedRowHeight:function(){return this.fixedRowHeight},frozenPosition:"left",isRightFrozen:function(){return"right"==this.frozenPosition},_create:function(){mini.FrozenGridView.superclass._create.call(this);this.el;this._columnsLockEl=mini.before(this._columnsViewEl,'<div class="mini-grid-columns-lock"></div>'),this._rowsLockEl=mini.before(this._rowsViewEl,'<div class="mini-grid-rows-lock"><div class="mini-grid-rows-content"></div></div>'),this._rowsLockContentEl=this._rowsLockEl.firstChild;this._filterLockEl=mini.before(this._filterViewEl,'<div class="mini-grid-filterRow-lock" style="height:100%;"></div>');this._summaryLockEl=mini.before(this._summaryViewEl,'<div class="mini-grid-summaryRow-lock"></div>')},_initEvents:function(){mini.FrozenGridView.superclass._initEvents.call(this),mini.on(this._rowsEl,"mousewheel",this.__OnMouseWheel,this)},_createHeaderText:function(t,e){var i=t.header;return"function"==typeof i&&(i=i.call(this,t)),!mini.isNull(i)&&""!==i||(i="&nbsp;"),i=this.isFrozen()&&2==e&&t.viewIndex1?"&nbsp;":i},_createColumnColSpan:function(t,e,i){this.isFrozen()?(i=t["colspan"+i])&&(e[e.length]='colspan="'+i+'" '):t.colspan&&(e[e.length]='colspan="'+t.colspan+'" ')},doUpdateColumns:function(){var t=this._columnsViewEl.scrollLeft,e=this.isFrozen()?this.getFrozenColumnsRow():[],i=this.isFrozen()?this.getUnFrozenColumnsRow():this.getVisibleColumnsRow(),n=this.isFrozen()?this.getFrozenColumns():[],s=this.isFrozen()?this.getUnFrozenColumns():this.getVisibleColumns(),n=this._createColumnsHTML(e,1,n),i=this._createColumnsHTML(i,2,s),s='<div class="mini-grid-topRightCell"></div>';i+=s,this._columnsLockEl.innerHTML=n+=s,this._columnsViewEl.innerHTML=i,this._columnsLockEl.firstChild.style.width="0px",this._columnsViewEl.scrollLeft=t},doUpdateRows:function(){var t,e=this.getVisibleRows(),i=this.getFrozenColumns(),n=this.getUnFrozenColumns();e=this.isGrouping()?(t=this._createGroupingHTML(i,1),this._createGroupingHTML(n,2)):(t=this._createRowsHTML(i,1,this.isFrozen()?e:[]),this._createRowsHTML(n,2,e)),this._rowsLockContentEl.innerHTML=t,this._rowsViewContentEl.innerHTML=e,this._rowsLockContentEl.firstChild.style.width="0px"},_doUpdateFilterRow:function(){this._filterLockEl.firstChild&&this._filterLockEl.removeChild(this._filterLockEl.firstChild),this._filterViewEl.firstChild&&this._filterViewEl.removeChild(this._filterViewEl.firstChild);var t=this.getFrozenColumns(),e=this.getUnFrozenColumns(),t=this._createFilterRowHTML(t,1),e=this._createFilterRowHTML(e,2);this._filterLockEl.innerHTML=t,this._filterViewEl.innerHTML=e,this._doRenderFilters()},_doUpdateSummaryRow:function(){var t=this.getFrozenColumns(),e=this.getUnFrozenColumns(),t=this._createSummaryRowHTML(t,1),e=this._createSummaryRowHTML(e,2);this._summaryLockEl.innerHTML=t,this._summaryViewEl.innerHTML=e},_syncRowsHeightTimer:null,syncRowDetail:function(t){var e=this._getRowDetailEl(t,1),t=this._getRowDetailEl(t,2);e&&t&&this._doSyncRowHeight(e,t)},_doSyncRowHeight:function(t,e){t.style.height=e.style.height="auto";var i=t.cells[0],n=e.cells[0],i=i.offsetHeight,n=n.offsetHeight;t.style.height=e.style.height=(i=i<n?n:i)+"px"},_syncRowsHeight:function(){var m=this;this.isFrozen()&&0==this.isFixedRowHeight()&&(this._syncRowsHeightTimer&&clearTimeout(this._syncRowsHeightTimer),this._syncRowsHeightTimer=setTimeout(function(){new Date,document;for(var t=m.getDataView(),e={},i=0,n=t.length;i<n;i++){var s=t[i],o=m._getRowEl(s,1),l=m._getRowEl(s,2);o&&l&&(o.style.height=l.style.height="auto",e[i]={row1:o,row2:l})}for(var r,a,i=0,n=t.length;i<n;i++){s=t[i];(c=e[i])&&(c.height=(r=c.row1,a=c.row2,r=r.cells[0],a=a.cells[0],r=r.offsetHeight,a=a.offsetHeight,r=r<a?a:r))}for(var h,d,u,i=0,n=t.length;i<n;i++){var c,s=t[i];(c=e[i])&&(h=c.row1,d=c.row2,u=c.height,h.style.height=d.style.height=u+"px")}m._syncRowsHeightTimer=null},2))},_syncColumnHeight:function(){var t=this._columnsLockEl,e=this._columnsViewEl;t.style.height=e.style.height="auto",this.isFrozen()&&(i=t.offsetHeight,n=e.offsetHeight,t.style.height=e.style.height=(i=n<i?i:n)+"px");var i,n,t=this._summaryLockEl,e=this._summaryViewEl;t.style.height=e.style.height="auto",this.isFrozen()&&(i=t.offsetHeight,n=e.offsetHeight,t.style.height=e.style.height=(i=n<i?i:n)+"px")},_layoutColumns:function(){function t(t){return t.offsetHeight}function r(t){for(var e=[],i=0,n=t.cells.length;i<n;i++){var s=t.cells[i];"0px"!=s.style.width&&e.push(s)}return e}function s(t){for(var e=r(t),i=0,n=e.length;i<n;i++)e[i].style.height="auto"}function a(t,e){for(var i=0,n=r(t),s=0,o=n.length;s<o;s++){var l=n[s];1<parseInt(l.rowSpan)&&e||i<(l=l.offsetHeight)&&(i=l)}return i}if(this.isFrozen()){var o=this._columnsLockEl.firstChild,l=this._columnsViewEl.firstChild;!function(){o.style.height=o.style.height="auto";for(var t=0,e=o.rows.length;t<e;t++){var i=o.rows[t],n=l.rows[t];s(i),s(n)}}();for(var e=0,i=o.rows.length;e<i;e++){var n,h,d=o.rows[e],u=l.rows[e];(n=a(d))==(h=a(u))||(n<h?(c(d,u),m(d,u)):h<n&&(c(u,d),m(u,d)))}(n=t(o))<(h=t(l))?mini.setHeight(o,h):h<n&&mini.setHeight(l,n)}function c(t,e){for(var i=a(e,!0),n=r(t),s=0,o=n.length;s<o;s++){var l=n[s];1<parseInt(l.rowSpan)||mini.setHeight(l,i)}}function m(t,e){for(var i=a(e),n=r(t),s=0,o=n.length;s<o;s++){var l=n[s];1<parseInt(l.rowSpan)&&mini.setHeight(l,i)}}},doLayout:function(){var t,e,i,n,s;0!=this.canLayout()&&(this._doLayoutScroll=!1,t=this.isFrozen(),i=this.getViewportWidth(!0)-(e=this.getLockedWidth()),this._doEmptyText(),n=this.isRightFrozen()?"marginRight":"marginLeft",s=this.isRightFrozen()?"right":"left",t?(this._filterViewEl.style[n]=e+"px",this._summaryViewEl.style[n]=e+"px",this._columnsViewEl.style[n]=e+"px",this._rowsViewEl.style[n]=e+"px",mini.isSafari||mini.isChrome||mini.isIE6?(this._filterViewEl.style.width=i+"px",this._summaryViewEl.style.width=i+"px",this._columnsViewEl.style.width=i+"px"):(this._filterViewEl.style.width="auto",this._summaryViewEl.style.width="auto",this._columnsViewEl.style.width="auto"),(mini.isSafari||mini.isChrome||mini.isIE6)&&(this._rowsViewEl.style.width=i+"px"),mini.setWidth(this._filterLockEl,e),mini.setWidth(this._summaryLockEl,e),mini.setWidth(this._columnsLockEl,e),mini.setWidth(this._rowsLockEl,e),this._filterLockEl.style[s]="0px",this._summaryLockEl.style[s]="0px",this._columnsLockEl.style[s]="0px",this._rowsLockEl.style[s]="0px"):this._doClearFrozen(),this._layoutColumns(),this._syncColumnHeight(),mini.FrozenGridView.superclass.doLayout.call(this),s=this._autoHeight,t&&(mini.isChrome||mini.isIE6)&&(this._layoutColumns(),this._syncColumnHeight(),mini.FrozenGridView.superclass.doLayout.call(this)),this._rowsLockEl.style.height=s?"auto":"100%",this._syncRowsHeight())},_doEmptyText:function(){},_getRowEl:function(t,e){t=this.getRecord(t);e=this._createRowId(t,e);return document.getElementById(e)},_doClearFrozen:function(){this.isRightFrozen(),this.isRightFrozen();this._filterLockEl.style.left="-10px",this._summaryLockEl.style.left="-10px",this._columnsLockEl.style.left="-10px",this._rowsLockEl.style.left="-10px",this._filterLockEl.style.width="0px",this._summaryLockEl.style.width="0px",this._columnsLockEl.style.width="0px",this._rowsLockEl.style.width="0px",this._filterViewEl.style.marginLeft="0px",this._summaryViewEl.style.marginLeft="0px",this._columnsViewEl.style.marginLeft="0px",this._rowsViewEl.style.marginLeft="0px",this._filterViewEl.style.width="auto",this._summaryViewEl.style.width="auto",this._columnsViewEl.style.width="auto",this._rowsViewEl.style.width="auto",(mini.isSafari||mini.isChrome||mini.isIE6)&&(this._filterViewEl.style.width="100%",this._summaryViewEl.style.width="100%",this._columnsViewEl.style.width="100%",this._rowsViewEl.style.width="100%")},frozenColumns:function(t,e){this.frozen(t,e)},unFrozenColumns:function(){this.unFrozen()},frozen:function(t,e){this._doClearFrozen(),this._columnModel.frozen(t,e)},unFrozen:function(){this._doClearFrozen(),this._columnModel.unFrozen()},setFrozenStartColumn:function(t){this._columnModel.setFrozenStartColumn(t)},setFrozenEndColumn:function(t){return this._columnModel.setFrozenEndColumn(t)},getFrozenStartColumn:function(t){return this._columnModel._frozenStartColumn},getFrozenEndColumn:function(t){return this._columnModel._frozenEndColumn},getFrozenColumnsRow:function(){return this._columnModel.getFrozenColumnsRow()},getUnFrozenColumnsRow:function(){return this._columnModel.getUnFrozenColumnsRow()},getLockedWidth:function(){if(!this.isFrozen())return 0;var t=this._rowsLockContentEl.firstChild.firstChild;return t?t.offsetWidth:0},_canDeferSyncScroll:function(){return this.isFrozen()},_syncScroll:function(){var t=this._rowsViewEl.scrollLeft;this._filterViewEl.firstChild.style.left=-t+"px",this._summaryViewEl.scrollLeft=t,this._columnsViewEl.scrollLeft=t;t=this._rowsViewEl.scrollTop;this._rowsLockEl.scrollTop=t},__OnMouseWheel:function(t){var e=this.getScrollTop()-t.wheelDelta,i=this.getScrollTop();this.setScrollTop(e),i!=this.getScrollTop()&&t.preventDefault()}}),mini.regClass(mini.FrozenGridView,"FrozenGridView"),mini.ScrollGridView=function(){mini.ScrollGridView.superclass.constructor.apply(this,arguments)},mini.extend(mini.ScrollGridView,mini.FrozenGridView,{virtualScroll:!0,virtualRows:25,defaultRowHeight:25,virtualColumns:!1,_canDeferSyncScroll:function(){return this.isFrozen()&&!this.isVirtualScroll()},setVirtualScroll:function(t){this.virtualScroll=t,this.doUpdate()},getVirtualScroll:function(t){return this.virtualScroll},isFitColumns:function(){return this.fitColumns&&!this.virtualColumns},setVirtualColumns:function(t){this.virtualColumns=t,this.doUpdate()},getVirtualColumns:function(t){return this.virtualColumns},isFixedRowHeight:function(){return this.fixedRowHeight||this.virtualScroll},isVirtualScroll:function(){return!!this.virtualScroll&&(0==this.isAutoHeight()&&0==this.isGrouping())},_getScrollView:function(){return this.getVisibleRows()},_getScrollViewCount:function(){return this._getScrollView().length},_getScrollRowHeight:function(t,e){if(e&&e._height){e=parseInt(e._height);if(!isNaN(e))return e}return this.defaultRowHeight},_getRangeHeight:function(t,e){return(e-t)*this.defaultRowHeight},_getIndexByScrollTop:function(t){return parseInt(t/this.defaultRowHeight)},__getScrollViewRange:function(t,e){return this._getScrollView().getRange(t,e)},_getColumnByScrollLeft:function(t){for(var e=0,i=this.getUnFrozenColumns(),n=i.length,s=0,o=n;s<o;s++){var l=i[s].pxWidth;if(isNaN(l)||(e+=l),t<=e)return s}return n},_getRangeWidth:function(t,e){for(var i=0,n=this.getUnFrozenColumns(),s=t;s<e;s++){var o=n[s];o&&(o=o.pxWidth,isNaN(o)||(i+=o))}return i},_getColumnAllWidth:function(){for(var t=0,e=this.getUnFrozenColumns(),i=0,n=e.length;i<n;i++){var s=e[i].pxWidth;isNaN(s)||(t+=s)}return t},_getViewRegion:function(){var t=this._getScrollView();if(0==this.isVirtualScroll())return e={top:0,bottom:0,rows:t,start:0,end:0};this.defaultRowHeight;for(var e,i=this._getViewNowRegion(),n=(this.getScrollTop(),this._vscrollEl.offsetHeight,this._getScrollViewCount()),s=i.start,o=i.end,l=0,r=n;l<r;l+=this.virtualRows){var a=l+this.virtualRows;l<=s&&s<a&&(s=l),l<o&&o<=a&&(o=a)}return 0==(o=n<o?n:o)&&(o=this.virtualRows),(e={top:this._getRangeHeight(0,s),bottom:this._getRangeHeight(o,this._getScrollViewCount()),rows:t=this.__getScrollViewRange(s,o),start:s,end:o,viewStart:s,viewEnd:o}).viewTop=this._getRangeHeight(0,e.viewStart),e.viewBottom=this._getRangeHeight(e.viewEnd,this._getScrollViewCount()),this.virtualColumns?(n=this.getScrollLeft(),t=this._rowsViewEl.offsetWidth,e.startColumn=this._getColumnByScrollLeft(n),e.endColumn=this._getColumnByScrollLeft(n+t),e.columns=this.getUnFrozenColumns().slice(e.startColumn,e.endColumn+1),e.right=this._getColumnAllWidth(),e.viewLeft=this._getRangeWidth(0,e.startColumn)):e.columns=this.getUnFrozenColumns(),e},_getViewNowRegion:function(){this.defaultRowHeight;var t=this.getScrollTop(),e=this._rowsViewEl.offsetHeight,i=this._getIndexByScrollTop(t),t=this._getIndexByScrollTop(t+e+30),e=this._getScrollViewCount();return{start:i,end:t=e<t?e:t}},_canVirtualUpdate:function(){if(!this._viewRegion)return!0;var t=this._getViewNowRegion();return!(this._viewRegion.start<=t.start&&t.end<=this._viewRegion.end)},__OnColumnsChanged:function(t){this.columns=this._columnModel.columns,this._doUpdateFilterRow(),this._doUpdateSummaryRow(),0==this.getVisibleRows().length?this.doUpdate():this.deferUpdate(),this.isVirtualScroll()&&this.__OnVScroll(),this.fire("columnschanged")},doLayout:function(){0!=this.canLayout()&&(mini.ScrollGridView.superclass.doLayout.call(this),this._layoutScroll(),mini.isNumber(this._scrollTop)&&this._vscrollEl.scrollTop!=this._scrollTop&&(this._vscrollEl.scrollTop=this._scrollTop))},_createRowsHTML:function(t,e,i,n,s,o){var l=this.isVirtualScroll();if(!l)return mini.ScrollGridView.superclass._createRowsHTML.apply(this,arguments);l&&this._viewRegion;var r=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0" >'];r.push(this._createTopRowHTML(t)),this.isVirtualScroll()&&r.push('<tr class="mini-grid-virtualscroll-top" style="padding:0;border:0;'+(l=0==n?"display:none;":"")+'"><td colspan="'+t.length+'" style="height:'+n+"px;padding:0;border:0;"+l+'"></td></tr>');new Date;if(1!=e||0!=this.isFrozen())for(var a=0,h=i.length;a<h;a++){var d=i[a];this._createRowHTML(d,o,t,e,r),o++}return this.isVirtualScroll()&&r.push('<tr class="mini-grid-virtualscroll-bottom" style="padding:0;border:0;"><td colspan="'+t.length+'" style="height:'+s+'px;padding:0;border:0;"></td></tr>'),r.push("</table>"),r.join("")},doUpdateRows:function(){var t,e,i,n;0!=this.isVirtualScroll()?(n=this._getViewRegion(),this._viewRegion=n,e=this.getFrozenColumns(),t=n.columns,i=n.viewStart,n.start,n.viewEnd,this._scrollPaging&&(i-=this.getPageIndex()*this.getPageSize()),e=this._createRowsHTML(e,1,n.rows,n.viewTop,n.viewBottom,i),i=this._createRowsHTML(t,2,n.rows,n.viewTop,n.viewBottom,i),this._rowsLockContentEl.innerHTML=e,this._rowsViewContentEl.innerHTML=i,e=this._rowsViewContentEl.firstChild,this.virtualColumns&&(i='<div style="position:absolute;top:0px;left:'+n.right+'px;width:1px;height:1px;overflow:hidden;"></div>',jQuery(i).appendTo(this._rowsViewContentEl),e.style.width="0px",e.style.position="absolute",e.style.top="0px",e.style.left=n.viewLeft+"px"),n=this.getScrollTop(),this._rowsViewEl.scrollTop!=n&&this._syncScrollOffset(null,n)):mini.ScrollGridView.superclass.doUpdateRows.call(this)},_create:function(){mini.ScrollGridView.superclass._create.call(this),this._vscrollEl=mini.append(this._rowsEl,'<div class="mini-grid-vscroll"><div class="mini-grid-vscroll-content"></div></div>'),this._vscrollContentEl=this._vscrollEl.firstChild},_initEvents:function(){mini.ScrollGridView.superclass._initEvents.call(this);var e=this;mini.on(this._vscrollEl,"scroll",this.__OnVScroll,this),mini._onScrollDownUp(this._vscrollEl,function(t){e._VScrollMouseDown=!0},function(t){e._VScrollMouseDown=!1})},_layoutScroll:function(){var t,e,i=this.isVirtualScroll();i?(t=(e=this.getScrollHeight())>this._rowsViewEl.offsetHeight,i&&t?(this._vscrollEl.style.display="block",this._vscrollContentEl.style.height=e+"px"):this._vscrollEl.style.display="none",this._rowsViewEl.scrollWidth>this._rowsViewEl.clientWidth+1?(e=this.getBodyHeight(!0)-18,this._vscrollEl.style.height=(e=e<0?0:e)+"px"):this._vscrollEl.style.height="100%"):this._vscrollEl.style.display="none"},getScrollHeight:function(){var t=this.getVisibleRows();return this._getRangeHeight(0,t.length)},setScrollTop:function(t){this.isVirtualScroll()?this._vscrollEl.scrollTop=t:this._rowsViewEl.scrollTop=t},getScrollTop:function(){return(this.isVirtualScroll()?this._vscrollEl:this._rowsViewEl).scrollTop},__OnVScroll:function(t){var e;this.isVirtualScroll()&&(this._scrollTop=this._vscrollEl.scrollTop,e=this,setTimeout(function(){e._syncScrollOffset(null,e._scrollTop),e.__scrollTimer=null},8),this._scrollTopTimer&&clearTimeout(this._scrollTopTimer),this._scrollTopTimer=setTimeout(function(){e._scrollTopTimer=null,e._tryUpdateScroll(),e._syncScrollOffset(null,e._scrollTop)},150))},wheelIncrement:0,setWheelIncrement:function(t){this.wheelIncrement=t},getWheelIncrement:function(){return this.wheelIncrement},__OnMouseWheel:function(t){var e=t.wheelDelta?t:t.originalEvent,i=e.wheelDelta||40*-e.detail;0<i?i+=this.wheelIncrement:i-=this.wheelIncrement;e=this.getScrollTop()-i,i=this.getScrollTop();this.setScrollTop(e),i==this.getScrollTop()&&!this.isVirtualScroll()||t.preventDefault()},_tryUpdateScroll:function(){var t;this._canVirtualUpdate()&&(this._scrollPaging?this.reload(null,null,function(t){}):(new Date,t=this._rowsViewEl.scrollLeft,this._doRemoveRowContent(),this.doUpdateRows(),this.deferLayout(50),this._syncScrollOffset(t)))},_updateScrollTop:function(t){this._syncScrollOffset(null,t),this._tryUpdateScroll()},__OnRowViewScroll:function(t){this._syncScroll(),this.virtualColumns&&this.doVirtualColumns()},doVirtualColumns:function(){var t=this;t._virtualColumnTimer&&(clearTimeout(t._virtualColumnTimer),t._virtualColumnTimer=null),t._virtualColumnTimer=setTimeout(function(){t._virtualColumnTimer=null,t._doRemoveRowContent(),t.doUpdateRows(),t.deferLayout(50)},500)}}),mini.regClass(mini.ScrollGridView,"ScrollGridView"),mini._onScrollDownUp=function(t,e,i){function n(t){mini.un(document,"mousemove",n),i(t)}function s(t){mini.un(document,"mouseup",s),i(t)}mini.on(t,"mousedown",function(t){mini.isFirefox?mini.on(document,"mouseup",s):mini.on(document,"mousemove",n),e(t)})},mini.mousewheelEditable=!1,mini._Grid_Select=function(t){this.owner=t,el=t.el,t.on("rowmousemove",this.__OnRowMouseMove,this),mini.on(t._viewportEl,"mouseout",this.__OnMouseOut,this),mini.on(t._viewportEl,"mousewheel",this.__OnMouseWheel,this),mini.on(document,"mousewheel",this.__OnMouseWheel,this),t.on("cellmousedown",this.__OnCellMouseDown,this),t.on("cellmouseup",this.__OnGridCellClick,this),t.on("celldblclick",this.__OnGridCellClick,this),mini.on(t.el,"keydown",this.__OnGridKeyDown,this),jQuery(t._columnsEl).on("mouseenter",".mini-grid-headerCell",function(t){jQuery(t.currentTarget).addClass("mini-grid-header-over")}),jQuery(t._columnsEl).on("mouseleave",".mini-grid-headerCell",function(t){jQuery(t.currentTarget).removeClass("mini-grid-header-over")})},mini._Grid_Select.prototype={__OnGridKeyDown:function(t){var e=this.owner,i=mini.findParent(t.target,"mini-grid-detailRow"),i=!!i&&mini.isAncestor(e.el,i);if(!(mini.isAncestor(e._filterEl,t.target)||mini.isAncestor(e._summaryEl,t.target)||mini.isAncestor(e._toolbarEl,t.target)||mini.isAncestor(e._footerEl,t.target)||mini.findParent(t.target,"mini-grid-detailRow")&&i||mini.findParent(t.target,"mini-grid-rowEdit")||mini.findParent(t.target,"mini-tree-editinput"))){var n=e.getCurrentCell();if(!(t.shiftKey||t.ctrlKey||t.altKey)){37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode||t.preventDefault();var s=e.getVisibleColumns(),o=n?n[1]:null,l=n?n[0]:null;n||(l=e.getCurrent());var r,a,h=s.indexOf(o),d=(r=l,e.getVisibleRows().indexOf(r)),u=e.getVisibleRows().length;switch(t.keyCode){case 9:if(e.allowCellEdit&&e.editOnTabKey)return t.preventDefault(),void e._beginEditNextCell(0==t.shiftKey,!0);break;case 27:break;case 13:if(e.allowCellEdit&&e.editNextOnEnterKey&&o&&(e.isEditingCell(n)||!o.editor))return void e._beginEditNextCell(0==t.shiftKey);e.allowCellEdit&&n&&!o.readOnly&&!e.isReadOnly()&&e.beginEditCell();break;case 37:o?0<h&&--h:h=0;break;case 38:l?0<d&&--d:d=0,0!=d&&e.isVirtualScroll();break;case 39:o?h<s.length-1&&(h+=1):h=0;break;case 40:l?d<u-1&&(d+=1):d=0;break;default:return}o=s[h],a=d,l=e.getVisibleRows()[a],o&&l&&e.allowCellSelect&&(e.setCurrentCell(n=[l,o]),e.scrollIntoView(l,o,!1)),e.onlyCheckSelection||37!=t.keyCode&&39!=t.keyCode&&l&&e.allowRowSelect&&(i={record:l,selected:l,cancel:!1,htmlEvent:t},l&&(e.fire("beforerowselect",i),e.fire("beforeselect",i)),i.cancel||(e.deselectAll(),e.setCurrent(l),l&&e.scrollIntoView(l,null,!1)))}}},__OnMouseWheel:function(t){var e,i=this.owner;t.stopPropagation(),mini.mousewheelEditable||((e=i._editingControl)&&e.within(t)||i.allowCellEdit&&i.commitEdit())},__OnGridCellClick:function(t){var e=this.owner,i=t.type;new Date;"cellmouseup"==i&&(i="cellclick"),0!=e.allowCellEdit&&e.cellEditAction==i&&(t.record,t.column.readOnly||e.isReadOnly()||t.htmlEvent.shiftKey||t.htmlEvent.ctrlKey||e.beginEditCell())},__OnCellMouseDown:function(t){var e=this;!e.owner.selectOnRightClick&&3==t.htmlEvent.which||setTimeout(function(){e.__doSelect(t)},1)},__OnRowMouseMove:function(t){var e=this.owner,t=t.record;e.enabled&&0!=e.enableHotTrack&&e.focusRow(t)},__OnMouseOut:function(t){this.owner.allowHotTrackOut&&this.owner.focusRow(null)},__doSelect:function(t){var e=t.record,i=t.column,n=this.owner;if(!1!==e.enabled&&(n.allowCellSelect&&n.setCurrentCell([e,i]),(!n.onlyCheckSelection||i._multiRowSelect)&&n.allowRowSelect)){var s={record:e,selected:e,cancel:!1,htmlEvent:t};if(e&&(n.isSelected(e)||(n.fire("beforerowselect",s),n.fire("beforeselect",s))),!s.cancel)if(n.getMultiSelect())if(n.el.onselectstart=function(){},t.htmlEvent.shiftKey){n.el.onselectstart=function(){return!1};try{t.htmlEvent.preventDefault()}catch(s){}i=n.getCurrent();i?(n.deselectAll(),n.selectRange(i,e),n.setCurrent(i)):(n.select(e),n.setCurrent(e))}else{if(n.el.onselectstart=function(){},t.htmlEvent.ctrlKey){n.el.onselectstart=function(){return!1};try{t.htmlEvent.preventDefault()}catch(s){}}!0===t.column._multiRowSelect||t.htmlEvent.ctrlKey||n.allowUnselect?n.isSelected(e)?n.deselect(e):(n.select(e),n.setCurrent(e)):n.isSelected(e)||(n.deselectAll(),n.select(e),n.setCurrent(e))}else n.isSelected(e)?(t.htmlEvent.ctrlKey||n.allowUnselect)&&n.deselectAll():(n.deselectAll(),n.select(e))}}},mini._Grid_RowGroup=function(t){this.owner=t,el=t.el,mini.on(t._bodyEl,"click",this.__OnClick,this)},mini._Grid_RowGroup.prototype={__OnClick:function(t){var e=this.owner,i=e._getRowGroupByEvent(t);i&&(e.groupTitleCollapsible||mini.hasClass(t.target,"mini-grid-group-ecicon"))&&(e.fire("beforegroupclick",t={htmlEvent:t,cancel:!1,group:i}),!0!==t.cancel&&e.toggleRowGroup(i))}},mini._Grid_ColumnsMenu=function(t){this.owner=t,this.menu=this.createMenu(),mini.on(t.el,"contextmenu",this.__OnContextMenu,this),t.on("destroy",this.__OnGridDestroy,this)},mini._Grid_ColumnsMenu.prototype={__OnGridDestroy:function(t){this.menu&&this.menu.destroy(),this.menu=null},createMenu:function(){var t=mini.create({type:"menu",hideOnClick:!1});return t.on("itemclick",this.__OnItemClick,this),jQuery(t.el).addClass("mini-menu-open"),t},updateMenu:function(){for(var t=this.owner,e=this.menu,i=t.getBottomColumns(),n=[],s=0,o=i.length;s<o;s++){var l,r=i[s];r.hideable||((l={}).checked=r.visible,l.checkOnClick=!0,l.text=t._createHeaderText(r),"&nbsp;"==l.text&&("indexcolumn"==r.type&&(l.text="序号"),"checkcolumn"==r.type&&(l.text="选择")),n.push(l),l.enabled=r.enabled,l._column=r)}e.setItems(n)},__OnContextMenu:function(t){var e=this.owner;if(0!=e.showColumnsMenu&&0!=mini.isAncestor(e._columnsEl,t.target))return this.updateMenu(),this.menu.showAtPos(t.pageX,t.pageY),!1},__OnItemClick:function(t){for(var e=this.owner,i=this.menu,n=(e.getBottomColumns(),i.getItems()),i=t.item,t=i._column,s=0,o=0,l=n.length;o<l;o++)n[o].getChecked()&&s++;s<1&&i.setChecked(!0),i.getChecked()?e.showColumn(t):e.hideColumn(t)}},mini._Grid_CellToolTip=function(t){this.owner=t,mini.on(this.owner.el,"mousemove",this.__OnGridMouseMove,this)},mini._Grid_CellToolTip.prototype={__OnGridMouseMove:function(t){var e,i,n,s,o=this.owner;mini.hasClass(t.target,"mini-grid-headerCell-inner")?(n=t.target).scrollWidth>n.clientWidth?(e=n.innerText||n.textContent||"",n.title=e.trim()):n.title="":(i=o._getCellByEvent(t),n=o._getCellEl(i[0],i[1]),s=o.getCellError(i[0],i[1]),n&&(s?setTimeout(function(){n.title=s.errorText},10):setTimeout(function(){var t=n;n.firstChild&&(mini.hasClass(n.firstChild,"mini-grid-cell-inner")&&(t=n.firstChild),mini.hasClass(n.firstChild,"mini-tree-nodetitle")&&(t=n.firstChild)),t.scrollWidth>t.clientWidth&&o.getShowCellTip()&&i[1].showCellTip?(t=t.innerText||t.textContent||"",n.title=t.trim()):n.title=""},10)))}},mini._Grid_Sorter=function(t){this.owner=t,this.owner.on("headercellclick",this.__OnGridHeaderCellClick,this),this.owner.on("headercelldblclick",this.__OnGridHeaderCellClick,this),mini.on(t._headerEl,"mousemove",this.__OnGridHeaderMouseMove,this),mini.on(t._headerEl,"mouseout",this.__OnGridHeaderMouseOut,this)},mini._Grid_Sorter.prototype={__OnGridHeaderMouseOut:function(t){this._focusedColumnEl&&mini.removeClass(this._focusedColumnEl,"mini-grid-headerCell-hover")},__OnGridHeaderMouseMove:function(t){t=mini.findParent(t.target,"mini-grid-headerCell");t&&(mini.addClass(t,"mini-grid-headerCell-hover"),this._focusedColumnEl=t)},__OnGridHeaderCellClick:function(t){var e=this.owner,i=t.htmlEvent.type;"dblclick"==i&&!e.sortDblClick||"click"==i&&e.sortDblClick||mini.hasClass(t.htmlEvent.target,"mini-grid-headerCell-inner")&&e.allowSortColumn&&0==e.isEditing()&&((i=t.column).columns&&0!=i.columns.length||(t=i.sortField||i.field)&&!1!==i.allowSort&&(e.allowCancelSort&&"desc"==e.getSortOrder()?e.clearSort():(i="asc",e.getSortField()==t&&(i="asc"==e.getSortOrder()?"desc":"asc"),e.sortBy(t,i))))}},mini._Grid_ColumnMove=function(t){this.owner=t,mini.on(this.owner.el,"mousedown",this.__onGridMouseDown,this)},mini._Grid_ColumnMove.prototype={__onGridMouseDown:function(t){var e,i,n=this.owner;n.isEditing()||mini.hasClass(t.target,"mini-grid-column-splitter")||t.button==mini.MouseButton.Right||(e=mini.findParent(t.target,n._headerCellCls))&&(this._remove(),i=n._getColumnByEvent(t),n.allowMoveColumn&&i&&i.allowMove&&(this.dragColumn=i,this._columnEl=e,this.getDrag().start(t)))},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!1,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){var e,i,n=this.owner;this._dragProxy=mini.append(document.body,'<div class="mini-grid-columnproxy"></div>'),this._dragProxy.innerHTML='<div class="mini-grid-columnproxy-inner" style="height:26px;">'+(e=this.dragColumn,"function"==typeof(i=e.header)&&(i=i.call(n,e)),i=mini.isNull(i)||""===i?"&nbsp;":i)+"</div>",mini.setXY(this._dragProxy,t.now[0]+15,t.now[1]+18),mini.addClass(this._dragProxy,"mini-grid-no"),this.moveTop=mini.append(document.body,'<div class="mini-grid-movetop"></div>'),this.moveBottom=mini.append(document.body,'<div class="mini-grid-movebottom"></div>')},_OnDragMove:function(t){var e=this.owner,i=t.now[0];mini.setXY(this._dragProxy,i+15,t.now[1]+18),this.targetColumn=this.insertAction=null,!mini.findParent(t.event.target,e._headerCellCls)||(t=e._getColumnByEvent(t.event))&&t!=this.dragColumn&&e.getParentColumn(this.dragColumn)==e.getParentColumn(t)&&(this.targetColumn=t,this.insertAction="before",i>(i=e.getColumnBox(this.targetColumn)).x+i.width/2&&(this.insertAction="after")),this.targetColumn?(mini.addClass(this._dragProxy,"mini-grid-ok"),mini.removeClass(this._dragProxy,"mini-grid-no"),e=e.getColumnBox(this.targetColumn),this.moveTop.style.display="block",this.moveBottom.style.display="block","before"==this.insertAction?(mini.setXY(this.moveTop,e.x-4,e.y-9),mini.setXY(this.moveBottom,e.x-4,e.bottom)):(mini.setXY(this.moveTop,e.right-4,e.y-9),mini.setXY(this.moveBottom,e.right-4,e.bottom))):(mini.removeClass(this._dragProxy,"mini-grid-ok"),mini.addClass(this._dragProxy,"mini-grid-no"),this.moveTop.style.display="none",this.moveBottom.style.display="none")},_remove:function(){this.owner;mini.removeNode(this._dragProxy),mini.removeNode(this.moveTop),mini.removeNode(this.moveBottom),this._dragProxy=this.moveTop=this.moveBottom=this.dragColumn=this.targetColumn=null},_OnDragStop:function(t){this.owner.moveColumn(this.dragColumn,this.targetColumn,this.insertAction),this._remove()}},mini._Grid_ColumnSplitter=function(t){this.owner=t,mini.on(t.el,"mousedown",this.__OnMouseDown,this)},mini._Grid_ColumnSplitter.prototype={__OnMouseDown:function(t){var e=this.owner,i=t.target;mini.hasClass(i,"mini-grid-column-splitter")&&(i=e._getColumnById(i.id),e.isEditing()||e.allowResizeColumn&&i&&i.allowResize&&(this.splitterColumn=i,this.getDrag().start(t)))},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!0,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){var e=this.owner,i=e.getColumnBox(this.splitterColumn);this.columnBox=i,this._dragProxy=mini.append(document.body,'<div class="mini-grid-proxy"></div>');var n=e.getGridViewBox();n.x=i.x,n.width=i.width,n.right=i.right,mini.setBox(this._dragProxy,n),e._ignoreClick=!0},_OnDragMove:function(t){var e=this.owner,t=mini.copyTo({},this.columnBox).width+(t.now[0]-t.init[0]);(t=t<e.columnMinWidth?e.columnMinWidth:t)>e.columnMaxWidth&&(t=e.columnMaxWidth),mini.setWidth(this._dragProxy,t)},_OnDragStop:function(t){var e=this.owner,i=mini.getBox(this._dragProxy),n=this,s=e.allowSortColumn;e.allowSortColumn=!1,setTimeout(function(){jQuery(n._dragProxy).remove(),n._dragProxy=null,e.allowSortColumn=s},10);var o,l=this.splitterColumn,r=parseInt(l.width);r+"%"!=l.width&&(o=e.getColumnWidth(l),(i=parseInt(r/o*i.width))<e.columnMinWidth&&(i=e.columnMinWidth),e.setColumnWidth(l,i)),setTimeout(function(){e._ignoreClick=!1},100)}},mini._Grid_DragDrop=function(t){this.owner=t,this.owner.on("CellMouseDown",this.__OnGridCellMouseDown,this)},mini._Grid_DragDrop.prototype={__OnGridCellMouseDown:function(t){var e,i;t.htmlEvent.button!=mini.MouseButton.Right&&((e=this.owner)._dragging||(this.dropObj=e,mini.findParent(t.htmlEvent.target,"mini-tree-editinput")||e.isReadOnly()||0==e.isAllowDrag(t.record,t.column)||((i=e._OnDragStart(t.record,t.column)).cancel||(this.dragText=i.dragText,i=t.record,this.isTree=!!e.isTree,this.beginRecord=i,this._getDrag().start(t.htmlEvent)))))},_OnDragStart:function(t){var e=this.owner;e._dragging=!0;var i=this.beginRecord;this.dragData=e._getDragData(),-1==this.dragData.indexOf(i)&&this.dragData.push(i),this.feedbackEl=mini.append(document.body,'<div class="mini-feedback"></div>'),this.feedbackEl.innerHTML=this.dragText,this.lastFeedbackClass="",this.enableHotTrack=e.getEnableHotTrack(),e.setEnableHotTrack(!1)},_getDropTargetObj:function(t){t=mini.findParent(t.target,"mini-grid",500);if(t)return mini.get(t)},_OnDragMove:function(t){this.owner;var e=this._getDropTargetObj(t.event);this.dropObj=e;var i,n=t.now[0],s=t.now[1];mini.setXY(this.feedbackEl,n+15,s+18),e&&e.allowDrop?(this.isTree=e.isTree,i=e._getRecordByEvent(t.event),(this.dropRecord=i)?this.isTree?this.dragAction=this.getFeedback(i,s,3):this.dragAction=this.getFeedback(i,s,2):this.dragAction="no"):this.dragAction="no",e&&e.allowDrop&&!i&&0==e.getData().length&&(this.dragAction="add"),this.lastFeedbackClass="mini-feedback-"+this.dragAction,this.feedbackEl.className="mini-feedback "+this.lastFeedbackClass,"no"==this.dragAction&&(i=null),this.setRowFeedback(i,this.dragAction)},_OnDragStop:function(t){var e,i,n,s=this.owner,o=this.dropObj;if(s._dragging=!1,mini.removeNode(this.feedbackEl),s.setEnableHotTrack(this.enableHotTrack),this.feedbackEl=null,this.setRowFeedback(null),this.isTree){for(var l=[],r=0,a=this.dragData.length;r<a;r++){for(var h=this.dragData[r],d=!1,u=0,c=this.dragData.length;u<c;u++){var m=this.dragData[u];if(m!=h&&(d=s.isAncestor(m,h)))break}d||l.push(h)}this.dragData=l}"add"!=this.dragAction||this.dropRecord||(this.dropRecord=o.getRootNode?o.getRootNode():{__root:!0}),this.dropRecord&&o&&"no"!=this.dragAction&&((n=o._OnDragDrop(this.dragData,this.dropRecord,this.dragAction)).cancel||(l=n.dragNodes,i=n.targetNode,e=n.action,o.isTree?s==o?o.moveNodes(l,i,e):("move"==o.dropAction?s.removeNodes(l):"copy"==o.dropAction&&(l=mini.clone(l)),o.addNodes(l,i,e)):(i=o.indexOf(i),"after"==e&&(i+=1),s==o?o.moveRow(l,i):("move"==o.dropAction?s.removeRows(l):"copy"==o.dropAction&&(l=mini.clone(l)),"add"==this.dragAction?o.addRows(l):o.addRows(l,i))),n={dragNode:n.dragNodes[0],dropNode:n.targetNode,dragAction:n.action,dragNodes:n.dragNodes,targetNode:n.targetNode},o.fire("drop",n))),this.dropRecord=null,this.dragData=null},setRowFeedback:function(t,e){this.owner;var i,n,s,o=this.dropObj;this.lastAddDomRow&&o&&o.removeRowCls(this.lastAddDomRow,"mini-tree-feedback-add"),null!=t&&"add"!=this.dragAction||(mini.removeNode(this.feedbackLine),this.feedbackLine=null),null!=(this.lastRowFeedback=t)&&("before"==e||"after"==e?(this.feedbackLine||(this.feedbackLine=mini.append(document.body,"<div class='mini-feedback-line'></div>")),this.feedbackLine.style.display="block",n=(i=o.getRowBox(t)).x,s=i.y-1,"after"==e&&(s+=i.height),mini.setXY(this.feedbackLine,n,s),s=o.getBox(!0),mini.setWidth(this.feedbackLine,s.width)):(o.addRowCls(t,"mini-tree-feedback-add"),this.lastAddDomRow=t))},getFeedback:function(t,e,i){var n=this.owner,s=this.dropObj,o=s.getRowBox(t),l=o.height,e=e-o.y,r=null;if(-1!=this.dragData.indexOf(t))return"no";o=!1;if(3==i)for(var o=s.isLeaf(t),a=0,h=this.dragData.length;a<h;a++){var d=this.dragData[a];if(s.isAncestor(d,t)){r="no";break}}return null==r&&(r=2==i||o&&!1===s.allowLeafDropIn?l/2<e?"after":"before":l/3*2<e?"after":l/3<=e&&e<=l/3*2?"add":"before"),s._OnGiveFeedback(r,this.dragData,t,n).effect},_getDrag:function(){return this.drag||(this.drag=new mini.Drag({onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag}},mini._Grid_Events=function(t){this.owner=t,el=t.el,mini.on(el,"click",this.__OnClick,this),mini.on(el,"dblclick",this.__OnDblClick,this),mini.on(el,"mousedown",this.__OnMouseDown,this),mini.on(el,"mouseup",this.__OnMouseUp,this),mini.on(el,"mousemove",this.__OnMouseMove,this),mini.on(el,"mouseover",this.__OnMouseOver,this),mini.on(el,"mouseout",this.__OnMouseOut,this),mini.on(el,"keydown",this.__OnKeyDown,this),mini.on(el,"keyup",this.__OnKeyUp,this),mini.on(el,"contextmenu",this.__OnContextMenu,this),t.on("rowmousemove",this.__OnRowMouseMove,this),mini.on(window,"resize",this.__windowResize,this)},mini._Grid_Events.prototype={__windowResize:function(){var i=this.owner;setTimeout(function(){var t,e;(e=i._getEditingControl())&&(t=i.getCurrentCell(),t=i.getCellBox(t[0],t[1]),i._getEditWrap(t,e),i._setEditorBox(e,t))},100)},_row:null,__OnRowMouseMove:function(t){var e=this.owner,i=t.record;this._row!=i&&(t.record=i,t.row=i,e.fire("rowmouseenter",t)),this._row=i},__OnClick:function(t){this.owner._ignoreClick||this._fireEvent(t,"Click")},__OnDblClick:function(t){this._fireEvent(t,"Dblclick")},__OnMouseDown:function(e){var t,i=this.owner;mini.findParent(e.target,"mini-tree-editinput")||mini.findParent(e.target,"mini-tree-node-ecicon")||(this._fireEvent(e,"MouseDown"),t=300,"a"==e.target.tagName.toLowerCase()&&e.target.href&&(t=10),setTimeout(function(){var t;t=mini.findParent(e.target,"mini-grid-detailRow"),mini.isAncestor(i.el,t)||i._editingCell||i._tryFocus(e)},t))},__OnMouseUp:function(t){var e;mini.findParent(t.target,"mini-tree-editinput")||mini.findParent(t.target,"mini-tree-node-ecicon")||mini.findParent(t.target,"mini-tree-checkbox")||(e=this.owner,mini.isAncestor(e.el,t.target)&&this._fireEvent(t,"MouseUp"))},__OnMouseMove:function(t){this._fireEvent(t,"MouseMove")},__OnMouseOver:function(t){this._fireEvent(t,"MouseOver")},__OnMouseOut:function(t){this._fireEvent(t,"MouseOut")},__OnKeyDown:function(t){this._fireEvent(t,"KeyDown")},__OnKeyUp:function(t){this._fireEvent(t,"KeyUp")},__OnContextMenu:function(t){this._fireEvent(t,"ContextMenu")},_fireEvent:function(t,e){var i,n,s=this.owner,o=s._getCellByEvent(t),l=o[0],o=o[1];l&&(i={record:l,row:l,htmlEvent:t},(n=s["_OnRow"+e])?n.call(s,i):s.fire("row"+e,i)),o&&(i={column:o,field:o.field,htmlEvent:t},(n=s["_OnColumn"+e])?n.call(s,i):s.fire("column"+e,i)),l&&o&&(i={sender:s,record:l,row:l,column:o,field:o.field,htmlEvent:t},(n=s["_OnCell"+e])?n.call(s,i):s.fire("cell"+e,i),o["onCell"+e]&&o["onCell"+e].call(o,i)),!l&&o&&mini.findParent(t.target,"mini-grid-headerCell")&&(i={column:o,htmlEvent:t},(n=s["_OnHeaderCell"+e])?n.call(s,i):(o[n="onheadercell"+e.toLowerCase()]&&(i.sender=s,o[n](i)),s.fire("headercell"+e,i)))}},mini.DataGrid=function(t){mini.DataGrid.superclass.constructor.call(this,null),this._Events=new mini._Grid_Events(this),this._Select=new mini._Grid_Select(this),this._DragDrop=new mini._Grid_DragDrop(this),this._RowGroup=new mini._Grid_RowGroup(this),this._Splitter=new mini._Grid_ColumnSplitter(this),this._ColumnMove=new mini._Grid_ColumnMove(this),this._Sorter=new mini._Grid_Sorter(this),this._CellToolTip=new mini._Grid_CellToolTip(this),this._ColumnsMenu=new mini._Grid_ColumnsMenu(this),this._createPagers(),t&&mini.applyTo.call(this,t)},mini.extend(mini.DataGrid,mini.ScrollGridView,{uiCls:"mini-datagrid",selectOnLoad:!1,showHeader:!1,showPager:!0,validateOnAdd:!1,getValidateOnAdd:function(){return this.validateOnAdd},setValidateOnAdd:function(t){this.validateOnAdd=t},dropAction:"move",onlyCheckSelection:!1,_$onlyCheckSelection:!0,allowUnselect:!1,allowRowSelect:!0,allowCellSelect:!1,allowCellEdit:!1,cellEditAction:"cellclick",allowCellValid:!1,allowResizeColumn:!0,allowSortColumn:!0,allowMoveColumn:!0,showColumnsMenu:!1,virtualScroll:!1,enableHotTrack:!0,allowHotTrackOut:!0,showLoading:!0,columnMinWidth:8,_expandLoad:function(){},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.url;delete t.url;var n=t.data;delete t.data;var s=t.columns;delete t.columns;var o=t.defaultColumnWidth;return delete t.defaultColumnWidth,o&&this.setDefaultColumnWidth(o),mini.isNull(s)||this.setColumns(s),mini.DataGrid.superclass.set.call(this,t),mini.isNull(n)||this.setData(n),mini.isNull(i)||this.setUrl(i),mini.isNull(e)||this.setValue(e),this},doUpdate:function(){this._destroyEditors(),mini.DataGrid.superclass.doUpdate.apply(this,arguments)},_destroyEditors:function(){for(var t=mini.getChildControls(this),e=[],i=0,n=t.length;i<n;i++){var s=t[i];s.el&&mini.findParent(s.el,this._rowCls)&&(e.push(s),s.destroy())}},_OnDrawCell:function(){return mini.DataGrid.superclass._OnDrawCell.apply(this,arguments)},_bindSource:function(){var t=this._dataSource;t.on("beforeload",this.__OnSourceBeforeLoad,this),t.on("preload",this.__OnSourcePreLoad,this),t.on("load",this.__OnSourceLoadSuccess,this),t.on("loaderror",this.__OnSourceLoadError,this),t.on("loaddata",this.__OnSourceLoadData,this),t.on("cleardata",this.__OnSourceClearData,this),t.on("sort",this.__OnSourceSort,this),t.on("filter",this.__OnSourceFilter,this),t.on("pageinfochanged",this.__OnPageInfoChanged,this),t.on("selectionchanged",this.__OnSelectionChanged,this),t.on("currentchanged",function(t){this.fire("currentchanged",t)},this),t.on("add",this.__OnSourceAdd,this),t.on("update",this.__OnSourceUpdate,this),t.on("remove",this.__OnSourceRemove,this),t.on("move",this.__OnSourceMove,this),t.on("beforeadd",function(t){this.fire("beforeaddrow",t)},this),t.on("beforeupdate",function(t){this.fire("beforeupdaterow",t)},this),t.on("beforeremove",function(t){this.fire("beforeremoverow",t)},this),t.on("beforemove",function(t){this.fire("beforemoverow",t)},this),t.on("beforeselect",function(t){this.fire("beforeselect",t)},this),t.on("beforedeselect",function(t){this.fire("beforedeselect",t)},this),t.on("select",function(t){this.fire("select",t)},this),t.on("deselect",function(t){this.fire("deselect",t)},this)},_getMaskWrapEl:function(){return this.el},_initData:function(){this.data=this._dataSource.getSource(),this.pageIndex=this.getPageIndex(),this.pageSize=this.getPageSize(),this.totalCount=this.getTotalCount(),this.totalPage=this.getTotalPage(),this.sortField=this.getSortField(),this.sortOrder=this.getSortOrder(),this.url=this.getUrl(),this._mergedCellMaps={},this._mergedCells={},this._cellErrors=[],this._cellMapErrors={},this.isGrouping()&&(this.groupBy(this._groupField,this._groupDir),this.collapseGroupOnLoad&&this.collapseGroups())},__OnSourceBeforeLoad:function(t){this.fire("beforeload",t),1!=t.cancel&&this.showLoading&&this.loading()},__OnSourcePreLoad:function(t){this.fire("preload",t)},__OnSourceLoadSuccess:function(t){this.fire("load",t),this.unmask()},__OnSourceLoadError:function(t){this.fire("loaderror",t),this.unmask()},__OnSourceSort:function(t){this.deferUpdate(),this.fire("sort",t)},__OnSourceFilter:function(t){this.deferUpdate(),this.fire("filter",t)},__OnSourceAdd:function(t){this._doAddRowEl(t.record,t.index);var e=this;e._addTimer||(e._addTimer=setTimeout(function(){e._addTimer=null,e._doUpdateSummaryRow(),e._viewRegion=e._getViewRegion()},10)),this.fire("addrow",t)},__OnSourceUpdate:function(t){this._doUpdateRowEl(t.record),this._doUpdateSummaryRow(),this.fire("updaterow",t)},__OnSourceRemove:function(t){var e=this;this._doRemoveRowEl(t.record),e._toSummary||(e._toSummary=setTimeout(function(){e._toSummary=null,e._doUpdateSummaryRow()},10)),this.fire("removerow",t),this.isVirtualScroll()&&this.deferUpdate()},__OnSourceMove:function(t){this._doMoveRowEl(t.record,t.index),this._doUpdateSummaryRow(),this.fire("moverow",t)},__OnSelectionChanged:function(t){!1!==t.fireEvent&&(t.select?this.fire("rowselect",t):this.fire("rowdeselect",t));var e=this;this._selectionTimer&&(clearTimeout(this._selectionTimer),this._selectionTimer=null),this._selectionTimer=setTimeout(function(){e._selectionTimer=null,!1!==t.fireEvent&&e.fire("SelectionChanged",t),e.fire("_selectchange",t)},1);new Date;this._doRowSelect(t._records,t.select)},__OnPageInfoChanged:function(t){this._updatePagesInfo()},_updatePagesInfo:function(){for(var t=this.getPageIndex(),e=this.getPageSize(),i=this.getTotalCount(),n=(this.getTotalPage(),this._pagers),s=0,o=n.length;s<o;s++){var l=n[s];l.update(t,e,i),this._dataSource.totalPage=l.totalPage}},setPagerButtons:function(t){this._bottomPager.setButtons(t)},setPager:function(t){if("string"==typeof t){if(!mini.byId(t))return;mini.parse(t),t=mini.get(t)}t&&this.bindPager(t)},bindPager:function(t){t&&(this.unbindPager(t),this._pagers.add(t),t.on("beforepagechanged",this.__OnPageChanged,this))},unbindPager:function(t){t&&(this._pagers.remove(t),t.un("pagechanged",this.__OnPageChanged,this))},__OnPageChanged:function(t){t.cancel=!0,this.gotoPage(t.pageIndex,t.pageSize)},_canUpdateRowEl:!0,_doUpdateRowEl:function(t){var e,i=this.getFrozenColumns(),n=this.getUnFrozenColumns(),s=this.indexOf(t),o=this._createRowHTML(t,s,n,2),l=this._getRowEl(t,2);l&&(jQuery(l).before(o),n=l.previousSibling,l&&l.parentNode.removeChild(l),this.isFrozen()&&(o=this._createRowHTML(t,s,i,1),l=this._getRowEl(t,1),jQuery(l).before(o),e=l.previousSibling,jQuery(l).remove()),this.deferLayout(),n&&e&&this._doSyncRowHeight(n,e))},_doAddRowEl:function(t,e){var i=this.getFrozenColumns(),n=this.getUnFrozenColumns(),s=this._rowsLockContentEl.firstChild,o=this._rowsViewContentEl.firstChild,l=mini.isNumber(e)?e:this.indexOf(t),r=this.getAt(l+1);function a(t,e,i,n){i=this._createRowHTML(t,l,i,e);r?(e=this._getRowEl(r,e),jQuery(e).before(i)):mini.append(n,i)}a.call(this,t,2,n,o),this.isFrozen()&&a.call(this,t,1,i,s),this.deferLayout(),!this.showEmptyText||(s=jQuery(".mini-grid-emptyText",this._bodyEl)[0])&&(s.style.display="none",s.parentNode.style.display="none")},_doRemoveRowEl:function(t){var e=this._getRowEl(t,1),i=this._getRowEl(t,2);e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i),i&&(i=this._getRowDetailEl(t,1),t=this._getRowDetailEl(t,2),i&&i.parentNode.removeChild(i),t&&t.parentNode.removeChild(t),this.deferLayout(),!this.showEmptyText||0!=this.getVisibleRows().length||(t=jQuery(".mini-grid-emptyText",this._bodyEl)[0])&&(t.style.display="",t.parentNode.style.display=""))},_doMoveRowEl:function(t,e){this._doRemoveRowEl(t),this._doAddRowEl(t)},_getRowGroupEl:function(t,e){if(1==e&&!this.isFrozen())return null;e=this._createRowGroupId(t,e);return mini.byId(e,this.el)},_getRowGroupRowsEl:function(t,e){if(1==e&&!this.isFrozen())return null;e=this._createRowGroupRowsId(t,e);return mini.byId(e,this.el)},_getRowEl:function(t,e){if(1==(e=null==e?2:e)&&!this.isFrozen())return null;t=this.getRecord(t);e=this._createRowId(t,e);return mini.byId(e,this.el)},_getHeaderCellEl:function(t,e){if(1==(e=null==e?2:e)&&!this.isFrozen())return null;t=this.getColumn(t);e=this._createHeaderCellId(t,e);return mini.byId(e,this.el)},getRowEl:function(t,e){return this._getRowEl(t,e)},getHeaderCellEl:function(t,e){return this._getHeaderCellEl(t,e)},_getCellEl:function(t,e){if(t=this.getRecord(t),e=this.getColumn(e),!t||!e)return null;e=this._createCellId(t,e);return mini.byId(e,this.el)},getCellEl:function(t,e){return this._getCellEl(t,e)},getRecordByEvent:function(t){return this._getRecordByEvent(t)},_getRecordByEvent:function(t){t=mini.findParent(t.target,this._rowCls);if(!t)return null;t=t.id.split("$"),t=t[t.length-1];return this._getRowByID(t)},getColumnByEvent:function(t){return this.getColumnFromEvent(t)},_getColumnByEvent:function(t){var e=mini.findParent(t.target,this._cellCls);if(e=e||mini.findParent(t.target,this._headerCellCls)){e=e.id.split("$"),e=e[e.length-1];return this._getColumnById(e)}return null},_getCellByEvent:function(t){return[this._getRecordByEvent(t),this._getColumnByEvent(t)]},getColumnFromEvent:function(t){return t?this._getColumnByEvent(t):null},getCellFromEvent:function(t){return this._getCellByEvent(t)},getRowFromEvent:function(t){t=this._getCellByEvent(t);return t?t[0]:null},getRowByEvent:function(t){return this.getRowFromEvent(t)},getCellByEvent:function(t){return this.getCellFromEvent(t)},_getRowByID:function(t){return this._dataSource.getby_id(t)},_getColumnById:function(t){return this._columnModel._getColumnById(t)},hasRowCls:function(t,e){t=this._rowClsHash[t._id];return!!t&&-1!=t.indexOf(e)},addRowCls:function(t,e,i){var n=this._getRowEl(t,1),s=this._getRowEl(t,2);n&&mini.addClass(n,e),s&&mini.addClass(s,e),t&&!1!==i&&((i=this._rowClsHash[t._id])?i.remove(e):i=this._rowClsHash[t._id]=[],i.push(e))},removeRowCls:function(t,e){var i=this._getRowEl(t,1),n=this._getRowEl(t,2);i&&mini.removeClass(i,e),n&&mini.removeClass(n,e),!t||(n=this._rowClsHash[t._id])&&(n.remove(e),0==n.length&&delete this._rowClsHash[t._id])},getCellBox:function(t,e){if(t=this.getRow(t),e=this.getColumn(e),!t||!e)return null;e=this._getCellEl(t,e);return e?mini.getBox(e):null},getColumnBox:function(t){var e=this._createHeaderCellId(t,2),i=document.getElementById(e);if(i||(e=this._createHeaderCellId(t,1),i=document.getElementById(e)),i){i=mini.getBox(i);return--i.x,i.left=i.x,i.right=i.x+i.width,i}},getRowBox:function(t){var e=this._getRowEl(t,1),t=this._getRowEl(t,2);if(!t)return null;t=mini.getBox(t);return e&&(e=mini.getBox(e),t.x=t.left=e.left,t.width=t.right-t.x),t},_doRowSelect:function(t,e){var i=this.isVirtualScroll(),n=this._viewRegion,s=i?n.start:-1,n=i?n.end:-1,o={};if(-1!=s)for(var l=this.getVisibleRows(),r=s,a=n;r<a;r++){var h=l[r];h&&(o[h._id]=!0)}new Date;for(r=0,a=t.length;r<a;r++){var d=t[r];-1!=s&&!o[d._id]||(e?this.addRowCls(d,this._rowSelectedCls,!1):this.removeRowCls(d,this._rowSelectedCls))}},_tryFocus:function(t){try{var e=t.target.tagName.toLowerCase();if("input"==e||"textarea"==e||"select"==e)return;if(mini.hasClass(t.target,"mini-placeholder-label"))return;mini.findParent(t.target,"mini-grid-rows-content")&&(mini.setXY(this._focusEl,t.pageX,t.pageY),this.focus(!1))}catch(ex){}},focus:function(t){try{var i,n=this.getCurrentCell();n&&!1!==t&&(i=this.getCellBox(n[0],n[1]),mini.setX(this._focusEl,i.x));var s,o,l=this.getCurrent();l?(s=this._getRowEl(l,2))&&(!1!==t&&(o=mini.getBox(s),mini.setY(this._focusEl,o.top)),(!(mini.isIE||mini.isIE11||mini.isChrome)||mini.isChrome?this.el:this._focusEl).focus()):(mini.isIE||mini.isIE11||mini.isChrome?this._focusEl:this.el).focus()}catch(e){}},focusRow:function(t){this._focusRow!=t&&(this._focusRow&&this.removeRowCls(this._focusRow,this._rowHoverCls),(this._focusRow=t)&&this.addRowCls(t,this._rowHoverCls,!1),mini.isIE6&&mini.repaint())},scrollIntoView:function(t,i,n){if(t=this.getRow(t)){var s,o,l,r,a,h,d,n=this.isVirtualScroll();try{(i=i&&this._columnModel.isFrozenColumn(i)?null:i)&&(s=this._getCellEl(t,i),mini.scrollIntoView(s,this._rowsViewEl,!0,1!=n),this._syncScroll()),this.isVirtualScroll()?(n=!0,o=this.getScrollTop(),l=this._vscrollEl.offsetHeight,this._getViewRegion(),r=this.getVisibleRows().indexOf(t),h=(a=this._getRangeHeight(0,r))+(t._height||this.defaultRowHeight),a<o?(this.setScrollTop(a),this._updateScrollTop(a)):o+l<h&&(a=o+h-(o+l),this.setScrollTop(a),this._updateScrollTop(a))):(d=this._getRowEl(t,2),mini.scrollIntoView(d,this._rowsViewEl,!1),this._syncScroll())}catch(e){}}},setShowLoading:function(t){this.showLoading=t},getShowLoading:function(){return this.showLoading},setEnableHotTrack:function(t){this.enableHotTrack=t},getEnableHotTrack:function(){return this.enableHotTrack},setAllowHotTrackOut:function(t){this.allowHotTrackOut=t},getAllowHotTrackOut:function(){return this.allowHotTrackOut},setOnlyCheckSelection:function(t){this.onlyCheckSelection=t},getOnlyCheckSelection:function(){return this.onlyCheckSelection},setAllowUnselect:function(t){this.allowUnselect=t},getAllowUnselect:function(){return this.allowUnselect},setAllowRowSelect:function(t){this.allowRowSelect=t},getAllowRowSelect:function(){return this.allowRowSelect},setAllowCellSelect:function(t){this.allowCellSelect=t},getAllowCellSelect:function(){return this.allowCellSelect},setAllowCellEdit:function(t){this.allowCellEdit=t},getAllowCellEdit:function(){return this.allowCellEdit},setCellEditAction:function(t){this.cellEditAction=t},getCellEditAction:function(){return this.cellEditAction},setAllowCellValid:function(t){this.allowCellValid=t},getAllowCellValid:function(){return this.allowCellValid},setAllowResizeColumn:function(t){this.allowResizeColumn=t,mini.removeClass(this.el,"mini-grid-resizeColumns-no"),t||mini.addClass(this.el,"mini-grid-resizeColumns-no")},getAllowResizeColumn:function(){return this.allowResizeColumn},setAllowSortColumn:function(t){this.allowSortColumn=t},getAllowSortColumn:function(){return this.allowSortColumn},setAllowMoveColumn:function(t){this.allowMoveColumn=t},getAllowMoveColumn:function(){return this.allowMoveColumn},setShowColumnsMenu:function(t){this.showColumnsMenu=t},getShowColumnsMenu:function(){return this.showColumnsMenu},setEditNextRowCell:function(t){this.editNextRowCell=t},getEditNextRowCell:function(){return this.editNextRowCell},setEditNextOnEnterKey:function(t){this.editNextOnEnterKey=t},getEditNextOnEnterKey:function(){return this.editNextOnEnterKey},setEditOnTabKey:function(t){this.editOnTabKey=t},getEditOnTabKey:function(){return this.editOnTabKey},setCreateOnEnter:function(t){this.createOnEnter=t},getCreateOnEnter:function(){return this.createOnEnter},_currentCell:null,_doCurrentCell:function(t){var e,i;this._currentCell&&(e=this._currentCell[0],i=this._currentCell[1],(i=this._getCellEl(e,i))&&(t?mini.addClass(i,this._cellSelectedCls):mini.removeClass(i,this._cellSelectedCls)))},setCurrentCell:function(t){var e,i;this._currentCell!=t&&(this._doCurrentCell(!1),(this._currentCell=t)&&(e=this.getRow(t[0]),i=this.getColumn(t[1]),this._currentCell=e&&i?[e,i]:null),this._doCurrentCell(!0),t&&(this._getAnchorCell(t[0],t[1])||(this.isFrozen()?this.scrollIntoView(t[0],null,!1):this.scrollIntoView(t[0],t[1],!1))),this.fire("currentcellchanged"))},getCurrentCell:function(){var t=this._currentCell;return t=t&&-1==this.indexOf(t[0])?this._currentCell=null:t},_editingCell:null,isEditingCell:function(t){return this._editingCell&&this._editingCell[0]==t[0]&&this._editingCell[1]==t[1]},beginEditCell:function(t,e){this._pushUpdateCallback(function(t,e){new Date;var i=[t=this.getRow(t),e=this.getColumn(e)];t&&e&&this.setCurrentCell(i),i=this.getCurrentCell(),this._editingCell&&i&&this._editingCell[0]==i[0]&&this._editingCell[1]==i[1]||(this._editingCell&&this.commitEdit(),i&&(t=i[0],"inline"!=(e=i[1]).editMode&&!1!==this._OnCellBeginEdit(t,e,this.getCellEditor(e))&&(this.scrollIntoView(t,e,!1),this._editingCell=i,this._OnCellShowingEdit(t,e))))},this,[t,e])},cancelEdit:function(){if(this.allowCellEdit)this._editingCell&&this._OnCellEndEdit();else if(this.isEditing()){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++)1==t[e]._editing&&this.cancelEditRow(e);this._allowLayout=!0,this.doLayout()}},commitEdit:function(){if(this.allowCellEdit)this._editingCell&&(this._OnCellCommitEdit(this._editingCell[0],this._editingCell[1]),this._OnCellEndEdit());else if(this.isEditing()){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];1==n._editing&&this.commitEditRow(n)}this._allowLayout=!0,this.doLayout()}},getCellEditor:function(t,e){if(t=this.getColumn(t)){if(this.allowCellEdit){var i=t.__editor;return(i=i||mini.getAndCreate(t.editor))&&i!=t.editor&&(t.editor=i),i}if(e=this.getRow(e),t=this.getColumn(t),!(e=e||this.getEditingRow())||!t)return null;t=this.uid+"$"+e._uid+"$"+t._id+"$editor";return mini.get(t)}},_OnCellBeginEdit:function(t,e,i,n){var s=mini._getMap(e.field,t),o={sender:this,rowIndex:this.indexOf(t),row:t,record:t,column:e,field:e.field,editor:i,value:s,cancel:!1};this.fire("cellbeginedit",o),mini.isNull(e.defaultValue)||!mini.isNull(o.value)&&""!==o.value||(l=e.defaultValue,l=mini.clone({d:l}),o.value=l.d);var l,i=o.editor,s=o.value;return!o.cancel&&(!(!i&&"inline"!=e.editMode)&&(!0!==e.readOnly&&(!1===n||"inline"!=e.editMode&&(mini.isNull(s)&&(s=""),i.setValue&&i.setValue(s),i.ownerRowID=t._uid,e.displayField&&i.setText&&(t=mini._getMap(e.displayField,t),mini.isNull(e.defaultText)||!mini.isNull(t)&&""!==t||(t=(l=mini.clone({d:e.defaultText})).d),i.setText(t)),this.allowCellEdit&&(this._editingControl=o.editor)),!0)))},_OnCellCommitEdit:function(t,e,i,n){var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:n||this.getCellEditor(e),value:mini.isNull(i)?"":i,text:"",cancel:!1};if(s.editor&&s.editor.getValue){try{s.editor.blur()}catch(ex){}s.value=s.editor.getValue()}s.editor&&s.editor.getText&&(s.text=s.editor.getText());n=mini._getMap(e.field,t),i=s.value;return s.oldValue=n,mini.isEquals(n,i)||(this.fire("cellcommitedit",s),0==s.cancel&&this.allowCellEdit&&((i={})[e.field]=s.value,e.displayField&&(i[e.displayField]=s.text),this.updateRow(t,i))),s},_OnCellEndEdit:function(t,e){if(this._editingCell||t){t=t||this._editingCell[0],e=e||this._editingCell[1];var i=mini._getMap(e.field,t),i={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:this._editingControl,value:i};if(this.fire("cellendedit",i),this.allowCellEdit&&i.editor){i=i.editor;i&&i.setIsValid&&i.setIsValid(!0),this._editWrap&&(this._editWrap.style.display="none");for(var n=this._editWrap.childNodes,s=n.length-1;0<=s;s--){var o=n[s];this._editWrap.removeChild(o)}i&&i.hidePopup&&i.hidePopup(),i&&i.setValue&&i.setValue(""),this._editingControl=null,this._editingCell=null,this.allowCellValid&&this.validateCell(t,e)}}},_OnCellShowingEdit:function(t,e){if(!this._editingControl)return!1;var i,n=this.getCellBox(t,e);n&&(i=document.body.scrollWidth,n.right>i&&(n.width=i-n.left,n.width<10&&(n.width=10),n.right=n.left+n.width));t={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,cellBox:n,editor:this._editingControl};this.fire("cellshowingedit",t);t=t.editor;t&&t.setIsValid&&t.setIsValid(!0),n&&(this._getEditWrap(t),this._editWrap.style.zIndex=mini.getMaxZIndex(),this._setEditorBox(t,n),mini.on(document,"mousedown",this.__OnBodyMouseDown,this),e.autoShowPopup&&t.showPopup&&t.showPopup()),t&&this.navEditMode&&(t.keyNavEnabled=!(!1!==e.navUpdown))},_getEditingControl:function(){return this._editingControl},_setEditorBox:function(t,e){var i;t.setWidth&&(n=e.width,t.setWidth(n=n<20?20:n)),t.setHeight&&"textarea"==t.type&&(i=e.height-1,t.minHeight&&i<t.minHeight&&(i=t.minHeight),t.setHeight(i)),t.setWidth&&(n=e.width-1,t.minWidth&&n<t.minWidth&&(n=t.minWidth),t.setWidth(n));var n=e,e=t.getHeight(),t=n.y;e<n.height-2&&(t=Math.round(n.y+n.height/2-e/2)),mini.setXY(this._editWrap,n.x,t),mini.setWidth(this._editWrap,n.width);t=document.body.scrollWidth;n.x>t&&mini.setX(this._editWrap,-1e3)},__OnBodyMouseDown:function(t){if(this._editingControl){var e=this._getCellByEvent(t);if(this._editingCell&&e&&this._editingCell[0]==e.record&&this._editingCell[1]==e.column)return!1;var i,n;0==(this._editingControl.within?this._editingControl.within(t):mini.isAncestor(this._editWrap,t.target))&&(i=this,0==mini.isAncestor(this._bodyEl,t.target)?setTimeout(function(){i.commitEdit()},1):(n=i._editingCell,setTimeout(function(){var t=i._editingCell;n==t&&i.commitEdit()},70)),mini.un(document,"mousedown",this.__OnBodyMouseDown,this))}},getEditWrap:function(){return this._editWrap},_getEditWrap:function(t){return this._editWrap||(this._editWrap=mini.append(this.cellEditorContainer||mini.cellEditorContainer||document.body,'<div class="mini-grid-editwrap" style="position:absolute;"></div>'),mini.on(this._editWrap,"keydown",this.___OnEditControlKeyDown,this)),this._editWrap.style.zIndex=1e9,this._editWrap.style.display="block",t.render?(t.render(this._editWrap),setTimeout(function(){t.focus(),t.selectText&&setTimeout(function(){t.selectText()},11)},50),t.setVisible&&t.setVisible(!0)):t.el&&(this._editWrap.appendChild(t.el),setTimeout(function(){try{t.el.focus()}catch(e){}},50)),this._editWrap},___OnEditControlKeyDown:function(t){var e=this._editingControl;if(13!=t.keyCode||!e||"textarea"!=e.type){if(13==t.keyCode){var i=new Date;if(this._enterTimestamp&&i-this._enterTimestamp<80)return;if(this._enterTimestamp=i,(s=this._editingCell)&&s[1]&&!1===s[1].enterCommit)return;this.commitEdit(),this.focus(),this.editNextOnEnterKey&&(this.fire("celleditenter",{record:s[0],column:s[1]}),this._beginEditNextCell(0==t.shiftKey))}else 27==t.keyCode?(this.cancelEdit(),this.focus()):9==t.keyCode&&(this.commitEdit(),this.editOnTabKey&&(t.preventDefault(),this.commitEdit(),this._beginEditNextCell(0==t.shiftKey,!0)));if(this.navEditMode){if(s=this._editingCell){var n=s[1];if(n&&!1===n.navUpdown&&e&&(38==t.keyCode||40==t.keyCode))return}switch(t.keyCode){case 37:this.focus(),t.preventDefault(),this.commitEdit(),this._beginEditNextCell(!1!==t.shiftKey);break;case 39:this.focus(),this.commitEdit(),this.editOnTabKey&&(t.preventDefault(),this.commitEdit(),this._beginEditNextCell(0==t.shiftKey,!0));break;case 38:this.focus(),t.preventDefault();var s=this._editingCell;this.commitEdit();var o=s[0],n=s[1];if(!o)return;0<(r=this.indexOf(o))&&--r;var l=[this.getRow(r),n];this.setCurrentCell(l),this.beginEditCell();break;case 40:this.focus(),t.preventDefault();s=this._editingCell;this.commitEdit();var r,o=s[0],n=s[1];if(!o)return;(r=this.indexOf(o))<this.getData().length-1&&(r+=1);l=[this.getRow(r),n];this.setCurrentCell(l),this.beginEditCell()}}}},navEditMode:!1,setNavEditMode:function(t){this.navEditMode=t},getNavEditMode:function(){return this.navEditMode},editNextRowCell:!1,editNextOnEnterKey:!1,editOnTabKey:!0,createOnEnter:!1,skipReadOnlyCell:!1,setSkipReadOnlyCell:function(t){this.skipReadOnlyCell=t},getSkipReadOnlyCell:function(){return this.skipReadOnlyCell},isCellCanEdit:function(t,e){return this._OnCellBeginEdit(t,e,this.getCellEditor(e),!1)},_beginEditNextCell:function(t,e){var i=new Date;if(!(this._editTimestamp&&i-this._editTimestamp<80)){this._editTimestamp=i;var n=this;if(c=this.getCurrentCell()){this.focus();var s,o,l,r=n.getVisibleColumns(),a=c?c[1]:null,h=c?c[0]:null,d=r.indexOf(a),u=(s=h,n.getVisibleRows().indexOf(s)),i=n.getVisibleRows().length;!1===t?this.skipReadOnlyCell?(o=this,f()&&0!=d||(d=r.length,f(),p())):(a=r[--d])||(a=r[r.length-1],p()):this.editNextRowCell&&!e?u+1<i&&(h=m(u+1)):this.skipReadOnlyCell?(o=this,l=r.length,_()&&d+1!=l||(d=0,_(),g())):(a=r[d+=1])||(a=r[0],g());var c=[h,a];if(n.setCurrentCell(c),!n.onlyCheckSelection&&n.allowRowSelect&&n.getCurrent()!=h&&(n.deselectAll(),n.setCurrent(h)),n.scrollIntoView(h,a,!1),n.isReadOnly()||a.readOnly)return!1;n.beginEditCell()}}function m(t){return n.getVisibleRows()[t]}function f(){for(var t=d-1==0?r.length:d-1;0<t;t--)if(a=r[t],o.isCellCanEdit(h,a))return a}function p(){h=m(u-1)}function g(){(h=n.getAt(u+1))||n.createOnEnter&&(h={},n.addRow(h))}function _(){for(var t=d+1==l?0:d+1;t<l;t++)if(a=r[t],o.isCellCanEdit(h,a))return a}},getEditorOwnerRow:function(t){t=t.ownerRowID;return this.getRowByUID(t)},beginEditRow:function(t){this.allowCellEdit||this._pushUpdateCallback(function(t){if(new Date,(t=this.getRow(t))&&(e=this._getRowEl(t,2))){t._editing=!0,this._doUpdateRowEl(t);var e=this._getRowEl(t,2);mini.addClass(e,"mini-grid-rowEdit");for(var i=this.getVisibleColumns(),n=0,s=i.length;n<s;n++){var o,l=i[n],r=(t[l.field],this._getCellEl(t,l));r&&("string"==typeof l.editor&&(l.editor=window.eval("("+l.editor+")")),(o=mini.copyTo({},l.editor)).id=this.uid+"$"+t._uid+"$"+l._id+"$editor",o=mini.create(o),this._OnCellBeginEdit(t,l,o)&&o&&(mini.addClass(r,"mini-grid-cellEdit"),r.innerHTML="",r.appendChild(o.el),mini.addClass(o.el,"mini-grid-editor")))}this.doLayout()}},this,[t])},cancelEditRow:function(t){if(!this.allowCellEdit&&(t=this.getRow(t))&&t._editing){delete t._editing;this._getRowEl(t);for(var e=this.getVisibleColumns(),i=0,n=e.length;i<n;i++){e[i];var s=this._createCellId(t,e[i]),s=document.getElementById(s);s&&(s=s.firstChild,(s=mini.get(s))&&s.destroy())}this._doUpdateRowEl(t),this.doLayout()}},commitEditRow:function(t){var e;this.allowCellEdit||(t=this.getRow(t))&&t._editing&&(e=this.getEditRowData(t,!1,!1),this._canUpdateRowEl=!1,this.updateRow(t,e),this._canUpdateRowEl=!0,this.cancelEditRow(t))},isEditing:function(){for(var t=this.getDataView(),e=0,i=t.length;e<i;e++)if(1==t[e]._editing)return!0;return!1},isEditingRow:function(t){return!!(t=this.getRow(t))&&!!t._editing},isNewRow:function(t){return"added"==t._state},getEditingRows:function(){for(var t=[],e=this.getDataView(),i=0,n=e.length;i<n;i++){var s=e[i];1==s._editing&&t.push(s)}return t},getEditingRow:function(){return this.getEditingRows()[0]},getEditData:function(t){for(var e,i=[],n=this.getDataView(),s=0,o=n.length;s<o;s++)1==n[s]._editing&&(e=this.getEditRowData(s,t),i.push(e));return i},getEditRowData:function(t,e,i){if(!(t=this.getRow(t))||!t._editing)return null;for(var n=this.getIdField(),s=this.getParentField?this.getParentField():null,o={},l=this.getVisibleColumns(),r=0,a=l.length;r<a;r++){var h=l[r],d=this._createCellId(t,l[r]),u=document.getElementById(d);if(u){var c=null;if("checkboxcolumn"==h.type||"radiobuttoncolumn"==h.type)d=h.isChecked(t,h)?h.trueValue:h.falseValue,c=this._OnCellCommitEdit(t,h,d);else{u=u.firstChild,u=mini.get(u);if(!u)continue;c=this._OnCellCommitEdit(t,h,null,u)}!1!==i?(mini._setMap(h.field,c.value,o),h.displayField&&mini._setMap(h.displayField,c.text,o)):(o[h.field]=c.value,h.displayField&&(o[h.displayField]=c.text))}}return o[n]=t[n],s&&(o[s]=t[s]),e&&(e=mini.copyTo({},t),o=mini.copyTo(e,o)),o},collapseGroups:function(){if(this.isGrouping()){this._allowLayout=!1;for(var t=this.getGroupingView(),e=0,i=t.length;e<i;e++){var n=t[e];this.collapseRowGroup(n)}this._allowLayout=!0,this.doLayout()}},expandGroups:function(){if(this.isGrouping()){this._allowLayout=!1;for(var t=this.getGroupingView(),e=0,i=t.length;e<i;e++){var n=t[e];this.expandRowGroup(n)}this._allowLayout=!0,this.doLayout()}},toggleRowGroup:function(t){t.expanded?this.collapseRowGroup(t):this.expandRowGroup(t)},collapseRowGroup:function(t){var e,i,n;(t=this.getRowGroup(t))&&(t.expanded=!1,e=this._getRowGroupEl(t,1),i=this._getRowGroupRowsEl(t,1),n=this._getRowGroupEl(t,2),t=this._getRowGroupRowsEl(t,2),i&&(i.style.display="none"),t&&(t.style.display="none"),e&&mini.addClass(e,"mini-grid-group-collapse"),n&&mini.addClass(n,"mini-grid-group-collapse"),this.doLayout())},expandRowGroup:function(t){var e,i,n;(t=this.getRowGroup(t))&&(t.expanded=!0,e=this._getRowGroupEl(t,1),i=this._getRowGroupRowsEl(t,1),n=this._getRowGroupEl(t,2),t=this._getRowGroupRowsEl(t,2),i&&(i.style.display=""),t&&(t.style.display=""),e&&mini.removeClass(e,"mini-grid-group-collapse"),n&&mini.removeClass(n,"mini-grid-group-collapse"),this.doLayout())},showAllRowDetail:function(){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];this.showRowDetail(n)}this._allowLayout=!0,this.doLayout()},hideAllRowDetail:function(){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];this.hideRowDetail(n)}this._allowLayout=!0,this.doLayout()},isShowRowDetail:function(t){return!!(t="object"==typeof t?t:this.getRow(t))&&!!t._showDetail},toggleRowDetail:function(t){(t=this.getRow(t))&&(grid.isShowRowDetail(t)?grid.hideRowDetail(t):grid.showRowDetail(t))},showRowDetail:function(t){var e,i,n;(t=this.getRow(t))&&1!=t._showDetail&&(t._showDetail=!0,e=this._getRowDetailEl(t,1,!0),i=this._getRowDetailEl(t,2,!0),e&&(e.style.display=""),i&&(i.style.display=""),e=this._getRowEl(t,1),i=this._getRowEl(t,2),e&&mini.addClass(e,"mini-grid-expandRow"),i&&mini.addClass(i,"mini-grid-expandRow"),this.fire("showrowdetail",{record:t}),(n=this).isFrozen()&&setTimeout(function(){n.syncRowDetail(t)},1),this.doLayout())},hideRowDetail:function(t){var e,i;(t=this.getRow(t))&&!0===t._showDetail&&(t._showDetail=!1,e=this._getRowDetailEl(t,1),i=this._getRowDetailEl(t,2),e&&(e.style.display="none"),i&&(i.style.display="none"),e=this._getRowEl(t,1),i=this._getRowEl(t,2),e&&mini.removeClass(e,"mini-grid-expandRow"),i&&mini.removeClass(i,"mini-grid-expandRow"),this.fire("hiderowdetail",{record:t}),this.doLayout())},_getRowDetailEl:function(t,e,i){if(!(t=this.getRow(t)))return null;var n=this._createRowDetailId(t,e),n=document.getElementById(n);return n=!n&&!0===i?this._createRowDetail(t,e):n},_createRowDetail:function(t,e){var i=this.getFrozenColumns(),n=this.getUnFrozenColumns(),i=i.length;2==e&&(i=n.length);n=this._getRowEl(t,e);if(!n)return null;e=this._createRowDetailId(t,e),i='<tr id="'+e+'" class="mini-grid-detailRow"><td style="width:0"></td><td class="mini-grid-detailCell" colspan="'+i+'"></td></tr>';return jQuery(n).after(i),document.getElementById(e)},_createRowDetailId:function(t,e){return this._id+"$detail"+e+"$"+t._id},getRowDetailCellEl:function(t,e){e=this._getRowDetailEl(t,e=e||2);if(e)return e.cells[1]},autoHideRowDetail:!0,setAutoHideRowDetail:function(t){this.autoHideRowDetail=t},getAutoHideRowDetail:function(){return this.autoHideRowDetail},mergeColumns:function(t){t&&0==mini.isArray(t)&&(t=[t]);var d=this.getVisibleColumns();t=t||d;var u=this.getDataView();u.push({});for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];(s=this.getColumn(s))&&(s=function(t){if(t.field){for(var e=[],i=-1,n=1,s=d.indexOf(t),o=null,l=0,r=u.length;l<r;l++){var a=u[l],h=mini._getMap(t.field,a);-1!=i&&mini.isEquals(h,o)?n++:(1<n&&(a={rowIndex:i,columnIndex:s,rowSpan:n,colSpan:1},e.push(a)),i=l,n=1,o=h)}return e}}(s),e.addRange(s))}this.mergeCells(e)},mergeCells:function(t){if(mini.isArray(t)){this._mergedCells=t;var h=this._mergedCellMaps={};if(t=this._mergedCells)for(var e=0,i=t.length;e<i;e++){var n=t[e];n.rowSpan||(n.rowSpan=1),n.colSpan||(n.colSpan=1),function(t,e,i,n,s){for(var o=t,l=t+i;o<l;o++)for(var r=e,a=e+n;r<a;r++)h[o+":"+r]=o!=t||r!=e||s}(n.rowIndex,n.columnIndex,n.rowSpan,n.colSpan,n)}this.doUpdate()}},margeCells:function(t){this.mergeCells(t)},_isCellVisible:function(t,e){return!this._mergedCellMaps||!(!0===this._mergedCellMaps[t+":"+e])},_getAnchorCell:function(t,e){if(!this._mergedCellMaps)return null;t=this.indexOf(t),e=this.getBottomColumns().indexOf(e);return this._mergedCellMaps[t+":"+e]},_getCellEls:function(t,e,i,n){var s=[];if(!mini.isNumber(t))return[];if(!mini.isNumber(e))return[];this.getVisibleColumns(),this.getDataView();for(var o=t,l=t+i;o<l;o++)for(var r=e,a=e+n;r<a;r++){var h=this._getCellEl(o,r);h&&s.push(h)}return s},_getDragData:function(){var t=this.getSelecteds().clone(),i=this;return mini.sort(t,function(t,e){t=i.indexOf(t),e=i.indexOf(e);return e<t?1:t<e?-1:0},this),t},_getDragText:function(t){return"Records "+t.length},allowDrag:!1,allowDrop:!1,allowLeafDropIn:!1,setAllowLeafDropIn:function(t){this.allowLeafDropIn=t},getAllowLeafDropIn:function(){return this.allowLeafDropIn},setAllowDrag:function(t){this.allowDrag=t},getAllowDrag:function(){return this.allowDrag},setAllowDrop:function(t){this.allowDrop=t},getAllowDrop:function(){return this.allowDrop},isAllowDrag:function(t,e){return!this.isReadOnly()&&0!=this.enabled&&(!(!this.allowDrag||!e.allowDrag)&&!1!==t.allowDrag)},_OnDragStart:function(t,e){e={node:t,nodes:this._getDragData(),column:e,cancel:!1};return e.record=e.node,e.records=e.nodes,e.dragText=this._getDragText(e.nodes),this.fire("dragstart",e),e},_OnGiveFeedback:function(t,e,i,n){var s={};return s.from=n,s.effect=t,s.nodes=e,s.node=s.nodes[0],s.targetNode=i,s.dragNodes=e,s.dragNode=s.dragNodes[0],s.dropNode=s.targetNode,s.dragAction=s.action,this.fire("givefeedback",s),s},_OnDragDrop:function(t,e,i){i={dragNodes:t=t.clone(),targetNode:e,action:i,cancel:!1};return i.dragNode=i.dragNodes[0],i.dropNode=i.targetNode,i.dragAction=i.action,this.fire("beforedrop",i),this.fire("dragdrop",i),i},moveUp:function(t){if(mini.isArray(t))for(var i=this,e=0,n=(t=t.sort(function(t,e){t=i.indexOf(t);return i.indexOf(e)<t?1:-1})).length;e<n;e++){var s=t[e],o=this.indexOf(s);this.moveRow(s,o-1)}},moveDown:function(t){if(mini.isArray(t)){var i=this;(t=t.sort(function(t,e){t=i.indexOf(t);return i.indexOf(e)<t?1:-1})).reverse();for(var e=0,n=t.length;e<n;e++){var s=t[e],o=this.indexOf(s);this.moveRow(s,o+2)}}},pageSize:20,pageIndex:0,totalCount:0,totalPage:0,sortField:"",sortOrder:"",url:"",setAjaxAsync:function(t){this._dataSource.ajaxAsync=t,this.ajaxAsync=t},getAjaxAsync:function(){return this._dataSource.ajaxAsync},setAjaxMethod:function(t){this._dataSource.ajaxMethod=t,this.ajaxMethod=t},getAjaxMethod:function(){return this._dataSource.ajaxMethod},setAjaxType:function(t){this._dataSource.ajaxType=t,this.ajaxType=t},getAjaxType:function(){return this._dataSource.ajaxType},setAjaxOptions:function(t){this._dataSource.setAjaxOptions(t)},getAjaxOptions:function(){return this._dataSource.getAjaxOptions()},setAutoLoad:function(t){this._dataSource.setAutoLoad(t)},getAutoLoad:function(){return this._dataSource.getAutoLoad()},setUrl:function(t){this._dataSource.setUrl(t),this.url=t},getUrl:function(){return this._dataSource.getUrl()},load:function(t,e,i,n){this._dataSource.load(t,e,i,n)},reload:function(t,e,i){this.accept(),this._dataSource.reload(t,e,i)},gotoPage:function(t,e){this._dataSource.gotoPage(t,e)},sortBy:function(t,e){if(!t)return null;var i=this._dataSource;this.sortField=i.sortField=t,this.sortOrder=i.sortOrder=e,"server"==this._dataSource.sortMode?this._dataSource.sortBy(t,e):(i=this._columnModel._getDataTypeByField(t),this._dataSource._doClientSortField(t,e,i))},sortDblClick:!1,setSortDblClick:function(t){this.sortDblClick=t},getSortDblClick:function(){return this.sortDblClick},showCellTip:!0,setShowCellTip:function(t){this.showCellTip=t},getShowCellTip:function(){return this.showCellTip},setCheckSelectOnLoad:function(t){this._dataSource.setCheckSelectOnLoad(t),this.checkSelectOnLoad=t},getCheckSelectOnLoad:function(){return this._dataSource.getCheckSelectOnLoad()},setSelectOnLoad:function(t){this._dataSource.setSelectOnLoad(t),this.selectOnLoad=t},getSelectOnLoad:function(){return this._dataSource.getSelectOnLoad()},allowCancelSort:!1,setAllowCancelSort:function(t){this.allowCancelSort=t},getAllowCancelSort:function(){return this.allowCancelSort},setSortMode:function(t){this._dataSource.setSortMode(t),this.sortMode=t},getSortMode:function(){return this._dataSource.getSortMode()},setPageIndex:function(t){this._dataSource.setPageIndex(t),this.pageIndex=t},getPageIndex:function(){return this._dataSource.getPageIndex()},setPageSize:function(t){this._dataSource.setPageSize(t),this._virtualRows=t,this.pageSize=t},getPageSize:function(){return this._dataSource.getPageSize()},setTotalCount:function(t){this._dataSource.setTotalCount(t),this.totalCount=t},getTotalCount:function(){return this._dataSource.getTotalCount()},getTotalPage:function(){return this._dataSource.getTotalPage()},setSortField:function(t){this._dataSource.setSortField(t),this.sortField=t},getSortField:function(){return this._dataSource.sortField},setSortOrder:function(t){this._dataSource.setSortOrder(t),this.sortOrder=t},getSortOrder:function(){return this._dataSource.sortOrder},setPageIndexField:function(t){this._dataSource.pageIndexField=t,this.pageIndexField=t},getPageIndexField:function(){return this._dataSource.pageIndexField},setPageSizeField:function(t){this._dataSource.pageSizeField=t,this.pageSizeField=t},getPageSizeField:function(){return this._dataSource.pageSizeField},setStartField:function(t){this._dataSource.startField=t,this.startField=t},getStartField:function(){return this._dataSource.startField},setLimitField:function(t){this._dataSource.limitField=t,this.limitField=t},getLimitField:function(){return this._dataSource.limitField},setSortFieldField:function(t){this._dataSource.sortFieldField=t,this.sortFieldField=t},getSortFieldField:function(){return this._dataSource.sortFieldField},setSortOrderField:function(t){this._dataSource.sortOrderField=t,this.sortOrderField=t},getSortOrderField:function(){return this._dataSource.sortOrderField},setTotalField:function(t){this._dataSource.totalField=t,this.totalField=t},getTotalField:function(){return this._dataSource.totalField},setDataField:function(t){this._dataSource.dataField=t,this.dataField=t},getDataField:function(){return this._dataSource.dataField},setErrorField:function(t){this._dataSource.errorField=t,this.errorField=t},getErrorField:function(){return this._dataSource.errorField},setErrorMsgField:function(t){this._dataSource.errorMsgField=t,this.errorMsgField=t},getErrorMsgField:function(){return this._dataSource.errorMsgField},setStackTraceField:function(t){this._dataSource.stackTraceField=t,this.stackTraceField=t},getStackTraceField:function(){return this._dataSource.stackTraceField},setPageSizeWidth:function(t){this._bottomPager.setPageSizeWidth(t)},getPageSizeWidth:function(){return this._bottomPager.getPageSizeWidth()},getBottomPager:function(){return this._bottomPager},sizeText:"",setSizeText:function(t){this._bottomPager.sizeText=t},getSizeText:function(){return this.sizeText},showPagerButtonText:!1,setShowPagerButtonText:function(t){this._bottomPager.setShowButtonText(t)},getShowPagerButtonText:function(){return this.showPagerButtonText},showPagerButtonIcon:!1,setShowPagerButtonIcon:function(t){this._bottomPager.setShowButtonIcon(t)},getShowPagerButtonIcon:function(){return this.showPagerButtonIcon},setShowReloadButton:function(t){this._bottomPager.setShowReloadButton(t)},getShowReloadButton:function(){return this._bottomPager.getShowReloadButton()},setShowPageInfo:function(t){this._bottomPager.setShowPageInfo(t)},getShowPageInfo:function(){return this._bottomPager.getShowPageInfo()},setSizeList:function(t){mini.isArray(t)&&this._bottomPager.setSizeList(t)},getSizeList:function(){return this._bottomPager.getSizeList()},setShowPageSize:function(t){this._bottomPager.setShowPageSize(t)},getShowPageSize:function(){return this._bottomPager.getShowPageSize()},setShowPageIndex:function(t){this.showPageIndex=t,this._bottomPager.setShowPageIndex(t)},getShowPageIndex:function(){return this._bottomPager.getShowPageIndex()},setShowTotalCount:function(t){this._bottomPager.setShowTotalCount(t)},getShowTotalCount:function(){return this._bottomPager.getShowTotalCount()},setPagerStyle:function(t){this.pagerStyle=t,mini.setStyle(this._bottomPager.el,t)},setPagerCls:function(t){this.pagerCls=t,mini.addClass(this._bottomPager.el,t)},setDropAction:function(t){this.dropAction=t},getDropAction:function(){return this.dropAction},groupTitleCollapsible:!0,setGroupTitleCollapsible:function(t){this.groupTitleCollapsible=t},getGroupTitleCollapsible:function(){return this.groupTitleCollapsible},allowEmptyContextMenu:!1,setAllowEmptyContextMenu:function(t){this.allowEmptyContextMenu=t},getAllowEmptyContextMenu:function(){return this.allowEmptyContextMenu},_beforeOpenContentMenu:function(t,e){mini.isAncestor(this._bodyEl,e.htmlEvent.target)?t.fire("BeforeOpen",e):e.cancel=!0},__OnHtmlContextMenu:function(t){var e={popupEl:this.el,htmlEvent:t,cancel:!1};if(mini.isAncestor(this._columnsEl,t.target)){if(this.headerContextMenu){if(this.headerContextMenu.fire("BeforeOpen",e),1==e.cancel)return;if(this.headerContextMenu.fire("opening",e),1==e.cancel)return;this.headerContextMenu.showAtPos(t.pageX,t.pageY),this.headerContextMenu.fire("Open",e)}}else{var i=mini.findParent(t.target,"mini-grid-detailRow");if(i&&mini.isAncestor(this.el,i))return;if(!mini.findParent(t.target,"mini-tree-nodeshow")&&"tree"==this.type&&!this.allowEmptyContextMenu)return;if(!this.allowEmptyContextMenu&&!mini.findParent(t.target,"mini-grid-table"))return;if(mini.findParent(t.target,"mini-grid-filterRow"))return;if(mini.findParent(t.target,"mini-grid-summaryRow"))return;if(this.contextMenu){if(this._beforeOpenContentMenu(this.contextMenu,e),1==e.cancel)return;if(this.contextMenu.fire("opening",e),1==e.cancel)return;this.contextMenu.showAtPos(t.pageX,t.pageY),this.contextMenu.fire("Open",e)}}return!1},headerContextMenu:null,setHeaderContextMenu:function(t){t=this._getContextMenu(t);t&&this.headerContextMenu!==t&&(this.headerContextMenu=t,mini.addClass(t.el,"mini-menu-open"),this.headerContextMenu.owner=this,mini.on(this.el,"contextmenu",this.__OnHtmlContextMenu,this))},getHeaderContextMenu:function(){return this.headerContextMenu},selectOnRightClick:!0,setSelectOnRightClick:function(t){this.selectOnRightClick=t},getSelectOnRightClick:function(){return this.selectOnRightClick},_get_originals:function(){return this._dataSource._originals},_set_originals:function(t){this._dataSource._originals=t},_set_clearOriginals:function(t){this._dataSource._clearOriginals=t},_set_originalIdField:function(t){this._dataSource._originalIdField=t},_set_autoCreateNewID:function(t){this._dataSource._autoCreateNewID=t},getAttrs:function(t){for(var e=mini.DataGrid.superclass.getAttrs.call(this,t),i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],l=mini.getAttr(o,"property");l&&("columns"==(l=l.toLowerCase())?(e.columns=mini._ParseColumns(o),mini.removeNode(o)):"data"==l&&(e.data=o.innerHTML,mini.removeNode(o)))}return mini._ParseString(t,e,["oncelleditenter","onselect","ondeselect","onbeforeselect","onbeforedeselect","url","sizeList","bodyCls","bodyStyle","footerCls","footerStyle","pagerCls","pagerStyle","onheadercellclick","onheadercellmousedown","onheadercellcontextmenu","onrowdblclick","onrowclick","onrowmousedown","onrowcontextmenu","onrowmouseenter","onrowmouseleave","oncellclick","oncellmousedown","oncellcontextmenu","oncelldblclick","onbeforeload","onpreload","onloaderror","onload","onupdate","ondrawcell","oncellbeginedit","onselectionchanged","ondrawgroup","onbeforeshowrowdetail","onbeforehiderowdetail","onshowrowdetail","onhiderowdetail","idField","valueField","pager","oncellcommitedit","oncellendedit","headerContextMenu","loadingMsg","emptyText","cellEditAction","sortMode","oncellvalidation","onsort","ondrawsummarycell","ondrawgroupsummarycell","onresize","oncolumnschanged","ajaxMethod","ajaxOptions","onaddrow","onupdaterow","onremoverow","onmoverow","onbeforeaddrow","onbeforeupdaterow","onbeforeremoverow","onbeforemoverow","pageIndexField","pageSizeField","sortFieldField","sortOrderField","startField","limitField","totalField","dataField","sortField","sortOrder","stackTraceField","errorField","errorMsgField","pagerButtons","onbeforegroupclick","dropAction","sizeText","pagerType","viewType","itemRenderer","summaryPosition"]),mini._ParseBool(t,e,["showColumns","showFilterRow","showSummaryRow","showPager","showFooter","enableGroupOrder","validateOnAdd","showHGridLines","showVGridLines","showSortIcon","allowSortColumn","allowMoveColumn","allowResizeColumn","fitColumns","showLoading","multiSelect","allowAlternating","resultAsData","allowRowSelect","allowUnselect","onlyCheckSelection","allowHotTrackOut","enableHotTrack","showPageIndex","showPageSize","showTotalCount","checkSelectOnLoad","allowResize","autoLoad","autoHideRowDetail","allowCellSelect","allowCellEdit","allowCellWrap","allowHeaderWrap","selectOnLoad","virtualScroll","virtualColumns","collapseGroupOnLoad","showGroupSummary","showEmptyText","alwaysShowEmptyText","allowCellValid","showModified","showColumnsMenu","showPageInfo","showReloadButton","showNewRow","editNextOnEnterKey","createOnEnter","skipReadOnlyCell","ajaxAsync","allowDrag","allowDrop","allowLeafDropIn","editNextRowCell","fixedRowHeight","showCellTip","showPagerButtonText","showPagerButtonIcon","groupTitleCollapsible","navEditMode","selectOnRightClick","sortDblClick","allowEmptyContextMenu","showGroupSummary","allowCancelSort"]),mini._ParseInt(t,e,["frozenStartColumn","frozenEndColumn","pageSizeWidth","pageIndex","pageSize","defaultRowHeight","defaultColumnWidth","wheelIncrement","summaryRows"]),"string"==typeof e.ajaxOptions&&(e.ajaxOptions=window.eval("("+e.ajaxOptions+")")),"string"==typeof e.sizeList&&(e.sizeList=window.eval("("+e.sizeList+")")),!e.idField&&e.valueField&&(e.idField=e.valueField),e.pagerButtons&&(e.pagerButtons=mini.byId(e.pagerButtons)),e.itemRenderer&&(e.itemRenderer=window[e.itemRenderer]),e}}),mini.regClass(mini.DataGrid,"datagrid"),mini_DataGrid_CellValidator_Prototype={getCellErrors:function(){for(var t=this._cellErrors.clone(),e=this._dataSource,i=0,n=t.length;i<n;i++){var s,o=t[i],l=o.record;e.getby_id(l._id)||(s=o.column,s=l[this._rowIdField]+"$"+s._id,delete this._cellMapErrors[s],this._cellErrors.remove(o))}return this._cellErrors},getCellError:function(t,e){if(t=this.getNode?this.getNode(t):this.getRow(t),e=this.getColumn(e),t&&e){e=t[this._rowIdField]+"$"+e._id;return this._cellMapErrors?this._cellMapErrors[e]:null}},isValid:function(){return 0==this.getCellErrors().length},isCellValid:function(t,e){if(!this._cellMapErrors)return!0;e=t[this._rowIdField]+"$"+e._id;return!this._cellMapErrors[e]},validate:function(t){t=t||this.getDataView();for(var e=0,i=(t=!mini.isArray(t)?[]:t).length;e<i;e++){var n=t[e];this.validateRow(n)}},validateRow:function(t){for(var e=this.getBottomColumns(),i=0,n=e.length;i<n;i++){var s=e[i];this.validateCell(t,s)}},validateCell:function(t,e){if(t=this.getNode?this.getNode(t):this.getRow(t),e=this.getColumn(e),t&&e&&0!=e.visible){var i=mini._getMap(e.field,t),n={record:t,row:t,node:t,column:e,field:e.field,value:i,isValid:!0,errorText:""};if(e.vtype&&mini._ValidateVType(e.vtype,n.value,n,e),1==n.isValid&&e.unique&&e.field)for(var s={},o=this.data,l=e.field,r=0,a=o.length;r<a;r++){var h=o[r],d=h[l];if(!mini.isNull(d)&&""!==String(d).trim()){var u=s[d];if(u&&h==t){n.isValid=!1,n.errorText=mini._getErrorText(e,"uniqueErrorText"),this.setCellIsValid(u,e,n.isValid,n.errorText);break}s[d]=h}}this.fire("cellvalidation",n),this.setCellIsValid(t,e,n.isValid,n.errorText)}},setIsValid:function(t){if(t)for(var e=this._cellErrors.clone(),i=0,n=e.length;i<n;i++){var s=e[i];this.setCellIsValid(s.record,s.column,!0)}},_removeRowError:function(t){for(var e=this.getColumns(),i=0,n=e.length;i<n;i++){var s=e[i],o=t[this._rowIdField]+"$"+s._id,s=this._cellMapErrors[o];s&&(delete this._cellMapErrors[o],this._cellErrors.remove(s))}},setCellIsValid:function(t,e,i,n){var s,o,l;t=this.getRow(t),e=this.getColumn(e),t&&e&&(s=t[this._rowIdField]+"$"+e._id,o=this._getCellEl(t,e),l=this._cellMapErrors[s],delete this._cellMapErrors[s],this._cellErrors.remove(l),!0===i?o&&l&&mini.removeClass(o,"mini-grid-cell-error"):(this._cellMapErrors[s]=l={record:t,column:e,isValid:i,errorText:n},this._cellErrors.add(l),o&&mini.addClass(o,"mini-grid-cell-error")))}},mini.copyTo(mini.DataGrid.prototype,mini_DataGrid_CellValidator_Prototype),mini.TreeGrid=function(){mini.TreeGrid.superclass.constructor.apply(this,arguments),mini.addClass(this.el,"mini-tree"),this.setAjaxAsync(!1),this.setAutoLoad(!0),1==this.showTreeLines&&mini.addClass(this.el,"mini-tree-treeLine"),this._AsyncLoader=new mini._Tree_AsyncLoader(this),this._Expander=new mini._Tree_Expander(this),this.setShowArrow(this.showArrow)},mini.copyTo(mini.TreeGrid.prototype,mini._DataTreeApplys),mini.extend(mini.TreeGrid,mini.DataGrid,{isTree:!0,uiCls:"mini-treegrid",showPager:!1,showNewRow:!1,showCheckBox:!1,showRadioButton:!1,showTreeIcon:!0,showExpandButtons:!0,showTreeLines:!1,showArrow:!1,expandOnDblClick:!0,expandOnNodeClick:!1,loadOnExpand:!0,_checkBoxType:"checkbox",iconField:"iconCls",_treeColumn:null,leafIconCls:"mini-tree-leaf",folderIconCls:"mini-tree-folder",fixedRowHeight:!1,_checkBoxCls:"mini-tree-checkbox",_expandNodeCls:"mini-tree-expand",_collapseNodeCls:"mini-tree-collapse",_eciconCls:"mini-tree-node-ecicon",_inNodeCls:"mini-tree-nodeshow",isEditingNode:function(t){return this._editingNode==t},indexOf:function(t){return this._dataSource.indexOfList(t)},_getDragText:function(t){return"Nodes "+t.length},_initEvents:function(){mini.TreeGrid.superclass._initEvents.call(this),this.on("nodedblclick",this.__OnNodeDblClick,this),this.on("nodeclick",this.__OnNodeClick,this),this.on("cellclick",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodeclick",t)},this),this.on("cellmousedown",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodemousedown",t)},this),this.on("celldblclick",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodedblclick",t)},this),this.on("beforerowselect",function(t){t.node=t.selected,t.isLeaf=this.isLeaf(t.node),this.fire("beforenodeselect",t)},this),this.on("rowselect",function(t){t.node=t.selected,t.isLeaf=this.isLeaf(t.node),this.fire("nodeselect",t)},this)},setValue:function(t,e){var i;mini.isNull(t)&&(t=""),t=String(t),this.getValue()!=t&&(i=this.getCheckedNodes(),this.uncheckNodes(i,this.checkRecursive),this.value=t,this.showCheckBox?(i=String(t).split(","),this._dataSource.doCheckNodes(i,!0,!1!==e)):this.selectNode(t,!1))},getValue:function(t){return this.showCheckBox?this._dataSource.getCheckedNodesId(t=!1===t?"leaf":t):this._dataSource.getSelectedsId()},getText:function(){var t=[];this.showCheckBox?t=this.getCheckedNodes():(o=this.getSelectedNode())&&t.push(o);for(var e=[],i=this.getTextField(),n=0,s=t.length;n<s;n++){var o=t[n];e.push(o[i])}return e.join(",")},isGrouping:function(){return!1},_createSource:function(){this._dataSource=new mini.DataTree},_bindSource:function(){mini.TreeGrid.superclass._bindSource.call(this);var t=this._dataSource;t.on("expand",this.__OnTreeExpand,this),t.on("collapse",this.__OnTreeCollapse,this),t.on("_checkchanged",this.__OnCheckChanged,this),t.on("addnode",this.__OnSourceAddNode,this),t.on("removenode",this.__OnSourceRemoveNode,this),t.on("movenode",this.__OnSourceMoveNode,this),t.on("beforeloadnode",this.__OnBeforeLoadNode,this),t.on("loadnode",this.__OnLoadNode,this)},__OnBeforeLoadNode:function(t){this.__showLoading=this.showLoading,this.showLoading=!1,this.addNodeCls(t.node,"mini-tree-loading"),this.fire("beforeloadnode",t)},__OnLoadNode:function(t){this.showLoading=this.__showLoading,this.removeNodeCls(t.node,"mini-tree-loading"),this.fire("loadnode",t)},_virtualUpdate:function(){var t=this;t._updateNodeTimer&&(clearTimeout(t._updateNodeTimer),t._updateNodeTimer=null),t._updateNodeTimer=setTimeout(function(){t._updateNodeTimer=null,t.doUpdateRows(),t.deferLayout(50)},5)},__OnSourceAddNode:function(t){var e=this._dataSource.isVisibleNode(t.node);1==this.isVirtualScroll()?this._virtualUpdate():e?this._doAddNodeEl(t.node):(e=this.getParentNode(t.node),this._dataSource.isVisibleNode(e)&&this._doUpdateTreeNodeEl(e)),this.fire("addnode",t)},__OnSourceRemoveNode:function(t){var e,i;1==this.isVirtualScroll()?this._virtualUpdate():(this._doRemoveNodeEl(t.node),i=this.getParentNode(t.node),0==(e=this.getChildNodes(i)).length?this._doUpdateTreeNodeEl(i):1<(i=t.index)&&i==e.length&&this._doUpdateTreeNodeEl(e[e.length-1])),this.fire("removenode",t)},__OnSourceMoveNode:function(t){this._doMoveNodeEl(t.node),this.fire("movenode",t);var e=t.oldParentNode;e!=t.parentNode&&(!(e=this.getChildNodes(e))||(e=e[e.length-1])&&this._doUpdateTreeNodeEl(e))},_doAddNodeEl:function(t){var e=this.getFrozenColumns(),i=this.getUnFrozenColumns(),n=this.getParentNode(t),s=this.indexOf(t),o=!1;function l(t,e,i){e=this._createRowHTML(t,s,e,i),t=this.indexOfNode(t)+1,t=this.getChildNodeAt(t,n);t?(t=this._getNodeEl(t,i),jQuery(t).before(e)):(i=this._getNodesEl(n,i))?mini.append(i.firstChild,e):o=!0}l.call(this,t,i,2),l.call(this,t,e,1),o&&this._doUpdateTreeNodeEl(n)},_doRemoveNodeEl:function(t){this._doRemoveRowEl(t);var e=this._getNodesEl(t,1),t=this._getNodesEl(t,2);e&&e.parentNode.removeChild(e),t&&t.parentNode.removeChild(t)},_doMoveNodeEl:function(t){1==this.isVirtualScroll()?this._virtualUpdate():(this._doRemoveNodeEl(t),t=this.getParentNode(t),this._doUpdateTreeNodeEl(t))},_doUpdateNodeTitle:function(t){this._doUpdateTreeNodeEl(t,!1)},_doUpdateTreeNodeEl:function(t,e){var i,n,s,o,l,r,a,h,d,u;e=!1!==e,this.getRootNode()!=t?this.isVisibleNode(t)&&(i=t,h=this.getFrozenColumns(),d=this.getUnFrozenColumns(),u=this._createNodeHTML(t,h,1,null,e),n=this._createNodeHTML(t,d,2,null,e),s=this._getNodeEl(t,1),o=this._getNodeEl(t,2),l=this._getNodesTr(t,1),r=this._getNodesTr(t,2),a=this._getRowDetailEl(t,1),h=this._getRowDetailEl(t,2),t=(d=mini.createElements(u))[0],u=d[1],s&&(mini.before(s,t),e&&(a?mini.after(a,u):mini.before(s,u)),mini.removeNode(s),e&&mini.removeNode(l)),t=(d=mini.createElements(n))[0],u=d[1],o&&(mini.before(o,t),e&&(h?mini.after(h,u):mini.before(o,u)),mini.removeNode(o),e&&mini.removeNode(r)),1==t.checked||this.isLeaf(t)||this._doCheckNodeEl(i)):this.doUpdate()},addNodeCls:function(t,e){this.addRowCls(t,e)},removeNodeCls:function(t,e){this.removeRowCls(t,e)},doUpdate:function(){mini.TreeGrid.superclass.doUpdate.apply(this,arguments)},setData:function(t){this._dataSource.setData(t=t||[])},loadList:function(t,e,i){e=e||this.getIdField(),i=i||this.getParentField();i=mini.listToTree(t,this.getNodesField(),e,i);this.setData(i)},_createDrawCellEvent:function(t,e,i,n){n=mini.TreeGrid.superclass._createDrawCellEvent.call(this,t,e,i,n);return n.node=n.record,n.isLeaf=this.isLeaf(n.node),this._treeColumn&&this._treeColumn==e.name&&(n.isTreeCell=!0,n.img=t[this.imgField],n.iconCls=this._getNodeIcon(t),n.nodeCls="",n.nodeStyle="",n.nodeHtml="",n.showTreeIcon=this.showTreeIcon,n.checkBoxType=this._checkBoxType,n.showCheckBox=this.showCheckBox,n.showRadioButton=this.showRadioButton,n.showCheckBox&&!n.isLeaf&&(n.showCheckBox=this.showFolderCheckBox),n.showRadioButton&&!n.isLeaf&&(n.showRadioButton=this.showFolderCheckBox),n.enabled=!1!==n.node.enabled,n.checkable=this.getCheckable(n.node)),n},_OnDrawCell:function(t,e,i,n){n=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);return this._treeColumn&&this._treeColumn==e.name&&(this.fire("drawnode",n),n.nodeStyle&&(n.cellStyle=n.nodeStyle),n.nodeCls&&(n.cellCls=n.nodeCls),n.nodeHtml&&(n.cellHtml=n.nodeHtml),this._createTreeColumn(n)),n},_isViewFirstNode:function(t){if(this._viewNodes){var e=this.getParentNode(t);return this._getViewChildNodes(e)[0]===t}return this.isFirstNode(t)},_isViewLastNode:function(t){if(this._viewNodes){var e=this.getParentNode(t),e=this._getViewChildNodes(e);return e[e.length-1]===t}return this.isLastNode(t)},_isInViewLastNode:function(t,e){if(this._viewNodes){for(var i=null,n=this.getAncestors(t),s=0,o=n.length;s<o;s++){var l=n[s];this.getLevel(l)==e&&(i=l)}return i&&i!=this.root?this._isViewLastNode(i):!1}return this.isInLastNode(t,e)},isInLastNode:function(t,e){for(var i=null,n=this.getAncestors(t),s=0,o=n.length;s<o;s++){var l=n[s];this.getLevel(l)==e&&(i=l)}return!(!i||i==this.root)&&this.isLastNode(i)},_createNodeTitle:function(t,e,i){var n=!e;e=e||[];var s=this.isLeaf(t),o=this.getLevel(t),l=i.nodeCls;s||(l=this.isExpandedNode(t)?this._expandNodeCls:this._collapseNodeCls),!1===t.enabled&&(l+=" mini-disabled"),s||(l+=" mini-tree-parentNode");var r=this.getChildNodes(t);r&&r.length;e[e.length]='<div class="mini-tree-nodetitle '+l+'" >';for(var a,r=this.getParentNode(t),h=0;h<=o;h++)h!=o&&(s&&o-1<h||(a="",this._isInViewLastNode(t,h)&&(a="background:none"),e[e.length]='<span class="mini-tree-indent " style="'+a+'"></span>'));var d,u,l="";if(this._isViewFirstNode(t)&&0==o?l="mini-tree-node-ecicon-first":this._isViewLastNode(t)&&(l="mini-tree-node-ecicon-last"),this._isViewFirstNode(t)&&this._isViewLastNode(t)&&(l="mini-tree-node-ecicon-firstAndlast",r==this.root&&(l="mini-tree-node-ecicon-firstLast")),e[e.length]=s?'<span class="'+this._eciconCls+" "+l+'" style="'+(this.showExpandButtons?"":"display:none")+'"></span>':'<a class="'+this._eciconCls+" "+l+'" style="'+(this.showExpandButtons?"":"display:none")+'" '+(mini.isChrome?"":'href="javascript:void(0);"')+' onclick="return false;" hidefocus></a>',e[e.length]='<span class="mini-tree-nodeshow mini-corner-all">',i.showTreeIcon&&(i.img?(l=this.imgPath+i.img,e[e.length]='<span class="mini-tree-icon mini-icon mini-iconfont" style="background-image:url('+l+');"></span>'):e[e.length]='<span class="'+i.iconCls+' mini-tree-icon mini-icon mini-iconfont"></span>'),i.showRadioButton&&!i.showCheckBox&&(e[e.length]='<span class="mini-tree-radio mini-icon" ></span>'),i.showCheckBox&&(d=this._createCheckNodeId(t),u=this.isCheckedNode(t),i.enabled,!1!==i.enabled&&i.checkable,e[e.length]='<span id="'+d+'" class="mini-icon '+this._checkBoxCls+" "+(u?"mini-tree-checkbox-checked":"")+'"></span>'),e[e.length]='<span class="mini-tree-nodetext">',this._editingNode==t?(d=this._id+"$edit$"+t._id,u=i.value,e[e.length]='<input id="'+d+'" type="text" class="mini-tree-editinput" value="'+u+'"/>'):e[e.length]=i.cellHtml,e[e.length]="</span>",e[e.length]="</span>",e[e.length]="</div>",n)return e.join("")},_createCheckNodeId:function(t){return this._id+"$checkbox$"+t._id},_createTreeColumn:function(t){var e=t.record;t.column;t.headerCls+=" mini-tree-treecolumn",t.cellCls+=" mini-tree-treecell",t.cellStyle+=";padding:0;";var i=this.isLeaf(e);t.cellHtml=this._createNodeTitle(e,null,t),1==e.checked||i||t.showCheckBox&&this._renderCheckState(e)},_renderCheckState:function(t){var n;this._renderCheckStateNodes||(this._renderCheckStateNodes=[]),this._renderCheckStateNodes.push(t),this._renderCheckStateTimer||((n=this)._renderCheckStateTimer=setTimeout(function(){n._renderCheckStateTimer=null;var t=n._renderCheckStateNodes;n._renderCheckStateNodes=null;for(var e=0,i=t.length;e<i;e++)n._doCheckNodeEl(t[e])},1))},_createNodeHTML:function(t,e,i,n,s){var o=!n;n=n||[];var l=this._dataSource,r=l.getDataView().indexOf(t);if(this._createRowHTML(t,r,e,i,n),!1!==s&&(r=l.getChildNodes(t),s=this.isVisibleNode(t),r&&0<r.length&&(1==(l=this.isExpandedNode(t))&&(s=l&&s?"":"display:none",t=this._createNodesId(t,i),n[n.length]='<tr class="mini-tree-nodes-tr" style="',mini.isIE&&(n[n.length]=s),n[n.length]='" ><td class="mini-tree-nodes-td" colspan="',n[n.length]=e.length+1,n[n.length]='" >',n[n.length]='<div class="mini-tree-nodes" id="',n[n.length]=t,n[n.length]='" style="',n[n.length]=s,n[n.length]='">',this._createNodesHTML(r,e,i,n),n[n.length]="</div>",n[n.length]="</td></tr>"))),o)return n.join("")},_createNodesHTML:function(t,e,i,n){if(!t)return"";var s=!n;if((n=n||[]).push('<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'),n.push(this._createTopRowHTML(e,!0)),0<e.length)for(var o=0,l=t.length;o<l;o++){var r=t[o];this._createNodeHTML(r,e,i,n)}return n.push("</table>"),s?n.join(""):void 0},_createRowsHTML:function(t,e){if(this.isVirtualScroll())return mini.TreeGrid.superclass._createRowsHTML.apply(this,arguments);var i=this._dataSource,n=[],s=[],o=i.getRootNode();return!0!==this._useEmptyView&&(s=i.getChildNodes(o)),(2==e?this._rowsViewEl:this._rowsLockEl).firstChild.id=this._createNodesId(o,e),this._createNodesHTML(s,t,e,n),n.join("")},_createNodesId:function(t,e){return this._id+"$nodes"+e+"$"+t._id},_getNodeEl:function(t,e){return this._getRowEl(t,e)},_getNodesEl:function(t,e){t=this.getNode(t);e=this._createNodesId(t,e);return document.getElementById(e)},_getNodesTr:function(t,e){e=this._getNodesEl(t,e);if(e)return e.parentNode.parentNode},checkOnTextClick:!1,setCheckOnTextClick:function(t){this.checkOnTextClick=t},getCheckOnTextClick:function(){return this.checkOnTextClick},setTreeColumn:function(t){this._treeColumn=t,this.deferUpdate()},getTreeColumn:function(){return this._treeColumn},setShowTreeIcon:function(t){this.showTreeIcon=t,this.deferUpdate()},getShowTreeIcon:function(){return this.showTreeIcon},setShowCheckBox:function(t){this.showCheckBox=t,this.deferUpdate()},getShowCheckBox:function(){return this.showCheckBox},setShowRadioButton:function(t){this.showRadioButton=t,this.deferUpdate()},getShowRadioButton:function(){return this.showRadioButton},setCheckBoxType:function(t){this._checkBoxType=t,this._doUpdateCheckState()},getCheckBoxType:function(){return this._checkBoxType},setIconsField:function(t){this._iconsField=t},getIconsField:function(){return this._iconsField},_getNodeIcon:function(t){var e=t[this.iconField];return e=e||(this.isLeaf(t)?this.leafIconCls:this.folderIconCls)},_getCheckBoxEl:function(t){if(0==this.isVisibleNode(t))return null;t=this._id+"$checkbox$"+t._id;return mini.byId(t,this.el)},useAnimation:!0,_updateNodeTimer:null,_doExpandCollapseNode:function(t){var e=this;e._updateNodeTimer&&(clearTimeout(e._updateNodeTimer),e._updateNodeTimer=null);var i;new Date;function n(){this._doUpdateTreeNodeEl(t),this.deferLayout(20)}function s(t,e,i){var n,s=this._getNodesEl(t,e);s&&(e=mini.getHeight(s),s.style.overflow="hidden",s.style.height="0px",e={height:e+"px"},(n=this)._inAniming=!0,jQuery(s).animate(e,250,function(){s.style.height="auto",n._inAniming=!1,n.doLayout(),mini.repaint(s)}))}function o(t,e,i){var n,s=this._getNodesEl(t,e);s?(mini.getHeight(s),(n=this)._inAniming=!0,jQuery(s).animate({height:"0px"},180,function(){s.style.height="auto",n._inAniming=!1,i&&i.call(n),n.doLayout(),mini.repaint(s)})):i&&i.call(this)}1!=this.isVirtualScroll()?mini.isIE6||!this.useAnimation||this.isFrozen()?n.call(this):(i=this.isExpandedNode(t),e=this,i?(n.call(this),s.call(this,t,2),s.call(this,t,1)):(o.call(this,t,2,n),o.call(this,t,1))):this._updateTimer||(e._updateNodeTimer=setTimeout(function(){e._updateNodeTimer=null,e.doUpdateRows(),e.deferLayout(50)},5))},__OnTreeCollapse:function(t){this._doExpandCollapseNode(t.node)},__OnTreeExpand:function(t){this._doExpandCollapseNode(t.node)},_doCheckNodeEl:function(t){var e,i,n=this._getCheckBoxEl(t);n&&(e=this.getCheckModel(),mini.removeClass(n,"mini-tree-checkbox-indeterminate"),i=t.indeterminate&&!t.checked,"cascade"!=e&&!i||("indeterminate"==(i?"indeterminate":this.getCheckState(t))?mini.addClass(n,"mini-tree-checkbox-indeterminate"):mini.removeClass(n,"mini-tree-checkbox-indeterminate")),t.checked?mini.addClass(n,"mini-tree-checkbox-checked"):mini.removeClass(n,"mini-tree-checkbox-checked"))},__OnCheckChanged:function(t){for(var e=0,i=t._nodes.length;e<i;e++){var n=t._nodes[e];this._doCheckNodeEl(n)}this._checkChangedTimer&&(clearTimeout(this._checkChangedTimer),this._checkChangedTimer=null);var s=this;this._checkChangedTimer=setTimeout(function(){s._checkChangedTimer=null,s.fire("_checkchanged")},1)},_tryToggleCheckNode:function(t){var e,i;!1!==t.enabled&&0!=this.getCheckable(t)&&(i={node:t,cancel:!1,checked:e=this.isCheckedNode(t),isLeaf:this.isLeaf(t)},this.fire("beforenodecheck",i),i.cancel||(this._dataSource.doCheckNodes(t,!e,!0),this.fire("nodecheck",i)))},_tryToggleNode:function(t){var e={node:t,cancel:!1};this.isExpandedNode(t)?(this.fire("beforecollapse",e),1!=e.cancel&&(this.collapseNode(t),e.type="collapse",this.fire("collapse",e))):(this.fire("beforeexpand",e),1!=e.cancel&&(this.expandNode(t),e.type="expand",this.fire("expand",e)))},_OnCellMouseDown:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellmousedown",t)},_OnCellClick:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||(mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.checkOnTextClick?this._tryToggleCheckNode(t.record):this.fire("cellclick",t))},__OnNodeDblClick:function(t){},__OnNodeClick:function(t){},setNodeText:function(t,e){var i;(t=this.getNode(t))&&((i={})[this.getTextField()]=e,this.updateNode(t,i))},setNodeIconCls:function(t,e){var i;(t=this.getNode(t))&&((i={})[this.iconField]=e,this.updateNode(t,i))},setIconField:function(t){this.iconField=t},getIconField:function(){return this.iconField},setAllowSelect:function(t){this.setAllowRowSelect(t)},getAllowSelect:function(){return this.getAllowRowSelect()},setShowExpandButtons:function(t){this.showExpandButtons!=t&&(this.showExpandButtons=t,this.doUpdate())},getShowExpandButtons:function(){return this.showExpandButtons},setShowTreeLines:function(t){1==(this.showTreeLines=t)?mini.addClass(this.el,"mini-tree-treeLine"):mini.removeClass(this.el,"mini-tree-treeLine")},getShowTreeLines:function(){return this.showTreeLines},setShowArrow:function(t){1==(this.showArrow=t)?mini.addClass(this.el,"mini-tree-showArrows"):mini.removeClass(this.el,"mini-tree-showArrows")},getShowArrow:function(){return this.showArrow},setLeafIcon:function(t){this.leafIcon=t},getLeafIcon:function(){return this.leafIcon},setFolderIcon:function(t){this.folderIcon=t},getFolderIcon:function(){return this.folderIcon},getExpandOnDblClick:function(){return this.expandOnDblClick},setExpandOnNodeClick:function(t){(this.expandOnNodeClick=t)?mini.addClass(this.el,"mini-tree-nodeclick"):mini.removeClass(this.el,"mini-tree-nodeclick")},getExpandOnNodeClick:function(){return this.expandOnNodeClick},setLoadOnExpand:function(t){this.loadOnExpand=t},getLoadOnExpand:function(){return this.loadOnExpand},hideNode:function(t){var e;(t=this.getNode(t))&&(t.visible=!1,this._doUpdateTreeNodeEl(t),e=this._getNodeEl(t,1),t=this._getNodeEl(t,2),e&&(e.style.display="none"),t&&(t.style.display="none"))},showNode:function(t){(t=this.getNode(t))&&(t.visible=!0,this._doUpdateTreeNodeEl(t))},enableNode:function(t){var e,i;(t=this.getNode(t))&&(t.enabled=!0,e=this._getNodeEl(t,1),i=this._getNodeEl(t,2),e&&mini.removeClass(e,"mini-disabled"),i&&mini.removeClass(i,"mini-disabled"),(t=this._getCheckBoxEl(t))&&(t.disabled=!1))},disableNode:function(t){var e,i;(t=this.getNode(t))&&(t.enabled=!1,e=this._getNodeEl(t,1),i=this._getNodeEl(t,2),e&&mini.addClass(e,"mini-disabled"),i&&mini.addClass(i,"mini-disabled"),(t=this._getCheckBoxEl(t))&&(t.disabled=!0))},imgPath:"",setImgPath:function(t){this.imgPath=t},getImgPath:function(){return this.imgPath},imgField:"img",setImgField:function(t){this.imgField=t},getImgField:function(){return this.imgField},getAttrs:function(t){var e,i=mini.TreeGrid.superclass.getAttrs.call(this,t);mini._ParseString(t,i,["value","url","idField","textField","iconField","nodesField","parentField","valueField","checkedField","leafIcon","folderIcon","leafField","ondrawnode","onbeforenodeselect","onnodeselect","onnodemousedown","onnodeclick","onnodedblclick","onbeforenodecheck","onnodecheck","onbeforeexpand","onexpand","onbeforecollapse","oncollapse","dragGroupName","dropGroupName","onendedit","expandOnLoad","ondragstart","onbeforedrop","ondrop","ongivefeedback","treeColumn","onaddnode","onremovenode","onmovenode","imgPath","imgField","hoverMode"]),mini._ParseBool(t,i,["allowSelect","showCheckBox","showRadioButton","showExpandButtons","showTreeIcon","showTreeLines","checkRecursive","enableHotTrack","showFolderCheckBox","resultAsTree","allowDrag","allowDrop","showArrow","expandOnDblClick","removeOnCollapse","autoCheckParent","loadOnExpand","expandOnNodeClick","useAnimation","checkOnTextClick"]),i.expandOnLoad&&(e=parseInt(i.expandOnLoad),mini.isNumber(e)?i.expandOnLoad=e:i.expandOnLoad="true"==i.expandOnLoad);var a=i.idField||this.getIdField(),h=i.textField||this.getTextField(),d=i.iconField||this.getIconField(),u=i.nodesField||this.getNodesField();t=function c(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i],o=mini.getChildNodes(s),l=o[0],r=o[1];l&&r||(l=s),o=jQuery(l),(s={})[a]=l.getAttribute("value"),s[d]=o.attr("iconCls"),s[h]=l.innerHTML,e.add(s),(l=o.attr("expanded"))&&(s.expanded="false"!=l),(o=o.attr("allowSelect"))&&(s.allowSelect="false"!=o),!r||0<(r=c(mini.getChildNodes(r))).length&&(s[u]=r)}return e}(mini.getChildNodes(t));return 0<t.length&&(i.data=t),!i.idField&&i.valueField&&(i.idField=i.valueField),i}}),mini.regClass(mini.TreeGrid,"TreeGrid"),mini.Tree=function(){mini.Tree.superclass.constructor.apply(this,arguments);var t=[{name:"node",header:"",field:this.getTextField(),width:"auto",allowDrag:!0,editor:{type:"textbox"}}];this._columnModel.setColumns(t),this._column=this._columnModel.getColumn("node"),mini.removeClass(this.el,"mini-treegrid"),mini.addClass(this.el,"mini-tree-nowrap"),this.setBorderStyle("border:0")},mini.extend(mini.Tree,mini.TreeGrid,{_userEmptyTd:!(mini.isChrome||mini.isIE6||mini.isIE7),setTextField:function(t){this._dataSource.setTextField(t),this._columnModel.updateColumn("node",{field:t}),this.textField=t},uiCls:"mini-tree",hoverMode:"title",_rowHoverCls:"mini-tree-node-hover",_rowSelectedCls:"mini-tree-selectedNode",_getRecordByEvent:function(t,e){"node"==this.hoverMode&&(e=!1);var i=mini.Tree.superclass._getRecordByEvent.call(this,t);return!1===e||i&&mini.findParent(t.target,"mini-tree-nodeshow")?i:null},_treeColumn:"node",defaultRowHeight:22,_getRowHeight:function(t){var e=this.defaultRowHeight;return t._height&&(e=parseInt(t._height),isNaN(parseInt(t._height))&&(e=rowHeight)),e},showHeader:!1,showTopbar:!1,showFooter:!1,showColumns:!1,showHGridLines:!1,showVGridLines:!1,showTreeLines:!0,setTreeColumn:null,setColumns:null,getColumns:null,frozen:null,unFrozen:null,showModified:!1,_OnCellMouseDown:function(t){this._editInput&&this._editInput.blur(),this.fire("cellmousedown",t)},beginEdit:function(e){var t,i,n;function s(){var t=n._id+"$edit$"+e._id;n._editInput=document.getElementById(t),n._editInput.focus(),mini.selectRange(n._editInput,0,1e3),mini.on(n._editInput,"keydown",n.__OnEditInputKeyDown,n),mini.on(n._editInput,"blur",n.__OnEditInputBlur,n)}(e=this.getNode(e))&&(t=this.getColumn(0),i=mini._getMap(t.field,e),i={record:e,node:e,column:t,field:t.field,value:i,cancel:!1},this.fire("cellbeginedit",i),1!=i.cancel&&(this._editingNode=e,this._doUpdateNodeTitle(e),n=this,setTimeout(function(){s()},100),s()))},cancelEdit:function(t){var e=this._editingNode;this._editingNode=null,e&&(!1!==t&&this._doUpdateNodeTitle(e),mini.un(this._editInput,"keydown",this.__OnEditInputKeyDown,this),mini.un(this._editInput,"blur",this.__OnEditInputBlur,this)),this._editInput=null},__OnEditInputKeyDown:function(t){var e,i;13==t.keyCode?(e=this._editingNode,i=this._editInput.value,this._editingNode=null,this.setNodeText(e,i),this.cancelEdit(!1),this.fire("endedit",{node:e,text:i})):27==t.keyCode&&this.cancelEdit()},__OnEditInputBlur:function(t){var e,i=this._editingNode;i&&(e=this._editInput.value,this.cancelEdit(),this.setNodeText(i,e),this.fire("endedit",{node:i,text:e}))},addRowCls:function(t,e){var i=this._getRowEl(t,1),t=this._getRowEl(t,2);i&&mini.addClass(i,e),t&&mini.addClass(t,e),i&&mini.addClass(i.cells[1],e),t&&mini.addClass(t.cells[1],e)},removeRowCls:function(t,e){var i=this._getRowEl(t,1),t=this._getRowEl(t,2);i&&mini.removeClass(i,e),t&&mini.removeClass(t,e),i&&mini.removeClass(i.cells[1],e),t&&mini.removeClass(t.cells[1],e)},scrollIntoView:function(e){var i;(e=this.getNode(e))&&(this.isVisibleNode(e)||this.expandPath(e),i=this,setTimeout(function(){var t;i.isVirtualScroll()?mini.Tree.superclass.scrollIntoView.call(i,e):(t=i._getNodeEl(e,2),mini.scrollIntoView(t,i._rowsViewEl,!1))},10))}}),mini.regClass(mini.Tree,"Tree"),mini._Tree_Expander=function(t){this.owner=t,mini.on(t.el,"click",this.__OnClick,this),mini.on(t.el,"dblclick",this.__OnDblClick,this)},mini._Tree_Expander.prototype={_canToggle:function(){return!this.owner._dataSource._isNodeLoading()},__OnClick:function(t){var e,i=this.owner,n=i._getRecordByEvent(t,!1);n&&!1!==n.enabled&&(mini.findParent(t.target,"mini-tree-checkbox")||(e=i.isLeaf(n),!mini.findParent(t.target,i._eciconCls)&&(!i.expandOnNodeClick||e||i._inAniming)||0!=this._canToggle()&&i._tryToggleNode(n)))},__OnDblClick:function(t){var e,i=this.owner,n=i._getRecordByEvent(t,!1);n&&!1!==n.enabled&&(i.isEditingNode(n)||(e=i.isLeaf(n),i._inAniming||mini.findParent(t.target,i._eciconCls)||mini.findParent(t.target,"mini-tree-checkbox")||i.expandOnNodeClick||i.expandOnDblClick&&!e&&0!=this._canToggle()&&(t.preventDefault(),i._tryToggleNode(n))))}},mini._Tree_AsyncLoader=function(t){(this.owner=t).on("expand",this.__OnBeforeNodeExpand,this)},mini._Tree_AsyncLoader.prototype={__OnBeforeNodeExpand:function(t){var e=this.owner,i=t.node,n=e.isLeaf(i),s=i[e.getNodesField()];n||s&&0!=s.length||e.loadOnExpand&&!1!==i.asyncLoad&&(t.cancel=!0,e.loadNode(i))}},mini.DataGrid.prototype.validateCell=mini_DataGrid_CellValidator_Prototype.validateCell=function validateCell(t,e){if(t=this.getNode?this.getNode(t):this.getRow(t),e=this.getColumn(e),t&&e&&0!=e.visible){var i=mini._getMap(e.field,t),n={record:t,row:t,node:t,column:e,field:e.field,value:mini.htmlUnescape(i),isValid:!0,errorText:""};if(e.vtype&&mini._ValidateVType(e.vtype,n.value,n,e),1==n.isValid&&e.unique&&e.field)for(var s={},o=this.data,l=e.field,r=0,a=o.length;r<a;r++){var h=o[r],d=h[l];if(!mini.isNull(d)&&""!==String(d).trim()){var u=s[d];if(u&&h==t){n.isValid=!1,n.errorText=mini._getErrorText(e,"uniqueErrorText"),this.setCellIsValid(u,e,n.isValid,n.errorText);break}s[d]=h}}this.fire("cellvalidation",n),this.setCellIsValid(t,e,n.isValid,n.errorText)}},mini.overwrite(mini.Form,{getValidateFields:function(t){for(var e=[],i=this.getFields(),n=0,s=i.length;n<s;n++){var o=i[n];o.validate&&o.isDisplay&&(!mini.isDisplay(o.el,function(t){if(mini.hasClass(t,"mini-tabs-body")||mini.hasClass(t,"fui-acc-bd")||mini.hasClass(t,"invisible"))return!0})&&!o.forceValidate||(o.enabled||t||o.forceValidate)&&e.push(o))}return e},getErrors:function(){for(var t=[],e=this.getValidateFields(),i=0,n=e.length;i<n;i++){var s=e[i];s.isValid&&0==s.isValid()&&t.push(s)}return t}}),mini.overwrite(mini.MessageBox,{show:function(e){(e=mini.copyTo({width:"360",height:"145",customCls:"",showModal:!0,timeout:0,minWidth:150,maxWidth:800,minHeight:50,maxHeight:350,showHeader:!0,title:"",titleIcon:"",iconCls:"",iconStyle:"",message:"",html:"",spaceStyle:"",showCloseButton:!0,buttons:null,buttonWidth:null,callback:null,showNoTipCheck:!1,clickNoTipCheck:!1},e)).message=String(e.message);var i=e.callback,n=e.control||new mini.Window;e.customCls&&n.addCls(e.customCls),n.addCls("mini-messagebox"),n.setBodyStyle("overflow:hidden"),n.setShowModal(e.showModal),n.setTitle(e.title||""),n.setIconCls(e.titleIcon),n.setShowHeader(e.showHeader),n.setShowCloseButton(e.showCloseButton);var t=n.uid+"$table",s=n.uid+"$content",o='<i class="mini-messagebox-icon mini-iconfont '+e.iconCls+'" style="'+e.iconStyle+'"></i><p class="mini-messagebox-msg">'+(e.message||"")+"</p>";n._bodyEl.innerHTML='<div class="mini-messagebox-content"></div><div class="mini-messagebox-buttons"></div>';var l=n._bodyEl.firstChild;e.html?"string"==typeof e.html?l.innerHTML=e.html:mini.isElement(e.html)&&l.appendChild(e.html):(l.innerHTML=o,n._content=l.lastChild),e.showNoTipCheck&&((m=n._bodyEl.lastChild).innerHTML='<label class="mini-messagebox-checkbox"><input type="checkbox">不再提示</label>',mini.on(m.firstChild,"click",function(){var t;e.clickNoTipCheck&&(t=this.firstChild.checked,e.clickNoTipCheck.apply(this,[t]))})),n._Buttons=[];var r=n._bodyEl.lastChild;if(e.buttons&&0<e.buttons.length)for(var a=0,h=e.buttons.length;a<h;a++){var d=e.buttons[a],u=(u=mini.MessageBox.buttonText[d])||d,c=new mini.Button;c.setText(u),c.setWidth(e.buttonWidth),c.render(r),c.action=d,c.on("click",function(t){t=t.sender;i&&!1===i(t.action)||mini.MessageBox.hide(n)}),a!=h-1&&c.setStyle(e.spaceStyle),c.setCls("mini-messagebox-button"),"ok"==d&&(c.addCls("ok"),c.setState("primary")),n._Buttons.push(c)}else mini.addClass(n._bodyEl,"no-btn");n.setMinWidth(e.minWidth),n.setMinHeight(e.minHeight),n.setMaxWidth(e.maxWidth),n.setMaxHeight(e.maxHeight),n.setWidth(e.width),n.setHeight(e.height),mini.parse(l),n.show(e.x,e.y,{animType:e.animType});var m=n.getWidth();n.setWidth(m+"px");m=$(l).css("position","relative").outerHeight(!0);$(l).css("position","");m=m?m+($(n._headerEl).is(":visible")?$(n._headerEl).outerHeight(!0):0)+($(r).is(":visible")?$(r).outerHeight(!0):0):n.getHeight();m>e.maxHeight&&(m=e.maxHeight),n.setHeight(m+"px");t=document.getElementById(t);t&&(t.style.width="100%");s=document.getElementById(s);return s&&(s.style.width="100%"),mini.MessageBox.autoFocus&&(n._Buttons[0]||n).focus(),n.on("beforebuttonclick",function(t){i&&i("close"),t.cancel=!0,mini.MessageBox.hide(n)}),mini.on(n.el,"keydown",function(t){27==t.keyCode&&(i&&i("close"),mini.MessageBox.hide(n))}),e.timeout&&setTimeout(function(){mini.MessageBox.hide(n.uid)},e.timeout),n.uid},prompt:function(t,e,i,n,s){var o=new mini.Window;o.addCls("mini-prompt");var l=(r=o.uid)+"$prompt",t=t||mini.MessageBox.promptMessage,t=n?'<label class="mini-prompt-label">'+t+'</label><input id="'+l+'" class="mini-textarea mini-prompt-input" errorMode="text">':'<label class="mini-prompt-label">'+t+'</label><input type="text" id="'+l+'" class="mini-textbox mini-prompt-input" errorMode="text">',r=mini.MessageBox.show({control:o,title:e||mini.MessageBox.promptTitle,buttons:["ok","cancel"],html:'<div class="mini-messagebox-prompt" >'+t+"</div>",callback:function(t){var e=mini.get(l);if(s&&e.validate&&e.validate(),i)return i(t,e.getValue())}});return s&&mini.get(l).on("validation",s),mini.get(l).focus(),r},deletePrompt:function(i,n,t){t=t||{},n=n||function(){};var e=$.extend({title:"删除确认",tpl:"删除后不可恢复，请输入%s确认"},t),t=$('<span class="mini-delete-prompt-content"></span>').text(i)[0].outerHTML,t=e.tpl.replace(/%s/,t);return mini.prompt(t,e.title,function(t,e){if("ok"==t){if(e!==i)return!1;n()}},!1,function(t){t.value!==i?(t.errorText="输入内容不匹配",t.isValid=!1):(t.errorText="",t.isValid=!0)})},confirm:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.confirmTitle,buttons:["ok","cancel"],message:t,iconCls:"mini-messagebox-question",callback:i})},deleteConfirm:function(){}}),mini.prompt=mini.MessageBox.prompt,mini.deletePrompt=mini.MessageBox.deletePrompt,mini.showMessageBox=mini.MessageBox.show,mini.confirm=mini.MessageBox.confirm,mini.showTips=mini.MessageBox.showTips=function(t){var e=mini.newId("mini-tips-"),i='<div id="'+e+'" class="mini-tips '+("mini-tips-"+(t=jQuery.extend({content:"",state:"default",showIcon:!0,x:"center",y:"top",offset:[10,10],fixed:!0,timeout:2e3},t)).state)+(t.showIcon?" mini-tips-showIcon":"")+'">'+t.content.replace(/<(script\b[^<]*(?:(?!<\/script>)<[^<]*)*)<(\/script)>/gi,"&lt;$1&lt;$2&gt;")+"</div>",n=jQuery(i).appendTo(document.body);return t.el=n[0],t.timeoutHandler=function(){n.slideUp(function(){n.remove()})},mini.showAt(t),n.hide().slideDown(),e},mini.hideTips=mini.MessageBox.hideTips=function(t,e){if(t)return e?$(this).remove():jQuery("#"+t).slideUp(function(){$(this).remove()})},mini.Avatar=function(){mini.Avatar.superclass.constructor.call(this)},mini.extend(mini.Avatar,mini.Control,{uiCls:"mini-avatar",username:"",shortName:"",bgColor:"",portrait:"",_tpl:'{{#portrait}}<img class="mini-avatar-img" src="{{portrait}}" >{{/portrait}}{{^portrait}}<span class="mini-avatar-text" style="background:{{avatarBg}}">{{shortName}}</span>{{/portrait}}',_create:function(){var t=document.createElement("span");this._portraitEl=document.createElement("img"),this._portraitEl.className="mini-avatar-img",this._textEl=document.createElement("span"),this._textEl.className="mini-avatar-text",t.appendChild(this._portraitEl),t.appendChild(this._textEl),this.el=t},_getShortName:function(){return this.username?this.username.substr(-2):""},setData:function(t){var e=t.username,i=t.bgColor,t=t.portrait;this.setUsername(e),this.setBgColor(i),this.setPortrait(t)},getData:function(){return{username:this.username,bgColor:this.bgColor,portrait:this.portrait}},setUsername:function(t){this.username=t,this._textEl.setAttribute("title",t),this._portraitEl.setAttribute("title",t),this._textEl.innerText=this._getShortName(),this.portrait?this.el.setAttribute("mode","img"):this.el.setAttribute("mode","")},getUsername:function(t){return this.username},setBgColor:function(t){this.bgColor=t,this._textEl.style.backgroundColor=t},getBgColor:function(t){return this.bgColor},setPortrait:function(t){this.portrait=t,this.portrait?(this._portraitEl.setAttribute("src",t),this.el.setAttribute("mode","img")):this.el.setAttribute("mode","")},getPortrait:function(t){return this.portrait},getAttrs:function(t){var e=mini.Avatar.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["username","bgColor","portrait","width","height"]),e},setWidth:function(t){$(this.el).add(this._textEl).add(this._portraitEl).css("width",t)},setHeight:function(t){var e="number"==typeof t?t+"px":/px$/.test(t)?t:parseInt(t,10)+"px";$(this.el).add(this._textEl).add(this._portraitEl).css({height:t,"line-height":e})}}),mini.regClass(mini.Avatar,"avatar"),mini.CatalogImport=function(){mini.CatalogImport.superclass.constructor.call(this)},mini.extend(mini.CatalogImport,mini.Control,{uiCls:"mini-catalogimport",url:"",pickerText:"导入文件",_create:function(){this.el=document.createElement("div"),this.uploader=new mini.WebUploader,this.uploader.set({uploadUrl:this.url,pickerText:this.pickerText,fileNumLimit:1,limitType:"xls,xlsx,xlsm",showDefaultUI:!1,auto:!1,renderTo:this.el}),this.uploader.on("beforefilequeued",this._onBeforeFileQueued,this),this.uploader.on("filesqueued",this._onFilesQueued,this),this.uploader.on("uploadbeforesend",this._onUploadBeforeSend,this),this.uploader.on("uploadprogress",this._onUploadProgress,this),this.uploader.on("uploadsuccess",this._onUploadSuccess,this),this.uploader._uploadBtn.hide(),this.fileList=document.createElement("div"),this.fileList.className="mini-catalogimport-filelist",this.el.appendChild(this.fileList),this._bindEvent()},_bindEvent:function(){var t=this;jQuery(this.fileList).on("click",".catalogimport-delete",function(){$(this).closest(".mini-catalogimport-item").remove(),t.uploader.clearFile()}).on("click",".catalogimport-export",function(){t.fire("exportresult",{attachGuid:t._curAttachGuid})})},_onFilesQueued:function(t){var e=t.files[0],i=this;e&&(t=this._generateFileList({id:e.id,name:e.name,size:e.size}),this.isImportFinished=!1,jQuery(t).appendTo(this.fileList),this.uploader._uploader.md5File(e).progress(function(t){}).then(function(t){t={fileMD5:i._curFileMD5=t,fileName:e.name,fileSize:e.size};t[i.uploader.id+"_action"]="queryFileStatus",i.uploader.getCommonData&&(t.commonDto=mini.encode(i.uploader.getCommonData())),i._onPostFileMd5(t),$.ajax(i.url,{dataType:"json",data:t,type:"post",success:function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),i._onQueryFileStatus(t)}})}))},_onPostFileMd5:function(t){this.fire("postfilemd5",{data:t})},_curFileMD5:"",_curAttachGuid:"",_onQueryFileStatus:function(t){t.msg&&mini.alert(t.msg),this.setDetailStatus(t.detail),this._curAttachGuid=t.attachGuid,this._oldAttachGuid=t.attachGuidOld,t.end?this._onFinished(t.status):(t.pollingFrequency&&(this._pollingFrequency=t.pollingFrequency),"importStatus"==t.action?this.pollingStatus(t):"upload"==t.action?this.uploader._uploader.upload():jQuery(this.fileList).find(".mini-catalogimport-action").removeClass("hidden"))},_onUploadBeforeSend:function(t){this.isContinueImport&&(t.data.attachGuid=this._curAttachGuid),t.data.fileMD5=this._curFileMD5},_onUploadProgress:function(t){var e=t.file,i=t.percentage,t=mini.byId(e.id),e=jQuery(".mini-catalogimport-progressbar",t),t=jQuery(".progress-text",e),e=jQuery(".progress-body",e),i=Math.round(100*i)+"%";t.text(i),e.width(i)},_generateFileList:function(t){var e=[];return e.push('<div class="mini-catalogimport-item" id="'+t.id+'">'),e.push('<span class="mini-catalogimport-info">'+t.name+"</span>"),e.push('<span class="mini-catalogimport-size">('+this._getSize(t.size)+")</span>"),e.push('<span class="mini-catalogimport-action hidden"><a href="javascript:void(0)" class="catalogimport-delete">删除</a></span>'),e.push('<span class="mini-catalogimport-status">正在上传</span>'),e.push('<span class="mini-catalogimport-progressbar"><span class="progress-text">0%</span><div class="progress-body"></div></span>'),e.push("</div>"),e.join("")},_onPollingStatus:function(t){var e,i,n,s;t.status&&(s=mini.byId(this._currentFileId),e=jQuery(".mini-catalogimport-status",s),i=jQuery(".mini-catalogimport-progressbar",s),n=jQuery(".progress-text",i),s=jQuery(".progress-body",i),e.text(t.status),0<=t.handlepercent?(t=t.handlepercent+"%",i.removeClass("hidden"),n.text(t),s.width(t)):i.addClass("hidden"))},_generateStatuslist:function(t){var e,i,n,s=!0,o=!0,l=['<div class="catalogimport-status-item">'];if(l.push('<h3 class="catalogimport-status-title">'+t.sheetName+"</h3>"),l.push('<h4 class="catalogimport-status-type">校验结果：</h4>'),l.push('<p class="catalogimport-status-count">总计：'+t.checkCount+"条，成功："+t.checkSuccessCount+"，失败："+t.checkErrorCount+"条。"),(n=t.checkMsg)&&(i=n.length)){for(l.push('<a href="javascript:void(0);" class="catalogimport-status-toggle">展开详情</a></p>'),l.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)l.push("<p>"+n[e]+"</p>");l.push("</div>")}else s=!1;if(t.saveCount)if(s||(l.push("</p>"),s=!0),l.push('<h4 class="catalogimport-status-type">导入结果：</h4>'),l.push('<p class="catalogimport-status-count">总计：'+t.saveCount+"条，成功："+t.saveSuccessCount+"，失败："+t.saveErrorCount+"条。"),(n=t.saveMsg)&&(i=n.length)){for(l.push('<a href="javascript:void(0);" class="catalogimport-status-toggle">展开详情</a></p>'),l.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)l.push("<p>"+n[e]+"</p>");l.push("</div>")}else o=!1;if((n=t.taskMsg)&&(i=n.length)){for(l.push('<a href="javascript:void(0);" class="catalogimport-status-toggle">展开详情</a></p>'),l.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)l.push("<p>"+n[e]+"</p>");l.push("</div>")}else s&&o||l.push("</p>");return l.push("</div>"),l.join("")},_getSize:function(t){return 1048576<(t=parseInt(t))?(t/1048576).toFixed(2)+"M":(t/1024).toFixed(2)+"K"},_pollingFrequency:1e3,_oldAttachGuid:"",_onUploadSuccess:function(t){var e=t.ret,t=t.file,e=(e=(e=mini.getSecondRequestData?mini.getSecondRequestData(e):e).data||e).extraDatas||e;if(this._pollingFrequency=e.pollingFrequency,"importStatus"==e.action)return this._curAttachGuid=e.attachGuid,this._oldAttachGuid=e.attachGuidOld,e.fileId=t.id,void this.pollingStatus(e);var i=this;mini.alert("数据导入失败，请重试！","",function(){i._onFinished(e)})},_onFinished:function(t){var e=t.status||"导入已完成",i=t.success;this.isImportFinished=!0;var n=mini.byId(this._currentFileId),s=jQuery(".mini-catalogimport-status",n),o=jQuery(".mini-catalogimport-progressbar",n),n=jQuery(".mini-catalogimport-action",n);s.text(e),o.addClass("hidden"),i?setTimeout(function(){s.addClass("hidden")},1e3):(s.addClass("error"),s.append('<a class="catalogimport-export">校验结果导出</a>'),n.removeClass("hidden")),this._events.importfinished&&this.fire("importfinished",t)},_onBeforeFileQueued:function(t){this._events.beforefilequeued&&this.fire("beforefilequeued",t)},_currentFileId:"",pollingStatus:function(t){t.fileId&&(this._currentFileId=t.fileId),this._onPollingStatus(t);var e=this,t={fileMD5:this._curFileMD5,attachGuid:this._curAttachGuid,attachGuidOld:this._oldAttachGuid};t[this.uploader.id+"_action"]="importStatus",this.uploader.getCommonData&&(t.commonDto=mini.encode(this.uploader.getCommonData())),jQuery.ajax({url:this.url,data:t,type:"POST",dataType:"json"}).done(function(t){(t=mini.getSecondRequestData?mini.getSecondRequestData(t):t).msg&&mini.alert(t.msg),t.end?e._onFinished(t):setTimeout(jQuery.proxy(e.pollingStatus,e,t),e._pollingFrequency),e.setDetailStatus(t.detail)})},setDetailStatus:function(t){this.detailStatus=t,this.isDetailShow&&this.renderDetailStatus()},renderDetailStatus:function(){var t,e=this.detailStatus,i=[],n=0;if(e)for(t=e.length;n<t;n++)i.push(this._generateStatuslist(e[n]));this.detailContent.innerHTML=i.join("")},showDetailStatus:function(){this.renderDetailStatus(),this.detailEl.style.display="block",this.isDetailShow=!0},hideDetailStatus:function(){this.detailEl.style.display="none",this.isDetailShow=!1},setUrl:function(t){this.url=t,this.uploader&&this.uploader.setUploadUrl(t)},getUrl:function(){return this.url},setPickerText:function(t){},setEnabled:function(t){mini.CatalogImport.superclass.setEnabled.call(this,t),this.uploader&&this.uploader.setEnabled(t)},getAttrs:function(t){var e=mini.CatalogImport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","pickerText","onbeforefilequeued","onpostfilemd5","onimportfinished","onexportresult"]),e}}),mini.regClass(mini.CatalogImport,"catalogimport"),function(o){var i=function(t){this.value={h:1,s:1,b:1,a:1},this.setColor(t)};i.prototype={constructor:i,setColor:function(n){n=n.toLowerCase();var s=this;o.each(l.stringParsers,function(t,e){var i=e.re.exec(n),i=i&&e.parse(i),e=e.space||"rgba";if(i)return s.value="hsla"===e?l.RGBtoHSB.apply(null,l.HSLtoRGB.apply(null,i)):l.RGBtoHSB.apply(null,i),!1})},setHue:function(t){this.value.h=1-t},setSaturation:function(t){this.value.s=t},setLightness:function(t){this.value.b=1-t},setAlpha:function(t){this.value.a=parseInt(100*(1-t),10)/100},toRGB:function(t,e,i,n){var s,o,l;return t||(t=this.value.h,e=this.value.s,i=this.value.b),t=(t*=360)%360/60,i=s=o=i-(l=i*e),i+=[l,e=l*(1-Math.abs(t%2-1)),0,0,e,l][t=~~t],s+=[e,l,l,e,0,0][t],o+=[0,0,e,l,l,e][t],{r:Math.round(255*i),g:Math.round(255*s),b:Math.round(255*o),a:n||this.value.a}},toHex:function(t,e,i,n){n=this.toRGB(t,e,i,n);return"#"+(1<<24|parseInt(n.r)<<16|parseInt(n.g)<<8|parseInt(n.b)).toString(16).substr(1)},toHSL:function(t,e,i,n){t||(t=this.value.h,e=this.value.s,i=this.value.b);var s=(2-e)*i,i=e*i;return{h:t,s:i=1<(i/=0<s&&s<=1?s:2-s)?1:i,l:s/=2,a:n||this.value.a}}};var s=function(t,e){this.element=o(t);e=e.format||this.element.data("color-format")||"hex";this.format=l.translateFormats[e],this.isInput=this.element.is("input"),this.component=!!this.element.is(".color")&&this.element.find(".add-on"),this.picker=o(l.template).appendTo("body").on("mousedown",o.proxy(this.mousedown,this)),this.isInput?this.element.on({focus:o.proxy(this.show,this),keyup:o.proxy(this.update,this)}):(this.component||this.element).on({click:o.proxy(this.show,this)}),"rgba"!==e&&"hsla"!==e||(this.picker.addClass("alpha"),this.alpha=this.picker.find(".colorpicker-alpha")[0].style),this.component?(this.picker.find(".colorpicker-color").hide(),this.preview=this.element.find("i")[0].style):this.preview=this.picker.find("div:last")[0].style,this.base=this.picker.find("div:first")[0].style,this.update()};s.prototype={constructor:s,show:function(t){this.picker.show(),this.height=(this.component||this.element).outerHeight(),this.place(),o(window).on("resize",o.proxy(this.place,this)),this.isInput||t&&(t.stopPropagation(),t.preventDefault()),o(document).on({mousedown:o.proxy(this.hide,this)}),this.element.trigger({type:"show",color:this.color})},update:function(){this.color=new i(this.isInput?this.element.prop("value"):this.element.data("color")),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor()},setValue:function(t){this.color=new i(t),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor(),this.element.trigger({type:"changeColor",color:this.color})},hide:function(){this.picker.hide(),o(window).off("resize",this.place),this.isInput?this.element.prop("value",this.format.call(this)):(o(document).off({mousedown:this.hide}),this.component&&this.element.find("input").prop("value",this.format.call(this)),this.element.data("color",this.format.call(this))),this.element.trigger({type:"hide",color:this.color})},place:function(){var t=(this.component||this.element).offset();this.picker.css({top:t.top+this.height,left:t.left})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(e){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},pointer:null,slider:null,mousedown:function(t){t.stopPropagation(),t.preventDefault();var e=o(t.target).closest("div");if(!e.is(".colorpicker")){if(e.is(".colorpicker-saturation"))this.slider=o.extend({},l.sliders.saturation);else if(e.is(".colorpicker-hue"))this.slider=o.extend({},l.sliders.hue);else{if(!e.is(".colorpicker-alpha"))return!1;this.slider=o.extend({},l.sliders.alpha)}var i=e.offset();this.slider.knob=e.find("i")[0].style,this.slider.left=t.pageX-i.left,this.slider.top=t.pageY-i.top,this.pointer={left:t.pageX,top:t.pageY},o(document).on({mousemove:o.proxy(this.mousemove,this),mouseup:o.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(t){t.stopPropagation(),t.preventDefault();var e=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((t.pageX||this.pointer.left)-this.pointer.left))),t=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((t.pageY||this.pointer.top)-this.pointer.top)));return this.slider.knob.left=e+"px",this.slider.knob.top=t+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,e/100),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,t/100),this.previewColor(),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),o(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1}},o.fn.colorpicker=function(i,n){return this.each(function(){var t=o(this),e=t.data("colorpicker");e||t.data("colorpicker",e=new s(this,o.extend({},o.fn.colorpicker.defaults,"object"==typeof i&&i))),"string"==typeof i&&e[i](n)})},o.fn.colorpicker.defaults={},o.fn.colorpicker.Constructor=s;var l={translateFormats:{rgb:function(){var t=this.color.toRGB();return"rgb("+t.r+","+t.g+","+t.b+")"},rgba:function(){var t=this.color.toRGB();return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},hsl:function(){var t=this.color.toHSL();return"hsl("+Math.round(360*t.h)+","+Math.round(100*t.s)+"%,"+Math.round(100*t.l)+"%)"},hsla:function(){var t=this.color.toHSL();return"hsla("+Math.round(360*t.h)+","+Math.round(100*t.s)+"%,"+Math.round(100*t.l)+"%,"+t.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(t,e,i,n){var s,o;return t/=255,e/=255,i/=255,{h:((0==(o=(s=Math.max(t,e,i))-Math.min(t,e,i))?null:s==t?(e-i)/o:s==e?(i-t)/o+2:(t-e)/o+4)+360)%6*60/360||1,s:0==o?0:o/s,b:s,a:n||1}},HueToRGB:function(t,e,i){return i<0?i+=1:1<i&&--i,6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t},HSLtoRGB:function(t,e,i,n){e<0&&(e=0);var s,o=2*i-(s=i<=.5?i*(1+e):i+e-i*e),i=t,e=t-1/3;return[Math.round(255*l.HueToRGB(o,s,t+1/3)),Math.round(255*l.HueToRGB(o,s,i)),Math.round(255*l.HueToRGB(o,s,e)),n||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1]/360,t[2]/100,t[3]/100,t[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(window.jQuery),mini.ColorPicker=function(){mini.ColorPicker.superclass.constructor.call(this)},mini.extend(mini.ColorPicker,mini.Control,{value:"#ff0000",format:"hex",allowInput:!1,uiCls:"mini-colorpicker",_clearBorder:!1,_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<span class="mini-colorpicker-indication"><i></i></span>',this._valueBox=new mini.TextBox,this._indication=this.el.lastChild.firstChild,this._valueBox.setValue(this.value),this.allowInput||this._valueBox.setAllowInput(!1),this._valueBox.render(this.el,"prepend"),jQuery(this._indication).css("background",this.value),this.colorPicker=jQuery(this.el).attr("data-color",this.value).colorpicker({format:this.format})},_initEvents:function(){var e=this;this.colorPicker.on("changeColor",function(t){e.value=e._getValue(t.color),e._valueBox.setValue(e.value),jQuery(e._indication).css("background",e.value),e.fire("valuechanged",{sender:e,value:e.value,type:"valuechanged"})}),this._valueBox.on("blur",function(t){e.colorPicker.colorpicker("setValue",e._valueBox.getValue())})},_getValue:function(t){var e="";switch(this.format){case"rgb":var i,e="rgb("+(i=t.toRGB()).r+","+i.g+","+i.b+")";break;case"rgba":e="rgba("+(i=t.toRGB()).r+","+i.g+","+i.b+","+i.a+")";break;case"hsl":var n=t.toHSL();e="hsl("+Math.round(360*n.h)+","+Math.round(100*n.s)+"%,"+Math.round(100*n.l)+"%)";break;case"hsla":n=t.toHSL();e="hsla("+Math.round(360*n.h)+","+Math.round(100*n.s)+"%,"+Math.round(100*n.l)+"%,"+n.a+")";break;case"hex":e=t.toHex()}return e},setValue:function(t){this.colorPicker.colorpicker("setValue",t)},getValue:function(){return this.value},setFormat:function(t){this.colorPicker.colorpicker({format:t}),this.format=t,this.setValue(this.value)},getFormat:function(){return this.format},setAllowInput:function(t){this._valueBox.setAllowInput(t),this.allowInput=t},getAllowInput:function(){return this.allowInput},getAttrs:function(t){var e=mini.ColorPicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onvaluechanged","format"]),mini._ParseBool(t,e,["allowInput"]),e}}),mini.regClass(mini.ColorPicker,"colorpicker"),mini.DataExport=function(){mini.DataExport.superclass.constructor.call(this)},mini.extend(mini.DataExport,mini.Button,{gridId:"",exportUrl:"",fileName:"",position:"right",uiCls:"mini-dataexport",columnsValue:"",columnsText:"",paramName:"exportParams",dynamicColumns:!1,expandText:"导出",collapseText:"导出",exportText:"导 出",leftListTitle:"待选列",rightListTitle:"已选列",fromText:"从第",pageNumInfo:"页导出到第",pageText:"页",exportModelText:"以模板导出",_clearBorder:!1,showExportModel:!1,showIcon:!1,_iconCls:"icon-upload",_create:function(){mini.DataExport.superclass._create.apply(this,arguments),this.set({text:this.collapseText,disableMultiClick:!1}),this.showIcon&&this.setIconCls(this._iconCls),this.popup=new mini.Popup,this.panel=new mini.Panel,this.popup.addCls("mini-dataexport-popup"),this.panel.addCls("mini-dataexport-panel"),this.panel.set({width:450,showToolbar:!1,showFooter:!1,showHeader:!1}),this.popup.render(document.body),this.panel.render(this.popup.el);var t=['<div class="mini-export-list"><div class="mini-export-left"></div><div class="mini-export-middle"></div><div class="mini-export-right"></div></div>'];t.push('<div class="mini-export-line">'),t.push('<div id="'+this.id+'-rbl" class="mini-radiobuttonlist" repeatItems="1" repeatLayout="table" ></div>'),t.push('<div id="'+this.id+'-model-ck" class="mini-checkbox model-ck" style="display:none" text="'+this.exportModelText+'"></div>'),t.push("</div>"),t.push('<a id="'+this.id+'-action" class="mini-button mini-btn-primary mini-export-btn">'+this.exportText+"</a>"),t.push('<div style="display:none;"></div>'),this.panel.setBody(t.join("")),mini.parse(this.popup.el),this._panel=this.panel.el,this._exportBtn=mini.get(this.id+"-action",this._panel);t=this.panel.getBodyEl();this._listContent=t.firstChild,this._exportRbl=mini.get(this.id+"-rbl",this._panel),this._exportRbl.setData([{text:"仅导出选中行",id:"0"},{text:"导出全部",id:"1"},{text:"导出当前页",id:"2"},{text:this.fromText+'<input type="text" class="mini-export-num" id="'+this.id+'-fromnum"/>'+this.pageNumInfo+'<input type="text" class="mini-export-num" id="'+this.id+'-tonum"/>'+this.pageText,id:"3"}]),this._radioTrs=this._exportRbl._innerEl.getElementsByTagName("tr"),this._rowTr=this._radioTrs[0],this._curPageTr=this._radioTrs[2],this._pageTr=this._radioTrs[3],this._fromNumInput=mini.byId(this.id+"-fromnum",this._pageTr),this._toNumInput=mini.byId(this.id+"-tonum",this._pageTr),this.exportModelCheck=mini.get(this.id+"-model-ck",this._panel),this._exportFormWrap=t.lastChild,this._exportFormWrap.innerHTML='<form method="post" target="exportIFrame"><input type="hidden" name="'+this.paramName+'" /></form><iframe id="exportIFrame" name="exportIFrame" style="display:none;"></iframe>',this._exportForm=this._exportFormWrap.firstChild,this._exportFormField=this._exportForm.firstChild,this._exportIframe=this._exportFormWrap.lastChild,this._contentL=this._listContent.firstChild,this._contentM=this._listContent.childNodes[1],this._contentR=this._listContent.lastChild,this._contentL.innerHTML='<div class="mini-export-list-header">'+this.leftListTitle+'</div><div class="mini-export-list-content"></div>',this._contentR.innerHTML='<div class="mini-export-list-header">'+this.rightListTitle+'</div><div class="mini-export-list-content"></div>',this.leftListBox=new mini.ListBox,this.leftListBox.set({height:170,width:180,valueField:"field",showCheckBox:!0,multiSelect:!0}),this.leftListBox.render(this._contentL.lastChild),this.rightListBox=new mini.ListBox,this.rightListBox.set({height:170,width:180,valueField:"field",showCheckBox:!0,multiSelect:!0}),this.rightListBox.render(this._contentR.lastChild),this._initButtons()},_initEvents:function(){mini.DataExport.superclass._initEvents.apply(this,arguments);var s=this;this.on("click",function(){mini.hasClass(s.el,"mini-button-popup")?s.hidePanel():s.showPanel()}),this._exportBtn.on("click",function(t){s._OnExport(t)}),mini.on(this._fromNumInput,"blur",function(){var t,e,i,n;s.dataGrid&&(t=s.dataGrid.getPageIndex()+1,e=s.dataGrid.getTotalPage(),i=parseInt(s._toNumInput.value,10),(n=parseInt(this.value,10))?e<n&&(n=e):n=t,this.value=n=i<n?i:n)}),mini.on(this._toNumInput,"blur",function(){var t,e,i;s.dataGrid&&(s.dataGrid.getPageIndex(),t=s.dataGrid.getTotalPage(),e=parseInt(s._fromNumInput.value,10),i=parseInt(this.value,10),this.value=i=(i=!i||t<i?t:i)<e?e:i)}),mini.on(document,"mouseup",this._OnDocMouseUp,this),mini.on(this._exportIframe,"load",function(){s.fire("exportsuccess")})},_getExportData:function(){var t={columns:this.rightListBox.data,fileName:this.fileName};if(t.fileName||window.console&&window.console.error&&console.error("未指定导出文件的filename，导出文件可能不正常！"),this.gridId){this.dataGrid||(this.dataGrid=mini.get(this.gridId));var e=this._exportRbl.value,i=this.dataGrid.getPageSize(),n=this.dataGrid.getTotalCount(),s=this.dataGrid.getSortField(),o=this.dataGrid.getSortOrder(),l=this.dataGrid.getTotalPage()-1,r=0,a=0,h=this.dataGrid.getPageIndex(),d=this.exportModelCheck.checked;switch(e){case"0":a=r=h,t.idField=this.dataGrid.idField,t.checkedRows={},t.checkedRows[this.dataGrid.idField]=this._getSelectedGridIds();break;case"1":r=0,a=l;break;case"2":a=r=h;break;case"3":r=parseInt(this._fromNumInput.value,10)-1,a=parseInt(this._toNumInput.value)-1,mini.isNumber(r)||(r=h),(!mini.isNumber(a)||a<r)&&(a=l)}mini.copyTo(t,{fromIndex:r,toIndex:a,pageSize:i,totalCount:n,sortField:s,sortOrder:o,exportByTemplate:d})}return t},_getSelectedGridIds:function(){for(var t=[],e=[],i=this.dataGrid.idField,n=0,s=(e=this.dataGrid?this.dataGrid.getSelecteds():e).length;n<s;n++){var o=e[n];t.push(o[i])}return t.join(",")},_OnExport:function(t){t={htmlEvent:t,data:this._getExportData()};this.fire("beforeexport",t),this._exportFormField.value="string"==typeof t.data?t.data:mini.encode(t.data),this._exportForm.submit(),this.hidePanel()},_OnDocMouseUp:function(t){mini.isAncestor(this.popup.el,t.target)||this.hidePanel()},_initButtons:function(){this._contentM.innerHTML='<button class="mini-export-listbtn mini-icon right" type="button"></button><button class="mini-export-listbtn mini-icon right-all" type="button"></button><button class="mini-export-listbtn mini-icon left" type="button"></button><button class="mini-export-listbtn mini-icon left-all" type="button"></button>';var i=this;mini.on(this._contentM,"click",function(t){var e,t=t.target;mini.hasClass(t,"right")?(e=i.leftListBox.getSelecteds(),i.leftListBox.removeItems(e),i.rightListBox.addItems(e)):mini.hasClass(t,"right-all")?(e=i.leftListBox.getData(),i.leftListBox.removeItems(e),i.rightListBox.addItems(e)):mini.hasClass(t,"left")?(e=i.rightListBox.getSelecteds(),i.rightListBox.removeItems(e),i.leftListBox.addItems(e)):mini.hasClass(t,"left-all")&&(e=i.rightListBox.getData(),i.rightListBox.removeItems(e),i.leftListBox.addItems(e))})},setExportUrl:function(t){this.exportUrl=t,this._exportForm.action=t},getExportUrl:function(){return this.exportUrl},getGridId:function(){return this.gridId},setGridId:function(t){this.gridId=t,this.dataGrid=mini.get(t)},showPanel:function(){var t;this._adjustRadioLayout(),this.setText(this.expandText),this.addCls("mini-button-popup"),this.isInit&&!this.dynamicColumns||(t=this.getColumns(),"left"==this.position?(this.leftListBox.setData(t),this.rightListBox.setData([])):(this.rightListBox.setData(t),this.leftListBox.setData([])),this.isInit=!0),this.popup.showAtEl(this.el)},_adjustRadioLayout:function(){!this.dataGrid&&this.gridId&&(this.dataGrid=mini.get(this.gridId)),this.dataGrid?(mini.removeClass(this._exportRbl.el,"hidden"),this.dataGrid.multiSelect&&this._getSelectedGridIds()?(mini.removeClass(this._rowTr,"hidden"),this._exportRbl.setValue("0")):(mini.addClass(this._rowTr,"hidden"),this._exportRbl.setValue("1"),this.dataGrid.showPager||(mini.addClass(this._curPageTr,"hidden"),mini.addClass(this._pageTr,"hidden")),this._fromNumInput.value=this.dataGrid.getPageIndex()+1)):mini.addClass(this._exportRbl.el,"hidden")},hidePanel:function(){this.removeCls("mini-button-popup"),this.setText(this.collapseText),this.popup.hide()},getColumns:function(){var t=[];if(this.columnsData)t=this.columnsData;else if(this.columnsValue)for(var e=this.columnsValue.split(","),i=this.columnsText.split(","),n=e.length,s=0;s<n;s++)t.push({text:i[s]||e[s],field:e[s]});else this.gridId&&(this.dataGrid||(this.dataGrid=mini.get(this.gridId)),t=this.dataGrid?this._getColumns(this.dataGrid.columns):[]);var o={columns:t};return this.fire("beforeupdatecolumn",o),this.columnsData=t=o.columns},_getColumns:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];s.field?e.push({text:jQuery.trim(s.header),field:s.field}):s.columns&&(s=this._getColumns(s.columns),e=e.concat(s))}return e},setCollapseText:function(t){this.collapseText=t,this&&this.setText(t)},getFileName:function(){return this.fileName},setFileName:function(t){this.fileName=t},setShowIcon:function(t){this.showIcon=t,this&&this.setIconCls(t?this._iconCls:"")},setShowExportModel:function(t){this.showExportModel!=t&&((this.showExportModel=t)?this.exportModelCheck.show():(this.exportModelCheck.hide(),this.exportModelCheck.setChecked(!1)))},getAttrs:function(t){var e=mini.DataExport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["gridId","exportUrl","onbeforeexport","fileName","columnsText","columnsValue","position","expandText","collapseText","onbeforeupdatecolumn","onexportsuccess"]),mini._ParseBool(t,e,["dynamicColumns","showIcon","showExportModel"]),e.text=e.expandText,e.text||(e.text=this.expandText),e}}),mini.regClass(mini.DataExport,"dataexport"),mini.DataImport=function(){mini.DataImport.superclass.constructor.call(this)},mini.extend(mini.DataImport,mini.Control,{uiCls:"mini-dataimport",url:"",pickerText:"导入文件",_create:function(){this.el=document.createElement("div"),this.uploader=new mini.WebUploader,this.uploader.set({uploadUrl:this.url,pickerText:this.pickerText,fileNumLimit:1,limitType:"xls,xlsx,xlsm",showDefaultUI:!1,auto:!1,renderTo:this.el}),this.uploader.on("beforefilequeued",this._onBeforeFileQueued,this),this.uploader.on("filesqueued",this._onFilesQueued,this),this.uploader.on("uploadbeforesend",this._onUploadBeforeSend,this),this.uploader.on("uploadprogress",this._onUploadProgress,this),this.uploader.on("uploadsuccess",this._onUploadSuccess,this),this.uploader._uploadBtn.hide(),this.maskEl=document.createElement("div"),this.maskEl.className="mini-dataimport-mask",this.maskEl.innerHTML='<div class="mini-dataimport-mask-content"></div>',this.maskContent=this.maskEl.firstChild,document.body.appendChild(this.maskEl),this.detailEl=document.createElement("div"),this.detailEl.className="mini-dataimport-detail",this.detailEl.innerHTML='<div class="mini-dataimport-detail-content"></div><i class="dataimport-detail-close">X</i>',this.detailContent=this.detailEl.firstChild,document.body.appendChild(this.detailEl),this._bindEvent()},_bindEvent:function(){var t=this;jQuery(this.maskEl).on("click",".dataimport-showdetail",function(){return t.showDetailStatus(),!1}).on("click",".dataimport-continue",function(){t.isContinueImport=!0,t.uploader._uploader.upload()}).on("click",".dataimport-restart",function(){t.uploader._uploader.upload()}).on("click",function(){t.isImportFinished&&!t.isDetailShow&&(t.maskEl.style.display="none")}),jQuery(this.detailEl).on("click",".dataimport-detail-close",function(){t.hideDetailStatus()}).on("click",".dataimport-status-toggle",function(){var t=$(this),e=t.parent();e.hasClass("opened")?(t.text("展开详情"),e.removeClass("opened")):(t.text("收起详情"),e.addClass("opened"))})},_onFilesQueued:function(t){var e=t.files[0],i=this;e&&(t=this._generateFileList({id:e.id,name:e.name,size:e.size}),this.isImportFinished=!1,this.maskContent.innerHTML=t,this.maskEl.style.display="block",this.uploader._uploader.md5File(e).progress(function(t){}).then(function(t){t={fileMD5:i._curFileMD5=t,fileName:e.name,fileSize:e.size};t[i.uploader.id+"_action"]="queryFileStatus",i.uploader.getCommonData&&(t.commonDto=mini.encode(i.uploader.getCommonData())),i._onPostFileMd5(t),$.ajax(i.url,{dataType:"json",data:t,type:"post",success:function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),i._onQueryFileStatus(t)}})}))},_onPostFileMd5:function(t){this.fire("postfilemd5",{data:t})},_curFileMD5:"",_curAttachGuid:"",_onQueryFileStatus:function(t){t.msg&&mini.alert(t.msg),this.setDetailStatus(t.detail),this._curAttachGuid=t.attachGuid,this._oldAttachGuid=t.attachGuidOld,t.end?this._onFinished(t.status):(t.pollingFrequency&&(this._pollingFrequency=t.pollingFrequency),"importStatus"==t.action?this.pollingStatus(t):"upload"==t.action?this.uploader._uploader.upload():jQuery(this.maskContent).find(".mini-dataimport-action").removeClass("hidden"))},_onUploadBeforeSend:function(t){this.isContinueImport&&(t.data.attachGuid=this._curAttachGuid),t.data.fileMD5=this._curFileMD5},_onUploadProgress:function(t){var e=t.file,i=t.percentage,t=mini.byId(e.id),e=jQuery(".mini-dataimport-progressbar",t),t=jQuery(".progress-text",e),e=jQuery(".progress-body",e),i=Math.round(100*i)+"%";t.text(i),e.width(i)},_generateFileList:function(t){var e=[];return e.push('<div class="mini-dataimport-item">'),e.push('<span class="mini-dataimport-info">'+t.name+"</span>"),e.push('<span class="mini-dataimport-size">('+this._getSize(t.size)+")</span>"),e.push('<span class="mini-dataimport-progressbar"><span class="progress-text">0%</span><div class="progress-body"></div></span>'),e.push('<span class="mini-dataimport-action hidden"><a href="javascript:void(0)" class="dataimport-continue" title="上次导入中断，修改完后继续导入">继续导入</a><a href="javascript:void(0)" class="dataimport-restart" title="重新尝试导入这个文件">重新导入</a><a href="javascript:void(0)" class="dataimport-showdetail hidden">查看详情</a></span>'),e.push("</div>"),e.join("")},_generateImportStatus:function(t){var e=[];return e.push('<div class="mini-dataimport-item">'),e.push('<span class="mini-dataimport-info">'+(t.status||"")+"</span>"),0<=t.handlepercent&&e.push('<span class="mini-dataimport-progressbar"><span class="progress-text">'+t.handlepercent+'%</span><div class="progress-body" style="width:'+t.handlepercent+'%;"></div></span>'),t.end&&e.push('<span class="mini-dataimport-action"><a href="javascript:void(0)" class="dataimport-showdetail">查看详情</a></span>'),e.push("</div>"),e.join("")},_generateStatuslist:function(t){var e,i,n,s=!0,o=!0,l=['<div class="dataimport-status-item">'];if(l.push('<h3 class="dataimport-status-title">'+t.sheetName+"</h3>"),l.push('<h4 class="dataimport-status-type">校验结果：</h4>'),l.push('<p class="dataimport-status-count">总计：'+t.checkCount+"条，成功："+t.checkSuccessCount+"，失败："+t.checkErrorCount+"条。"),(n=t.checkMsg)&&(i=n.length)){for(l.push('<a href="javascript:void(0);" class="dataimport-status-toggle">展开详情</a></p>'),l.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)l.push("<p>"+n[e]+"</p>");l.push("</div>")}else s=!1;if(t.saveCount)if(s||(l.push("</p>"),s=!0),l.push('<h4 class="dataimport-status-type">导入结果：</h4>'),l.push('<p class="dataimport-status-count">总计：'+t.saveCount+"条，成功："+t.saveSuccessCount+"，失败："+t.saveErrorCount+"条。"),(n=t.saveMsg)&&(i=n.length)){for(l.push('<a href="javascript:void(0);" class="dataimport-status-toggle">展开详情</a></p>'),l.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)l.push("<p>"+n[e]+"</p>");l.push("</div>")}else o=!1;if((n=t.taskMsg)&&(i=n.length)){for(l.push('<a href="javascript:void(0);" class="dataimport-status-toggle">展开详情</a></p>'),l.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)l.push("<p>"+n[e]+"</p>");l.push("</div>")}else s&&o||l.push("</p>");return l.push("</div>"),l.join("")},_getSize:function(t){return 1048576<(t=parseInt(t))?(t/1048576).toFixed(2)+"M":(t/1024).toFixed(2)+"K"},_pollingFrequency:1e3,_oldAttachGuid:"",_onUploadSuccess:function(t){var e=t.ret,e=(t.file,(e=(e=mini.getSecondRequestData?mini.getSecondRequestData(e):e).data||e).extraDatas||e);if(this._pollingFrequency=e.pollingFrequency,"importStatus"==e.action)return this._curAttachGuid=e.attachGuid,this._oldAttachGuid=e.attachGuidOld,void this.pollingStatus(e);var i=this;mini.alert("数据导入失败，请重试！","",function(){i._onFinished(e.status),i.maskEl.style.display="none"})},_onFinished:function(t){t=t||"导入已完成",this.isImportFinished=!0,this.maskContent.innerHTML=t+'<a href="javascript:void(0);" class="dataimport-showdetail">查看详情</a>',this._events.importfinished&&this.fire("importfinished"),this.uploader.clearFile()},_onBeforeFileQueued:function(t){this._events.beforefilequeued&&this.fire("beforefilequeued",t)},pollingStatus:function(t){this.maskContent.innerHTML=this._generateImportStatus(t);var e=this,t={fileMD5:this._curFileMD5,attachGuid:this._curAttachGuid,attachGuidOld:this._oldAttachGuid};t[this.uploader.id+"_action"]="importStatus",this.uploader.getCommonData&&(t.commonDto=mini.encode(this.uploader.getCommonData())),jQuery.ajax({url:this.url,data:t,type:"POST",dataType:"json"}).done(function(t){(t=mini.getSecondRequestData?mini.getSecondRequestData(t):t).msg&&mini.alert(t.msg),t.end?e._onFinished(t.status):setTimeout(jQuery.proxy(e.pollingStatus,e,t),e._pollingFrequency),e.setDetailStatus(t.detail)})},setDetailStatus:function(t){this.detailStatus=t,this.isDetailShow&&this.renderDetailStatus()},renderDetailStatus:function(){var t,e=this.detailStatus,i=[],n=0;if(e)for(t=e.length;n<t;n++)i.push(this._generateStatuslist(e[n]));this.detailContent.innerHTML=i.join("")},showDetailStatus:function(){this.renderDetailStatus(),this.detailEl.style.display="block",this.isDetailShow=!0},hideDetailStatus:function(){this.detailEl.style.display="none",this.isDetailShow=!1},setUrl:function(t){this.url=t,this.uploader&&this.uploader.setUploadUrl(t)},getUrl:function(){return this.url},setPickerText:function(t){this.pickerText=t,this.uploader.setPickerText(t)},setEnabled:function(t){mini.CatalogImport.superclass.setEnabled.call(this,t),this.uploader&&this.uploader.setEnabled(t)},getAttrs:function(t){var e=mini.DataImport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","pickerText","onbeforefilequeued","onpostfilemd5","onimportfinished"]),e}}),mini.regClass(mini.DataImport,"dataimport"),mini.DatePicker=function(){mini.DatePicker.superclass.constructor.apply(this,arguments),mini.addClass(this.el,"mini-datepicker"),this.on("validation",this.__OnValidation,this)},mini.extend(mini.DatePicker,mini.ButtonEdit,{valueFormat:"",format:"yyyy-MM-dd",maxDate:"9999-12-31",minDate:"1753-01-01",showTime:!1,timeFormat:"H:mm",showYesterdayButton:!1,showTodayButton:!0,showClearButton:!0,showOkButton:!1,firstDayOfWeek:0,valueType:"date",formField:!0,allowInput:!0,uiCls:"mini-datepicker",_create:function(){mini.DatePicker.superclass._create.call(this),this.externalSrc=this.externalSrc||mini.externalSrc;var t=this;window.laydate?this._init():mini.loadJS(this.externalSrc+"laydate/laydate.js",function(){t._init()})},_init:function(){var n=this,t={elem:this._textEl,format:this._translateToLaydateFormat(this.format),readOnly:this.readOnly,enabled:this.enabled,btns:this._getBtns(),trigger:"click",ready:function(t){n._onLaydateReady(t),n.showPopup()},done:function(t,e,i){n._onLaydateDone(t,e,i),n._tryValidate()},onHide:function(){n.hidePopup()},drawdate:function(t,e){t={allowSelect:!0,date:mini.parseDate(t.year+"-"+t.month+"-"+t.date),dom:e};n.fire("drawdate",t),t.allowSelect||mini.addClass(e,"laydate-disabled")}};this.minDate&&(t.min=mini.formatDate(new Date(this.minDate),"yyyy-MM-dd HH:mm:ss")),this.maxDate&&(t.max=mini.formatDate(new Date(this.maxDate),"yyyy-MM-dd HH:mm:ss")),this._beforeLaydateRender(t),this.laydate=laydate.render(t),this._fixedHoverScroller(),this._fixedTimeScrollPos()},_translateToLaydateFormat:function(t){return t.replace(/(y)\1{1}/g,function(t,e,i,n){return"y"===n.charAt(i-1)||"y"===n.charAt(i+2)?"yy":"y"})},_onLaydateReady:function(t){},_onLaydateDone:function(t,e,i){this.setValue(t),this._oldValue!==this.value&&(this.fire("valuechanged",{value:this.value,oldValue:this._oldValue}),this._oldValue=this.value)},_beforeLaydateRender:function(t){this.showTime&&(t.type="datetime",this.showOkButton=!0,t.btns=this._getBtns())},_fixedHoverScroller:function(){var t=mini._scrollBarWidth,e="fixed-hover-scroller-for-daterange";t&&!$("#"+e).length&&(t=[".laydate-time-list li ol {","margin-right: "+t+"px}",".laydate-time-list>li:hover ol{","margin-right:0;}"].join(""),$('<style id="'+e+'">'+t+"</style>").appendTo("head"))},_fixedTimeScrollPos:function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.setTimeout;function t(t){var s=$(t.target||t.srcElement);s.closest(".laydate-time-list > li li").length&&e(function(){var t,e,i,n;e=(t=s).position().top,i=t.outerHeight(!0),t=(n=t.parent())[0].offsetHeight,0<e&&e<t-i||(n[0].scrollTop=n[0].scrollTop+e)})}return document.addEventListener?function(){document.removeEventListener("click",t,!0),document.addEventListener("click",t,!0)}:function(){}}(),showPopup:function(){var t=jQuery(this.el).find(".mini-buttonedit-button")[0];t&&mini.addClass(t,this._buttonPressedCls);var e=".daterange-"+this.id;$("html, body, .fui-content").on("scroll"+e,function(){$("body").trigger("click"),$("html, body, .fui-content").off("scroll"+e)}),this.fire("showPopup")},hidePopup:function(){var t=jQuery(this.el).find(".mini-buttonedit-button")[0];t&&mini.removeClass(t,this._buttonPressedCls),this.fire("hidePopup")},_monthPicker:!1,within:function(t){return!!mini.isAncestor(this.el,t.target)||!!mini.isAncestor(this.laydate._laydate.elem,t.target)},minDateErrorText:"",maxDateErrorText:"",__OnValidation:function(t){var e,i,n,s,o;!1!==t.isValid&&(e=this.value,mini.isDate(e)&&(i=mini.parseDate(this.maxDate),n=mini.parseDate(this.minDate),s=this.maxDateErrorText||mini.VTypes.maxDateErrorText,o=this.minDateErrorText||mini.VTypes.minDateErrorText,mini.isDate(i)&&e.getTime()>i.getTime()&&(t.isValid=!1,t.errorText=String.format(s,mini.formatDate(i,this.format))),mini.isDate(n)&&e.getTime()<n.getTime()&&(t.isValid=!1,t.errorText=String.format(o,mini.formatDate(n,this.format)))))},setFormat:function(t){"string"==typeof t&&this.format!==t&&(this.format=t,this._textEl.value=this.getFormValue(),this._updateLaydateFormat())},_updateLaydateFormat:function(){var i,n="yyyy|y|MM|M|dd|d|HH|H|mm|m|ss|s";this.laydate&&(this.laydate.config.format=this._translateToLaydateFormat(this.format),(i=this.laydate._laydate).format=this.laydate.config.format.match(new RegExp(n+"|.","g"))||[],i.EXP_IF="",i.EXP_SPLIT="",mini.forEach(i.format,function(t,e){t=new RegExp(n).test(t)?"\\d{"+(new RegExp(n).test(i.format[0===e?e+1:e-1]||"")?/^yyyy|y$/.test(t)?4:t.length:/^yyyy$/.test(t)?"1,4":/^y$/.test(t)?"1,308":"1,2")+"}":"\\"+t;i.EXP_IF=i.EXP_IF+t,i.EXP_SPLIT=i.EXP_SPLIT+"("+t+")"}),i.EXP_IF=new RegExp("^"+(this.delimiter?i.EXP_IF+"\\s\\"+this.delimiter+"\\s"+i.EXP_IF:i.EXP_IF)+"$"),i.EXP_SPLIT=new RegExp("^"+i.EXP_SPLIT+"$",""))},getFormat:function(){return this.format},setValueFormat:function(t){"string"==typeof t&&this.valueFormat!==t&&(this.valueFormat=t)},getValueFormat:function(){return this.valueFormat},_oldValue:"",setValue:function(t){this.getFormValue()!==t&&("date"===this.valueType?t=mini.parseDate(t):mini.isDate(t)&&(t=mini.formatDate(t,this.format)),mini.isNull(t)&&(t=""),mini.isDate(t)&&(t=new Date(t.getTime()),mini.isDate(t)&&isNaN(t.getTime())&&(t="")),this.value=t),this.text=this.getFormValue(),this._textEl.value=this.text},nullValue:"",setNullValue:function(t){this.nullValue=t="null"===t?null:t},getNullValue:function(){return this.nullValue},getValue:function(){if("date"!==this.valueType)return this.value;if(!mini.isDate(this.value))return this.nullValue;var t=this.value;return t=this.valueFormat?mini.formatDate(t,this.valueFormat):t},getFormValue:function(t){return"date"!==this.valueType?this.value:mini.isDate(this.value)?(t=t||this.format,mini.formatDate(this.value,t)):""},setViewDate:function(t){},getViewDate:function(){},setShowTime:function(t){this.showTime!==t&&(this.showTime=t,this._updateLaydateShowTime())},_updateLaydateShowTime:function(){this.laydate&&(this.showTime?(this.laydate.config.type="datetime",this.showOkButton=!0,this.laydate.config.btns=this._getBtns()):this.laydate.config.type="date")},getShowTime:function(){return this.showTime},setTimeFormat:function(t){this.timeFormat!==t&&(this.timeFormat=t)},getTimeFormat:function(){return this.timeFormat},setShowYesterdayButton:function(t){this.showYesterdayButton=t},getShowYesterdayButton:function(){return this.showYesterdayButton},setShowTodayButton:function(t){this.showTodayButton=t,this._updateLaydateBtns()},getShowTodayButton:function(){return this.showTodayButton},setShowClearButton:function(t){this.showClearButton=t,this._updateLaydateBtns()},getShowClearButton:function(){return this.showClearButton},setShowOkButton:function(t){this.showOkButton=t,this._updateLaydateBtns()},getShowOkButton:function(){return this.showOkButton},_getBtns:function(){var t=[];return this.showClearButton&&t.push("clear"),this.showTodayButton&&t.push("now"),this.showOkButton&&t.push("confirm"),t},_updateLaydateBtns:function(){this.laydate&&(this.laydate.config.btns=this._getBtns())},setShowWeekNumber:function(t){this.showWeekNumber=t},getShowWeekNumber:function(){return this.showWeekNumber},setMaxDate:function(t){this.maxDate=t,this.laydate&&(t=new Date(this.maxDate),this.laydate.config.max={year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),hours:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds()})},getMaxDate:function(){return this.maxDate},setMinDate:function(t){this.minDate=t,this.laydate&&(t=new Date(this.minDate),this.laydate.config.min={year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),hours:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds()})},getMinDate:function(){return this.minDate},setMaxDateErrorText:function(t){this.maxDateErrorText=t},getMaxDateErrorText:function(){return this.maxDateErrorText},setMinDateErrorText:function(t){this.minDateErrorText=t},getMinDateErrorText:function(){return this.minDateErrorText},setEnabled:function(t){mini.DatePicker.superclass.setEnabled.call(this,t),this.laydate&&(this.laydate.config.enabled=t)},_OnButtonClick:function(t){t.stopPropagation();t={htmlEvent:t,cancel:!1};this.fire("beforebuttonclick",t),1!=t.cancel&&(this.fire("buttonclick",t),jQuery(this._textEl).trigger("click"))},__OnInputTextChanged:function(t){var e,i=this._textEl.value;"date"==this.valueType&&((e=mini.parseDate(i))&&!isNaN(e)||(e=null)),this.setValue(i)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8===t.keyCode&&(this.isReadOnly()||!1===this.allowInput))return!1;if(9!==t.keyCode){if(!this.isReadOnly())switch(t.keyCode){case 27:t.preventDefault(),this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 9:case 13:this.__OnInputTextChanged(null);var i=this;setTimeout(function(){i.fire("enter",e)},10);break;case 37:break;case 38:t.preventDefault();break;case 39:break;case 40:this.keyNavEnabled&&(t.preventDefault(),this.showPopup())}}else this.isShowPopup()&&this.hidePopup()},setReadOnly:function(t){mini.DatePicker.superclass.setReadOnly.call(this,t),this.laydate&&(this.laydate.config.readOnly=t)},getAttrs:function(t){var e=mini.DatePicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["format","viewDate","timeFormat","ondrawdate","minDate","maxDate","valueType","valueFormat","nullValue","minDateErrorText","maxDateErrorText"]),mini._ParseBool(t,e,["showTime","showTodayButton","showClearButton","showOkButton","showWeekNumber","showYesterdayButton","allowInput"]),e}}),mini.regClass(mini.DatePicker,"datepicker"),mini.MonthPicker=function(){mini.MonthPicker.superclass.constructor.apply(this,arguments)},mini.extend(mini.MonthPicker,mini.DatePicker,{uiCls:"mini-monthpicker",valueFormat:"",format:"yyyy-MM",_monthPicker:!0,showOkButton:!0,_beforeLaydateRender:function(t){t.type="month"}}),mini.regClass(mini.MonthPicker,"monthpicker"),mini.DateRangePicker=function(){mini.DateRangePicker.superclass.constructor.call(this)},mini.extend(mini.DateRangePicker,mini.DatePicker,{uiCls:"mini-daterangepicker",rangeType:"date",delimiter:"~",showOkButton:!0,set:function(t){if("string"==typeof t)return this;var e=t.rangeType;delete t.rangeType;var i=t.format;return delete t.format,mini.DateRangePicker.superclass.set.call(this,t),mini.isNull(e)||this.setRangeType(e),mini.isNull(i)||this.setFormat(i),this},_onLaydateReady:function(t){var e=$(".laydate-footer-btns");e.length&&$('<span class="laydate-footer-tips">注：点击某日期两次代表选择某一天</span>').insertBefore(e)},_onLaydateDone:function(t,e,i){this.setValue({startDate:this._formatDate(e),endDate:this._formatDate(i)})},_beforeLaydateRender:function(t){this.showTime&&(t.type="datetime"),t.range=this.delimiter},_formatDate:function(t){if(!t||function(t){for(var e in t)return;return 1}(t))return"";var e=this.format.replace(/yyyy/g,t.year);return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/yy/g,(t.year+"").substring(2))).replace(/MM/g,t.month<10?"0"+t.month:t.month)).replace(/M/g,t.month)).replace(/dd/g,t.date<10?"0"+t.date:t.date)).replace(/d/g,t.date)).replace(/HH/g,t.hours<10?"0"+t.hours:t.hours)).replace(/H/g,t.hours)).replace(/mm/g,t.minutes<10?"0"+t.minutes:t.minutes)).replace(/m/g,t.minutes)).replace(/ss/g,t.seconds<10?"0"+t.seconds:t.seconds)).replace(/s/g,t.seconds)},setFormat:function(t){this.format=t,this.laydate&&(this.laydate.config.format=this._translateToLaydateFormat(t))},_translateToLaydateFormat:function(t){return t.replace(/(y)\1{1}/g,function(t,e,i,n){return"y"==n.charAt(i-1)||"y"==n.charAt(i+2)?"yy":"y"})},setMinDate:function(t){this.minDate=mini.parseDate(t),this.laydate&&(this.laydate.config.min={year:this.minDate.getFullYear(),month:this.minDate.getMonth(),date:this.minDate.getDate(),hours:this.minDate.getHours(),minutes:this.minDate.getMinutes(),seconds:this.minDate.getSeconds()})},setMaxDate:function(t){this.maxDate=mini.parseDate(t),this.laydate&&(this.laydate.config.max={year:this.maxDate.getFullYear(),month:this.maxDate.getMonth(),date:this.maxDate.getDate(),hours:this.maxDate.getHours(),minutes:this.maxDate.getMinutes(),seconds:this.maxDate.getSeconds()})},setRangeType:function(t){this.rangeType=t,this.laydate&&(this.laydate.config.type=t),"datetime"==t?(this.format="yyyy-MM-dd HH:mm",this.showTime=!0):this.showTime=!1},setShowTime:function(t){this.showTime!==t&&(this.showTime=t,this.showTime?this.rangeType="datetime":this.rangeType="date")},_oldValue:{startDate:"",endDate:""},value:{startDate:"",endDate:""},setValue:function(t){(t="string"==typeof t?mini.JSON.decode(t):t).startDate&&t.endDate?(this.value={startDate:mini.formatDate(mini.parseDate(t.startDate),this.format),endDate:mini.formatDate(mini.parseDate(t.endDate),this.format)},this.text=this.value.startDate+" "+this.delimiter+" "+this.value.endDate):(this.value={startDate:"",endDate:""},this.text=""),this.value.startDate==this._oldValue.startDate&&this.value.endDate==this._oldValue.endDate||(this._oldValue=this.value,this.fire("valuechanged",{value:this.value,oldValue:this._oldValue}),this._oldValue=this.value),this._textEl.value=this.text},getValue:function(){return this.value},getText:function(){return this._textEl.value},validate:function(){var t={value:this.getValue(),errorText:"",isValid:!0};return this.required&&(""!==String(t.value.startDate).trim()&&""!==String(t.value.endDate).trim()||(t.isValid=!1,t.errorText=this.requiredErrorText)),this.fire("validation",t),this.errorText=t.errorText,this.setIsValid(t.isValid),this.isValid()},getAttrs:function(t){var e=mini.DateRangePicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["rangeType","format","minDate","maxDate","onvaluechanged","emptyText","onShowPopup","onHidePopup"]),e}}),mini.regClass(mini.DateRangePicker,"daterangepicker"),mini.FilterTree=function(){mini.FilterTree.superclass.constructor.call(this),this.initComponents(),this.bindEvents()},mini.extend(mini.FilterTree,mini.Tree,{filterMode:"client",filterUrl:"",height:"100%",emptyText:"请输入内容查询",uiCls:"mini-filtertree",initComponents:function(){var t='<input name="filterInput" class="mini-buttonedit mini-filtertree-filter" emptyText="'+this.emptyText+'" />';this.set({showToolbar:!0,toolbar:t})},_filterKey:"",bindEvents:function(){var e=this;this._filterInput=mini.getbyName("filterInput",this),this._filterInput.on("enter",function(){var t=e._filterInput._textEl.value;e._doFilter(t)}),this._filterInput.on("buttonclick",function(){var t=e._filterInput._textEl.value;e._doFilter(t)}),this.on("load",function(t){var e=t.data;t.xhr&&"client"===this.filterMode&&(this._initialData=mini.clone(e))})},setData:function(t){mini.FilterTree.superclass.setData.call(this,t),"client"===this.filterMode&&(this._initialData=mini.clone(t))},_doFilter:function(o){var l,r=this;r._filterKey=o,"server"==r.filterMode?(l={data:{search_condition:o},url:r.getFilterUrl(),sender:r,cancel:!1},r.fire("serverfilter",l),l.cancel||(r.fire("beforeload",l),jQuery.ajax({url:l.url,data:l.data,type:"post",success:function(t,e,i){t&&"null"!=t||(t="{ tatal: 0, data: [] }"),delete l.params;var n={text:t,result:null,sender:r,options:l,xhr:i},i=null;try{mini_doload(n),i=(i=n.result)||mini.decode(t)}catch(s){1==mini_debugger&&alert(url+"\n json is error.")}mini.isArray(i)&&(i={data:i}),r.dataField&&(i.data=mini._getMap(r.dataField,i)),i.data||(i.data=[]);i={data:i.data,cancel:!1,result:i};r.fire("preload",i),1!=i.cancel&&(r.getResultAsTree()?r.loadData(i.data):r.loadList(i.data),r.fire("filter"),""!==o&&r.expandAll())}}))):(""===o?(r.clearFilter(),r.isFilter=!1):(o=mini.htmlEncode(o.toLowerCase()),r.filter(function(t){if(-1!=(t.text?t.text.toLowerCase():"").indexOf(o))return!0}),r.expandAll(),r.isFilter=!0),r.fire("filter"))},_OnCellClick:function(t){if(!mini.findParent(t.htmlEvent.target,this._eciconCls)){var e,i;if(this._filterKey&&(e=t.record[this.nodesField]))for(var n=0,s=e.length;n<s;n++)i=e[n][this.textField],e[n][this.textField]=i.replace(/<\/?.+?>/g,"");mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.checkOnTextClick?this._tryToggleCheckNode(t.record):this.fire("cellclick",t)}},_OnDrawCell:function(t,e,i,n){i=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);return this._treeColumn&&this._treeColumn==e.name&&(!1===(n=i.node).ckr&&(i.showCheckBox=!1,i.showRadioButton=!1),this._filterKey&&(e=t[e.field],/<[^>]+>/.test(e)||(i.nodeHtml=e.replace(new RegExp("("+this._filterKey.replace(/\\/g,"\\\\").replace(/\$/g,"\\$").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\./g,"\\.").replace(/\[/g,"\\[").replace(/\?/g,"\\?").replace(/\^/g,"\\^").replace(/\{/g,"\\{").replace(/\|/g,"\\|").replace(/</g,"&lt;").replace(/>/g,"&gt;")+")","gi"),'<span class="mini-highlight">$1</span>'))),this.fire("drawnode",i),i.nodeStyle&&(i.cellStyle=i.nodeStyle),i.nodeCls&&(i.cellCls=i.nodeCls),i.nodeHtml?i.cellHtml=i.nodeHtml:n.textCls&&(i.cellHtml='<span class="'+n.textCls+'">'+i.cellHtml+"</span>"),this._createTreeColumn(i)),i},clearFilter:function(){(this._filterKey||this.isFilter)&&(this._filterInput.setValue(""),this._filterInput.setText(""),this._filterKey="",mini.FilterTree.superclass.clearFilter.call(this),"server"===this.filterMode?this.reload():this._initialData&&this.setData(this._initialData))},getFilterUrl:function(){return this.filterUrl||this.url},setFilterUrl:function(t){this.filterUrl=t},getFilterMode:function(){return this.filterMode},setFilterMode:function(t){this.filterMode=t},setEmptyText:function(t){this.emptyText!=t&&(this._filterInput.emptyText=this.emptyText=t,this._filterInput._doEmpty())},getEmptyText:function(){return this.emptyText},getAttrs:function(t){var e=mini.FilterTree.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["filterMode","filterUrl","emptyText","onserverfilter"]),e.filterUrl||(e.filterUrl=e.url),e}}),mini.regClass(mini.FilterTree,"filtertree"),mini.ImageUploader=function(){mini.ImageUploader.superclass.constructor.call(this)},mini.extend(mini.ImageUploader,mini.Control,{uiCls:"mini-imageuploader",actionButtons:[{icon:"icon-upload",name:"上传",role:"reselect"},{icon:"icon-trash",name:"删除",role:"remove"}],maxBtnNum:3,imageWidth:80,imageHeight:80,limitWidth:NaN,limitHeight:NaN,accept:"image/*",fileNumLimit:undefined,fileSizeLimit:undefined,multiple:!1,serverFileNum:0,data:[],STATE_TEXT:{PEDDING:"pedding",UPLOADING:"UPLOADING",DONE:"done",FAIL:"fail"},_dealUrl:function(t){return t},_initToolTip:function(){mini.ImageUploader.tooltip||(mini.ImageUploader.tooltip=new mini.ToolTip).set({target:document.body,trigger:"hover",selector:".mini-imageuploader [data-tooltip]",placement:"top",autoHide:!0})},_create:function(){this.externalSrc=this.externalSrc||mini.externalSrc,this._fileIdPrefix=this.id+"$file$",this._fileIndex=0,this._initToolTip(),this._createInput(),this.el=document.createElement("div"),this.el.innerHTML='<div class="mini-imageuploader-list"><label class="mini-imageuploader-addbutton action-icon icon-add"></label></div>',this._listEl=this.el.firstChild,this.el.appendChild(this._fileInput),this._$addBtn=jQuery(this.el).find(".mini-imageuploader-addbutton"),this._$addBtn.css({width:this.imageWidth||"auto",height:this.imageHeight||"auto",lineHeight:this.imageHeight?this.imageHeight+"px":""}).attr({"for":this.id+"$file"}),mini.on(this._$addBtn[0],"click",this.__onAddBtnClick,this),this.on("change",this.__onFileChange,this)},setActionButtons:function(t){var n=this,s=this.id+"$action$more";this.actionButtons=t;var e,i=this.actionButtonsMap={};if(jQuery.each(t,function(t,e){e.id||(e.id=this.id+"$action$"+(t+1)),i[e.id]=e}),console.log("_initActionBtn"),jQuery(this.el).off("click",".mini-imageuploader-btn").on("click",".mini-imageuploader-btn",function(t){var e=t.target,i=e.getAttribute("data-id");i!==s?(t=n.actionButtonsMap[i])&&((i=t.role)?n.handleActionBtnClick(i,n._genderActionBtnEventData(e)):"function"==typeof(t="function"!=typeof(t=t.handle)?window[t]:t)&&t.call(n,n._genderActionBtnEventData(e))):n._showActionPopup(e)}),!(this.actionButtons.length>this.maxBtnNum))return e=jQuery.map(this.actionButtons,function(t){return'<span class="mini-imageuploader-btn action-icon '+t.icon+'" data-tooltip="'+t.name+'" data-id="'+t.id+'"></span>'}).join(""),void(this._actionBtnHtml=e);var o=this.actionButtons.slice(0,this.maxBtnNum-1);o.push({id:s,icon:"icon-omit",handle:this._showActionPopup,name:"更多"});t=this.actionButtons.slice(this.maxBtnNum-1);this._initActonBtnPopup(t),e=jQuery.map(o,function(t){return'<span class="mini-imageuploader-btn action-icon '+t.icon+'" data-tooltip="'+t.name+'" data-id="'+t.id+'"></span>'}).join(""),this._actionBtnHtml=e},_genderActionBtnEventData:function(t){var e=jQuery(t),i=this.actionButtonsMap[e.attr("data-id")],t=e.closest(".mini-imageuploader-item"),n=t.attr("file-id"),s=t.attr("file-guid"),e=this.data.filter(function(t){return t.id==n||t.attachGuid==s})[0];return{sender:this,source:this,icon:i,file:e,fileEl:t[0]}},_initActonBtnPopup:function(t){var n,e,i;this.__extMenuInited||(n=this,(e=new mini.Menu).set({minWidth:50,yOffset:4}),e.setItems($.map(t,function(t){return{id:t.id,text:t.name,iconCls:t.icon}})),e.on("itemclick",function(t){var e=t.item.id,i=t.sender.popupEl,t=n.actionButtonsMap[e];t&&((e=t.role)?n.handleActionBtnClick(e,n._genderActionBtnEventData(i)):"function"==typeof(t="function"!=typeof(t=t.handle)?window[t]:t)&&t.call(n,n._genderActionBtnEventData(i)))}),i=e.hide,e.hide=function(){i.apply(this,arguments),jQuery(n.el).find(".mini-imageuploader-btn").removeClass("active")},this.__extMenu=e,this.__extMenuInited=!0,this._showActionPopup=function(t){e.popupEl=t,e.showAtEl(t),jQuery(t).addClass("active")})},handleActionBtnClick:function(t,e){var i=this;switch(t){case"remove":mini.confirm("确定移除此图片？","删除提醒",function(t){"ok"==t&&i.removeImage(e.file)});break;case"reselect":this.reselectImage(e.file)}},_getFileData:function(t){for(var e=null,i=0,n=this.data.length;i<n;i++){var s=this.data[i];if(s.id===t){e=s;break}}return e},_removeFileData:function(t){for(var e=!1,i=0,n=this.data.length;i<n;i++)if(this.data[i].id===t){this.data.splice(i,1),e=!0;break}return e},removeImage:function(t){var e="string"!=typeof t?t.id:t,t=this._removeFileData(e);return t&&this.serverFiles[e]&&(delete this.serverFiles[e],this.serverFileNum--),jQuery(this.el).find('.mini-imageuploader-item[file-id="'+e+'"]').remove(),t&&this._updateAddBtnState(),t},reselectImage:function(t){var i="string"!=typeof t?t.id:t,n=this,s=(this._getFileData(i),jQuery(this.el).find('.mini-imageuploader-item[file-id="'+i+'"]'));this._fileInput.removeAttribute("multiple"),this.on("selectFile",function o(t){t.cancel=!0,n.setMultiple(n.multiple),n.un("selectFile",o,this);var e=t.files;if(e.length)return 1<e.length?mini.alert("你选择的图片文件过多，只能选择一个"):(t=t.files[0],n.fileSizeLimit&&t.size>1024*n.fileSizeLimit?mini.alert("选中的图片文件过大，最大允许上传"+this.fileSizeLimit+"KB的图片"):void n._validateWidthHeight(t).then(function(t){var e={sender:n,source:n,cancel:!1,type:"beforefilequeued",file:t};n.fire("beforefilequeued",e),e.cancel||(t.fromServer=!1,t.state=n.STATE_TEXT.PEDDING,n.data.push(t),n._removeFileData(i),e=n._genderImgEl(t,s[0]),n._doUpload(t,e))}))},this);t=document.createElement("label");t.setAttribute("for",this._fileInput.id),document.body.appendChild(t),t.click(),document.body.removeChild(t)},__onAddBtnClick:function(t){this.multi||(this._fileInput.files&&this._fileInput.files.length||this.data&&this.data.length||$(this._listEl).find(".mini-imageuploader-item").length)&&t.preventDefault()},_createInput:function(){this._fileInput=document.createElement("input"),this._fileInput.style.cssText="display:none",this._fileInput.setAttribute("type","file"),this._fileInput.setAttribute("accept",this.accept),this.multiple?this._fileInput.setAttribute("multiple",""):this._fileInput.removeAttribute("multiple"),this._fileInput.id=this.id+"$file";var i=this;jQuery(this._fileInput).on("change",function n(t){var e=t.originalEvent,t={files:this.files,cancel:!1};i.fire("selectFile",t),t.cancel||i.fire("change",t);e=e.target.cloneNode(!0);e.value=null,this.parentNode.replaceChild(e,this),jQuery(i._fileInput).off(),i._fileInput=e,jQuery(i._fileInput).on("change",n)})},_getFileWrapper:function(t){return{id:this._fileIdPrefix+ ++this._fileIndex,name:t.name,size:t.size,type:t.type,ext:t.name.substr(t.name.lastIndexOf(".")+1),file:t}},_validateWidthHeight:function(t){var e=this._getFileWrapper(t),i=jQuery.Deferred();if(!this.limitWidth||!this.limitHeight)return i.resolve(e),i.promise();var n=this,s=new Image,o=URL.createObjectURL(e.file);return s.onload=function(){s.onload=null,s.onerror=null,URL.revokeObjectURL(o),e.width=s.width,e.height=s.height;var t={sender:n,source:n,isValid:s.width===n.limitWidth&&s.height===n.limitHeight,width:s.width,height:s.height};t.errorText=t.isValid?"":"图片宽高校验失败，只允许上传"+n.limitWidth+"px *"+n.limitHeight+"px的图片",n.fire("limitValidation",t),t.isValid?i.resolve(e):(mini.showTips({content:t.errorText,state:"danger"}),i.reject(e))},s.onerror=function(t){s.onload=null,s.onerror=null,URL.revokeObjectURL(o),i.reject(t),console.log(t)},s.src=o,i.promise()},__onFileChange:function(t){t=t.files;console.log(t),t.length&&(t.length+this.data.length>this.fileNumLimit?mini.showTips({content:"您选择的文件过多，最多还能选择 "+(this.fileNumLimit-this.data.length)+" 个图片",state:"danger"}):this.__doFilesAdd(t))},__doFilesAdd:function(e){this._filesQueue=[];var i,n=this;this._validateImageSize(e)&&(i=0,function s(){if(i<e.length){var t=e[i++];return n.__fileQueue(t).then(s)}}().then(function(){var t={sender:n,source:n,type:"filesqueued",files:n._filesQueue};n.fire("filesqueued",t),n._updateAddBtnState(),n.__doFilesUpload()}))},_validateImageSize:function(t){if(this.fileSizeLimit)for(var e=1024*this.fileSizeLimit,i=0,n=t.length;i<n;i++)if(t[i].size>e)return mini.alert("选中的图片文件过大，最大允许上传"+this.fileSizeLimit+"KB的图片"),!1;return!0},__fileQueue:function(t){var i=$.Deferred(),n=this;return this._validateWidthHeight(t).then(function(t){console.log("beforefilequeued");var e={sender:n,source:n,cancel:!1,type:"beforefilequeued",file:t};if(n.fire("beforefilequeued",e),e.cancel)return i.resolve();t.fromServer=!1,t.state=n.STATE_TEXT.PEDDING,n._filesQueue.push(t),n.data.push(t),i.resolve()},function(){i.resolve()}),i.promise()},_updateAddBtnState:function(){this.multiple?this.data.length>=this.fileNumLimit?this._$addBtn.hide():this._$addBtn.show():(this._fileInput.files&&this._fileInput.files.length||this.data&&this.data.length||$(this._listEl).find(".mini-imageuploader-item").length)&&this._$addBtn.hide()},__doFilesUpload:function(){for(var t=0,e=this._filesQueue.length;t<e;t++){var i=this._filesQueue[t];this._doUpload(i,this._genderImgEl(i))}},_genderItemEl:function(t){var e,i=document.createElement("div");return i.className="mini-imageuploader-item",jQuery(i).css({width:this.imageWidth||"auto",height:this.imageHeight||"auto"}),i.innerHTML='<div class="mini-imageuploader-btns">'+this._actionBtnHtml+"</div>",i.setAttribute("file-id",t.id),t.fileGuid&&i.setAttribute("file-guid",t.fileGuid),t.downloadUrl&&((e=document.createElement("img")).className="mini-imageuploader-img",e.src=this._dealUrl(t.downloadUrl),i.insertAdjacentElement("afterbegin",e)),i},_genderImgEl:function(t,e){var i=t.file,t=this._genderItemEl(t),n=document.createElement("img");n.className="mini-imageuploader-img";var s=URL.createObjectURL(i);return n.onload=function(){n.onload=null,URL.revokeObjectURL(s)},n.src=s,t.insertAdjacentElement("afterbegin",n),e?jQuery(e).replaceWith(t):jQuery(t).insertBefore(this._$addBtn),t},_doUpload:function(i,n){var t=i.file,s=this,e=jQuery(n).find(".mini-imageuploader-img")[0],o=new FormData;o.append("file",t),this.fire("beforeUpload",{sender:this,source:this,formData:o}),jQuery.ajax({method:"post",url:this.uploadUrl,contentType:!1,processData:!1,dataType:"json",data:o,xhr:function(){var t=new XMLHttpRequest;return t.upload.onloadstart=function(){i.state=s.STATE_TEXT.UPLOADING},t.upload.onprogress=function(t){var e=t.loaded/t.total,t=(100*e).toFixed(2)+"%";console.log(e,t),i.progress=e,s.fire("uploadprogress",{progress:e,percent:t,file:i,fileEl:n})},t}}).done(function(t){console.log(t),URL.revokeObjectURL(e.src),e.src=t.downloadUrl,i.progress<1&&(i.progress=1,s.fire("uploadprogress",{progress:1,percent:"100%",file:i,fileEl:n})),i.state=s.STATE_TEXT.DONE,s.fire("uploaderror",{type:"uploaderror",sender:s,source:s,file:i,fileEl:n})}).fail(function(t){console.error(t),i.state=s.STATE_TEXT.FAIL,s.fire("uploaderror",{type:"uploaderror",sender:s,source:s,file:i,fileEl:n})})},getData:function(){return this.data||[]},setData:function(t){if(!jQuery.isArray(t))return!1;var e=$.map(t,function(t){return{fromServer:!0,id:t.attachGuid,state:"success",size:t.attachLength,width:t.width,height:t.height,date:t.uploadDateTime,fileGuid:t.attachGuid,downloadUrl:t.downloadUrl}}),i=this.data=e;this.serverFileNum=this.data.length,this._updateAddBtnState();var n,s=document.createDocumentFragment();this.serverFiles={};for(var o=0,l=i.length;o<l;o++)n=i[o],this.serverFiles[n.fileGuid]=n,s.appendChild(this._genderItemEl(n));this._$addBtn.parent().empty(),this._listEl.appendChild(s),this._listEl.appendChild(this._$addBtn[0]),this.fire("load",{sender:this,eventType:"load",data:t})},getMultiple:function(){return this.multiple},setMultiple:function(t){this.multiple=!0===t,this.multiple?this._fileInput.setAttribute("multiple",""):this._fileInput.removeAttribute("multiple")},getFileNumLimit:function(){return this.fileNumLimit},setFileNumLimit:function(t){if(!jQuery.isNumeric(t))return!1;this.fileNumLimit=t},getFileSizeLimit:function(){return this.fileSizeLimit},setFileSizeLimit:function(t){if(!jQuery.isNumeric(t))return!1;this.fileSizeLimit=t},getImageWidth:function(){return this.imageWidth},setImageWidth:function(t){if(!jQuery.isNumeric(t))return!1;this.imageWidth=t,this._$addBtn.css({width:this.imageWidth}),jQuery(this.el).find(".mini-imageuploader-item").css({width:this.imageWidth})},getImageHeight:function(){return this.imageHeight},setImageHeight:function(t){if(!jQuery.isNumeric(t))return!1;this.imageHeight=t,this._$addBtn.css({height:this.imageHeight,lineHeight:this.imageHeight+"px"}),jQuery(this.el).find(".mini-imageuploader-item").css({height:this.imageHeight})},getAttrs:function(t){var e=mini.ImageUploader.superclass.getAttrs.call(this,t);console.log("getAttrs");var i=jQuery(t).children('[type="button"]'),n=[];return $.each(i,function(t,e){"button"==e.getAttribute("type")&&n.push({icon:e.getAttribute("icon"),name:e.getAttribute("title")||e.innerText,role:e.getAttribute("role"),handle:e.getAttribute("onclick")})}),n.length?e.actionButtons=n:this.setActionButtons(this.actionButtons),mini._ParseInt(t,e,["imageWidth","imageHeight","limitWidth","limitHeight","fileNumLimit","fileSizeLimit","maxBtnNum"]),mini._ParseBool(t,e,["multiple"]),mini._ParseString(t,e,["accept","uploadUrl","onLimitValidation","onbeforefilequeued","onFilesQueued","onbeforeUpload","onuploadprogress","onuploadprogress","onuploaderror"]),e}}),mini.regClass(mini.ImageUploader,"imageuploader"),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(b){var n,t=navigator.userAgent,E=/iphone/i.test(t),T=/chrome/i.test(t),S=/android/i.test(t);b.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},b.fn.extend({caret:function(t,e){var i;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof t?(e="number"==typeof e?e:t,this.each(function(){this.setSelectionRange?this.setSelectionRange(t,e):this.createTextRange&&((i=this.createTextRange()).collapse(!0),i.moveEnd("character",e),i.moveStart("character",t),i.select())})):(this[0].setSelectionRange?(t=this[0].selectionStart,e=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),t=0-i.duplicate().moveStart("character",-1e5),e=t+i.text.length),{begin:t,end:e})},unmask:function(){return this.trigger("unmask")},mask:function(e,g){var i,_,v,y,w,C,x;if(!e&&0<this.length){var t=b(this[0]).data(b.mask.dataName);return t?t():void 0}return g=b.extend({autoclear:b.mask.autoclear,placeholder:b.mask.placeholder,completed:null},g),i=b.mask.definitions,_=[],v=C=e.length,y=null,b.each(e.split(""),function(t,e){"?"==e?(C--,v=t):i[e]?(_.push(new RegExp(i[e])),null===y&&(y=_.length-1),t<v&&(w=_.length-1)):_.push(null)}),this.trigger("unmask").each(function(){function l(){if(g.completed){for(var t=y;t<=w;t++)if(_[t]&&m[t]===r(t))return;g.completed.call(c)}}function r(t){return g.placeholder.charAt(t<g.placeholder.length?t:0)}function a(t){for(;++t<C&&!_[t];);return t}function h(t,e){var i,n;if(!(t<0)){for(i=t,n=a(e);i<C;i++)if(_[i]){if(!(n<C&&_[i].test(m[n])))break;m[i]=m[n],m[n]=r(n),n=a(n)}u(),c.caret(Math.max(y,t))}}function s(){o(),c.val()!=p&&c.change()}function d(t,e){for(var i=t;i<e&&i<C;i++)_[i]&&(m[i]=r(i))}function u(){c.val(m.join(""))}function o(t){for(var e,i=c.val(),n=-1,s=0,o=0;s<C;s++)if(_[s]){for(m[s]=r(s);o++<i.length;)if(e=i.charAt(o-1),_[s].test(e)){m[s]=e,n=s;break}if(o>i.length){d(s+1,C);break}}else m[s]===i.charAt(o)&&o++,s<v&&(n=s);return t?u():n+1<v?g.autoclear||m.join("")===f?(c.val()&&c.val(""),d(0,C)):u():(u(),c.val(c.val().substring(0,n+1))),v?s:y}var c=b(this),m=b.map(e.split(""),function(t,e){return"?"!=t?i[t]?r(e):t:void 0}),f=m.join(""),p=c.val();c.data(b.mask.dataName,function(){return b.map(m,function(t,e){return _[e]&&t!=r(e)?t:null}).join("")}),c.one("unmask",function(){c.off(".mask").removeData(b.mask.dataName)}).on("focus.mask",function(){var t;c.prop("readonly")||(clearTimeout(n),p=c.val(),t=o(),n=setTimeout(function(){u(),t==e.replace("?","").length?c.caret(0,t):c.caret(t)},10))}).on("blur.mask",s).on("keydown.mask",function(t){var e,i,n;c.prop("readonly")||(n=t.which||t.keyCode,x=c.val(),8===n||46===n||E&&127===n?(e=(i=c.caret()).begin,(i=i.end)-e==0&&(e=46!==n?function(t){for(;0<=--t&&!_[t];);return t}(e):i=a(e-1),i=46===n?a(i):i),d(e,i),h(e,i-1),t.preventDefault()):13===n?s.call(this,t):27===n&&(c.val(p),c.caret(0,o()),t.preventDefault()))}).on("keypress.mask",function(t){var e,i,n,s,o;c.prop("readonly")||(s=t.which||t.keyCode,o=c.caret(),t.ctrlKey||t.altKey||t.metaKey||s<32||!s||13===s||(o.end-o.begin!=0&&(d(o.begin,o.end),h(o.begin,o.end-1)),(e=a(o.begin-1))<C&&(i=String.fromCharCode(s),_[e].test(i))&&(function(t){for(var e,i,n=t,s=r(t);n<C;n++)if(_[n]){if(e=a(n),i=m[n],m[n]=s,!(e<C&&_[e].test(i)))break;s=i}}(e),m[e]=i,u(),n=a(e),S?setTimeout(function(){b.proxy(b.fn.caret,c,n)()},0):c.caret(n),o.begin<=w&&l()),t.preventDefault()))}).on("input.mask paste.mask",function(){c.prop("readonly")||setTimeout(function(){var t=o(!0);c.caret(t),l()},0)}),T&&S&&c.off("input.mask").on("input.mask",function(){var t=c.val(),e=c.caret();if(t.length<x.length){for(o(!0);0<e.begin&&!_[e.begin-1];)e.begin--;if(0===e.begin)for(;e.begin<y&&!_[e.begin];)e.begin++;c.caret(e.begin,e.begin)}else{for(o(!0);e.begin<C&&!_[e.begin];)e.begin++;c.caret(e.begin,e.begin)}l()}),o()})}})}),mini.InputMask=function(){mini.InputMask.superclass.constructor.call(this)},mini.extend(mini.InputMask,mini.TextBox,{uiCls:"mini-inputmask",mask:"",set:function(t){if("string"==typeof t)return this;var e=t.mask;return delete t.mask,mini.InputMask.superclass.set.call(this,t),e&&this.setMask(e),this},setMask:function(t){this.mask=t,jQuery(this._textEl).mask(t)},getMask:function(){return this.mask},getAttrs:function(t){var e=mini.InputMask.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["mask"]),e}}),mini.regClass(mini.InputMask,"inputmask"),mini.LargeFileUploader=function(){mini.LargeFileUploader.superclass.constructor.call(this)},mini.extend(mini.LargeFileUploader,mini.Control,{uiCls:"mini-largefileuploader",uploadUrl:"",limitType:"",fileNumLimit:1,fileSizeLimit:0,fileSingleSizeLimit:0,multiSelect:!1,auto:!0,externalSrc:"",pickerText:"选择文件",startText:"开始上传",pauseText:"暂停上传",numLimitErrorText:"选择的文件过多！</br>最多可上传{0}个文件",sizeLimitErrorText:"选择的文件过大！</br>最多可上传{0}KB文件",typeDeniedErrorText:"选择的文件类型错误！</br>可上传的文件类型为：{0}",sizeErrorText:"选择的文件过大！</br>可上传的单文件最大为{0}KB",emptyFileErrorText:"不能上传空文件！",set:function(t){if("string"==typeof t)return this;var e=t.pickerText;delete t.pickerText;var i=t.needChunkLocal;return delete t.needChunkLocal,i&&(this.needChunkLocal=i),mini.LargeFileUploader.superclass.set.call(this,t),e&&(this._picker.innerHTML=e),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<div class="mini-uploader-btns"><div class="mini-ntko-pick">'+this.pickerText+'</div></div><div class="mini-uploader-list"></div><div class="mini-ntko"></div>',this._buttons=this.el.firstChild,this._fileList=this.el.children[1],this._ntkoContent=this.el.lastChild,this._picker=this._buttons.firstChild,this._uploadBtn=new mini.Button,this._uploadBtn.setText(this.startText),this._uploadBtn.render(this._buttons),this._ntkoContent.innerHTML='<object id="'+this.uid+'-ntko" classid="clsid:882C96AC-B79E-4f50-A7A6-6E5E42431A05" codebase="'+(this.externalSrc||mini.externalSrc)+'ntkoLFUploader/NtkoLFUploader.cab#version=6,1,1,8"><PARAM NAME="BackColor" VALUE="16744576"><PARAM NAME="ForeColor" VALUE="16777215"><PARAM NAME="IsUseUTF8Data" VALUE="true"><param name="ProductCaption" value="'+(window.NTKO_ProductCaption||"国泰新点用户")+'"><param name="ProductKey" value="'+(window.NTKO_ProductKey||"3CF3019EA6883730AB34F0D5A8FACDB1CDB2A9EA")+'"><PARAM NAME="MakerCaption" VALUE="'+(window.NTKO_MakerCaption||"江苏国泰新点软件有限公司")+'"><PARAM NAME="MakerKey" VALUE="'+(window.NTKO_MakerKey||"39337AFCA7AFD1F882A3BF53CBE1E4AC804C65A6")+'"><span style="color: red;">不能装载NTKO大文件上传控件。</span></object>',this._ntko=this._ntkoContent.firstChild,this._errorContent=""},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this._picker,"click",this.__OnPickerClick,this)},this);var t,e,s=this,n=this._ntko;function i(t){var e=document.createElement("script");e.language="JScript",e.setAttribute("for",t.target),e.event=t.event,e.text=t.text,document.body.appendChild(e)}this._uploadBtn.on("click",function(){n.IsUploading?(s.stopUpload(),s._uploadBtn.setText(s.pauseText)):(s.beginUpload(),s._uploadBtn.setText(s.startText))}),this.auto&&this._uploadBtn.hide(),n.attachEvent?(n.attachEvent("BeforeFileAdded",function(t,e,i){n.CancelLastCommand=!s._beforeFileQueued(t,e,i)}),n.attachEvent("OnLocalFileAdded",function(t,e,i){s._onFilesQueued(t,e,i)}),n.attachEvent("OnFileProcessStatusChange",function(t,e,i,n){s._onUploadProgress(t,e,i,n)}),n.attachEvent("OnOneFileUploadFinished",function(t,e){s._onFileFinished(t,e)}),n.attachEvent("OnSaveToURLFinished",function(t){s._onUploadFinished(t)})):(i({target:t=this.uid+"-ntko",event:"BeforeFileAdded(filePath, fileName, fileSize)",text:(e='var lfu = mini.getbyUID("'+this.uid+'");')+"lfu._ntko.CancelLastCommand = !lfu._beforeFileQueued(filePath, fileName, fileSize);"}),i({target:t,event:"OnLocalFileAdded(filePath, fileName, fileSize)",text:e+"lfu._onFilesQueued(filePath, fileName, fileSize);"}),i({target:t,event:"OnFileProcessStatusChange(file, statusText, isPersent, persentNumber)",text:e+"lfu._onUploadProgress(file, statusText, isPersent, persentNumber);"}),i({target:t,event:"OnOneFileUploadFinished(file, isAllUploaded)",text:e+"lfu._onFileFinished(file, isAllUploaded);"}),i({target:t,event:"OnSaveToURLFinished(isAllSuccess)",text:e+"lfu._onUploadFinished(isAllSuccess);"}))},_afterApply:function(){this._ntko.StatusCode===undefined&&(this._buttons.innerHTML='<a class="noflash" title="不能装载NTKO大文件上传控件。请确保使用IE浏览器，并检查浏览器的安全设置。">初始化错误</a>',mini.showPageWarning({html:"不能装载NTKO大文件上传控件。请确保使用IE浏览器，并检查浏览器的安全设置"}))},__OnPickerClick:function(t){var e=this._ntko;try{e.AddLocalFile("",this.multiSelect,this._ntkoFileType),this.auto&&this.beginUpload()}catch(i){10==e.StatusCode?window.console&&console.log("用户取消操作"):window.console&&console.error("error："+i.number+":"+i.description)}},_blocksFileField:"NTKO_LF_BLOCK",beginUpload:function(){var t,e;this._onStartUpload()&&((t=this._ntko).QueryFileStatusURL=this._ntkoQueryFileStatusURL,t.FinishedUploadURL=this._ntkoFinishedUploadURL,this._onUploadBeforeSend(e={data:{}}),t.BeginSaveToURL(this.uploadUrl+"&query=upload",this._blocksFileField,function(t){var e,i=[];for(e in t)i.push(e+"="+t[e]);return i.join("&")}(e.data)))},stopUpload:function(){this._ntko.StopSaveToURL(),this._onStopUpload()},reset:function(){this._ntko.Reset(),this._onReset()},removeFile:function(t){var e=this._ntko,i=this._getFileIndex(t);-1<i&&(t=e.GetFile(i),e.RemoveFile(i),this._fileIds[t.FilePath]=undefined,delete this._fileIds[t.FilePath],this._onFileDequeued(t))},_getFileIndex:function(t){var e,i=0;for(e in this._fileIds){if(this._fileIds[e].id===t)return i;i++}return-1},_ntkoFileType:"*.*",setLimitType:function(t){this.limitType=t.toLowerCase(),this._ntkoFileType=this._getNtkoFileType(t)},getLimitType:function(){return this.limitType},setAuto:function(t){this.auto!=t&&((this.auto=t)?this._uploadBtn.hide():this._uploadBtn.show())},getAuto:function(){return this.auto},_getNtkoFileType:function(t){if(!t)return"*.*";for(var e=[],i=t.split(","),n=0,s=i.length;n<s;n++)e.push("*."+i[n]);return e.join(";")},getFileList:function(){return this._fileList},setFileNumLimit:function(t){t=parseInt(t)||0,1===(this.fileNumLimit=t)&&(this.multiSelect=!1)},getFileNumLimit:function(){return this.fileNumLimit},setUploadUrl:function(t){var e=window.location.search.substring(1),i="?";0<t.indexOf("?")&&(i="&"),t+=i+"type=ntko",e&&(t+="&"+e),this.needChunkLocal&&(t+="&needChunkLocal=1"),this.uploadUrl=t,this._ntkoQueryFileStatusURL=t+"&query=getStatus",this._ntkoFinishedUploadURL=t+"&query=finished"},getUploadUrl:function(){return this.uploadUrl},setFileSingleSizeLimit:function(t){this.fileSingleSizeLimit=t},getFileSingleSizeLimit:function(){return this.fileSingleSizeLimit},_validateFile:function(t){var e=this._ntko.FilesCount;return this.fileNumLimit&&e>=this.fileNumLimit?(this._errorContent=String.format(this.numLimitErrorText,this.fileNumLimit),!1):this.fileSingleSizeLimit&&t.size>1024*this.fileSingleSizeLimit?(this._errorContent=String.format(this.sizeErrorText,this.fileSingleSizeLimit),!1):0===t.size?(this._errorContent=this.emptyFileErrorText,!1):!this.limitType||-1!=(","+this.limitType+",").indexOf(","+t.ext.toLowerCase()+",")||(this._errorContent=String.format(this.typeDeniedErrorText,this.limitType),!1)},_parseAttachFile:function(t){t={path:t.FilePath,name:t.FileName,size:t.FileSize,md5:t.MD5ID};return t.ext=t.name.substr(t.name.lastIndexOf(".")+1),t.id=this._fileIds[t.path].id,t},_beforeFileQueued:function(t,e,i){i={path:t,name:e,size:i,ext:e.substr(e.lastIndexOf(".")+1)};if(this._events.beforefilequeued){e={source:this,sender:this,type:"beforefilequeued",file:i,cancel:!1};if(this.fire("beforefilequeued",e),e.cancel)return!1}return!!this._validateFile(i)||(this._errorContent&&mini.alert(this._errorContent),this._errorContent="",!1)},_fileIds:{},_onFilesQueued:function(t,e,i){e={path:t,name:e,size:i,ext:e.substr(e.lastIndexOf(".")+1),id:UUID()};this._fileIds[e.path]={id:e.id},this.fire("filesqueued",{files:[e]})},_onFileDequeued:function(t){this.fire("filedequeued",{file:t})},_onUploadBeforeSend:function(t){this.fire("uploadbeforesend",t)},_onUploadProgress:function(t,e,i,n){t=this._parseAttachFile(t),console.log(arguments);var s=!1;i?s||0!==e.indexOf("正在分析文件")?this.fire("uploadprogress",{file:t,percentage:n/100}):(this.fire("md5progress",{file:t,percentage:n/100}),100==n&&(s=!0)):this._fileIds[t.path].started||(this.fire("uploadstart",{file:t}),this._fileIds[t.path].started=!0)},_onFileFinished:function(t,e){t=this._parseAttachFile(t),e?this._onUploadSuccess(t):this._onUploadError(t,this._parseNtkoRet(this._ntko.LastFinishedUploadRetMes)),this._onUploadComplete(t)},_onUploadSuccess:function(t){var e=this._parseNtkoRet(this._ntko.LastFinishedUploadRetMes);this.fire("uploadaccept",{ret:e,object:{file:t}}),this.fire("uploadsuccess",{file:t})},_onUploadError:function(t,e){this.fire("uploaderror",{file:t,reason:e})},_onUploadComplete:function(t){this.fire("uploadcomplete",{file:t})},_onStartUpload:function(){if(this._events.startupload){var t={source:this,sender:this,type:"startupload",cancel:!1};if(this.fire("startupload",t),t.cancel)return!1}return!0},_onStopUpload:function(){this.fire("stopupload")},_onUploadFinished:function(t){this._uploadBtn.setText(this.startText),this.fire("uploadfinished",{isAllSuccess:t})},_onReset:function(){this._fileIds={},this.fire("reset")},_parseNtkoRet:function(t){var n={},t=t.split("&");return $.each(t,function(t,e){var i=e.split("="),e=i[0],i=i[1];"undefined"==typeof n[e]?n[e]=i:"string"==typeof n[e]?n[e]=[n[e],i]:n[e].push(i)}),n},getAttrs:function(t){var e=mini.LargeFileUploader.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["uploadUrl","limitType","onbeforefilequeued","onfilesqueued","onreset","onstartupload","onstopupload","onuploadfinished","onuploadstart","onuploadbeforesend","onuploadaccept","onuploadprogress","onmd5progress","onuploadsuccess","onuploaderror","onuploadcomplete","pickerText"]),mini._ParseBool(t,e,["auto","multiSelect"]),mini._ParseInt(t,e,["fileNumLimit","fileSingleSizeLimit"]),e}}),mini.regClass(mini.LargeFileUploader,"largefileuploader"),mini.Output=function(){mini.Output.superclass.constructor.apply(this,arguments)},mini.extend(mini.Output,mini.Control,{url:"","async":!1,escape:!1,autoLoad:!0,uiCls:"mini-output",_create:function(){this.el=document.createElement("div"),this.el.className="mini-output"},_initEvents:function(){},doLayout:function(){if(this.canLayout()){var t=this.el.childNodes;if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];mini.layout(n)}}},doUpdate:function(){var t=jQuery.ajax({url:this.url,"async":this["async"]}),e=this;t.done(function(t){e.setValue(t)})},setUrl:function(t){this.url=t,this.autoLoad&&this.doUpdate()},getUrl:function(){return this.url},setAutoLoad:function(t){this.autoLoad=!!t},getAutoLoad:function(){return this.autoLoad},setEscape:function(t){this.escape=!!t},getEscape:function(){return this.escape},setAsync:function(t){this["async"]=t},getAsync:function(){return this["async"]},setValue:function(t){var e={value:t};this.fire("valuechanged",e),null!==(t=e.value)&&t!==undefined||(t=""),this.escape&&(t=mini.htmlEncode(t)),mini.innerHTML(this.el,t),mini.parse(this.el),this.doLayout()},getAttrs:function(t){var e=mini.Output.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","onvaluechanged"]),mini._ParseBool(t,e,["escape","async","autoLoad"]),e}}),mini.regClass(mini.Output,"output"),mini.OutputText=function(){mini.OutputText.superclass.constructor.apply(this,arguments)},mini.extend(mini.OutputText,mini.Control,{maxWidth:"",escape:!1,showTitle:!0,numFormat:"",uiCls:"mini-outputtext",set:function(t){if("string"==typeof t)return this;var e=t.maxWidth;delete t.maxWidth;var i=t.escape;delete t.escape;var n=t.showTitle;delete t.showTitle;var s=t.numFormat;return delete t.numFormat,e&&this.setMaxWidth(e),i&&(this.escape=i),mini.isNull(n)||this.setShowTitle(n),s&&(this.numFormat=s),mini.OutputText.superclass.set.call(this,t),this},_create:function(){this.el=document.createElement("span")},setValue:function(t){var e;null!==t&&t!==undefined||(t=""),this.value=t,this.numFormat?(e=(e=parseFloat(t))&&mini.formatNumber(e,this.numFormat))&&(t=e):!0===this.escape&&(t=(t=mini.htmlEncode(t)).replace(/\n/g,"<br/>")),this.el.innerHTML=t;t=jQuery(this.el).text();this.showTitle&&mini.setAttr(this.el,"title",t)},setMaxWidth:function(t){(t=t.replace(/(^\s*)|(\s*$)/g,""))?("px"!=t.substr(t.length-2)&&(t+="px"),mini.addClass(this.el,"mini-text-ellipsis")):mini.removeClass(this.el,"mini-text-ellipsis"),this.el.style.maxWidth=t,this.maxWidth=t},getMaxWidth:function(){return this.maxWidth},getEscape:function(){return this.escape},getShowTitle:function(){return this.showTitle},setShowTitle:function(t){this.showTitle=t},setNumFormat:function(t){this.numFormat=t},getAttrs:function(t){var e=mini.OutputText.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["maxWidth","numFormat"]),mini._ParseBool(t,e,["escape","showTitle"]),e}}),mini.regClass(mini.OutputText,"outputtext"),mini.PagerTree=function(){mini.PagerTree.superclass.constructor.call(this),mini.addClass(this.el,"mini-tree"),mini.addClass(this.el,"mini-treegrid"),this._Expander=new mini._PagerTree_Expander(this),this._collapseNodes=[],this._expandNodes=[],this.on("beforeload",this.__OnBeforeLoad,this)},mini.extend(mini.PagerTree,mini.DataGrid,{uiCls:"mini-pagertree",treeColumn:"",idField:"id",parentField:"pid",showTreeIcon:!0,iconField:"iconCls",imgField:"img",imgPath:"",leafIconCls:"mini-tree-leaf",folderIconCls:"mini-tree-folder",_expandNodeCls:"mini-tree-expand",_collapseNodeCls:"mini-tree-collapse",_eciconCls:"mini-tree-node-ecicon",_OnCellMouseDown:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellmousedown",t)},_OnCellClick:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellclick",t)},_OnDrawCell:function(t,e,i,n){n=mini.PagerTree.superclass._OnDrawCell.call(this,t,e,i,n);return this.treeColumn&&this.treeColumn==e.name&&(n.headerCls+=" mini-tree-treecolumn",n.cellCls+=" mini-tree-treecell",n.cellStyle+=";padding:0;",n.img=t[this.imgField],n.iconCls=this._getNodeIcon(t),n.showTreeIcon=this.showTreeIcon,n.nodeCls="",n.nodeStyle="",this._createTreeCell(n)),n},_createTreeCell:function(t){var e=[],i=t.record,n=this.isLeafNode(i),s=this.getNodeLevel(i),o=this.isExpandedNode(i),i=t.nodeCls;n||(i=o?this._expandNodeCls:this._collapseNodeCls),n||(i+=" mini-tree-parentNode"),e[e.length]='<div class="mini-tree-nodetitle '+i+'" style="'+t.nodeStyle+'">';for(var l=0;l<s-1;l++)e[e.length]='<span class="mini-tree-indent " ></span>';e[e.length]=n?'<span class="'+this._eciconCls+'" ></span>':'<i class="'+this._eciconCls+'"></i>',e[e.length]='<span class="mini-tree-nodeshow">',t.showTreeIcon&&(t.img?(n=this.imgPath+t.img,e[e.length]='<span class="mini-tree-icon" style="background-image:url('+n+');"></span>'):e[e.length]='<span class="'+t.iconCls+' mini-tree-icon mini-icon"></span>'),e[e.length]='<span class="mini-tree-nodetext">',e[e.length]=t.cellHtml,e[e.length]="</span>",e[e.length]="</span>",e[e.length]="</div>",t.cellHtml=e.join("")},__OnBeforeLoad:function(t){t.data.__ecconfig=this._getEcConfig()},_getEcConfig:function(){var t={collapseNodes:this._collapseNodes,expandNodes:this._expandNodes};return mini.encode(t)},load:function(){return this._collapseNodes=[],this._expandNodes=[],mini.PagerTree.superclass.load.apply(this,arguments)},expandNode:function(t){!(t=this._dataSource.getbyId(t))||this.isLeafNode(t)||(t=t[this.getIdField()])&&(this._expandNodes.remove(t),this._collapseNodes.remove(t),this._expandNodes.add(t)),this.reload()},collapseNode:function(t){!(t=this._dataSource.getbyId(t))||this.isLeafNode(t)||(t=t[this.getIdField()])&&(this._expandNodes.remove(t),this._collapseNodes.remove(t),this._collapseNodes.add(t)),this.reload()},toggleNode:function(t){(t=this._dataSource.getbyId(t))?this.isExpandedNode(t)?this.collapseNode(t):this.expandNode(t):this.reload()},isExpandedNode:function(t){return t.expanded===undefined||"true"==t.expanded.toString()},isLeafNode:function(t){return t.isLeaf&&"true"==t.isLeaf.toString()},getNodeLevel:function(t){return t._level},_getNodeIcon:function(t){var e=t[this.iconField];return e=e||(this.isLeafNode(t)?this.leafIconCls:this.folderIconCls)},getAttrs:function(t){var e=mini.PagerTree.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["treeColumn","iconField","imgField","imgPath","idField","parentField"]),mini._ParseBool(t,e,["showTreeIcon"]),e}}),mini.regClass(mini.PagerTree,"pagertree"),mini._PagerTree_Expander=function(t){this.owner=t,mini.on(t.el,"click",this.__OnClick,this)},mini._PagerTree_Expander.prototype={__OnClick:function(t){var e=this.owner,i=e.getRecordByEvent(t,!1);i&&(e.isLeafNode(i),mini.findParent(t.target,e._eciconCls)&&(e.isLeafNode(i)||e.toggleNode(i)))}},mini.Pagination=function(){mini.Pagination.superclass.constructor.apply(this,arguments)},mini.extend(mini.Pagination,mini.Control,{pageIndex:0,pageSize:10,totalCount:0,totalPage:0,showTotalCount:!0,showPageSize:!0,showPageInfo:!0,sizeList:[10,20,50,100],pageInfoText:"共{0}条",jumpText:'跳至<input class="pagination-number"  value="{0}"/>页',set:function(t){if("string"==typeof t)return this;var e=t.pageIndex;return delete t.pageIndex,mini.Pagination.superclass.set.call(this,t),mini.isNull(e)||this.setPageIndex(e),this},uiCls:"mini-pagination",_create:function(){this.el=document.createElement("div"),this._updatePager()},_updatePagerButtons:function(){var t,e=parseInt(this.pageSize,10),i=parseInt(this.pageIndex,10),n=parseInt(this.totalCount,10),s=Math.ceil(n/e),o=[];this.showTotalCount&&0<=n&&o.push('<div class="pagination-pagerinfo">'+String.format(this.pageInfoText,n)+"</div>"),o.push('<div class="pagination-buttons">');var l="",r=0;if(o.push('<a class="pagination-button pagination-prev mini-icon '+(l=0==i?"disabled":l)+'" action="prev"></a>'),s<8)for(r=0;r<s;r++)l="",o.push('<a class="pagination-button '+(l=i==r?"pagination-current":l)+'">'+(r+1)+"</a>");else if(i<6){for(r=0;r<6;r++)l="",o.push('<a class="pagination-button '+(l=i==r?"pagination-current":l)+'">'+(r+1)+"</a>");o.push('<a class="pagination-button pagination-button-ellipsis" action="none" data-index="'+(t=s<=r+4?s-1:r+4)+'" title="'+t+'">...</a>'),o.push('<a class="pagination-button">'+s+"</a>")}else if(s-6<i)for(o.push('<a class="pagination-button">1</a>'),o.push('<a class="pagination-button pagination-button-ellipsis" action="none" data-index="'+(s-6)+'" title="'+(s-6)+'">...</a>'),r=6;0<r;r--)l="",o.push('<a class="pagination-button '+(l=i==s-r?"pagination-current":l)+'">'+(s-r+1)+"</a>");else{for(o.push('<a class="pagination-button">1</a>'),o.push('<a class="pagination-button pagination-button-ellipsis" action="none" data-index="'+(i-3)+'" title="'+(i-3)+'">...</a>'),r=0;r<3;r++)o.push('<a class="pagination-button">'+(i-(2-r))+"</a>");t=s<=i+4?s-1:i+4,o.push('<a class="pagination-button pagination-current">'+(i+1)+"</a>"),o.push('<a class="pagination-button pagination-button-ellipsis" action="none" data-index="'+t+'" title="'+t+'">...</a>'),o.push('<a class="pagination-button">'+s+"</a>")}l="",o.push('<a class="pagination-button pagination-next  mini-icon '+(l=s-1<=i&&0<=n||-9999==n?"disabled":l)+'" action="next"></a>'),o.push("</div>");n=o.join(" ");this.el.innerHTML=n},_updatePagerInfo:function(){var t,e,i=this,n=parseInt(i.pageSize,10),s=parseInt(i.pageIndex,10),o=i.sizeList,l=!1,r=0;if(i.showPageSize){for(t=o.length;r<t;r++)o[r]===n&&(l=!0);l||o.push(n),o.sort(function(t,e){return t-e});for(var a=[],r=0;r<t;r++)a.push({id:o[r],text:o[r]});i.sizeCombo=new mini.ComboBox,i.sizeCombo.setData(a),i.sizeCombo.setValue(n),i.sizeCombo.on("valuechanged",function(t){t=parseInt(t.value,10);i._OnPageChanged(0,t)}),i.sizeCombo.render(i.el)}0<=i.totalCount&&((e=document.createElement("span")).className="pagination-pagerchange",s=String.format(this.jumpText,s+1),e.innerHTML=s,i.el.appendChild(e))},_updatePager:function(){this._updatePagerButtons(),this._updatePagerInfo()},_initEvents:function(){mini.Pagination.superclass._initEvents.call(this);var l=this;function e(t){var e=l.pageSize,i=l.totalCount,i=Math.ceil(i/e),e=parseInt(t.val());isNaN(e)?t.val(""):(i<e&&t.val(e=i),l._OnPageChanged(e-1))}setTimeout(function(){$(l.el).on("click",".pagination-button",function(t){var e=l.pageSize,i=l.pageIndex,n=l.totalCount,s=Math.ceil(n/e),o=$(t.target).attr("action"),e="";"prev"==o?0!=i&&l._OnPageChanged(i-1):"next"==o?(i<s-1||n<0)&&-9999!==n&&l._OnPageChanged(l.pageIndex+1):"none"==o?0<(e=parseInt($(t.target).data("index"),10))&&l._OnPageChanged(e-1):$(t.target).hasClass("current")||0<(e=parseInt($(t.target).text(),10))&&l._OnPageChanged(e-1)}).on("keydown",".pagination-number",function(t){13==t.keyCode&&e($(t.target))}).on("change",".pagination-number",function(t){e($(t.target))})},100)},_OnPageChanged:function(t,e){e={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};-1<this.totalPage&&e.pageIndex>this.totalPage-1&&(e.pageIndex=this.totalPage-1),e.pageIndex<0&&(e.pageIndex=0),this.fire("beforepagechanged",e),1!=e.cancel&&(this.fire("pagechanged",e),this.update(e.pageIndex,e.pageSize))},update:function(t,e,i){var n=this;mini.isNumber(t)&&(n.pageIndex=parseInt(t)),mini.isNumber(e)&&(n.pageSize=parseInt(e)),mini.isNumber(i)&&(n.totalCount=parseInt(i)),n.totalPage=parseInt(n.totalCount/n.pageSize)+1,n.totalCount<0?n.totalPage=-1:((n.totalPage-1)*n.pageSize==n.totalCount&&--n.totalPage,0==n.totalCount&&(n.totalPage=0),n.pageIndex>n.totalPage-1&&(n.pageIndex=n.totalPage-1),n.totalPage<=0&&(n.totalPage=0)),n.pageIndex<=0&&(n.pageIndex=0),this._updatePager()},setPageIndex:function(t){isNaN(t)||(this.pageIndex=t,this.update())},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){isNaN(t)||(this.pageSize=t,this.update())},getPageSize:function(){return this.pageSize},setTotalCount:function(t){t=parseInt(t),isNaN(t)||(this.totalCount=t,this.update())},getTotalCount:function(){return this.totalCount},setSizeList:function(t){mini.isArray(t)&&(this.sizeList=t,this.update())},getSizeList:function(){return this.sizeList},setShowReloadButton:function(t){},getShowReloadButton:function(){return!1},setShowTotalCount:function(t){this.showTotalCount!==t&&(this.showTotalCount=t,this.update())},getShowTotalCount:function(){return this.showTotalCount},setShowPageSize:function(t){this.showPageSize!==t&&(this.showPageSize=t,this.update())},getShowPageSize:function(){return this.showPageSize},setShowPageInfo:function(t){this.showPageInfo=t,this.setShowTotalCount(t)},getShowPageInfo:function(){return this.showPageInfo},setShowPagerButtonText:function(t){},setShowPagerButtonIcon:function(t){},setPageSizeWidth:function(t){},setShowPageIndex:function(t){},getAttrs:function(t){var e=mini.Pager.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onpagechanged","sizeList","onbeforepagechanged","buttons","sizeText"]),mini._ParseBool(t,e,["showPageSize","showTotalCount"]),mini._ParseInt(t,e,["pageIndex","pageSize","totalCount"]),"string"==typeof e.sizeList&&(e.sizeList=window.eval(e.sizeList)),e.buttons&&(e.buttons=mini.byId(e.buttons)),e}}),mini.regClass(mini.Pagination,"pagination"),mini.PanelTip=function(){mini.PanelTip.superclass.constructor.apply(this,arguments)},mini.extend(mini.PanelTip,mini.ToolTip,{selector:".paneltip",trigger:"click",uiCls:"mini-paneltip",url:"",tplUrl:"",tpl:"",cssUrl:"",defaultTheme:"light",externalSrc:"",_create:function(){this.el=jQuery('<div class="mini-tooltip mini-paneltip"><div class="mini-tooltip-arrow"></div><i class="mini-paneltip-close"></i><div class="mini-tooltip-inner"></div></div>')[0],this.$element=jQuery(this.el),this.$close=jQuery(".mini-paneltip-close",this.$element),this.$element.appendTo(document.body),this.externalSrc=this.externalSrc||mini.externalSrc},_initEvents:function(){var t=this;this.$close.on("click",function(){t.close()}),this._bindTooltip()},_opened:"",open:function(t){t=jQuery(t)[0]||this.target;var e=jQuery(t).attr("data-guid"),i={element:t,data:{guid:e},cancel:!1};this.fire("beforeopen",i),i.cancel||(this.$element.show(),this._target=t,this._getData(i.data,e),this.fire("open",{element:t}))},_getData:function(t,i){var n=this;this.showLoading(),mini.ajax({url:this.url,data:t,"async":!0,success:function(t){var e=mini.decode(t)||"";n._opened=i,window.Mustache?n._renderContent(e):mini.loadJS(n.externalSrc+"mustache.min.js",function(){n._renderContent(e)})}})},_renderContent:function(t){t=Mustache.render(this.tpl,t);this.setContent(t),this.$close.removeClass("hidden")},_toggle:function(t){if(this._opened&&jQuery(t.currentTarget).attr("data-guid")===this._opened)return void this.applyPlacement();this.close(),this._enter(t)},_leave:function(t){clearTimeout(this.openTimer)},showLoading:function(){this.setContent('<div class="mini-tooltip-loading"></div>'),this.$close.addClass("hidden")},close:function(){this._target=null,this.$element.hide(),this._opened=""},setTplUrl:function(t){this.tplUrl=t,this.tpl=jQuery.trim(mini.loadText(t))},setCssUrl:function(t){this.cssUrl=t,mini.loadCSS(t)},getAttrs:function(t){var e=mini.PanelTip.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["trigger"]),e}}),mini.regClass(mini.PanelTip,"paneltip"),mini.Repeat=function(){mini.Repeat.superclass.constructor.call(this)},mini.extend(mini.Repeat,mini.ListControl,{templateId:"",templateUrl:"",url:"",externalSrc:"",uiCls:"mini-repeat",_create:function(){this.el=document.createElement("div"),this.externalSrc=this.externalSrc||mini.externalSrc},setTemplateUrl:function(t){this.templateUrl=t;var t=jQuery.ajax({url:t,"async":!1}),e=this;t.done(function(t){e.template=jQuery.trim(t)}).fail(function(t,e,i){throw new Error("template not found")})},getTemplateUrl:function(){return this.templateUrl},setTemplateId:function(t){this.templateId=t;t=document.getElementById(t);if(!t)throw new Error("template not found");this.template=jQuery.trim(t.innerHTML)},getTemplateId:function(){return this.templateId},setData:function(t){if(this.data=t||[],!this.template)throw new Error("template not init");var e=this;window.Mustache?this._renderHtml():mini.loadJS(this.externalSrc+"mustache.min.js",function(){e._renderHtml()})},_renderHtml:function(){var t=this.data.control,e=this.data.template||this.data,i=[];for(o=0,l=e.length;o<l;o++)i.push(Mustache.render(this.template,e[o]));if(this.el.innerHTML=i.join(""),mini.parse(this.el),t)for(var n,s,o=0,l=(t=!mini.isArray(t)?[]:t).length;o<l;o++)for(var r in n=t[o])(s=mini.get(r,this.el))&&n[r]&&(n[r].data&&(s.loadList?s.loadList(n[r].data):s.setData&&(s.setData(n[r].data),n[r].total&&s.setTotalCount&&s.setTotalCount(n[r].total))),"object"!=typeof n[r]&&s.setValue&&s.setValue(n[r]),n[r].value&&s.setValue&&s.setValue(n[r].value))},getAttrs:function(t){var e=mini.Repeat.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["templateId","templateUrl"]),e}}),mini.regClass(mini.Repeat,"repeat"),mini.SlideWindow=function(){mini.SlideWindow.superclass.constructor.apply(this,arguments),this.setAllowDrag(!1),this.setAllowResize(!1)},mini.extend(mini.SlideWindow,mini.Window,{uiCls:"mini-slidewindow",iconCls:"",iconStyle:"",duration:200,visible:!1,x:0,y:0,showModal:!1,allowResize:!1,pageVisibility:function(){var i,e,n=function(t,e){return""!==t?t+e.slice(0,1).toUpperCase()+e.slice(1):e},s=(e=!1,"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(t){0==e&&document[n(t,"hidden")]!=undefined&&(i=t,e=!0)}),e),o=function(){return s?document[n(i,"hidden")]:undefined},l=function(){return s?document[n(i,"visibilityState")]:undefined};return{isSupport:s,hidden:o(),visibilityState:l(),getVisibilityState:l,eventName:s?i+"visibilitychange":"",visibilitychange:function(e,t){return t=undefined||!1,s&&"function"==typeof e?document.addEventListener(i+"visibilitychange",function(t){this.hidden=o(),this.visibilityState=l(),e.call(this,t)}.bind(this),t):undefined}}}(undefined),_create:function(){mini.SlideWindow.superclass._create.call(this),this._titleEl.style.paddingRight="0",this.iconCls=this.iconStyle="",this.setDuration(this.duration)},destroy:function(){var t=this;this.hide().then(function(){t._destroy()})},_destroy:function(){this.pageVisibility.isSupport&&jQuery(document).off(this.pageVisibility.eventName+"."+this._id),mini.un(this.el,"mouseover",this.__OnMouseOver,this),mini.un(window,"resize",this.__OnWindowResize,this),mini.Window.superclass.destroy.call(this)},setDuration:function(t){if(!$.isNumeric(t))return!1;this.duration=t;t=this.duration/1e3+"s";jQuery(this.el).css({"-webkit-transition-duration":t,"-moz-transition-duration":t,"-ms-transition-duration":t,"-o-transition-duration":t,"transition-duration":t})},getDuration:function(){return this.duration},_initEvents:function(){var e=this;mini.Window.superclass._initEvents.call(this),mini._BindEvents(function(){mini.on(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this)},this),this.pageVisibility.isSupport&&jQuery(document).on(this.pageVisibility.eventName+"."+this._id,function(t){"visible"===e.pageVisibility.getVisibilityState()&&e.doLayout()})},__OnWindowResize:function(){var t=this;this.pageVisibility.isSupport&&"visible"!==this.pageVisibility.getVisibilityState()||(this.__showWidth=jQuery(window).width(),this.__showHeight=jQuery(window).height(),this.isDisplay()&&(clearTimeout(this.__resizeTimer),this.__resizeTimer=setTimeout(function(){t.doLayout()},20)))},_initButtons:function(){this.buttons=[];var t=this.createButton({name:"close",cls:"mini-tools-back icon-left",visible:this.showCloseButton});this.buttons.push(t)},doLayout:function(){if(!this.canLayout())return!1;mini.setSize(this.el,this.__showWidth,this.__showHeight),mini.Window.superclass.doLayout.call(this)},show:function(){var t=document.body;this.isRender()||this.render(t);var e=this.__showWidth||jQuery(window).width(),t=this.__showHeight||jQuery(window).height(),i=jQuery(this.el);i.css({"z-index":mini.getMaxZIndex(),position:"fixed",width:e,height:t,top:0,left:0}).show(),this.setVisible(!0),mini.isIE8||mini.isIE9?this.doLayout():(clearTimeout(this.__hideTimer),clearTimeout(this.__showTimer),this.__showTimer=setTimeout(function(){i.addClass("show")}))},showAtEl:function(){this.show()},showAtPos:function(){this.show()},hide:function(){var t=$.Deferred(),e=this,i=jQuery(this.el);return mini.isIE8||mini.isIE9?(e.setVisible(!1),t.resolve()):(clearTimeout(this.__hideTimer),clearTimeout(this.__showTimer),i.removeClass("show"),this.__hideTimer=setTimeout(function(){e.setVisible(!1),t.resolve()},this.duration)),t.promise()},max:function(){},restore:function(){}}),mini.regClass(mini.SlideWindow,"slidewindow"),mini.Slider=function(){mini.Slider.superclass.constructor.call(this)},mini.extend(mini.Slider,mini.Control,{uiCls:"mini-slider",width:"200px",formField:!0,minValue:0,maxValue:100,step:1,precision:0,showTooltip:!0,set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value,mini.Slider.superclass.set.call(this,t),mini.isNull(e)||this.setValue(e)},_create:function(){this.el=document.createElement("div"),this.el.className="mini-slider",this.el.innerHTML='<div class="mini-slider-runway"><div class="mini-slider-bar"></div><div class="mini-slider-pointer"></div></div>',this.runway=this.el.firstChild,this.bar=this.runway.firstChild,this.pointer=this.runway.lastChild},_initEvents:function(){var t,e,i=this;function n(){e=i.value,$(window).off("mousemove",s),$(window).off("mouseup",s),$(window).off("mouseup",n),t!=e&&i.fire("valuechanged",{value:e,oldValue:t})}function s(t){i._handleChange(t)}$(this.el).on("mousedown",function(){t=i.value,$(window).on("mousemove",s),$(window).on("mouseup",s),$(window).on("mouseup",n)})},_afterApply:function(){this.showTooltip&&(this.toolTip=new mini.ToolTip,this.toolTip.set({target:document,scope:this.el,selector:"[data-tooltip]",placement:"top"}),this.toolTip.on("beforeopen",this._onBeforeShowToolTip,this))},_onBeforeShowToolTip:function(t){var e={content:t.content};this.fire("beforeshowtooltip",e),t.content=e.content},_handleChange:function(t){t.preventDefault&&t.preventDefault();var e,i,n,s,o,l,r=this.el,a=r.clientWidth,h=r.getBoundingClientRect().left+window.pageXOffset,d=t.pageX||(t.touches?t.touches[0].pageX:0),t=(o=(n=a)-(e=d-h),(i=0)<=(s=e-i)&&0<=o?e:Math.abs(s)>=Math.abs(o)?n:i),u=t<=0?(l=0,this.minValue):a<=t?(l=100,this.maxValue):(l=100*t/a,u=100/((this.maxValue-this.minValue)/this.step),u=Math.round(l/u)*u*(this.maxValue-this.minValue)*.01+this.minValue,parseFloat(u.toFixed(this.precision)));this.setValue(u,l),this.showTooltip&&(this.fire("beforeshowtooltip",u={content:u}),this.toolTip.setContent(u.content))},setPosition:function(t){this.bar.style.width=t+"%",this.pointer.style.left=t+"%"},setValue:function(t,e){t=parseFloat(t),isNaN(t)&&(t=this.minValue),(t=0<=this.precisions?t.toFixed(this.precisions):t)>this.maxValue?t=this.maxValue:t<this.minValue&&(t=this.minValue),this.value!=t&&(this.value=t,e=mini.isNumber(e)?e:(t-this.minValue)/(this.maxValue-this.minValue)*100,this.setPosition(e),this.showTooltip&&this.pointer.setAttribute("data-tooltip",t))},getValue:function(){return this.value},setMaxValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.maxValue!=t&&(this.maxValue=t,this._ValueLimit()))},getMaxValue:function(t){return this.maxValue},setMinValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.minValue!=t&&(this.minValue=t,this._ValueLimit()))},getMinValue:function(){return this.minValue},setStep:function(t){t=parseFloat(t),isNaN(t)||this.step!=t&&(this.step=t,this._adjustPrecision())},getStep:function(){return this.step},_ValueLimit:function(){this.minValue>this.maxValue&&(this.maxValue=this.minValue+100),this.value<this.minValue&&this.setValue(this.minValue),this.value>this.maxValue&&this.setValue(this.maxValue),this._adjustPrecision()},_adjustPrecision:function(){var t=[this.minValue,this.maxValue,this.step].map(function(t){t=(""+t).split(".")[1];return t?t.length:0});this.precision=Math.max.apply(null,t)},getAttrs:function(t){var e=mini.Slider.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["maxValue","minValue","step","onvaluechanged","onbeforeshowtooltip"]),e}}),mini.regClass(mini.Slider,"slider"),mini.TabsTreeSelect=function(){mini.TabsTreeSelect.superclass.constructor.call(this)},mini.extend(mini.TabsTreeSelect,mini.ValidatorBase,{text:"",value:"",width:660,height:353,expandOnLoad:!1,expandOnNodeClick:!0,idField:"id",textField:"text",nodesField:"children",url:"",filterUrl:"",filterMode:"",autoLoad:!0,data:[],tabsConfig:[],tabKeys:[],showTreeIcon:!0,showTreeLines:!0,resultAsTree:!0,showFolderCheckBox:!0,loadChildWhenChecked:!0,parentField:"pid",canCheckParent:!1,checkRecursive:!0,autoCheckParent:!1,checkOnTextClick:!0,showSelectedCount:!0,showSort:!1,selectedPanelTitle:"已选人员",delimiter:",",showFullPath:!1,includeRootNode:!1,showBorder:!1,uiCls:"mini-tabstreeselect",set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;delete t.text;var n=t.data;delete t.data;var s=t.showBorder;delete t.showBorder;var o=t.tabs;delete t.tabs;var l=t.url;delete t.url;var r=t.filterUrl;delete t.filterUrl;var a=t.filterMode;delete t.filterMode;var h=t.autoLoad;delete t.autoLoad;var d=t.showFullPath;delete t.showFullPath;var u=t.includeRootNode;delete t.includeRootNode;var c=t.showSort;return delete t.showSort,mini.TabsTreeSelect.superclass.set.call(this,t),mini.isNull(h)||this.setAutoLoad(h),mini.isNull(l)||this.setUrl(l),mini.isNull(o)||this.setTabs(o,this.autoLoad),mini.isNull(n)||this.setData(n),mini.isNull(e)||this.setValue(e),mini.isNull(i)||this.setText(i),mini.isNull(r)||this.setFilterUrl(r),mini.isNull(a)||this.setFilterMode(a),mini.isNull(d)||(this.showFullPath=d,this.tree.showFullPath=d),mini.isNull(u)||(this.includeRootNode=u,this.tree.includeRootNode=u),s&&(this.el.style.borderWidth="1px"),c?this.showSort=c:this._buttons.removeChild(this.sortBtn),this},actionTitles:{sort:"一键排序",top:"置顶",bottom:"置底",remove:"删除",removeall:"删除全部",recover:"回到初始状态"},sortTitles:{none:"一键排序",asc:"正序",desc:"倒序"},_getActionBtn:function(t,e){var i=document.createElement("span");return i.className="mini-tabstreeselect-action mini-icon "+t+("sort"===t?" none":"")+(e?" disabled":""),i.title=this.actionTitles[t],i},_create:function(){this.el=document.createElement("div"),this.el.className="mini-tabstreeselect",this.el.innerHTML='<div class="mini-tabstreeselect-left"><div class="mini-tabstreeselect-header"></div><div class="mini-tabstreeselect-content"></div></div><div class="mini-tabstreeselect-right"><div class="mini-tabstreeselect-header"><div class="mini-tabstreeselect-header-main"><span class="mini-tabstreeselect-header-title">'+this.selectedPanelTitle+'</span><span class="mini-tabstreeselect-header-count hidden"></span></div></div><div class="mini-tabstreeselect-content"></div></div>',this._leftPanel=this.el.firstChild,this._rightPanel=this.el.lastChild,this._leftHeader=this._leftPanel.firstChild,this._rightHeader=this._rightPanel.firstChild.firstChild,this._rightTitle=this._rightHeader.firstChild,this._rightCount=this._rightHeader.lastChild,this._leftHeader.innerHTML='<ul class="mini-tabstreeselect-tabs clearfix"></ul>',this._tabs=this._leftHeader.firstChild,this._leftContent=this._leftPanel.lastChild,this._rightContent=this._rightPanel.lastChild,this.dimensionComboBox=new mini.ComboBox,this.dimensionComboBox.on("valuechanged",this.__onDimensionChanged,this),this.dimensionComboBox.render(this._leftContent),this.dimensionComboBox.hide(),this.tree=new mini.FilterTree,this.tree.setShowTreeIcon(!0),this.tree.setStyle("border:0;width:100%;height:100%;overflow:hidden;"),this.tree.setResultAsTree(this.resultAsTree),this.tree.setCheckRecursive(this.checkRecursive),this.tree.setShowCheckBox(!0),this.tree.setShowFolderCheckBox(this.showFolderCheckBox),this.tree.setExpandOnNodeClick(this.expandOnNodeClick),this.tree.setCheckOnTextClick(this.checkOnTextClick),this.tree.setAutoLoad(!0),this.tree.on("load",this.__OnLoad,this),this.tree.on("nodeclick",this.__OnNodeClick,this),this.tree.on("nodecheck",this.__OnCheckedChanged,this),this.tree.on("expand",this.__OnTreeExpand,this),this.tree.on("collapse",this.__OnTreeCollapse,this),this.tree.on("beforenodecheck",this.__OnTreeBeforeNodeCheck,this),this.tree.on("beforenodeselect",this.__OnTreeBeforeNodeSelect,this),this.tree.on("drawnode",this.__OnDrawNode,this),this.tree.on("loadnode",this.__OnLoadNode,this),this.tree.on("beforeload",this.__OnBeforeLoad,this),this.tree.on("filter",this.__OnFilter,this),this.tree.useAnimation=!0,this.tree.render(this._leftContent),this._rightContent.innerHTML='<div class="mini-tabstreeselect-buttons"></div><ul class="mini-tabstreeselect-list"></ul>',this._buttons=this._rightContent.firstChild,this._selectList=this._rightContent.lastChild,this._buttons.appendChild(this.sortBtn=this._getActionBtn("sort")),this._buttons.appendChild(this.topBtn=this._getActionBtn("top",!0)),this._buttons.appendChild(this.bottomBtn=this._getActionBtn("bottom",!0)),this._buttons.appendChild(this.recoverBtn=this._getActionBtn("recover")),this._buttons.appendChild(this.removeallBtn=this._getActionBtn("removeall")),this.selectNodes={},this.selectedCount=0,this._listItemTempl='<li class="mini-tabstreeselect-item" guid="{{value}}"><span class="item-name" title="{{name}}">{{name}}</span><i class="mini-tabstreeselect-action mini-icon remove" title="'+this.actionTitles.remove+'"></i></li>',this.bindEvents()},__OnDrawNode:function(t){this.fire("drawnode",t)},__OnTreeBeforeNodeCheck:function(t){t.tree=t.sender,this.fire("beforenodecheck",t)},__OnTreeBeforeNodeSelect:function(t){t.tree=t.sender,this.fire("beforenodeselect",t)},__OnTreeExpand:function(t){this.fire("treeexpand",t)},__OnTreeCollapse:function(t){this.fire("treecollapse",t)},__OnNodeClick:function(t){this.fire("nodeclick",{node:t.node})},__OnBeforeLoad:function(t){this.fire("beforeload",t)},__OnCheckedChanged:function(t){t=t.node;t.checked?this._addNode(t):this._removeNode(t)},__OnLoadNode:function(t){var t=t.node,e=this.idField,i=this.tree,n=this.selectNodes;i.eachChild(t,function(t){n[t[e]]||t.checked&&!t.isLeaf?i.checkNode(t):i.uncheckNode(t)}),!t.checked||this.checkRecursive||n[t[e]]||this.tree.uncheckNode(t)},__OnLoad:function(t){this.fire("load",t)},__OnFilter:function(t){this.tree.uncheckAllNodes();for(var e=this.getValue().split(","),i=0,n=e.length;i<n;i++){var s=this.tree.getNode(e[i]);s&&this.tree.checkNode(s)}},__onDimensionChanged:function(t){var e=this.tabsConfig[this._activeTabIndex],i=this.tabKeys[this._activeTabIndex],n=e.url+("&dimension="+t.value),s=e.filterUrl,e=this.tree._filterInput.getValue();s&&this.tree.setFilterUrl(s+("&dimension="+t.value)),this._setLastDimensionValue(i,t.value),e&&"server"===this.tree.filterMode?(this.tree.setAutoLoad(!1),this.tree.setUrl(n),this.treeUrl=n,this.tree._doFilter(e)):(this.tree.url=n,this.tree.setUrl(n),this.treeUrl=n,e&&this.tree._doFilter(e))},_addNode:function(t){var e=t[this.idField];if(this.canCheckParent||this.tree.isLeaf(t)&&!this.selectNodes[e])this.selectNodes[e]=t,"none"!=this._curAutoSortDirection?this._addNodeByDirection(t,this._curAutoSortDirection):mini.append(this._selectList,this._getItemHtml(t));else{var i=this.tree.getChildNodes(t);if(i.length||this.tree.isLeaf(t))for(var n=0,s=i.length;n<s;n++)this._addNode(i[n]);else this.loadChildWhenChecked&&(this.tree._dataSource.loadParams.needAll=!0,this.tree.loadNode(t),this.tree._dataSource.loadParams.needAll=!1)}this._selectList.style.height||(this._selectList.style.height=jQuery(this._rightContent).height()-jQuery(this._buttons).outerHeight(!0)+"px"),this._setSelectedCount()},_addNodeByDirection:function(t,e){for(var i,n=this.tree.getValue().split(","),s=t[this.idField],o=0,l=n.length;o<l&&n[o]!==s;o++);(i=(e="asc"===e?n[o-1]:n[o+1])?jQuery(this._selectList).find('[guid="'+e+'"]'):i)&&i.length?$(this._getItemHtml(t)).insertAfter(i):$(this._selectList).prepend(this._getItemHtml(t))},_removeNode:function(t){var e=t[this.idField];if(delete this.selectNodes[e],jQuery(this._selectList).find('li[guid="'+e+'"]').remove(),this.checkRecursive&!this.tree.isLeaf(t))for(var i=this.tree.getChildNodes(t),n=0,s=i.length;n<s;n++)this._removeNode(i[n]);this._setSelectedCount()},_getItemHtml:function(t){return this._listItemTempl.replace(/{{name}}/g,this.tree.getItemText(t)).replace("{{value}}",t[this.idField])},bindEvents:function(){var n=this;jQuery(this._tabs).on("click","> li",function(){var t=jQuery(this),e=t.index();t.hasClass("active")||n.activeTab(e)}),jQuery(this._selectList).on("click",".remove",function(){var t=jQuery(this.parentNode),e=t.attr("guid"),i=n.tree.getNode(e);t.hasClass("selected")&&(n.selectedListNode=null),i?(n._removeNode(i),n.tree.uncheckNode(i)):(t.remove(),delete n.selectNodes[e],n._setSelectedCount()),n._updateButtons()}).on("mousedown",".mini-tabstreeselect-item",function(t){n.dragItem=this,n.getDrag().start(t)}).on("click",".mini-tabstreeselect-item",function(){var t=jQuery(this);t.hasClass("selected")||(n.selectedListNode&&n.selectedListNode.removeClass("selected"),t.addClass("selected"),n.selectedListNode=t,n._updateButtons())}),jQuery(this._buttons).on("click",".mini-tabstreeselect-action",function(){mini.hasClass(this,"disabled")||(mini.hasClass(this,"sort")&&n.toggleAutoSort(),mini.hasClass(this,"top")?(n.selectedListNode.insertBefore(n._selectList.firstChild),n.toggleAutoSort(!0)):mini.hasClass(this,"bottom")?(n.selectedListNode.insertAfter(n._selectList.lastChild),n.toggleAutoSort(!0)):mini.hasClass(this,"removeall")?n.clearAll():mini.hasClass(this,"recover")&&(n.setValue(n.value),n.setText(n.text)),n._updateButtons())})},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!1,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){this._dragProxy=mini.append(document.body,'<div class="mini-tabstreeselect-proxy"></div>'),this._dragProxy.innerHTML='<div class="mini-tabstreeselect-proxy-inner">'+this.dragItem.outerHTML+"</div>",mini.setXY(this._dragProxy,t.now[0]+15,t.now[1]+18),mini.setWidth(this._dragProxy,mini.getBox(this.dragItem).width),this.feedbackLine=mini.append(document.body,"<div class='mini-feedback-line'></div>"),mini.addClass(this.dragItem,"dragging")},_OnDragMove:function(t){var e=t.now[0],i=t.now[1];mini.setXY(this._dragProxy,e+15,i+18),this.targetItem=this.insertAction=null;t=mini.findParent(t.event.target,"mini-tabstreeselect-item");t?(this.targetItem=t,this.insertAction="before",i>(i=mini.getBox(this.targetItem)).y+i.height/2&&(this.insertAction="after"),this.feedbackLine.style.display="block","after"==this.insertAction?mini.setXY(this.feedbackLine,i.x,i.y+i.height):mini.setXY(this.feedbackLine,i.x,i.y),mini.setWidth(this.feedbackLine,i.width)):this.feedbackLine.style.display="none"},_removeDrag:function(){mini.removeNode(this._dragProxy),mini.removeNode(this.feedbackLine),this._dragProxy=this.feedbackLine=this.dragItem=this.targetItem=null},_OnDragStop:function(t){this.targetItem&&("before"==this.insertAction?this._selectList.insertBefore(this.dragItem,this.targetItem):this._selectList.lastChild==this.targetItem?this._selectList.appendChild(this.dragItem):this._selectList.insertBefore(this.dragItem,this.targetItem.nextSibling),this.toggleAutoSort(!0)),mini.removeClass(this.dragItem,"dragging"),this._removeDrag()},_curAutoSortDirection:"none",toggleAutoSort:function(t){this.showSort&&(t=t?"none":this._getNextAutoSortDirection(),mini.removeClass(this.sortBtn,"asc desc none"),mini.addClass(this.sortBtn,t),this.sortBtn.setAttribute("title",this.sortTitles[t]),"none"!=(this._curAutoSortDirection=t)&&this._serverSort(t))},_getNextAutoSortDirection:function(){switch(this._curAutoSortDirection){case"asc":return"desc";case"desc":default:return"asc"}},_serverSort:function(t){var e=this.getValue(),t={url:this.treeUrl,data:{value:e,direction:t,eventType:"sortChanged"},sender:this};this.fire("beforesortchanged",t),e&&1<e.split(",").length&&this._loadValue(t)},_loadValue:function(t){var a=this,e=setTimeout(function(){a.mask(),a.isMask=!0},100);jQuery.ajax({url:t.url,data:t.data,type:"post",dataType:"json",success:function(t){var e={data:t};if(a.fire("beforeloadvalue",e),!e.cancel&&(t=e.value!==undefined?{value:e.value,text:e.text}:mini.getSecondRequestData(t))){var i,n,s,e=a.getValue(),o=0,l=0,r=[];if(a._selectList.innerHTML="",a.selectNodes={},a.canCheckParent&&a.tree.uncheckAllNodes(),t.value){for(i=t.value.split(","),n=t.text.split(","),l=i.length;o<l;o++)(s=a.tree.getNode(i[o]))?a.tree.checkNode(s):((s={})[a.idField]=i[o],s[a.textField]=n[o]),a.selectNodes[i[o]]=s,r.push(a._getItemHtml(s));a._selectList.insertAdjacentHTML("afterbegin",r.join(""))}a._updateButtons(),a._setSelectedCount(l),e!=a.getValue()&&a._OnValueChanged()}},complete:function(){e&&clearTimeout(e),a.isMask&&(a.unmask(),a.isMask=!1)}})},_updateButtons:function(){var t=function(t){mini.removeClass(t,"disabled")},e=function(t){mini.addClass(t,"disabled")};this.selectedListNode&&this.selectedListNode.siblings().length?this.selectedListNode.prev().length?this.selectedListNode.next().length?(t(this.topBtn),t(this.bottomBtn)):(t(this.topBtn),e(this.bottomBtn)):(e(this.topBtn),t(this.bottomBtn)):(e(this.topBtn),e(this.bottomBtn))},getSelectedNodes:function(){var i=[];return jQuery(this._selectList).children("li").each(function(t,e){e=jQuery(e);i.push({value:e.attr("guid"),text:e.text()})}),i},setSelectedNodes:function(t){for(var e=0,i=t.length;e<i;e++){var n=this.tree.getNode(t[e].value);n?this.tree.selectNode(n):((n={})[this.textField]=t[e].text,n[this.idField]=t[e].value,this.selectNodes[t[e].value]=n,mini.append(this._selectList,this._getItemHtml(n)))}},clearAll:function(){this._selectList.innerHTML&&(this._selectList.innerHTML="",this.selectNodes={},this.selectedListNode=null,this.tree.uncheckAllNodes(),this._setSelectedCount(0))},setValue:function(t){var e=(this.value=t).split(","),i=[];if(this.clearAll(),t){for(var n=0,s=e.length;n<s;n++){var o=this.tree.getNode(e[n]);o?this.tree.checkNode(o):(o={})[this.textField]=o[this.idField]=e[n],this.selectNodes[e[n]]=o,i.push(this._getItemHtml(o))}this._selectList.insertAdjacentHTML("afterbegin",i.join("")),this._updateButtons(),this._setSelectedCount()}},getValue:function(){var i=[];return jQuery(this._selectList).children("li").each(function(t,e){i.push(jQuery(e).attr("guid"))}),i.join(",")},setText:function(t){if(this.text=t)for(var e,i,n=t.split(","),s=this.value.split(","),o=0,l=s.length;o<l;o++)i=s[o],(e=this.selectNodes[i])&&(e[this.textField]=n[o],jQuery(this._selectList).find('li[guid="'+i+'"]').find(".item-name").attr("title",n[o]).html(n[o]))},getText:function(){var i=[];return jQuery(this._selectList).children("li").each(function(t,e){i.push(jQuery(e).find(".item-name").text())}),i.join(",")},setSelectedPanelTitle:function(t){this.selectedPanelTitle=t,this._rightTitle.innerHTML=t},_setSelectedCount:function(t){this.showSelectedCount&&(0!==(t=0<=t?t:jQuery(this._selectList).children("li").length)?mini.removeClass(this._rightCount,"hidden"):mini.addClass(this._rightCount,"hidden"),this._rightCount.innerHTML=t)},setShowSelectedCount:function(t){this.showSelectedCount=!0===t,this.showSelectedCount?mini.removeClass(this._rightCount,"hidden"):mini.addClass(this._rightCount,"hidden")},getShowSelectedCount:function(){return this.showSelectedCount},doLayout:function(){var t=jQuery(this.el).height();this._leftPanel.style.height=t+"px",this._rightPanel.style.height=t+"px";t=jQuery(this._rightContent).height()-jQuery(this._buttons).outerHeight(!0);this._selectList.style.height=(0<=t?t:0)+"px",this.tree.doLayout()},setTabs:function(t,e){var i,n,s=[],o=0<this.url.indexOf("?");for(this.tabsConfig=[],this.tabKeys=[],i=0,n=t.length;i<n;i++){s.push("<li>"+t[i].tabText+"</li>");var l=(o?"&":"?")+"tabKey="+t[i].tabKey;this.tabsConfig.push({url:this.url+l,filterMode:t[i].filterMode,filterUrl:this.filterUrl?this.filterUrl+l:undefined,showDimension:t[i].showDimension}),this.tabKeys.push(t[i].tabKey),t[i].showDimension&&(this.showDimension=!0)}this._tabs.innerHTML=s.join(""),this.doLayout(),this.activeTab(0,e)},addTab:function(t,e){var i=(0<this.url.indexOf("?")?"&":"?")+"tabKey="+t.tabKey;this.tabsConfig.push({url:this.url+i,filterMode:t.filterMode,filterUrl:this.filterUrl?this.filterUrl+i:undefined}),this.tabKeys.push(t.tabKey),jQuery("<li>"+t.tabText+"</li>").appendTo(this._tabs),this.doLayout(),!1!==e&&this.activeTab(this.tabsConfig.length-1,!0)},_getDimensionKey:function(t){return this.id+"_"+t},_getLastDimensionValue:function(t){t=this._getDimensionKey(t);return mini.Cookie.get(t)},_setLastDimensionValue:function(t,e){document.cookie=this._getDimensionKey(t)+"="+escape(e)+";path="+window.location.pathname},_activeTabIndex:0,activeTab:function(t,e){var i,n,s=this.tabsConfig[t],o=jQuery(this._tabs).children().eq(t);s&&(o.hasClass("active")||(o.siblings(".active").removeClass("active"),o.addClass("active")),this._activeTabIndex=t,n=this.tree._filterInput.getValue(),this.tree._filterKey=n,i=s.url,o=s.filterUrl,s.showDimension?((t=this._getLastDimensionValue(this.tabKeys[t]))?this.dimensionComboBox.setValue(t):t=this.dimensionComboBox.getValue(),i+="&dimension="+t,o&&(o+="&dimension="+t),this.dimensionComboBox.show(),this.tree.setHeight($(this._leftContent).height()-this.dimensionComboBox.getHeight()-5)):(this.dimensionComboBox.hide(),this.tree.setHeight("100%")),s.filterMode&&this.tree.setFilterMode(s.filterMode),o&&this.tree.setFilterUrl(o),(o=n&&"server"===this.tree.filterMode)?(this.tree.setAutoLoad(!1),this.tree.setUrl(i),this.treeUrl=i,this.tree._doFilter(n)):(!1===e?this.tree.setAutoLoad(!1):this.tree.setAutoLoad(!0),this.tree._dataSource.ajaxData={activeTab:!0},this.tree.setUrl(i),this.tree._dataSource.ajaxData=null,this.tree._dataSource.loadParams&&(this.tree._dataSource.loadParams.activeTab=!1),this.treeUrl=i,!o&&!1!==e||this.tree.setAutoLoad(!0),n&&this.tree._doFilter(n)))},setData:function(data){"string"==typeof data&&(data=eval("("+data+")"));var treeData=data.tree||data,dimensionData=data.dimension;mini.isArray(treeData)||(treeData=[]),this.resultAsTree?this.tree.setData(treeData):this.tree.loadList(treeData),mini.isArray(dimensionData)||(dimensionData=[]),this.dimensionComboBox.setData(dimensionData),this.data=data},getData:function(){return this.data},setUrl:function(t){this.url=t,this._updateTabsUrl()},getUrl:function(){return this.url},getAutoLoad:function(){return this.autoLoad},setAutoLoad:function(t){this.autoLoad=t},setTabKeys:function(t){this.tabKeys=t,this._updateTabsUrl()},_updateTabsUrl:function(){var t,e=Math.min(this.tabKeys.length,this.tabsConfig.length),i=0<this.url.indexOf("?");if(0<e){for(t=0;t<e;t++){var n=(i?"&":"?")+"tabKey="+this.tabKeys[t];this.tabsConfig[t].url=this.url+n,this.tabsConfig[t].filterUrl=this.filterUrl?this.filterUrl+n:undefined}this.activeTab(0,this.autoLoad)}},load:function(){this.tree.load()},setResultAsTree:function(t){this.resultAsTree=t,this.tree&&this.tree.setResultAsTree(t)},getResultAsTree:function(){return this.resultAsTree},setParentField:function(t){this.parentField=t,this.tree&&this.tree.setParentField(t)},getParentField:function(){return this.parentField},setDataField:function(t){this.dataField=t,this.tree&&this.tree.setDataField(t)},getDataField:function(){return this.dataField},setIdField:function(t){this.tree&&this.tree.setIdField(t),this.idField=t},getIdField:function(){return this.idField},getTextField:function(){return this.textField},setTextField:function(t){this.textField=t,this.tree&&this.tree.setTextField(t)},getNodesField:function(){return this.nodesField},setNodesField:function(t){this.nodesField=t,this.tree&&this.tree.setNodeField(t)},setShowTreeIcon:function(t){this.showTreeIcon=t,this.tree&&this.tree.setShowTreeIcon(t)},getShowTreeIcon:function(){return this.showTreeIcon},setShowTreeLines:function(t){this.showTreeLines=t,this.tree&&this.tree.setShowTreeLines(t)},getShowTreeLines:function(){return this.showTreeLines},setShowFolderCheckBox:function(t){this.showFolderCheckBox=t,this.tree&&this.tree.setShowFolderCheckBox(t)},getShowFolderCheckBox:function(){return this.showFolderCheckBox},setFilterUrl:function(t){this.filterUrl=t,this.tree&&this.tree.setFilterUrl(t)},getFilterUrl:function(){return this.filterUrl},setFilterMode:function(t){this.filterMode=t,this.tree&&this.tree.setFilterMode(t)},getFilterMode:function(){return this.filterMode},setCanCheckParent:function(t){this.canCheckParent=t,this.tree&&this.tree.setCheckRecursive(!t)},getCanCheckParent:function(){return this.canCheckParent},setCheckRecursive:function(t){this.checkRecursive=t,this.tree&&this.tree.setCheckRecursive(t)},getCheckRecursive:function(){return this.checkRecursive},setAutoCheckParent:function(t){this.autoCheckParent=t,this.tree&&this.tree.setAutoCheckParent(t)},getAutoCheckParent:function(){return this.AutoCheckParent},setExpandOnLoad:function(t){this.expandOnLoad=t,this.tree&&this.tree.setExpandOnLoad(t)},getExpandOnLoad:function(){return this.expandOnLoad},setCheckOnTextClick:function(t){this.checkOnTextClick=t,this.tree&&this.tree.setCheckOnTextClick(t)},setExpandOnNodeClick:function(t){this.expandOnNodeClick=t,this.tree&&this.tree.setExpandOnNodeClick(t)},getAttrs:function(t){var e=mini.TabsTreeSelect.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["data","textField","pinyinField","idField","nodesField","parentField","dataField","onbeforenodecheck","onbeforenodeselect","onnodeclick","url","filterUrl","filterMode","onbeforeload","onload","ontreeexpand","ontreecollapse","ondrawnode","onbeforeloadvalue","selectedPanelTitle"]),mini._ParseBool(t,e,["expandOnNodeClick","expandOnLoad","resultAsTree","showTreeIcon","showTreeLines","showFolderCheckBox","canCheckParent","showBorder","loadChildWhenChecked","autoLoad","checkRecursive","autoCheckParent","showFullPath","includeRootNode","checkOnTextClick","showSelectedCount","showSort"]);for(var i,n=[],s=mini.getChildNodes(t),o=0,l=s.length;o<l;o++)i={},mini._ParseString(s[o],i,["tabText","tabKey","filterMode","showDimension"]),n.push(i);return e.tabs=n,e}}),mini.regClass(mini.TabsTreeSelect,"tabstreeselect"),mini.TreeSelect=function(){this.data=[],mini.TreeSelect.superclass.constructor.apply(this,arguments)},mini.extend(mini.TreeSelect,mini.PopupEdit,{valueFromSelect:!1,text:"",value:"",autoCheckParent:!1,expandOnLoad:!1,valueField:"id",textField:"text",nodesField:"children",dataField:"",delimiter:",",multiSelect:!1,data:[],url:"",allowInput:!1,showTreeIcon:!1,showTreeLines:!0,resultAsTree:!1,parentField:"pid",checkRecursive:!1,showFolderCheckBox:!1,showRadioButton:!1,showFilter:!1,filterMode:"client",filterUrl:"",showFullPath:!1,includeRootNode:!1,popupHeight:200,popupWidth:"100%",popupMaxHeight:250,popupMinWidth:100,setAjaxData:function(t){this.ajaxData=t,this.tree.setAjaxData(t)},setAjaxType:function(t){this.ajaxType=t,this.tree.setAjaxType(t)},setAjaxOptions:function(t){this.ajaxOptions=t,this.tree.setAjaxOptions(t)},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;delete t.text;var n=t.url;delete t.url;var s=t.data;delete t.data;var o=t.showFullPath;delete t.showFullPath;var l=t.includeRootNode;delete t.includeRootNode;var r=t.autoLoad;return delete t.autoLoad,mini.TreeSelect.superclass.set.call(this,t),mini.isNull(s)||this.setData(s),mini.isNull(r)||(this.autoLoad=r,this.tree&&this.tree.setAutoLoad(r)),mini.isNull(n)||this.setUrl(n),mini.isNull(e)||this.setValue(e),mini.isNull(i)||this.setText(i),mini.isNull(o)||(this.showFullPath=o,this.tree.showFullPath=o),mini.isNull(l)||(this.includeRootNode=l,this.tree.includeRootNode=l),this},uiCls:"mini-treeselect",_createPopup:function(){mini.TreeSelect.superclass._createPopup.call(this),this.tree=new mini.FilterTree,this.tree.setShowTreeIcon(!0),this.tree.setStyle("border:0;width:100%;height:100%;overflow:hidden;"),this.tree.setResultAsTree(this.resultAsTree),this.tree.render(this.popup._contentEl),this.tree.setCheckRecursive(this.checkRecursive),this.tree.setShowFolderCheckBox(this.showFolderCheckBox),this.tree.setShowRadioButton(this.showRadioButton),this.tree.setExpandOnNodeClick(this.expandOnNodeClick),this.autoLoad!==undefined&&this.tree.setAutoLoad(this.autoLoad),mini.isNull(this.defaultRowHeight)||(this.tree.defaultRowHeight=this.defaultRowHeight);var e=this;this.tree.on("nodeclick",function(t){setTimeout(function(){e.__OnNodeClick(t)},10)},this),this.tree.on("nodecheck",this.__OnCheckedChanged,this),this.tree.on("expand",this.__OnTreeExpand,this),this.tree.on("collapse",this.__OnTreeCollapse,this),this.tree.on("beforenodecheck",this.__OnTreeBeforeNodeCheck,this),this.tree.on("beforenodeselect",this.__OnTreeBeforeNodeSelect,this),this.tree.on("drawnode",this.__OnDrawNode,this),this.tree.useAnimation=!1,this.tree.set({showToolbar:this.showFilter,filterMode:this.filterMode,filterUrl:this.filterUrl}),this.tree.on("filter",this.__OnFilter,this),this.tree.on("beforeload",function(t){e.fire("beforeload",t)},this),this.tree.on("load",function(t){e.fire("load",t)},this),this.tree.on("loaderror",function(t){e.fire("loaderror",t)},this),this.tree.on("loadnode",this.__OnLoadNode,this)},__OnLoadNode:function(t){this.value&&this.tree&&this.tree.setValue(this.value),this.fire("loadnode",t)},__OnDrawNode:function(t){this.fire("drawnode",t)},__OnTreeBeforeNodeCheck:function(t){t.tree=t.sender,this.fire("beforenodecheck",t)},__OnTreeBeforeNodeSelect:function(t){t.tree=t.sender,this.fire("beforenodeselect",t),t.cancel&&(this._nohide=!0)},__OnTreeExpand:function(t){},__OnTreeCollapse:function(t){},__OnFilter:function(){this.tree.setValue(this.value)},findItems:function(t){return this.tree.findNodes(this.tree.getIdField(),t)},findNodes:function(t){return this.tree.getNodesByValue(t)},getSelectedNode:function(){return this.getSelectedNodes()[0]},getCheckedNodes:function(t){var e=this.tree.getNodesByValue(this.value);return this.tree._dataSource.doGetCheckedNodes(e,t=!1===t?"leaf":t)},getSelectedNodes:function(){return this.tree.getNodesByValue(this.value)},getParentNode:function(t){return this.tree.getParentNode(t)},getChildNodes:function(t){return this.tree.getChildNodes(t)},showPopup:function(){var t={cancel:!1};this.fire("beforeshowpopup",t),this._firebeforeshowpopup=!1,1!=t.cancel&&(this.popup.el.style.height,mini.TreeSelect.superclass.showPopup.call(this),this.tree.setValue(this.value,!1),this.expandOnPopup&&this.tree.expandPath(this.value),this._nohide=!1)},expandOnPopup:!1,setExpandOnPopup:function(t){this.expandOnPopup=t},getExpandOnPopup:function(){return this.expandOnPopup},__OnPopupHide:function(t){this.__doFocusCls(),this.tree.clearFilter(),this.fire("hidepopup")},getItem:function(t){return"object"==typeof t?t:this.data[t]},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},loadList:function(t,e,i){this.tree.loadList(t,e,i),this.data=this.tree.getData(),this._getCheckedValue()},getList:function(){return this.tree.getList()},load:function(t){this.tree.load(t),this.data=this.tree.data,this._getCheckedValue()},_eval:function(_){return eval("("+_+")")},setData:function(t){"string"==typeof t&&(t=this._eval(t)),mini.isArray(t)||(t=[]),this.tree.setData(t),this.data=this.tree.data,this._getCheckedValue()},getData:function(){return this.data},_getCheckedValue:function(){var t=this.tree.getValue();this.setValue(t)},setUrl:function(t){this.getPopup(),this.tree.setUrl(t),this.url=this.tree.url,this.data=this.tree.data,this._getCheckedValue()},getUrl:function(){return this.url},virtualScroll:!1,setVirtualScroll:function(t){this.tree&&this.tree.setVirtualScroll(t),this.virtualScroll=t},getVirtualScroll:function(){return this.virtualScroll},defaultRowHeight:23,setDefaultRowHeight:function(t){this.tree&&(this.tree.defaultRowHeight=t),this.defaultRowHeight=t},getDefaultRowHeight:function(){return this.defaultRowHeight},pinyinField:"tag",setPinyinField:function(t){this.pinyinField=t},getPinyinField:function(){return this.pinyinField},setTextField:function(t){this.tree&&this.tree.setTextField(t),this.textField=t},getTextField:function(){return this.textField},setNodesField:function(t){this.tree&&this.tree.setNodesField(t),this.nodesField=t},getNodesField:function(){return this.nodesField},setDataField:function(t){this.tree&&this.tree.setDataField(t),this.dataField=t},getDataField:function(){return this.dataField},getValue:function(){var t=mini.TreeSelect.superclass.getValue.call(this);return this.valueFromSelect&&t&&0==this.findItems(t).length?"":t},setValue:function(t,e){var i=this.tree.getValueAndText(t);""!=i[1]||this.valueFromSelect||(i[0]=t,i[1]=t),this.value=t,this._valueEl.value=t,!e&&this.tree&&this.tree.setValue(t),this.text=this._textEl.value=mini.htmlDecode(i[1]),this._doEmpty()},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t,this.tree.setShowCheckBox(t),this.tree.setAllowSelect(!t),this.tree.setEnableHotTrack(!t))},getMultiSelect:function(){return this.multiSelect},__OnNodeClick:function(t){var e,i;this.multiSelect||(i=this.tree.getSelectedNode(),e=this.tree.getValueAndText(i)[0],i=this.getValue(),this.setValue(e),i!=this.getValue()&&this._OnValueChanged(),!0!==this._nohide&&(this.hidePopup(),isMobile||this.focus()),this._nohide=!1,this.fire("nodeclick",{node:t.node}))},__OnCheckedChanged:function(t){var e,i;this.multiSelect&&(e=this.tree.getValue(!this.checkRecursive),i=this.getValue(),this.setValue(e),i!=this.getValue()&&this._OnValueChanged(),isMobile||this.focus())},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(!this.isReadOnly()){var i=this;switch(t.keyCode){case 27:this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 13:setTimeout(function(){i.fire("enter",e)},10);break;case 37:break;case 38:t.preventDefault();break;case 39:break;case 40:t.preventDefault(),this.showPopup();break;default:0==this.allowInput||setTimeout(function(){i._doQuery()},10)}}}else this.isShowPopup()&&this.hidePopup()},_doQuery:function(){var i,n,s;this.multiSelect||(i=this.textField,n=this.pinyinField,s=this._textEl.value.toLowerCase(),this.tree.filter(function(t){var e=String(t[i]||"").toLowerCase(),t=String(t[n]||"").toLowerCase();return-1!=e.indexOf(s)||-1!=t.indexOf(s)}),this.tree.expandAll(),this.showPopup())},setCheckRecursive:function(t){this.checkRecursive=t,this.tree&&this.tree.setCheckRecursive(t)},getCheckRecursive:function(){return this.checkRecursive},setResultAsTree:function(t){this.resultAsTree=t,this.tree&&this.tree.setResultAsTree(t)},getResultAsTree:function(){return this.resultAsTree},setParentField:function(t){this.parentField=t,this.tree&&this.tree.setParentField(t)},getParentField:function(){return this.parentField},setValueField:function(t){this.tree&&this.tree.setIdField(t),this.valueField=t},getValueField:function(){return this.valueField},setShowTreeIcon:function(t){this.showTreeIcon=t,this.tree&&this.tree.setShowTreeIcon(t)},getShowTreeIcon:function(){return this.showTreeIcon},setShowTreeLines:function(t){this.showTreeLines=t,this.tree&&this.tree.setShowTreeLines(t)},getShowTreeLines:function(){return this.showTreeLines},setShowFolderCheckBox:function(t){this.showFolderCheckBox=t,this.tree&&this.tree.setShowFolderCheckBox(t)},getShowFolderCheckBox:function(){return this.showFolderCheckBox},setShowRadioButton:function(t){this.showRadioButton=t,this.tree&&this.tree.setShowRadioButton(t)},getShowRadioButton:function(){return this.showRadioButton},setAutoCheckParent:function(t){this.autoCheckParent=t,this.tree&&this.tree.setAutoCheckParent(t)},getAutoCheckParent:function(){return this.autoCheckParent},setExpandOnLoad:function(t){this.expandOnLoad=t,this.tree&&this.tree.setExpandOnLoad(t)},getExpandOnLoad:function(){return this.expandOnLoad},setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},expandOnNodeClick:!1,setExpandOnNodeClick:function(t){this.expandOnNodeClick=t,this.tree&&this.tree.setExpandOnNodeClick(t)},getExpandOnNodeClick:function(){return this.expandOnNodeClick},getFilterUrl:function(){return this.filterUrl||this.url},getShowFilter:function(){return this.showFilter},setShowFilter:function(t){this.showFilter=t,this.tree.set({showToolbar:t})},setFilterUrl:function(t){this.filterUrl=t,this.tree.setFilterUrl(t)},getFilterMode:function(){return this.filterMode},setFilterMode:function(t){this.filterMode=t,this.tree.setFilterMode(t)},clear:function(){this.tree._filterInput.setValue(""),this.tree._filterInput.setText(""),this.tree._doFilter("")},getAttrs:function(t){var e=mini.TreeSelect.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","data","textField","pinyinField","valueField","nodesField","parentField","onbeforenodecheck","onbeforenodeselect","expandOnLoad","onnodeclick","onbeforeload","onload","onloaderror","ondrawnode","filterMode","filterUrl"]),mini._ParseBool(t,e,["expandOnNodeClick","multiSelect","resultAsTree","checkRecursive","showTreeIcon","showTreeLines","showFolderCheckBox","showRadioButton","autoLoad","autoCheckParent","valueFromSelect","virtualScroll","expandOnPopup","showFilter","showFullPath","includeRootNode"]),mini._ParseInt(t,e,["defaultRowHeight"]),e.expandOnLoad&&(t=parseInt(e.expandOnLoad),mini.isNumber(t)?e.expandOnLoad=t:e.expandOnLoad="true"==e.expandOnLoad),e}}),mini.regClass(mini.TreeSelect,"TreeSelect"),jQuery(function(){setTimeout(function(){try{var t,e,i=mini.getActiveElement();i&&(!(t=jQuery(i).closest(".mini-buttonedit, .mini-textbox")).length||(e=mini.get(t[0]))&&(e.blur(),e.focus()))}catch(ex){}},100)}),mini.VerifyCode=function(){mini.VerifyCode.superclass.constructor.apply(this,arguments)},mini.extend(mini.VerifyCode,mini.Control,{url:"",autoLoad:!0,width:78,height:32,charLength:4,uiCls:"mini-verifycode",set:function(t){if("string"==typeof t)return this;var e=t.url;return delete t.url,mini.VerifyCode.superclass.set.call(this,t),e&&this.setUrl(e),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<img title="看不清楚，换一个？"></img>',this._img=this.el.firstChild},_initEvents:function(){var t=this;mini.on(this._img,"click",function(){t._doLoad({width:parseInt(this.width),height:parseInt(this.height),charLength:t.charLength})})},setData:function(t){this.value=t.value,this._img.src=t.src,this.uuid=t.uuid},setUrl:function(t){this.url=t,this.autoLoad&&this._doLoad({width:parseInt(this.width),height:parseInt(this.height),charLength:this.charLength})},getUrl:function(){return this.url},_doLoad:function(t){var o,l,r={url:this.url,"async":!1,type:this.ajaxType||"post",data:t=t||{},params:t,cache:!1,cancel:!1};this.fire("beforeload",r),r.data!=r.params&&r.params!=t&&(r.data=r.params),1!=r.cancel&&(o=me=this,l=r.url,mini.copyTo(r,{success:function(t,e,i){delete r.params;var n={text:t,result:null,sender:me,options:r,xhr:i},i=null;try{mini_doload(n),i=(i=n.result)||mini.decode(t)}catch(s){1==mini_debugger&&alert(l+"\njson is error.")}var s={data:(i={data:i}).data,cancel:!1,result:i};o.fire("preload",s),1!=s.cancel&&(o.setData(s.data),delete s.cancel,o.fire("load",s))},error:function(t,e,i){t={xhr:t,text:t.responseText,textStatus:e,errorMsg:t.responseText,errorCode:t.status};1==mini_debugger&&alert(l+"\n"+t.errorCode+"\n"+t.errorMsg),o.fire("loaderror",t)}}),this._ajaxer=mini.ajax(r))},getAttrs:function(t){var e=mini.VerifyCode.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","data","onbeforeload","onload","onloaderror","onpreload"]),mini._ParseBool(t,e,["autoLoad"]),mini._ParseInt(t,e,["charLength"]),e}}),mini.regClass(mini.VerifyCode,"verifycode"),mini.WebEditor=function(){mini.WebEditor.superclass.constructor.call(this)},mini.extend(mini.WebEditor,mini.Control,{width:"100%",height:"350px",readOnly:!1,editstyle:"coolblue",editSkin:"flat10",value:"",uiCls:"mini-webeditor",formField:!0,_editorModel:window.mini_editor_model||"ewebeditor",_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<textarea style="display:none"></textarea>',this._fromEditor=this.el.firstChild,this._editor=new mini.TextArea,this._editor.setVisible(!1),this._editor.render(this.el);var t=this;this.externalSrc=this.externalSrc||mini.externalSrc,"ewebeditor"===this._editorModel?window.EWEBEDITOR?this._initEditor():mini.loadJS(this.externalSrc+"ewebeditor/ewebeditor.js",function(){t._initEditor()}):window.UE?this._initEditor():mini.loadJS(this.externalSrc+"ueditor/ueditor.config.js",function(){mini.loadJS(t.externalSrc+"ueditor/ueditor.all.js",function(){t._initEditor()})})},render:function(t){mini.WebEditor.superclass.constructor.call(this,t)},_initEditor:function(){var t=this;setTimeout(function(){t._doInitEditor()},1)},_doInitEditor:function(){var e,i;!1!==this.isRender()&&(this.editor||((e=this)._editor.set({name:this.id,id:this.id+"_editor"}),this._fromEditor.id=this.id+"_fromEditor","ewebeditor"===this._editorModel?(this.editor=EWEBEDITOR.Replace(this._fromEditor.id,{width:this.width.replace("px",""),height:this.height.replace("px",""),readonly:this.readOnly?"2":"",style:this.editstyle,skin:this.editSkin}),i=window.EWEBEDITOR_EVENT,window.EWEBEDITOR_EVENT=function(t){"LoadComplete"===t.flag&&(e.readOnlyChanged&&e.editor.setReadOnly(e.readOnly?"2":""),e._loadComplete=!0,e.fire("init",{sender:e,type:"init"})),i&&i(t)}):(this.editor=UE.getEditor(this._fromEditor.id,{initialFrameWidth:this.width.replace("px",""),readonly:this.readOnly}),this.editor.ready(function(){e.editor.container.parentElement.style.display="",e.value&&e.editor.setContent(e.value),e._$toolbar=jQuery(e.editor.container).find(".edui-editor-toolbarbox"),e._$footer=jQuery(e.editor.container).find(".edui-editor-bottomContainer"),e.setHeight(e.height),e.fire("init",{sender:e,type:"init"})}))))},getEditor:function(){return this.editor},getEditorPromise:function(e){var i=this,n=jQuery.Deferred(),s=0;return function o(){if(50<s++)return n.reject(new Error("富文本控件初始化超时！"));var t=i.editor;t?setTimeout(function(){n.resolve(t),"function"==typeof e&&e(t)}):setTimeout(o,20)}(),n.promise()},setValue:function(t){this.value=this._fromEditor.value=t,"ewebeditor"===this._editorModel?window.EWEBEDITOR&&EWEBEDITOR.SetHtmlAsync(this._fromEditor.id,t):this.editor&&this.editor.isReady&&this.editor.setContent(t)},getValue:function(){if("ewebeditor"===this._editorModel){if(this.editor&&this.editor.getHTML)return this.editor.getHTML()}else if(this.editor&&this.editor.isReady)return this.editor.getContent();return this.value},setSubmitData:function(){this._editor&&this._editor.setValue(this.getValue())},getSubmitData:function(){return(this._editor||this).getValue()},setReadOnly:function(t){this.editor&&("ewebeditor"===this._editorModel?this._loadComplete?this.editor.setReadOnly(t?"2":""):this.readOnlyChanged=!0:this.editor.isReady&&(t?this.editor.setDisabled("fullscreen"):this.editor.setEnabled())),this.readOnly=t},getReadOnly:function(){return this.readOnly},setHeight:function(t){"ueditor"===this._editorModel&&(t="100%"==t?jQuery(this.el.parentElement).height():parseInt(t))&&(this.height=t,this.editor&&this.editor.isReady&&this.editor.setHeight(t-this._$toolbar.height()-this._$footer.height()))},getAttrs:function(t){var e=mini.WebEditor.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["value","text","editstyle","editSkin","oninit"]),mini._ParseBool(t,e,["readOnly"]),e}}),mini.regClass(mini.WebEditor,"webeditor"),mini.WebUploader=function(){mini.WebUploader.superclass.constructor.call(this)},mini.extend(mini.WebUploader,mini.Control,{uiCls:"mini-webuploader",uploadUrl:"",limitType:"",mimeTypes:"",auto:!0,fileNumLimit:undefined,fileSizeLimit:undefined,fileSingleSizeLimit:undefined,fileNameLengthLimit:100,chunked:!1,chunkSize:5120,chunkRetry:2,duplicate:undefined,needMD5:!1,showIcon:!0,compress:!1,timeout:12e4,threads:3,externalSrc:"",state:"pending",dnd:"",pickerText:"选择文件",startText:"开始上传",pauseText:"暂停上传",numLimitErrorText:"选择的文件过多！</br>最多可上传{0}个文件",sizeLimitErrorText:"选择的文件过大！</br>最多可上传{0}KB文件",typeDeniedErrorText:"选择的文件类型错误！</br>可上传的文件类型为：{0}",sizeErrorText:"选择的文件过大！</br>可上传的单文件最大为{0}KB",emptyFileErrorText:"不能上传空文件！",duplicateErrorText:"不能上传重复的文件！",fileNameLengthErrorText:"选择的文件名称长度过长！</br>文件名最长为{0}个字符",set:function(t){if("string"==typeof t)return this;var e=t.pickerText;return delete t.pickerText,t.menu&&jQuery(t.menu).length&&(this._showSplit=!0,this.menu=t.menu,delete t.menu),t.fileList&&jQuery(t.fileList).length&&(this.setFileList(jQuery(t.fileList)[0]),delete t.fileList),mini.WebUploader.superclass.set.call(this,t),e&&(this.pickerText=e,this._pickerText.innerHTML=e),this._initUploader(),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<div class="mini-uploader-btns"><label class="mini-btn-pick"><i class="mini-button-icon icon-upload"></i><span class="mini-btn-pick-text">'+this.pickerText+'</span></label></div><div class="mini-uploader-list"></div>',this._buttons=this.el.firstChild,this._fileList=this.el.lastChild,this._picker=this._buttons.firstChild,this._pickerText=this._picker.lastChild,this._uploadBtn=new mini.Button,this._uploadBtn.setText(this.startText),this._uploadBtn.render(this._buttons),this.showIcon&&mini.addClass(this._buttons,"show-icon"),this._errorContent="",this._buttons.style.visibility="hidden",this.on("render",this._initUploader,this)},_isInit:!1,_initUploader:function(){var t=this;this.isInit||(this.externalSrc=this.externalSrc||mini.externalSrc,window.WebUploader?this._createUploader():mini.loadJS(this.externalSrc+"webuploader/webuploader.min.js",function(){t._createUploader()}),this._showSplit&&(this._splitBtn=new mini.MenuButton,this._splitBtn.setMenu(this.menu),this._splitBtn.render(jQuery(this.el).find(".mini-btn-pick")[0],"after"),mini.addClass(this._buttons,"dropdown-menu")),this.isInit=!0)},_createUploader:function(){var t=null,o=this;this.limitType&&(t={extensions:this.limitType,mimeTypes:this.mimeTypes}),this._fileMD5={},this.chunked&&!this._isInit?(this._hasFinishedList={},window.isRegWebUploader||(WebUploader.Uploader.register({"before-send-file":"preupload","before-send":"checkchunk","after-send-file":"finished"},{preupload:function(e){var t=this.owner,i=this.options.server,n=WebUploader.Deferred(),s=$(e.source._refer).closest(".mini-webuploader");if((o=mini.getAndCreate(s[0])).chunked)return t.md5File(e.source).fail(function(){n.reject()}).then(function(t){o._fileMD5[e.id]=t,e.uuid=UUID();t={url:i,data:{fileMD5:t,fileName:e.name,fileSize:e.size,uploadGuid:e.uuid}};o._onBeforeMd5File(t),$.ajax(t.url,{dataType:"json",data:t.data,type:"post",success:function(t){o._onMd5File(t,e),n.resolve()},error:function(){n.reject(),$.ajaxSettings.error&&$.ajaxSettings.error.apply(this,arguments)}})}),n.promise()},checkchunk:function(t){if(o.chunked){var e=","+t.chunk+",",t=$.Deferred();return-1<o._existFileParts.indexOf(e)?t.reject():t.resolve(),t.promise()}},finished:function(e){var t=WebUploader.Deferred();if(o.chunked){if(o._hasFinishedList[e.id])return o._hasFinishedList[e.id]=!1,void delete o._hasFinishedList[e.id];var i={url:o.uploadUrl,data:{fileMD5:o._fileMD5[e.id],fileName:e.name,fileSize:e.size,uploadGuid:e.uuid,contentType:e.type}};o._onBeforeMd5FileFinished(i),$.ajax(i.url,{dataType:"json",data:i.data,type:"post",success:function(t){o._onMd5FileFinished(t,e),delete o._fileMD5[e.id]},error:function(){t.reject(),$.ajaxSettings.error&&$.ajaxSettings.error.apply(this,arguments)}})}}}),window.isRegWebUploader=!0)):this.needMD5&&WebUploader.Uploader.register({"before-send-file":"preupload"},{preupload:function(e){var t=this.owner,i=WebUploader.Deferred();return t.md5File(e.source).fail(function(){i.reject()}).then(function(t){o._fileMD5[e.id]=t,i.resolve()}),i.promise()}}),this.dnd&&!jQuery(this.dnd).length&&(window.console&&window.console.error&&console.error("配置的上传拖拽元素选择器无效，无法找到 "+this.dnd+" 这个元素"),this.dnd="");try{this._uploader=WebUploader.create({swf:this.externalSrc+"webuploader/Uploader.swf",server:this.uploadUrl,pick:{id:this._picker,multiple:1!=this.fileNumLimit},dnd:this.dnd,auto:this.auto,fileNumLimit:this.fileNumLimit,fileSizeLimit:1024*this.fileSizeLimit,fileSingleSizeLimit:1024*this.fileSingleSizeLimit,accept:t,chunked:this.chunked,chunkSize:1024*this.chunkSize,chunkRetry:this.chunkRetry,compress:this.compress,duplicate:this.duplicate,timeout:this.timeout,threads:this.threads})}catch(e){if("Runtime Error"!=e.message)throw e;if(mini.isIE9||mini.isIE8||mini.isIE7||mini.isIE6)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){o.el.innerHTML='<a class="noflash" title="要使用上传功能，请下载安装Falsh后，刷新页面" href="http://get.adobe.com/flashplayer/" target="_blank">初始化错误</a>',mini.showPageWarning({html:'检测到您的系统未安装Flash，上传功能不可用。请<a href="http://get.adobe.com/flashplayer/" target="_blank">下载安装Falsh</a>后，刷新页面'})}return}this._uploader.on("beforeFileQueued",function(t){return o._beforeFileQueued(t)}).on("filesQueued",function(t){o._onFilesQueued(t)}).on("fileDequeued",function(t){o._onFileDequeued(t)}).on("reset",function(){o._onReset()}).on("startUpload",function(){o._onStartUpload()}).on("stopUpload",function(){o._onStopUpload()}).on("uploadFinished",function(){o._onUploadFinished()}).on("uploadStart",function(t){o._onUploadStart(t)}).on("uploadBeforeSend",function(t,e,i){o._onUploadBeforeSend(t,e,i)}).on("uploadAccept",function(t,e){return o._onUploadAccept(t,e)}).on("uploadProgress",function(t,e){o._onUploadProgress(t,e)}).on("uploadSuccess",function(t,e){o._onUploadSuccess(t,e)}).on("uploadError",function(t,e){o._onUploadError(t,e)}).on("uploadComplete",function(t){o._onUploadComplete(t)}).on("all",function(t){"startUpload"===t?o.state="uploading":"stopUpload"===t?o.state="paused":"uploadFinished"===t&&(o.state="done"),o.auto||"uploading"!==o.state?o._uploadBtn.setText(o.startText):o._uploadBtn.setText(o.pauseText)}).on("error",function(t){switch(t){case"Q_EXCEED_NUM_LIMIT":o._errorContent=String.format(o.numLimitErrorText,o.fileNumLimit);break;case"Q_EXCEED_SIZE_LIMIT":o._errorContent=String.format(o.sizeLimitErrorText,o.fileSizeLimit);break;case"Q_TYPE_DENIED":o._errorContent=String.format(o.typeDeniedErrorText,o.limitType);break;case"F_EXCEED_SIZE":o._errorContent=String.format(o.sizeErrorText,o.fileSingleSizeLimit);break;case"Q_EMPTY_FILE":o._errorContent=o.emptyFileErrorText;break;case"F_DUPLICATE":o._errorContent=o.duplicateErrorText}}).on("ready",function(){o._uploaderPick=o._picker.lastChild,o.enabled||(o._uploader.disable(),jQuery(o._uploaderPick).detach()),o.fire("init",{sender:o,type:"init"})}),this.auto?this._uploadBtn.hide():this._uploadBtn.on("click",function(){"uploading"===o.state?o._uploader.stop(!0):o._uploader.upload()}),this._buttons.style.visibility="visible",this._isInit=!0},getFileList:function(){return this._fileList},setFileList:function(t){t&&this._fileList!=t&&(this._fileList=t,this._unbindDefaultUIEvents&&this._unbindDefaultUIEvents(),this._initEvents())},getUploader:function(){return this._uploader},getUploaderPromise:function(e){var i=this,n=jQuery.Deferred(),s=0;return function o(){if(50<s++)return n.reject(new Error("上传控件初始化超时！"));var t=i._uploader;t?setTimeout(function(){n.resolve(t),"function"==typeof e&&e(t)}):setTimeout(o,20)}(),n.promise()},retry:function(t){this._uploader.retry(t)},removeFile:function(t){this._uploader.removeFile(t,!0)},clearFile:function(){for(var t=this._uploader.getFiles(),e=t.length-1;0<=e;e--)this.removeFile(t[e])},refresh:function(){this._uploader&&this._uploader.refresh()},_beforeFileQueued:function(t){if(this._events.beforefilequeued){t={source:this,sender:this,type:"beforefilequeued",file:t,cancel:!1};return this.fire("beforefilequeued",t),!t.cancel}},_onFilesQueued:function(t){this._errorContent&&mini.alert(this._errorContent),this._errorContent="",this.fire("filesqueued",{files:t})},_onFileDequeued:function(t){this.fire("filedequeued",{file:t})},_onReset:function(){this.fire("reset")},_onStartUpload:function(){this.fire("startupload")},_onStopUpload:function(){this.fire("stopupload")},_onUploadFinished:function(){this.fire("uploadfinished")},_onUploadStart:function(t){this.fire("uploadstart",{file:t})},_onUploadBeforeSend:function(t,e,i){!this.chunked&&this.needMD5&&(e.fileMD5=this._fileMD5[e.id],delete this._fileMD5[e.id]),this.fire("uploadbeforesend",{object:t,data:e,headers:i})},_onUploadAccept:function(t,e){if(this._events.uploadaccept){e={source:this,sender:this,type:"uploadaccept",object:t,ret:e,cancel:!1};return this.fire("uploadaccept",e),!e.cancel}},_onUploadProgress:function(t,e){this.fire("uploadprogress",{file:t,percentage:e})},_onUploadSuccess:function(t,e){this.fire("uploadsuccess",{file:t,ret:e})},_onUploadError:function(t,e){this.fire("uploaderror",{file:t,reason:e})},_onUploadComplete:function(t){this.fire("uploadcomplete",{file:t})},_onBeforeMd5File:function(t){this.fire("beforemd5file",t)},_onBeforeMd5FileFinished:function(t){this.fire("beforemd5filefinished",t)},_existFileParts:"",_onMd5File:function(t,e){t.fileFinished?(this._uploader.skipFile(e),this._hasFinishedList[e.id]=!0):(this._existFileParts=t.existFileParts||"",this._existFileParts=","+this._existFileParts+",")},_onMd5FileFinished:function(t,e){},setUploadUrl:function(t){this.uploadUrl=t,this._uploader&&this._uploader.option("server",t)},getUploadUrl:function(){return this.uploadUrl},setAuto:function(t){this.auto=t,this._uploader&&this._uploader.option("auto",t)},getAuto:function(){return this.auto},defaultCompres:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0,noCompressIfLarger:!1,compressSize:0},setCompress:function(t){this.compress=!!t&&this.defaultCompres,this._uploader&&this._uploader.option("compress",this.compress)},getCompress:function(){return!!this.compress},setFileNumLimit:function(t){this.fileNumLimit=t,this._uploader&&this._uploader.option("fileNumLimit",t)},getFileNumLimit:function(){return this.fileNumLimit},setFileSizeLimit:function(t){this.fileSizeLimit=t,this._uploader&&this._uploader.option("fileSizeLimit",1024*t)},getFileSizeLimit:function(){return this.fileSizeLimit},setFileSingleSizeLimit:function(t){this.fileSingleSizeLimit=t,this._uploader&&this._uploader.option("fileSingleSizeLimit",1024*t)},getFileSingleSizeLimit:function(){return this.fileSingleSizeLimit},getLimitType:function(){return this.limitType},setLimitType:function(t){this.limitType!=t&&(this.limitType=t,this._uploader&&(this._uploader.options.accept||(this._uploader.options.accept=[{}]),this._uploader.options.accept[0].extensions=this.limitType,this._uploader._init({accept:this._uploader.options.accept})))},getMimeTypes:function(){return this.mimeTypes},setMimeTypes:function(t){var i;this.mimeTypes!=t&&(this.mimeTypes=t,this._uploader&&(this._uploader.options.accept||(this._uploader.options.accept=[{}]),this._uploader.options.accept[0].mimeTypes=this.mimeTypes,"flash"!=this._uploader.predictRuntimeType()&&(i=this._uploader,function n(t){var e=jQuery(i.options.pick.id).find('input[type="file"]');e.length?e.attr("accept",t):setTimeout(function(){n(t)},100)}(this.mimeTypes))))},setVisible:function(t){this.visible=t,this.el&&(t?(mini.removeClass(this.el,"invisible"),mini.removeClass(this._buttons,"webuploader-element-invisible")):(mini.addClass(this.el,"invisible"),mini.addClass(this._buttons,"webuploader-element-invisible")))},setEnabled:function(t){this.enabled=t,this.enabled?(this.removeCls(this._disabledCls),jQuery(this._uploaderPick).appendTo(this._picker),this._uploader&&this._uploader.enable()):(this.addCls(this._disabledCls),this._uploader&&this._uploader.disable(),jQuery(this._uploaderPick).detach()),this._doReadOnly()},getDuplicate:function(){return this.duplicate},setPickerText:function(t){this.pickerText=t,this._pickerText.innerHTML=t},getPickerText:function(){return this.pickerText},setShowIcon:function(t){this.showIcon!==t&&((this.showIcon=t)?mini.addClass(this._buttons,"show-icon"):mini.removeClass(this._buttons,"show-icon"))},getAttrs:function(t){var e=mini.WebUploader.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["uploadUrl","limitType","mimeTypes","onbeforefilequeued","onfilesqueued","onfiledequeued","onreset","onstartupload","onstopupload","onuploadfinished","onuploadstart","onuploadbeforesend","onuploadaccept","onuploadprogress","onuploadsuccess","onuploaderror","onuploadcomplete","pickerText","onbeforemd5file","onbeforemd5filefinished","oninit","dnd","editurl","editext","previewurl","previewext","menu","fileList"]),mini._ParseBool(t,e,["auto","chunked","compress","needMD5","duplicate","showIcon"]),mini._ParseInt(t,e,["fileNumLimit","fileSizeLimit","fileSingleSizeLimit","chunkSize","chunkRetry","timeout","threads"]),e}}),mini.regClass(mini.WebUploader,"webuploader");
//# sourceMappingURL=miniui.min.js.map