!function(){"use strict";function o(o){o=Util.extend({},n,o),this.container=Util.selector(o.container),this.options=o,this._render(),this.update()}var t="https:"===document.location.protocol,i=window.BMAP_STATUS_SUCCESS||0,n={container:"#baidumap",isSupportGeolocation:!1,isForceDD:!1,isForceEJS:!1,longitude:120.61990712,latitude:31.31798737};o.prototype={_render:function(){var o=new BMap.Point(this.options.longitude,this.options.latitude);this.currPoint=o,this.myGeo=new BMap.Geocoder,this.map=new BMap.Map(this.container),this.map.centerAndZoom(o,12)},_updateLocation:function(o){var t=this.map;t.centerAndZoom(o,16),t.enableScrollWheelZoom(!0);var i=new BMap.Marker(o);t.clearOverlays(),t.addOverlay(i),t.panTo(o),this.currPoint=o},_changeBDPointByGeolocationLocation:function(o,t,i,n,e){if("0"==arguments[2]){var a=new BMap.Point(o,t);return void(n&&n(a))}e=e||!1;var a=new BMap.Point(o,t),c=new BMap.Convertor,s=[];s.push(a);var u=e?1:3;c.translate(s,u,5,function(o){var t=a;o&&0===o.status&&o.points&&(t=o.points[0]),n&&n(t)})},_getLocationByEJS:function(o,t){"1"==Config.customize.isCustomLocation&&Util.os.android?this._callApiGetLocation(o):ejs.runtime.getGeolocation({success:function(t){o&&o(t.longitude,t.latitude,1)},error:function(o){t&&t(o.msg||"EJS获取坐标失败")}})},_callApiGetLocation:function(o){window.JSBridge.callHandler("util","invokePluginApi",{path:"baidumap.provider.location",dataMap:{}},function(t){if("1"==t.code)o&&o(t.result.longitude,t.result.latitude,0);else{var i="Log："+t.msg+"\n\n",n="解决方案：\n1、请前往百度地图开发者平台申请appkey\n",e="2、确保前端EJS为3.2.4以上\n\n",a="3、最新版本组件需在 build.gradle或者 project.gradle 中加入,不然打包会报错\n\n";ejs.ui.confirm({title:"温馨提示",message:i+n+e+a,buttonLabels:["关闭当前页面"],cancelable:0,success:function(o){ejs.page.close()}})}},function(o){ejs.ui.confirm({title:"温馨提示",message:o.msg,buttonLabels:["关闭当前页面"],cancelable:0,success:function(o){ejs.page.close()}}),o&&o(o.msg||"自定义api获取坐标失败")})},_getLocationByDD:function(o,t){dd.device.geolocation.get({targetAccuracy:200,coordinate:0,withReGeocode:!1,onSuccess:function(t){o&&o(t.longitude,t.latitude)},onFail:function(o){t&&t("钉钉获取坐标失败")}})},_getLocationByGeolocation:function(o,t){navigator.geolocation.getCurrentPosition(function(t){o&&o(t.coords.longitude,t.coords.latitude)},function(o){switch(o.code){case o.PERMISSION_DENIED:o&&o("用户拒绝对获取地理位置的请求");break;case o.POSITION_UNAVAILABLE:o&&o("位置信息是不可用的。");break;case o.TIMEOUT:o&&o("请求用户地理位置超时。");break;case o.UNKNOWN_ERROR:o&&o("未知错误。");break;default:o&&o("未知错误。")}})},_getLocationByBDBrowser:function(o,t){var n=new BMap.Geolocation;n.getCurrentPosition(function(n){this.getStatus()===i?o&&o(n.point):t&&t("failed"+this.getStatus())},{enableHighAccuracy:!0})},_location:function(){var o=this;o.getLocation(function(t){o._updateLocation(t),o.options.success&&o.options.success(t)},o.options.error)},getLocation:function(o,i){var n=this.options,e=this,a=function(t,i,a){t=t||n.longitude,i=i||n.latitude,e._changeBDPointByGeolocationLocation(t,i,a,o)};n.isForceDD&&Util.os.dd&&window.dd?this._getLocationByDD(a,i):n.isForceEJS&&Util.os.ejs&&window.ejs&&ejs.runtime.getGeolocation?this._getLocationByEJS(a,i):navigator.geolocation&&t&&n.isSupportGeolocation?this._getLocationByGeolocation(a,i):this._getLocationByBDBrowser(a,i)},update:function(o){this.options=Util.extend(this.options,o),this._location()},searchHotPoint:function(o){var t=this;o=o||{},o.poiRadius=o.poiRadius||1e3,o.numPois=o.numPois||12,t.myGeo.getLocation(t.currPoint,function(t){var i=t.surroundingPois;o.success&&o.success(i)},o)},destroy:function(){this.container=null,this.options=null,this.currPoint=null,this.myGeo=null,this.map=null}},window.BaiduMap=o}();