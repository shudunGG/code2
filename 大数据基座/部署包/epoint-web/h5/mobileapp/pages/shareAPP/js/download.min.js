"use strict";var customBiz={configReady:function(){var e=this;e.initConfig()},addEvent:function(){var e=this,t=document.querySelector(".em-btn-content"),n=document.querySelector(".loading"),i=document.querySelector("#showtext"),o=document.querySelector(".modal"),a=document.querySelector(".em-mask");mui(".mui-content").on("tap","#install",function(){var o=this,a=this.getAttribute("downloadUrl");e.judgeENV(function(e){return""!=e?void mui.alert(e):(location.href=a,void(app.os.ios?(o.classList.add("download-animation"),setTimeout(function(){t.style.display="none",n.style.display="block"},250),setTimeout(function(){n.style.display="none",i.style.display="block"},3e3)):(o.classList.add("download-animation"),i.innerText="正在下载，请在浏览器中查看下载进度",setTimeout(function(){t.style.display="none",n.style.display="block"},250),setTimeout(function(){n.style.display="none",i.style.display="block"},8e3))))})}),mui(".mui-content").on("tap",".span12",function(){o.style.opacity="1",document.querySelector(".modal").style.zIndex="999",document.querySelector(".modal-body").style.overflow="scroll",a.style.display="block"}),mui(".mui-content").on("tap",".close",function(){document.querySelector(".modal").style.zIndex="-10",o.style.opacity="0",a.style.display="none",document.querySelector(".modal-body").style.overflow="hidden"})},initConfig:function(){var e=this,t=e.getExtraDataByKey("appguid")||"c2eb7667-8dea-411c-afe1-dd67a452bd5e",n=e.getExtraDataByKey("isHide")||"0";location.href;if(""==t||null==t||void 0==t)return void alert("应用唯一标识为空");var i=JSON.stringify({appguid:t}),o=rootUrl+"rest/mobileappclient/getupdateinfo";mui.ajax(o,{data:{params:i},dataType:"json",type:"post",timeout:1e4,success:function(t){if(t=JSON.parse(t),console.log("3.-App返回结果："+t),1==t.status.code){var i=t.custom,o={};app.os.ios?(o=i.iphoneinfo[0]||{},o.sysicon="img/img_icon_ios.png",o.downloadUrl=o.plistUrl):(o=i.andriodinfo[0]||{},o.sysicon="img/img_icon_android.png",o.downloadUrl=Util.getRightUrl(o.url));var a=document.getElementById("templ").innerHTML,s=Mustache.render(a,o);document.querySelector(".mui-content").innerHTML=s,1==n&&(document.querySelector(".em-btn-content").classList.add("mui-hidden"),document.querySelector(".em-scan").innerText="使用手机扫描二维码安装",document.querySelector(".em-erweima").style.margin="50px auto",document.querySelector(".em-copyright").classList.add("mui-hidden")),e.judgeENV(),e.addEvent(),$("#qrcode").qrcode({width:101,height:101,render:"canvas",text:Util.getRightUrl(o.downloadUrl)})}else mui.toast(t.status.text)},error:function(e,t,n){console.log(JSON.stringify(e))}})},judgeENV:function(e){var t="",n=document.querySelector(".em-tip"),i=document.querySelector(".em-tip-left"),o=document.getElementById("androidIcon"),a=document.getElementById("iosIcon");if(app.os.ios){app.os.uc?(t="您当前使用的是UC浏览器，该浏览器不支持安装App。请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active")):app.os.mobileQQClient?(t="您当前使用的是QQ客户端，该客户端不支持安装App。请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active")):app.os.browserQQ?(t="您当前使用的是QQ浏览器，该浏览器不支持安装App。请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active")):app.os.wechat?(t="点击右上角按钮，然后在弹出的菜单中，请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active")):app.os.weibo&&(t="您当前使用的是微博客户端，该客户端不支持安装App。请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active"));var s=document.querySelector(".span12");a.style.display="inline-block",o.style.display="none",s.style.display="block"}else app.os.android?(app.os.uc?t="":app.os.wechat?(t="点击右上角按钮，然后在弹出的菜单中，点击右上角按钮在浏览器中打开，即可安装",i.innerText=t,n.classList.add("em-tip-active")):app.os.weibo&&(t="您当前使用的是微博客户端，该客户端不支持安装App，点击右上角按钮在浏览器中打开，即可安装",i.innerText=t,n.classList.add("em-tip-active")),a.style.display="none",o.style.display="inline-block"):(t="当前为PC浏览器,PC浏览器下无法安装APP,请用手机浏览器打开",i.innerText=t,n.classList.add("em-tip-active"));e&&e(t)},getExtraDataByKey:function(e){if(!e)return null;var t=function(e,t){var n,i,o=e.substring(e.indexOf("?")+1,e.length).split("&"),a={};for(n=0;i=o[n];n++)a[i.substring(0,i.indexOf("=")).toLowerCase()]=i.substring(i.indexOf("=")+1,i.length);var s=a[t.toLowerCase()];return s=decodeURIComponent(s),"undefined"==typeof s?void 0:s},n=t(window.location.href,e);return"undefined"===n&&(n=null),n}};customBiz.configReady();