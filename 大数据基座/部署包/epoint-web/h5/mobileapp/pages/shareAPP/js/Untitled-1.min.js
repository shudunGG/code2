"use strict";var customBiz={configReady:function(){var e=this;e.initConfig(),mui(".mui-content").on("tap","#install",function(){var t=this.getAttribute("downloadUrl"),n=document.getElementById("plat").innerHTML,i=document.getElementById("ver").innerHTML,o=i.substr(0,i.indexOf("<"));e.judgeENV(function(i){var a=window.location.href,s=a.substr(0,a.indexOf("/d/"))+"/rest/mobileappclient/updatecount",r=JSON.stringify({platform:n,version:o,appguid:e.getExtraDataByKey("appguid")});mui.ajax(s,{data:r,dataType:"json",type:"post",timeout:5e4,headers:{"Content-Type":"application/json"},success:function(e){location.href=t},error:function(e,n,i){console.log(JSON.stringify(e)),location.href=t}})})}),mui(".mui-content").on("tap",".em-logo",function(){var t=this.parentNode.querySelector("#install").getAttribute("downloadUrl");e.judgeENV(function(e){location.href=t})})},initConfig:function(){var e=this,t=e.getExtraDataByKey("appguid");if(""==t||null==t||void 0==t)return void alert("应用唯一标识为空");var n=window.location.href,i=n.substr(0,n.indexOf("/d/"))+"/rest/mobileappclient/getupdateinfo";console.log(i);var o=JSON.stringify({appguid:t});mui.ajax(i,{data:o,dataType:"json",type:"post",timeout:1e4,headers:{"Content-Type":"application/json"},success:function(t){if(console.log(JSON.stringify(t)),1==t.status.code){var n=t.custom,i={};app.os.ios?(i=n.iphoneinfo[0],i.sysicon="img/img_icon_ios.png",i.downloadUrl=i.plistUrl):(i=n.andriodinfo[0],i.sysicon="img/img_icon_android.png",i.downloadUrl=i.url);var o=document.getElementById("templ").innerHTML,a=Mustache.render(o,i);document.querySelector(".mui-content").innerHTML=a,e.judgeENV()}else mui.toast(t.status.text)},error:function(e,t,n){console.log(JSON.stringify(e))}})},judgeENV:function(e){var t="",n=document.querySelector(".em-tip"),i=document.querySelector(".em-tip-left"),o=document.getElementById("androidIcon"),a=document.getElementById("iosIcon");app.os.ios?(app.os.uc?(t="您当前使用的是UC浏览器，该浏览器不支持安装App。请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active")):app.os.mobileQQClient?(t="您当前使用的是QQ客户端，该客户端不支持安装App。请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active")):app.os.browserQQ?(t="您当前使用的是QQ浏览器，该浏览器不支持安装App。请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active")):app.os.wechat&&(t="点击右上角按钮，然后在弹出的菜单中，请在Safari中打开，即可下载",i.innerText=t,n.classList.add("em-tip-active")),a.style.display="inline-block",o.style.display="none"):app.os.android?(app.os.uc?t="":app.os.mobileQQClient?(t="点击右上角按钮，然后在弹出的菜单中，点击在浏览器中打开，即可安装",i.innerText=t,n.classList.add("em-tip-active")):app.os.browserQQ?t="":app.os.wechat&&(t="点击右上角按钮，然后在弹出的菜单中，点击在浏览器中打开，即可安装",i.innerText=t,n.classList.add("em-tip-active")),a.style.display="none",o.style.display="inline-block"):(t="当前为PC浏览器,PC浏览器下无法安装APP,请用手机浏览器打开",i.innerText=t,n.classList.add("em-tip-active")),e&&e(t)},getExtraDataByKey:function(e){if(!e)return null;var t=function(e,t){var n,i,o=e.substring(e.indexOf("?")+1,e.length).split("&"),a={};for(n=0;i=o[n];n++)a[i.substring(0,i.indexOf("=")).toLowerCase()]=i.substring(i.indexOf("=")+1,i.length);var s=a[t.toLowerCase()];return s=decodeURIComponent(s),"undefined"==typeof s?void 0:s},n=t(window.location.href,e);return"undefined"===n&&(n=null),n}};customBiz.configReady();