<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>门户预览</title>
    <script src="../../../../frame/fui/js/cssboot.js"></script>
    <script>
        SrcBoot.output(['framemanager/ui/portalNew/mCustomScrollbar/jquery.mCustomScrollbar.min.css',
            'framemanager/ui/portalNew/portaldesign/css/preview.css',
            'framemanager/ui/portalNew/portaldesign/css/ruler.css'
            // 'framemanager/ui/portalNew/deskmanagement/deskmanagement.css'
        ]);
    </script>
</head>

<body>
    <div class="main relative">
        <!-- 右侧内容 -->
        <div class="container-panel" id="container-panel">
            <div class="painting-area" id="painting-area">
                <div class="grid-container row-line ui-droppable" id="grid-container">
                    <ul>

                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="footer text-center clearfix">
        <a class="mini-button mr-5 verticle-middle" onclick="useTemplate()">使用模板</a>
    </div>

    <!-- 存为模板 -->
    <div id="htmlContent" class="diy-html" style="display:none;">
        <input id="portal-name" class="portal-name" placeholder="请输入模板名称" />
    </div>

    <!-- 模板重命名 -->
    <div id="tempRename" class="diy-html" style="display:none;">
        <input id="temp-name" class="portal-name" placeholder="" />
    </div>

    <!-- 仓库更多-->
    <ul id="lib-more-menu" class="more-menu">
        <li class="menu-item" data-ref="edit">编辑</li>
        <li class="menu-item" data-ref="create">创建副本</li>
        <li class="menu-item text-red" data-ref="delete">删除</li>
    </ul>

    <!-- 元件（仓库） -->
    <script type="x-tmpl-mustache" id="lib-item-tpl">
        <ul>
            {{#list}}
            <li id="lib-item-{{id}}" class="lib-item drag-item{{#visible}} active{{/visible}}" data-id="{{id}}" data-title="{{title}}" data-other="{{other}}" data-url="{{url}}">
                <i class="icon-eye" title="{{#visible}}点击隐藏{{/visible}}{{^visible}}点击显示{{/visible}}"></i>
                <div class="lib-content text-ellipsis" title="{{title}}">
                    {{title}}
                </div>
                <div class="lib-more"></div>
            </li>
            {{/list}}
        </ul>
    </script>
    <!-- 元件（搜索仓库） -->
    <script type="x-tmpl-mustache" id="lib-item-search-tpl">
        <ul>
            {{#list}}
            {{#result}}<li id="lib-item-{{id}}" class="lib-item drag-item{{#visible}} active{{/visible}}" data-id="{{id}}" data-title="{{title}}"  data-other="{{other}}" data-url="{{url}}">
                <i class="icon-eye" title="{{#visible}}点击隐藏{{/visible}}{{^visible}}点击显示{{/visible}}"></i>
                <div class="lib-content text-ellipsis" title="{{title}}">
                    {{{result}}}
                </div>
                <div class="lib-more"></div>
            </li>{{/result}}
            {{/list}}
        </ul>
    </script>

    <script type="x-tmpl-mustache" id="element-content-tpl">
        <ul class="element-body-list">
            {{#itemList}}
            <li class="todo-item">
                <a href="javascript:;" class="todo-item-link" title="{{title}}" data-url="{{url}}" data-id="{{id}}">{{content}}</a>
                <span class="todo-item-date">{{date}}</span>
            </li>
            {{/itemList}}
        </ul>
    </script>
    <!-- js -->
    <script src="../../../../rest/resource/jsboot"></script>
    <script>
        var cacheInitData = [];
        var domain = "rest/portalpreviewaction/",
            portalGuid = Util.getUrlParams('portalGuid'), // 门户ID
            portalConfig = {
                getElementDataUrl: domain + 'getElementData?isCommondto=true'// 获取元件中的列表和数量
            };
    </script>
    <script>
        SrcBoot.output([
            './js/jquery.gridster.min.js',
            './js/common.js',
            './js/preview.js'
        ]);
    </script>
    <script>
        var cacheTableData = '';
        epoint.initPage('portalpreviewaction', '@all', function (data) {

            // 初始化内容
            var tableData = data.tableData;
            cacheTableData = tableData;
            gridster.remove_all_widgets();
            commonUtil.loadTemp({
                templ: './tpl/element.tpl',
                callback: function () {
                    $.each(tableData, function (index, item) {
                        ElementManage.addElementItem(item, true);
                    });

                    gridster.disable();
                }
            });

        });

        function useTemplate() {
            mini.showMessageBox({
                title: "提示",
                iconCls: "mini-messagebox-question",
                buttons: ["取消", "确定"],
                message: "当前门户页面将被模板覆盖，是否确认替换？",
                callback: function (action) {
                    if (action == '确定') {
                        epoint.closeDialog({
                            type: 'ok',
                            options: {
                                data: cacheTableData
                            }
                        });
                    }
                }
            });
        }
    </script>

</body>

</html>