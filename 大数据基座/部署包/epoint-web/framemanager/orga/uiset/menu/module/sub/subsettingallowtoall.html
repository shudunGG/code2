<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>模块授权</title>
<script src="../../../../../../frame/fui/js/cssboot.js"></script>
<link rel="stylesheet"
	href="../../../../../../frame/pages/basic/gateway/app/appinfomanage/css/roleSelect.css" />
<style>
.truncate {
	max-width: 110px;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.footer-btns>.mini-button {
	margin-top: 15px
}
</style>
</head>

<body>
	<div class="role-contain" id="role-contain">
		<div class="role-status">
			<div class="public-status l" id="public-status"></div>
			<span class="public-lable" id="public-lable"> 公开状态：未开启</span>
		</div>
		<div class="tab-contain">
			<div id="multi-tabs" class="hidden multi-tabs">
				<div id="tabs1" class="mini-tabs" tabAlign="fit" activeIndex="0"
					onactivechanged="onactivechanged"
					style="width: 100%; height: 100%;" plain="false">
					<div title="授权角色">
						<div class="role-tab" id="role-a">
							<div class="clearfix">
								<span class="l role-name">授权角色</span>
								<div class="r  role-search">
									<input class="search-input" id="search-input" type="text"
										placeholder="搜索角色名称" />
								</div>
							</div>
							<div class="role-box" id=""></div>
						</div>
					</div>
					<div title="授权用户">
						<div class="mini-fit">
							<div id="tabstreeselect" class="mini-tabstreeselect"
								selectedPanelTitle="已选择记录" style="width: 99%; height: 100%"
								action="getUserTreeModal" loadWhenChecked="true"
								filterMode="server" showBorder="true">
								<div tabText="授权用戶" tabKey="user"></div>
							</div>
						</div>
					</div>
					<div title="授权部门">
						<div class="mini-fit">
							<div id="tabstreeselect2" class="mini-tabstreeselect"
								CheckRecursive="false" selectedPanelTitle="已选择记录"
								style="width: 99%; height: 100%" action="getOuTreeModal"
								loadWhenChecked="true" filterMode="server" showBorder="true">
								<div tabText="所有部门" tabKey="ou"></div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div id="single-tab" class="single-tab hidden">
				<div class="role-tab">
					<div class="clearfix">
						<span class="l role-name">授权角色</span>
						<div class="r  role-search">
							<input class="search-input" id="search-input" type="text"
								placeholder="搜索角色名称" />
						</div>
					</div>
					<div class="role-box" id="role-box2"></div>
				</div>
			</div>
		</div>
		<div class="footer-btns">
			<span class="mini-button confirm-btn" state="primary">保存设置</span> <span
				class="mini-button confirm-btn1" state="primary">级联保存</span> <span
				class="mini-button" onclick="epoint.closeDialog('close')">取消</span>
		</div>
	</div>
	<!-- 内容模板 -->
	<script type="x-tmpl-mustache" id="role-template">
        <ul>
            {{#list}}
            <li class="role-classify {{#isChecked}}select-all{{/isChecked}}">
                <div class="role-title">
                    <div data-id="{{id}}" data-title="{{title}}" class="role-title-check {{#isSearch}}search-title{{/isSearch}} {{#isHideCheck}}no-check{{/isHideCheck}} {{#isChecked}}active{{/isChecked}} l">
                        {{^isSearch}}<i class="role-icons l"></i>{{/isSearch}}
                        <span class="l">{{title}}</span>
                    </div>
                    <i class="role-arrow r"></i>
                </div>
                <div class="role-list-content">
                    <ul class="clearfix role-list">
                        {{#children}}
                        <li class="role-item l">
                            <div data-id="{{id}}" data-title="{{title}}" title="{{title}}" id="check-{{id}}" class="role-check {{#isSearch}}search-check{{/isSearch}} {{#isHideCheck}}no-check{{/isHideCheck}} {{#isChecked}}active{{/isChecked}} clearfix">
                                <i class="role-icons l"></i>
                                <span class="l truncate">{{title}}</span>
                            </div>
                        </li>
                        {{/children}}
                    </ul>
                </div>
            </li>
            {{/list}}
        </ul>
    </script>
	<script src="../../../../../../rest/resource/jsboot"></script>

	<script>
		// 授权用户，部门，群组等
		epoint.initPage('subsettingallowtoallaction', '', function() {
			renderRoleList();
		});

		var roleConfig = {
			// 角色列表
			roleList : epoint
					.dealRestfulUrl('subsettingallowtoallaction/getRoleData'),
			//保存
			roleSave : 'subsettingallowtoallaction/save',
			// 角色搜索
			searchRole : epoint
					.dealRestfulUrl('subsettingallowtoallaction/searchRoles'),
			//级联保存
			saveCascade : 'subsettingallowtoallaction/saveCascade'
		}

		function onactivechanged(res) {
			mini.get('tabstreeselect2').tree.doLayout();
			mini.get('tabstreeselect').tree.doLayout();
		}

		var tree2 = mini.get('tabstreeselect2');

		tree2.on('valuechanged', function(e) {
			var isRootCheck = tree2.tree.getNode('f9root').checked;
			tree2.tree.setValue(e.value);
			if (isRootCheck) {
				tree2.tree.checkNode('f9root');
			}
		});
	</script>
	<script
		src="../../../../../../frame/pages/basic/gateway/app/appinfomanage/js/roleSelect.js"></script>
</body>

</html>