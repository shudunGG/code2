<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>转移角色选择</title>
<script src="../../../../frame/fui/js/cssboot.js"></script>
<link rel="stylesheet"
	href="../../../../frame/pages/basic/gateway/app/appinfomanage/css/roleSelect.css" />
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>

	<!-- 内容区域 -->
	<div class="fui-content">
		<div class="fui-form" id="role-contain">
			<div id="multi-tabs" class="hidden multi-tabs">
				<div id="tabs1" class="mini-tabs" tabAlign="fit" activeIndex="0"
					plain="false">
					<div title="用户所有角色">
						<div class="role-tab">
							<div class="role-box" id=""></div>
						</div>
					</div>
				</div>
			</div>

			<div id="single-tab" class="single-tab hidden">
				<div class="role-tab">
					<div class="role-box" id="role-box2"></div>
				</div>
			</div>
		</div>
	</div>
	<!-- toolbar区域 -->
	<div class="fui-toolbar bottom">
		<a class="mini-button" state="primary" id="addClose"
			onclick="saveAndClose">确定选择</a> <a class="mini-button"
			onclick="epoint.closeDialog">取消选择</a>
	</div>
	<!-- 内容模板 -->
	<script type="x-tmpl-mustache" id="role-template">
        <ul>
            {{#list}}
            <li class="role-classify {{#isChecked}}select-all{{/isChecked}}">
                <div class="role-title">
                    <div data-id="{{id}}" data-title="{{{title}}}" class="role-title-check {{#isSearch}}search-title{{/isSearch}} {{#isHideCheck}}no-check{{/isHideCheck}} {{#isChecked}}active{{/isChecked}} l">
                        {{^isSearch}}<i class="role-icons l"></i>{{/isSearch}}
                        <span class="l">{{{title}}}</span>
                    </div>
                    <i class="role-arrow r"></i>
                </div>
                <div class="role-list-content">
                    <ul class="clearfix role-list">
                        {{#children}}
                        <li class="role-item l">
                            <div data-id="{{id}}" data-title="{{{title}}}" title="{{{title}}}" id="check-{{id}}" class="role-check {{#isSearch}}search-check{{/isSearch}} {{#isHideCheck}}no-check{{/isHideCheck}} {{#isChecked}}active{{/isChecked}} clearfix">
                                <i class="role-icons l"></i>
                                <span class="l truncate">{{{title}}}</span>
                            </div>
                        </li>
                        {{/children}}
                    </ul>
                </div>
            </li>
            {{/list}}
        </ul>
    </script>
	<script src="../../../../rest/resource/jsboot"></script>
	<script>
		var roleConfig = {
			// 角色列表
			roleList : epoint
					.dealRestfulUrl('userroleselectaction/getRoleData')
		}
		var cacheRoleCollection = [];
	</script>
	<script src="../user/js/roleSelect.js"></script>
	<script>
		epoint.initPage('userroleselectaction', '', initCallback);
		function initCallback(e) {
			if (e.soa) {
				epoint.alertAndClose(e.soa, '', null, null, 'info');
			}
			if (e.threemanage) {
				epoint.alertAndClose(e.threemanage, '', null, null, 'info');
			}
		}
		function saveAndClose() {
			var roles = "";
			$(cacheRoleCollection).each(function(index, item) {
				if (!item.isChecked) {
					$(item.children).each(function(i, el) {
						if (el.isChecked) {
							roles += el.id + ";";
						}
					});
				} else {
					$(item.children).each(function(i, el) {
						roles += el.id + ";";
					});
				}
			});
			// 角色授权数据 end
			roles = roles.substring(0, roles.length - 1);
			if (roles != null && roles.length > 0) {
				epoint.closeDialog(roles);
			} else {
				epoint.showTips('请选择要转移的角色',  {state : 'warning'});
			}
		}
	</script>
</body>
</html>