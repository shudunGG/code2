<!DOCTYPE html>
<html>

<head>
<title>数据源管理</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>
	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<a class="mini-button" state="primary" onclick="add()">新增数据源</a> <a
			class="mini-button" state="danger"
			onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.showTips('请选择想要删除的数据源！', {state : 'warning'});} else {deleteItems();}">删除数据源</a>
		<div id="fui-form" class="fui-toolbar-search r">
			<input class="mini-textbox" bind="dataSource.dsname"
				emptyText="请输入数据源名称搜索" onenter="searchData" width="180px" /> <input
				id="dsType" class="mini-combobox" bind="dataSource.dsType"
				name="dsType" width="220px" showNullItem="false" allowInput="false"
				emptyText="请选择数据源类型搜索" action="getDsTypes" autoLoad="false"
				onenter="searchData" showClose="true" oncloseclick="onCloseClick" />
			<a class="mini-button ml8" state="primary" iconCls="icon-search"
				onclick="searchData" tooltip="搜索"></a>
		</div>
	</div>

	<div class="fui-content">
		<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="dsid" multiSelect="true" style="width: 100%; height: 100%;"
			allowResize="true" action="getDataGridData" showPager="true"
			allowCellEdit="false" allowCellSelect="true"
			editNextOnEnterKey="true" editNextRowCell="true">
			<div property="columns">
				<div type="checkcolumn" width="40"></div>

				<div type="indexcolumn" width="40" align="left">序</div>

				<div field="dsname" width="170">数据源名称</div>
				<div field="connectionString" width="100%">连接字符串</div>
				<div field="loginuser" width="170">登录用户</div>
				<div type="actioncolumn">
					操作 <span type="action" icon="icon-edit" onclick="editItems">修改</span>
					<span type="action" icon="icon-copy" onclick="copyItems">复制</span>
				</div>
			</div>
		</div>

	</div>
	<script src="../../../rest/resource/jsboot"></script>

	<!-- 配置变量 -->
	<script>
		//<![CDATA[  
		// 初始化页面
		epoint.initPage('datasourcelistaction');

		function onCloseClick() {
			mini.get('dsType').setValue('');
			mini.get('dsType').setText('');
		}

		// 弹出新增窗口
		function add() {
			epoint.openDialog('新增数据源',
					'framemanager/metadata/datasource/datasource', function(
							param) {
						if (param && param != "close") {
							epoint.showTips(param, {
								state : 'success'
							});
						}
						callBack();
					}, {
						'width' : 970,
						'height' : 410
					});
		}

		// 弹出修改窗口
		function editItems(row) {
			epoint.openDialog("修改数据源",
					'framemanager/metadata/datasource/datasource?dsid='
							+ row.dsid, function(param) {
						if (param && param != "close") {
							epoint.showTips(param, {
								state : 'success'
							});
						}
						callBack();
					}, {
						'width' : 970,
						'height' : 410
					});
		}

		// 弹出复制窗口
		function copyItems(row) {
			epoint.openDialog("复制数据源",
					'framemanager/metadata/datasource/datasource?dsid='
							+ row.dsid + "&extGoal=copy", function(param) {
						if (param && param != "close") {
							epoint.showTips(param, {
								state : 'success'
							});
						}
						callBack();
					}, {
						'width' : 970,
						'height' : 410
					});
		}

		// 删除选中行
		function deleteItems() {
			epoint.confirm("确认删除数据源?", '', function() {
				epoint.execute('deleteSelect', '', msgcallBack);
			});
		}

		// 回掉提醒
		function msgcallBack(data) {
			if (data.msg) {
				if (data.msg.indexOf("成功") != -1) {
					epoint.showTips(data.msg, {
						state : 'success'
					});
				} else {
					epoint.showTips(data.msg, {
						state : 'error'
					});
				}

				epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
			}
		}

		// 回调刷新
		function callBack(param) {
			if (param) {
				epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
			}
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid', 'fui-form' ]);
		}
		//]]>
	</script>
</body>

</html>
