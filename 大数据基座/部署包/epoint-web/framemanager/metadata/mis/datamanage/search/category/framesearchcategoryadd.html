<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>新增</title>
<script src="../../../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>
	<div class="fui-toolbar">
		<a class="mini-button" id="addNew" onclick="saveAndNew">保存并新建</a> <a
			class="mini-button" id="addClose" onclick="saveAndClose">保存并关闭</a> <a
			class="mini-button" onclick="epoint.closeDialog">关闭</a>
	</div>

	<div class="fui-content">
		<div id="fui-form" class="fui-form">
			<div role="form">
				<div role="row">
					<div role="control" label="上级类别" starred="true">
						<input id="parentguid" class="mini-treeselect" emptyText="请选择" showFilter="true" showFolderCheckBox="true"
							bind="dataBean.parentguid" required="true" allowInput="false" showRadioButton="true"
							action="searchcategorytreesingleaction.getTreeModel" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="类别名称" starred="true">
						<input id="categoryname" class="mini-textbox"
							bind="dataBean.categoryname" required="true" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="排序号" starred="true">
						<input id="ordernumber" class="mini-textbox"
							bind="dataBean.ordernumber" required="true" vtype="int" />
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="../../../../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[ 
		var parent = mini.get("parentguid");
		epoint.initPage('framesearchcategoryaddaction', null, function(data) {
			if (data) {
				if (data.parentGuid) {
					parent.setValue(data.parentGuid);
				}
				if (data.parentName) {
					parent.setText(data.parentName);
				}
			}
		});

		function selectCategory() {
			epoint
					.openTopDialog(
							'子集查询类别树',
							'framemanager/metadata/mis/datamanage/search/tree/searchcategorytreesingle',
							function(data) {
								if (data != 'close') {
									parent.setValue(data.id);
									parent.setText(data.text);
								}
							}, {
								width : "400",
								height : "500"
							})

		}

		function saveAndNew() {
			if (epoint.validate()) {
				epoint.execute('addNew', 'fui-form', function(data) {
					if (data && data.msg) {
						if (data.msg == 'success') {
							var alertMsg = '保存成功！';
							epoint.alert(alertMsg, "", null, "info");
							//清理表单
							epoint.clear('fui-form');
						} else {
							epoint.alert(data.msg, "", null, "info");
						}
					}
				});
			}
		}

		function saveAndClose() {
			if (epoint.validate()) {
				epoint.execute('addNew', 'fui-form', closeCallback);
			}
		}

		function closeCallback(data) {
			if (data && data.msg) {
				if (data.msg == 'success') {
					var alertMsg = '保存成功！';
					epoint.alertAndClose(alertMsg, "", null, "info");
				} else {
					epoint.alert(data.msg, "", null, "info");
				}
			}
		}
		//]]>
	</script>
</body>
</html>