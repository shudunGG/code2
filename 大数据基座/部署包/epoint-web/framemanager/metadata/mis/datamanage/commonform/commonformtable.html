<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
<title>动态生成表格</title>
<script src="../../../../../frame/fui/js/cssboot.js"></script>
</head>
<body>
	<div class="page-loading"></div>
	<div class="fui-toolbar">
		<a class="mini-button" id="addNew" onclick="saveAndNew">保存并新建</a> <a
			class="mini-button" id="addClose" onclick="saveAndClose">保存并关闭</a> <a
			class="mini-button" id="addCancel" onclick="epoint.closeDialog">关闭</a> <a class="mini-button" id="updateAndSync" onclick="update()">保存并关闭</a> <a class="mini-button" id="updateCancel" onclick="epoint.closeDialog">取消修改</a>
	</div>
	<!-- 内容区域 -->
	<div class="fui-content">
		<div id="fui-form" class="fui-form">
			<div role="form" id="formColumn"></div>
			<input class="mini-hidden" bind="pageRefresh" id="pageRefresh" />
		</div>
	</div>

	<script src="../../../../../rest/resource/jsboot"></script>
	<script src="../../../../../frame/fui/js/epoint/epoint.controlconfig.js"></script>
	<script src="../../../../../frame/fui/js/epoint/epoint.form.js"></script>
	<script src="../search/js/eputil.js"></script>

	<script type="text/javascript">
		//<![CDATA[
		epoint.initPage("commonformtableaction", '', initCallBack);

		function initCallBack(data) {
			var pageRefresh = data.pageRefresh || '0';
			if (data.add) {
				mini.get("updateAndSync").hide();
				mini.get("updateCancel").hide();
			} else {
				mini.get("addNew").hide();
				mini.get("addClose").hide();
				mini.get("addCancel").hide();
			}
			//加载控件
			if (data.controls) {
				var html = epoint.parseForm(data.controls);
				$('#formColumn').prepend(html);
				//initCondition();

				mini.parse();
			}

			//设置下拉、buttonedit等控件的Text属性值
			if (data.resetControl) {
				var controlObject = JSON.parse(data.resetControl);
				for (var i = 0; i < controlObject.length; i++) {
					var id = controlObject[i].id;
					var value = controlObject[i].value;
					if (mini.get(id)) {
						mini.get(id).setText(value);
					}
				}
			}

			if (!data.add && pageRefresh == '0') {
				mini.get('pageRefresh').setValue('1');
				// epoint.refresh(['fui-form'],'',true);
				epoint.initPage("commonformtableaction");
			}
		}

		function saveAndNew() {
			if (epoint.validate()) {
				epoint.execute('addNew', 'fui-form', newCallback);
			}
		}

		function saveAndClose() {
			if (epoint.validate()) {
				epoint.execute('add', 'fui-form', closeCallback);
			}
		}

		// 新增操作的回调
		function newCallback(data) {
			if (data.msg) {
				epoint.alert(data.msg, null, null, 'info');
				// 清空表单
				epoint.clear('fui-form');
			}
		}

		// 关闭操作的回调
		function closeCallback(data) {
			if (data.msg) {
				epoint.alertAndClose(data.msg);
			}
		}
		function update() {
			if (epoint.validate()) {
				epoint.execute('save', 'fui-form', closeCallback);
			}
		}
		//]]>
	</script>
</body>
</html>