<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>防篡改配置</title>
<!-- 请修改相对路径 -->
<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>

	<!-- 内容区域 -->
	<div class="fui-content">
		<!-- 表单区域  -->
		<div id="fui-form" class="fui-form">
			<div role="form">
				<div role="row">
					<div role="control" label="表名" starred="true">
						<input bind="dataBean.tablename" class="mini-combobox"
							required="true" style="width: 90%" requiredErrorText="请选择表名"
							action="getTableNames" allowInput="true"
							onvaluechanged="onTableNameChanged" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="字段">
						<input id="columns" bind="columns" class="mini-combobox"
							style="width: 90%" multiSelect="true"
							action="getSelectFieldModel" onvaluechanged="onColumnsChanged" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="类型" starred="true">
						<div id="type" name="type" class="mini-radiobuttonlist"
							required="true" action="getDataTypeList" bind="dataBean.datatype"
							textField="text" valueField="id" value="ANTITAMPER"
							onvaluechanged="onTypeChanged"></div>
					</div>
				</div>
			</div>
		</div>

		<!-- 列表区域  -->
		<div id="datagrid" name="datagrid" class="mini-datagrid hidden"
			idField="columnname" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			allowCellValid="true" allowCellEdit="true" showPager="false"
			action="getDataGridData" allowCellSelect="true"
			editNextOnEnterKey="true">
			<div property="columns">
				<div type="indexcolumn" width="40" align="left">序</div>
				<div field="columnname" name="columnname" width="50%">字段名称</div>
				<div field="datamaskingtype" name="datamaskingtype" width="50%"
					type="comboboxcolumn" autoShowPopup="true">
					脱敏类型 <input property="editor" class="mini-combobox"
						style="width: 99%" allowInput="false" data="datamaskingtypes" />
				</div>
			</div>
		</div>
	</div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar bottom">
		<a class="mini-button" state="primary" id="addNew"
			onclick="saveAndNew">保存并新建</a> <a class="mini-button" id="addClose"
			onclick="saveAndClose">保存并关闭</a>
	</div>

	<!-- 请修改相对路径 -->
	<script src="../../../../rest/resource/jsboot">
		
	</script>
	<script>
		// 初始化页面
		epoint.initPage('antitamperaddaction', '', initCallback);

		function initCallback(data) {
		}

		function onTableNameChanged(e) {
			epoint.refresh([ 'fui-form' ]);
		}

		function saveAndNew() {
			if (epoint.validate()) {
				epoint.execute('addNew', [ 'fui-form', 'datagrid' ],
						newCallback);
			}
		}

		function saveAndClose() {
			if (epoint.validate()) {
				epoint
						.execute('add', [ 'fui-form', 'datagrid' ],
								closeCallback);
			}
		}

		// 新增操作的回调
		function newCallback(data) {
			if (data.msg) {
				if (data.success) {
					// 清空表单
					epoint.clear('fui-form');
					epoint.showTips(data.msg,{state : 'success'});
					$("#datagrid").addClass("hidden");
				} else {
					epoint.showTips(data.msg, {state : 'danger'});
				}
			}
		}

		// 关闭操作的回调
		function closeCallback(data) {
			if (data.msg) {
				if (data.success) {
					//top.epoint.showTips(data.msg);
					epoint.closeDialog(data.msg);
				} else {
					epoint.showTips(data.msg, {state : 'danger'});
				}
			}
		}

		// 表安全管理类型切换
		function onTypeChanged(e) {
			// 脱敏控件需要展示表格
			if ("DATAMASKING" == e.value) {
				$("#datagrid").removeClass("hidden");
				epoint.refresh([ 'fui-form', 'datagrid' ]);
			} else {
				$("#datagrid").addClass("hidden");
			}
		}

		// 字段类型切换
		function onColumnsChanged(e) {
			if ("DATAMASKING" == mini.get("type").getValue()) {
				epoint.refresh([ 'fui-form', 'datagrid' ]);
			}
		}

		// 脱敏类型
		var datamaskingtypes = [ {
			id : "CHINESE_NAME",
			text : '中文名'
		}, {
			id : "ID_CARD",
			text : '身份证号'
		}, {
			id : "FIXED_PHONE",
			text : '座机号'
		}, {
			id : "MOBILE_PHONE",
			text : '手机号'
		}, {
			id : "FIXED_PHONE",
			text : '座机号'
		}, {
			id : "EMAIL",
			text : '电子邮件'
		}, {
			id : "BANK_CARD",
			text : '银行卡'
		}, {
			id : "PASSWORD",
			text : '密码'
		}, {
			id : "LOGINID",
			text : '登陆名'
		}, {
			id : "INTELLIGENCE",
			text : '智能脱敏'
		} ];
	</script>
</body>
</html>