<!DOCTYPE html>
<html>

<head>
<title>流程版本管理</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>
<style>
.action-icon2 {
	display: inline-block;
	font-family: ActionIcon !important;
	font-size: 16px;
	font-style: normal;
	line-height: 1;
	color: #888;
	-webkit-font-smoothing: antialiased
}
</style>

<body>
	<div class="page-loading"></div>
	<div class="fui-content">
		<div class="fui-accordions" style="width: 90%; height: 30%;">
			<div role="accordion" opened="true">
				<div role="head" title="通用版本"></div>
				<div role="body">
					<div id="datagrid1" class="mini-datagrid" sortOrder="desc"
						idField="processVersionGuid" multiSelect="true"
						style="width: 100%; height: 300px;" allowResize="false"
						allowCellValid="true" action="getDefaultModel" showPager="false">
						<div property="columns">

							<div field="version" width="200">版本</div>
							<div field="note" width="100%">备注</div>
							<div width="50" renderer="changeImageNoEdit">状态</div>
							<div width="80" renderer="design">查看</div>
							<div width="80" renderer="personalized">个性化</div>
							<div field="status" visible="false"></div>
						</div>
					</div>
				</div>
			</div>

			<div role="accordion">
				<div role="head" title="租户版本"></div>
				<div role="body">
					<div id="datagrid" class="mini-datagrid" sortOrder="desc"
						idField="processVersionGuid" multiSelect="true"
						style="width: 100%; height: 300px;" allowResize="true"
						allowCellValid="true" action="getDefaultModelLessee"
						showPager="false">
						<div property="columns">
							<div type="checkcolumn" width="50"></div>
							<div type="indexcolumn" headerAlign="center" width="50">序</div>
							<div field="version" headerAlign="center" align="center"
								width="200">版本</div>
							<div field="note" headerAlign="center" align="center"
								width="100%">备注</div>
							<div field="name" headerAlign="center" align="center" width="80">挂靠关系</div>
							<div width="50" headerAlign="center" renderer="affiliated"
								align="center">挂靠</div>
							<div width="50" headerAlign="center" align="center"
								renderer="changeImageNoEdit">状态</div>
							<div width="80" headerAlign="center" align="center"
								renderer="material">流程材料</div>
							<div width="80" headerAlign="center" align="center"
								renderer="context">相关数据</div>
							<div headerAlign="center" align="center" width="80"
								renderer="method">方法管理</div>
							<div headerAlign="center" align="center" width="80"
								renderer="design">流程设计</div>
							<div headerAlign="center" align="center" width="50"
								renderer="edit">修改</div>
							<div field="status" visible="false"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<input class="mini-hidden" id="hidMainPVActivityGuid"
			bind="hidMainPVActivityGuid" /> <input class="mini-hidden"
			id="hidProcessVersionGuid" bind="hidProcessVersionGuid" /> <input
			class="mini-hidden" id="processGuid" bind="processGuid" />
		<script src="../../../../rest/resource/jsboot"></script>

		<!-- 配置变量 -->
		<script>
			//<![CDATA[
			//初始化页面
			epoint.initPage("alllesseeprocessversionlistaction");

			function changeImage(e) {
				if (e.row.status == 10) {
					return epoint.renderCell(e, "action-icon icon-start", "");
				} else {
					return epoint.renderCell(e, "action-icon icon-pause", "");
				}
			}

			function changeImageNoEdit(e) {
				if (e.row.status == 10) {
					return epoint.renderCell(e, "action-icon2 icon-start success");
				} else {
					return epoint.renderCell(e, "action-icon2 icon-pause error");
				}
			}

			function affiliated(e) {
				return epoint.renderCell(e, "action-icon icon-fix",
						"JumpToSelectMainProcess");
			}

			function material(e) {
				return epoint.renderCell(e, "action-icon icon-doc",
						"JumpToMaterial");
			}

			function context(e) {
				return epoint.renderCell(e, "action-icon icon-console",
						"JumpToContext");
			}

			function method(e) {
				return epoint.renderCell(e, "action-icon icon-paper",
						"JumpToMethod");
			}

			function design(e) {
				return epoint.renderCell(e, "action-icon icon-search",
						"JumpToDesign");
			}

			function edit(e) {
				return epoint.renderCell(e, "action-icon icon-edit",
						"editVersion");
			}
			//个性化按钮
			function personalized(e) {
				if (e.row.status == 10) {
					return epoint.renderCell(e, "action-icon icon-gear",
							"JumpToActionList");
				}
			}
			//个性化按钮
			function JumpToActionList(processVersionGuid) {
				var url = "lesseeactivitylist?processVersionGuid="
						+ processVersionGuid;
				epoint.openDialog('个性化', "framemanager/workflow/manage/lessee/"
						+ url);

			}

			function changeImage(e) {
				if (e.row.status == 10) {
					return epoint.renderCell(e, "action-icon icon-start success",
							"changeStatus");
				} else {
					return epoint.renderCell(e, "action-icon icon-pause error",
							"changeStatus");
				}
			}

			function copyWorkflow() {
				epoint.execute('copyVersion', 'datagrid', msgCallBack);
			}

			function changeStatus(e) {
				epoint.execute('changeImage', '@none', [ e ], msgCallBack);
			}

			// 删除
			function deleteSelected() {
				epoint.execute('deleteSelect', 'datagrid', msgCallBack);
			}

			function check() {
				epoint.execute('check', 'datagrid', exportafter);
			}

			function exportafter(data) {
				if (data.guid) {
					var form = document.getElementById('download_form');
					form.action = "../../../"
							+ epoint
									.dealRestfulUrl("lesseeprocessversionlistaction/exportWorkflow?exportguid="
											+ data.guid);
					form.submit();
				} else if (data.msg) {
					epoint.alert(data.msg, '', '', 'warning');
				}
			}

			// 回调提醒
			function msgCallBack(data) {
				if (data) {
					var msg = data.msg;
					if (data.flag != null && (data.flag == "1")) {
						epoint.alert(msg, '', function() {
							epoint.refresh('datagrid', '', true);
						}, 'info');
					} else {
						epoint.alert(msg, '', '', 'warning');
					}
				}
			}

			function openAddDialog() {
				var processGuid = mini.get('processGuid').getValue();
				var url = "processversionbaseinfoadd?processGuid="
						+ processGuid;
				epoint.openDialog('新增版本',
						"framemanager/workflow/manage/" + url, function() {
							epoint.refresh('datagrid', '', true);
						}, {
							'width' : 1000
						});
			}

			function changeComplete(msg) {
				if (msg) {
					epoint.alertAndClose(msg, '', null, null, 'info');
				}
			}

			function editVersion(processVersionGuid) {
				var url = "processversionbaseinfoedit?processVersionGuid="
						+ processVersionGuid;
				epoint.openDialog('修改版本',
						"framemanager/workflow/manage/" + url, function() {
							epoint.refresh('datagrid', '', true);
						}, {
							'width' : 1000
						});
			}

			function JumpToDesign(processVersionGuid) {
				var url = "lesseebrowser?processVersionGuid="
						+ processVersionGuid + "&mainPVActivityGuid="
						+ mini.get('hidMainPVActivityGuid').getValue();
				epoint.openTopDialog('流程设计', "framemanager/workflow/design/"
						+ url);
			}

			function JumpToMaterial(processVersionGuid) {
				var url = "processmaterial?processVersionGuid="
						+ processVersionGuid + "&mainPVActivityGuid="
						+ mini.get('hidMainPVActivityGuid').getValue();
				epoint.openDialog('配置流程材料', "framemanager/workflow/manage/"
						+ url, '', {
					'width' : 1000
				});
			}

			function JumpToContext(processVersionGuid) {
				var url = "framemanager/workflow/design/contextfieldlist?processVersionGuid="
						+ processVersionGuid;
				epoint.openDialog('配置相关数据', url, '', {
					'width' : 1000
				});
			}

			function JumpToMethod(processVersionGuid) {
				var url = "methodlist?processVersionGuid=" + processVersionGuid;
				epoint.openDialog('配置流程方法', "framemanager/workflow/design/"
						+ url, '', {
					'width' : 1000
				});
			}

			function JumpToSelectMainProcess(processVersionGuid) {
				var url = "processselectmainprocessframe?processVersionGuid="
						+ processVersionGuid;
				epoint.openDialog('挂接主流程', "framemanager/workflow/manage/"
						+ url, JumpToSelectMainProcessOperJS, {
					'width' : 1000
				});
			}

			// 表格的搜索
			function searchData() {
				epoint.refresh('datagrid');
			}

			function UploadSuccess(args) {
				if (args.ret.extraDatas.msg) {
					epoint.alert(args.ret.extraDatas.msg, '', '', 'warning');
				} else {
					epoint.alert('导入成功', '', null, 'info');
				}
			}

			function JumpToSelectMainProcessOperJS(rtnValue) {
				if (rtnValue && rtnValue != 'close') {
					mini.get('hidMainPVActivityGuid').setValue(
							rtnValue.split(";")[0]);
					// 			    mini.get('hidProcessVersionGuid').setValue(rtnValue.split(";")[1]);
					epoint.refresh('datagrid', '', true);
				}
			}

			//]]>
		</script>
</body>
</html>
