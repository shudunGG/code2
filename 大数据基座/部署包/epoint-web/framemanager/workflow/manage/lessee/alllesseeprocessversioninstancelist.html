<!DOCTYPE html>
<html>

<head>
<title>过程版本实例</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<div class="page-loading"></div>
	<div class="fui-left">
		<div role="head" title="租户列表"></div>
		<div role="body">
			<ul id="tree" class="mini-tree" style="height: 100%"
				action="getTreeData"></ul>
		</div>
	</div>

	<div class="fui-right">
		<div class="fui-condition">
			<div class="fui-form" id="fui-form">
				<div role="form">
					<!-- 2列 -->
					<div role="row">
						<div role="control" label="过程版本实例名称">
							<input bind="processversion" id="processversion"
								class="mini-textbox" />
						</div>
						<div role="control" label="PVIGuid">
							<input bind="pviguid" id="pviguid" class="mini-textbox" />
						</div>
					</div>
					<div role="row">
						<div role="control" label="过程版本实例状态">
							<input id="processversionstate" autoLoad="false"
								bind="processversionstate" textField="text"
								data="[{text:'所有分类',id:'0'},{text:'初始化',id:'10'},{text:'未提交',id:'15'},{text:'已提交',id:'20'},{text:'挂起',id:'30'},{text:'完成',id:'80'},{text:'终止',id:'90'}]"
								valueField="id" class="mini-combobox mr10" />
						</div>
						<div role="control"></div>
					</div>
				</div>
				<!-- 添加隐藏域，用于树与表格的联动 -->
				<input bind="leftNumber" id="leftNumber" class="mini-hidden" />
			</div>
			<!-- 搜索按钮 -->
			<a role="searcher" callback="searchData"></a>
		</div>

		<div class="fui-content">
			<div id="datagrid" class="mini-datagrid" sortOrder="desc"
				idField="processVersionInstanceGuid" multiSelect="true"
				style="width: 100%; height: 100%;" allowResize="true"
				action="getDefaultDataModel" showPager="true"
				editNextOnEnterKey="true" editNextRowCell="true">
				<div property="columns">

					<div type="checkcolumn" width="40"></div>

					<div type="indexcolumn" width="40">序</div>
					<div field="processVersionInstanceGuid" width="280">pviguid</div>
					<div field="pviName" width="100%" renderer="onLocationUrl">名称</div>
					<div field="tenantName" width="80">租户标识</div>
					<div field="sendName" width="120">发起人</div>
					<div field="tenantName" width="80" renderer="onSetting">流程监控</div>
					<div field="startDate" width="150" dateFormat="yyyy-MM-dd HH:mm:ss"
						data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}" allowSort="true"
						sortOrder="desc">开始时间</div>
					<div field="pviStatus" width="80">状态</div>
					<div field="endDate" width="150" dateFormat="yyyy-MM-dd HH:mm:ss"
						data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}">结束时间</div>
				</div>

			</div>
		</div>
	</div>

	<script src="../../../../rest/resource/jsboot"></script>
	<script>
		//<![CDATA[  
		//初始化页面
		epoint.initPage("alllesseepvilistaction");

		//树js对象
		var tree = mini.get("tree");
		// 点击左侧树刷新右侧表格
		tree.on("nodeselect", function(e) {
			var id = e.node.id;
			// 将左侧树点击的节点id放到隐藏域中
			// 在表格发二次请求时，会自动带上条件区域中的内容
			mini.get('leftNumber').setValue(id);
			//刷新表格
			searchData();
		});

		function onLocationUrl(e) {
			return ' <a class="" href="javascript:openBrowserWindow(\''
					+ e.row['processVersionInstanceGuid'] + '\')">' + e.value
					+ '</a>';
		}

		function showFlowChart(processversioninstanceguid) {
			epoint
					.openDialog(
							'流程监控',
							Util
									.addUrlParams(
											"frame/pages/epointworkflow/client/processoa9manage?processVersionInstanceGuid="
													+ processversioninstanceguid
													+ "&actionName=processversioninstancelistaction",
											Util.getUrlParams(), "ignore"),
							function() {
								epoint.refresh([ 'datagrid', 'fui-form' ], '',
										true);
							});
		}

		function openBrowserWindow(processversioninstanceguid) {
			var url = Util
					.addUrlParams(
							"frame/pages/epointworkflow/client/browser/browserenter?ProcessVersionInstanceGuid="
									+ processversioninstanceguid
									+ "&actionName=processversioninstancelistaction",
							Util.getUrlParams(), "ignore");
			epoint.openDialog('流程预览', url);
		}

		function onSetting(e) {
			return epoint.renderCell(e, "action-icon icon-gear",
					"showFlowChart");
		}

		// 回调提醒
		function msgCallBack(data) {
			var msg = data.msg;
			if (msg) {
				epoint.alert(msg, '', function() {
					epoint.refresh([ 'datagrid', 'fui-form' ], '', true);
				}, 'info');
			}
		}

		// 表格的搜索
		function searchData() {
			epoint.refresh([ 'datagrid', 'fui-form' ]);
		}
		//]]>
	</script>
</body>
</html>
