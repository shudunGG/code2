<!DOCTYPE html>
<html>

<head>
<title>过程版本修改</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<link rel="stylesheet"
	href="../css/workflowicons.css?releaseNo=#{version.version}" />
<script src="../../../frame/fui/js/cssboot.js"></script>
<style type="text/css">
p {
	margin-left: 16px;
	margin-right: 16px;
}
</style>
</head>

<body>
	<div class="page-loading"></div>

	<!-- toolbar区域 -->
	<div class="fui-toolbar">
		<a class="mini-button" state="primary" id="addbtn"
			onclick="saveProcessVersion()">保存修改</a> <a class="mini-button"
			id="cancelbtn" onclick="epoint.closeDialog()">取消修改</a> <a
			role="helper" class="mr10">使用过程中需注意的信息</a>
	</div>

	<!-- 帮助信息区域 默认隐藏-->
	<div class="fui-notice hidden">
		<p>
			<font>监听类的配置为类全路径，该类必须实现com.epoint.workflow.engine.event.EventObserver接口，
			</font>
		</p>
		<p>
			<font>用于监听整个流程的流转，当你实现它后，原则上将不需要配置任何其他事件。</font>
		</p>
	</div>

	<div class="fui-content">
		<div class="fui-form" style="width: 90%">
			<div role="form">
				<!-- 2列 -->
				<div role="row">
					<div role="control" label="版本" starred="true">
						<input class="mini-textbox" required="true"
							bind="workflowProcessVersion.version" emptyText="版本名称不能为空"
							style="width: 100%;" />
					</div>
					<div role="control" label="版本实例名称" id="versionname">
						<input class="mini-textbox"
							bind="workflowProcessVersion.processVersionName" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="监听类" id="type">
						<input class="mini-combobox" bind="workflowProcessVersion.tag"
							action="getWorkFlowEvent" showClose="true" id="tag"
							allowInput="true" oncloseclick="onCloseClick" />
					</div>
					<div role="control" label="作者" id=author>
						<input class="mini-textbox" bind="author" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="过程实例名称">
						<input class="mini-buttonedit " id="pviname"
							bind="workflowProcessVersion.instanceNameExpression"
							onbuttonclick="setParValue1" />
					</div>
					<div style="display: none">
						<input id="pvguid" class="mini-textbox"
							bind="workflowProcessVersion.processVersionGuid" />
					</div>
				</div>
				<div role="row">
					<div role="control">
						<span class="text-danger">可以是字符串+相关数据
							,如[#=项目名称#]（[#=申请单位#]）</span>
					</div>
				</div>
				<div role="row">
					<div role="control" label="待办事宜标题">
						<input class="mini-buttonedit" onbuttonclick="setParValue2"
							bind="workflowProcessVersion.workItemNameExpression"
							style="width: 100%;" id="title" />
					</div>
				</div>
				<div role="row">
					<div role="control">
						<span class="text-danger">可以是字符串+相关数据
							,如[#=项目名称#]（[#=申请单位#]）</span>
					</div>
				</div>
				<div role="row" style="word-break:keep-all">
					<div role="control" label="移动端待办事宜标识">
						<input class="mini-textbox"
							bind="workflowProcessVersion.mobileMessageTag" />
					</div>
				</div>
				<div role="row">
					<div role="control">
						<span class="text-danger">说明：多系统或者需个性化移动接口时可以填写</span>
					</div>
				</div>
				<div role="row" style="word-break:keep-all">
					<div role="control" label="删除业务实例方法">
						<input class="mini-buttonedit"
							onbuttonclick="selDeleteAppInstanceMethodGuid"
							bind="txtMethodName" style="width: 100%;" id="txtMethodName"
							selectOnFocus="true" />
					</div>
				</div>
				<div role="row" style="display: none">
					<div role="control">
						<input id="hidMethodGuid" class="mini-textbox"
							bind="workflowProcessVersion.deleteAppInstanceMethodGuid" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="备注">
						<input class="mini-textarea" bind="workflowProcessVersion.note"
							style="width: 100%; height: 80px" />
					</div>
				</div>
				<div role="row">
					<div role="control" label="允许时限">
						<input id="txtTimeLimit" bind="txtTimeLimit" class="mini-textbox"
							style="width: 20%" /> <input id="timeLimitUnit"
							name="timeLimitUnit" showNullItem="false"
							bind="workflowProcessVersion.timeLimitUnit"
							action="getTiemUnitList" class="mini-combobox" textField="text"
							valueField="id" style="width: 30%; margin-left: 8px" />
					</div>
					<div role="control" label="提前预警时间">
						<input id="txtWarningTime" bind="txtWarningTime"
							class="mini-textbox" style="width: 20%" /> <input
							id="earlyWarningTimeUnit" name="earlyWarningTimeUnit"
							showNullItem="false"
							bind="workflowProcessVersion.earlyWarningTimeUnit"
							action="getTiemUnitList" class="mini-combobox" textField="text"
							valueField="id" style="width: 30%; margin-left: 8px" />
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="../../../rest/resource/jsboot"></script>

	<!-- 配置变量 -->
	<script>
		//<![CDATA[
		//初始化页面
		epoint.initPage("processversionbaseinfoeditaction", '', initEdit);

		function initEdit(e) {
			if (e) {
				mini.get("pviname").setValue(e.pviname);
				mini.get("pviname").setText(e.pviname);
				mini.get("title").setValue(e.title);
				mini.get("title").setText(e.title);
				mini.get("txtMethodName").setValue(e.txtMethodName);
				mini.get("txtMethodName").setText(e.txtMethodName);
			}
		}

		function showSelect(e) {
			epoint.openDialog('选择所属类别',
					'framemanager/workflow/manage/selectItemcode',
					showSelectOperJS, {
						'width' : 300,
						'height' : 550
					});
		}

		function setParValue1(e) {
			var pvguid = mini.get('pvguid').getValue();
			epoint.openDialog('选择相关数据',
					"framemanager/workflow/design/designhelper?mode=context&processVersionGuid="
							+ pvguid, setParValue1OperJS, {
						'width' : 480,
						'height' : 300
					});
		}

		function saveProcessVersion() {
			if (epoint.validate()) {
				if ((mini.get("txtMethodName").getValue() == "")
						|| (mini.get("txtMethodName").getValue() == null)) {
					mini.get("hidMethodGuid").setValue("");
				}
				epoint.execute('saveProcessVersion', '', editComplete);
			}
		}

		function setParValue1OperJS(data) {
			if (data && data != 'close') {
				var s = data.split(';')[0];
				mini.get('pviname').setValue("[#=" + s + "#]");
				mini.get('pviname').setText("[#=" + s + "#]");
				mini.get('pviname').validate("[#=" + s + "#]");
			}
		}

		function setParValue2(e) {
			var pvguid = mini.get('pvguid').getValue();
			epoint.openDialog('选择相关数据',
					"framemanager/workflow/design/designhelper?mode=context&processVersionGuid="
							+ pvguid, setParValue2OperJS, {
						'width' : 480,
						'height' : 300
					});
		}

		function setParValue2OperJS(data) {
			if (data && data != 'close') {
				var s = data.split(';')[0];
				mini.get('title').setValue("[#=" + s + "#]");
				mini.get('title').setText("[#=" + s + "#]");
				mini.get('title').validate("[#=" + s + "#]");
			}
		}

		function selDeleteAppInstanceMethodGuid(e) {
			var pvguid = mini.get('pvguid').getValue();
			epoint.openDialog('选择方法',
					"framemanager/workflow/design/designhelper?mode=function&processVersionGuid="
							+ pvguid, setDeleteJS, {
						'width' : 480,
						'height' : 300
					});
		}

		function setDeleteJS(data) {
			if (data && data != 'close') {
				var rtnArray = data.split(";");
				mini.get('txtMethodName').setValue("[#=" + rtnArray[0] + "#]");
				mini.get('txtMethodName').setText("[#=" + rtnArray[0] + "#]");
				mini.get("hidMethodGuid").setValue(rtnArray[1]);
			}
		}

		function editComplete(data) {
			if (data) {
				if (data.flag != null && (data.flag == "1")) {
					epoint.closeDialog(data.sameName);
				} else {
					epoint.showTips(data.sameName, {
						state : 'warning'
					});
				}
			}
		}

		//清除监听类
		function onCloseClick() {
			mini.get('tag').setValue('');
			mini.get('tag').setText('');
		}

		//]]>
	</script>
</body>
</html>
