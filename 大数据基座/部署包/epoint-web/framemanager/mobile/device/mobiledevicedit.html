<!DOCTYPE html>
<html>

<head>
<title>设备列表</title>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<!-- 请修改相对路径 -->
<script src="../../../frame/fui/js/cssboot.js"></script>
</head>

<body>
	<!-- 必须有，加载时的loading效果 -->
	<div class="page-loading"></div>
	<div class="fui-toolbar">
		<a id="btnDel" class="mini-button" state="danger"
			onclick="epoint.confirm('确认要删除吗?','',deleteAll)"> 删除全部 </a>
	</div>
	<!-- 内容区域 -->
	<div id="fuiContent" class="fui-content">
		<div id="datagrid" class="mini-datagrid" idField="rowguid"
			action="getDataGridData" sortOrder="desc" showPager="true"
			style="height: 100%;" allowResize="true" multiSelect="true"
			allowCellEdit="true" allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true">
			<div property="columns">
				<div type="indexcolumn" width="30" headerAlign="center">序</div>
				<div field="deviceinfo" headerAlign="center" align="center"
					width="150">设备型号</div>
				<div field="deviceid" headerAlign="center" align="center"
					width="100%">设备ID</div>
				<div field="appversion" headerAlign="center" align="center"
					width="65">app版本</div>
				<div field="appguid" visible="false"></div>
				<div field="registdate" headerAlign="center" width="150"
					data-options="{'format':'yyyy-MM-dd HH:mm:ss'}"
					dateFormat="yyyy-MM-dd HH:mm:ss" align="center">注册时间</div>
				<div field="lastusedate" headerAlign="center" width="150"
					data-options="{'format':'yyyy-MM-dd HH:mm:ss'}"
					dateFormat="yyyy-MM-dd HH:mm:ss" align="center">登录时间</div>
				<div field="enableStatus" width="45" align="center"
					headerAlign="center" renderer="onEnableRenderer">状态</div>
				<div field="enablebutton" name="enablebutton" headerAlign="center"
					renderer="onEnableBtnRenderer" align="center" width="45">操作</div>
				<div name="devicedelete" width="45" align="center"
					headerAlign="center" renderer="onDelRenderer">删除</div>
			</div>
		</div>
	</div>

	<!-- 请修改相对路径 -->
	<script src="../../../rest/resource/jsboot"></script>
	<script>
		// 初始化页面
		epoint.initPage('mobiledeviceeditaction');

		//绘制初始化密码列
		function onEnableBtnRenderer(e) {
			var rowGuid = e.row['rowguid'];
			return "<a  style=\"cursor:pointer;color:blue;\"  onclick=\"enableBtn('"
					+ rowGuid + "')\">" + e.value + "</a>";
		}

		//启用禁用操作
		function enableBtn(rowGuid) {
			epoint
					.execute('setDeviceEnable', '', '[' + rowGuid + ']',
							callback);
		}

		function callback(data) {
			if (data.success) {
				epoint.refresh([ 'datagrid' ], '', true);
				epoint.alert(data.msg, '', null, 'success');
			} else {
				if (data.msg) {
					epoint.alert(data.msg, '', null, 'warning');
				}
			}
		}

		//绘制状态列
		function onEnableRenderer(e) {
			var enableValue = e.value;
			if (enableValue == '已禁用') {
				return "<span style=\"color:red;\">" + enableValue + "</span>";
			}

			return enableValue;
		}

		// 绘制行删除按钮
		var onDelRenderer = function(e) {
			return epoint.renderCell(e, "action-icon icon-remove",
					"deleteDevice", "rowguid");
		};

		// 删除一行数据
		function deleteDevice(rowguid) {
			// 弹出确认框
			epoint.confirm("确认删除该条数据吗?", '', function() {
				epoint.execute('deleteDevice', '', '[' + rowguid + ']',
						callback);
			});
		}

		// 删除数据
		function deleteAll() {
			epoint.execute("deleteAll", '', callback);
		}
	</script>
</body>
</html>