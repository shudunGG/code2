!function(){"use strict";function n(n){n=mui.extend({},t,n),this.container=this._selector(n.container),this._initData(n)}var t={container:"#calendar",isLunar:!0,isSwipeH:!0,isSwipeV:!0};n.prototype={_initData:function(n){if(this.options=n,!this._validate())throw new Error("验证错误，日历的传入格式非法，请检查代码");this._initParams(),this._addEvent()},_initParams:function(){var n=this;n.newDate=new Date,n.nowYear=n.newDate.getFullYear(),n.nowMonth=n.newDate.getMonth()+1,n.nowDay=n.newDate.getDate(),n.nowMonth=String(n.nowMonth),1==n.nowMonth.length&&(n.nowMonth="0"+n.nowMonth),n.CalendarData=new Array(100),n.madd=new Array(12),n.tgString="甲乙丙丁戊己庚辛壬癸",n.dzString="子丑寅卯辰巳午未申酉戌亥",n.numString="一二三四五六七八九十",n.monString="正二三四五六七八九十冬腊",n.weekString="日一二三四五六",n.sx="鼠牛虎兔龙蛇马羊猴鸡狗猪",n.cYear,n.cMonth,n.cDay,n.TheDate,n.CalendarData=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877),n.madd[0]=0,n.madd[1]=31,n.madd[2]=59,n.madd[3]=90,n.madd[4]=120,n.madd[5]=151,n.madd[6]=181,n.madd[7]=212,n.madd[8]=243,n.madd[9]=273,n.madd[10]=304,n.madd[11]=334,this.refresh(n.nowYear,n.nowMonth,n.nowDay)},refresh:function(n,t,a){var e=this;e.nowYear=parseInt(n),e.nowMonth=parseInt(t),e.nowDay=parseInt(a),parseInt(e.nowMonth)>9?e.nowMonth=""+parseInt(e.nowMonth):e.nowMonth="0"+parseInt(e.nowMonth),parseInt(e.nowDay)>9?e.nowDay=""+parseInt(e.nowDay):e.nowDay="0"+parseInt(e.nowDay);var o=new Date(Date.parse(e.nowYear+"/"+e.nowMonth+"/1")),r=o.getDay();r=parseInt(r),0==r&&(r=7);var s=this._judgeDaysByYearMonth(e.nowYear,e.nowMonth),i={},h=this._judgeDaysByYearMonth(e.nowYear,e.nowMonth-1);h=parseInt(h);for(var d=r;d>0;d--){var w=h--,p="day"+d,c="lunar"+d;i[p]=w,i[c]=this._getLunar(w,"m-1")}var u=0;if("28"==s){u=28+r;for(var d=r+1,l=1;d<28+r+1;d++,l++){var p="day"+d,c="lunar"+d;i[p]=l,i[c]=this._getLunar(l)}}if("29"==s){u=29+r;for(var d=r+1,l=1;d<29+r+1;d++,l++){var p="day"+d,c="lunar"+d;i[p]=l,i[c]=this._getLunar(l)}}if("30"==s){u=30+r;for(var d=r+1,l=1;d<30+r+1;d++,l++){var p="day"+d,c="lunar"+d;i[p]=l,i[c]=this._getLunar(l)}}if("31"==s){u=31+r;for(var d=r+1,l=1;d<31+r+1;d++,l++){var p="day"+d,c="lunar"+d;i[p]=l,i[c]=this._getLunar(l)}}for(var D=u+1,y=1;D<=42;D++,y++){var p="day"+D,c="lunar"+D;i[p]=y,i[c]=this._getLunar(y,"m+1")}this._render(i)},_render:function(n){for(var t=this,a=[],e=1;e<43;e++)a.push({day_index:"{{day"+e+"}}",lunar_index:"{{lunar"+e+"}}"});var o="";o+='<table id="dateBorder">',o+="<tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr>";for(var r=1;r<7;r++){o+="<tr>";for(var s='<td><div class="dateQuan"><span class="day" data-value="{{day_index}}">{{day_index}}</span><span class="font12">{{lunar_index}}</span></div></td>',i="",h=7;h>0;h--){var d=7*r-h+1;i+=Mustache.render(s,a[d-1])}o+=i,o+="</tr>"}o+="</table>";var i=Mustache.render(o,n);this._selector(this.options.container).innerHTML=i;for(var w=0;w<=41&&1!=parseInt(Zepto("td")[w].innerText);w++)Zepto(Zepto("td")[w]).css("color","#D8D8D8"),Zepto(Zepto("td")[w]).find("div.dateQuan").addClass("nouse");for(var p=41;p>=0;p--){if(1==parseInt(Zepto("td")[p].innerText)){Zepto(Zepto("td")[p]).css("color","#D8D8D8"),Zepto(Zepto("td")[p]).find("div.dateQuan").addClass("nouse");break}Zepto(Zepto("td")[p]).css("color","#D8D8D8"),Zepto(Zepto("td")[p]).find("div.dateQuan").addClass("nouse")}var c=new Date,u=c.getFullYear(),l=c.getMonth()+1;u==t.nowYear&&l==t.nowMonth&&Zepto(".dateQuan").each(function(){if(Zepto(this).hasClass("nouse"));else{var n=Zepto(this).text();t.nowDay==parseInt(n)&&(Zepto(".dateQuan").removeClass("clickActive"),Zepto(this).addClass("clickActive").html("<span class='day' data-value='"+t.nowDay+"'>今天</span><span class='font12'>"+n.substr(-2,2)+"<span>"))}})},_addEvent:function(){var n=this,t=n.options.itemClick,a=n.options.swipeCallback;mui(n.options.container).on("tap",".dateQuan",function(){var a=this.querySelector(".font12").innerText.trim();if(Zepto(this).hasClass("nouse"));else{Zepto(".dateQuan").removeClass("clickActive"),Zepto(this).addClass("clickActive");var e=this.querySelector(".day").getAttribute("data-value");e=parseInt(e)>9?""+parseInt(e):"0"+parseInt(e);var o=n.nowYear+"-"+n.nowMonth+"-"+e;t&&t({date:o,lunar:a})}}),n.options.isSwipeH&&(n._selector(n.options.container).addEventListener("swiperight",function(){n.options.isDebug&&console.log("你正在向右滑动"),n.nowMonth=parseInt(n.nowMonth)-parseInt(1),0==n.nowMonth&&(n.nowYear=n.nowYear-1,n.nowMonth=12),parseInt(n.nowMonth)>9?n.nowMonth=""+parseInt(n.nowMonth):n.nowMonth="0"+parseInt(n.nowMonth),parseInt(n.nowDay)>9?n.nowDay=""+parseInt(n.nowDay):n.nowDay="0"+parseInt(n.nowDay),n.refresh(n.nowYear,n.nowMonth,n.nowDay),a&&a({year:n.nowYear,month:n.nowMonth,day:n.nowDay})}),n._selector(n.options.container).addEventListener("swipeleft",function(){n.options.isDebug&&console.log("你正在向左滑动"),n.nowMonth=parseInt(n.nowMonth)+parseInt(1),13==n.nowMonth&&(n.nowYear=n.nowYear+1,n.nowMonth=1),parseInt(n.nowMonth)>9?n.nowMonth=""+parseInt(n.nowMonth):n.nowMonth="0"+parseInt(n.nowMonth),parseInt(n.nowDay)>9?n.nowDay=""+parseInt(n.nowDay):n.nowDay="0"+parseInt(n.nowDay),n.refresh(n.nowYear,n.nowMonth,n.nowDay),a&&a({year:n.nowYear,month:n.nowMonth,day:n.nowDay})})),n.options.isSwipeV},_getLunar:function(n,t){var a=this,e=a.nowYear,o=a.nowMonth;o=parseInt(o),"m+1"===t&&(o=1+o,13==o&&(o=1)),"m-1"===t&&(o=-1+o,0==o&&(o=1));var r=n;new Date(Date.parse(e+"/"+o+"/"+r)).getDay();return this._getLunarDay(e,o,r)},_judgeDaysByYearMonth:function(n,t){var a=this;if(void 0==n||null==n)throw"=====获取当前月份天数时，缺少y参数，未定义！=======";if(void 0==t||null==t)throw"=====获取当前月份天数时，缺少m参数，未定义！=======";var n=parseInt(n),t=parseInt(t);return 0==t&&(n--,t=12),2==t?n%4==0&&n%100!=0||n%400==0?"29":"28":a._inArray(t,[1,3,5,7,8,10,12])?"31":"30"},_validate:function(){var n=!0;return this.options.container||(n=!1),n},_selector:function(n){return document.querySelector(n)},_inArray:function(n,t){if(!Array.isArray(t))throw"arguments is not Array";for(var a=0,e=t.length;a<e;a++)if(n==t[a])return!0;return!1},_sibling:function(n,t){for(var a=n.parentNode.firstChild;a;a=a.nextSibling)1===a.nodeType&&a!==n&&t&&"function"==typeof t&&t(a)},_getBit:function(n,t){return n>>t&1},_e2c:function(){var n=this;n.TheDate=3!=arguments.length?new Date:new Date(arguments[0],arguments[1],arguments[2]);var t,a,e,o,r=!1,s=n.TheDate.getYear();for(s<1900&&(s+=1900),t=365*(s-1921)+Math.floor((s-1921)/4)+n.madd[n.TheDate.getMonth()]+n.TheDate.getDate()-38,n.TheDate.getYear()%4==0&&n.TheDate.getMonth()>1&&t++,a=0;;a++){for(o=n.CalendarData[a]<4095?11:12,e=o;e>=0;e--){if(t<=29+n._getBit(n.CalendarData[a],e)){r=!0;break}t=t-29-n._getBit(n.CalendarData[a],e)}if(r)break}n.cYear=1921+a,n.cMonth=o-e+1,n.cDay=t,12==o&&(n.cMonth==Math.floor(n.CalendarData[a]/65536)+1&&(n.cMonth=1-n.cMonth),n.cMonth>Math.floor(n.CalendarData[a]/65536)+1&&n.cMonth--)},_getcDateString:function(){var n=this,t="";return n.cMonth<1,t+=n.cDay<11?"初":n.cDay<20?"十":n.cDay<30?"廿":"三十",n.cDay%10==0&&10!=n.cDay||(t+=n.numString.charAt((n.cDay-1)%10)),t},_getLunarDay:function(n,t,a){var e=this;return n<1921||n>2080?"":(t=parseInt(t)>0?t-1:11,e._e2c(n,t,a),e._getcDateString())}},window.Calendar=n}();