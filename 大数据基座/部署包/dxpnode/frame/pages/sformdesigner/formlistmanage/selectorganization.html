<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>选择部门人员</title>
<script src="../../../../frame/fui/js/cssboot.js"></script>
</head>
<body>
	<div class="page-loading"></div>
	<div class="fui-toolbar" id="toolbar">
		<div class="btn-group mr10">
			<a class="mini-button" id="addNew" onclick="saveAndClose">确定选择</a> <a
				class="mini-button" onclick="epoint.closeDialog" id="checkClose">取消选择</a>
		</div>
	</div>
	<!-- 内容区域 -->
	<div class="fui-content">
		<ul id="tree" class="mini-tree" style="height: 100%" textField="text"
			idField="id" parentField="pid" action="getModel" resultAsTree="false"
			showRadioButton="true" onbeforenodeselect="beforenodeselect">
		</ul>
		<ul id="tree1" class="mini-tree" style="height: 100%; display: none"
			textField="text" idField="id" parentField="pid" action="getModel"
			resultAsTree="false" showCheckBox="true">
		</ul>
	</div>
	<script src="../../../../rest/resource/jsboot"></script>
	<script>
		var multselect = "";
		var mode = "";
		//初始化请求
		epoint.initPage('selectorganizationaction', '', function(data) {
			if (data) {
				if ("true" == data.multselect) {
					document.getElementById("tree1").style.display = "block";
					document.getElementById("tree").style.display = "none";
					multselect = data.multselect;
				} else {
					document.getElementById("toolbar").style.display = "none";
				}
				if (data.mode) {
					mode = data.mode;
				}

			}
		});

		//树js对象
		var tree = mini.get("tree");
		var tree1 = mini.get("tree1");

		// 点击左侧树刷新右侧表格
		tree.on("nodeselect", function(e) {
			if (e.node) {
				if (e.node.noClick == true) {
					e.cancel = true;
				} else {
					var id = e.node.id;
					epoint.closeDialog(mini.htmlUnescape(e.node.text) + ";"
							+ e.node.id);
				}
			}
		});

		function saveAndClose() {
			epoint.execute('oulist', 'tree1', saveCallback);
		}

		//回调
		function saveCallback(data) {
			if (data.nameandguidlist) {
				epoint.closeDialog(data.nameandguidlist);
			} else {
				epoint.alert('您还没有选择任何记录！', '', null, 'warning');
			}
		}

		function beforenodeselect(e) {
			if ("people" == mode) {
				if (e.isLeaf == false || e.record.ckr == false
						|| e.record.path == 'parent'
						|| e.record.noClick == true) {
					e.cancel = true;
				}
			} else {

			}

		}
	</script>


</body>
</html>