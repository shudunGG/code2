<!DOCTYPE html>
<html>

	<head>
		<title>流程代理人设置</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<script src="../../../../frame/fui/js/cssboot.js"></script>
	</head>
	<body>
		<!-- 等待提示框 -->
		<div class="page-loading"></div>

		<!-- 按钮区域 -->
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button" onclick="openAdd" iconCls="icon-save">新增设置</a><a
				class="mini-button mini-btn-danger" onclick="deleteCommission" iconCls="icon-minuscircle">删除选中</a><a
				class="mini-button" onclick="epoint.closeDialog" iconCls="icon-removecircle">关闭</a>
			</div>
		</div>

		<!-- 内容区域 -->
		<div class="fui-content">
			<div id="datagrid" name="datagrid" class="mini-datagrid"
			idField="messageitemguid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			showPager="true" action="getDataGridData" allowCellEdit="true"
			allowCellSelect="true" editNextOnEnterKey="true"
			editNextRowCell="true">
				<div property="columns">
					<div type="checkcolumn" width="30"></div>
					<div type="indexcolumn" width="32" headerAlign="center">
						序
					</div>
					<div field="topic" headerAlign="center" width="100%" validateLevel="1">
						标题
					</div>
					<div field="beiZhu" headerAlign="center" width="70" align="center">
						步骤名称
					</div>
					<div field="targetDispName" headerAlign="center" width="150" align="center">
						办理人
					</div>
					<div field="fromDispName" headerAlign="center" width="150" align="center">
						提交人
					</div>
					<div field="generateDate" headerAlign="center" align="center" width="150"
					data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}" dateFormat="yyyy-MM-dd HH:mm:ss">
						发送时间
					</div>
				</div>
			</div>
		</div>

		<script src="../../../../rest/resource/jsboot"></script>

		<script>
			//<![CDATA[
			//初始化页面
			epoint.initPage("commissionhandlelistaction", "", initCallback);

			var leadGuid;
			var ouGuid;
			var commissionGuid = Util.getUrlParams().commissionGuid;

			function initCallback(data) {
				if (data) {
					leadGuid = data.leadGuid;
					ouGuid = data.ouGuid;
				}
			}

			//新增回调事件
			function addCallBack(data) {
				epoint.refresh(['datagrid'], '', true);
			}

			//新增设置
			function openAdd() {
				epoint.openDialog("消息列表", 'frame/pages/basic/communication/waithandle/waithandlelist?commissionGuid=' + commissionGuid + '&leadGuid=' + leadGuid + '&ouGuid=' + ouGuid, addCallBack);
			}

			//删除选中
			function deleteCommission() {
				var datagrid = mini.get('datagrid');
				var ids = datagrid.getSelectedIds();
				if (ids.length > 0) {
					epoint.confirm("确定删除选中记录？", "", function(action) {
						epoint.execute("deleteSelect", "", [ids.join(',')], function(data) {
							if (data.msg) {
								epoint.alert(data.msg,null,null,'info');
								epoint.refresh(["datagrid"], '', true);
							}
						});
					});
				} else {
					epoint.alert("请选择要删除的记录!",null,null,'warning');
				}
			}

			//]]>
		</script>
	</body>
</html>