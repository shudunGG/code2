<!DOCTYPE html>
<html>

<head>
<title>待办工作</title>
<meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" />

<script src="../../../fui/js/cssboot.js"></script>
</head>

	<body>
		<div class="page-loading"></div>

	<div class="fui-left">
	    <div role="head" title="过程列表">
	    </div>
	    <div role="body">
	    	<ul id="tree" class="mini-tree" style="height: 100%" textField="text"
				idField="id" parentField="pid"
				action="getTreeModal" resultAsTree="false"></ul>
	    </div>
	</div>
	
	<div class="fui-right">
		<div class="fui-toolbar">
			<div class="btn-group mr10">
				<a class="mini-button mini-btn-danger" iconCls="icon-removecircle"
				onclick="if(mini.get('datagrid').getSelecteds().length==0){epoint.alert('请选择想要删除的记录！', null, null, 'warning');} else {epoint.confirm('是否确定删除？','',deleteSelected);}">删除选中</a>
			</div>
		</div>
	
	
		<div class="fui-condition">
				<!-- 表单布局 -->
				<div class="fui-form" id="fui-form">
					<div role="form">
						<!-- 2列 -->
						<div role="row">
							<div role="control" label="待办工作名称" starred="false">
								<input bind="workitemlistaction.workItemName"
								class="mini-textbox" />
							</div>
						</div>
						<!-- 添加隐藏域，用于树与表格的联动 -->
						<input bind="leftTreeNodeGuid" id="leftTreeNodeGuid"
						class="mini-hidden" />
					</div>
				</div>

				<!-- 搜索按钮 -->
				<a role="searcher" callback="searchData"></a>
		</div>
				
		<div class="fui-content">
			<div id="datagrid" class="mini-datagrid" sortOrder="desc"
			idField="workItemGuid" multiSelect="true"
			style="width: 100%; height: 100%;" allowResize="true"
			allowCellValid="true" action="getDefaultModel"
			showPager="true"
			editNextOnEnterKey="true" editNextRowCell="true">
				<div property="columns">
					<div type="checkcolumn" width="50"></div>
					<div type="indexcolumn" headerAlign="center" width="50">
						序号
					</div>
					<div field="itemStatus" width="50" headerAlign="center" align="center">
						状态
						<input property="editor" class="mini-textbox" minWidth="200" />
					</div>
					<div field="workItemName" width="100%" headerAlign="center"  renderer="onLocationUrl">
						待办工作
					</div>
					<div field="processVersionName" width="100" headerAlign="center" align="center">
						所属工作类别
					</div>
					<div field="createDate" width="150" headerAlign="center" align="center" dateFormat="yyyy-MM-dd HH:mm:ss" data-options="{'format' : 'yyyy-MM-dd HH:mm:ss'}"  allowSort="true">
						流转时间
					</div>
					<div field="lastDate" width="150" headerAlign="center" align="center">
						最迟完成时间
					</div>
					<div field="restDate" width="150" headerAlign="center" align="center">
						剩余时间
					</div>
				</div>
			</div>
		</div>	
	</div>
	
	<script src="../../../../rest/resource/jsboot"></script>

		<!-- 配置变量 -->
		<script>
			//初始化页面
			epoint.initPage("workitemlistaction");

			//树js对象
			var tree = mini.get("tree");
			// 点击左侧树刷新右侧表格
			tree.on("nodeselect", function(e) {
				var id = e.node.objectcode;
				// 将左侧树点击的节点id放到隐藏域中
				// 在表格发二次请求时，会自动带上条件区域中的内容
				mini.get('leftTreeNodeGuid').setValue(id);
				//刷新表格
				searchData();
			});

			// 删除
			function deleteSelected() {
				epoint.execute('delete', 'datagrid', msgCallBack);
			}
			
			// 回调提醒
			function msgCallBack(data) {
				var msg =data.msg;
				if (msg) {
					epoint.alert(msg, '', searchData(), 'info');
				}
			}
			
			function onLocationUrl(e){
				return ' <a class="" href="javascript:openUrl(\'' + e.row['handleurl'] + '\')">'+e.value+'</a>';
			}
			
			function openUrl(handleUrl){
				epoint.openTopDialog('待办流程处理', handleUrl, function(){
					epoint.refresh(['datagrid', 'fui-form'],'',true);
				});
			}
			
			// 表格的搜索
			function searchData() {
				epoint.refresh(['datagrid', 'fui-form']);
			}
		</script>

	</body>

</html>
