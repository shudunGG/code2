// 全局变量处理
(function(a,b){a._datacenterEvent_=new Util.UserEvent;var g=b("#cover-wrap");a.createMainContentCover=Util.browsers.isIE&&window.hasObjectTag?function(){var c=document.createElement("iframe");c.width="100%";c.height="100%";c.scrolling="no";c.frameBorder=0;c.style.background="transparent";c.src="../../activexcover/activexcover.html";return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').append(c).appendTo(g)}:function(){return b('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').appendTo(g)};a._getData_=function(c,b){return Util.ajax({url:epoint.dealRestfulUrl(getDataUrl+"/"+c),data:b})};a.dealLinkOpen=function(b){switch(b.openType){case "tabsnav":TabsNav.addTab(b);break;case "dialog":epoint.openTopDialog(b.name,Util.getRightUrl(b.url));break;case "blank":a.open(Util.getRightUrl(b.url),(b.id+"").replace(/-/g,"_"))}};a._ANIMATION_TIME_={slide:300};a.getTplHtml=function(c,a){var d=b("#"+c).html();Mustache.parse(d);return Mustache.render(d,a)}})(this,jQuery);(function(a,b){var g=b("#main");b(".main-content",g);"[object Function]"===Object.prototype.toString.call(a.EpTabsNav)?(window.TabsNav=new EpTabsNav({ifrContainer:"#main-ifr-wrap",tabContainer:"#main-tab-wrap",needScrollBtn:!1,scrollBtnSite:"sides",smoothItems:3,refreshOnActiveTab:Util.getFrameSysParam("refreshOnActiveTab")||!1,needQuickNav:!0,position:"bottom",tabWidth:115}),TabsNav._$pageCover=createMainContentCover()):console.error('The TabsNav is required! , please add the "frame/fui/js/widgets/tabsnav/tabsnav.js" before theme\'s javascript file')})(this,jQuery);(function(a,b){var g=b("#sys-logo-img"),c=b("#user-info"),h=b("#home-btn");_getData_("getUserInfo").done(function(b){a._userName_=b.name;a._userGuid_=b.guid;c.find(".user-info-name").text(b.name)});_getData_("getPageInfo").done(function(b){d(b)});var d=function(c){c.logo&&g.attr("src",/^data:/i.test(c.logo)?c.logo:Util.getRightUrl(c.logo));c.title&&(document.title=c.title,a.systemTitle=c.title);var f={closeIcon:!1,refresh:!0};b.each(c.homes,function(a,d){var e=!1;d.items&&b.each(d.items,function(b,a){if(c.defaultHome){if(a.code==c.defaultHome)return f.id=a.code||"home",f.url=a.url,f.name=a.name,e=!0,!1}else if("tabsnav"==a.openType)return f.id=a.code||"home",f.url=a.url,f.name=a.name,e=!0,!1});if(e)return!1});a.goHome=function(){f.id&&TabsNav.addTab(f)};f.id&&TabsNav.addTab(f);_datacenterEvent_.fire("afterPageInfo")},k=createMainContentCover();c.on("click",".user-info-summary",function(){c.hasClass("active")?(c.removeClass("active"),k.addClass("hidden")):(c.addClass("active"),k.removeClass("hidden"))}).on("click",".user-action-item",function(){var a=b(this);a.hasClass("logout")?mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(b){"ok"==b&&(window.location.href=Util.getRightUrl("rest/logout?isCommondto\x3dtrue"))}):a.hasClass("change-pwd");c.removeClass("active");k.addClass("hidden")});b("body").on("click",function(a){b(a.target).closest("#user-info").length||(c.removeClass("active"),k.addClass("hidden"))});h.on("click",function(){goHome()})})(this,jQuery);(function(a,b){var g=b("#left-nav"),c=b("#left-menu-list"),h=b("#left-menu-innerlist"),d=b("#sub-menu-list"),k=createMainContentCover(),m=[];(function(){Util.ajax({url:getDataUrl+"/getMenu",data:{query:"all"}}).done(function(f){f.forEach(function(b,f){b.index=f});m=f;4<f.length&&g.find(".left-menu-top,.left-menu-bottom").removeClass("hidden");h.html(getTplHtml("left-menu-itemtpl",{list:f}));for(var c=0,a=f.length;c<a;c++){var e=f[c];console.log(e.url,e.openType);if(e.url&&"tabsnav"==e.openType){TabsNav.addTab({id:e.code,name:e.name,openType:e.openType,url:e.url});console.log("111",b("#left-menu-"+id));b("#left-menu-"+e.code).addClass("active");break}else if(e.items&&e.items.length)for(var d=0,k=e.items.length;d<k;d++){var l=e.items[d];if(l.url&&"tabsnav"==e.openType){TabsNav.addTab({id:l.code,name:l.name,openType:l.openType,url:l.url});b("#left-menu-"+l.code).addClass("active");return}}}})})();g.on("click",".left-menu-bottom",function(){var b=c.outerHeight(),a=h.outerHeight(),a=b-a,d=Number(h.css("margin-top").split("px")[0]);d-b<a?h.css({"margin-top":a+"px"}):h.css({"margin-top":d-b+"px"})}).on("click",".left-menu-top",function(){var b=c.outerHeight(),a=Number(h.css("margin-top").split("px")[0]);0<a+b?h.css({"margin-top":"0px"}):h.css({"margin-top":a+b+"px"})}).on("click",".left-menu-item",function(){k.addClass("hidden");var a=b(this),c=a.data("id"),h=a.data("url"),e=a.data("name"),g=a.data("index"),p=a.data("opentype"),l=a.offset().top,n=document.body.clientHeight;a.addClass("active").siblings().removeClass("active");d.removeAttr("style").addClass("hidden");m[g].items&&m[g].items.length&&(d.html(getTplHtml("sub-menu-itemtpl",{list:m[g].items})),d.css({top:l+10+"px"}).removeClass("hidden"),k.removeClass("hidden"),d.outerHeight()>n-l-50&&d.css({height:n-l-50+"px"}));h&&dealLinkOpen({id:c,name:e,url:h,openType:p})}).on("click",".sub-menu-item",function(){var a=b(this),c=a.data("id"),g=a.data("url"),e=a.data("name"),a=a.data("opentype");dealLinkOpen({id:c,name:e,url:g,openType:a});d.addClass("hidden");k.addClass("hidden")});b("body").on("click",function(a){b(a.target).closest(".left-menu-item,#sub-menu-list").length||(d.addClass("hidden"),k.addClass("hidden"))})})(this,jQuery);