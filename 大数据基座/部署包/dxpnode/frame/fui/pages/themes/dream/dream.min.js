// jshint -W030
// 主菜单的顶级菜单模板
var NAV_TPL='{{^isOverall}}\x3cli class\x3d"fui-nav-item top"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link"data-url\x3d"{{url}}"data-rowkey\x3d"{{rowkey}}" data-code\x3d"{{code}}" title\x3d"{{name}}"data-opentype\x3d"{{openType}}"\x3e\x3ci class\x3d"fui-nav-icon {{icon}}"\x3e\x3c/i\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{name}}\x3c/span\x3e\x3c/a\x3e{{/isOverall}}{{#hasSub}}\x3cdiv class\x3d"fui-nav second"\x3e\x3ch4 class\x3d"fui-nav-title" title\x3d"{{name}}" data-rowkey\x3d"{{rowkey}}"\x3e{{name}}\x3c/h4\x3e{{^isOverall}}\x3cdiv class\x3d"ajax-loading" \x3e\x3c/div\x3e{{/isOverall}}\x3cul class\x3d"fui-nav-items"\x3e{{{subItem}}}\x3c/ul\x3e\x3c/div\x3e{{/hasSub}}{{^isOverall}}\x3c/li\x3e{{/isOverall}}',SUBNAV_TPL='\x3cli class\x3d"fui-nav-item"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link"{{#indent}}style\x3d"padding-left: {{indent}}px"{{/indent}} data-url\x3d"{{url}}" data-code\x3d"{{code}}" data-rowkey\x3d"{{rowkey}}" title\x3d"{{name}}"data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"fui-nav-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}\x3cul class\x3d"fui-nav sub"\x3e{{{subItem}}}\x3c/ul\x3e{{/hasSub}}\x3c/li\x3e',QUICKNAV_TPL='\x3cli class\x3d"fui-nav-item top"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link quick-link-js" title\x3d"{{name}}"\x3e\x3ci class\x3d"fui-nav-icon modicon-1"\x3e\x3c/i\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{name}}\x3c/span\x3e\x3c/a\x3e\x3cdiv class\x3d"fui-nav second"\x3e\x3ch4 class\x3d"fui-nav-title"\x3e\x3cspan class\x3d"fui-quicknav-text"\x3e{{name}}\x3c/span\x3e\x3ci data-url\x3d"{{editUrl}}" title\x3d"\u7f16\u8f91\u81ea\u5b9a\u4e49\u83dc\u5355" class\x3d"fui-nav-edit modicon-64"\x3e\x3c/i\x3e\x3c/h4\x3e\x3cul class\x3d"fui-nav-items"\x3e{{#quickNav}}\x3cli class\x3d"fui-nav-item"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link" style\x3d"padding-left: 20px" data-url\x3d"{{url}}" data-code\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{name}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e{{/quickNav}}\x3c/ul\x3e\x3c/div\x3e\x3c/li\x3e',RESULTNAV_TPL='\x3cli class\x3d"fui-nav-item"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"fui-nav-link"style\x3d"padding-left: 20px"data-url\x3d"{{url}}"data-code\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"fui-nav-text"\x3e{{{resultName}}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e',TAB_ITEM_TPL='\x3cli id\x3d"tab-{{id}}" class\x3d"fui-main-tab" ref\x3d"tab-content-{{id}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"fui-tab-text"\x3e{{name}}\x3c/span\x3e{{#closeIcon}}\x3ci class\x3d"fui-tab-close" title\x3d"\u5173\u95ed"\x3e\x3c/i\x3e{{/closeIcon}}{{^closeIcon}}\x3ci class\x3d"fui-tab-refresh" title\x3d"\u5237\u65b0"\x3e\x3c/i\x3e{{/closeIcon}}\x3c/li\x3e',TAB_CONTENT_TPL='\x3cdiv class\x3d"fui-tab-content" id\x3d"tab-content-{{id}}"\x3e\x3ciframe src\x3d"{{url}}" allowTransparency\x3d"true" height\x3d"100%" width\x3d"100%" frameborder\x3d"0" scrolling\x3d"no"\x3e\x3c/iframe\x3e\x3c/div\x3e',TAB_CURRENT_TPL='\x3cli class\x3d"fui-current-item {{#isActive}}active{{/isActive}}" data-tabId\x3d"tab-{{id}}" title\x3d"{{name}}"\x3e\x3cspan class\x3d"fui-current-text"\x3e{{name}}\x3c/span\x3e\x3c/li\x3e',MSG_TPL='{{^hasHead}}\x3cdiv class\x3d"msg-category" data-code\x3d"{{code}}"\x3e\x3ch3 class\x3d"msg-category-head"data-url\x3d"{{url}}"data-title\x3d"{{name}}"\x3e\x3cspan class\x3d"msg-category-title" title\x3d"{{name}}"\x3e{{{name}}} (\x3cspan class\x3d"msg-category-num"\x3e{{num}}\x3c/span\x3e)\x3c/span\x3e\x3ci class\x3d"msg-category-remove" title\x3d"\u5ffd\u7565\u5168\u90e8"\x3e\x3c/i\x3e\x3c/h3\x3e\x3cul class\x3d"msg-list"\x3e{{/hasHead}}{{#items}}\x3cli class\x3d"msg-list-item {{#hasNew}}newmsg{{/hasNew}}" data-url\x3d"{{url}}" data-guid\x3d"{{guid}}" data-title\x3d"{{title}}" data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"msg-item-text" title\x3d"{{title}}"\x3e{{{name}}}\x3c/span\x3e\x3cspan class\x3d"msg-item-date"\x3e{{date}}\x3c/span\x3e\x3ci class\x3d"msg-item-ignore" title\x3d"\u5ffd\u7565"\x3e\x3c/i\x3e\x3c/li\x3e{{/items}}{{^hasHead}}\x3c/ul\x3e\x3c/div\x3e{{/hasHead}}',EMSG_RECENT_TPL='{{#items}}\x3cli class\x3d"emsg-recent-item {{^hasRead}}newmsg{{/hasRead}}" data-sessionid\x3d"{{sessionId}}" data-uid\x3d"{{uid}}" data-type\x3d"{{type}}"\x3e\x3cdiv class\x3d"emsg-user-img"\x3e\x3cimg src\x3d"{{imgUrl}}" onerror\x3d"this.onerror\x3d\'\';this.src\x3d\'../../emsg/images/emsg-user-error.jpg\';" /\x3e\x3c/div\x3e\x3cdiv class\x3d"emsg-recent-record"\x3e\x3ch2\x3e\x3cspan class\x3d"emsg-user-name" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e{{^hasRead}}\x3ci class\x3d"emsg-not-read"\x3e\x3c/i\x3e{{/hasRead}}\x3cspan class\x3d"emsg-recent-date"\x3e{{date}}\x3c/span\x3e\x3c/h2\x3e\x3cp class\x3d"emsg-recent-message"\x3e{{message}}\x3c/p\x3e{{^hasRead}} \x3cspan class\x3d"emsg-ignore-icon"\x3e\u5ffd\u7565\x3c/span\x3e{{/hasRead}}\x3c/div\x3e\x3c/li\x3e{{/items}}',SOUND_URL="../../msgsound/sound.html";(function(k,a){var g=a("#headerUser"),e=a("#userDropdown"),l=a(".fui-user-hello",g),n=a(".fui-user-org",g),r=a(".fui-userinfo-name",e),m=a(".fui-userinfo-org",e),p=a("#headerSearch");a("input",p);a(".fui-search-icon",p);a("#headerHelp");var t=a("#bg-img"),u=a("#logo-img"),x="",z=a("#page-cover"),v=function(){e.addClass("hidden")},A=function(){e.hasClass("hidden")?(e.removeClass("hidden"),z.removeClass("hidden")):v()},B=function(){mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(a){"ok"==a?UserConfig.onLogout&&(eMsgSocket&&eMsgSocket.close(),UserConfig.onLogout()):v()})},D=function(){var a="./skins/"+(mini.Cookie.get("_dream_skin_")||"default")+"/images/bg.png",f=new Image;f.src=a;f.onload=function(){t[0].src=a}},K=function(){Util.ajax({type:"POST",dataType:"json",url:UserConfig.getUrl,success:function(g){x=g.guid;l.html(g.name+"\uff0c\u60a8\u597d\uff01");n.html(g.ouName);k._userName_=g.name;k._userGuid_=x;var f=g.title,p=g.homes,y=g.logo;f&&(document.title=f);y&&u.attr("src",Util.getRightUrl(epoint.dealRestfulUrl(y)));k.FixedTabs&&0!==FixedTabs.length||(FixedTabs=[],a.each(p,function(a,f){FixedTabs.push({id:"home-"+a,name:f.name,url:f.url})}));initFixedTab();setTimeout(function(){r.html(g.name);m.html(g.ouName);g.hasParttime&&a("#user-btns",e).addClass("switch")},800)}})},w=function(){g.on("click",A);a("body").on("click",function(e){a.contains(g[0],e.target)||v()});e.on("click",".fui-user-linkitem",function(){var e=a(this),f=e.data("url"),g=e.text(),e="userlink-"+e.index();TabsNav.addTab({id:e,name:g,url:f});v()}).on("click",".fui-user-logout",function(){B()}).on("click",".fui-user-switch",function(){if(UserConfig.onSwitch)UserConfig.onSwitch(x)})};a(function(){D();K();w()})})(this,jQuery);(function(k,a){var g=a("#fuiBody"),e=a("#sidebar",g),l=a("#leftNav",e),n=a(".fui-sidebar-toggle",e),r=a("#page-cover"),m=a("#navOverall",e),p=a(".fui-overall-content",m),t=a(".fui-overall-navs",p),g=a(".fui-overall-footer",p),u=a(".fui-overall-scroller",g),x=a(".fui-scroller-left",u),z=a(".fui-scroller-right",u),v=a("#navResult",m),A=a("#navSearch",g).children("input"),B=a("#fuiHeader").outerHeight(),D=m.outerHeight(),K=n.outerHeight(),w=m.find(".fui-overall-content").width(),H=0,f=0,I=function(){var d=a(k).height()-B-K-D;l.css("height",d)},y=Mustache,Q=a.trim(NAV_TPL),R=a.trim(SUBNAV_TPL),J=a.trim(QUICKNAV_TPL),E=a.trim(RESULTNAV_TPL),q={},L=!1,C={_cache:{},searchNodes:[],cacheNodeData:function(a){var d,b=a.rowkey;this._cache[b]={};for(d in a)"items"!==d&&(this._cache[b][d]=a[d])},getNodeData:function(a){return(a=this._cache[a])?a:null},cacheSearchNode:function(a){a.url&&this.searchNodes.push({name:a.name,url:a.url,code:a.code})}},O=function(d,e){var b=[];a.each(d,function(c,h){var d={name:h.name,icon:h.icon||"modicon-1",url:h.url,code:h.code,openType:h.openType,hasSub:h.hasSub};d.rowkey=void 0===e?c+"":e+"-"+c;C.cacheNodeData(a.extend({},h,d));d.hasSub||(q[d.code]=!0);b.push(y.render(Q,d))});return b.join("")},P=function(d,e){var b=[];a.each(d,function(c,h){var d={name:h.name,icon:h.icon,url:h.url,code:h.code,openType:h.openType,hasSub:h.items&&h.items.length};d.rowkey=void 0===e?c+"":e+"-"+c;C.cacheNodeData(a.extend({},h,d));var f=a.extend({},h,d);f.isOverall=!0;f.hasSub=!0;d.hasSub?(d=M(h.items,d.rowkey,!0),b.push(y.render(Q,a.extend(f,{subItem:d})))):(b.push(y.render(Q,f)),C.cacheSearchNode(d))});return b.join("")},M=function(d,e,b){var c=[];a.each(d,function(h,d){var f={name:d.name,url:d.url,code:d.code,openType:d.openType,hasSub:d.items&&d.items.length};f.rowkey=void 0===e?h+"":e+"-"+h;var g=f.rowkey.split("-").length;f.indent=1!==g?20+15*(g-2):!1;C.cacheNodeData(a.extend({},d,f));f.hasSub?c.push(y.render(R,a.extend(f,{subItem:M(d.items,f.rowkey,b)}))):(c.push(y.render(R,f)),b&&C.cacheSearchNode(f))});return c.join("")},T=function(d){d&&d.length&&(d=y.render(J,{name:QuickNav.name,icon:QuickNav.icon,editUrl:QuickNav.editUrl,quickNav:d}),a(Util.clearHtml(d)).appendTo(l))},U=function(d){d&&d.items.length&&(html=O(d.items),a(Util.clearHtml(html)).appendTo(l))},W=function(d){var f=[];a.each(C.searchNodes,function(a,c){if(c.url){var b=c.name.indexOf(d);if(0<=b){var e={url:c.url,code:c.code,name:c.name,openType:c.openType},g=[];g.push(c.name.substr(0,b));g.push('\x3cspan class\x3d"keynote"\x3e'+c.name.substr(b,d.length)+"\x3c/span\x3e");g.push(c.name.substring(b+d.length));e.resultName=g.join("");f.push(y.render(E,e))}}});return f.join("")},N=function(a,e){if(e){if(a==f)return;a-=w;a<f&&(a=f)}else{if(0===a)return;a+=w;0<a&&(a=0)}0===a?(x.addClass("disabled"),z.removeClass("disabled")):a>f?(x.removeClass("disabled"),z.removeClass("disabled")):(x.removeClass("disabled"),z.addClass("disabled"));t.stop(!0).animate({left:a},800)},F=function(){l.on("mousewheel",function(d){a(d.target).closest(".fui-nav.second").length||(d.preventDefault(),this.scrollTop+=d.deltaY*d.deltaFactor*-1)})},S=function(){e.on("click",".fui-nav-link",function(b){b.preventDefault();var c=a(this),h=c.data("url"),d=c.data("code"),f=c.attr("title"),e=c.data("rowkey"),g=c.data("opentype");b=c.parent();var n=!!b.find("\x3e .fui-nav").length,y=SidebarNav.onNodeClick;if(!e||!y||!1!==y.call(this,C.getNodeData(e))){if(!n&&(c.closest(".fui-nav-item.top,.fui-overall").removeClass("opened"),r.addClass("hidden"),h))return"blank"==g?k.open(Util.getRightUrl(h)):TabsNav.addTab({id:d,name:f,url:h}),b=c.closest(".fui-nav-item.top"),b.length?b.removeClass("opened"):m.removeClass("opened"),!1;b.hasClass("top")?(b.hasClass("opened")?r.addClass("hidden"):r.removeClass("hidden"),b.hasClass("fui-overall")?(p.removeClass("small"),A.val(""),b.toggleClass("opened"),l.children(".opened").removeClass("opened")):(b.toggleClass("opened").siblings(".opened").removeClass("opened"),m.removeClass("opened"),c=b.children("a.fui-nav-link"),c.hasClass("quick-link-js")||(c=c.data("code"),b.hasClass("fui-nav-item top")&&!q[c]&&X(c,b)))):n&&(b.hasClass("opened")?b.removeClass("opened"):b.siblings(".opened").removeClass("opened").end().addClass("opened"))}}).on("click",".fui-nav-edit",function(){var b=a(this),c=b.data("url"),h=b.parent().text();TabsNav.addTab({id:"editNav",name:h,url:c});b.closest(".fui-nav-item.top").removeClass("opened")}).on("click",".fui-overall-link",function(b){b=a(this).parent();L||G();p.removeClass("small");A.val("");b.hasClass("opened")?r.addClass("hidden"):r.removeClass("hidden");b.toggleClass("opened");l.children(".opened").removeClass("opened")});a("body").on("click",function(b){a.contains(l[0],b.target)||a.contains(m[0],b.target)||e.find(".fui-nav-item.top, .fui-overall").removeClass("opened")});var d=null;A.on("keyup",function(b){var c=a.trim(this.value);c.length?(d&&clearTimeout(d),d=setTimeout(function(){var a=W(c);v.find(".fui-nav-items").html(Util.clearHtml(a))},500),p.addClass("small")):p.removeClass("small")});u.on("click",".fui-scroller-left",function(){if(a(this).hasClass("disabled"))return!1;var b=parseInt(t.css("left"));N(b)}).on("click",".fui-scroller-right",function(){if(a(this).hasClass("disabled"))return!1;var b=parseInt(t.css("left"));N(b,!0)});n.on("click",function(){e.hasClass("big")?(e.removeClass("big"),a("#tabs-nav").css("marginLeft","46px"),a.cookie("isBigSidebar","0")):(e.addClass("big"),a("#tabs-nav").css("marginLeft","146px"),a.cookie("isBigSidebar","1"))});a.fn.mousewheel?F():Util.loadJs("frame/fui/js/lib/jquery.mousewheel.min.js",F);var f=0;a(k).on("resize",function(){f&&clearTimeout(f);f=setTimeout(I,50)})},V=function(){Util.ajax({url:SidebarNav.loadUrl,data:{query:"top"}}).done(U,S,I).fail(S,I)},X=function(d,f){q[d]="pedding";Util.ajax({url:SidebarNav.loadUrl,data:{query:"sub",code:d}}).done(function(b){var c=f.find(".fui-nav-items"),h=c.siblings(".ajax-loading");b&&b.length&&(html=M(b),a(Util.clearHtml(html)).appendTo(c),h.addClass("hidden"));q[d]=!0}).fail(function(){q[d]=!1})},G=function(){Util.ajax({url:SidebarNav.loadUrl,data:{query:"all"}}).done(function(d){d&&d.length&&(html=P(d),a(Util.clearHtml(html)).appendTo(t),H=t.children().eq(0).outerWidth()*d.length,f=w-H,t.css("width",H),0<=f&&z.addClass("disabled"),p.find(".ajax-loading").addClass("hidden"),L=!0)},I).fail(I)};"0"==a.cookie("isBigSidebar")&&(e.removeClass("big"),a("#tabs-nav").css("marginLeft","46px"));setTimeout(function(){Util.ajax({url:QuickNav.loadUrl}).done(T,V).fail(V)},1)})(this,jQuery);(function(k,a){var g=a("#tabs-nav"),e=a(".fui-main-head",g),l=a(".fui-main-tabcontainer",e),n=a(".fui-main-tabs",e),r=n.filter("#fixedTabs"),m=n.filter("#mainTabs"),p=a(".fui-taboperation-scroller",e),t=a(".fui-tabscroller-left",e),u=a(".fui-tabscroller-right",e),x=a(".fui-taboperation-close",e),z=a(".fui-taboperation-more",e),v=a(".fui-taboperation-dropdown",e);a(".fui-taboperation-history",v);var A=a(".fui-taboperation-current",v),B=A.filter("#currentFixed"),D=A.filter("#currentCommon"),K=a("#mainframe",g),w=Mustache,H=a.trim(TAB_ITEM_TPL),f=a.trim(TAB_CONTENT_TPL),I=a.trim(TAB_CURRENT_TPL),y=a(".fui-main-taboperation",e).outerWidth(!0),Q=a(".fui-main-msg",e).outerWidth(!0),R=0,J=0,E=0,q={},L=[],C="",O=!1,P=null,M={_cache:[],_reSort:function(a){for(var b=this._cache[a],h=0;h<=a;h++){var d=this._cache[h];this._cache[h]=b;b=d}},_inHistory:function(a){for(var b=0,h=this._cache.length;b<h;b++)if(this._cache[b].id==a.id)return b;return-1},addHistory:function(a){var b=this._inHistory(a);-1<b?0<b&&this._reSort(b):(3<=this._cache.length&&this._cache.pop(),this._cache.unshift(a))},removeHistory:function(a){for(var b=0,h=this._cache.length;b<h;b++)if(this._cache[b].id==a.id){this._cache.splice(b,1);break}}},T=function(b){b?(B.empty(),a.each(L,function(b,h){var c={id:q[h].id,name:q[h].name,isFixed:!0};h==P&&(c.isActive=!0);a(Util.clearHtml(w.render(I,c))).appendTo(B)})):(D.empty(),a.each(q,function(b,h){if(h&&h.closeIcon){var c={id:h.id,name:h.name};"tab-"+h.id==P&&(c.isActive=!0,B.find(".active").removeClass("active"));a(Util.clearHtml(w.render(I,c))).appendTo(D)}}));O=!1},U=function(){m.children().length?x.removeClass("disabled"):x.addClass("disabled")},W={closeIcon:!0};k.TabsNav={_tab_w:null,_getTabWidth:function(){this._tab_w||(this._tab_w=m.children().eq(0).outerWidth(!0));return this._tab_w},addTab:function(b,c){var h=a.extend({},W,b),d="tab-"+h.id;q[d]||(c?(h.realUrl=Util.getRightUrl(h.url),h.url="about:blank"):h.url=Util.getRightUrl(h.url),h.closeIcon?a(Util.clearHtml(w.render(H,h))).appendTo(m):a(Util.clearHtml(w.render(H,h))).appendTo(r),a(Util.clearHtml(w.render(f,h))).appendTo(K),q[d]=h,c&&(q[d].notInit=!0),this.adjustSize(),O=!0,U());c||this.activeTab(d)},getActiveTab:function(){var a=n.find("li.active");return new N(q[a[0].id])},getTabByIndex:function(a){},activeTab:function(b){var c=a("#"+b);if(c.length){var d=a("#"+c[0].getAttribute("ref")),f=q[b];c.hasClass("active")||(n.find("li.active").removeClass("active"),c.addClass("active"),f.notInit&&(d.find("iframe")[0].src=f.realUrl,f.notInit=!1),d.addClass("active").siblings(".fui-tab-content").removeClass("active"),P=b,c=A.find('[data-tabid\x3d"'+P+'"]'),c.length&&!c.hasClass("active")&&(A.find(".active").removeClass("active"),c.addClass("active")),-1==a.inArray(b,L)&&this.adjustTabPosOnActive(b))}},adjustTabPosOnActive:function(b){if(!p.hasClass("invisible")){var c=a("#"+b).prevAll();b=this._getTabWidth();var d=Math.ceil(Math.abs(parseFloat(m.css("margin-left"),10))),f=d,c=b*c.length;c<d?f=c:c>=E+d?f=c+b-E:c>d&&c<E+d&&c+b>E+d&&(f=c+b-E);m.stop(!0).animate({marginLeft:-f},500);0===f?(t.addClass("disabled"),u.removeClass("disabled")):f==J?(t.removeClass("disabled"),u.addClass("disabled")):(t.removeClass("disabled"),u.removeClass("disabled"))}},removeTab:function(b){var c=a("#"+b),d=a("#"+c[0].getAttribute("ref"));c.hasClass("active")&&(c.prev().length?this.activeTab(c.prev()[0].id):c.next().length?this.activeTab(c.next()[0].id):this.activeTab(C));c.remove();Util.clearIframe(d.find("\x3eiframe"));d.remove();delete q[b];this.adjustSize();O=!0;U()},removeAll:function(a){m.find(".fui-main-tab").each(function(b,d){var c=d.id;c!=a&&TabsNav.removeTab(c)});a||TabsNav.activeTab(C)},adjustSize:function(){var a=e.width()-y-Q-R-1,c=this._getTabWidth()*m.children().length;0<c&&m.css("width",c);a>c?(p.addClass("invisible"),m.stop(!0).css("margin-left",0),l.css("width","auto")):(p.removeClass("invisible"),u.addClass("disabled"),t.removeClass("disabled"),J=c-a,E=a,m.stop(!0).css("margin-left",-J),l.css("width",E))},refreshTabContent:function(b){var c=a("#"+b),c=a("#"+c[0].getAttribute("ref"));a("iframe",c)[0].src="about:blank";a("iframe",c)[0].src=Util.getRightUrl(q[b].realUrl||q[b].url)}};var N=function(a){this._data=a};a.extend(N.prototype,{remove:function(){var b="tab-"+this._data.id;-1<a.inArray(b,L)?console.warn("\u8b66\u544a\uff1a\u56fa\u5b9aTab\u662f\u4e0d\u80fd\u5220\u9664\u7684\uff01"):TabsNav.removeTab(b)},getData:function(){var b=this._data;return a.extend({},b,{tabId:"tab-"+b.id})},refreshContent:function(){TabsNav.refreshTabContent("tab-"+this._data.id)},active:function(){TabsNav.activeTab("tab-"+this._data.id)},prev:function(){var b=a("#tab-"+this._data.id).prev();if(b.length)return new N(q[b[0].id]);console.warn("\u5df2\u7ecf\u5230\u5934\u4e86\uff01")},next:function(){var b=a("#tab-"+this._data.id).next();if(b.length)return new N(q[b[0].id]);console.warn("\u5df2\u7ecf\u5230\u5c3e\u4e86\uff01")}});var F=function(){z.hasClass("active")&&(z.removeClass("active"),v.addClass("hidden"))},S=!1,V=function(){mini.showMessageBox({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u5173\u95ed\u6240\u6709tab\uff1f",buttons:["ok","cancel"],iconCls:"mini-messagebox-question",showNoTipCheck:!0,clickNoTipCheck:function(a){S=a},callback:function(a){"ok"==a&&TabsNav.removeAll()}})};a(k).on("resize",function(a){TabsNav.adjustSize()});g.on("click",".fui-main-tab",function(a){TabsNav.activeTab(this.id)}).on("click",".fui-tab-refresh",function(a){a.stopPropagation();TabsNav.refreshTabContent(this.parentNode.id);F()}).on("click",".fui-tab-close",function(a){a.stopPropagation();a=this.parentNode.id;M.addHistory(q[a]);TabsNav.removeTab(a);F()});u.on("click",function(a){a=parseInt(m.css("marginLeft"));a!=-J&&(a-=100,a<=-J&&(a=-J,u.addClass("disabled")),m.stop(!0,!0).animate({marginLeft:a},500));t.removeClass("disabled")});t.on("click",function(a){a=parseInt(m.css("marginLeft"));0!==a&&(a+=100,0<=a&&(a=0,t.addClass("disabled")),m.stop(!0,!0).animate({marginLeft:a},500));u.removeClass("disabled")});x.on("click",function(){x.hasClass("disabled")||(S?TabsNav.removeAll():V())});var X=a("#page-cover");z.on("click",function(){var b=a(this);b.hasClass("active")?F():(b.addClass("active"),O&&T(),v.removeClass("hidden"),X.removeClass("hidden"))});var G=null;v.on("click",".fui-history-item",function(){var b=a(this);if(!b.hasClass("empty")){var c=b.data("url"),d=b.data("tabid"),b=b.text();TabsNav.addTab({id:d.substr(4),name:b,url:c});M.removeHistory(q[d]);F()}}).on("click",".fui-current-item",function(){var b=a(this),c=b.data("tabid");b.hasClass("active")||(TabsNav.activeTab(c),A.find(".active").removeClass("active"),b.addClass("active"));F()});a("body").on("click",function(b){0===a(b.target).closest(".fui-main-taboperation").length&&F()});k.tabContextMenu={refresh:function(a){TabsNav.refreshTabContent(a.sender.ownerMenu.tabId)},closeOther:function(a){TabsNav.removeAll(a.sender.ownerMenu.tabId)},close:function(a){a=a.sender.ownerMenu.tabId;M.addHistory(q[a]);TabsNav.removeTab(a)}};var d=mini.get("tabContextMenu");a(d.el).on("mouseout",function(){G&&(clearTimeout(G),G=null);G=setTimeout(function(){d.hide()},500)}).on("mouseover",function(){G&&(clearTimeout(G),G=null)});m.on("contextmenu",".fui-main-tab",function(a){d.set({tabId:this.id}).showAtPos(a.pageX,a.pageY);return!1});k.initFixedTab=function(){a.each(FixedTabs,function(a,c){TabsNav.addTab({id:c.id,name:c.name,url:c.url,closeIcon:!1},!0);L.push("tab-"+c.id);C="tab-"+c.id});TabsNav.activeTab("tab-"+FixedTabs[0].id);R=r.outerWidth(!0);T(!0);a.niceScroll?Y():Util.loadJs("frame/fui/js/lib/jquery.nicescroll.min.js",Y)};var Y=function(){D.niceScroll({cursorcolor:"#666"})}})(this,jQuery);(function(k,a){function g(){D=new MessageList({container:t,getUrl:MsgRemind.getUrl,ignoreUrl:MsgRemind.ignoreUrl,afterOpenMsg:B,afterIgnore:function(a){v()}})}function e(){w=new EMsgList({content:K,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:B,onDecEmsgCount:H});k.RefreshEMsg=a.proxy(w.getData,w)}var l=a("#rightMessage"),n=a(".fui-msg-iconlist",l),r=a(".msg-panel",l),m=a(".icon-info",n).next(),p=a(".icon-emsg",n).next(),l=a("#msgRemind",r),t=a(".msg-panel-content",l),l=a("#msg-sound"),u,x;Util.browsers.isIE?u=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden" id\x3d"msgcenter-sound"\x3e\x3c/iframe\x3e').appendTo(l):(l.html('\x3caudio id\x3d"msgcenter-sound-audio" controls\x3d"controls" src\x3d"../../msgsound/newsms.wav" class\x3d"hidden-accessible"\x3e\x3c/audio\x3e'),x=document.getElementById("msgcenter-sound-audio"));a.trim(MSG_TPL);var z=function(a){a=parseInt(a);return 99<a?"99+":0>=a?"":a+""},v=function(){var a=!1,e=!1,g,k;Util.ajax({url:MsgNumUrl,data:{haseXun:!0,needNum:!0}}).done(function(f){f.remind?(k=parseInt(f.remind),g=m.data("num")||0,k>g?a=!0:k&&(e=!0),m.text(z(k)).data("num",k)):m.text("").data("num",0);f.eXun?(k=parseInt(f.eXun),a||(g=p.data("num")||0,k>g?a=!0:k&&(e=!0)),p.text(z(k)).data("num",k)):p.text("").data("num",0);a?(Util.browsers.isIE?u[0].src=Util.getRightUrl(SOUND_URL+"?_\x3d"+ +new Date):x.play(),docTitle.roll()):e||docTitle.stop()})},A=a("#page-cover"),B=function(){r.animate({right:-350},function(){r.addClass("hidden")});n.find(".active").removeClass("active")},D;k.MessageList?g():Util.loadJs("../../messagelist/messagelist.js",function(){g()});n.on("click",".fui-msg-iconitem",function(f){f.stopPropagation();f=a(this);var e=f.data("ref"),g=a("#"+e,r);f.hasClass("active")?B():(f.addClass("active").siblings(".active").removeClass("active"),"msgRemind"==e?D.getData():"msgEMsg"==e&&w.getData(),g.removeClass("hidden").siblings().addClass("hidden"),g.find(".msg-panel-content").removeClass("hidden"),r.removeClass("hidden"),r.animate({right:0}),A.removeClass("hidden"))});a("body").on("click",function(f){0===a(f.target).closest(".msg-panel").length&&B()});l=a("#msgEMsg",r);a("li[data-ref\x3d'msgEMsg']",n);var l=a(".msg-panel-content",l),K=a(".emsg-recent-list",l),w;k.EMsgList?e():Util.loadJs("../../emsglist/emsglist.js",function(){e()});var H=function(){var a=p.text();a&&(a=parseInt(a)-1);0==a&&(a="");p.text(a)};r.on("click",".msg-panel-hide",function(){B()});a(function(){v();setInterval(v,6E4)})})(this,jQuery);(function(k,a){var g=function(){a("[placeholder]").placeholder()};a.placeholder?g():Util.loadJs("frame/fui/js/lib/jquery.placeholder.min.js",g)})(this,jQuery);(function(k,a){var g,e="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",l=0;k.docTitle={roll:function(){g||(g=document.title);document.title=e;clearTimeout(l);l=setTimeout(function r(){document.title=e.substring(1,e.length)+e.substring(0,1);e=document.title;l=setTimeout(r,300)},300)},stop:function(){clearTimeout(l);document.title=g||document.title;e="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}}})(window,jQuery);var eMsgSocket;window.OpenEMsg=function(k,a,g){window.eMsg?"undefined"==typeof a?eMsg.open(k):eMsg.openSession(k,a,g):Util.loadPageModule({templ:"frame/fui/pages/emsg/emsg.tpl",js:"frame/fui/pages/emsg/emsg.js",css:"frame/fui/pages/emsg/emsg.css",callback:function(){eMsgSocket=new EMsgSocket(_userGuid_,_userName_);"undefined"==typeof a?eMsg.open(k):eMsg.openSession(k,a,g)}})};(function(k){var a=k("#headerUser"),g=k("#leftNav,#navOverall"),e=k("#page-cover");k("body").on("click",function(l){var n=l.target;$target=k(n);needHideCover=!0;0!==k(l.target).closest(".msg-panel").length&&(needHideCover=!1);k.contains(a[0],n)&&(needHideCover=!1);if(k.contains(g[0],n)||k.contains(g[1],n))needHideCover=!1;0!==$target.closest(".fui-main-taboperation").length&&(needHideCover=!1);needHideCover&&e.addClass("hidden")})})(jQuery);