/*
 * @Author: chends
 * @Date: 2018-07-04 08:24:11
 * @LastEditors: jjj
 * @LastEditTime: 2018-09-15 16:21:19
 * @Description: 
 */

// 全局变量处理
(function(c,a){c._graceEvent_=new Util.UserEvent;var e=a("#cover-wrap");c.createMainContentCover=Util.browsers.isIE&&window.hasObjectTag?function(){var c=document.createElement("iframe");c.width="100%";c.height="100%";c.scrolling="no";c.frameBorder=0;c.style.background="transparent";c.src="../../activexcover/activexcover.html";return a('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').append(c).appendTo(e)}:function(){return a('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').appendTo(e)};c._getData_=function(a,c){return Util.ajax({url:epoint.dealRestfulUrl(getDataUrl+"/"+a),data:c})};c.dealLinkOpen=function(a){switch(a.openType){case "tabsnav":TabsNav.addTab(a);break;case "dialog":epoint.openTopDialog(a.name,Util.getRightUrl(a.url));break;case "blank":c.open(Util.getRightUrl(a.url),a.id)}};c._ANIMATION_TIME_={slide:300};c.useWebsocket=!0===Util.getFrameSysParam("useWebsocket");c.eWebSocket=void 0;c.creatWebSocket=function(a,f,b){if(eWebSocket)b&&b();else{var d=c.EWebSocketConfig?c.EWebSocketConfig:{url:EmsgConfig.websocketUrl};d.uid=a;d.uname=f;c.EWebSocket?(eWebSocket=new EWebSocket(d),b&&b(),_graceEvent_.fire("websocketCreated")):Util.loadJs("frame/fui/js/widgets/ewebsocket/ewebsocket.js",function(){eWebSocket=new EWebSocket(d);b&&b();_graceEvent_.fire("websocketCreated")})}};c.showEXun=!0;c._msgcenterConfig_=c.MsgCenterConfig||{}})(this,jQuery);(function(c,a){"[object Function]"===Object.prototype.toString.call(c.EpTabsNav)?(window.TabsNav=new EpTabsNav({ifrContainer:"#main-ifr-wrap",tabContainer:"#main-tab-wrap",needScrollBtn:!1,scrollBtnSite:"sides",smoothItems:3,refreshOnActiveTab:Util.getFrameSysParam("refreshOnActiveTab")||!1,needQuickNav:!0,position:"bottom",tabWidth:112}),TabsNav._$pageCover=createMainContentCover()):console.error('The TabsNav is required! , please add the "frame/fui/js/widgets/tabsnav/tabsnav.js" before theme\'s javascript file')})(this,jQuery);(function(c,a){var e=a("#theme-bg-img"),h=function(a){a=a||mini.Cookie.get("_grace_skin_")||"default";var b="./skins/"+a+"/images/bg.png";a=new Image;a.src=b;a.onload=function(){e[0].src=b}};a(window).on("message",function(a){a=a.originalEvent;if(a.data)try{var b=JSON.parse(a.data);"skinChange"==b.type&&b.skin&&h(b.skin)}catch(d){console.error(d)}})})(this,jQuery);(function(c,a){function e(){if(!r&&(r=d.children().length,0===r))return;g||(g=d.children().eq(0).outerHeight(!0));var a=h.width();if(0>=a)return setTimeout(e,17);a=(a-l-q-80-30)/95>>0;r>a?b.addClass("is-over").css("width",95*a):b.removeClass("is-over").css("width",95*r);k&&(a=g*Math.ceil(r/a),m.text(".top-menu-wrap.active{max-height:"+a+"px;max-height:"+a/100+"rem}"))}var h=a("#header-main-nav"),f=a("#main"),b=a("#top-menu"),d=a(".top-menu-list",b),l=a("#top-portal").outerWidth()||120,q=a("#quick-menu").outerWidth()||80,g,p=document.createElement("div"),k="transition"in p.style,p=null,m=a("\x3cstyle\x3e\x3c/style\x3e").appendTo("head"),r=0,u;a(window).on("resize.topmenuadjust",function(){clearTimeout(u);u=setTimeout(e,17)});_graceEvent_.on("headerSearchLoad",e);var n=createMainContentCover();b.on("click",".top-menu-trigger",function(){b.hasClass("is-over")&&(b.hasClass("active")?(k&&b.addClass("hold-color"),b.removeClass("active"),n.addClass("hidden")):(b.addClass("active"),n.removeClass("hidden")))}).on("transitionend",function(a){a.target===this&&b.removeClass("hold-color")}).on("click",".top-menu-item",function(){var d=a(this),c=d.data("url"),g=this.getAttribute("title")||this.innerText,k=d.data("opentype"),l=d.data("hassub");d.addClass("active").siblings().removeClass("active");l?(f.removeClass("left-none"),getLeftMenu({code:this.getAttribute("data-id"),name:this.getAttribute("title")||this.innerText},!0)):f.addClass("left-none");c&&dealLinkOpen({openType:k,name:g,id:d.data("id"),url:c});b.removeClass("active");n.addClass("hidden")});a("body").on("click",function(d){a(d.target).closest("#top-menu").length||(b.removeClass("active"),n.addClass("hidden"))});(function(){_getData_("getMenu",{query:"top"}).done(function(b){if(b&&b.items){var c=b.code,g="",k;c?a.each(b.items,function(a,d){if(d.code==c)return d.isActived=!0,g=d.name,k=d.hasSub,!1}):(b.items[0].isActived=!0,c=b.items[0].code,g=b.items[0].name,k=b.items[0].hasSub);a(Mustache.render('{{#items}}\x3cli class\x3d"top-menu-item l {{#isActived}}active{{/isActived}}" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}" data-hassub\x3d"{{hasSub}}" title\x3d"{{name}}"\x3e{{name}}\x3c/li\x3e{{/items}}',b)).appendTo(d);_graceEvent_.fire("topMenuLoad");e();k?getLeftMenu({code:c,name:g}):f.addClass("left-none")}})})()})(this,jQuery);(function(c,a){var e=a("#sys-logo-img"),h=a("#user-info"),f=a(".user-portrait",h),b=createMainContentCover();h.on("click",".user-info-summary",function(){h.hasClass("active")?(h.removeClass("active"),b.addClass("hidden")):(h.addClass("active"),b.removeClass("hidden"))}).on("click",".user-action-item",function(){var d=a(this);if(d.hasClass("person-info"))TabsNav.addTab({id:this.getAttribute("data-id"),name:this.getAttribute("data-name"),url:this.getAttribute("data-url")});else if(d.hasClass("logout"))mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(a){"ok"==a&&(eWebSocket&&eWebSocket.close(),UserSettings.logout())});else if(d.hasClass("role-change"))UserSettings.changeRole(_userGuid_);else{var c=d.data("opentype"),e=d.data("id"),g=d.attr("url"),f=d.text(),k=d.attr("script");e||(e=Util.uuid(),d.data("id",e).attr("data-id",e));if(g)dealLinkOpen({id:e,openType:c,name:f,url:g});else if(k)try{eval(k)}catch(m){console.error(m)}}h.removeClass("active");b.addClass("hidden")});a("body").on("click",function(d){a(d.target).closest("#user-info").length||(h.removeClass("active"),b.addClass("hidden"))});_getData_("getUserInfo").done(function(d){c._userName_=d.name;c._userGuid_=d.guid;a.extend(c._msgcenterConfig_,{isMsgCenterMaxSize:d.isMsgCenterMaxSize||!1,msgCenterOrder:d.msgCenterOrder||"asc",hideCallback:function(){b.addClass("hidden")}});useWebsocket&&creatWebSocket(_userGuid_,_userName_);if(d.portrait){var l=Util.getRightUrl(epoint.dealRestfulUrl(d.portrait));f.attr("src",l)}d.hasParttime&&h.find(".user-action-item.role-change").removeClass("hidden");l=a("#user-info-detail");l.find(".user-name").text(d.name).attr("title",d.name);l.find(".user-dept").text(d.ouName).attr("title",d.ouName)});_getData_("getPageInfo").done(function(a){a.logo&&e.attr("src",/^data:/i.test(a.logo)?a.logo:Util.getRightUrl(a.logo));a.title&&(document.title=a.title,c.systemTitle=a.title);a.fullSearchUrl&&(c._fullSearchUrl_=a.fullSearchUrl);!1===a.showEXun&&(c.showEXun=!1);initPortal(a.homes,a.defaultHome);_graceEvent_.fire("afterPageInfo")});a(c).on("message",function(a){try{var b=JSON.parse(a.originalEvent.data);"userPortraitChange"===b.type&&f.attr("src",b.imgData)}catch(q){}});_getData_("getExtTabsInfo").done(function(b){if(b&&b.length){var d="";a.each(b,function(a,b){b.icon=b.icon||"modicon-8";/^icon-/.test(b.icon)&&(b.icon="action-icon "+b.icon);d+=Mustache.render('\x3cli class\x3d"user-action-item" title\x3d"{{name}}" url\x3d"{{url}}" data-opentype\x3d"{{openType}}" script\x3d"{{script}}"\x3e\x3cspan class\x3d"{{icon}}"\x3e\x3c/span\x3e{{name}}\x3c/li\x3e',b)});a(d).insertAfter("#person-info-setting")}})})(this,jQuery);(function(c,a){function e(b,d){for(var c={closeIcon:!1,refresh:!0},e=[],k=0;k<b.length;k++){var m=b[k],l=!1;void 0!=m.items?!l&&a.each(m.items,function(a,b){if(d){if(b.code==d)return c.id=b.code||"home",c.url=b.url,c.name=b.name,l=!0,!1}else if("tabsnav"==b.openType)return c.id=b.code||"home",c.url=b.url,c.name=b.name,l=!0,!1}):(l||(d?m.code==d&&(c.id=m.code||"home",c.url=m.url,c.name=m.name,l=!0):"tabsnav"==m.openType&&(c.id=m.code||"home",c.url=m.url,c.name=m.name,l=!0)),e=e.concat(b.splice(k,1)),k--)}var f=[{code:"signleHomes",name:"\u9ed8\u8ba4\u5206\u7c7b",items:e}];a.each(b,function(a,b){f.push(b)});return{homes:f,home:c}}function h(c,e){TabsNav.addTab(e);var g="",l=3<=c.length?!0:!1,k,m;l?(b.addClass("multi"),k='\x3cdiv class\x3d"portal-category-list"\x3e',m='\x3cdiv class\x3d"portal-sub-container"\x3e',a.each(c,function(a,b){k+=Mustache.render('\x3cdiv class\x3d"top-portal-cate-item" data-target\x3d"{{code}}"\x3e\x3cspan class\x3d"top-portal-cate-name" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e\x3cspan class\x3d"top-portal-cate-trigger"\x3e\x3c/span\x3e\x3c/div\x3e',b);m+='\x3cdiv class\x3d"portal-sub-list" data-cate\x3d"'+b.code+'"\x3e';m+=Mustache.render('{{#items}}\x3cdiv class\x3d"top-portal-item" data-id\x3d"{{code}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}" data-url\x3d"{{url}}"\x3e{{name}}\x3c/div\x3e{{/items}}',b);m+="\x3c/div\x3e"}),k+="\x3c/div\x3e",m+="\x3c/div\x3e",g=k+m):a.each(c,function(a,b){g+=Mustache.render('\x3cdiv class\x3d"top-portal-cate-item" data-target\x3d"{{code}}"\x3e\x3cspan class\x3d"top-portal-cate-name" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e\x3cspan class\x3d"top-portal-cate-trigger"\x3e\x3c/span\x3e\x3c/div\x3e',b);g+='\x3cdiv class\x3d"portal-sub-list" data-cate\x3d"'+b.code+'"\x3e';g+=Mustache.render('{{#items}}\x3cdiv class\x3d"top-portal-item" data-id\x3d"{{code}}" data-opentype\x3d"{{openType}}" title\x3d"{{name}}" data-url\x3d"{{url}}"\x3e{{name}}\x3c/div\x3e{{/items}}',b);g+="\x3c/div\x3e"});a(g).appendTo(d.empty());f(l,e);(1===c.length&&!c[0].items||1===c.length&&c[0].items&&1===c[0].items.length)&&b.find(".portal-trigger").addClass("hidden")}function f(c,e){var g=createMainContentCover();if(c){var f=d.find(".top-portal-cate-item:eq(0)").addClass("active");d.find('.portal-sub-list[data-cate\x3d"'+f.data("target")+'"]').removeClass("hidden").siblings().addClass("hidden");b.on("click",".top-portal-cate-item",function(){var b=a(this);b.addClass("active").siblings().removeClass("active");d.find('.portal-sub-list[data-cate\x3d"'+b.data("target")+'"]').removeClass("hidden").siblings().addClass("hidden")})}else b.on("click",".top-portal-cate-trigger, .top-portal-cate-name",function(){var b=a(this).closest(".top-portal-cate-item"),c=b.next();b.data("target")==c.data("cate")&&(b.hasClass("close")?(b.removeClass("close"),c.stop(!0).slideDown(_ANIMATION_TIME_.slide)):(b.addClass("close"),c.stop(!0).slideUp(_ANIMATION_TIME_.slide)))});b.on("click",".portal-trigger",function(){b.hasClass("active")?(b.removeClass("active"),g.addClass("hidden")):(b.addClass("active"),g.removeClass("hidden"))}).on("click",".top-portal-item",function(){var c=a(this),d=c.data("id"),e=c.data("opentype"),f=c.data("url"),c=c.attr("title");"tabsnav"==e?TabsNav.addTab({id:d,name:c,url:f}):"blank"==e&&window.open(Util.getRightUrl(f),d);b.removeClass("active");g.addClass("hidden")}).on("click",".portal-curr",function(){TabsNav.addTab(e)});a("body").on("click",function(c){a(c.target).closest("#top-portal").length||(b.removeClass("active"),g.addClass("hidden"))})}var b=a("#top-portal"),d=a(".portal-box-inner",b);c.initPortal=function(a,b){var c=e(a,b);return h(c.homes,c.home)}})(this,jQuery);(function(c,a){var e=a("#quick-menu"),h=a(".quick-menu-list",e),f=createMainContentCover();e.on("click",".quick-menu-header",function(){e.hasClass("active")?(e.removeClass("active"),f.addClass("hidden")):(e.addClass("active"),f.removeClass("hidden"))}).on("click",".quick-menu-item",function(){var b=a(this),d=b.data("opentype"),l=b.data("id"),h=this.title,b=b.data("url");"tabsnav"==d?TabsNav.addTab({id:l,name:h,url:b}):c.open(Util.getRightUrl(b),l);e.removeClass("active");f.addClass("hidden")});a("body").on("click",function(b){a(b.target).closest("#quick-menu").length||(f.addClass("hidden"),e.removeClass("active"))});_getData_("getQuickMenu").done(function(b){if(b&&b.length){var c="";a.each(b,function(a,b){c+=Mustache.render('\x3cli class\x3d"quick-menu-item" data-id\x3d"{{code}}" title\x3d"{{name}}" data-opentype\x3d"{{openType}}" data-url\x3d"{{url}}"\x3e{{name}}\x3c/li\x3e',b)});a(c).appendTo(h.empty())}else e.addClass("hidden")})})(this,jQuery);(function(c,a){function e(b,c){var d="";a.each(b,function(b,n){n.hasSub=!(!n.items||!n.items.length);n.rowkey=void 0===c?b+"":c+"-"+b;var g=n.rowkey.split("-").length;n.isTop=1===g;n.level="level-"+g;var f;f=g||n.rowkey.split("-").length;n.indent=36+13*(f-1);n.indentRem=n.indent&&n.indent/100;1===g&&(n.icon=n.icon||"modicon-1");d=n.hasSub?d+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;padding-left: {{indentRem}}rem;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',a.extend(n,{subMenu:e(n.items,n.rowkey)})):d+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;padding-left: {{indentRem}}rem;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',n)});return d}function h(a){if(p[a])return TabsNav.addTab(p[a]);var b="",c="";q.find("#left-menu-"+a).find(".left-menu-link").each(function(d,e){c=e.getAttribute("data-url");b=e.getAttribute("data-opentype");if(c&&"tabsnav"==b)return p[a]={id:e.getAttribute("data-id"),name:e.title,url:c},TabsNav.addTab(p[a]),!1})}var f={},b=a("#main"),d=a("#left-menu"),l=a(".left-nav-trigger",d),q=a(".left-nav-container",d),g;(function(){function c(a){localStorage.setItem("_grace_leftmenu_state_",a)}var e=localStorage.getItem("_grace_leftmenu_state_")||"normal";b["normal"==e?"removeClass":"addClass"]("left-narrow");var f=Util.browsers.isIE8||Util.browsers.isIE9,h=createMainContentCover();a(".left-nav-trigger").on("click",function(){b.hasClass("left-narrow")?(c(e="normal"),b.removeClass("left-narrow"),h.addClass("hidden")):(c(e="narrow"),b.addClass("left-narrow"),g&&(g.find(".left-menu-item.level-1.opened").length?h.removeClass("hidden"):d.trigger("hide-trans")))});d.on("hide-trans",function(){!f&&d.addClass("hide-trans")}).on("transitionend",function(a){a.target===this&&d.removeClass("hide-trans")}).on("click",".left-menu-link",function(){var b=a(this),c=b.parent(),f=c.hasClass("level-1"),l=b.data("hassub"),k={url:b.data("url"),openType:b.data("opentype"),name:this.title,id:b.data("id")},m="narrow"===e;l?(b=f?b.next().find(".left-menu-sub-list:eq(0)"):b.next(),c.hasClass("opened")?(c.removeClass("opened"),b.stop(!0).slideUp(_ANIMATION_TIME_.slide),f&&m&&h.addClass("hidden")):(c.addClass("opened"),f&&m&&h.removeClass("hidden"),b.stop(!0).slideDown(_ANIMATION_TIME_.slide),c.siblings(".opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").stop(!0).slideUp(_ANIMATION_TIME_.slide))):k.url&&(dealLinkOpen(k),m&&(g.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp(_ANIMATION_TIME_.slide),h.addClass("hidden"),d.removeClass("has-opened")));if(f&&m)d[g.find(".left-menu-item.level-1.opened").length?"addClass":"removeClass"]("has-opened")});a("body").on("click",function(b){a(b.target).closest("#left-menu").length||(h.addClass("hidden"),"narrow"===e&&g&&g.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp())});a(".main-content",b).on("transitionend",function(){TabsNav.adjustSize()})})();c.getLeftMenu=function(c,m){var k=c.code;if(!f[k]||"reject"===f[k])return _getData_("getMenu",{query:"sub",code:k}).done(function(p){p&&p.length?(p=e(p),g=a(Mustache.render('\x3cdiv class\x3d"left-menu-wrap" id\x3d"left-menu-{{code}}"\x3e\x3cdiv class\x3d"left-menu-header"\x3e{{name}}\x3c/div\x3e\x3cul class\x3d"left-menu-list"\x3e{{{leftMenuItems}}}\x3c/ul\x3e\x3c/div\x3e',{code:c.code,name:c.name,leftMenuItems:p})),g.appendTo(q).siblings(".left-menu-wrap").addClass("hidden"),b.removeClass("left-none"),Util.browsers.isIE8&&g.find(".left-menu-list").height(d.height()-l.height()||36)):b.addClass("left-none");f[k]="resolve";m&&h(k+"")}).fail(function(){f[k]="reject"});"resolve"===f[k]&&(g=a("#left-menu-"+k),g.removeClass("hidden").siblings(".left-menu-wrap").addClass("hidden"),m&&h(k))};var p={}})(this,jQuery);window.OpenEMsg=function(c,a,e){window.eMsg?"undefined"===typeof a?eMsg.open(c):eMsg.openSession(c,a,e):creatWebSocket(_userGuid_,_userName_,function(){eWebSocket.openEmsg(c,a,e)})};(function(c,a){function e(){ThemeSelection._styleLoaded=!0;b=new ThemeSelection({getPagesUrl:getPagesUrl,savePageUrl:savePageUrl,showCallback:function(){f.removeClass("hidden")},hideCallback:function(){h.removeClass("active");f.addClass("hidden")}});window.themeSelection=b;h.on("click",function(){h.hasClass("active")?(h.removeClass("active"),b.hide()):(b.show(),h.addClass("active"))});a("body").on("click",function(c){a(c.target).closest(".theme-selection-container, #theme-skin-switch").length||(h.removeClass("active"),b.hide())})}var h=a("#theme-skin-switch"),f=createMainContentCover(),b;window.ThemeSelection?e():Util.loadJs("frame/fui/js/widgets/themeselection/themeselection.js",e)})(this,jQuery);(function(c,a){function e(){A=new EMsgList({content:F,getUrl:EmsgConfig.baseUrl,ignoreUrl:EmsgConfig.baseUrl,userImg:EmsgConfig.userImg,groupImg:EmsgConfig.groupImg,afterOpenEMsg:function(){h()},onDecEmsgCount:function(a){H(a)}});c.RefreshEMsg=a.proxy(A.getData,A)}function h(){C.addClass("hidden");t.stop(!0).animate({right:-350},function(){t.addClass("hidden")});m.find("[data-ref].active").removeClass("active")}var f="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",b=0,d="",l={roll:function(){d=c.systemTitle||document.title;document.title=f;clearTimeout(b);b=setTimeout(function I(){document.title=f.substring(1,f.length)+f.substring(0,1);f=document.title;b=setTimeout(I,300)},300)},stop:function(){clearTimeout(b);document.title=d||document.title;f="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}},q=a("#msg-sound"),g,p;Util.browsers.isIE?g=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden" id\x3d"msgcenter-sound"\x3e\x3c/iframe\x3e').appendTo(q):(q.html('\x3caudio id\x3d"msgcenter-sound-audio" controls\x3d"controls" src\x3d"../../msgsound/newsms.wav" class\x3d"hidden-accessible"\x3e\x3c/audio\x3e'),p=document.getElementById("msgcenter-sound-audio"));var k=function(a){a=parseInt(a,10);return 99<a?"99+":0>=a?"":a+""},m=a("#header-action-btns"),r=a(".header-action-btn.chart",m),u=a(".remind-num",m),n=a(".emsg-num",m),t=a("#msg-panel"),y=a("#msgEMsg",t),E=a(".msg-panel-content",y),F=a(".emsg-recent-list",E),z=a(".online-user-num",y),w=document.getElementById("online-user"),x=a("#new-remind-wrap"),B={show:function(){RemindTipsCfg.show&&(x.removeClass("hidden"),this.autoHide())},autoHide:function(){return 0!=RemindTipsCfg.timeout?function(){clearTimeout(B.timer);B.timer=setTimeout(function(){x.addClass("hidden")},RemindTipsCfg.timeout)}:function(){}}(),initEvent:function(){if(RemindTipsCfg.show)x.on("click",".icon, .text",function(){x.addClass("hidden")}).on("click",".close",function(a){a.stopPropagation();x.addClass("hidden")})}};B.initEvent();var D=function(a){var b={haseXun:c.showEXun,needNum:!0};a&&(b.inCache=!0);return _getData_("getMsgCount",b).done(function(a){G(a)})},G=function(a){var b=0,c=!1;a.remind?(b=parseInt(u.data("num"),10)||0,a.remind>b&&(c=!0,B.show()),u.removeClass("hidden").text(k(a.remind)),u.data("num",a.remind)):u.text("").addClass("hidden");a.eXun?(b=parseInt(n.data("num"),10)||0,a.eXun>b&&(c=!0),n.removeClass("hidden").text(k(a.eXun)),n.data("num",a.eXun)):n.text("").addClass("hidden");var d=Util.getWinSize(),b=d.height/2+75,d=d.width/2-150;a.systemUpdate&&(b=window.open("","","width\x3d300,height\x3d150,top\x3d"+b+",left\x3d"+d),b.document.write("\x3cp\x3e"+a.systemUpdate+"\x3c/p\x3e"),b.focus());if(c){if(!1!==Util.getFrameSysParam("messageSound"))if(Util.browsers.isIE)g[0].src=Util.getRightUrl("../../msgsound/sound.html?_\x3d"+ +new Date);else try{p&&p.play()["catch"](function(){var a=new window.SpeechSynthesisUtterance;a.text="\u60a8\u6709\u65b0\u77ed\u6d88\u606f\uff0c\u8bf7\u6ce8\u610f\u67e5\u6536\uff01";window.speechSynthesis.speak(a)})}catch(K){}l.roll()}else l.stop()};_graceEvent_.on("afterPageInfo",function(){D();c.useWebsocket||setInterval(function(){D(!0)},6E4);c.showEXun?J():r.addClass("hidden")});if(c.useWebsocket)_graceEvent_.on("websocketCreated",function(){eWebSocket.socketEvent.on("messagecount",function(a){G(a.data)})});c.getMessageCount=D;var H=function(a){var b=n.text();Util.ajax({url:EmsgConfig.countUrl,data:{sessionid:a}}).done(function(a){b&&a&&(b=parseInt(b,10)-parseInt(a,10));0>b&&(b=0);0==b&&(b="",n.data("num",0).addClass("hidden"));n.text(b)})},A,J=function(){c.EMsgList?e():Util.loadJs("frame/fui/js/widgets/emsglist/emsglist.js",function(){e()});c.OnlineUserSettings&&c.OnlineUserSettings.show&&(y.find(".msg-panel-head").addClass("tab").find(".panel-hd-tab.hidden").removeClass("hidden"),y.on("click",".panel-hd-tab",function(){var b=a(this),c=b.data("ref"),d=F;b.hasClass("active")||(b.addClass("active").siblings().removeClass("active"),c&&(d=a("#"+c,E),setTimeout(function(){OnlineUserSettings.onRefreshData(function(a){z.html(a)})},500)),d.removeClass("hidden").siblings().addClass("hidden"))}))};c.hideMessagePanel=h;var C=createMainContentCover(),v;c.messageCenter={refresh:function(){v&&v.refresh()},hide:function(){v&&v.hide()}};m.on("click","[data-ref]",function(){var b=a(this),d=b.data("ref"),e=a("#"+d,t);if(b.hasClass("active"))h(),C.addClass("hidden");else if(b.addClass("active").siblings(".active").removeClass("active"),"msgRemind"==d)v||(v=new MsgCenter(c._msgcenterConfig_)),v.show(),hideMessagePanel();else{if("msgEMsg"==d){if(A.getData(),c.OnlineUserSettings&&c.OnlineUserSettings.show)if(w.src)OnlineUserSettings.onRefreshData(function(a){z.html(a)});else w.src=OnlineUserSettings.url,w.attachEvent?w.attachEvent("onload",function(){OnlineUserSettings.onRefreshData(function(a){z.html(a)})}):w.onload=function(){OnlineUserSettings.onRefreshData(function(a){z.html(a)})}}else"msgSkin"==d&&c.initSkinView&&c.initSkinView();e.removeClass("hidden").siblings(".msg-panel-detail").addClass("hidden");e.find(".msg-panel-content").removeClass("hidden");t.removeClass("hidden");t.stop(!0).animate({right:0});C.removeClass("hidden")}});t.on("click",".msg-panel-hide",function(){h()});a("body").on("click",function(b){a(b.target).closest("#msg-panel , .header-action-btn[data-ref]").length||hideMessagePanel()})})(this,jQuery);(function(c,a){function e(){return Util.ajax({url:c.fullSearchCateUrl}).done(function(a){h(a.categories)})}function h(d){d=d||[];"string"==typeof d&&(d=JSON.parse(d));var e=[];a.each(d,function(a,b){e.push({id:b.guid,name:b.name,iconCls:b.icon||"view"})});e.length||e.push({id:"all",name:"\u5168\u6587\u68c0\u7d22",iconCls:"modicon-25"});ClassifySearch._styleLoaded=!0;ClassifySearch._$pageCover=createMainContentCover();new ClassifySearch({id:"header-search",searchTarget:"\u5185\u5bb9",category:e,placeholder:"\u8bf7\u8f93\u5165",maxShowCharacter:5,enter:function(a,b){var d;d=a||"all";try{TabsNav.removeTab("fullsearch")}catch(k){}TabsNav.addTab({id:"fullsearch",name:"\u5168\u6587\u68c0\u7d22",url:c._fullSearchUrl_+"?wd\x3d"+c.encodeURI(b)+"\x26type\x3d"+d})}});setTimeout(function(){b.removeClass("invisible")},200)}var f=a(".header-container"),b=a("#top-search").addClass("invisible");_graceEvent_.on("afterPageInfo",function(){c._fullSearchUrl_?(e(),f.addClass("has-search")):f.removeClass("has-search");_graceEvent_.fire("headerSearchLoad")})})(this,jQuery);(function(c,a){function e(){if(q)try{q.abort()}catch(k){}var a=h();a.join("")!==g?q=Util.ajax({url:topMenuSaveUrl,data:{sort:JSON.stringify(a)}}).done(function(){mini.showTips({content:"\u4fdd\u5b58\u6210\u529f",state:"success",x:"center",y:"center",timeout:3E3});g=h().join("")}):mini.showTips({content:"\u6392\u5e8f\u672a\u66f4\u6539",state:"info",x:"center",y:"center",timeout:3E3});b.removeClass("active in-sort");f.addClass("hidden")}function h(){return d.sortable("toArray",{attribute:"data-id"})}if(1==Util.getFrameSysParam("enableCustomSort")){var f=createMainContentCover(),b=a("#top-menu"),d=b.find(".top-menu-list");d.sortable({revert:200,delay:300,distance:30,forcePlaceholderSize:!0,containment:"parent",update:function(){clearTimeout(l);l=setTimeout(e,1E3)},stop:function(){clearTimeout(l);l=setTimeout(e,1E3)},sort:function(){clearTimeout(l)},start:function(){clearTimeout(l);f.removeClass("hidden");b.addClass("active in-sort")}});var l,q,g;_graceEvent_.on("topMenuLoad",function(){g=h().join("")})}})(this,jQuery);