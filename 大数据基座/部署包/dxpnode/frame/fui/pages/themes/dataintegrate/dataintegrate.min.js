/*!
 * 新点数据集成开发平台
 * author:jiangqn
 * date: 2019-09-23
 * version: 1.0.0
 */var $main=$("#main"),$mainIframe=$("#main-iframe");(function(c,a){c._dataintegrateEvent_=new Util.UserEvent;var e=a("#cover-wrap");c.createMainContentCover=Util.browsers.isIE&&window.hasObjectTag?function(){var d=document.createElement("iframe");d.width="100%";d.height="100%";d.scrolling="no";d.frameBorder=0;d.style.background="transparent";d.src="../../activexcover/activexcover.html";return a('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').append(d).appendTo(e)}:function(){return a('\x3cdiv class\x3d"main-content-cover hidden"\x3e\x3c/div\x3e').appendTo(e)};c._getData_=function(a,c){return Util.ajax({url:epoint.dealRestfulUrl(getDataUrl+"/"+a),data:c})};c.dealLinkOpen=function(a){switch(a.openType){case "tabsnav":TabsNav.addTab(a);break;case "dialog":epoint.openTopDialog(a.name,Util.getRightUrl(a.url));break;case "blank":c.open(Util.getRightUrl(a.url),a.id)}};c._ANIMATION_TIME_={slide:200};c.useWebsocket=!0===Util.getFrameSysParam("useWebsocket");c.eWebSocket=void 0;c.creatWebSocket=function(a,e,b){if(eWebSocket)b&&b();else{var k=c.EWebSocketConfig?c.EWebSocketConfig:{url:EmsgConfig.websocketUrl};k.uid=a;k.uname=e;c.EWebSocket?(eWebSocket=new EWebSocket(k),b&&b(),_dataintegrateEvent_.fire("websocketCreated")):Util.loadJs("fui/pages/ewebsocket/ewebsocket.js",function(){eWebSocket=new EWebSocket(k);b&&b();_dataintegrateEvent_.fire("websocketCreated")})}};c.getTplHtml=function(c,e){var b=a("#"+c).html();Mustache.parse(b);return Mustache.render(b,e)}})(this,jQuery);(function(c,a){c.TabsNav={addTab:function(c){console.log(c);c.menuLink||a(".left-menu-link").removeClass("active");$mainIframe[0].src=Util.getRightUrl(c.url);$mainIframe.data("id",c.id)}}})(this,jQuery);(function(c,a){var e=a("#top-menu"),d=a("#top-menu-inner"),h=a("#header-container"),b=a("#menu-trigger"),k=createMainContentCover();$mainIframe[0].src=Util.getRightUrl(homeUrl);(function(){_getData_("getMenu",{query:"top"}).done(function(b){b=b.items;var c=Math.floor(100/b.length*100)/100;6>=b.length&&d.width("1000px");b.forEach(function(b){b.width=c+"%"});d.html(getTplHtml("topmenu-tpl",{list:b}));a("#top-menu-"+localStorage.getItem("activeTopId")).length&&a("#top-menu-"+localStorage.getItem("activeTopId")).trigger("click")})})();e.on("click",".top-menu-item",function(){var c=a(this),g=c.data("name"),d=c.data("url"),p=c.data("hassub"),r=c.data("id"),l=c.data("opentype");c.hasClass("active")?(b.removeClass("active"),e.addClass("hidden"),k.addClass("hidden")):(a(".top-menu-item",e).removeClass("active"),c.addClass("active"),p?($main.removeClass("left-none"),getLefMenu({code:this.getAttribute("data-id"),name:this.getAttribute("title")||this.innerText},!0)):$main.addClass("left-none"),d&&dealLinkOpen({openType:l,name:g,id:r,url:d}),b.removeClass("active"),e.addClass("hidden"),k.addClass("hidden"),localStorage.setItem("activeTopId",r))});h.on("click",".menu-trigger",function(){b.hasClass("active")?(b.removeClass("active"),e.addClass("hidden"),k.addClass("hidden")):(b.addClass("active"),e.removeClass("hidden"),k.removeClass("hidden"))});a("body").on("click",function(c){a(c.target).closest("#top-menu,#menu-trigger").length||(b.removeClass("active"),e.addClass("hidden"),k.addClass("hidden"))})})(window,jQuery);(function(c,a){var e=a("#user-info"),d=a(".user-portrait",e),h=createMainContentCover();e.on("click",".user-info-summary",function(){e.hasClass("active")?(e.removeClass("active"),h.addClass("hidden")):(e.addClass("active"),h.removeClass("hidden"))}).on("click",".user-action-item",function(){var b=a(this);if(b.hasClass("person-info"))TabsNav.addTab({id:this.getAttribute("data-id"),name:this.getAttribute("data-name"),url:this.getAttribute("data-url")});else if(b.hasClass("logout"))mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(b){"ok"==b&&(eWebSocket&&eWebSocket.close(),UserSettins.logout())});else if(b.hasClass("role-change"))UserSettins.changeRole(_userGuid_);else{var c=b.data("opentype"),d=b.data("id"),g=b.attr("url"),n=b.text(),p=b.attr("script");d||(d=Util.uuid(),b.data("id",d).attr("data-id",d));if(g)dealLinkOpen({id:d,openType:c,name:n,url:g});else if(p)try{eval(p)}catch(r){console.error(r)}}e.removeClass("active");h.addClass("hidden")});a("body").on("click",function(b){a(b.target).closest("#user-info").length||(e.removeClass("active"),h.addClass("hidden"))});_getData_("getUserInfo").done(function(b){c._userName_=b.name;c._userGuid_=b.guid;c._msgcenterConfig_=a.extend({},MsgCenterConfig,{isMsgCenterMaxSize:b.isMsgCenterMaxSize||!1,msgCenterOrder:b.msgCenterOrder||"asc",hideCallback:function(){h.addClass("hidden")}});useWebsocket&&creatWebSocket(_userGuid_,_userName_);if(b.portrait){var k=Util.getRightUrl(epoint.dealRestfulUrl(b.portrait));d.attr("src",k+"\x26t\x3d"+Math.random())}b.hasParttime&&e.find(".user-action-item.role-change").removeClass("hidden");k=a("#user-info-detail");k.find(".user-name").text(b.name).attr("title",b.name);k.find(".user-dept").text(b.ouName).attr("title",b.ouName);b.title&&(document.title=b.title,c.systemTitle=b.title);b.fullSearchUrl&&(c._fullSearchUrl_=b.fullSearchUrl);TabsNav.addTab(home);_dataintegrateEvent_.fire("afterPageInfo")});a(c).on("message",function(b){try{var a=JSON.parse(b.originalEvent.data);"userPortraitChange"===a.type&&d.attr("src",a.imgData)}catch(q){}});_getData_("getExtTabsInfo").done(function(b){if(b&&b.length){var c="";a.each(b,function(b,a){a.icon=a.icon||"modicon-8";/^icon-/.test(a.icon)&&(a.icon="action-icon "+a.icon);c+=Mustache.render('\x3cli class\x3d"user-action-item" title\x3d"{{name}}" url\x3d"{{url}}" data-opentype\x3d"{{openType}}" \x3e\x3cspan class\x3d"{{icon}}"\x3e\x3c/span\x3e{{name}}\x3c/li\x3e',a)});a(c).insertAfter("#person-info-setting")}})})(this,jQuery);(function(c,a){function e(){new MessageList({container:z,getUrl:epoint.dealRestfulUrl(getDataUrl+"/getMsgData"),ignoreUrl:epoint.dealRestfulUrl(getDataUrl+"/ignoreRemind"),afterOpenMsg:function(){d()},afterIgnore:function(){v()}})}function d(){x.addClass("hidden");f.stop(!0).animate({right:-350},function(){f.addClass("hidden")});l.find("[data-ref].active").removeClass("active")}var h="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",b=0,k="",q={roll:function(){k=c.systemTitle||document.title;document.title=h;clearTimeout(b);b=setTimeout(function A(){document.title=h.substring(1,h.length)+h.substring(0,1);h=document.title;b=setTimeout(A,300)},300)},stop:function(){clearTimeout(b);document.title=k||document.title;h="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}},g=a("#msg-sound"),n,p;Util.browsers.isIE?n=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden" id\x3d"msgcenter-sound"\x3e\x3c/iframe\x3e').appendTo(g):(g.html('\x3caudio id\x3d"msgcenter-sound-audio" controls\x3d"controls" src\x3d"../../msgsound/newsms.wav" class\x3d"hidden-accessible"\x3e\x3c/audio\x3e'),p=document.getElementById("msgcenter-sound-audio"));var r=function(a){a=parseInt(a,10);return 99<a?"99+":0>=a?"":a+""},l=a("#header-action-btns"),m=a(".remind-num",l);a(".emsg-num",l);var f=a("#msg-panel"),g=a("#msgRemind",f),z=a(".msg-panel-content",g),g=a("#msgEMsg",f),B=a(".msg-panel-content",g);a(".emsg-recent-list",B);a(".online-user-num",g);document.getElementById("online-user");var t=a("#new-remind-wrap"),w={show:function(){RemindTipsCfg.show&&(t.removeClass("hidden"),this.autoHide())},autoHide:function(){return 0!=RemindTipsCfg.timeout?function(){clearTimeout(w.timer);w.timer=setTimeout(function(){t.addClass("hidden")},RemindTipsCfg.timeout)}:function(){}}(),initEvent:function(){if(RemindTipsCfg.show)t.on("click",".icon, .text",function(){t.addClass("hidden")}).on("click",".close",function(a){a.stopPropagation();t.addClass("hidden")})}};w.initEvent();var v=function(a){var b={haseXun:!1,needNum:!0};a&&(b.inCache=!0);return _getData_("getMsgCount",b).done(function(a){y(a)})},y=function(a){var b=0,c=!1;a.remind?(b=parseInt(m.data("num"),10)||0,a.remind>b&&(c=!0,w.show()),m.removeClass("hidden").text(r(a.remind)),m.data("num",a.remind)):m.text("").addClass("hidden");if(c){if(!1!==Util.getFrameSysParam("messageSound"))if(Util.browsers.isIE)n[0].src=Util.getRightUrl("../../msgsound/sound.html?_\x3d"+ +new Date);else try{p&&p.play()["catch"](function(){var a=new window.SpeechSynthesisUtterance;a.text="\u60a8\u6709\u65b0\u77ed\u6d88\u606f\uff0c\u8bf7\u6ce8\u610f\u67e5\u6536\uff01";window.speechSynthesis.speak(a)})}catch(C){}q.roll()}else q.stop()};_dataintegrateEvent_.on("afterPageInfo",function(){v();useWebsocket||setInterval(function(){v(!0)},6E4)});if(useWebsocket)_dataintegrateEvent_.on("websocketCreated",function(){eWebSocket.socketEvent.on("messagecount",function(a){y(a.data)})});c.getMessageCount=v;c.MessageList?e():Util.loadJs("../../messagelist/messagelist.js",function(){e()});c.hideMessagePanel=d;var x=createMainContentCover(),u;c.messageCenter={refresh:function(){u&&u.refresh()}};l.on("click","[data-ref]",function(){var b=a(this),c=b.data("ref"),e=a("#"+c,f);b.hasClass("active")?(d(),x.addClass("hidden")):(b.addClass("active").siblings(".active").removeClass("active"),"msgRemind"==c?(u||(u=new MsgCenter(_msgcenterConfig_)),u.show(),hideMessagePanel()):(e.removeClass("hidden").siblings(".msg-panel-detail").addClass("hidden"),e.find(".msg-panel-content").removeClass("hidden"),f.removeClass("hidden"),f.stop(!0).animate({right:0}),x.removeClass("hidden")))});f.on("click",".msg-panel-hide",function(){d()});a("body").on("click",function(b){a(b.target).closest("#msg-panel , .header-action-btn[data-ref]").length||hideMessagePanel()})})(this,jQuery);(function(c,a){function e(b,c){var d="";a.each(b,function(b,f){f.hasSub=!(!f.items||!f.items.length);f.rowkey=void 0===c?b+"":c+"-"+b;var g=f.rowkey.split("-").length;f.isTop=1===g;f.level="level-"+g;var l;l=g||f.rowkey.split("-").length;f.indent=36+13*(l-1);1===g&&(f.icon=f.icon||"modicon-1");d=f.hasSub?d+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',a.extend(f,{subMenu:e(f.items,f.rowkey)})):d+Mustache.render('\x3cli class\x3d"left-menu-item {{level}}"\x3e\x3ca href\x3d"javascript:void(0);" data-url\x3d"{{url}}" data-id\x3d"{{code}}" title\x3d"{{name}}" data-openType\x3d"{{openType}}" data-hasSub\x3d"{{hasSub}}" class\x3d"left-menu-link"style\x3d"padding-left: {{indent}}px;"\x3e{{#isTop}}\x3ci class\x3d"left-menu-icon {{icon}} "\x3e\x3c/i\x3e{{/isTop}}\x3cspan class\x3d"left-menu-name"\x3e{{name}}\x3c/span\x3e{{#hasSub}}\x3ci class\x3d"left-menu-trigger"\x3e\x3c/i\x3e{{/hasSub}}\x3c/a\x3e{{#hasSub}}{{#isTop}}\x3cdiv class\x3d"left-menu-sub"\x3e\x3cdiv class\x3d"left-menu-sub-inner"\x3e\x3cdiv class\x3d"left-menu-sub-header"\x3e\x3cspan class\x3d"left-menu-sub-title"\x3e{{name}}\x3c/span\x3e\x3c/div\x3e{{/isTop}}\x3cul class\x3d"left-menu-sub-list" style\x3d"display:none;"\x3e {{{subMenu}}}\x3c/ul\x3e{{#isTop}}\x3c/div\x3e\x3c/div\x3e{{/isTop}}{{/hasSub}}\x3c/li\x3e',f)});return d}function d(a){if(n[a])return TabsNav.addTab(n[a]);var b="",c="";q.find("#left-menu-"+a).find(".left-menu-item-link").each(function(d,f){c=f.getAttribute("data-url");b=f.getAttribute("data-opentype");if(c&&"tabsnav"==b)return n[a]={id:f.getAttribute("data-id"),name:f.title,url:c},TabsNav.addTab(n[a]),!1})}var h={},b=a("#left-menu"),k=a(".left-nav-trigger",b),q=a(".left-nav-container",b),g;(function(){function c(a){localStorage.setItem("_dataintegrate_leftmenu_state_",a)}var d=localStorage.getItem("_dataintegrate_leftmenu_state_")||"normal";$main["normal"==d?"removeClass":"addClass"]("left-narrow");var e=Util.browsers.isIE8||Util.browsers.isIE9,h=createMainContentCover();a(".left-nav-trigger").on("click",function(){$main.hasClass("left-narrow")?(c(d="normal"),$main.removeClass("left-narrow"),h.addClass("hidden")):(c(d="narrow"),$main.addClass("left-narrow"),g&&(g.find(".left-menu-item.level-1.opened").length?h.removeClass("hidden"):b.trigger("hide-trans")))});b.on("hide-trans",function(){!e&&b.addClass("hide-trans")}).on("transitionend",function(a){a.target===this&&b.removeClass("hide-trans")}).on("click",".left-menu-link",function(){var c=a(this),e=c.parent(),k=e.hasClass("level-1"),l=c.data("hassub"),p={url:c.data("url"),openType:c.data("opentype"),name:this.title,id:c.data("id")},m="narrow"===d;l&&(l=k?c.next().find(".left-menu-sub-list:eq(0)"):c.next(),e.hasClass("opened")?(e.removeClass("opened"),l.stop(!0).slideUp(_ANIMATION_TIME_.slide),k&&m&&h.addClass("hidden")):(e.addClass("opened"),k&&m&&h.removeClass("hidden"),l.stop(!0).slideDown(_ANIMATION_TIME_.slide),e.siblings(".opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").stop(!0).slideUp(_ANIMATION_TIME_.slide)));if(p.url){if(String($mainIframe.data("id"))===String(c.data("id")))return;a(".left-menu-link").removeClass("active");c.addClass("active");p.menuLink=!0;dealLinkOpen(p);m&&(g.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp(_ANIMATION_TIME_.slide),h.addClass("hidden"),b.removeClass("has-opened"))}if(k&&m)b[g.find(".left-menu-item.level-1.opened").length?"addClass":"removeClass"]("has-opened")});a("body").on("click",function(b){a(b.target).closest("#left-menu").length||(h.addClass("hidden"),"narrow"===d&&g&&g.find(".left-menu-item.level-1.opened").removeClass("opened").find(".left-menu-sub-list:eq(0)").slideUp())})})();c.getLefMenu=function(c,n){var l=c.code;if(!h[l]||"reject"===h[l])return _getData_("getMenu",{query:"sub",code:l}).done(function(m){console.log(m);m&&m.length&&(m=e(m),g=a(Mustache.render('\x3cdiv class\x3d"left-menu-wrap" id\x3d"left-menu-{{code}}"\x3e\x3cdiv class\x3d"left-menu-header"\x3e{{name}}\x3c/div\x3e\x3cul class\x3d"left-menu-list"\x3e{{{leftMenuItems}}}\x3c/ul\x3e\x3c/div\x3e',{code:c.code,name:c.name,leftMenuItems:m})),g.appendTo(q).siblings(".left-menu-wrap").addClass("hidden"),Util.browsers.isIE8&&g.find(".left-menu-list").height(b.height()-k.height()||36));h[l]="resolve";n&&d(l+"")}).fail(function(){h[l]="reject"});"resolve"===h[l]&&(g=a("#left-menu-"+l),g.removeClass("hidden").siblings(".left-menu-wrap").addClass("hidden"),n&&d(l))};var n={}})(this,jQuery);